var Yw=Object.defineProperty;var Kw=(o,n,a)=>n in o?Yw(o,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[n]=a;var ct=(o,n,a)=>(Kw(o,typeof n!="symbol"?n+"":n,a),a);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))h(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const v of g.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&h(v)}).observe(document,{childList:!0,subtree:!0});function a(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function h(d){if(d.ep)return;d.ep=!0;const g=a(d);fetch(d.href,g)}})();function Ox(o){return o<2?"Low":o>=2&&o<4?"Medium":o>=4&&o<8?"High":o>=8?"Highest":"N/A"}const I={key:["Menu Options","hover panel text","color scheme","percentiles","legend labels"],"h3-index":[["N/A"],["H3 Index",""],"rainbow"],row_col:[["N/A"],["Row/Col",""],"rainbow"],female_educational_attainment_mean:[["Demographics","Female Education","N/A"],["Avg. Female Education","years"],"rdylgn",{max:8.6589,min:3.4551,mean:4.8228326,median:4.7054,"98_percentile":6.68306,"99_percentile":7.185144,"2_percentile":3.999912,"1_percentile":3.921612,quantiles:[3.4551,4.26988,4.4051,4.5131,4.6083,4.7054,4.80628,4.9392,5.11134,5.48352,8.6589],style_stops_99:[3.921612,4.737495005130768,5.553377985954285,6.3692609667778015,7.185144],style_stops_98:[3.999912,4.670699059963226,5.341486096382141,6.012273132801056,6.68306],style_stops_maxmin:[3.4551,4.756050109863281,6.057000160217285,7.357950210571289,8.6589]},["Less Educated","More Educated"]],females_0_4:[["Population","Female 0-4","N/A"],["Population","females"],"magma",{max:1174,min:0,mean:39.94789195806871,median:33,"98_percentile":135,"99_percentile":198,"2_percentile":2,"1_percentile":1,quantiles:[0,10,17,23,28,33,38,44,52,68.29999999999927,1174],style_stops_99:[1,50.25,99.5,148.75,198],style_stops_98:[2,35.25,68.5,101.75,135],style_stops_maxmin:[0,293.5,587,880.5,1174]},["More People","Less People"]],females_0_9:[["Population","Female 0-9","N/A"],["Population","females"],"magma",{max:2347,min:0,mean:86.69309051955008,median:72,"98_percentile":287,"99_percentile":414.89000000000306,"2_percentile":5,"1_percentile":2,quantiles:[0,21,38,51,62,72,83,96,114,148,2347],style_stops_99:[2,105.22250000000076,208.44500000000153,311.6675000000023,414.89000000000306],style_stops_98:[5,75.5,146,216.5,287],style_stops_maxmin:[0,586.75,1173.5,1760.25,2347]},["More People","Less People"]],females_10_14:[["Population","Female 10-14","N/A"],["Population","females"],"magma",{max:1087,min:0,mean:43.51254877955467,median:36,"98_percentile":145,"99_percentile":207,"2_percentile":2,"1_percentile":1,quantiles:[0,11,19,26,31,36,42,48,57,75,1087],style_stops_99:[1,52.5,104,155.5,207],style_stops_98:[2,37.75,73.5,109.25,145],style_stops_maxmin:[0,271.75,543.5,815.25,1087]},["More People","Less People"]],females_15_49:[["Population","Female 15-49","N/A"],["Population","females"],"magma",{max:5236,min:0,mean:176.1674573418012,median:147,"98_percentile":583.2599999999984,"99_percentile":847.630000000001,"2_percentile":10,"1_percentile":5,quantiles:[0,43,77,104,126,147,168,193,228,296,5236],style_stops_99:[5,215.65750000000025,426.3150000000005,636.9725000000008,847.630000000001],style_stops_98:[10,153.3149999999996,296.6299999999992,439.9449999999988,583.2599999999984],style_stops_maxmin:[0,1309,2618,3927,5236]},["More People","Less People"]],females_50_64:[["Population","Female 50-64","N/A"],["Population","females"],"magma",{max:487,min:0,mean:25.222740837095415,median:22,"98_percentile":81,"99_percentile":106,"2_percentile":1,"1_percentile":0,quantiles:[0,6,11,15,19,22,25,29,34,44,487],style_stops_99:[0,26.5,53,79.5,106],style_stops_98:[1,21,41,61,81],style_stops_maxmin:[0,121.75,243.5,365.25,487]},["More People","Less People"]],females_5_9:[["Population","Female 5-9","N/A"],["Population","females"],"magma",{max:1173,min:0,mean:46.2448542352131,median:39,"98_percentile":151,"99_percentile":218.63000000000102,"2_percentile":2,"1_percentile":1,quantiles:[0,11,20,27,33,39,45,51,61,80,1173],style_stops_99:[1,55.407500000000255,109.81500000000051,164.22250000000076,218.63000000000102],style_stops_98:[2,39.25,76.5,113.75,151],style_stops_maxmin:[0,293.25,586.5,879.75,1173]},["More People","Less People"]],females_65_plus:[["Population","Female 65+","N/A"],["Population","females"],"magma",{max:181,min:0,mean:10.05325579615885,median:9,"98_percentile":33,"99_percentile":44,"2_percentile":0,"1_percentile":0,quantiles:[0,2,4,6,7,9,10,12,14,18,181],style_stops_99:[0,11,22,33,44],style_stops_98:[0,8.25,16.5,24.75,33],style_stops_maxmin:[0,45.25,90.5,135.75,181]},["More People","Less People"]],male_educational_attainment_mean:[["Demographics","Male Education","N/A"],["Avg. Male Education","years"],"rdylgn",{max:8.9661,min:4.0105,mean:5.114354,median:4.9656,"98_percentile":7.050552,"99_percentile":7.602576,"2_percentile":4.444456,"1_percentile":4.357428,quantiles:[4.0105,4.6616,4.7679,4.8369,4.8977,4.9656,5.0479,5.152,5.3074403,5.70886,8.9661],style_stops_99:[4.357428,5.168715000152588,5.980001926422119,6.79128885269165,7.602576],style_stops_98:[4.444456,5.0959800481796265,5.747503995895386,6.399027943611145,7.050552],style_stops_maxmin:[4.0105,5.249399900436401,6.48829984664917,7.7271997928619385,8.9661]},["Less Educated","More Educated"]],males_0_4:[["Population","Male 0-4","N/A"],["Population","males"],"magma",{max:1239,min:0,mean:40.78728288315862,median:34,"98_percentile":138,"99_percentile":200,"2_percentile":2,"1_percentile":1,quantiles:[0,10,18,24,29,34,39,45,53,70,1239],style_stops_99:[1,50.75,100.5,150.25,200],style_stops_98:[2,36,70,104,138],style_stops_maxmin:[0,309.75,619.5,929.25,1239]},["More People","Less People"]],males_0_9:[["Population","Male 0-9","N/A"],["Population","males"],"magma",{max:2413,min:0,mean:88.35660723850333,median:74,"98_percentile":293,"99_percentile":421.630000000001,"2_percentile":5,"1_percentile":2,quantiles:[0,22,39,52,63,74,84,98,116,151,2413],style_stops_99:[2,106.90750000000025,211.8150000000005,316.72250000000076,421.630000000001],style_stops_98:[5,77,149,221,293],style_stops_maxmin:[0,603.25,1206.5,1809.75,2413]},["More People","Less People"]],males_10_14:[["Population","Male 10-14","N/A"],["Population","males"],"magma",{max:987,min:0,mean:44.25835947662407,median:37,"98_percentile":147,"99_percentile":207.63000000000102,"2_percentile":2,"1_percentile":1,quantiles:[0,11,20,26,32,37,43,49,59,77,987],style_stops_99:[1,52.657500000000255,104.31500000000051,155.97250000000076,207.63000000000102],style_stops_98:[2,38.25,74.5,110.75,147],style_stops_maxmin:[0,246.75,493.5,740.25,987]},["More People","Less People"]],males_15_49:[["Population","Male 15-49","N/A"],["Population","males"],"magma",{max:7696,min:0,mean:175.09771214323973,median:137,"98_percentile":614.2599999999984,"99_percentile":973.890000000003,"2_percentile":9,"1_percentile":5,quantiles:[0,41,73,98,118,137,157,181,215,287,7696],style_stops_99:[5,247.22250000000076,489.4450000000015,731.6675000000023,973.890000000003],style_stops_98:[9,160.3149999999996,311.6299999999992,462.9449999999988,614.2599999999984],style_stops_maxmin:[0,1924,3848,5772,7696]},["More People","Less People"]],males_50_64:[["Population","Male 50-64","N/A"],["Population","males"],"magma",{max:626,min:0,mean:24.470005356186395,median:20,"98_percentile":85,"99_percentile":123,"2_percentile":1,"1_percentile":0,quantiles:[0,6,11,14,17,20,23,27,32,42,626],style_stops_99:[0,30.75,61.5,92.25,123],style_stops_98:[1,22,43,64,85],style_stops_maxmin:[0,156.5,313,469.5,626]},["More People","Less People"]],males_5_9:[["Population","Male 5-9","N/A"],["Population","males"],"magma",{max:1173,min:0,mean:47.07093121126329,median:40,"98_percentile":154,"99_percentile":222,"2_percentile":2,"1_percentile":1,quantiles:[0,11,21,28,34,40,45,52,62,81,1173],style_stops_99:[1,56.25,111.5,166.75,222],style_stops_98:[2,40,78,116,154],style_stops_maxmin:[0,293.25,586.5,879.75,1173]},["More People","Less People"]],males_65_plus:[["Population","Male 65+","N/A"],["Population","males"],"magma",{max:116,min:0,mean:7.452827301247226,median:6,"98_percentile":25,"99_percentile":33,"2_percentile":0,"1_percentile":0,quantiles:[0,2,3,4,5,6,7,9,10,13,116],style_stops_99:[0,8.25,16.5,24.75,33],style_stops_98:[0,6.25,12.5,18.75,25],style_stops_maxmin:[0,29,58,87,116]},["More People","Less People"]],pop_0_4:[["Population","Children 0-4","N/A"],["Population","people"],"magma",{max:2414,min:0,mean:81.23295584972071,median:67,"98_percentile":273.2599999999984,"99_percentile":401.630000000001,"2_percentile":4,"1_percentile":2,quantiles:[0,20,36,48,58,67,77,89,106,139,2414],style_stops_99:[2,101.90750000000025,201.8150000000005,301.72250000000076,401.630000000001],style_stops_98:[4,71.3149999999996,138.6299999999992,205.9449999999988,273.2599999999984],style_stops_maxmin:[0,603.5,1207,1810.5,2414]},["More People","Less People"]],pop_0_9:[["Population","Children 0-9","N/A"],["Population","people"],"magma",{max:4761,min:0,mean:175.5523375927768,median:146,"98_percentile":581,"99_percentile":837,"2_percentile":10,"1_percentile":5,quantiles:[0,44,78,104,126,146,168,194,230,300,4761],style_stops_99:[5,213,421,629,837],style_stops_98:[10,152.75,295.5,438.25,581],style_stops_maxmin:[0,1190.25,2380.5,3570.75,4761]},["More People","Less People"]],pop_10_14:[["Population","Youth 10-14","N/A"],["Population","people"],"magma",{max:2074,min:0,mean:88.26807712908409,median:74,"98_percentile":293,"99_percentile":413,"2_percentile":5,"1_percentile":2,quantiles:[0,22,39,53,63,74,85,98,117,153,2074],style_stops_99:[2,104.75,207.5,310.25,413],style_stops_98:[5,77,149,221,293],style_stops_maxmin:[0,518.5,1037,1555.5,2074]},["More People","Less People"]],pop_15_49:[["Population","People 15-49","N/A"],["Population","people"],"magma",{max:12933,min:0,mean:351.7657051036805,median:285,"98_percentile":1182,"99_percentile":1817.260000000002,"2_percentile":19,"1_percentile":10,quantiles:[0,86,152,203,245,285,327,374,444,585,12933],style_stops_99:[10,461.8150000000005,913.630000000001,1365.4450000000015,1817.260000000002],style_stops_98:[19,309.75,600.5,891.25,1182],style_stops_maxmin:[0,3233.25,6466.5,9699.75,12933]},["More People","Less People"]],pop_50_64:[["Population","People 50-64","N/A"],["Population","people"],"magma",{max:1e3,min:0,mean:50.18991506618716,median:43,"98_percentile":164,"99_percentile":228,"2_percentile":3,"1_percentile":1,quantiles:[0,12,23,30,37,43,49,56,66,87,1e3],style_stops_99:[1,57.75,114.5,171.25,228],style_stops_98:[3,43.25,83.5,123.75,164],style_stops_maxmin:[0,250,500,750,1e3]},["More People","Less People"]],pop_5_9:[["Population","Children 5-9","N/A"],["Population","people"],"magma",{max:2347,min:0,mean:93.82137118371719,median:79,"98_percentile":304,"99_percentile":442,"2_percentile":5,"1_percentile":2,quantiles:[0,23,42,56,68,79,90,104,124,161,2347],style_stops_99:[2,112,222,332,442],style_stops_98:[5,79.75,154.5,229.25,304],style_stops_maxmin:[0,586.75,1173.5,1760.25,2347]},["More People","Less People"]],pop_65_plus:[["Population","People 65+","N/A"],["Population","people"],"magma",{max:295,min:0,mean:17.99812533476165,median:16,"98_percentile":57,"99_percentile":78,"2_percentile":1,"1_percentile":0,quantiles:[0,4,8,11,13,16,18,21,24,32,295],style_stops_99:[0,19.5,39,58.5,78],style_stops_98:[1,15,29,43,57],style_stops_maxmin:[0,73.75,147.5,221.25,295]},["More People","Less People"]],population:[["Population","All","N/A"],["Population","people"],"magma",{max:19813,min:0,mean:685.0027928686204,median:568,"98_percentile":2282.0399999999936,"99_percentile":3354.150000000005,"2_percentile":39,"1_percentile":21,quantiles:[0,169,302,405,488,568,649,746,885,1153,19813],style_stops_99:[21,854.2875000000013,1687.5750000000025,2520.862500000004,3354.150000000005],style_stops_98:[39,599.7599999999984,1160.5199999999968,1721.2799999999952,2282.0399999999936],style_stops_maxmin:[0,4953.25,9906.5,14859.75,19813]},["More People","Less People"]],pregnancies:[["Demographics","Pregnancies","N/A"],["Pregnancies"],"magma",{max:1470,min:0,mean:24.80560869232535,median:22,"98_percentile":69,"99_percentile":98,"2_percentile":1,"1_percentile":0,quantiles:[0,6,12,15,19,22,25,28,33,40,1470],style_stops_99:[0,24.5,49,73.5,98],style_stops_98:[1,18,35,52,69],style_stops_maxmin:[0,367.5,735,1102.5,1470]},["More Pregnancies","Less Pregnancies"]],births:[["Demographics","Births","N/A"],["Births"],"magma",{max:1038,min:0,mean:17.36693702655138,median:15,"98_percentile":48,"99_percentile":69,"2_percentile":1,"1_percentile":0,quantiles:[0,4,8,11,13,15,17,20,23,28,1038],style_stops_99:[0,17.25,34.5,51.75,69],style_stops_98:[1,12.75,24.5,36.25,48],style_stops_maxmin:[0,259.5,519,778.5,1038]},["More Births","Less Births"]],rwi:[["Demographics","Relative Wealth Index","N/A"],["Relative Wealth Index"],"rdylgn",{max:1.8281,min:-.6764,mean:.037351005,median:-.0138,"98_percentile":.79605,"99_percentile":1.014425,"2_percentile":-.3014,"1_percentile":-.341575,quantiles:[-.6764,-.1962,-.1374,-.0932,-.0529,-.0138,.0312,.0852,.1652,.3208,1.8281],style_stops_99:[-.341575,-.0025749802589416504,.3364250361919403,.6754250526428223,1.014425],style_stops_98:[-.3014,-.027037501335144043,.24732500314712524,.5216875076293945,.79605],style_stops_maxmin:[-.6764,-.05027502775192261,.5758499503135681,1.2019749283790588,1.8281]},["Less Wealthy","More Wealthy"]],underweight:[["Demographics","Underweight","N/A"],["Underweight"],"rdylgn",{max:.2202,min:.047,mean:.085901745,median:.0853,"98_percentile":.11585,"99_percentile":.128375,"2_percentile":.0609,"1_percentile":.055725,quantiles:[.047,.0731,.0773,.0803,.0828,.0853,.0876,.0902,.0936,.0986,.2202],style_stops_99:[.055725,.07388749904930592,.09204999729990959,.11021249555051327,.128375],style_stops_98:[.0609,.07463749963790178,.08837500028312206,.10211250092834234,.11585],style_stops_maxmin:[.047,.09030000120401382,.13360000401735306,.1769000068306923,.2202]},["More Underweight","Less Underweight"]],travel_time_all_education_facilities_fixed:[["Travel Time","With All Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:64.64993496059377,median:46,"98_percentile":280.2599999999984,"99_percentile":431,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,39,46,53,63,76,104,1700],style_stops_99:[10,30,46,60,431],style_stops_98:[11,30,46,60,280.2599999999984],style_stops_maxmin:[5,428.75,852.5,1276.25,1700]},["Longer","Shorter"]],travel_time_all_health_facilities_optimal:[["Travel Time","With All Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:87.18452062131762,median:73,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,29,42,53,63,73,83,96,112,140,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,420,833,1246,1659]},["Longer","Shorter"]],travel_time_constructed_sites_all_education_facilities_fixed:[["Travel Time","With Constructed Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:66.77672354426505,median:47,"98_percentile":295.2599999999984,"99_percentile":450.630000000001,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,40,47,55,64,78,110,1700],style_stops_99:[10,30,46,60,450.63],style_stops_98:[11,30,46,60,295.2599999999984],style_stops_maxmin:[5,30,46,60,1700]},["Longer","Shorter"]],travel_time_constructed_sites_all_health_facilities_optimal:[["Travel Time","With Constructed Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:87.94938403856455,median:74,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,30,43,53,64,74,84.19999999999891,97,114,141,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,45,90,135,1659]},["Longer","Shorter"]],travel_time_constructed_sites_health_centers_optimal:[["Travel Time","With Constructed Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:122.2729359553141,median:104,"98_percentile":376,"99_percentile":499.630000000001,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,76,90,104,119,136,159,199,1775],style_stops_99:[15,45,90,135,499.630000000001],style_stops_98:[19,45,90,135,376],style_stops_maxmin:[7,45,90,135,1775]},["Longer","Shorter"]],travel_time_constructed_sites_health_posts_optimal:[["Travel Time","With Constructed Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:129.43029305991277,median:112,"98_percentile":342,"99_percentile":446.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,62,79,96,112,130,151,178,221,1659],style_stops_99:[15,45,90,135,446.26000000000204],style_stops_98:[19,45,90,135,342],style_stops_maxmin:[7,45,90,135,1659]},["Longer","Shorter"]],travel_time_constructed_sites_major_hospitals_optimal:[["Travel Time","With Constructed Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:368.4278827760349,median:340,"98_percentile":967.2599999999984,"99_percentile":1111.630000000001,"2_percentile":60,"1_percentile":41,quantiles:[10,141,203,253,298,340,384,432,498,608,1774],style_stops_99:[41,60,120,180,1111.630000000001],style_stops_98:[60,286.8149999999996,513.6299999999992,740.4449999999988,967.2599999999984],style_stops_maxmin:[10,451,892,1333,1774]},["Longer","Shorter"]],travel_time_constructed_sites_primary_schools_fixed:[["Travel Time","With Constructed Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:71.40767275974714,median:51.16,"98_percentile":299.1866666666659,"99_percentile":453.08733333333294,"2_percentile":12.863636363636363,"1_percentile":11.499789473684212,quantiles:[5.133333333333334,20.91176470588235,29.540317460317464,36.85981900452488,43.947908232118756,51.16,59.46153846153846,69.9280423280423,85.59285714285718,119.18817567567568,1700.3636363636363],style_stops_99:[11.499789473684212,30,46,60,453.08733333333294],style_stops_98:[12.863636363636363,84.44439393939373,156.02515151515112,227.60590909090848,299.1866666666659],style_stops_maxmin:[5.133333333333334,428.94090909090903,852.7484848484847,1276.5560606060606,1700.3636363636363]},["Longer","Shorter"]],travel_time_constructed_sites_secondary_schools_fixed:[["Travel Time","With Constructed Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:98.89652336748952,median:75.22361111111111,"98_percentile":400.1361212121209,"99_percentile":529.9095833333323,"2_percentile":14.24649202047576,"1_percentile":12.264347980786338,quantiles:[5.133333333333334,28.119918699186993,41.086656671664166,52.58320895522388,63.80250000000001,75.22361111111111,87.87391304347825,103.48525252525252,125.79307692307694,169.3693633952255,1725.75],style_stops_99:[12.264347980786338,30,46,60,529.9095833333323],style_stops_98:[14.24649202047576,110.71889931838703,207.1913066162983,303.6637139142096,400.1361212121209],style_stops_maxmin:[5.133333333333334,435.28749999999997,865.4416666666666,1295.5958333333333,1725.75]},["Longer","Shorter"]],travel_time_constructed_sites_semi_dense_urban_optimal:[["Travel Time","With Constructed Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:376.9627362460785,median:330,"98_percentile":1011,"99_percentile":1101,"2_percentile":27,"1_percentile":21,quantiles:[10,91,156,216,272,330,396,474,571,732,1758],style_stops_99:[21,60,120,180,1101],style_stops_98:[27,273,519,765,1011],style_stops_maxmin:[10,447,884,1321,1758]},["Longer","Shorter"]],travel_time_health_centers_optimal:[["Travel Time","With All Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:120.95638533935266,median:103,"98_percentile":376,"99_percentile":497.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,60,75,89,103,118,135,157,196,1775],style_stops_99:[15,30,46,60,497.26000000000204],style_stops_98:[19,30,46,60,376],style_stops_maxmin:[7,30,46,60,1775]},["Longer","Shorter"]],travel_time_health_posts_optimal:[["Travel Time","With All Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:127.87585125105211,median:110,"98_percentile":338,"99_percentile":445,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,78,94,110,128,149,176,219,1659],style_stops_99:[15,30,46,60,445],style_stops_98:[19,30,46,60,338],style_stops_maxmin:[7,30,46,60,1659]},["Longer","Shorter"]],travel_time_major_hospitals_optimal:[["Travel Time","With All Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:364.9125793863341,median:336,"98_percentile":954.2599999999984,"99_percentile":1084,"2_percentile":59,"1_percentile":41,quantiles:[10,139,201,250,294,336,380,429,494,605,1774],style_stops_99:[41,60,120,180,1084],style_stops_98:[59,60,120,180,954.2599999999984],style_stops_maxmin:[10,60,120,180,1774]},["Longer","Shorter"]],travel_time_no_sites_all_education_facilities_fixed:[["Travel Time","Without Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:67.1364297191828,median:47,"98_percentile":299,"99_percentile":450.630000000001,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,40,47,55,65,79,111,1700],style_stops_99:[10,30,45,60,450.630000000001],style_stops_98:[11,30,45,60,299],style_stops_maxmin:[5,30,45,60,1700]},["Longer","Shorter"]],travel_time_no_sites_all_health_facilities_optimal:[["Travel Time","Without Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:88.12170020659576,median:74,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,30,43,53,64,74,85,97,114,141,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,45,90,135,1659]},["Longer","Shorter"]],travel_time_no_sites_health_centers_optimal:[["Travel Time","Without Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:122.52620705486265,median:104,"98_percentile":376,"99_percentile":499.630000000001,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,77,90,104,119,136.89999999999782,159,199,1775],style_stops_99:[15,45,90,135,499.630000000001],style_stops_98:[19,45,90,135,376],style_stops_maxmin:[7,45,90,135,1775]},["Longer","Shorter"]],travel_time_no_sites_health_posts_optimal:[["Travel Time","Without Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:129.89023643737087,median:113,"98_percentile":343,"99_percentile":446.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,62,79,96,113,131,152,179,222,1659],style_stops_99:[15,45,90,135,446.26000000000204],style_stops_98:[19,45,90,135,262,343],style_stops_maxmin:[7,45,90,135,1659]},["Longer","Shorter"]],travel_time_no_sites_major_hospitals_optimal:[["Travel Time","Without Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:369.13463157089296,median:341,"98_percentile":967.2599999999984,"99_percentile":1111.630000000001,"2_percentile":60,"1_percentile":41,quantiles:[10,142,204,253,299,341,384,433,498,610,1774],style_stops_99:[41,60,120,180,1111.630000000001],style_stops_98:[60,60,120,180,967.2599999999984],style_stops_maxmin:[10,60,120,180,1774]},["Longer","Shorter"]],travel_time_no_sites_primary_schools_fixed:[["Travel Time","Without Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:71.75796345160377,median:51.32727272727273,"98_percentile":301.51599999999945,"99_percentile":453.08733333333294,"2_percentile":12.864895104895105,"1_percentile":11.511820931639443,quantiles:[5.133333333333334,20.92804399057345,29.61742654508612,36.931419457735245,44.04545454545455,51.32727272727273,59.71318681318681,70.25,86.03045761440363,119.87186009538954,1700.3636363636363],style_stops_99:[11.511820931639443,30,45,60,453.08733333333294],style_stops_98:[12.864895104895105,30,45,60,301.51599999999945],style_stops_maxmin:[5.133333333333334,30,45,60,1700.3636363636363]},["Longer","Shorter"]],travel_time_no_sites_secondary_schools_fixed:[["Travel Time","Without Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:99.44496852814716,median:75.47935435435436,"98_percentile":404.03360139860104,"99_percentile":529.9095833333323,"2_percentile":14.24649202047576,"1_percentile":12.264347980786338,quantiles:[5.133333333333334,28.146439024390244,41.16964285714287,52.75548780487805,64.05233821445442,75.47935435435436,88.23946388682054,104.18397534668718,126.51818181818189,170.43190476190478,1725.75],style_stops_99:[12.264347980786338,30,45,60,529.9095833333323],style_stops_98:[14.24649202047576,30,45,60,404.03360139860104],style_stops_maxmin:[5.133333333333334,30,45,60,1725.75]},["Longer","Shorter"]],travel_time_no_sites_semi_dense_urban_optimal:[["Travel Time","Without Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:377.7297803963578,median:331,"98_percentile":1012,"99_percentile":1101,"2_percentile":27,"1_percentile":21,quantiles:[10,91,157,216,272,331,396,475,573,733,1758],style_stops_99:[21,60,120,180,1101],style_stops_98:[27,60,120,180,1012],style_stops_maxmin:[10,60,120,180,1758]},["Longer","Shorter"]],travel_time_primary_schools_fixed:[["Travel Time","With All Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:69.20764038727852,median:50.241379310344826,"98_percentile":284.9642105263155,"99_percentile":430.96133333333273,"2_percentile":12.767935916542474,"1_percentile":11.439333333333334,quantiles:[5.133333333333334,20.678656126482217,29.225929127052726,36.3762987012987,43.2402962962963,50.241379310344826,58.142857142857146,68,82.70089399744576,113.63214285714288,1700.3636363636363],style_stops_99:[11.439333333333334,30,45,60,430.96133333333273],style_stops_98:[12.767935916542474,30,45,60,284.9642105263155],style_stops_maxmin:[5.133333333333334,30,45,60,1700.3636363636363]},["Longer","Shorter"]],travel_time_secondary_schools_fixed:[["Travel Time","With All Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:95.76174201155379,median:73.67567567567568,"98_percentile":385.59878787878796,"99_percentile":512.0158169934646,"2_percentile":14.202546583850932,"1_percentile":12.222857142857142,quantiles:[5.133333333333334,27.86842105263158,40.67359667359667,51.854602675059006,62.82921832884097,73.67567567567568,86,100.54747474747472,121.08325358851685,160.87112299465244,1725.75],style_stops_99:[12.222857142857142,30,45,60,512.0158169934646],style_stops_98:[14.202546583850932,30,45,60,385.59878787878796],style_stops_maxmin:[5.133333333333334,30,45,60,1725.75]},["Longer","Shorter"]],travel_time_semi_dense_urban_optimal:[["Travel Time","With All Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:373.7797842222052,median:327,"98_percentile":1007.2599999999984,"99_percentile":1093.630000000001,"2_percentile":27,"1_percentile":21,quantiles:[10,90,155,213,268,327,391,469,567,728,1758],style_stops_99:[21,60,120,180,1093.630000000001],style_stops_98:[27,60,120,180,1007.2599999999984],style_stops_maxmin:[10,60,120,180,1758]},["Longer","Shorter"]],all_education_potential_impact:[["Impact","Potential Impact","School"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.08149055015685974,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],all_education_current_impact:[["Impact","Current Impact","School"],["Current Impact",""],"impactScheme",{max:8,min:0,mean:.013466982936720483,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],all_health_potential_impact:[["Impact","Potential Impact","Healthcare"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.044456347080878415,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],all_health_current_impact:[["Impact","Current Impact","Healthcare"],["Potential Impact",""],"impactScheme",{max:4,min:0,mean:.006580457571352055,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],health_centers_potential_impact:[["Impact","Potential Impact","Health Center"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.04690488943300941,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],health_centers_current_impact:[["Impact","Current Impact","Health Center"],["Current Impact",""],"impactScheme",{max:4,min:0,mean:.0055092202922947435,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],health_posts_potential_impact:[["Impact","Potential Impact","Health Post"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.05608692325350065,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],health_posts_current_impact:[["Impact","Current Impact","Health Post"],["Current Impact",""],"impactScheme",{max:4,min:0,mean:.010635855842069018,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],major_hospitals_potential_impact:[["Impact","Potential Impact","Hospital"],["Potential Impact",""],"impactScheme",{max:4,min:0,mean:.01614507613436376,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],major_hospitals_current_impact:[["Impact","Current Impact","Hospital"],["Current Impact",""],"impactScheme",{max:4,min:0,mean:.004973601652766088,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],primary_schools_potential_impact:[["Impact","Potential Impact","Primary School"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.07888897390772057,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],primary_schools_current_impact:[["Impact","Current Impact","Primary School"],["Current Impact",""],"impactScheme",{max:8,min:0,mean:.011630576172622236,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],secondary_schools_potential_impact:[["Impact","Potential Impact","Secondary School"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.03994184711913689,median:0,"98_percentile":0,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],secondary_schools_current_impact:[["Impact","Current Impact","Secondary School"],["Current Impact",""],"impactScheme",{max:8,min:0,mean:.00711607621088071,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],semi_dense_urban_potential_impact:[["Impact","Potential Impact","Market"],["Potential Impact",""],"impactScheme",{max:4,min:0,mean:.014002601576249139,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],semi_dense_urban_current_impact:[["Impact","Current Impact","Market"],["Current Impact",""],"impactScheme",{max:4,min:0,mean:.002907644043155559,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],total_potential_impact:[["Impact","Potential Impact","All"],["Potential Impact",""],"impactScheme",{max:22,min:0,mean:.2519703114239804,median:0,"98_percentile":4,"99_percentile":6,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,22],style_stops_99:[0,1.5,3,4.5,6],style_stops_98:[0,1,2,3,4],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],total_current_impact:[["Impact","Current Impact","All"],["Current Impact",""],"impactScheme",{max:18,min:0,mean:.04277297421378835,median:0,"98_percentile":0,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,18],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],total_school_current_impact:[["Impact","Current Impact","School"],["Current Impact",""],"impactScheme",{max:12,min:0,mean:.018746652383502947,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,12],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],total_school_potential_impact:[["Impact","Potential Impact","School"],["Potential Impact",""],"impactScheme",{max:16,min:0,mean:.11883082102685745,median:0,"98_percentile":2,"99_percentile":4,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,16],style_stops_99:[0,1,2,3,4],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],total_health_current_impact:[["Impact","Current Impact","Healthcare"],["Current Impact",""],"impactScheme",{max:8,min:0,mean:.02111867778712985,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]],total_health_potential_impact:[["Impact","Potential Impact","Healthcare"],["Potential Impact",""],"impactScheme",{max:10,min:0,mean:.11913688882087382,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,10],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]},["Less Impact","More Impact"]]},W={inferno:["#000004","#57106e","#bc3754","#f98e09","#fcffa4"],magma:["#000004","#51127c","#b73779","#fc8961","#fcfdbf"],impactScheme:["rgba(255, 255, 255, 0)","#f7fcb9","#ffeda0","#7fcdbb","#2ca25f"],plasma:["#0d0887","#7e03a8","#cc4778","#f89540","#f0f921"],viridis:["#440154","#3b528b","#21918c","#5ec962","#fde725"],cividis:["#002051","#3c4d6e","#7f7c75","#bbaf71","#fdea45"],turbo:["#23171b","#26bce1","#95fb51","#ff821d","#900c00"],warm:["#6e40aa","#d23ea7","#ff5e63","#efa72f","#aff05b"],cool:["#6e40aa","#417de0","#1ac7c2","#40f373","#aff05b"],blues:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],greens:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],grays:["#f7f7f7","#cccccc","#969696","#636363","#252525"],oranges:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],purples:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],reds:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],bugn:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],bupu:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],gnbu:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],orrd:["#fee8c8","#fdbb84","#e34a33","#b30000"],pubu:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],pubugn:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],puor:["#f1a340","#f7f7f7","#998ec3","#762a83"],purd:["#e7e1ef","#c994c7","#dd1c77","#980043"],rdpu:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],ylgn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#31a354"],ylgnbu:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],ylorbr:["#ffffe5","#fff7bc","#fec44f","#d95f0e","#993404"],ylorrd:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],brbg:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],prgn:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],piyg:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],puor:["#5e3c99","#b2abd2","#f7f7f7","#fdb863","#e66101"],rdbu:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],rdgy:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],rdylbu:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],rdylgn:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],spectral:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],rainbow:["#6e40aa","#ff5e63","#aff05b","#1ac7c2","#6e40aa"],sinebow:["#ff4040","#7fee11","#00bfbf","#7f11ee","#ff4040"],tableau10:["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],pastel:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Bx={female_educational_attainment_mean:{"fill-color":["interpolate",["linear"],["get","female_educational_attainment_mean"],I.female_educational_attainment_mean[3].style_stops_99[0],W[I.female_educational_attainment_mean[2]][0],I.female_educational_attainment_mean[3].style_stops_99[1],W[I.female_educational_attainment_mean[2]][1],I.female_educational_attainment_mean[3].style_stops_99[2],W[I.female_educational_attainment_mean[2]][2],I.female_educational_attainment_mean[3].style_stops_99[3],W[I.female_educational_attainment_mean[2]][3],I.female_educational_attainment_mean[3].style_stops_99[4],W[I.female_educational_attainment_mean[2]][4]]},females_0_4:{"fill-color":["interpolate",["linear"],["get","females_0_4"],I.females_0_4[3].style_stops_99[0],W[I.females_0_4[2]][4],I.females_0_4[3].style_stops_99[1],W[I.females_0_4[2]][3],I.females_0_4[3].style_stops_99[2],W[I.females_0_4[2]][2],I.females_0_4[3].style_stops_99[3],W[I.females_0_4[2]][1],I.females_0_4[3].style_stops_99[4],W[I.females_0_4[2]][0]]},females_0_9:{"fill-color":["interpolate",["linear"],["get","females_0_9"],I.females_0_9[3].style_stops_99[0],W[I.females_0_9[2]][4],I.females_0_9[3].style_stops_99[1],W[I.females_0_9[2]][3],I.females_0_9[3].style_stops_99[2],W[I.females_0_9[2]][2],I.females_0_9[3].style_stops_99[3],W[I.females_0_9[2]][1],I.females_0_9[3].style_stops_99[4],W[I.females_0_9[2]][0]]},females_10_14:{"fill-color":["interpolate",["linear"],["get","females_10_14"],I.females_10_14[3].style_stops_99[0],W[I.females_10_14[2]][4],I.females_10_14[3].style_stops_99[1],W[I.females_10_14[2]][3],I.females_10_14[3].style_stops_99[2],W[I.females_10_14[2]][2],I.females_10_14[3].style_stops_99[3],W[I.females_10_14[2]][1],I.females_10_14[3].style_stops_99[4],W[I.females_10_14[2]][0]]},females_15_49:{"fill-color":["interpolate",["linear"],["get","females_15_49"],I.females_15_49[3].style_stops_99[0],W[I.females_15_49[2]][4],I.females_15_49[3].style_stops_99[1],W[I.females_15_49[2]][3],I.females_15_49[3].style_stops_99[2],W[I.females_15_49[2]][2],I.females_15_49[3].style_stops_99[3],W[I.females_15_49[2]][1],I.females_15_49[3].style_stops_99[4],W[I.females_15_49[2]][0]]},females_50_64:{"fill-color":["interpolate",["linear"],["get","females_50_64"],I.females_50_64[3].style_stops_99[0],W[I.females_50_64[2]][4],I.females_50_64[3].style_stops_99[1],W[I.females_50_64[2]][3],I.females_50_64[3].style_stops_99[2],W[I.females_50_64[2]][2],I.females_50_64[3].style_stops_99[3],W[I.females_50_64[2]][1],I.females_50_64[3].style_stops_99[4],W[I.females_50_64[2]][0]]},females_5_9:{"fill-color":["interpolate",["linear"],["get","females_5_9"],I.females_5_9[3].style_stops_99[0],W[I.females_5_9[2]][4],I.females_5_9[3].style_stops_99[1],W[I.females_5_9[2]][3],I.females_5_9[3].style_stops_99[2],W[I.females_5_9[2]][2],I.females_5_9[3].style_stops_99[3],W[I.females_5_9[2]][1],I.females_5_9[3].style_stops_99[4],W[I.females_5_9[2]][0]]},females_65_plus:{"fill-color":["interpolate",["linear"],["get","females_65_plus"],I.females_65_plus[3].style_stops_99[0],W[I.females_65_plus[2]][4],I.females_65_plus[3].style_stops_99[1],W[I.females_65_plus[2]][3],I.females_65_plus[3].style_stops_99[2],W[I.females_65_plus[2]][2],I.females_65_plus[3].style_stops_99[3],W[I.females_65_plus[2]][1],I.females_65_plus[3].style_stops_99[4],W[I.females_65_plus[2]][0]]},male_educational_attainment_mean:{"fill-color":["interpolate",["linear"],["get","male_educational_attainment_mean"],I.male_educational_attainment_mean[3].style_stops_99[0],W[I.male_educational_attainment_mean[2]][0],I.male_educational_attainment_mean[3].style_stops_99[1],W[I.male_educational_attainment_mean[2]][1],I.male_educational_attainment_mean[3].style_stops_99[2],W[I.male_educational_attainment_mean[2]][2],I.male_educational_attainment_mean[3].style_stops_99[3],W[I.male_educational_attainment_mean[2]][3],I.male_educational_attainment_mean[3].style_stops_99[4],W[I.male_educational_attainment_mean[2]][4]]},males_0_4:{"fill-color":["interpolate",["linear"],["get","males_0_4"],I.males_0_4[3].style_stops_99[0],W[I.males_0_4[2]][4],I.males_0_4[3].style_stops_99[1],W[I.males_0_4[2]][3],I.males_0_4[3].style_stops_99[2],W[I.males_0_4[2]][2],I.males_0_4[3].style_stops_99[3],W[I.males_0_4[2]][1],I.males_0_4[3].style_stops_99[4],W[I.males_0_4[2]][0]]},males_0_9:{"fill-color":["interpolate",["linear"],["get","males_0_9"],I.males_0_9[3].style_stops_99[0],W[I.males_0_9[2]][4],I.males_0_9[3].style_stops_99[1],W[I.males_0_9[2]][3],I.males_0_9[3].style_stops_99[2],W[I.males_0_9[2]][2],I.males_0_9[3].style_stops_99[3],W[I.males_0_9[2]][1],I.males_0_9[3].style_stops_99[4],W[I.males_0_9[2]][0]]},males_10_14:{"fill-color":["interpolate",["linear"],["get","males_10_14"],I.males_10_14[3].style_stops_99[0],W[I.males_10_14[2]][4],I.males_10_14[3].style_stops_99[1],W[I.males_10_14[2]][3],I.males_10_14[3].style_stops_99[2],W[I.males_10_14[2]][2],I.males_10_14[3].style_stops_99[3],W[I.males_10_14[2]][1],I.males_10_14[3].style_stops_99[4],W[I.males_10_14[2]][0]]},males_15_49:{"fill-color":["interpolate",["linear"],["get","males_15_49"],I.males_15_49[3].style_stops_99[0],W[I.males_15_49[2]][4],I.males_15_49[3].style_stops_99[1],W[I.males_15_49[2]][3],I.males_15_49[3].style_stops_99[2],W[I.males_15_49[2]][2],I.males_15_49[3].style_stops_99[3],W[I.males_15_49[2]][1],I.males_15_49[3].style_stops_99[4],W[I.males_15_49[2]][0]]},males_50_64:{"fill-color":["interpolate",["linear"],["get","males_50_64"],I.males_50_64[3].style_stops_99[0],W[I.males_50_64[2]][4],I.males_50_64[3].style_stops_99[1],W[I.males_50_64[2]][3],I.males_50_64[3].style_stops_99[2],W[I.males_50_64[2]][2],I.males_50_64[3].style_stops_99[3],W[I.males_50_64[2]][1],I.males_50_64[3].style_stops_99[4],W[I.males_50_64[2]][0]]},males_5_9:{"fill-color":["interpolate",["linear"],["get","males_5_9"],I.males_5_9[3].style_stops_99[0],W[I.males_5_9[2]][4],I.males_5_9[3].style_stops_99[1],W[I.males_5_9[2]][3],I.males_5_9[3].style_stops_99[2],W[I.males_5_9[2]][2],I.males_5_9[3].style_stops_99[3],W[I.males_5_9[2]][1],I.males_5_9[3].style_stops_99[4],W[I.males_5_9[2]][0]]},males_65_plus:{"fill-color":["interpolate",["linear"],["get","males_65_plus"],I.males_65_plus[3].style_stops_99[0],W[I.males_65_plus[2]][4],I.males_65_plus[3].style_stops_99[1],W[I.males_65_plus[2]][3],I.males_65_plus[3].style_stops_99[2],W[I.males_65_plus[2]][2],I.males_65_plus[3].style_stops_99[3],W[I.males_65_plus[2]][1],I.males_65_plus[3].style_stops_99[4],W[I.males_65_plus[2]][0]]},pop_0_4:{"fill-color":["interpolate",["linear"],["get","pop_0_4"],I.pop_0_4[3].style_stops_99[0],W[I.pop_0_4[2]][4],I.pop_0_4[3].style_stops_99[1],W[I.pop_0_4[2]][3],I.pop_0_4[3].style_stops_99[2],W[I.pop_0_4[2]][2],I.pop_0_4[3].style_stops_99[3],W[I.pop_0_4[2]][1],I.pop_0_4[3].style_stops_99[4],W[I.pop_0_4[2]][0]]},pop_0_9:{"fill-color":["interpolate",["linear"],["get","pop_0_9"],I.pop_0_9[3].style_stops_99[0],W[I.pop_0_9[2]][4],I.pop_0_9[3].style_stops_99[1],W[I.pop_0_9[2]][3],I.pop_0_9[3].style_stops_99[2],W[I.pop_0_9[2]][2],I.pop_0_9[3].style_stops_99[3],W[I.pop_0_9[2]][1],I.pop_0_9[3].style_stops_99[4],W[I.pop_0_9[2]][0]]},pop_10_14:{"fill-color":["interpolate",["linear"],["get","pop_10_14"],I.pop_10_14[3].style_stops_99[0],W[I.pop_10_14[2]][4],I.pop_10_14[3].style_stops_99[1],W[I.pop_10_14[2]][3],I.pop_10_14[3].style_stops_99[2],W[I.pop_10_14[2]][2],I.pop_10_14[3].style_stops_99[3],W[I.pop_10_14[2]][1],I.pop_10_14[3].style_stops_99[4],W[I.pop_10_14[2]][0]]},pop_15_49:{"fill-color":["interpolate",["linear"],["get","pop_15_49"],I.pop_15_49[3].style_stops_99[0],W[I.pop_15_49[2]][4],I.pop_15_49[3].style_stops_99[1],W[I.pop_15_49[2]][3],I.pop_15_49[3].style_stops_99[2],W[I.pop_15_49[2]][2],I.pop_15_49[3].style_stops_99[3],W[I.pop_15_49[2]][1],I.pop_15_49[3].style_stops_99[4],W[I.pop_15_49[2]][0]]},pop_50_64:{"fill-color":["interpolate",["linear"],["get","pop_50_64"],I.pop_50_64[3].style_stops_99[0],W[I.pop_50_64[2]][4],I.pop_50_64[3].style_stops_99[1],W[I.pop_50_64[2]][3],I.pop_50_64[3].style_stops_99[2],W[I.pop_50_64[2]][2],I.pop_50_64[3].style_stops_99[3],W[I.pop_50_64[2]][1],I.pop_50_64[3].style_stops_99[4],W[I.pop_50_64[2]][0]]},pop_5_9:{"fill-color":["interpolate",["linear"],["get","pop_5_9"],I.pop_5_9[3].style_stops_99[0],W[I.pop_5_9[2]][4],I.pop_5_9[3].style_stops_99[1],W[I.pop_5_9[2]][3],I.pop_5_9[3].style_stops_99[2],W[I.pop_5_9[2]][2],I.pop_5_9[3].style_stops_99[3],W[I.pop_5_9[2]][1],I.pop_5_9[3].style_stops_99[4],W[I.pop_5_9[2]][0]]},pop_65_plus:{"fill-color":["interpolate",["linear"],["get","pop_65_plus"],I.pop_65_plus[3].style_stops_99[0],W[I.pop_65_plus[2]][4],I.pop_65_plus[3].style_stops_99[1],W[I.pop_65_plus[2]][3],I.pop_65_plus[3].style_stops_99[2],W[I.pop_65_plus[2]][2],I.pop_65_plus[3].style_stops_99[3],W[I.pop_65_plus[2]][1],I.pop_65_plus[3].style_stops_99[4],W[I.pop_65_plus[2]][0]]},population:{"fill-color":["interpolate",["linear"],["get","population"],I.population[3].style_stops_99[0],W[I.population[2]][4],I.population[3].style_stops_99[1],W[I.population[2]][3],I.population[3].style_stops_99[2],W[I.population[2]][2],I.population[3].style_stops_99[3],W[I.population[2]][1],I.population[3].style_stops_99[4],W[I.population[2]][0]]},pregnancies:{"fill-color":["interpolate",["linear"],["get","pregnancies"],I.pregnancies[3].style_stops_99[0],W[I.pregnancies[2]][4],I.pregnancies[3].style_stops_99[1],W[I.pregnancies[2]][3],I.pregnancies[3].style_stops_99[2],W[I.pregnancies[2]][2],I.pregnancies[3].style_stops_99[3],W[I.pregnancies[2]][1],I.pregnancies[3].style_stops_99[4],W[I.pregnancies[2]][0]]},births:{"fill-color":["interpolate",["linear"],["get","births"],I.births[3].style_stops_99[0],W[I.births[2]][4],I.births[3].style_stops_99[1],W[I.births[2]][3],I.births[3].style_stops_99[2],W[I.births[2]][2],I.births[3].style_stops_99[3],W[I.births[2]][1],I.births[3].style_stops_99[4],W[I.births[2]][0]]},rwi:{"fill-color":["interpolate",["linear"],["get","rwi"],I.rwi[3].style_stops_99[0],W[I.rwi[2]][0],I.rwi[3].style_stops_99[1],W[I.rwi[2]][1],I.rwi[3].style_stops_99[2],W[I.rwi[2]][2],I.rwi[3].style_stops_99[3],W[I.rwi[2]][3],I.rwi[3].style_stops_99[4],W[I.rwi[2]][4]]},underweight:{"fill-color":["interpolate",["linear"],["get","underweight"],I.underweight[3].style_stops_99[0],W[I.underweight[2]][4],I.underweight[3].style_stops_99[1],W[I.underweight[2]][3],I.underweight[3].style_stops_99[2],W[I.underweight[2]][2],I.underweight[3].style_stops_99[3],W[I.underweight[2]][1],I.underweight[3].style_stops_99[4],W[I.underweight[2]][0]]},travel_time_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_all_education_facilities_fixed"],I.travel_time_all_education_facilities_fixed[3].style_stops_99[0],W[I.travel_time_all_education_facilities_fixed[2]][4],I.travel_time_all_education_facilities_fixed[3].style_stops_99[1],W[I.travel_time_all_education_facilities_fixed[2]][3],I.travel_time_all_education_facilities_fixed[3].style_stops_99[2],W[I.travel_time_all_education_facilities_fixed[2]][2],I.travel_time_all_education_facilities_fixed[3].style_stops_99[3],W[I.travel_time_all_education_facilities_fixed[2]][1],I.travel_time_all_education_facilities_fixed[3].style_stops_99[4],W[I.travel_time_all_education_facilities_fixed[2]][0]]},travel_time_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_all_health_facilities_optimal"],I.travel_time_all_health_facilities_optimal[3].style_stops_99[0],W[I.travel_time_all_health_facilities_optimal[2]][4],I.travel_time_all_health_facilities_optimal[3].style_stops_99[1],W[I.travel_time_all_health_facilities_optimal[2]][3],I.travel_time_all_health_facilities_optimal[3].style_stops_99[2],W[I.travel_time_all_health_facilities_optimal[2]][2],I.travel_time_all_health_facilities_optimal[3].style_stops_99[3],W[I.travel_time_all_health_facilities_optimal[2]][1],I.travel_time_all_health_facilities_optimal[3].style_stops_99[4],W[I.travel_time_all_health_facilities_optimal[2]][0]]},travel_time_constructed_sites_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_all_education_facilities_fixed"],I.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[0],W[I.travel_time_constructed_sites_all_education_facilities_fixed[2]][4],I.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[1],W[I.travel_time_constructed_sites_all_education_facilities_fixed[2]][3],I.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[2],W[I.travel_time_constructed_sites_all_education_facilities_fixed[2]][2],I.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[3],W[I.travel_time_constructed_sites_all_education_facilities_fixed[2]][1],I.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[4],W[I.travel_time_constructed_sites_all_education_facilities_fixed[2]][0]]},travel_time_constructed_sites_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_all_health_facilities_optimal"],I.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[0],W[I.travel_time_constructed_sites_all_health_facilities_optimal[2]][4],I.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[1],W[I.travel_time_constructed_sites_all_health_facilities_optimal[2]][3],I.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[2],W[I.travel_time_constructed_sites_all_health_facilities_optimal[2]][2],I.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[3],W[I.travel_time_constructed_sites_all_health_facilities_optimal[2]][1],I.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[4],W[I.travel_time_constructed_sites_all_health_facilities_optimal[2]][0]]},travel_time_constructed_sites_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_health_centers_optimal"],I.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[0],W[I.travel_time_constructed_sites_health_centers_optimal[2]][4],I.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[1],W[I.travel_time_constructed_sites_health_centers_optimal[2]][3],I.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[2],W[I.travel_time_constructed_sites_health_centers_optimal[2]][2],I.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[3],W[I.travel_time_constructed_sites_health_centers_optimal[2]][1],I.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[4],W[I.travel_time_constructed_sites_health_centers_optimal[2]][0]]},travel_time_constructed_sites_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_health_posts_optimal"],I.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[0],W[I.travel_time_constructed_sites_health_posts_optimal[2]][4],I.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[1],W[I.travel_time_constructed_sites_health_posts_optimal[2]][3],I.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[2],W[I.travel_time_constructed_sites_health_posts_optimal[2]][2],I.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[3],W[I.travel_time_constructed_sites_health_posts_optimal[2]][1],I.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[4],W[I.travel_time_constructed_sites_health_posts_optimal[2]][0]]},travel_time_constructed_sites_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_major_hospitals_optimal"],I.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[0],W[I.travel_time_constructed_sites_major_hospitals_optimal[2]][4],I.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[1],W[I.travel_time_constructed_sites_major_hospitals_optimal[2]][3],I.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[2],W[I.travel_time_constructed_sites_major_hospitals_optimal[2]][2],I.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[3],W[I.travel_time_constructed_sites_major_hospitals_optimal[2]][1],I.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[4],W[I.travel_time_constructed_sites_major_hospitals_optimal[2]][0]]},travel_time_constructed_sites_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_primary_schools_fixed"],I.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[0],W[I.travel_time_constructed_sites_primary_schools_fixed[2]][4],I.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[1],W[I.travel_time_constructed_sites_primary_schools_fixed[2]][3],I.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[2],W[I.travel_time_constructed_sites_primary_schools_fixed[2]][2],I.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[3],W[I.travel_time_constructed_sites_primary_schools_fixed[2]][1],I.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[4],W[I.travel_time_constructed_sites_primary_schools_fixed[2]][0]]},travel_time_constructed_sites_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_secondary_schools_fixed"],I.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[0],W[I.travel_time_constructed_sites_secondary_schools_fixed[2]][4],I.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[1],W[I.travel_time_constructed_sites_secondary_schools_fixed[2]][3],I.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[2],W[I.travel_time_constructed_sites_secondary_schools_fixed[2]][2],I.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[3],W[I.travel_time_constructed_sites_secondary_schools_fixed[2]][1],I.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[4],W[I.travel_time_constructed_sites_secondary_schools_fixed[2]][0]]},travel_time_constructed_sites_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_semi_dense_urban_optimal"],I.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[0],W[I.travel_time_constructed_sites_semi_dense_urban_optimal[2]][4],I.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[1],W[I.travel_time_constructed_sites_semi_dense_urban_optimal[2]][3],I.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[2],W[I.travel_time_constructed_sites_semi_dense_urban_optimal[2]][2],I.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[3],W[I.travel_time_constructed_sites_semi_dense_urban_optimal[2]][1],I.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[4],W[I.travel_time_constructed_sites_semi_dense_urban_optimal[2]][0]]},travel_time_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_health_centers_optimal"],I.travel_time_health_centers_optimal[3].style_stops_99[0],W[I.travel_time_health_centers_optimal[2]][4],I.travel_time_health_centers_optimal[3].style_stops_99[1],W[I.travel_time_health_centers_optimal[2]][3],I.travel_time_health_centers_optimal[3].style_stops_99[2],W[I.travel_time_health_centers_optimal[2]][2],I.travel_time_health_centers_optimal[3].style_stops_99[3],W[I.travel_time_health_centers_optimal[2]][1],I.travel_time_health_centers_optimal[3].style_stops_99[4],W[I.travel_time_health_centers_optimal[2]][0]]},travel_time_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_health_posts_optimal"],I.travel_time_health_posts_optimal[3].style_stops_99[0],W[I.travel_time_health_posts_optimal[2]][4],I.travel_time_health_posts_optimal[3].style_stops_99[1],W[I.travel_time_health_posts_optimal[2]][3],I.travel_time_health_posts_optimal[3].style_stops_99[2],W[I.travel_time_health_posts_optimal[2]][2],I.travel_time_health_posts_optimal[3].style_stops_99[3],W[I.travel_time_health_posts_optimal[2]][1],I.travel_time_health_posts_optimal[3].style_stops_99[4],W[I.travel_time_health_posts_optimal[2]][0]]},travel_time_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_major_hospitals_optimal"],I.travel_time_major_hospitals_optimal[3].style_stops_99[0],W[I.travel_time_major_hospitals_optimal[2]][4],I.travel_time_major_hospitals_optimal[3].style_stops_99[1],W[I.travel_time_major_hospitals_optimal[2]][3],I.travel_time_major_hospitals_optimal[3].style_stops_99[2],W[I.travel_time_major_hospitals_optimal[2]][2],I.travel_time_major_hospitals_optimal[3].style_stops_99[3],W[I.travel_time_major_hospitals_optimal[2]][1],I.travel_time_major_hospitals_optimal[3].style_stops_99[4],W[I.travel_time_major_hospitals_optimal[2]][0]]},travel_time_no_sites_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_all_education_facilities_fixed"],I.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[0],W[I.travel_time_no_sites_all_education_facilities_fixed[2]][4],I.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[1],W[I.travel_time_no_sites_all_education_facilities_fixed[2]][3],I.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[2],W[I.travel_time_no_sites_all_education_facilities_fixed[2]][2],I.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[3],W[I.travel_time_no_sites_all_education_facilities_fixed[2]][1],I.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[4],W[I.travel_time_no_sites_all_education_facilities_fixed[2]][0]]},travel_time_no_sites_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_all_health_facilities_optimal"],I.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[0],W[I.travel_time_no_sites_all_health_facilities_optimal[2]][4],I.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[1],W[I.travel_time_no_sites_all_health_facilities_optimal[2]][3],I.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[2],W[I.travel_time_no_sites_all_health_facilities_optimal[2]][2],I.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[3],W[I.travel_time_no_sites_all_health_facilities_optimal[2]][1],I.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[4],W[I.travel_time_no_sites_all_health_facilities_optimal[2]][0]]},travel_time_no_sites_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_health_centers_optimal"],I.travel_time_no_sites_health_centers_optimal[3].style_stops_99[0],W[I.travel_time_no_sites_health_centers_optimal[2]][4],I.travel_time_no_sites_health_centers_optimal[3].style_stops_99[1],W[I.travel_time_no_sites_health_centers_optimal[2]][3],I.travel_time_no_sites_health_centers_optimal[3].style_stops_99[2],W[I.travel_time_no_sites_health_centers_optimal[2]][2],I.travel_time_no_sites_health_centers_optimal[3].style_stops_99[3],W[I.travel_time_no_sites_health_centers_optimal[2]][1],I.travel_time_no_sites_health_centers_optimal[3].style_stops_99[4],W[I.travel_time_no_sites_health_centers_optimal[2]][0]]},travel_time_no_sites_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_health_posts_optimal"],I.travel_time_no_sites_health_posts_optimal[3].style_stops_99[0],W[I.travel_time_no_sites_health_posts_optimal[2]][4],I.travel_time_no_sites_health_posts_optimal[3].style_stops_99[1],W[I.travel_time_no_sites_health_posts_optimal[2]][3],I.travel_time_no_sites_health_posts_optimal[3].style_stops_99[2],W[I.travel_time_no_sites_health_posts_optimal[2]][2],I.travel_time_no_sites_health_posts_optimal[3].style_stops_99[3],W[I.travel_time_no_sites_health_posts_optimal[2]][1],I.travel_time_no_sites_health_posts_optimal[3].style_stops_99[4],W[I.travel_time_no_sites_health_posts_optimal[2]][0]]},travel_time_no_sites_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_major_hospitals_optimal"],I.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[0],W[I.travel_time_no_sites_major_hospitals_optimal[2]][4],I.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[1],W[I.travel_time_no_sites_major_hospitals_optimal[2]][3],I.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[2],W[I.travel_time_no_sites_major_hospitals_optimal[2]][2],I.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[3],W[I.travel_time_no_sites_major_hospitals_optimal[2]][1],I.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[4],W[I.travel_time_no_sites_major_hospitals_optimal[2]][0]]},travel_time_no_sites_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_primary_schools_fixed"],I.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[0],W[I.travel_time_no_sites_primary_schools_fixed[2]][4],I.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[1],W[I.travel_time_no_sites_primary_schools_fixed[2]][3],I.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[2],W[I.travel_time_no_sites_primary_schools_fixed[2]][2],I.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[3],W[I.travel_time_no_sites_primary_schools_fixed[2]][1],I.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[4],W[I.travel_time_no_sites_primary_schools_fixed[2]][0]]},travel_time_no_sites_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_secondary_schools_fixed"],I.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[0],W[I.travel_time_no_sites_secondary_schools_fixed[2]][4],I.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[1],W[I.travel_time_no_sites_secondary_schools_fixed[2]][3],I.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[2],W[I.travel_time_no_sites_secondary_schools_fixed[2]][2],I.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[3],W[I.travel_time_no_sites_secondary_schools_fixed[2]][1],I.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[4],W[I.travel_time_no_sites_secondary_schools_fixed[2]][0]]},travel_time_no_sites_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_semi_dense_urban_optimal"],I.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[0],W[I.travel_time_no_sites_semi_dense_urban_optimal[2]][4],I.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[1],W[I.travel_time_no_sites_semi_dense_urban_optimal[2]][3],I.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[2],W[I.travel_time_no_sites_semi_dense_urban_optimal[2]][2],I.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[3],W[I.travel_time_no_sites_semi_dense_urban_optimal[2]][1],I.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[4],W[I.travel_time_no_sites_semi_dense_urban_optimal[2]][0]]},travel_time_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_primary_schools_fixed"],I.travel_time_primary_schools_fixed[3].style_stops_99[0],W[I.travel_time_primary_schools_fixed[2]][4],I.travel_time_primary_schools_fixed[3].style_stops_99[1],W[I.travel_time_primary_schools_fixed[2]][3],I.travel_time_primary_schools_fixed[3].style_stops_99[2],W[I.travel_time_primary_schools_fixed[2]][2],I.travel_time_primary_schools_fixed[3].style_stops_99[3],W[I.travel_time_primary_schools_fixed[2]][1],I.travel_time_primary_schools_fixed[3].style_stops_99[4],W[I.travel_time_primary_schools_fixed[2]][0]]},travel_time_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_secondary_schools_fixed"],I.travel_time_secondary_schools_fixed[3].style_stops_99[0],W[I.travel_time_secondary_schools_fixed[2]][4],I.travel_time_secondary_schools_fixed[3].style_stops_99[1],W[I.travel_time_secondary_schools_fixed[2]][3],I.travel_time_secondary_schools_fixed[3].style_stops_99[2],W[I.travel_time_secondary_schools_fixed[2]][2],I.travel_time_secondary_schools_fixed[3].style_stops_99[3],W[I.travel_time_secondary_schools_fixed[2]][1],I.travel_time_secondary_schools_fixed[3].style_stops_99[4],W[I.travel_time_secondary_schools_fixed[2]][0]]},travel_time_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_semi_dense_urban_optimal"],I.travel_time_semi_dense_urban_optimal[3].style_stops_99[0],W[I.travel_time_semi_dense_urban_optimal[2]][4],I.travel_time_semi_dense_urban_optimal[3].style_stops_99[1],W[I.travel_time_semi_dense_urban_optimal[2]][3],I.travel_time_semi_dense_urban_optimal[3].style_stops_99[2],W[I.travel_time_semi_dense_urban_optimal[2]][2],I.travel_time_semi_dense_urban_optimal[3].style_stops_99[3],W[I.travel_time_semi_dense_urban_optimal[2]][1],I.travel_time_semi_dense_urban_optimal[3].style_stops_99[4],W[I.travel_time_semi_dense_urban_optimal[2]][0]]},all_education_potential_impact:{"fill-color":["interpolate",["linear"],["get","all_education_potential_impact"],I.all_education_potential_impact[3].style_stops_maxmin[0],W[I.all_education_potential_impact[2]][0],I.all_education_potential_impact[3].style_stops_maxmin[1],W[I.all_education_potential_impact[2]][1],I.all_education_potential_impact[3].style_stops_maxmin[2],W[I.all_education_potential_impact[2]][2],I.all_education_potential_impact[3].style_stops_maxmin[3],W[I.all_education_potential_impact[2]][3],I.all_education_potential_impact[3].style_stops_maxmin[4],W[I.all_education_potential_impact[2]][4]]},all_education_current_impact:{"fill-color":["interpolate",["linear"],["get","all_education_current_impact"],I.all_education_current_impact[3].style_stops_maxmin[0],W[I.all_education_current_impact[2]][0],I.all_education_current_impact[3].style_stops_maxmin[1],W[I.all_education_current_impact[2]][1],I.all_education_current_impact[3].style_stops_maxmin[2],W[I.all_education_current_impact[2]][2],I.all_education_current_impact[3].style_stops_maxmin[3],W[I.all_education_current_impact[2]][3],I.all_education_current_impact[3].style_stops_maxmin[4],W[I.all_education_current_impact[2]][4]]},all_health_potential_impact:{"fill-color":["interpolate",["linear"],["get","all_health_potential_impact"],I.all_health_potential_impact[3].style_stops_maxmin[0],W[I.all_health_potential_impact[2]][0],I.all_health_potential_impact[3].style_stops_maxmin[1],W[I.all_health_potential_impact[2]][1],I.all_health_potential_impact[3].style_stops_maxmin[2],W[I.all_health_potential_impact[2]][2],I.all_health_potential_impact[3].style_stops_maxmin[3],W[I.all_health_potential_impact[2]][3],I.all_health_potential_impact[3].style_stops_maxmin[4],W[I.all_health_potential_impact[2]][4]]},all_health_current_impact:{"fill-color":["interpolate",["linear"],["get","all_health_current_impact"],I.all_health_current_impact[3].style_stops_maxmin[0],W[I.all_health_current_impact[2]][0],I.all_health_current_impact[3].style_stops_maxmin[1],W[I.all_health_current_impact[2]][1],I.all_health_current_impact[3].style_stops_maxmin[2],W[I.all_health_current_impact[2]][2],I.all_health_current_impact[3].style_stops_maxmin[3],W[I.all_health_current_impact[2]][3],I.all_health_current_impact[3].style_stops_maxmin[4],W[I.all_health_current_impact[2]][4]]},health_centers_potential_impact:{"fill-color":["interpolate",["linear"],["get","health_centers_potential_impact"],I.health_centers_potential_impact[3].style_stops_maxmin[0],W[I.health_centers_potential_impact[2]][0],I.health_centers_potential_impact[3].style_stops_maxmin[1],W[I.health_centers_potential_impact[2]][1],I.health_centers_potential_impact[3].style_stops_maxmin[2],W[I.health_centers_potential_impact[2]][2],I.health_centers_potential_impact[3].style_stops_maxmin[3],W[I.health_centers_potential_impact[2]][3],I.health_centers_potential_impact[3].style_stops_maxmin[4],W[I.health_centers_potential_impact[2]][4]]},health_centers_current_impact:{"fill-color":["interpolate",["linear"],["get","health_centers_current_impact"],I.health_centers_current_impact[3].style_stops_maxmin[0],W[I.health_centers_current_impact[2]][0],I.health_centers_current_impact[3].style_stops_maxmin[1],W[I.health_centers_current_impact[2]][1],I.health_centers_current_impact[3].style_stops_maxmin[2],W[I.health_centers_current_impact[2]][2],I.health_centers_current_impact[3].style_stops_maxmin[3],W[I.health_centers_current_impact[2]][3],I.health_centers_current_impact[3].style_stops_maxmin[4],W[I.health_centers_current_impact[2]][4]]},health_posts_potential_impact:{"fill-color":["interpolate",["linear"],["get","health_posts_potential_impact"],I.health_posts_potential_impact[3].style_stops_maxmin[0],W[I.health_posts_potential_impact[2]][0],I.health_posts_potential_impact[3].style_stops_maxmin[1],W[I.health_posts_potential_impact[2]][1],I.health_posts_potential_impact[3].style_stops_maxmin[2],W[I.health_posts_potential_impact[2]][2],I.health_posts_potential_impact[3].style_stops_maxmin[3],W[I.health_posts_potential_impact[2]][3],I.health_posts_potential_impact[3].style_stops_maxmin[4],W[I.health_posts_potential_impact[2]][4]]},health_posts_current_impact:{"fill-color":["interpolate",["linear"],["get","health_posts_current_impact"],I.health_posts_current_impact[3].style_stops_maxmin[0],W[I.health_posts_current_impact[2]][0],I.health_posts_current_impact[3].style_stops_maxmin[1],W[I.health_posts_current_impact[2]][1],I.health_posts_current_impact[3].style_stops_maxmin[2],W[I.health_posts_current_impact[2]][2],I.health_posts_current_impact[3].style_stops_maxmin[3],W[I.health_posts_current_impact[2]][3],I.health_posts_current_impact[3].style_stops_maxmin[4],W[I.health_posts_current_impact[2]][4]]},major_hospitals_potential_impact:{"fill-color":["interpolate",["linear"],["get","major_hospitals_potential_impact"],I.major_hospitals_potential_impact[3].style_stops_maxmin[0],W[I.major_hospitals_potential_impact[2]][0],I.major_hospitals_potential_impact[3].style_stops_maxmin[1],W[I.major_hospitals_potential_impact[2]][1],I.major_hospitals_potential_impact[3].style_stops_maxmin[2],W[I.major_hospitals_potential_impact[2]][2],I.major_hospitals_potential_impact[3].style_stops_maxmin[3],W[I.major_hospitals_potential_impact[2]][3],I.major_hospitals_potential_impact[3].style_stops_maxmin[4],W[I.major_hospitals_potential_impact[2]][4]]},major_hospitals_current_impact:{"fill-color":["interpolate",["linear"],["get","major_hospitals_current_impact"],I.major_hospitals_current_impact[3].style_stops_maxmin[0],W[I.major_hospitals_current_impact[2]][0],I.major_hospitals_current_impact[3].style_stops_maxmin[1],W[I.major_hospitals_current_impact[2]][1],I.major_hospitals_current_impact[3].style_stops_maxmin[2],W[I.major_hospitals_current_impact[2]][2],I.major_hospitals_current_impact[3].style_stops_maxmin[3],W[I.major_hospitals_current_impact[2]][3],I.major_hospitals_current_impact[3].style_stops_maxmin[4],W[I.major_hospitals_current_impact[2]][4]]},primary_schools_potential_impact:{"fill-color":["interpolate",["linear"],["get","primary_schools_potential_impact"],I.primary_schools_potential_impact[3].style_stops_maxmin[0],W[I.primary_schools_potential_impact[2]][0],I.primary_schools_potential_impact[3].style_stops_maxmin[1],W[I.primary_schools_potential_impact[2]][1],I.primary_schools_potential_impact[3].style_stops_maxmin[2],W[I.primary_schools_potential_impact[2]][2],I.primary_schools_potential_impact[3].style_stops_maxmin[3],W[I.primary_schools_potential_impact[2]][3],I.primary_schools_potential_impact[3].style_stops_maxmin[4],W[I.primary_schools_potential_impact[2]][4]]},primary_schools_current_impact:{"fill-color":["interpolate",["linear"],["get","primary_schools_current_impact"],I.primary_schools_current_impact[3].style_stops_maxmin[0],W[I.primary_schools_current_impact[2]][0],I.primary_schools_current_impact[3].style_stops_maxmin[1],W[I.primary_schools_current_impact[2]][1],I.primary_schools_current_impact[3].style_stops_maxmin[2],W[I.primary_schools_current_impact[2]][2],I.primary_schools_current_impact[3].style_stops_maxmin[3],W[I.primary_schools_current_impact[2]][3],I.primary_schools_current_impact[3].style_stops_maxmin[4],W[I.primary_schools_current_impact[2]][4]]},secondary_schools_potential_impact:{"fill-color":["interpolate",["linear"],["get","secondary_schools_potential_impact"],I.secondary_schools_potential_impact[3].style_stops_maxmin[0],W[I.secondary_schools_potential_impact[2]][0],I.secondary_schools_potential_impact[3].style_stops_maxmin[1],W[I.secondary_schools_potential_impact[2]][1],I.secondary_schools_potential_impact[3].style_stops_maxmin[2],W[I.secondary_schools_potential_impact[2]][2],I.secondary_schools_potential_impact[3].style_stops_maxmin[3],W[I.secondary_schools_potential_impact[2]][3],I.secondary_schools_potential_impact[3].style_stops_maxmin[4],W[I.secondary_schools_potential_impact[2]][4]]},secondary_schools_current_impact:{"fill-color":["interpolate",["linear"],["get","secondary_schools_current_impact"],I.secondary_schools_current_impact[3].style_stops_maxmin[0],W[I.secondary_schools_current_impact[2]][0],I.secondary_schools_current_impact[3].style_stops_maxmin[1],W[I.secondary_schools_current_impact[2]][1],I.secondary_schools_current_impact[3].style_stops_maxmin[2],W[I.secondary_schools_current_impact[2]][2],I.secondary_schools_current_impact[3].style_stops_maxmin[3],W[I.secondary_schools_current_impact[2]][3],I.secondary_schools_current_impact[3].style_stops_maxmin[4],W[I.secondary_schools_current_impact[2]][4]]},semi_dense_urban_potential_impact:{"fill-color":["interpolate",["linear"],["get","semi_dense_urban_potential_impact"],I.semi_dense_urban_potential_impact[3].style_stops_maxmin[0],W[I.semi_dense_urban_potential_impact[2]][0],I.semi_dense_urban_potential_impact[3].style_stops_maxmin[1],W[I.semi_dense_urban_potential_impact[2]][1],I.semi_dense_urban_potential_impact[3].style_stops_maxmin[2],W[I.semi_dense_urban_potential_impact[2]][2],I.semi_dense_urban_potential_impact[3].style_stops_maxmin[3],W[I.semi_dense_urban_potential_impact[2]][3],I.semi_dense_urban_potential_impact[3].style_stops_maxmin[4],W[I.semi_dense_urban_potential_impact[2]][4]]},semi_dense_urban_current_impact:{"fill-color":["interpolate",["linear"],["get","semi_dense_urban_current_impact"],I.semi_dense_urban_current_impact[3].style_stops_maxmin[0],W[I.semi_dense_urban_current_impact[2]][0],I.semi_dense_urban_current_impact[3].style_stops_maxmin[1],W[I.semi_dense_urban_current_impact[2]][1],I.semi_dense_urban_current_impact[3].style_stops_maxmin[2],W[I.semi_dense_urban_current_impact[2]][2],I.semi_dense_urban_current_impact[3].style_stops_maxmin[3],W[I.semi_dense_urban_current_impact[2]][3],I.semi_dense_urban_current_impact[3].style_stops_maxmin[4],W[I.semi_dense_urban_current_impact[2]][4]]},total_potential_impact:{"fill-color":["interpolate",["linear"],["get","total_potential_impact"],I.total_potential_impact[3].style_stops_maxmin[0],W[I.total_potential_impact[2]][0],I.total_potential_impact[3].style_stops_maxmin[1],W[I.total_potential_impact[2]][1],I.total_potential_impact[3].style_stops_maxmin[2],W[I.total_potential_impact[2]][2],I.total_potential_impact[3].style_stops_maxmin[3],W[I.total_potential_impact[2]][3],I.total_potential_impact[3].style_stops_maxmin[4],W[I.total_potential_impact[2]][4]]},total_current_impact:{"fill-color":["interpolate",["linear"],["get","total_current_impact"],I.total_current_impact[3].style_stops_maxmin[0],W[I.total_current_impact[2]][0],I.total_current_impact[3].style_stops_maxmin[1],W[I.total_current_impact[2]][1],I.total_current_impact[3].style_stops_maxmin[2],W[I.total_current_impact[2]][2],I.total_current_impact[3].style_stops_maxmin[3],W[I.total_current_impact[2]][3],I.total_current_impact[3].style_stops_maxmin[4],W[I.total_current_impact[2]][4]]},total_school_current_impact:{"fill-color":["interpolate",["linear"],["get","total_school_current_impact"],I.total_school_current_impact[3].style_stops_maxmin[0],W[I.total_school_current_impact[2]][0],I.total_school_current_impact[3].style_stops_maxmin[1],W[I.total_school_current_impact[2]][1],I.total_school_current_impact[3].style_stops_maxmin[2],W[I.total_school_current_impact[2]][2],I.total_school_current_impact[3].style_stops_maxmin[3],W[I.total_school_current_impact[2]][3],I.total_school_current_impact[3].style_stops_maxmin[4],W[I.total_school_current_impact[2]][4]]},total_school_potential_impact:{"fill-color":["interpolate",["linear"],["get","total_school_potential_impact"],I.total_school_potential_impact[3].style_stops_maxmin[0],W[I.total_school_potential_impact[2]][0],I.total_school_potential_impact[3].style_stops_maxmin[1],W[I.total_school_potential_impact[2]][1],I.total_school_potential_impact[3].style_stops_maxmin[2],W[I.total_school_potential_impact[2]][2],I.total_school_potential_impact[3].style_stops_maxmin[3],W[I.total_school_potential_impact[2]][3],I.total_school_potential_impact[3].style_stops_maxmin[4],W[I.total_school_potential_impact[2]][4]]},total_health_current_impact:{"fill-color":["interpolate",["linear"],["get","total_health_current_impact"],I.total_health_current_impact[3].style_stops_maxmin[0],W[I.total_health_current_impact[2]][0],I.total_health_current_impact[3].style_stops_maxmin[1],W[I.total_health_current_impact[2]][1],I.total_health_current_impact[3].style_stops_maxmin[2],W[I.total_health_current_impact[2]][2],I.total_health_current_impact[3].style_stops_maxmin[3],W[I.total_health_current_impact[2]][3],I.total_health_current_impact[3].style_stops_maxmin[4],W[I.total_health_current_impact[2]][4]]},total_health_potential_impact:{"fill-color":["interpolate",["linear"],["get","total_health_potential_impact"],I.total_health_potential_impact[3].style_stops_maxmin[0],W[I.total_health_potential_impact[2]][0],I.total_health_potential_impact[3].style_stops_maxmin[1],W[I.total_health_potential_impact[2]][1],I.total_health_potential_impact[3].style_stops_maxmin[2],W[I.total_health_potential_impact[2]][2],I.total_health_potential_impact[3].style_stops_maxmin[3],W[I.total_health_potential_impact[2]][3],I.total_health_potential_impact[3].style_stops_maxmin[4],W[I.total_health_potential_impact[2]][4]]}};let Uh=null;function Jw(){gi.setFilter("hover-bridge",["==",["id"],0]),gi.setFilter("hover-health",["==",["id"],0]),gi.setFilter("hover-edu",["==",["id"],0]),gi.setFeatureState({source:"hex-8-source",id:Uh},{hover:!1}),document.getElementById("hover-panel").classList.remove("show")}function Eo(o){return o.toLowerCase().split(" ").map(function(n){return n.charAt(0).toUpperCase()+n.slice(1)}).join(" ")}function ty(o,n){let a=Object.keys(I).find(h=>JSON.stringify(I[h][0])===JSON.stringify([Jl.dropdown1,Jl.dropdown2,Jl.dropdown3]));Jw(),n&&document.getElementById("hover-panel").classList.add("show"),o==="hex-8-layer"&&n?(Uh!==null&&gi.setFeatureState({source:"hex-8-source",id:Uh},{hover:!1}),Uh=n.id,gi.setFeatureState({source:"hex-8-source",id:Uh},{hover:!0}),a=="female_educational_attainment_mean"||a=="male_educational_attainment_mean"||a=="rwi"?document.getElementById("hover-text").innerHTML="<strong>Geographic Area</strong> </br>Population: "+n.properties.population+"</br>Wealth Index: "+n.properties.rwi.toFixed(3)+"</br>"+I[a][1][0]+": "+n.properties[a].toFixed(1)+" "+I[a][1][1]:a.includes("impact")?document.getElementById("hover-text").innerHTML="<strong>Geographic Area</strong> </br>Population: "+n.properties.population+"</br>RWI: "+n.properties.rwi.toFixed(3)+"</br>"+I[a][1][0]+": "+Ox(n.properties[a].toFixed(1))+" "+I[a][1][1]:document.getElementById("hover-text").innerHTML="<strong>Geographic Area</strong> </br>Population: "+n.properties.population+"</br>Wealth Index: "+n.properties.rwi.toFixed(3)+"</br>"+I[a][1][0]+": "+n.properties[a].toFixed(0)+" "+I[a][1][1],document.getElementById("hover-icon").src="/assets/geo-hex.svg"):o==="bridge-point"&&n?(gi.setFilter("hover-bridge",["==",["id"],n.id]),console.log(n.properties.opportunity_name),document.getElementById("hover-text").innerHTML="<strong>Bridge Site </strong>"+n.properties.opportunity_name.split("-")[2].trim()+"</br>Status: "+n.properties.stage_public+" Site </br>Region: "+n.properties.level_2_government+"</br>Population Served: "+n.properties.individuals_directly_served,document.getElementById("hover-icon").src="/assets/bridge-hex.svg"):o==="health-point"&&n?(gi.setFilter("hover-health",["==",["id"],n.id]),document.getElementById("hover-text").innerHTML="<strong>"+Eo(n.properties.category)+"</strong> </br>District: "+Eo(n.properties.district)+"</br> Sector: "+Eo(n.properties.sector)+"</br> Village: "+Eo(n.properties.village),document.getElementById("hover-icon").src="/assets/health-hex.svg"):o==="edu-point"&&n&&(gi.setFilter("hover-edu",["==",["id"],n.id]),document.getElementById("hover-text").innerHTML="<strong>"+Eo(n.properties.category)+"</strong> </br>District: "+Eo(n.properties.district)+"</br> Sector: "+Eo(n.properties.sector)+"</br> Village: "+Eo(n.properties.village),document.getElementById("hover-icon").src="/assets/edu-hex.svg")}/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function du(o){return o+.5|0}const So=(o,n,a)=>Math.max(Math.min(o,a),n);function Gh(o){return So(du(o*2.55),0,255)}function Po(o){return So(du(o*255),0,255)}function Br(o){return So(du(o/2.55)/100,0,1)}function iy(o){return So(du(o*100),0,100)}const bs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},N_=[..."0123456789ABCDEF"],Qw=o=>N_[o&15],e2=o=>N_[(o&240)>>4]+N_[o&15],jd=o=>(o&240)>>4===(o&15),t2=o=>jd(o.r)&&jd(o.g)&&jd(o.b)&&jd(o.a);function i2(o){var n=o.length,a;return o[0]==="#"&&(n===4||n===5?a={r:255&bs[o[1]]*17,g:255&bs[o[2]]*17,b:255&bs[o[3]]*17,a:n===5?bs[o[4]]*17:255}:(n===7||n===9)&&(a={r:bs[o[1]]<<4|bs[o[2]],g:bs[o[3]]<<4|bs[o[4]],b:bs[o[5]]<<4|bs[o[6]],a:n===9?bs[o[7]]<<4|bs[o[8]]:255})),a}const n2=(o,n)=>o<255?n(o):"";function s2(o){var n=t2(o)?Qw:e2;return o?"#"+n(o.r)+n(o.g)+n(o.b)+n2(o.a,n):void 0}const r2=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Fx(o,n,a){const h=n*Math.min(a,1-a),d=(g,v=(g+o/30)%12)=>a-h*Math.max(Math.min(v-3,9-v,1),-1);return[d(0),d(8),d(4)]}function o2(o,n,a){const h=(d,g=(d+o/60)%6)=>a-a*n*Math.max(Math.min(g,4-g,1),0);return[h(5),h(3),h(1)]}function a2(o,n,a){const h=Fx(o,1,.5);let d;for(n+a>1&&(d=1/(n+a),n*=d,a*=d),d=0;d<3;d++)h[d]*=1-n-a,h[d]+=n;return h}function l2(o,n,a,h,d){return o===d?(n-a)/h+(n<a?6:0):n===d?(a-o)/h+2:(o-n)/h+4}function sm(o){const a=o.r/255,h=o.g/255,d=o.b/255,g=Math.max(a,h,d),v=Math.min(a,h,d),r=(g+v)/2;let T,C,R;return g!==v&&(R=g-v,C=r>.5?R/(2-g-v):R/(g+v),T=l2(a,h,d,R,g),T=T*60+.5),[T|0,C||0,r]}function rm(o,n,a,h){return(Array.isArray(n)?o(n[0],n[1],n[2]):o(n,a,h)).map(Po)}function om(o,n,a){return rm(Fx,o,n,a)}function c2(o,n,a){return rm(a2,o,n,a)}function h2(o,n,a){return rm(o2,o,n,a)}function Nx(o){return(o%360+360)%360}function u2(o){const n=r2.exec(o);let a=255,h;if(!n)return;n[5]!==h&&(a=n[6]?Gh(+n[5]):Po(+n[5]));const d=Nx(+n[2]),g=+n[3]/100,v=+n[4]/100;return n[1]==="hwb"?h=c2(d,g,v):n[1]==="hsv"?h=h2(d,g,v):h=om(d,g,v),{r:h[0],g:h[1],b:h[2],a}}function d2(o,n){var a=sm(o);a[0]=Nx(a[0]+n),a=om(a),o.r=a[0],o.g=a[1],o.b=a[2]}function p2(o){if(!o)return;const n=sm(o),a=n[0],h=iy(n[1]),d=iy(n[2]);return o.a<255?`hsla(${a}, ${h}%, ${d}%, ${Br(o.a)})`:`hsl(${a}, ${h}%, ${d}%)`}const ny={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},sy={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function f2(){const o={},n=Object.keys(sy),a=Object.keys(ny);let h,d,g,v,r;for(h=0;h<n.length;h++){for(v=r=n[h],d=0;d<a.length;d++)g=a[d],r=r.replace(g,ny[g]);g=parseInt(sy[v],16),o[r]=[g>>16&255,g>>8&255,g&255]}return o}let Vd;function _2(o){Vd||(Vd=f2(),Vd.transparent=[0,0,0,0]);const n=Vd[o.toLowerCase()];return n&&{r:n[0],g:n[1],b:n[2],a:n.length===4?n[3]:255}}const m2=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function g2(o){const n=m2.exec(o);let a=255,h,d,g;if(n){if(n[7]!==h){const v=+n[7];a=n[8]?Gh(v):So(v*255,0,255)}return h=+n[1],d=+n[3],g=+n[5],h=255&(n[2]?Gh(h):So(h,0,255)),d=255&(n[4]?Gh(d):So(d,0,255)),g=255&(n[6]?Gh(g):So(g,0,255)),{r:h,g:d,b:g,a}}}function y2(o){return o&&(o.a<255?`rgba(${o.r}, ${o.g}, ${o.b}, ${Br(o.a)})`:`rgb(${o.r}, ${o.g}, ${o.b})`)}const y_=o=>o<=.0031308?o*12.92:Math.pow(o,1/2.4)*1.055-.055,Wl=o=>o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4);function x2(o,n,a){const h=Wl(Br(o.r)),d=Wl(Br(o.g)),g=Wl(Br(o.b));return{r:Po(y_(h+a*(Wl(Br(n.r))-h))),g:Po(y_(d+a*(Wl(Br(n.g))-d))),b:Po(y_(g+a*(Wl(Br(n.b))-g))),a:o.a+a*(n.a-o.a)}}function Ud(o,n,a){if(o){let h=sm(o);h[n]=Math.max(0,Math.min(h[n]+h[n]*a,n===0?360:1)),h=om(h),o.r=h[0],o.g=h[1],o.b=h[2]}}function jx(o,n){return o&&Object.assign(n||{},o)}function ry(o){var n={r:0,g:0,b:0,a:255};return Array.isArray(o)?o.length>=3&&(n={r:o[0],g:o[1],b:o[2],a:255},o.length>3&&(n.a=Po(o[3]))):(n=jx(o,{r:0,g:0,b:0,a:1}),n.a=Po(n.a)),n}function v2(o){return o.charAt(0)==="r"?g2(o):u2(o)}class nu{constructor(n){if(n instanceof nu)return n;const a=typeof n;let h;a==="object"?h=ry(n):a==="string"&&(h=i2(n)||_2(n)||v2(n)),this._rgb=h,this._valid=!!h}get valid(){return this._valid}get rgb(){var n=jx(this._rgb);return n&&(n.a=Br(n.a)),n}set rgb(n){this._rgb=ry(n)}rgbString(){return this._valid?y2(this._rgb):void 0}hexString(){return this._valid?s2(this._rgb):void 0}hslString(){return this._valid?p2(this._rgb):void 0}mix(n,a){if(n){const h=this.rgb,d=n.rgb;let g;const v=a===g?.5:a,r=2*v-1,T=h.a-d.a,C=((r*T===-1?r:(r+T)/(1+r*T))+1)/2;g=1-C,h.r=255&C*h.r+g*d.r+.5,h.g=255&C*h.g+g*d.g+.5,h.b=255&C*h.b+g*d.b+.5,h.a=v*h.a+(1-v)*d.a,this.rgb=h}return this}interpolate(n,a){return n&&(this._rgb=x2(this._rgb,n._rgb,a)),this}clone(){return new nu(this.rgb)}alpha(n){return this._rgb.a=Po(n),this}clearer(n){const a=this._rgb;return a.a*=1-n,this}greyscale(){const n=this._rgb,a=du(n.r*.3+n.g*.59+n.b*.11);return n.r=n.g=n.b=a,this}opaquer(n){const a=this._rgb;return a.a*=1+n,this}negate(){const n=this._rgb;return n.r=255-n.r,n.g=255-n.g,n.b=255-n.b,this}lighten(n){return Ud(this._rgb,2,n),this}darken(n){return Ud(this._rgb,2,-n),this}saturate(n){return Ud(this._rgb,1,n),this}desaturate(n){return Ud(this._rgb,1,-n),this}rotate(n){return d2(this._rgb,n),this}}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function zr(){}const b2=(()=>{let o=0;return()=>o++})();function ei(o){return o===null||typeof o>"u"}function zi(o){if(Array.isArray&&Array.isArray(o))return!0;const n=Object.prototype.toString.call(o);return n.slice(0,7)==="[object"&&n.slice(-6)==="Array]"}function Ht(o){return o!==null&&Object.prototype.toString.call(o)==="[object Object]"}function Yi(o){return(typeof o=="number"||o instanceof Number)&&isFinite(+o)}function as(o,n){return Yi(o)?o:n}function Vt(o,n){return typeof o>"u"?n:o}const w2=(o,n)=>typeof o=="string"&&o.endsWith("%")?parseFloat(o)/100:+o/n,Vx=(o,n)=>typeof o=="string"&&o.endsWith("%")?parseFloat(o)/100*n:+o;function Ii(o,n,a){if(o&&typeof o.call=="function")return o.apply(a,n)}function yi(o,n,a,h){let d,g,v;if(zi(o))if(g=o.length,h)for(d=g-1;d>=0;d--)n.call(a,o[d],d);else for(d=0;d<g;d++)n.call(a,o[d],d);else if(Ht(o))for(v=Object.keys(o),g=v.length,d=0;d<g;d++)n.call(a,o[v[d]],v[d])}function xp(o,n){let a,h,d,g;if(!o||!n||o.length!==n.length)return!1;for(a=0,h=o.length;a<h;++a)if(d=o[a],g=n[a],d.datasetIndex!==g.datasetIndex||d.index!==g.index)return!1;return!0}function vp(o){if(zi(o))return o.map(vp);if(Ht(o)){const n=Object.create(null),a=Object.keys(o),h=a.length;let d=0;for(;d<h;++d)n[a[d]]=vp(o[a[d]]);return n}return o}function Ux(o){return["__proto__","prototype","constructor"].indexOf(o)===-1}function T2(o,n,a,h){if(!Ux(o))return;const d=n[o],g=a[o];Ht(d)&&Ht(g)?su(d,g,h):n[o]=vp(g)}function su(o,n,a){const h=zi(n)?n:[n],d=h.length;if(!Ht(o))return o;a=a||{};const g=a.merger||T2;let v;for(let r=0;r<d;++r){if(v=h[r],!Ht(v))continue;const T=Object.keys(v);for(let C=0,R=T.length;C<R;++C)g(T[C],o,v,a)}return o}function Jh(o,n){return su(o,n,{merger:E2})}function E2(o,n,a){if(!Ux(o))return;const h=n[o],d=a[o];Ht(h)&&Ht(d)?Jh(h,d):Object.prototype.hasOwnProperty.call(n,o)||(n[o]=vp(d))}const oy={"":o=>o,x:o=>o.x,y:o=>o.y};function M2(o){const n=o.split("."),a=[];let h="";for(const d of n)h+=d,h.endsWith("\\")?h=h.slice(0,-1)+".":(a.push(h),h="");return a}function S2(o){const n=M2(o);return a=>{for(const h of n){if(h==="")break;a=a&&a[h]}return a}}function Do(o,n){return(oy[n]||(oy[n]=S2(n)))(o)}function am(o){return o.charAt(0).toUpperCase()+o.slice(1)}const ru=o=>typeof o<"u",zo=o=>typeof o=="function",ay=(o,n)=>{if(o.size!==n.size)return!1;for(const a of o)if(!n.has(a))return!1;return!0};function A2(o){return o.type==="mouseup"||o.type==="click"||o.type==="contextmenu"}const Oi=Math.PI,Ri=2*Oi,I2=Ri+Oi,bp=Number.POSITIVE_INFINITY,C2=Oi/180,Ji=Oi/2,Pa=Oi/4,ly=Oi*2/3,Ao=Math.log10,hr=Math.sign;function Qh(o,n,a){return Math.abs(o-n)<a}function cy(o){const n=Math.round(o);o=Qh(o,n,o/1e3)?n:o;const a=Math.pow(10,Math.floor(Ao(o))),h=o/a;return(h<=1?1:h<=2?2:h<=5?5:10)*a}function P2(o){const n=[],a=Math.sqrt(o);let h;for(h=1;h<a;h++)o%h===0&&(n.push(h),n.push(o/h));return a===(a|0)&&n.push(a),n.sort((d,g)=>d-g).pop(),n}function Ql(o){return!isNaN(parseFloat(o))&&isFinite(o)}function k2(o,n){const a=Math.round(o);return a-n<=o&&a+n>=o}function Gx(o,n,a){let h,d,g;for(h=0,d=o.length;h<d;h++)g=o[h][a],isNaN(g)||(n.min=Math.min(n.min,g),n.max=Math.max(n.max,g))}function Ws(o){return o*(Oi/180)}function lm(o){return o*(180/Oi)}function hy(o){if(!Yi(o))return;let n=1,a=0;for(;Math.round(o*n)/n!==o;)n*=10,a++;return a}function $x(o,n){const a=n.x-o.x,h=n.y-o.y,d=Math.sqrt(a*a+h*h);let g=Math.atan2(h,a);return g<-.5*Oi&&(g+=Ri),{angle:g,distance:d}}function j_(o,n){return Math.sqrt(Math.pow(n.x-o.x,2)+Math.pow(n.y-o.y,2))}function L2(o,n){return(o-n+I2)%Ri-Oi}function ls(o){return(o%Ri+Ri)%Ri}function ou(o,n,a,h){const d=ls(o),g=ls(n),v=ls(a),r=ls(g-d),T=ls(v-d),C=ls(d-g),R=ls(d-v);return d===g||d===v||h&&g===v||r>T&&C<R}function mn(o,n,a){return Math.max(n,Math.min(a,o))}function D2(o){return mn(o,-32768,32767)}function Fr(o,n,a,h=1e-6){return o>=Math.min(n,a)-h&&o<=Math.max(n,a)+h}function cm(o,n,a){a=a||(v=>o[v]<n);let h=o.length-1,d=0,g;for(;h-d>1;)g=d+h>>1,a(g)?d=g:h=g;return{lo:d,hi:h}}const Nr=(o,n,a,h)=>cm(o,a,h?d=>{const g=o[d][n];return g<a||g===a&&o[d+1][n]===a}:d=>o[d][n]<a),z2=(o,n,a)=>cm(o,a,h=>o[h][n]>=a);function R2(o,n,a){let h=0,d=o.length;for(;h<d&&o[h]<n;)h++;for(;d>h&&o[d-1]>a;)d--;return h>0||d<o.length?o.slice(h,d):o}const qx=["push","pop","shift","splice","unshift"];function O2(o,n){if(o._chartjs){o._chartjs.listeners.push(n);return}Object.defineProperty(o,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[n]}}),qx.forEach(a=>{const h="_onData"+am(a),d=o[a];Object.defineProperty(o,a,{configurable:!0,enumerable:!1,value(...g){const v=d.apply(this,g);return o._chartjs.listeners.forEach(r=>{typeof r[h]=="function"&&r[h](...g)}),v}})})}function uy(o,n){const a=o._chartjs;if(!a)return;const h=a.listeners,d=h.indexOf(n);d!==-1&&h.splice(d,1),!(h.length>0)&&(qx.forEach(g=>{delete o[g]}),delete o._chartjs)}function Wx(o){const n=new Set(o);return n.size===o.length?o:Array.from(n)}const Zx=function(){return typeof window>"u"?function(o){return o()}:window.requestAnimationFrame}();function Hx(o,n){let a=[],h=!1;return function(...d){a=d,h||(h=!0,Zx.call(window,()=>{h=!1,o.apply(n,a)}))}}function B2(o,n){let a;return function(...h){return n?(clearTimeout(a),a=setTimeout(o,n,h)):o.apply(this,h),n}}const hm=o=>o==="start"?"left":o==="end"?"right":"center",Pn=(o,n,a)=>o==="start"?n:o==="end"?a:(n+a)/2,F2=(o,n,a,h)=>o===(h?"left":"right")?a:o==="center"?(n+a)/2:n;function Xx(o,n,a){const h=n.length;let d=0,g=h;if(o._sorted){const{iScale:v,_parsed:r}=o,T=v.axis,{min:C,max:R,minDefined:F,maxDefined:U}=v.getUserBounds();F&&(d=mn(Math.min(Nr(r,T,C).lo,a?h:Nr(n,T,v.getPixelForValue(C)).lo),0,h-1)),U?g=mn(Math.max(Nr(r,v.axis,R,!0).hi+1,a?0:Nr(n,T,v.getPixelForValue(R),!0).hi+1),d,h)-d:g=h-d}return{start:d,count:g}}function Yx(o){const{xScale:n,yScale:a,_scaleRanges:h}=o,d={xmin:n.min,xmax:n.max,ymin:a.min,ymax:a.max};if(!h)return o._scaleRanges=d,!0;const g=h.xmin!==n.min||h.xmax!==n.max||h.ymin!==a.min||h.ymax!==a.max;return Object.assign(h,d),g}const Gd=o=>o===0||o===1,dy=(o,n,a)=>-(Math.pow(2,10*(o-=1))*Math.sin((o-n)*Ri/a)),py=(o,n,a)=>Math.pow(2,-10*o)*Math.sin((o-n)*Ri/a)+1,eu={linear:o=>o,easeInQuad:o=>o*o,easeOutQuad:o=>-o*(o-2),easeInOutQuad:o=>(o/=.5)<1?.5*o*o:-.5*(--o*(o-2)-1),easeInCubic:o=>o*o*o,easeOutCubic:o=>(o-=1)*o*o+1,easeInOutCubic:o=>(o/=.5)<1?.5*o*o*o:.5*((o-=2)*o*o+2),easeInQuart:o=>o*o*o*o,easeOutQuart:o=>-((o-=1)*o*o*o-1),easeInOutQuart:o=>(o/=.5)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2),easeInQuint:o=>o*o*o*o*o,easeOutQuint:o=>(o-=1)*o*o*o*o+1,easeInOutQuint:o=>(o/=.5)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2),easeInSine:o=>-Math.cos(o*Ji)+1,easeOutSine:o=>Math.sin(o*Ji),easeInOutSine:o=>-.5*(Math.cos(Oi*o)-1),easeInExpo:o=>o===0?0:Math.pow(2,10*(o-1)),easeOutExpo:o=>o===1?1:-Math.pow(2,-10*o)+1,easeInOutExpo:o=>Gd(o)?o:o<.5?.5*Math.pow(2,10*(o*2-1)):.5*(-Math.pow(2,-10*(o*2-1))+2),easeInCirc:o=>o>=1?o:-(Math.sqrt(1-o*o)-1),easeOutCirc:o=>Math.sqrt(1-(o-=1)*o),easeInOutCirc:o=>(o/=.5)<1?-.5*(Math.sqrt(1-o*o)-1):.5*(Math.sqrt(1-(o-=2)*o)+1),easeInElastic:o=>Gd(o)?o:dy(o,.075,.3),easeOutElastic:o=>Gd(o)?o:py(o,.075,.3),easeInOutElastic(o){return Gd(o)?o:o<.5?.5*dy(o*2,.1125,.45):.5+.5*py(o*2-1,.1125,.45)},easeInBack(o){return o*o*((1.70158+1)*o-1.70158)},easeOutBack(o){return(o-=1)*o*((1.70158+1)*o+1.70158)+1},easeInOutBack(o){let n=1.70158;return(o/=.5)<1?.5*(o*o*(((n*=1.525)+1)*o-n)):.5*((o-=2)*o*(((n*=1.525)+1)*o+n)+2)},easeInBounce:o=>1-eu.easeOutBounce(1-o),easeOutBounce(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},easeInOutBounce:o=>o<.5?eu.easeInBounce(o*2)*.5:eu.easeOutBounce(o*2-1)*.5+.5};function um(o){if(o&&typeof o=="object"){const n=o.toString();return n==="[object CanvasPattern]"||n==="[object CanvasGradient]"}return!1}function fy(o){return um(o)?o:new nu(o)}function x_(o){return um(o)?o:new nu(o).saturate(.5).darken(.1).hexString()}const N2=["x","y","borderWidth","radius","tension"],j2=["color","borderColor","backgroundColor"];function V2(o){o.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),o.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:n=>n!=="onProgress"&&n!=="onComplete"&&n!=="fn"}),o.set("animations",{colors:{type:"color",properties:j2},numbers:{type:"number",properties:N2}}),o.describe("animations",{_fallback:"animation"}),o.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:n=>n|0}}}})}function U2(o){o.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const _y=new Map;function G2(o,n){n=n||{};const a=o+JSON.stringify(n);let h=_y.get(a);return h||(h=new Intl.NumberFormat(o,n),_y.set(a,h)),h}function pu(o,n,a){return G2(n,a).format(o)}const Kx={values(o){return zi(o)?o:""+o},numeric(o,n,a){if(o===0)return"0";const h=this.chart.options.locale;let d,g=o;if(a.length>1){const C=Math.max(Math.abs(a[0].value),Math.abs(a[a.length-1].value));(C<1e-4||C>1e15)&&(d="scientific"),g=$2(o,a)}const v=Ao(Math.abs(g)),r=isNaN(v)?1:Math.max(Math.min(-1*Math.floor(v),20),0),T={notation:d,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(T,this.options.ticks.format),pu(o,h,T)},logarithmic(o,n,a){if(o===0)return"0";const h=a[n].significand||o/Math.pow(10,Math.floor(Ao(o)));return[1,2,3,5,10,15].includes(h)||n>.8*a.length?Kx.numeric.call(this,o,n,a):""}};function $2(o,n){let a=n.length>3?n[2].value-n[1].value:n[1].value-n[0].value;return Math.abs(a)>=1&&o!==Math.floor(o)&&(a=o-Math.floor(o)),a}var kp={formatters:Kx};function q2(o){o.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(n,a)=>a.lineWidth,tickColor:(n,a)=>a.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:kp.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),o.route("scale.ticks","color","","color"),o.route("scale.grid","color","","borderColor"),o.route("scale.border","color","","borderColor"),o.route("scale.title","color","","color"),o.describe("scale",{_fallback:!1,_scriptable:n=>!n.startsWith("before")&&!n.startsWith("after")&&n!=="callback"&&n!=="parser",_indexable:n=>n!=="borderDash"&&n!=="tickBorderDash"&&n!=="dash"}),o.describe("scales",{_fallback:"scale"}),o.describe("scale.ticks",{_scriptable:n=>n!=="backdropPadding"&&n!=="callback",_indexable:n=>n!=="backdropPadding"})}const Va=Object.create(null),V_=Object.create(null);function tu(o,n){if(!n)return o;const a=n.split(".");for(let h=0,d=a.length;h<d;++h){const g=a[h];o=o[g]||(o[g]=Object.create(null))}return o}function v_(o,n,a){return typeof n=="string"?su(tu(o,n),a):su(tu(o,""),n)}class W2{constructor(n,a){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=h=>h.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(h,d)=>x_(d.backgroundColor),this.hoverBorderColor=(h,d)=>x_(d.borderColor),this.hoverColor=(h,d)=>x_(d.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(n),this.apply(a)}set(n,a){return v_(this,n,a)}get(n){return tu(this,n)}describe(n,a){return v_(V_,n,a)}override(n,a){return v_(Va,n,a)}route(n,a,h,d){const g=tu(this,n),v=tu(this,h),r="_"+a;Object.defineProperties(g,{[r]:{value:g[a],writable:!0},[a]:{enumerable:!0,get(){const T=this[r],C=v[d];return Ht(T)?Object.assign({},C,T):Vt(T,C)},set(T){this[r]=T}}})}apply(n){n.forEach(a=>a(this))}}var Ki=new W2({_scriptable:o=>!o.startsWith("on"),_indexable:o=>o!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[V2,U2,q2]);function Z2(o){return!o||ei(o.size)||ei(o.family)?null:(o.style?o.style+" ":"")+(o.weight?o.weight+" ":"")+o.size+"px "+o.family}function wp(o,n,a,h,d){let g=n[d];return g||(g=n[d]=o.measureText(d).width,a.push(d)),g>h&&(h=g),h}function H2(o,n,a,h){h=h||{};let d=h.data=h.data||{},g=h.garbageCollect=h.garbageCollect||[];h.font!==n&&(d=h.data={},g=h.garbageCollect=[],h.font=n),o.save(),o.font=n;let v=0;const r=a.length;let T,C,R,F,U;for(T=0;T<r;T++)if(F=a[T],F!=null&&!zi(F))v=wp(o,d,g,v,F);else if(zi(F))for(C=0,R=F.length;C<R;C++)U=F[C],U!=null&&!zi(U)&&(v=wp(o,d,g,v,U));o.restore();const Y=g.length/2;if(Y>a.length){for(T=0;T<Y;T++)delete d[g[T]];g.splice(0,Y)}return v}function ka(o,n,a){const h=o.currentDevicePixelRatio,d=a!==0?Math.max(a/2,.5):0;return Math.round((n-d)*h)/h+d}function my(o,n){n=n||o.getContext("2d"),n.save(),n.resetTransform(),n.clearRect(0,0,o.width,o.height),n.restore()}function U_(o,n,a,h){Jx(o,n,a,h,null)}function Jx(o,n,a,h,d){let g,v,r,T,C,R,F,U;const Y=n.pointStyle,ie=n.rotation,ce=n.radius;let he=(ie||0)*C2;if(Y&&typeof Y=="object"&&(g=Y.toString(),g==="[object HTMLImageElement]"||g==="[object HTMLCanvasElement]")){o.save(),o.translate(a,h),o.rotate(he),o.drawImage(Y,-Y.width/2,-Y.height/2,Y.width,Y.height),o.restore();return}if(!(isNaN(ce)||ce<=0)){switch(o.beginPath(),Y){default:d?o.ellipse(a,h,d/2,ce,0,0,Ri):o.arc(a,h,ce,0,Ri),o.closePath();break;case"triangle":R=d?d/2:ce,o.moveTo(a+Math.sin(he)*R,h-Math.cos(he)*ce),he+=ly,o.lineTo(a+Math.sin(he)*R,h-Math.cos(he)*ce),he+=ly,o.lineTo(a+Math.sin(he)*R,h-Math.cos(he)*ce),o.closePath();break;case"rectRounded":C=ce*.516,T=ce-C,v=Math.cos(he+Pa)*T,F=Math.cos(he+Pa)*(d?d/2-C:T),r=Math.sin(he+Pa)*T,U=Math.sin(he+Pa)*(d?d/2-C:T),o.arc(a-F,h-r,C,he-Oi,he-Ji),o.arc(a+U,h-v,C,he-Ji,he),o.arc(a+F,h+r,C,he,he+Ji),o.arc(a-U,h+v,C,he+Ji,he+Oi),o.closePath();break;case"rect":if(!ie){T=Math.SQRT1_2*ce,R=d?d/2:T,o.rect(a-R,h-T,2*R,2*T);break}he+=Pa;case"rectRot":F=Math.cos(he)*(d?d/2:ce),v=Math.cos(he)*ce,r=Math.sin(he)*ce,U=Math.sin(he)*(d?d/2:ce),o.moveTo(a-F,h-r),o.lineTo(a+U,h-v),o.lineTo(a+F,h+r),o.lineTo(a-U,h+v),o.closePath();break;case"crossRot":he+=Pa;case"cross":F=Math.cos(he)*(d?d/2:ce),v=Math.cos(he)*ce,r=Math.sin(he)*ce,U=Math.sin(he)*(d?d/2:ce),o.moveTo(a-F,h-r),o.lineTo(a+F,h+r),o.moveTo(a+U,h-v),o.lineTo(a-U,h+v);break;case"star":F=Math.cos(he)*(d?d/2:ce),v=Math.cos(he)*ce,r=Math.sin(he)*ce,U=Math.sin(he)*(d?d/2:ce),o.moveTo(a-F,h-r),o.lineTo(a+F,h+r),o.moveTo(a+U,h-v),o.lineTo(a-U,h+v),he+=Pa,F=Math.cos(he)*(d?d/2:ce),v=Math.cos(he)*ce,r=Math.sin(he)*ce,U=Math.sin(he)*(d?d/2:ce),o.moveTo(a-F,h-r),o.lineTo(a+F,h+r),o.moveTo(a+U,h-v),o.lineTo(a-U,h+v);break;case"line":v=d?d/2:Math.cos(he)*ce,r=Math.sin(he)*ce,o.moveTo(a-v,h-r),o.lineTo(a+v,h+r);break;case"dash":o.moveTo(a,h),o.lineTo(a+Math.cos(he)*(d?d/2:ce),h+Math.sin(he)*ce);break;case!1:o.closePath();break}o.fill(),n.borderWidth>0&&o.stroke()}}function jr(o,n,a){return a=a||.5,!n||o&&o.x>n.left-a&&o.x<n.right+a&&o.y>n.top-a&&o.y<n.bottom+a}function Lp(o,n){o.save(),o.beginPath(),o.rect(n.left,n.top,n.right-n.left,n.bottom-n.top),o.clip()}function Dp(o){o.restore()}function X2(o,n,a,h,d){if(!n)return o.lineTo(a.x,a.y);if(d==="middle"){const g=(n.x+a.x)/2;o.lineTo(g,n.y),o.lineTo(g,a.y)}else d==="after"!=!!h?o.lineTo(n.x,a.y):o.lineTo(a.x,n.y);o.lineTo(a.x,a.y)}function Y2(o,n,a,h){if(!n)return o.lineTo(a.x,a.y);o.bezierCurveTo(h?n.cp1x:n.cp2x,h?n.cp1y:n.cp2y,h?a.cp2x:a.cp1x,h?a.cp2y:a.cp1y,a.x,a.y)}function K2(o,n){n.translation&&o.translate(n.translation[0],n.translation[1]),ei(n.rotation)||o.rotate(n.rotation),n.color&&(o.fillStyle=n.color),n.textAlign&&(o.textAlign=n.textAlign),n.textBaseline&&(o.textBaseline=n.textBaseline)}function J2(o,n,a,h,d){if(d.strikethrough||d.underline){const g=o.measureText(h),v=n-g.actualBoundingBoxLeft,r=n+g.actualBoundingBoxRight,T=a-g.actualBoundingBoxAscent,C=a+g.actualBoundingBoxDescent,R=d.strikethrough?(T+C)/2:C;o.strokeStyle=o.fillStyle,o.beginPath(),o.lineWidth=d.decorationWidth||2,o.moveTo(v,R),o.lineTo(r,R),o.stroke()}}function Q2(o,n){const a=o.fillStyle;o.fillStyle=n.color,o.fillRect(n.left,n.top,n.width,n.height),o.fillStyle=a}function Ua(o,n,a,h,d,g={}){const v=zi(n)?n:[n],r=g.strokeWidth>0&&g.strokeColor!=="";let T,C;for(o.save(),o.font=d.string,K2(o,g),T=0;T<v.length;++T)C=v[T],g.backdrop&&Q2(o,g.backdrop),r&&(g.strokeColor&&(o.strokeStyle=g.strokeColor),ei(g.strokeWidth)||(o.lineWidth=g.strokeWidth),o.strokeText(C,a,h,g.maxWidth)),o.fillText(C,a,h,g.maxWidth),J2(o,a,h,C,g),h+=Number(d.lineHeight);o.restore()}function ko(o,n){const{x:a,y:h,w:d,h:g,radius:v}=n;o.arc(a+v.topLeft,h+v.topLeft,v.topLeft,1.5*Oi,Oi,!0),o.lineTo(a,h+g-v.bottomLeft),o.arc(a+v.bottomLeft,h+g-v.bottomLeft,v.bottomLeft,Oi,Ji,!0),o.lineTo(a+d-v.bottomRight,h+g),o.arc(a+d-v.bottomRight,h+g-v.bottomRight,v.bottomRight,Ji,0,!0),o.lineTo(a+d,h+v.topRight),o.arc(a+d-v.topRight,h+v.topRight,v.topRight,0,-Ji,!0),o.lineTo(a+v.topLeft,h)}const eT=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,tT=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function iT(o,n){const a=(""+o).match(eT);if(!a||a[1]==="normal")return n*1.2;switch(o=+a[2],a[3]){case"px":return o;case"%":o/=100;break}return n*o}const nT=o=>+o||0;function dm(o,n){const a={},h=Ht(n),d=h?Object.keys(n):n,g=Ht(o)?h?v=>Vt(o[v],o[n[v]]):v=>o[v]:()=>o;for(const v of d)a[v]=nT(g(v));return a}function Qx(o){return dm(o,{top:"y",right:"x",bottom:"y",left:"x"})}function Lo(o){return dm(o,["topLeft","topRight","bottomLeft","bottomRight"])}function Ln(o){const n=Qx(o);return n.width=n.left+n.right,n.height=n.top+n.bottom,n}function hn(o,n){o=o||{},n=n||Ki.font;let a=Vt(o.size,n.size);typeof a=="string"&&(a=parseInt(a,10));let h=Vt(o.style,n.style);h&&!(""+h).match(tT)&&(console.warn('Invalid font style specified: "'+h+'"'),h=void 0);const d={family:Vt(o.family,n.family),lineHeight:iT(Vt(o.lineHeight,n.lineHeight),a),size:a,style:h,weight:Vt(o.weight,n.weight),string:""};return d.string=Z2(d),d}function $h(o,n,a,h){let d=!0,g,v,r;for(g=0,v=o.length;g<v;++g)if(r=o[g],r!==void 0&&(n!==void 0&&typeof r=="function"&&(r=r(n),d=!1),a!==void 0&&zi(r)&&(r=r[a%r.length],d=!1),r!==void 0))return h&&!d&&(h.cacheable=!1),r}function sT(o,n,a){const{min:h,max:d}=o,g=Vx(n,(d-h)/2),v=(r,T)=>a&&r===0?0:r+T;return{min:v(h,-Math.abs(g)),max:v(d,g)}}function Bo(o,n){return Object.assign(Object.create(o),n)}function pm(o,n=[""],a,h,d=()=>o[0]){const g=a||o;typeof h>"u"&&(h=n1("_fallback",o));const v={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:o,_rootScopes:g,_fallback:h,_getTarget:d,override:r=>pm([r,...o],n,g,h)};return new Proxy(v,{deleteProperty(r,T){return delete r[T],delete r._keys,delete o[0][T],!0},get(r,T){return t1(r,T,()=>dT(T,n,o,r))},getOwnPropertyDescriptor(r,T){return Reflect.getOwnPropertyDescriptor(r._scopes[0],T)},getPrototypeOf(){return Reflect.getPrototypeOf(o[0])},has(r,T){return yy(r).includes(T)},ownKeys(r){return yy(r)},set(r,T,C){const R=r._storage||(r._storage=d());return r[T]=R[T]=C,delete r._keys,!0}})}function ec(o,n,a,h){const d={_cacheable:!1,_proxy:o,_context:n,_subProxy:a,_stack:new Set,_descriptors:e1(o,h),setContext:g=>ec(o,g,a,h),override:g=>ec(o.override(g),n,a,h)};return new Proxy(d,{deleteProperty(g,v){return delete g[v],delete o[v],!0},get(g,v,r){return t1(g,v,()=>oT(g,v,r))},getOwnPropertyDescriptor(g,v){return g._descriptors.allKeys?Reflect.has(o,v)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(o,v)},getPrototypeOf(){return Reflect.getPrototypeOf(o)},has(g,v){return Reflect.has(o,v)},ownKeys(){return Reflect.ownKeys(o)},set(g,v,r){return o[v]=r,delete g[v],!0}})}function e1(o,n={scriptable:!0,indexable:!0}){const{_scriptable:a=n.scriptable,_indexable:h=n.indexable,_allKeys:d=n.allKeys}=o;return{allKeys:d,scriptable:a,indexable:h,isScriptable:zo(a)?a:()=>a,isIndexable:zo(h)?h:()=>h}}const rT=(o,n)=>o?o+am(n):n,fm=(o,n)=>Ht(n)&&o!=="adapters"&&(Object.getPrototypeOf(n)===null||n.constructor===Object);function t1(o,n,a){if(Object.prototype.hasOwnProperty.call(o,n))return o[n];const h=a();return o[n]=h,h}function oT(o,n,a){const{_proxy:h,_context:d,_subProxy:g,_descriptors:v}=o;let r=h[n];return zo(r)&&v.isScriptable(n)&&(r=aT(n,r,o,a)),zi(r)&&r.length&&(r=lT(n,r,o,v.isIndexable)),fm(n,r)&&(r=ec(r,d,g&&g[n],v)),r}function aT(o,n,a,h){const{_proxy:d,_context:g,_subProxy:v,_stack:r}=a;if(r.has(o))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+o);r.add(o);let T=n(g,v||h);return r.delete(o),fm(o,T)&&(T=_m(d._scopes,d,o,T)),T}function lT(o,n,a,h){const{_proxy:d,_context:g,_subProxy:v,_descriptors:r}=a;if(typeof g.index<"u"&&h(o))return n[g.index%n.length];if(Ht(n[0])){const T=n,C=d._scopes.filter(R=>R!==T);n=[];for(const R of T){const F=_m(C,d,o,R);n.push(ec(F,g,v&&v[o],r))}}return n}function i1(o,n,a){return zo(o)?o(n,a):o}const cT=(o,n)=>o===!0?n:typeof o=="string"?Do(n,o):void 0;function hT(o,n,a,h,d){for(const g of n){const v=cT(a,g);if(v){o.add(v);const r=i1(v._fallback,a,d);if(typeof r<"u"&&r!==a&&r!==h)return r}else if(v===!1&&typeof h<"u"&&a!==h)return null}return!1}function _m(o,n,a,h){const d=n._rootScopes,g=i1(n._fallback,a,h),v=[...o,...d],r=new Set;r.add(h);let T=gy(r,v,a,g||a,h);return T===null||typeof g<"u"&&g!==a&&(T=gy(r,v,g,T,h),T===null)?!1:pm(Array.from(r),[""],d,g,()=>uT(n,a,h))}function gy(o,n,a,h,d){for(;a;)a=hT(o,n,a,h,d);return a}function uT(o,n,a){const h=o._getTarget();n in h||(h[n]={});const d=h[n];return zi(d)&&Ht(a)?a:d||{}}function dT(o,n,a,h){let d;for(const g of n)if(d=n1(rT(g,o),a),typeof d<"u")return fm(o,d)?_m(a,h,o,d):d}function n1(o,n){for(const a of n){if(!a)continue;const h=a[o];if(typeof h<"u")return h}}function yy(o){let n=o._keys;return n||(n=o._keys=pT(o._scopes)),n}function pT(o){const n=new Set;for(const a of o)for(const h of Object.keys(a).filter(d=>!d.startsWith("_")))n.add(h);return Array.from(n)}function s1(o,n,a,h){const{iScale:d}=o,{key:g="r"}=this._parsing,v=new Array(h);let r,T,C,R;for(r=0,T=h;r<T;++r)C=r+a,R=n[C],v[r]={r:d.parse(Do(R,g),C)};return v}const fT=Number.EPSILON||1e-14,tc=(o,n)=>n<o.length&&!o[n].skip&&o[n],r1=o=>o==="x"?"y":"x";function _T(o,n,a,h){const d=o.skip?n:o,g=n,v=a.skip?n:a,r=j_(g,d),T=j_(v,g);let C=r/(r+T),R=T/(r+T);C=isNaN(C)?0:C,R=isNaN(R)?0:R;const F=h*C,U=h*R;return{previous:{x:g.x-F*(v.x-d.x),y:g.y-F*(v.y-d.y)},next:{x:g.x+U*(v.x-d.x),y:g.y+U*(v.y-d.y)}}}function mT(o,n,a){const h=o.length;let d,g,v,r,T,C=tc(o,0);for(let R=0;R<h-1;++R)if(T=C,C=tc(o,R+1),!(!T||!C)){if(Qh(n[R],0,fT)){a[R]=a[R+1]=0;continue}d=a[R]/n[R],g=a[R+1]/n[R],r=Math.pow(d,2)+Math.pow(g,2),!(r<=9)&&(v=3/Math.sqrt(r),a[R]=d*v*n[R],a[R+1]=g*v*n[R])}}function gT(o,n,a="x"){const h=r1(a),d=o.length;let g,v,r,T=tc(o,0);for(let C=0;C<d;++C){if(v=r,r=T,T=tc(o,C+1),!r)continue;const R=r[a],F=r[h];v&&(g=(R-v[a])/3,r[`cp1${a}`]=R-g,r[`cp1${h}`]=F-g*n[C]),T&&(g=(T[a]-R)/3,r[`cp2${a}`]=R+g,r[`cp2${h}`]=F+g*n[C])}}function yT(o,n="x"){const a=r1(n),h=o.length,d=Array(h).fill(0),g=Array(h);let v,r,T,C=tc(o,0);for(v=0;v<h;++v)if(r=T,T=C,C=tc(o,v+1),!!T){if(C){const R=C[n]-T[n];d[v]=R!==0?(C[a]-T[a])/R:0}g[v]=r?C?hr(d[v-1])!==hr(d[v])?0:(d[v-1]+d[v])/2:d[v-1]:d[v]}mT(o,d,g),gT(o,g,n)}function $d(o,n,a){return Math.max(Math.min(o,a),n)}function xT(o,n){let a,h,d,g,v,r=jr(o[0],n);for(a=0,h=o.length;a<h;++a)v=g,g=r,r=a<h-1&&jr(o[a+1],n),g&&(d=o[a],v&&(d.cp1x=$d(d.cp1x,n.left,n.right),d.cp1y=$d(d.cp1y,n.top,n.bottom)),r&&(d.cp2x=$d(d.cp2x,n.left,n.right),d.cp2y=$d(d.cp2y,n.top,n.bottom)))}function vT(o,n,a,h,d){let g,v,r,T;if(n.spanGaps&&(o=o.filter(C=>!C.skip)),n.cubicInterpolationMode==="monotone")yT(o,d);else{let C=h?o[o.length-1]:o[0];for(g=0,v=o.length;g<v;++g)r=o[g],T=_T(C,r,o[Math.min(g+1,v-(h?0:1))%v],n.tension),r.cp1x=T.previous.x,r.cp1y=T.previous.y,r.cp2x=T.next.x,r.cp2y=T.next.y,C=r}n.capBezierPoints&&xT(o,a)}function o1(){return typeof window<"u"&&typeof document<"u"}function mm(o){let n=o.parentNode;return n&&n.toString()==="[object ShadowRoot]"&&(n=n.host),n}function Tp(o,n,a){let h;return typeof o=="string"?(h=parseInt(o,10),o.indexOf("%")!==-1&&(h=h/100*n.parentNode[a])):h=o,h}const zp=o=>o.ownerDocument.defaultView.getComputedStyle(o,null);function bT(o,n){return zp(o).getPropertyValue(n)}const wT=["top","right","bottom","left"];function ja(o,n,a){const h={};a=a?"-"+a:"";for(let d=0;d<4;d++){const g=wT[d];h[g]=parseFloat(o[n+"-"+g+a])||0}return h.width=h.left+h.right,h.height=h.top+h.bottom,h}const TT=(o,n,a)=>(o>0||n>0)&&(!a||!a.shadowRoot);function ET(o,n){const a=o.touches,h=a&&a.length?a[0]:o,{offsetX:d,offsetY:g}=h;let v=!1,r,T;if(TT(d,g,o.target))r=d,T=g;else{const C=n.getBoundingClientRect();r=h.clientX-C.left,T=h.clientY-C.top,v=!0}return{x:r,y:T,box:v}}function Oa(o,n){if("native"in o)return o;const{canvas:a,currentDevicePixelRatio:h}=n,d=zp(a),g=d.boxSizing==="border-box",v=ja(d,"padding"),r=ja(d,"border","width"),{x:T,y:C,box:R}=ET(o,a),F=v.left+(R&&r.left),U=v.top+(R&&r.top);let{width:Y,height:ie}=n;return g&&(Y-=v.width+r.width,ie-=v.height+r.height),{x:Math.round((T-F)/Y*a.width/h),y:Math.round((C-U)/ie*a.height/h)}}function MT(o,n,a){let h,d;if(n===void 0||a===void 0){const g=mm(o);if(!g)n=o.clientWidth,a=o.clientHeight;else{const v=g.getBoundingClientRect(),r=zp(g),T=ja(r,"border","width"),C=ja(r,"padding");n=v.width-C.width-T.width,a=v.height-C.height-T.height,h=Tp(r.maxWidth,g,"clientWidth"),d=Tp(r.maxHeight,g,"clientHeight")}}return{width:n,height:a,maxWidth:h||bp,maxHeight:d||bp}}const qd=o=>Math.round(o*10)/10;function ST(o,n,a,h){const d=zp(o),g=ja(d,"margin"),v=Tp(d.maxWidth,o,"clientWidth")||bp,r=Tp(d.maxHeight,o,"clientHeight")||bp,T=MT(o,n,a);let{width:C,height:R}=T;if(d.boxSizing==="content-box"){const U=ja(d,"border","width"),Y=ja(d,"padding");C-=Y.width+U.width,R-=Y.height+U.height}return C=Math.max(0,C-g.width),R=Math.max(0,h?C/h:R-g.height),C=qd(Math.min(C,v,T.maxWidth)),R=qd(Math.min(R,r,T.maxHeight)),C&&!R&&(R=qd(C/2)),(n!==void 0||a!==void 0)&&h&&T.height&&R>T.height&&(R=T.height,C=qd(Math.floor(R*h))),{width:C,height:R}}function xy(o,n,a){const h=n||1,d=Math.floor(o.height*h),g=Math.floor(o.width*h);o.height=Math.floor(o.height),o.width=Math.floor(o.width);const v=o.canvas;return v.style&&(a||!v.style.height&&!v.style.width)&&(v.style.height=`${o.height}px`,v.style.width=`${o.width}px`),o.currentDevicePixelRatio!==h||v.height!==d||v.width!==g?(o.currentDevicePixelRatio=h,v.height=d,v.width=g,o.ctx.setTransform(h,0,0,h,0,0),!0):!1}const AT=function(){let o=!1;try{const n={get passive(){return o=!0,!1}};window.addEventListener("test",null,n),window.removeEventListener("test",null,n)}catch{}return o}();function vy(o,n){const a=bT(o,n),h=a&&a.match(/^(\d+)(\.\d+)?px$/);return h?+h[1]:void 0}function Ba(o,n,a,h){return{x:o.x+a*(n.x-o.x),y:o.y+a*(n.y-o.y)}}function IT(o,n,a,h){return{x:o.x+a*(n.x-o.x),y:h==="middle"?a<.5?o.y:n.y:h==="after"?a<1?o.y:n.y:a>0?n.y:o.y}}function CT(o,n,a,h){const d={x:o.cp2x,y:o.cp2y},g={x:n.cp1x,y:n.cp1y},v=Ba(o,d,a),r=Ba(d,g,a),T=Ba(g,n,a),C=Ba(v,r,a),R=Ba(r,T,a);return Ba(C,R,a)}const PT=function(o,n){return{x(a){return o+o+n-a},setWidth(a){n=a},textAlign(a){return a==="center"?a:a==="right"?"left":"right"},xPlus(a,h){return a-h},leftForLtr(a,h){return a-h}}},kT=function(){return{x(o){return o},setWidth(o){},textAlign(o){return o},xPlus(o,n){return o+n},leftForLtr(o,n){return o}}};function Xl(o,n,a){return o?PT(n,a):kT()}function a1(o,n){let a,h;(n==="ltr"||n==="rtl")&&(a=o.canvas.style,h=[a.getPropertyValue("direction"),a.getPropertyPriority("direction")],a.setProperty("direction",n,"important"),o.prevTextDirection=h)}function l1(o,n){n!==void 0&&(delete o.prevTextDirection,o.canvas.style.setProperty("direction",n[0],n[1]))}function c1(o){return o==="angle"?{between:ou,compare:L2,normalize:ls}:{between:Fr,compare:(n,a)=>n-a,normalize:n=>n}}function by({start:o,end:n,count:a,loop:h,style:d}){return{start:o%a,end:n%a,loop:h&&(n-o+1)%a===0,style:d}}function LT(o,n,a){const{property:h,start:d,end:g}=a,{between:v,normalize:r}=c1(h),T=n.length;let{start:C,end:R,loop:F}=o,U,Y;if(F){for(C+=T,R+=T,U=0,Y=T;U<Y&&v(r(n[C%T][h]),d,g);++U)C--,R--;C%=T,R%=T}return R<C&&(R+=T),{start:C,end:R,loop:F,style:o.style}}function h1(o,n,a){if(!a)return[o];const{property:h,start:d,end:g}=a,v=n.length,{compare:r,between:T,normalize:C}=c1(h),{start:R,end:F,loop:U,style:Y}=LT(o,n,a),ie=[];let ce=!1,he=null,be,Le,Fe;const qe=()=>T(d,Fe,be)&&r(d,Fe)!==0,Re=()=>r(g,be)===0||T(g,Fe,be),Je=()=>ce||qe(),nt=()=>!ce||Re();for(let st=R,De=R;st<=F;++st)Le=n[st%v],!Le.skip&&(be=C(Le[h]),be!==Fe&&(ce=T(be,d,g),he===null&&Je()&&(he=r(be,d)===0?st:De),he!==null&&nt()&&(ie.push(by({start:he,end:st,loop:U,count:v,style:Y})),he=null),De=st,Fe=be));return he!==null&&ie.push(by({start:he,end:F,loop:U,count:v,style:Y})),ie}function u1(o,n){const a=[],h=o.segments;for(let d=0;d<h.length;d++){const g=h1(h[d],o.points,n);g.length&&a.push(...g)}return a}function DT(o,n,a,h){let d=0,g=n-1;if(a&&!h)for(;d<n&&!o[d].skip;)d++;for(;d<n&&o[d].skip;)d++;for(d%=n,a&&(g+=d);g>d&&o[g%n].skip;)g--;return g%=n,{start:d,end:g}}function zT(o,n,a,h){const d=o.length,g=[];let v=n,r=o[n],T;for(T=n+1;T<=a;++T){const C=o[T%d];C.skip||C.stop?r.skip||(h=!1,g.push({start:n%d,end:(T-1)%d,loop:h}),n=v=C.stop?T:null):(v=T,r.skip&&(n=T)),r=C}return v!==null&&g.push({start:n%d,end:v%d,loop:h}),g}function RT(o,n){const a=o.points,h=o.options.spanGaps,d=a.length;if(!d)return[];const g=!!o._loop,{start:v,end:r}=DT(a,d,g,h);if(h===!0)return wy(o,[{start:v,end:r,loop:g}],a,n);const T=r<v?r+d:r,C=!!o._fullLoop&&v===0&&r===d-1;return wy(o,zT(a,v,T,C),a,n)}function wy(o,n,a,h){return!h||!h.setContext||!a?n:OT(o,n,a,h)}function OT(o,n,a,h){const d=o._chart.getContext(),g=Ty(o.options),{_datasetIndex:v,options:{spanGaps:r}}=o,T=a.length,C=[];let R=g,F=n[0].start,U=F;function Y(ie,ce,he,be){const Le=r?-1:1;if(ie!==ce){for(ie+=T;a[ie%T].skip;)ie-=Le;for(;a[ce%T].skip;)ce+=Le;ie%T!==ce%T&&(C.push({start:ie%T,end:ce%T,loop:he,style:be}),R=be,F=ce%T)}}for(const ie of n){F=r?F:ie.start;let ce=a[F%T],he;for(U=F+1;U<=ie.end;U++){const be=a[U%T];he=Ty(h.setContext(Bo(d,{type:"segment",p0:ce,p1:be,p0DataIndex:(U-1)%T,p1DataIndex:U%T,datasetIndex:v}))),BT(he,R)&&Y(F,U-1,ie.loop,R),ce=be,R=he}F<U-1&&Y(F,U-1,ie.loop,R)}return C}function Ty(o){return{backgroundColor:o.backgroundColor,borderCapStyle:o.borderCapStyle,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderJoinStyle:o.borderJoinStyle,borderWidth:o.borderWidth,borderColor:o.borderColor}}function BT(o,n){if(!n)return!1;const a=[],h=function(d,g){return um(g)?(a.includes(g)||a.push(g),a.indexOf(g)):g};return JSON.stringify(o,h)!==JSON.stringify(n,h)}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class FT{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(n,a,h,d){const g=a.listeners[d],v=a.duration;g.forEach(r=>r({chart:n,initial:a.initial,numSteps:v,currentStep:Math.min(h-a.start,v)}))}_refresh(){this._request||(this._running=!0,this._request=Zx.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(n=Date.now()){let a=0;this._charts.forEach((h,d)=>{if(!h.running||!h.items.length)return;const g=h.items;let v=g.length-1,r=!1,T;for(;v>=0;--v)T=g[v],T._active?(T._total>h.duration&&(h.duration=T._total),T.tick(n),r=!0):(g[v]=g[g.length-1],g.pop());r&&(d.draw(),this._notify(d,h,n,"progress")),g.length||(h.running=!1,this._notify(d,h,n,"complete"),h.initial=!1),a+=g.length}),this._lastDate=n,a===0&&(this._running=!1)}_getAnims(n){const a=this._charts;let h=a.get(n);return h||(h={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},a.set(n,h)),h}listen(n,a,h){this._getAnims(n).listeners[a].push(h)}add(n,a){!a||!a.length||this._getAnims(n).items.push(...a)}has(n){return this._getAnims(n).items.length>0}start(n){const a=this._charts.get(n);a&&(a.running=!0,a.start=Date.now(),a.duration=a.items.reduce((h,d)=>Math.max(h,d._duration),0),this._refresh())}running(n){if(!this._running)return!1;const a=this._charts.get(n);return!(!a||!a.running||!a.items.length)}stop(n){const a=this._charts.get(n);if(!a||!a.items.length)return;const h=a.items;let d=h.length-1;for(;d>=0;--d)h[d].cancel();a.items=[],this._notify(n,a,Date.now(),"complete")}remove(n){return this._charts.delete(n)}}var Rr=new FT;const Ey="transparent",NT={boolean(o,n,a){return a>.5?n:o},color(o,n,a){const h=fy(o||Ey),d=h.valid&&fy(n||Ey);return d&&d.valid?d.mix(h,a).hexString():n},number(o,n,a){return o+(n-o)*a}};class jT{constructor(n,a,h,d){const g=a[h];d=$h([n.to,d,g,n.from]);const v=$h([n.from,g,d]);this._active=!0,this._fn=n.fn||NT[n.type||typeof v],this._easing=eu[n.easing]||eu.linear,this._start=Math.floor(Date.now()+(n.delay||0)),this._duration=this._total=Math.floor(n.duration),this._loop=!!n.loop,this._target=a,this._prop=h,this._from=v,this._to=d,this._promises=void 0}active(){return this._active}update(n,a,h){if(this._active){this._notify(!1);const d=this._target[this._prop],g=h-this._start,v=this._duration-g;this._start=h,this._duration=Math.floor(Math.max(v,n.duration)),this._total+=g,this._loop=!!n.loop,this._to=$h([n.to,a,d,n.from]),this._from=$h([n.from,d,a])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(n){const a=n-this._start,h=this._duration,d=this._prop,g=this._from,v=this._loop,r=this._to;let T;if(this._active=g!==r&&(v||a<h),!this._active){this._target[d]=r,this._notify(!0);return}if(a<0){this._target[d]=g;return}T=a/h%2,T=v&&T>1?2-T:T,T=this._easing(Math.min(1,Math.max(0,T))),this._target[d]=this._fn(g,r,T)}wait(){const n=this._promises||(this._promises=[]);return new Promise((a,h)=>{n.push({res:a,rej:h})})}_notify(n){const a=n?"res":"rej",h=this._promises||[];for(let d=0;d<h.length;d++)h[d][a]()}}class d1{constructor(n,a){this._chart=n,this._properties=new Map,this.configure(a)}configure(n){if(!Ht(n))return;const a=Object.keys(Ki.animation),h=this._properties;Object.getOwnPropertyNames(n).forEach(d=>{const g=n[d];if(!Ht(g))return;const v={};for(const r of a)v[r]=g[r];(zi(g.properties)&&g.properties||[d]).forEach(r=>{(r===d||!h.has(r))&&h.set(r,v)})})}_animateOptions(n,a){const h=a.options,d=UT(n,h);if(!d)return[];const g=this._createAnimations(d,h);return h.$shared&&VT(n.options.$animations,h).then(()=>{n.options=h},()=>{}),g}_createAnimations(n,a){const h=this._properties,d=[],g=n.$animations||(n.$animations={}),v=Object.keys(a),r=Date.now();let T;for(T=v.length-1;T>=0;--T){const C=v[T];if(C.charAt(0)==="$")continue;if(C==="options"){d.push(...this._animateOptions(n,a));continue}const R=a[C];let F=g[C];const U=h.get(C);if(F)if(U&&F.active()){F.update(U,R,r);continue}else F.cancel();if(!U||!U.duration){n[C]=R;continue}g[C]=F=new jT(U,n,C,R),d.push(F)}return d}update(n,a){if(this._properties.size===0){Object.assign(n,a);return}const h=this._createAnimations(n,a);if(h.length)return Rr.add(this._chart,h),!0}}function VT(o,n){const a=[],h=Object.keys(n);for(let d=0;d<h.length;d++){const g=o[h[d]];g&&g.active()&&a.push(g.wait())}return Promise.all(a)}function UT(o,n){if(!n)return;let a=o.options;if(!a){o.options=n;return}return a.$shared&&(o.options=a=Object.assign({},a,{$shared:!1,$animations:{}})),a}function My(o,n){const a=o&&o.options||{},h=a.reverse,d=a.min===void 0?n:0,g=a.max===void 0?n:0;return{start:h?g:d,end:h?d:g}}function GT(o,n,a){if(a===!1)return!1;const h=My(o,a),d=My(n,a);return{top:d.end,right:h.end,bottom:d.start,left:h.start}}function $T(o){let n,a,h,d;return Ht(o)?(n=o.top,a=o.right,h=o.bottom,d=o.left):n=a=h=d=o,{top:n,right:a,bottom:h,left:d,disabled:o===!1}}function p1(o,n){const a=[],h=o._getSortedDatasetMetas(n);let d,g;for(d=0,g=h.length;d<g;++d)a.push(h[d].index);return a}function Sy(o,n,a,h={}){const d=o.keys,g=h.mode==="single";let v,r,T,C;if(n!==null){for(v=0,r=d.length;v<r;++v){if(T=+d[v],T===a){if(h.all)continue;break}C=o.values[T],Yi(C)&&(g||n===0||hr(n)===hr(C))&&(n+=C)}return n}}function qT(o){const n=Object.keys(o),a=new Array(n.length);let h,d,g;for(h=0,d=n.length;h<d;++h)g=n[h],a[h]={x:g,y:o[g]};return a}function Ay(o,n){const a=o&&o.options.stacked;return a||a===void 0&&n.stack!==void 0}function WT(o,n,a){return`${o.id}.${n.id}.${a.stack||a.type}`}function ZT(o){const{min:n,max:a,minDefined:h,maxDefined:d}=o.getUserBounds();return{min:h?n:Number.NEGATIVE_INFINITY,max:d?a:Number.POSITIVE_INFINITY}}function HT(o,n,a){const h=o[n]||(o[n]={});return h[a]||(h[a]={})}function Iy(o,n,a,h){for(const d of n.getMatchingVisibleMetas(h).reverse()){const g=o[d.index];if(a&&g>0||!a&&g<0)return d.index}return null}function Cy(o,n){const{chart:a,_cachedMeta:h}=o,d=a._stacks||(a._stacks={}),{iScale:g,vScale:v,index:r}=h,T=g.axis,C=v.axis,R=WT(g,v,h),F=n.length;let U;for(let Y=0;Y<F;++Y){const ie=n[Y],{[T]:ce,[C]:he}=ie,be=ie._stacks||(ie._stacks={});U=be[C]=HT(d,R,ce),U[r]=he,U._top=Iy(U,v,!0,h.type),U._bottom=Iy(U,v,!1,h.type);const Le=U._visualValues||(U._visualValues={});Le[r]=he}}function b_(o,n){const a=o.scales;return Object.keys(a).filter(h=>a[h].axis===n).shift()}function XT(o,n){return Bo(o,{active:!1,dataset:void 0,datasetIndex:n,index:n,mode:"default",type:"dataset"})}function YT(o,n,a){return Bo(o,{active:!1,dataIndex:n,parsed:void 0,raw:void 0,element:a,index:n,mode:"default",type:"data"})}function Bh(o,n){const a=o.controller.index,h=o.vScale&&o.vScale.axis;if(h){n=n||o._parsed;for(const d of n){const g=d._stacks;if(!g||g[h]===void 0||g[h][a]===void 0)return;delete g[h][a],g[h]._visualValues!==void 0&&g[h]._visualValues[a]!==void 0&&delete g[h]._visualValues[a]}}}const w_=o=>o==="reset"||o==="none",Py=(o,n)=>n?o:Object.assign({},o),KT=(o,n,a)=>o&&!n.hidden&&n._stacked&&{keys:p1(a,!0),values:null};class ws{constructor(n,a){this.chart=n,this._ctx=n.ctx,this.index=a,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const n=this._cachedMeta;this.configure(),this.linkScales(),n._stacked=Ay(n.vScale,n),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(n){this.index!==n&&Bh(this._cachedMeta),this.index=n}linkScales(){const n=this.chart,a=this._cachedMeta,h=this.getDataset(),d=(F,U,Y,ie)=>F==="x"?U:F==="r"?ie:Y,g=a.xAxisID=Vt(h.xAxisID,b_(n,"x")),v=a.yAxisID=Vt(h.yAxisID,b_(n,"y")),r=a.rAxisID=Vt(h.rAxisID,b_(n,"r")),T=a.indexAxis,C=a.iAxisID=d(T,g,v,r),R=a.vAxisID=d(T,v,g,r);a.xScale=this.getScaleForId(g),a.yScale=this.getScaleForId(v),a.rScale=this.getScaleForId(r),a.iScale=this.getScaleForId(C),a.vScale=this.getScaleForId(R)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(n){return this.chart.scales[n]}_getOtherScale(n){const a=this._cachedMeta;return n===a.iScale?a.vScale:a.iScale}reset(){this._update("reset")}_destroy(){const n=this._cachedMeta;this._data&&uy(this._data,this),n._stacked&&Bh(n)}_dataCheck(){const n=this.getDataset(),a=n.data||(n.data=[]),h=this._data;if(Ht(a))this._data=qT(a);else if(h!==a){if(h){uy(h,this);const d=this._cachedMeta;Bh(d),d._parsed=[]}a&&Object.isExtensible(a)&&O2(a,this),this._syncList=[],this._data=a}}addElements(){const n=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(n.dataset=new this.datasetElementType)}buildOrUpdateElements(n){const a=this._cachedMeta,h=this.getDataset();let d=!1;this._dataCheck();const g=a._stacked;a._stacked=Ay(a.vScale,a),a.stack!==h.stack&&(d=!0,Bh(a),a.stack=h.stack),this._resyncElements(n),(d||g!==a._stacked)&&Cy(this,a._parsed)}configure(){const n=this.chart.config,a=n.datasetScopeKeys(this._type),h=n.getOptionScopes(this.getDataset(),a,!0);this.options=n.createResolver(h,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(n,a){const{_cachedMeta:h,_data:d}=this,{iScale:g,_stacked:v}=h,r=g.axis;let T=n===0&&a===d.length?!0:h._sorted,C=n>0&&h._parsed[n-1],R,F,U;if(this._parsing===!1)h._parsed=d,h._sorted=!0,U=d;else{zi(d[n])?U=this.parseArrayData(h,d,n,a):Ht(d[n])?U=this.parseObjectData(h,d,n,a):U=this.parsePrimitiveData(h,d,n,a);const Y=()=>F[r]===null||C&&F[r]<C[r];for(R=0;R<a;++R)h._parsed[R+n]=F=U[R],T&&(Y()&&(T=!1),C=F);h._sorted=T}v&&Cy(this,U)}parsePrimitiveData(n,a,h,d){const{iScale:g,vScale:v}=n,r=g.axis,T=v.axis,C=g.getLabels(),R=g===v,F=new Array(d);let U,Y,ie;for(U=0,Y=d;U<Y;++U)ie=U+h,F[U]={[r]:R||g.parse(C[ie],ie),[T]:v.parse(a[ie],ie)};return F}parseArrayData(n,a,h,d){const{xScale:g,yScale:v}=n,r=new Array(d);let T,C,R,F;for(T=0,C=d;T<C;++T)R=T+h,F=a[R],r[T]={x:g.parse(F[0],R),y:v.parse(F[1],R)};return r}parseObjectData(n,a,h,d){const{xScale:g,yScale:v}=n,{xAxisKey:r="x",yAxisKey:T="y"}=this._parsing,C=new Array(d);let R,F,U,Y;for(R=0,F=d;R<F;++R)U=R+h,Y=a[U],C[R]={x:g.parse(Do(Y,r),U),y:v.parse(Do(Y,T),U)};return C}getParsed(n){return this._cachedMeta._parsed[n]}getDataElement(n){return this._cachedMeta.data[n]}applyStack(n,a,h){const d=this.chart,g=this._cachedMeta,v=a[n.axis],r={keys:p1(d,!0),values:a._stacks[n.axis]._visualValues};return Sy(r,v,g.index,{mode:h})}updateRangeFromParsed(n,a,h,d){const g=h[a.axis];let v=g===null?NaN:g;const r=d&&h._stacks[a.axis];d&&r&&(d.values=r,v=Sy(d,g,this._cachedMeta.index)),n.min=Math.min(n.min,v),n.max=Math.max(n.max,v)}getMinMax(n,a){const h=this._cachedMeta,d=h._parsed,g=h._sorted&&n===h.iScale,v=d.length,r=this._getOtherScale(n),T=KT(a,h,this.chart),C={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:R,max:F}=ZT(r);let U,Y;function ie(){Y=d[U];const ce=Y[r.axis];return!Yi(Y[n.axis])||R>ce||F<ce}for(U=0;U<v&&!(!ie()&&(this.updateRangeFromParsed(C,n,Y,T),g));++U);if(g){for(U=v-1;U>=0;--U)if(!ie()){this.updateRangeFromParsed(C,n,Y,T);break}}return C}getAllParsedValues(n){const a=this._cachedMeta._parsed,h=[];let d,g,v;for(d=0,g=a.length;d<g;++d)v=a[d][n.axis],Yi(v)&&h.push(v);return h}getMaxOverflow(){return!1}getLabelAndValue(n){const a=this._cachedMeta,h=a.iScale,d=a.vScale,g=this.getParsed(n);return{label:h?""+h.getLabelForValue(g[h.axis]):"",value:d?""+d.getLabelForValue(g[d.axis]):""}}_update(n){const a=this._cachedMeta;this.update(n||"default"),a._clip=$T(Vt(this.options.clip,GT(a.xScale,a.yScale,this.getMaxOverflow())))}update(n){}draw(){const n=this._ctx,a=this.chart,h=this._cachedMeta,d=h.data||[],g=a.chartArea,v=[],r=this._drawStart||0,T=this._drawCount||d.length-r,C=this.options.drawActiveElementsOnTop;let R;for(h.dataset&&h.dataset.draw(n,g,r,T),R=r;R<r+T;++R){const F=d[R];F.hidden||(F.active&&C?v.push(F):F.draw(n,g))}for(R=0;R<v.length;++R)v[R].draw(n,g)}getStyle(n,a){const h=a?"active":"default";return n===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(h):this.resolveDataElementOptions(n||0,h)}getContext(n,a,h){const d=this.getDataset();let g;if(n>=0&&n<this._cachedMeta.data.length){const v=this._cachedMeta.data[n];g=v.$context||(v.$context=YT(this.getContext(),n,v)),g.parsed=this.getParsed(n),g.raw=d.data[n],g.index=g.dataIndex=n}else g=this.$context||(this.$context=XT(this.chart.getContext(),this.index)),g.dataset=d,g.index=g.datasetIndex=this.index;return g.active=!!a,g.mode=h,g}resolveDatasetElementOptions(n){return this._resolveElementOptions(this.datasetElementType.id,n)}resolveDataElementOptions(n,a){return this._resolveElementOptions(this.dataElementType.id,a,n)}_resolveElementOptions(n,a="default",h){const d=a==="active",g=this._cachedDataOpts,v=n+"-"+a,r=g[v],T=this.enableOptionSharing&&ru(h);if(r)return Py(r,T);const C=this.chart.config,R=C.datasetElementScopeKeys(this._type,n),F=d?[`${n}Hover`,"hover",n,""]:[n,""],U=C.getOptionScopes(this.getDataset(),R),Y=Object.keys(Ki.elements[n]),ie=()=>this.getContext(h,d,a),ce=C.resolveNamedOptions(U,Y,ie,F);return ce.$shared&&(ce.$shared=T,g[v]=Object.freeze(Py(ce,T))),ce}_resolveAnimations(n,a,h){const d=this.chart,g=this._cachedDataOpts,v=`animation-${a}`,r=g[v];if(r)return r;let T;if(d.options.animation!==!1){const R=this.chart.config,F=R.datasetAnimationScopeKeys(this._type,a),U=R.getOptionScopes(this.getDataset(),F);T=R.createResolver(U,this.getContext(n,h,a))}const C=new d1(d,T&&T.animations);return T&&T._cacheable&&(g[v]=Object.freeze(C)),C}getSharedOptions(n){if(n.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},n))}includeOptions(n,a){return!a||w_(n)||this.chart._animationsDisabled}_getSharedOptions(n,a){const h=this.resolveDataElementOptions(n,a),d=this._sharedOptions,g=this.getSharedOptions(h),v=this.includeOptions(a,g)||g!==d;return this.updateSharedOptions(g,a,h),{sharedOptions:g,includeOptions:v}}updateElement(n,a,h,d){w_(d)?Object.assign(n,h):this._resolveAnimations(a,d).update(n,h)}updateSharedOptions(n,a,h){n&&!w_(a)&&this._resolveAnimations(void 0,a).update(n,h)}_setStyle(n,a,h,d){n.active=d;const g=this.getStyle(a,d);this._resolveAnimations(a,h,d).update(n,{options:!d&&this.getSharedOptions(g)||g})}removeHoverStyle(n,a,h){this._setStyle(n,h,"active",!1)}setHoverStyle(n,a,h){this._setStyle(n,h,"active",!0)}_removeDatasetHoverStyle(){const n=this._cachedMeta.dataset;n&&this._setStyle(n,void 0,"active",!1)}_setDatasetHoverStyle(){const n=this._cachedMeta.dataset;n&&this._setStyle(n,void 0,"active",!0)}_resyncElements(n){const a=this._data,h=this._cachedMeta.data;for(const[r,T,C]of this._syncList)this[r](T,C);this._syncList=[];const d=h.length,g=a.length,v=Math.min(g,d);v&&this.parse(0,v),g>d?this._insertElements(d,g-d,n):g<d&&this._removeElements(g,d-g)}_insertElements(n,a,h=!0){const d=this._cachedMeta,g=d.data,v=n+a;let r;const T=C=>{for(C.length+=a,r=C.length-1;r>=v;r--)C[r]=C[r-a]};for(T(g),r=n;r<v;++r)g[r]=new this.dataElementType;this._parsing&&T(d._parsed),this.parse(n,a),h&&this.updateElements(g,n,a,"reset")}updateElements(n,a,h,d){}_removeElements(n,a){const h=this._cachedMeta;if(this._parsing){const d=h._parsed.splice(n,a);h._stacked&&Bh(h,d)}h.data.splice(n,a)}_sync(n){if(this._parsing)this._syncList.push(n);else{const[a,h,d]=n;this[a](h,d)}this.chart._dataChanges.push([this.index,...n])}_onDataPush(){const n=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-n,n])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(n,a){a&&this._sync(["_removeElements",n,a]);const h=arguments.length-2;h&&this._sync(["_insertElements",n,h])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ct(ws,"defaults",{}),ct(ws,"datasetElementType",null),ct(ws,"dataElementType",null);function JT(o,n){if(!o._cache.$bar){const a=o.getMatchingVisibleMetas(n);let h=[];for(let d=0,g=a.length;d<g;d++)h=h.concat(a[d].controller.getAllParsedValues(o));o._cache.$bar=Wx(h.sort((d,g)=>d-g))}return o._cache.$bar}function QT(o){const n=o.iScale,a=JT(n,o.type);let h=n._length,d,g,v,r;const T=()=>{v===32767||v===-32768||(ru(r)&&(h=Math.min(h,Math.abs(v-r)||h)),r=v)};for(d=0,g=a.length;d<g;++d)v=n.getPixelForValue(a[d]),T();for(r=void 0,d=0,g=n.ticks.length;d<g;++d)v=n.getPixelForTick(d),T();return h}function eE(o,n,a,h){const d=a.barThickness;let g,v;return ei(d)?(g=n.min*a.categoryPercentage,v=a.barPercentage):(g=d*h,v=1),{chunk:g/h,ratio:v,start:n.pixels[o]-g/2}}function tE(o,n,a,h){const d=n.pixels,g=d[o];let v=o>0?d[o-1]:null,r=o<d.length-1?d[o+1]:null;const T=a.categoryPercentage;v===null&&(v=g-(r===null?n.end-n.start:r-g)),r===null&&(r=g+g-v);const C=g-(g-Math.min(v,r))/2*T;return{chunk:Math.abs(r-v)/2*T/h,ratio:a.barPercentage,start:C}}function iE(o,n,a,h){const d=a.parse(o[0],h),g=a.parse(o[1],h),v=Math.min(d,g),r=Math.max(d,g);let T=v,C=r;Math.abs(v)>Math.abs(r)&&(T=r,C=v),n[a.axis]=C,n._custom={barStart:T,barEnd:C,start:d,end:g,min:v,max:r}}function f1(o,n,a,h){return zi(o)?iE(o,n,a,h):n[a.axis]=a.parse(o,h),n}function ky(o,n,a,h){const d=o.iScale,g=o.vScale,v=d.getLabels(),r=d===g,T=[];let C,R,F,U;for(C=a,R=a+h;C<R;++C)U=n[C],F={},F[d.axis]=r||d.parse(v[C],C),T.push(f1(U,F,g,C));return T}function T_(o){return o&&o.barStart!==void 0&&o.barEnd!==void 0}function nE(o,n,a){return o!==0?hr(o):(n.isHorizontal()?1:-1)*(n.min>=a?1:-1)}function sE(o){let n,a,h,d,g;return o.horizontal?(n=o.base>o.x,a="left",h="right"):(n=o.base<o.y,a="bottom",h="top"),n?(d="end",g="start"):(d="start",g="end"),{start:a,end:h,reverse:n,top:d,bottom:g}}function rE(o,n,a,h){let d=n.borderSkipped;const g={};if(!d){o.borderSkipped=g;return}if(d===!0){o.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:v,end:r,reverse:T,top:C,bottom:R}=sE(o);d==="middle"&&a&&(o.enableBorderRadius=!0,(a._top||0)===h?d=C:(a._bottom||0)===h?d=R:(g[Ly(R,v,r,T)]=!0,d=C)),g[Ly(d,v,r,T)]=!0,o.borderSkipped=g}function Ly(o,n,a,h){return h?(o=oE(o,n,a),o=Dy(o,a,n)):o=Dy(o,n,a),o}function oE(o,n,a){return o===n?a:o===a?n:o}function Dy(o,n,a){return o==="start"?n:o==="end"?a:o}function aE(o,{inflateAmount:n},a){o.inflateAmount=n==="auto"?a===1?.33:0:n}class sp extends ws{parsePrimitiveData(n,a,h,d){return ky(n,a,h,d)}parseArrayData(n,a,h,d){return ky(n,a,h,d)}parseObjectData(n,a,h,d){const{iScale:g,vScale:v}=n,{xAxisKey:r="x",yAxisKey:T="y"}=this._parsing,C=g.axis==="x"?r:T,R=v.axis==="x"?r:T,F=[];let U,Y,ie,ce;for(U=h,Y=h+d;U<Y;++U)ce=a[U],ie={},ie[g.axis]=g.parse(Do(ce,C),U),F.push(f1(Do(ce,R),ie,v,U));return F}updateRangeFromParsed(n,a,h,d){super.updateRangeFromParsed(n,a,h,d);const g=h._custom;g&&a===this._cachedMeta.vScale&&(n.min=Math.min(n.min,g.min),n.max=Math.max(n.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(n){const a=this._cachedMeta,{iScale:h,vScale:d}=a,g=this.getParsed(n),v=g._custom,r=T_(v)?"["+v.start+", "+v.end+"]":""+d.getLabelForValue(g[d.axis]);return{label:""+h.getLabelForValue(g[h.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const n=this._cachedMeta;n.stack=this.getDataset().stack}update(n){const a=this._cachedMeta;this.updateElements(a.data,0,a.data.length,n)}updateElements(n,a,h,d){const g=d==="reset",{index:v,_cachedMeta:{vScale:r}}=this,T=r.getBasePixel(),C=r.isHorizontal(),R=this._getRuler(),{sharedOptions:F,includeOptions:U}=this._getSharedOptions(a,d);for(let Y=a;Y<a+h;Y++){const ie=this.getParsed(Y),ce=g||ei(ie[r.axis])?{base:T,head:T}:this._calculateBarValuePixels(Y),he=this._calculateBarIndexPixels(Y,R),be=(ie._stacks||{})[r.axis],Le={horizontal:C,base:ce.base,enableBorderRadius:!be||T_(ie._custom)||v===be._top||v===be._bottom,x:C?ce.head:he.center,y:C?he.center:ce.head,height:C?he.size:Math.abs(ce.size),width:C?Math.abs(ce.size):he.size};U&&(Le.options=F||this.resolveDataElementOptions(Y,n[Y].active?"active":d));const Fe=Le.options||n[Y].options;rE(Le,Fe,be,v),aE(Le,Fe,R.ratio),this.updateElement(n[Y],Y,Le,d)}}_getStacks(n,a){const{iScale:h}=this._cachedMeta,d=h.getMatchingVisibleMetas(this._type).filter(T=>T.controller.options.grouped),g=h.options.stacked,v=[],r=T=>{const C=T.controller.getParsed(a),R=C&&C[T.vScale.axis];if(ei(R)||isNaN(R))return!0};for(const T of d)if(!(a!==void 0&&r(T))&&((g===!1||v.indexOf(T.stack)===-1||g===void 0&&T.stack===void 0)&&v.push(T.stack),T.index===n))break;return v.length||v.push(void 0),v}_getStackCount(n){return this._getStacks(void 0,n).length}_getStackIndex(n,a,h){const d=this._getStacks(n,h),g=a!==void 0?d.indexOf(a):-1;return g===-1?d.length-1:g}_getRuler(){const n=this.options,a=this._cachedMeta,h=a.iScale,d=[];let g,v;for(g=0,v=a.data.length;g<v;++g)d.push(h.getPixelForValue(this.getParsed(g)[h.axis],g));const r=n.barThickness;return{min:r||QT(a),pixels:d,start:h._startPixel,end:h._endPixel,stackCount:this._getStackCount(),scale:h,grouped:n.grouped,ratio:r?1:n.categoryPercentage*n.barPercentage}}_calculateBarValuePixels(n){const{_cachedMeta:{vScale:a,_stacked:h,index:d},options:{base:g,minBarLength:v}}=this,r=g||0,T=this.getParsed(n),C=T._custom,R=T_(C);let F=T[a.axis],U=0,Y=h?this.applyStack(a,T,h):F,ie,ce;Y!==F&&(U=Y-F,Y=F),R&&(F=C.barStart,Y=C.barEnd-C.barStart,F!==0&&hr(F)!==hr(C.barEnd)&&(U=0),U+=F);const he=!ei(g)&&!R?g:U;let be=a.getPixelForValue(he);if(this.chart.getDataVisibility(n)?ie=a.getPixelForValue(U+Y):ie=be,ce=ie-be,Math.abs(ce)<v){ce=nE(ce,a,r)*v,F===r&&(be-=ce/2);const Le=a.getPixelForDecimal(0),Fe=a.getPixelForDecimal(1),qe=Math.min(Le,Fe),Re=Math.max(Le,Fe);be=Math.max(Math.min(be,Re),qe),ie=be+ce,h&&!R&&(T._stacks[a.axis]._visualValues[d]=a.getValueForPixel(ie)-a.getValueForPixel(be))}if(be===a.getPixelForValue(r)){const Le=hr(ce)*a.getLineWidthForValue(r)/2;be+=Le,ce-=Le}return{size:ce,base:be,head:ie,center:ie+ce/2}}_calculateBarIndexPixels(n,a){const h=a.scale,d=this.options,g=d.skipNull,v=Vt(d.maxBarThickness,1/0);let r,T;if(a.grouped){const C=g?this._getStackCount(n):a.stackCount,R=d.barThickness==="flex"?tE(n,a,d,C):eE(n,a,d,C),F=this._getStackIndex(this.index,this._cachedMeta.stack,g?n:void 0);r=R.start+R.chunk*F+R.chunk/2,T=Math.min(v,R.chunk*R.ratio)}else r=h.getPixelForValue(this.getParsed(n)[h.axis],n),T=Math.min(v,a.min*a.ratio);return{base:r-T/2,head:r+T/2,center:r,size:T}}draw(){const n=this._cachedMeta,a=n.vScale,h=n.data,d=h.length;let g=0;for(;g<d;++g)this.getParsed(g)[a.axis]!==null&&h[g].draw(this._ctx)}}ct(sp,"id","bar"),ct(sp,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),ct(sp,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class rp extends ws{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(n,a,h,d){const g=super.parsePrimitiveData(n,a,h,d);for(let v=0;v<g.length;v++)g[v]._custom=this.resolveDataElementOptions(v+h).radius;return g}parseArrayData(n,a,h,d){const g=super.parseArrayData(n,a,h,d);for(let v=0;v<g.length;v++){const r=a[h+v];g[v]._custom=Vt(r[2],this.resolveDataElementOptions(v+h).radius)}return g}parseObjectData(n,a,h,d){const g=super.parseObjectData(n,a,h,d);for(let v=0;v<g.length;v++){const r=a[h+v];g[v]._custom=Vt(r&&r.r&&+r.r,this.resolveDataElementOptions(v+h).radius)}return g}getMaxOverflow(){const n=this._cachedMeta.data;let a=0;for(let h=n.length-1;h>=0;--h)a=Math.max(a,n[h].size(this.resolveDataElementOptions(h))/2);return a>0&&a}getLabelAndValue(n){const a=this._cachedMeta,h=this.chart.data.labels||[],{xScale:d,yScale:g}=a,v=this.getParsed(n),r=d.getLabelForValue(v.x),T=g.getLabelForValue(v.y),C=v._custom;return{label:h[n]||"",value:"("+r+", "+T+(C?", "+C:"")+")"}}update(n){const a=this._cachedMeta.data;this.updateElements(a,0,a.length,n)}updateElements(n,a,h,d){const g=d==="reset",{iScale:v,vScale:r}=this._cachedMeta,{sharedOptions:T,includeOptions:C}=this._getSharedOptions(a,d),R=v.axis,F=r.axis;for(let U=a;U<a+h;U++){const Y=n[U],ie=!g&&this.getParsed(U),ce={},he=ce[R]=g?v.getPixelForDecimal(.5):v.getPixelForValue(ie[R]),be=ce[F]=g?r.getBasePixel():r.getPixelForValue(ie[F]);ce.skip=isNaN(he)||isNaN(be),C&&(ce.options=T||this.resolveDataElementOptions(U,Y.active?"active":d),g&&(ce.options.radius=0)),this.updateElement(Y,U,ce,d)}}resolveDataElementOptions(n,a){const h=this.getParsed(n);let d=super.resolveDataElementOptions(n,a);d.$shared&&(d=Object.assign({},d,{$shared:!1}));const g=d.radius;return a!=="active"&&(d.radius=0),d.radius+=Vt(h&&h._custom,g),d}}ct(rp,"id","bubble"),ct(rp,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),ct(rp,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function lE(o,n,a){let h=1,d=1,g=0,v=0;if(n<Ri){const r=o,T=r+n,C=Math.cos(r),R=Math.sin(r),F=Math.cos(T),U=Math.sin(T),Y=(Fe,qe,Re)=>ou(Fe,r,T,!0)?1:Math.max(qe,qe*a,Re,Re*a),ie=(Fe,qe,Re)=>ou(Fe,r,T,!0)?-1:Math.min(qe,qe*a,Re,Re*a),ce=Y(0,C,F),he=Y(Ji,R,U),be=ie(Oi,C,F),Le=ie(Oi+Ji,R,U);h=(ce-be)/2,d=(he-Le)/2,g=-(ce+be)/2,v=-(he+Le)/2}return{ratioX:h,ratioY:d,offsetX:g,offsetY:v}}class Na extends ws{constructor(n,a){super(n,a),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(n,a){const h=this.getDataset().data,d=this._cachedMeta;if(this._parsing===!1)d._parsed=h;else{let g=T=>+h[T];if(Ht(h[n])){const{key:T="value"}=this._parsing;g=C=>+Do(h[C],T)}let v,r;for(v=n,r=n+a;v<r;++v)d._parsed[v]=g(v)}}_getRotation(){return Ws(this.options.rotation-90)}_getCircumference(){return Ws(this.options.circumference)}_getRotationExtents(){let n=Ri,a=-Ri;for(let h=0;h<this.chart.data.datasets.length;++h)if(this.chart.isDatasetVisible(h)&&this.chart.getDatasetMeta(h).type===this._type){const d=this.chart.getDatasetMeta(h).controller,g=d._getRotation(),v=d._getCircumference();n=Math.min(n,g),a=Math.max(a,g+v)}return{rotation:n,circumference:a-n}}update(n){const a=this.chart,{chartArea:h}=a,d=this._cachedMeta,g=d.data,v=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,r=Math.max((Math.min(h.width,h.height)-v)/2,0),T=Math.min(w2(this.options.cutout,r),1),C=this._getRingWeight(this.index),{circumference:R,rotation:F}=this._getRotationExtents(),{ratioX:U,ratioY:Y,offsetX:ie,offsetY:ce}=lE(F,R,T),he=(h.width-v)/U,be=(h.height-v)/Y,Le=Math.max(Math.min(he,be)/2,0),Fe=Vx(this.options.radius,Le),qe=Math.max(Fe*T,0),Re=(Fe-qe)/this._getVisibleDatasetWeightTotal();this.offsetX=ie*Fe,this.offsetY=ce*Fe,d.total=this.calculateTotal(),this.outerRadius=Fe-Re*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Re*C,0),this.updateElements(g,0,g.length,n)}_circumference(n,a){const h=this.options,d=this._cachedMeta,g=this._getCircumference();return a&&h.animation.animateRotate||!this.chart.getDataVisibility(n)||d._parsed[n]===null||d.data[n].hidden?0:this.calculateCircumference(d._parsed[n]*g/Ri)}updateElements(n,a,h,d){const g=d==="reset",v=this.chart,r=v.chartArea,C=v.options.animation,R=(r.left+r.right)/2,F=(r.top+r.bottom)/2,U=g&&C.animateScale,Y=U?0:this.innerRadius,ie=U?0:this.outerRadius,{sharedOptions:ce,includeOptions:he}=this._getSharedOptions(a,d);let be=this._getRotation(),Le;for(Le=0;Le<a;++Le)be+=this._circumference(Le,g);for(Le=a;Le<a+h;++Le){const Fe=this._circumference(Le,g),qe=n[Le],Re={x:R+this.offsetX,y:F+this.offsetY,startAngle:be,endAngle:be+Fe,circumference:Fe,outerRadius:ie,innerRadius:Y};he&&(Re.options=ce||this.resolveDataElementOptions(Le,qe.active?"active":d)),be+=Fe,this.updateElement(qe,Le,Re,d)}}calculateTotal(){const n=this._cachedMeta,a=n.data;let h=0,d;for(d=0;d<a.length;d++){const g=n._parsed[d];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(d)&&!a[d].hidden&&(h+=Math.abs(g))}return h}calculateCircumference(n){const a=this._cachedMeta.total;return a>0&&!isNaN(n)?Ri*(Math.abs(n)/a):0}getLabelAndValue(n){const a=this._cachedMeta,h=this.chart,d=h.data.labels||[],g=pu(a._parsed[n],h.options.locale);return{label:d[n]||"",value:g}}getMaxBorderWidth(n){let a=0;const h=this.chart;let d,g,v,r,T;if(!n){for(d=0,g=h.data.datasets.length;d<g;++d)if(h.isDatasetVisible(d)){v=h.getDatasetMeta(d),n=v.data,r=v.controller;break}}if(!n)return 0;for(d=0,g=n.length;d<g;++d)T=r.resolveDataElementOptions(d),T.borderAlign!=="inner"&&(a=Math.max(a,T.borderWidth||0,T.hoverBorderWidth||0));return a}getMaxOffset(n){let a=0;for(let h=0,d=n.length;h<d;++h){const g=this.resolveDataElementOptions(h);a=Math.max(a,g.offset||0,g.hoverOffset||0)}return a}_getRingWeightOffset(n){let a=0;for(let h=0;h<n;++h)this.chart.isDatasetVisible(h)&&(a+=this._getRingWeight(h));return a}_getRingWeight(n){return Math.max(Vt(this.chart.data.datasets[n].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}ct(Na,"id","doughnut"),ct(Na,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),ct(Na,"descriptors",{_scriptable:n=>n!=="spacing",_indexable:n=>n!=="spacing"&&!n.startsWith("borderDash")&&!n.startsWith("hoverBorderDash")}),ct(Na,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(n){const a=n.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:h,color:d}}=n.legend.options;return a.labels.map((g,v)=>{const T=n.getDatasetMeta(0).controller.getStyle(v);return{text:g,fillStyle:T.backgroundColor,strokeStyle:T.borderColor,fontColor:d,lineWidth:T.borderWidth,pointStyle:h,hidden:!n.getDataVisibility(v),index:v}})}return[]}},onClick(n,a,h){h.chart.toggleDataVisibility(a.index),h.chart.update()}}}});class op extends ws{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(n){const a=this._cachedMeta,{dataset:h,data:d=[],_dataset:g}=a,v=this.chart._animationsDisabled;let{start:r,count:T}=Xx(a,d,v);this._drawStart=r,this._drawCount=T,Yx(a)&&(r=0,T=d.length),h._chart=this.chart,h._datasetIndex=this.index,h._decimated=!!g._decimated,h.points=d;const C=this.resolveDatasetElementOptions(n);this.options.showLine||(C.borderWidth=0),C.segment=this.options.segment,this.updateElement(h,void 0,{animated:!v,options:C},n),this.updateElements(d,r,T,n)}updateElements(n,a,h,d){const g=d==="reset",{iScale:v,vScale:r,_stacked:T,_dataset:C}=this._cachedMeta,{sharedOptions:R,includeOptions:F}=this._getSharedOptions(a,d),U=v.axis,Y=r.axis,{spanGaps:ie,segment:ce}=this.options,he=Ql(ie)?ie:Number.POSITIVE_INFINITY,be=this.chart._animationsDisabled||g||d==="none",Le=a+h,Fe=n.length;let qe=a>0&&this.getParsed(a-1);for(let Re=0;Re<Fe;++Re){const Je=n[Re],nt=be?Je:{};if(Re<a||Re>=Le){nt.skip=!0;continue}const st=this.getParsed(Re),De=ei(st[Y]),Dt=nt[U]=v.getPixelForValue(st[U],Re),zt=nt[Y]=g||De?r.getBasePixel():r.getPixelForValue(T?this.applyStack(r,st,T):st[Y],Re);nt.skip=isNaN(Dt)||isNaN(zt)||De,nt.stop=Re>0&&Math.abs(st[U]-qe[U])>he,ce&&(nt.parsed=st,nt.raw=C.data[Re]),F&&(nt.options=R||this.resolveDataElementOptions(Re,Je.active?"active":d)),be||this.updateElement(Je,Re,nt,d),qe=st}}getMaxOverflow(){const n=this._cachedMeta,a=n.dataset,h=a.options&&a.options.borderWidth||0,d=n.data||[];if(!d.length)return h;const g=d[0].size(this.resolveDataElementOptions(0)),v=d[d.length-1].size(this.resolveDataElementOptions(d.length-1));return Math.max(h,g,v)/2}draw(){const n=this._cachedMeta;n.dataset.updateControlPoints(this.chart.chartArea,n.iScale.axis),super.draw()}}ct(op,"id","line"),ct(op,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),ct(op,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class iu extends ws{constructor(n,a){super(n,a),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(n){const a=this._cachedMeta,h=this.chart,d=h.data.labels||[],g=pu(a._parsed[n].r,h.options.locale);return{label:d[n]||"",value:g}}parseObjectData(n,a,h,d){return s1.bind(this)(n,a,h,d)}update(n){const a=this._cachedMeta.data;this._updateRadius(),this.updateElements(a,0,a.length,n)}getMinMax(){const n=this._cachedMeta,a={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return n.data.forEach((h,d)=>{const g=this.getParsed(d).r;!isNaN(g)&&this.chart.getDataVisibility(d)&&(g<a.min&&(a.min=g),g>a.max&&(a.max=g))}),a}_updateRadius(){const n=this.chart,a=n.chartArea,h=n.options,d=Math.min(a.right-a.left,a.bottom-a.top),g=Math.max(d/2,0),v=Math.max(h.cutoutPercentage?g/100*h.cutoutPercentage:1,0),r=(g-v)/n.getVisibleDatasetCount();this.outerRadius=g-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(n,a,h,d){const g=d==="reset",v=this.chart,T=v.options.animation,C=this._cachedMeta.rScale,R=C.xCenter,F=C.yCenter,U=C.getIndexAngle(0)-.5*Oi;let Y=U,ie;const ce=360/this.countVisibleElements();for(ie=0;ie<a;++ie)Y+=this._computeAngle(ie,d,ce);for(ie=a;ie<a+h;ie++){const he=n[ie];let be=Y,Le=Y+this._computeAngle(ie,d,ce),Fe=v.getDataVisibility(ie)?C.getDistanceFromCenterForValue(this.getParsed(ie).r):0;Y=Le,g&&(T.animateScale&&(Fe=0),T.animateRotate&&(be=Le=U));const qe={x:R,y:F,innerRadius:0,outerRadius:Fe,startAngle:be,endAngle:Le,options:this.resolveDataElementOptions(ie,he.active?"active":d)};this.updateElement(he,ie,qe,d)}}countVisibleElements(){const n=this._cachedMeta;let a=0;return n.data.forEach((h,d)=>{!isNaN(this.getParsed(d).r)&&this.chart.getDataVisibility(d)&&a++}),a}_computeAngle(n,a,h){return this.chart.getDataVisibility(n)?Ws(this.resolveDataElementOptions(n,a).angle||h):0}}ct(iu,"id","polarArea"),ct(iu,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),ct(iu,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(n){const a=n.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:h,color:d}}=n.legend.options;return a.labels.map((g,v)=>{const T=n.getDatasetMeta(0).controller.getStyle(v);return{text:g,fillStyle:T.backgroundColor,strokeStyle:T.borderColor,fontColor:d,lineWidth:T.borderWidth,pointStyle:h,hidden:!n.getDataVisibility(v),index:v}})}return[]}},onClick(n,a,h){h.chart.toggleDataVisibility(a.index),h.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class G_ extends Na{}ct(G_,"id","pie"),ct(G_,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class ap extends ws{getLabelAndValue(n){const a=this._cachedMeta.vScale,h=this.getParsed(n);return{label:a.getLabels()[n],value:""+a.getLabelForValue(h[a.axis])}}parseObjectData(n,a,h,d){return s1.bind(this)(n,a,h,d)}update(n){const a=this._cachedMeta,h=a.dataset,d=a.data||[],g=a.iScale.getLabels();if(h.points=d,n!=="resize"){const v=this.resolveDatasetElementOptions(n);this.options.showLine||(v.borderWidth=0);const r={_loop:!0,_fullLoop:g.length===d.length,options:v};this.updateElement(h,void 0,r,n)}this.updateElements(d,0,d.length,n)}updateElements(n,a,h,d){const g=this._cachedMeta.rScale,v=d==="reset";for(let r=a;r<a+h;r++){const T=n[r],C=this.resolveDataElementOptions(r,T.active?"active":d),R=g.getPointPositionForValue(r,this.getParsed(r).r),F=v?g.xCenter:R.x,U=v?g.yCenter:R.y,Y={x:F,y:U,angle:R.angle,skip:isNaN(F)||isNaN(U),options:C};this.updateElement(T,r,Y,d)}}}ct(ap,"id","radar"),ct(ap,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),ct(ap,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class lp extends ws{getLabelAndValue(n){const a=this._cachedMeta,h=this.chart.data.labels||[],{xScale:d,yScale:g}=a,v=this.getParsed(n),r=d.getLabelForValue(v.x),T=g.getLabelForValue(v.y);return{label:h[n]||"",value:"("+r+", "+T+")"}}update(n){const a=this._cachedMeta,{data:h=[]}=a,d=this.chart._animationsDisabled;let{start:g,count:v}=Xx(a,h,d);if(this._drawStart=g,this._drawCount=v,Yx(a)&&(g=0,v=h.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:T}=a;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!T._decimated,r.points=h;const C=this.resolveDatasetElementOptions(n);C.segment=this.options.segment,this.updateElement(r,void 0,{animated:!d,options:C},n)}else this.datasetElementType&&(delete a.dataset,this.datasetElementType=!1);this.updateElements(h,g,v,n)}addElements(){const{showLine:n}=this.options;!this.datasetElementType&&n&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(n,a,h,d){const g=d==="reset",{iScale:v,vScale:r,_stacked:T,_dataset:C}=this._cachedMeta,R=this.resolveDataElementOptions(a,d),F=this.getSharedOptions(R),U=this.includeOptions(d,F),Y=v.axis,ie=r.axis,{spanGaps:ce,segment:he}=this.options,be=Ql(ce)?ce:Number.POSITIVE_INFINITY,Le=this.chart._animationsDisabled||g||d==="none";let Fe=a>0&&this.getParsed(a-1);for(let qe=a;qe<a+h;++qe){const Re=n[qe],Je=this.getParsed(qe),nt=Le?Re:{},st=ei(Je[ie]),De=nt[Y]=v.getPixelForValue(Je[Y],qe),Dt=nt[ie]=g||st?r.getBasePixel():r.getPixelForValue(T?this.applyStack(r,Je,T):Je[ie],qe);nt.skip=isNaN(De)||isNaN(Dt)||st,nt.stop=qe>0&&Math.abs(Je[Y]-Fe[Y])>be,he&&(nt.parsed=Je,nt.raw=C.data[qe]),U&&(nt.options=F||this.resolveDataElementOptions(qe,Re.active?"active":d)),Le||this.updateElement(Re,qe,nt,d),Fe=Je}this.updateSharedOptions(F,d,R)}getMaxOverflow(){const n=this._cachedMeta,a=n.data||[];if(!this.options.showLine){let r=0;for(let T=a.length-1;T>=0;--T)r=Math.max(r,a[T].size(this.resolveDataElementOptions(T))/2);return r>0&&r}const h=n.dataset,d=h.options&&h.options.borderWidth||0;if(!a.length)return d;const g=a[0].size(this.resolveDataElementOptions(0)),v=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(d,g,v)/2}}ct(lp,"id","scatter"),ct(lp,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),ct(lp,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var cE=Object.freeze({__proto__:null,BarController:sp,BubbleController:rp,DoughnutController:Na,LineController:op,PieController:G_,PolarAreaController:iu,RadarController:ap,ScatterController:lp});function La(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class gm{constructor(n){ct(this,"options");this.options=n||{}}static override(n){Object.assign(gm.prototype,n)}init(){}formats(){return La()}parse(){return La()}format(){return La()}add(){return La()}diff(){return La()}startOf(){return La()}endOf(){return La()}}var hE={_date:gm};function uE(o,n,a,h){const{controller:d,data:g,_sorted:v}=o,r=d._cachedMeta.iScale;if(r&&n===r.axis&&n!=="r"&&v&&g.length){const T=r._reversePixels?z2:Nr;if(h){if(d._sharedOptions){const C=g[0],R=typeof C.getRange=="function"&&C.getRange(n);if(R){const F=T(g,n,a-R),U=T(g,n,a+R);return{lo:F.lo,hi:U.hi}}}}else return T(g,n,a)}return{lo:0,hi:g.length-1}}function fu(o,n,a,h,d){const g=o.getSortedVisibleDatasetMetas(),v=a[n];for(let r=0,T=g.length;r<T;++r){const{index:C,data:R}=g[r],{lo:F,hi:U}=uE(g[r],n,v,d);for(let Y=F;Y<=U;++Y){const ie=R[Y];ie.skip||h(ie,C,Y)}}}function dE(o){const n=o.indexOf("x")!==-1,a=o.indexOf("y")!==-1;return function(h,d){const g=n?Math.abs(h.x-d.x):0,v=a?Math.abs(h.y-d.y):0;return Math.sqrt(Math.pow(g,2)+Math.pow(v,2))}}function E_(o,n,a,h,d){const g=[];return!d&&!o.isPointInArea(n)||fu(o,a,n,function(r,T,C){!d&&!jr(r,o.chartArea,0)||r.inRange(n.x,n.y,h)&&g.push({element:r,datasetIndex:T,index:C})},!0),g}function pE(o,n,a,h){let d=[];function g(v,r,T){const{startAngle:C,endAngle:R}=v.getProps(["startAngle","endAngle"],h),{angle:F}=$x(v,{x:n.x,y:n.y});ou(F,C,R)&&d.push({element:v,datasetIndex:r,index:T})}return fu(o,a,n,g),d}function fE(o,n,a,h,d,g){let v=[];const r=dE(a);let T=Number.POSITIVE_INFINITY;function C(R,F,U){const Y=R.inRange(n.x,n.y,d);if(h&&!Y)return;const ie=R.getCenterPoint(d);if(!(!!g||o.isPointInArea(ie))&&!Y)return;const he=r(n,ie);he<T?(v=[{element:R,datasetIndex:F,index:U}],T=he):he===T&&v.push({element:R,datasetIndex:F,index:U})}return fu(o,a,n,C),v}function M_(o,n,a,h,d,g){return!g&&!o.isPointInArea(n)?[]:a==="r"&&!h?pE(o,n,a,d):fE(o,n,a,h,d,g)}function zy(o,n,a,h,d){const g=[],v=a==="x"?"inXRange":"inYRange";let r=!1;return fu(o,a,n,(T,C,R)=>{T[v](n[a],d)&&(g.push({element:T,datasetIndex:C,index:R}),r=r||T.inRange(n.x,n.y,d))}),h&&!r?[]:g}var _E={evaluateInteractionItems:fu,modes:{index(o,n,a,h){const d=Oa(n,o),g=a.axis||"x",v=a.includeInvisible||!1,r=a.intersect?E_(o,d,g,h,v):M_(o,d,g,!1,h,v),T=[];return r.length?(o.getSortedVisibleDatasetMetas().forEach(C=>{const R=r[0].index,F=C.data[R];F&&!F.skip&&T.push({element:F,datasetIndex:C.index,index:R})}),T):[]},dataset(o,n,a,h){const d=Oa(n,o),g=a.axis||"xy",v=a.includeInvisible||!1;let r=a.intersect?E_(o,d,g,h,v):M_(o,d,g,!1,h,v);if(r.length>0){const T=r[0].datasetIndex,C=o.getDatasetMeta(T).data;r=[];for(let R=0;R<C.length;++R)r.push({element:C[R],datasetIndex:T,index:R})}return r},point(o,n,a,h){const d=Oa(n,o),g=a.axis||"xy",v=a.includeInvisible||!1;return E_(o,d,g,h,v)},nearest(o,n,a,h){const d=Oa(n,o),g=a.axis||"xy",v=a.includeInvisible||!1;return M_(o,d,g,a.intersect,h,v)},x(o,n,a,h){const d=Oa(n,o);return zy(o,d,"x",a.intersect,h)},y(o,n,a,h){const d=Oa(n,o);return zy(o,d,"y",a.intersect,h)}}};const _1=["left","top","right","bottom"];function Fh(o,n){return o.filter(a=>a.pos===n)}function Ry(o,n){return o.filter(a=>_1.indexOf(a.pos)===-1&&a.box.axis===n)}function Nh(o,n){return o.sort((a,h)=>{const d=n?h:a,g=n?a:h;return d.weight===g.weight?d.index-g.index:d.weight-g.weight})}function mE(o){const n=[];let a,h,d,g,v,r;for(a=0,h=(o||[]).length;a<h;++a)d=o[a],{position:g,options:{stack:v,stackWeight:r=1}}=d,n.push({index:a,box:d,pos:g,horizontal:d.isHorizontal(),weight:d.weight,stack:v&&g+v,stackWeight:r});return n}function gE(o){const n={};for(const a of o){const{stack:h,pos:d,stackWeight:g}=a;if(!h||!_1.includes(d))continue;const v=n[h]||(n[h]={count:0,placed:0,weight:0,size:0});v.count++,v.weight+=g}return n}function yE(o,n){const a=gE(o),{vBoxMaxWidth:h,hBoxMaxHeight:d}=n;let g,v,r;for(g=0,v=o.length;g<v;++g){r=o[g];const{fullSize:T}=r.box,C=a[r.stack],R=C&&r.stackWeight/C.weight;r.horizontal?(r.width=R?R*h:T&&n.availableWidth,r.height=d):(r.width=h,r.height=R?R*d:T&&n.availableHeight)}return a}function xE(o){const n=mE(o),a=Nh(n.filter(C=>C.box.fullSize),!0),h=Nh(Fh(n,"left"),!0),d=Nh(Fh(n,"right")),g=Nh(Fh(n,"top"),!0),v=Nh(Fh(n,"bottom")),r=Ry(n,"x"),T=Ry(n,"y");return{fullSize:a,leftAndTop:h.concat(g),rightAndBottom:d.concat(T).concat(v).concat(r),chartArea:Fh(n,"chartArea"),vertical:h.concat(d).concat(T),horizontal:g.concat(v).concat(r)}}function Oy(o,n,a,h){return Math.max(o[a],n[a])+Math.max(o[h],n[h])}function m1(o,n){o.top=Math.max(o.top,n.top),o.left=Math.max(o.left,n.left),o.bottom=Math.max(o.bottom,n.bottom),o.right=Math.max(o.right,n.right)}function vE(o,n,a,h){const{pos:d,box:g}=a,v=o.maxPadding;if(!Ht(d)){a.size&&(o[d]-=a.size);const F=h[a.stack]||{size:0,count:1};F.size=Math.max(F.size,a.horizontal?g.height:g.width),a.size=F.size/F.count,o[d]+=a.size}g.getPadding&&m1(v,g.getPadding());const r=Math.max(0,n.outerWidth-Oy(v,o,"left","right")),T=Math.max(0,n.outerHeight-Oy(v,o,"top","bottom")),C=r!==o.w,R=T!==o.h;return o.w=r,o.h=T,a.horizontal?{same:C,other:R}:{same:R,other:C}}function bE(o){const n=o.maxPadding;function a(h){const d=Math.max(n[h]-o[h],0);return o[h]+=d,d}o.y+=a("top"),o.x+=a("left"),a("right"),a("bottom")}function wE(o,n){const a=n.maxPadding;function h(d){const g={left:0,top:0,right:0,bottom:0};return d.forEach(v=>{g[v]=Math.max(n[v],a[v])}),g}return h(o?["left","right"]:["top","bottom"])}function qh(o,n,a,h){const d=[];let g,v,r,T,C,R;for(g=0,v=o.length,C=0;g<v;++g){r=o[g],T=r.box,T.update(r.width||n.w,r.height||n.h,wE(r.horizontal,n));const{same:F,other:U}=vE(n,a,r,h);C|=F&&d.length,R=R||U,T.fullSize||d.push(r)}return C&&qh(d,n,a,h)||R}function Wd(o,n,a,h,d){o.top=a,o.left=n,o.right=n+h,o.bottom=a+d,o.width=h,o.height=d}function By(o,n,a,h){const d=a.padding;let{x:g,y:v}=n;for(const r of o){const T=r.box,C=h[r.stack]||{count:1,placed:0,weight:1},R=r.stackWeight/C.weight||1;if(r.horizontal){const F=n.w*R,U=C.size||T.height;ru(C.start)&&(v=C.start),T.fullSize?Wd(T,d.left,v,a.outerWidth-d.right-d.left,U):Wd(T,n.left+C.placed,v,F,U),C.start=v,C.placed+=F,v=T.bottom}else{const F=n.h*R,U=C.size||T.width;ru(C.start)&&(g=C.start),T.fullSize?Wd(T,g,d.top,U,a.outerHeight-d.bottom-d.top):Wd(T,g,n.top+C.placed,U,F),C.start=g,C.placed+=F,g=T.right}}n.x=g,n.y=v}var kn={addBox(o,n){o.boxes||(o.boxes=[]),n.fullSize=n.fullSize||!1,n.position=n.position||"top",n.weight=n.weight||0,n._layers=n._layers||function(){return[{z:0,draw(a){n.draw(a)}}]},o.boxes.push(n)},removeBox(o,n){const a=o.boxes?o.boxes.indexOf(n):-1;a!==-1&&o.boxes.splice(a,1)},configure(o,n,a){n.fullSize=a.fullSize,n.position=a.position,n.weight=a.weight},update(o,n,a,h){if(!o)return;const d=Ln(o.options.layout.padding),g=Math.max(n-d.width,0),v=Math.max(a-d.height,0),r=xE(o.boxes),T=r.vertical,C=r.horizontal;yi(o.boxes,ce=>{typeof ce.beforeLayout=="function"&&ce.beforeLayout()});const R=T.reduce((ce,he)=>he.box.options&&he.box.options.display===!1?ce:ce+1,0)||1,F=Object.freeze({outerWidth:n,outerHeight:a,padding:d,availableWidth:g,availableHeight:v,vBoxMaxWidth:g/2/R,hBoxMaxHeight:v/2}),U=Object.assign({},d);m1(U,Ln(h));const Y=Object.assign({maxPadding:U,w:g,h:v,x:d.left,y:d.top},d),ie=yE(T.concat(C),F);qh(r.fullSize,Y,F,ie),qh(T,Y,F,ie),qh(C,Y,F,ie)&&qh(T,Y,F,ie),bE(Y),By(r.leftAndTop,Y,F,ie),Y.x+=Y.w,Y.y+=Y.h,By(r.rightAndBottom,Y,F,ie),o.chartArea={left:Y.left,top:Y.top,right:Y.left+Y.w,bottom:Y.top+Y.h,height:Y.h,width:Y.w},yi(r.chartArea,ce=>{const he=ce.box;Object.assign(he,o.chartArea),he.update(Y.w,Y.h,{left:0,top:0,right:0,bottom:0})})}};class g1{acquireContext(n,a){}releaseContext(n){return!1}addEventListener(n,a,h){}removeEventListener(n,a,h){}getDevicePixelRatio(){return 1}getMaximumSize(n,a,h,d){return a=Math.max(0,a||n.width),h=h||n.height,{width:a,height:Math.max(0,d?Math.floor(a/d):h)}}isAttached(n){return!0}updateConfig(n){}}class TE extends g1{acquireContext(n){return n&&n.getContext&&n.getContext("2d")||null}updateConfig(n){n.options.animation=!1}}const cp="$chartjs",EE={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Fy=o=>o===null||o==="";function ME(o,n){const a=o.style,h=o.getAttribute("height"),d=o.getAttribute("width");if(o[cp]={initial:{height:h,width:d,style:{display:a.display,height:a.height,width:a.width}}},a.display=a.display||"block",a.boxSizing=a.boxSizing||"border-box",Fy(d)){const g=vy(o,"width");g!==void 0&&(o.width=g)}if(Fy(h))if(o.style.height==="")o.height=o.width/(n||2);else{const g=vy(o,"height");g!==void 0&&(o.height=g)}return o}const y1=AT?{passive:!0}:!1;function SE(o,n,a){o.addEventListener(n,a,y1)}function AE(o,n,a){o.canvas.removeEventListener(n,a,y1)}function IE(o,n){const a=EE[o.type]||o.type,{x:h,y:d}=Oa(o,n);return{type:a,chart:n,native:o,x:h!==void 0?h:null,y:d!==void 0?d:null}}function Ep(o,n){for(const a of o)if(a===n||a.contains(n))return!0}function CE(o,n,a){const h=o.canvas,d=new MutationObserver(g=>{let v=!1;for(const r of g)v=v||Ep(r.addedNodes,h),v=v&&!Ep(r.removedNodes,h);v&&a()});return d.observe(document,{childList:!0,subtree:!0}),d}function PE(o,n,a){const h=o.canvas,d=new MutationObserver(g=>{let v=!1;for(const r of g)v=v||Ep(r.removedNodes,h),v=v&&!Ep(r.addedNodes,h);v&&a()});return d.observe(document,{childList:!0,subtree:!0}),d}const au=new Map;let Ny=0;function x1(){const o=window.devicePixelRatio;o!==Ny&&(Ny=o,au.forEach((n,a)=>{a.currentDevicePixelRatio!==o&&n()}))}function kE(o,n){au.size||window.addEventListener("resize",x1),au.set(o,n)}function LE(o){au.delete(o),au.size||window.removeEventListener("resize",x1)}function DE(o,n,a){const h=o.canvas,d=h&&mm(h);if(!d)return;const g=Hx((r,T)=>{const C=d.clientWidth;a(r,T),C<d.clientWidth&&a()},window),v=new ResizeObserver(r=>{const T=r[0],C=T.contentRect.width,R=T.contentRect.height;C===0&&R===0||g(C,R)});return v.observe(d),kE(o,g),v}function S_(o,n,a){a&&a.disconnect(),n==="resize"&&LE(o)}function zE(o,n,a){const h=o.canvas,d=Hx(g=>{o.ctx!==null&&a(IE(g,o))},o);return SE(h,n,d),d}class RE extends g1{acquireContext(n,a){const h=n&&n.getContext&&n.getContext("2d");return h&&h.canvas===n?(ME(n,a),h):null}releaseContext(n){const a=n.canvas;if(!a[cp])return!1;const h=a[cp].initial;["height","width"].forEach(g=>{const v=h[g];ei(v)?a.removeAttribute(g):a.setAttribute(g,v)});const d=h.style||{};return Object.keys(d).forEach(g=>{a.style[g]=d[g]}),a.width=a.width,delete a[cp],!0}addEventListener(n,a,h){this.removeEventListener(n,a);const d=n.$proxies||(n.$proxies={}),v={attach:CE,detach:PE,resize:DE}[a]||zE;d[a]=v(n,a,h)}removeEventListener(n,a){const h=n.$proxies||(n.$proxies={}),d=h[a];if(!d)return;({attach:S_,detach:S_,resize:S_}[a]||AE)(n,a,d),h[a]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(n,a,h,d){return ST(n,a,h,d)}isAttached(n){const a=mm(n);return!!(a&&a.isConnected)}}function OE(o){return!o1()||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas?TE:RE}class Ts{constructor(){ct(this,"x");ct(this,"y");ct(this,"active",!1);ct(this,"options");ct(this,"$animations")}tooltipPosition(n){const{x:a,y:h}=this.getProps(["x","y"],n);return{x:a,y:h}}hasValue(){return Ql(this.x)&&Ql(this.y)}getProps(n,a){const h=this.$animations;if(!a||!h)return this;const d={};return n.forEach(g=>{d[g]=h[g]&&h[g].active()?h[g]._to:this[g]}),d}}ct(Ts,"defaults",{}),ct(Ts,"defaultRoutes");function BE(o,n){const a=o.options.ticks,h=FE(o),d=Math.min(a.maxTicksLimit||h,h),g=a.major.enabled?jE(n):[],v=g.length,r=g[0],T=g[v-1],C=[];if(v>d)return VE(n,C,g,v/d),C;const R=NE(g,n,d);if(v>0){let F,U;const Y=v>1?Math.round((T-r)/(v-1)):null;for(Zd(n,C,R,ei(Y)?0:r-Y,r),F=0,U=v-1;F<U;F++)Zd(n,C,R,g[F],g[F+1]);return Zd(n,C,R,T,ei(Y)?n.length:T+Y),C}return Zd(n,C,R),C}function FE(o){const n=o.options.offset,a=o._tickSize(),h=o._length/a+(n?0:1),d=o._maxLength/a;return Math.floor(Math.min(h,d))}function NE(o,n,a){const h=UE(o),d=n.length/a;if(!h)return Math.max(d,1);const g=P2(h);for(let v=0,r=g.length-1;v<r;v++){const T=g[v];if(T>d)return T}return Math.max(d,1)}function jE(o){const n=[];let a,h;for(a=0,h=o.length;a<h;a++)o[a].major&&n.push(a);return n}function VE(o,n,a,h){let d=0,g=a[0],v;for(h=Math.ceil(h),v=0;v<o.length;v++)v===g&&(n.push(o[v]),d++,g=a[d*h])}function Zd(o,n,a,h,d){const g=Vt(h,0),v=Math.min(Vt(d,o.length),o.length);let r=0,T,C,R;for(a=Math.ceil(a),d&&(T=d-h,a=T/Math.floor(T/a)),R=g;R<0;)r++,R=Math.round(g+r*a);for(C=Math.max(g,0);C<v;C++)C===R&&(n.push(o[C]),r++,R=Math.round(g+r*a))}function UE(o){const n=o.length;let a,h;if(n<2)return!1;for(h=o[0],a=1;a<n;++a)if(o[a]-o[a-1]!==h)return!1;return h}const GE=o=>o==="left"?"right":o==="right"?"left":o,jy=(o,n,a)=>n==="top"||n==="left"?o[n]+a:o[n]-a,Vy=(o,n)=>Math.min(n||o,o);function Uy(o,n){const a=[],h=o.length/n,d=o.length;let g=0;for(;g<d;g+=h)a.push(o[Math.floor(g)]);return a}function $E(o,n,a){const h=o.ticks.length,d=Math.min(n,h-1),g=o._startPixel,v=o._endPixel,r=1e-6;let T=o.getPixelForTick(d),C;if(!(a&&(h===1?C=Math.max(T-g,v-T):n===0?C=(o.getPixelForTick(1)-T)/2:C=(T-o.getPixelForTick(d-1))/2,T+=d<n?C:-C,T<g-r||T>v+r)))return T}function qE(o,n){yi(o,a=>{const h=a.gc,d=h.length/2;let g;if(d>n){for(g=0;g<d;++g)delete a.data[h[g]];h.splice(0,d)}})}function jh(o){return o.drawTicks?o.tickLength:0}function Gy(o,n){if(!o.display)return 0;const a=hn(o.font,n),h=Ln(o.padding);return(zi(o.text)?o.text.length:1)*a.lineHeight+h.height}function WE(o,n){return Bo(o,{scale:n,type:"scale"})}function ZE(o,n,a){return Bo(o,{tick:a,index:n,type:"tick"})}function HE(o,n,a){let h=hm(o);return(a&&n!=="right"||!a&&n==="right")&&(h=GE(h)),h}function XE(o,n,a,h){const{top:d,left:g,bottom:v,right:r,chart:T}=o,{chartArea:C,scales:R}=T;let F=0,U,Y,ie;const ce=v-d,he=r-g;if(o.isHorizontal()){if(Y=Pn(h,g,r),Ht(a)){const be=Object.keys(a)[0],Le=a[be];ie=R[be].getPixelForValue(Le)+ce-n}else a==="center"?ie=(C.bottom+C.top)/2+ce-n:ie=jy(o,a,n);U=r-g}else{if(Ht(a)){const be=Object.keys(a)[0],Le=a[be];Y=R[be].getPixelForValue(Le)-he+n}else a==="center"?Y=(C.left+C.right)/2-he+n:Y=jy(o,a,n);ie=Pn(h,v,d),F=a==="left"?-Ji:Ji}return{titleX:Y,titleY:ie,maxWidth:U,rotation:F}}class Ga extends Ts{constructor(n){super(),this.id=n.id,this.type=n.type,this.options=void 0,this.ctx=n.ctx,this.chart=n.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(n){this.options=n.setContext(this.getContext()),this.axis=n.axis,this._userMin=this.parse(n.min),this._userMax=this.parse(n.max),this._suggestedMin=this.parse(n.suggestedMin),this._suggestedMax=this.parse(n.suggestedMax)}parse(n,a){return n}getUserBounds(){let{_userMin:n,_userMax:a,_suggestedMin:h,_suggestedMax:d}=this;return n=as(n,Number.POSITIVE_INFINITY),a=as(a,Number.NEGATIVE_INFINITY),h=as(h,Number.POSITIVE_INFINITY),d=as(d,Number.NEGATIVE_INFINITY),{min:as(n,h),max:as(a,d),minDefined:Yi(n),maxDefined:Yi(a)}}getMinMax(n){let{min:a,max:h,minDefined:d,maxDefined:g}=this.getUserBounds(),v;if(d&&g)return{min:a,max:h};const r=this.getMatchingVisibleMetas();for(let T=0,C=r.length;T<C;++T)v=r[T].controller.getMinMax(this,n),d||(a=Math.min(a,v.min)),g||(h=Math.max(h,v.max));return a=g&&a>h?h:a,h=d&&a>h?a:h,{min:as(a,as(h,a)),max:as(h,as(a,h))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const n=this.chart.data;return this.options.labels||(this.isHorizontal()?n.xLabels:n.yLabels)||n.labels||[]}getLabelItems(n=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(n))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ii(this.options.beforeUpdate,[this])}update(n,a,h){const{beginAtZero:d,grace:g,ticks:v}=this.options,r=v.sampleSize;this.beforeUpdate(),this.maxWidth=n,this.maxHeight=a,this._margins=h=Object.assign({left:0,right:0,top:0,bottom:0},h),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+h.left+h.right:this.height+h.top+h.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=sT(this,g,d),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const T=r<this.ticks.length;this._convertTicksToLabels(T?Uy(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),v.display&&(v.autoSkip||v.source==="auto")&&(this.ticks=BE(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),T&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let n=this.options.reverse,a,h;this.isHorizontal()?(a=this.left,h=this.right):(a=this.top,h=this.bottom,n=!n),this._startPixel=a,this._endPixel=h,this._reversePixels=n,this._length=h-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ii(this.options.afterUpdate,[this])}beforeSetDimensions(){Ii(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ii(this.options.afterSetDimensions,[this])}_callHooks(n){this.chart.notifyPlugins(n,this.getContext()),Ii(this.options[n],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ii(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(n){const a=this.options.ticks;let h,d,g;for(h=0,d=n.length;h<d;h++)g=n[h],g.label=Ii(a.callback,[g.value,h,n],this)}afterTickToLabelConversion(){Ii(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ii(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const n=this.options,a=n.ticks,h=Vy(this.ticks.length,n.ticks.maxTicksLimit),d=a.minRotation||0,g=a.maxRotation;let v=d,r,T,C;if(!this._isVisible()||!a.display||d>=g||h<=1||!this.isHorizontal()){this.labelRotation=d;return}const R=this._getLabelSizes(),F=R.widest.width,U=R.highest.height,Y=mn(this.chart.width-F,0,this.maxWidth);r=n.offset?this.maxWidth/h:Y/(h-1),F+6>r&&(r=Y/(h-(n.offset?.5:1)),T=this.maxHeight-jh(n.grid)-a.padding-Gy(n.title,this.chart.options.font),C=Math.sqrt(F*F+U*U),v=lm(Math.min(Math.asin(mn((R.highest.height+6)/r,-1,1)),Math.asin(mn(T/C,-1,1))-Math.asin(mn(U/C,-1,1)))),v=Math.max(d,Math.min(g,v))),this.labelRotation=v}afterCalculateLabelRotation(){Ii(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ii(this.options.beforeFit,[this])}fit(){const n={width:0,height:0},{chart:a,options:{ticks:h,title:d,grid:g}}=this,v=this._isVisible(),r=this.isHorizontal();if(v){const T=Gy(d,a.options.font);if(r?(n.width=this.maxWidth,n.height=jh(g)+T):(n.height=this.maxHeight,n.width=jh(g)+T),h.display&&this.ticks.length){const{first:C,last:R,widest:F,highest:U}=this._getLabelSizes(),Y=h.padding*2,ie=Ws(this.labelRotation),ce=Math.cos(ie),he=Math.sin(ie);if(r){const be=h.mirror?0:he*F.width+ce*U.height;n.height=Math.min(this.maxHeight,n.height+be+Y)}else{const be=h.mirror?0:ce*F.width+he*U.height;n.width=Math.min(this.maxWidth,n.width+be+Y)}this._calculatePadding(C,R,he,ce)}}this._handleMargins(),r?(this.width=this._length=a.width-this._margins.left-this._margins.right,this.height=n.height):(this.width=n.width,this.height=this._length=a.height-this._margins.top-this._margins.bottom)}_calculatePadding(n,a,h,d){const{ticks:{align:g,padding:v},position:r}=this.options,T=this.labelRotation!==0,C=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const R=this.getPixelForTick(0)-this.left,F=this.right-this.getPixelForTick(this.ticks.length-1);let U=0,Y=0;T?C?(U=d*n.width,Y=h*a.height):(U=h*n.height,Y=d*a.width):g==="start"?Y=a.width:g==="end"?U=n.width:g!=="inner"&&(U=n.width/2,Y=a.width/2),this.paddingLeft=Math.max((U-R+v)*this.width/(this.width-R),0),this.paddingRight=Math.max((Y-F+v)*this.width/(this.width-F),0)}else{let R=a.height/2,F=n.height/2;g==="start"?(R=0,F=n.height):g==="end"&&(R=a.height,F=0),this.paddingTop=R+v,this.paddingBottom=F+v}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ii(this.options.afterFit,[this])}isHorizontal(){const{axis:n,position:a}=this.options;return a==="top"||a==="bottom"||n==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(n){this.beforeTickToLabelConversion(),this.generateTickLabels(n);let a,h;for(a=0,h=n.length;a<h;a++)ei(n[a].label)&&(n.splice(a,1),h--,a--);this.afterTickToLabelConversion()}_getLabelSizes(){let n=this._labelSizes;if(!n){const a=this.options.ticks.sampleSize;let h=this.ticks;a<h.length&&(h=Uy(h,a)),this._labelSizes=n=this._computeLabelSizes(h,h.length,this.options.ticks.maxTicksLimit)}return n}_computeLabelSizes(n,a,h){const{ctx:d,_longestTextCache:g}=this,v=[],r=[],T=Math.floor(a/Vy(a,h));let C=0,R=0,F,U,Y,ie,ce,he,be,Le,Fe,qe,Re;for(F=0;F<a;F+=T){if(ie=n[F].label,ce=this._resolveTickFontOptions(F),d.font=he=ce.string,be=g[he]=g[he]||{data:{},gc:[]},Le=ce.lineHeight,Fe=qe=0,!ei(ie)&&!zi(ie))Fe=wp(d,be.data,be.gc,Fe,ie),qe=Le;else if(zi(ie))for(U=0,Y=ie.length;U<Y;++U)Re=ie[U],!ei(Re)&&!zi(Re)&&(Fe=wp(d,be.data,be.gc,Fe,Re),qe+=Le);v.push(Fe),r.push(qe),C=Math.max(Fe,C),R=Math.max(qe,R)}qE(g,a);const Je=v.indexOf(C),nt=r.indexOf(R),st=De=>({width:v[De]||0,height:r[De]||0});return{first:st(0),last:st(a-1),widest:st(Je),highest:st(nt),widths:v,heights:r}}getLabelForValue(n){return n}getPixelForValue(n,a){return NaN}getValueForPixel(n){}getPixelForTick(n){const a=this.ticks;return n<0||n>a.length-1?null:this.getPixelForValue(a[n].value)}getPixelForDecimal(n){this._reversePixels&&(n=1-n);const a=this._startPixel+n*this._length;return D2(this._alignToPixels?ka(this.chart,a,0):a)}getDecimalForPixel(n){const a=(n-this._startPixel)/this._length;return this._reversePixels?1-a:a}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:n,max:a}=this;return n<0&&a<0?a:n>0&&a>0?n:0}getContext(n){const a=this.ticks||[];if(n>=0&&n<a.length){const h=a[n];return h.$context||(h.$context=ZE(this.getContext(),n,h))}return this.$context||(this.$context=WE(this.chart.getContext(),this))}_tickSize(){const n=this.options.ticks,a=Ws(this.labelRotation),h=Math.abs(Math.cos(a)),d=Math.abs(Math.sin(a)),g=this._getLabelSizes(),v=n.autoSkipPadding||0,r=g?g.widest.width+v:0,T=g?g.highest.height+v:0;return this.isHorizontal()?T*h>r*d?r/h:T/d:T*d<r*h?T/h:r/d}_isVisible(){const n=this.options.display;return n!=="auto"?!!n:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(n){const a=this.axis,h=this.chart,d=this.options,{grid:g,position:v,border:r}=d,T=g.offset,C=this.isHorizontal(),F=this.ticks.length+(T?1:0),U=jh(g),Y=[],ie=r.setContext(this.getContext()),ce=ie.display?ie.width:0,he=ce/2,be=function(ti){return ka(h,ti,ce)};let Le,Fe,qe,Re,Je,nt,st,De,Dt,zt,ft,Gt;if(v==="top")Le=be(this.bottom),nt=this.bottom-U,De=Le-he,zt=be(n.top)+he,Gt=n.bottom;else if(v==="bottom")Le=be(this.top),zt=n.top,Gt=be(n.bottom)-he,nt=Le+he,De=this.top+U;else if(v==="left")Le=be(this.right),Je=this.right-U,st=Le-he,Dt=be(n.left)+he,ft=n.right;else if(v==="right")Le=be(this.left),Dt=n.left,ft=be(n.right)-he,Je=Le+he,st=this.left+U;else if(a==="x"){if(v==="center")Le=be((n.top+n.bottom)/2+.5);else if(Ht(v)){const ti=Object.keys(v)[0],xi=v[ti];Le=be(this.chart.scales[ti].getPixelForValue(xi))}zt=n.top,Gt=n.bottom,nt=Le+he,De=nt+U}else if(a==="y"){if(v==="center")Le=be((n.left+n.right)/2);else if(Ht(v)){const ti=Object.keys(v)[0],xi=v[ti];Le=be(this.chart.scales[ti].getPixelForValue(xi))}Je=Le-he,st=Je-U,Dt=n.left,ft=n.right}const on=Vt(d.ticks.maxTicksLimit,F),Kt=Math.max(1,Math.ceil(F/on));for(Fe=0;Fe<F;Fe+=Kt){const ti=this.getContext(Fe),xi=g.setContext(ti),bt=r.setContext(ti),Pi=xi.lineWidth,vi=xi.color,ki=bt.dash||[],gn=bt.dashOffset,_i=xi.tickWidth,vn=xi.tickColor,Nn=xi.tickBorderDash||[],bn=xi.tickBorderDashOffset;qe=$E(this,Fe,T),qe!==void 0&&(Re=ka(h,qe,Pi),C?Je=st=Dt=ft=Re:nt=De=zt=Gt=Re,Y.push({tx1:Je,ty1:nt,tx2:st,ty2:De,x1:Dt,y1:zt,x2:ft,y2:Gt,width:Pi,color:vi,borderDash:ki,borderDashOffset:gn,tickWidth:_i,tickColor:vn,tickBorderDash:Nn,tickBorderDashOffset:bn}))}return this._ticksLength=F,this._borderValue=Le,Y}_computeLabelItems(n){const a=this.axis,h=this.options,{position:d,ticks:g}=h,v=this.isHorizontal(),r=this.ticks,{align:T,crossAlign:C,padding:R,mirror:F}=g,U=jh(h.grid),Y=U+R,ie=F?-R:Y,ce=-Ws(this.labelRotation),he=[];let be,Le,Fe,qe,Re,Je,nt,st,De,Dt,zt,ft,Gt="middle";if(d==="top")Je=this.bottom-ie,nt=this._getXAxisLabelAlignment();else if(d==="bottom")Je=this.top+ie,nt=this._getXAxisLabelAlignment();else if(d==="left"){const Kt=this._getYAxisLabelAlignment(U);nt=Kt.textAlign,Re=Kt.x}else if(d==="right"){const Kt=this._getYAxisLabelAlignment(U);nt=Kt.textAlign,Re=Kt.x}else if(a==="x"){if(d==="center")Je=(n.top+n.bottom)/2+Y;else if(Ht(d)){const Kt=Object.keys(d)[0],ti=d[Kt];Je=this.chart.scales[Kt].getPixelForValue(ti)+Y}nt=this._getXAxisLabelAlignment()}else if(a==="y"){if(d==="center")Re=(n.left+n.right)/2-Y;else if(Ht(d)){const Kt=Object.keys(d)[0],ti=d[Kt];Re=this.chart.scales[Kt].getPixelForValue(ti)}nt=this._getYAxisLabelAlignment(U).textAlign}a==="y"&&(T==="start"?Gt="top":T==="end"&&(Gt="bottom"));const on=this._getLabelSizes();for(be=0,Le=r.length;be<Le;++be){Fe=r[be],qe=Fe.label;const Kt=g.setContext(this.getContext(be));st=this.getPixelForTick(be)+g.labelOffset,De=this._resolveTickFontOptions(be),Dt=De.lineHeight,zt=zi(qe)?qe.length:1;const ti=zt/2,xi=Kt.color,bt=Kt.textStrokeColor,Pi=Kt.textStrokeWidth;let vi=nt;v?(Re=st,nt==="inner"&&(be===Le-1?vi=this.options.reverse?"left":"right":be===0?vi=this.options.reverse?"right":"left":vi="center"),d==="top"?C==="near"||ce!==0?ft=-zt*Dt+Dt/2:C==="center"?ft=-on.highest.height/2-ti*Dt+Dt:ft=-on.highest.height+Dt/2:C==="near"||ce!==0?ft=Dt/2:C==="center"?ft=on.highest.height/2-ti*Dt:ft=on.highest.height-zt*Dt,F&&(ft*=-1),ce!==0&&!Kt.showLabelBackdrop&&(Re+=Dt/2*Math.sin(ce))):(Je=st,ft=(1-zt)*Dt/2);let ki;if(Kt.showLabelBackdrop){const gn=Ln(Kt.backdropPadding),_i=on.heights[be],vn=on.widths[be];let Nn=ft-gn.top,bn=0-gn.left;switch(Gt){case"middle":Nn-=_i/2;break;case"bottom":Nn-=_i;break}switch(nt){case"center":bn-=vn/2;break;case"right":bn-=vn;break}ki={left:bn,top:Nn,width:vn+gn.width,height:_i+gn.height,color:Kt.backdropColor}}he.push({label:qe,font:De,textOffset:ft,options:{rotation:ce,color:xi,strokeColor:bt,strokeWidth:Pi,textAlign:vi,textBaseline:Gt,translation:[Re,Je],backdrop:ki}})}return he}_getXAxisLabelAlignment(){const{position:n,ticks:a}=this.options;if(-Ws(this.labelRotation))return n==="top"?"left":"right";let d="center";return a.align==="start"?d="left":a.align==="end"?d="right":a.align==="inner"&&(d="inner"),d}_getYAxisLabelAlignment(n){const{position:a,ticks:{crossAlign:h,mirror:d,padding:g}}=this.options,v=this._getLabelSizes(),r=n+g,T=v.widest.width;let C,R;return a==="left"?d?(R=this.right+g,h==="near"?C="left":h==="center"?(C="center",R+=T/2):(C="right",R+=T)):(R=this.right-r,h==="near"?C="right":h==="center"?(C="center",R-=T/2):(C="left",R=this.left)):a==="right"?d?(R=this.left+g,h==="near"?C="right":h==="center"?(C="center",R-=T/2):(C="left",R-=T)):(R=this.left+r,h==="near"?C="left":h==="center"?(C="center",R+=T/2):(C="right",R=this.right)):C="right",{textAlign:C,x:R}}_computeLabelArea(){if(this.options.ticks.mirror)return;const n=this.chart,a=this.options.position;if(a==="left"||a==="right")return{top:0,left:this.left,bottom:n.height,right:this.right};if(a==="top"||a==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:n.width}}drawBackground(){const{ctx:n,options:{backgroundColor:a},left:h,top:d,width:g,height:v}=this;a&&(n.save(),n.fillStyle=a,n.fillRect(h,d,g,v),n.restore())}getLineWidthForValue(n){const a=this.options.grid;if(!this._isVisible()||!a.display)return 0;const d=this.ticks.findIndex(g=>g.value===n);return d>=0?a.setContext(this.getContext(d)).lineWidth:0}drawGrid(n){const a=this.options.grid,h=this.ctx,d=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(n));let g,v;const r=(T,C,R)=>{!R.width||!R.color||(h.save(),h.lineWidth=R.width,h.strokeStyle=R.color,h.setLineDash(R.borderDash||[]),h.lineDashOffset=R.borderDashOffset,h.beginPath(),h.moveTo(T.x,T.y),h.lineTo(C.x,C.y),h.stroke(),h.restore())};if(a.display)for(g=0,v=d.length;g<v;++g){const T=d[g];a.drawOnChartArea&&r({x:T.x1,y:T.y1},{x:T.x2,y:T.y2},T),a.drawTicks&&r({x:T.tx1,y:T.ty1},{x:T.tx2,y:T.ty2},{color:T.tickColor,width:T.tickWidth,borderDash:T.tickBorderDash,borderDashOffset:T.tickBorderDashOffset})}}drawBorder(){const{chart:n,ctx:a,options:{border:h,grid:d}}=this,g=h.setContext(this.getContext()),v=h.display?g.width:0;if(!v)return;const r=d.setContext(this.getContext(0)).lineWidth,T=this._borderValue;let C,R,F,U;this.isHorizontal()?(C=ka(n,this.left,v)-v/2,R=ka(n,this.right,r)+r/2,F=U=T):(F=ka(n,this.top,v)-v/2,U=ka(n,this.bottom,r)+r/2,C=R=T),a.save(),a.lineWidth=g.width,a.strokeStyle=g.color,a.beginPath(),a.moveTo(C,F),a.lineTo(R,U),a.stroke(),a.restore()}drawLabels(n){if(!this.options.ticks.display)return;const h=this.ctx,d=this._computeLabelArea();d&&Lp(h,d);const g=this.getLabelItems(n);for(const v of g){const r=v.options,T=v.font,C=v.label,R=v.textOffset;Ua(h,C,0,R,T,r)}d&&Dp(h)}drawTitle(){const{ctx:n,options:{position:a,title:h,reverse:d}}=this;if(!h.display)return;const g=hn(h.font),v=Ln(h.padding),r=h.align;let T=g.lineHeight/2;a==="bottom"||a==="center"||Ht(a)?(T+=v.bottom,zi(h.text)&&(T+=g.lineHeight*(h.text.length-1))):T+=v.top;const{titleX:C,titleY:R,maxWidth:F,rotation:U}=XE(this,T,a,r);Ua(n,h.text,0,0,g,{color:h.color,maxWidth:F,rotation:U,textAlign:HE(r,a,d),textBaseline:"middle",translation:[C,R]})}draw(n){this._isVisible()&&(this.drawBackground(),this.drawGrid(n),this.drawBorder(),this.drawTitle(),this.drawLabels(n))}_layers(){const n=this.options,a=n.ticks&&n.ticks.z||0,h=Vt(n.grid&&n.grid.z,-1),d=Vt(n.border&&n.border.z,0);return!this._isVisible()||this.draw!==Ga.prototype.draw?[{z:a,draw:g=>{this.draw(g)}}]:[{z:h,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:d,draw:()=>{this.drawBorder()}},{z:a,draw:g=>{this.drawLabels(g)}}]}getMatchingVisibleMetas(n){const a=this.chart.getSortedVisibleDatasetMetas(),h=this.axis+"AxisID",d=[];let g,v;for(g=0,v=a.length;g<v;++g){const r=a[g];r[h]===this.id&&(!n||r.type===n)&&d.push(r)}return d}_resolveTickFontOptions(n){const a=this.options.ticks.setContext(this.getContext(n));return hn(a.font)}_maxDigits(){const n=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/n}}class Hd{constructor(n,a,h){this.type=n,this.scope=a,this.override=h,this.items=Object.create(null)}isForType(n){return Object.prototype.isPrototypeOf.call(this.type.prototype,n.prototype)}register(n){const a=Object.getPrototypeOf(n);let h;JE(a)&&(h=this.register(a));const d=this.items,g=n.id,v=this.scope+"."+g;if(!g)throw new Error("class does not have id: "+n);return g in d||(d[g]=n,YE(n,v,h),this.override&&Ki.override(n.id,n.overrides)),v}get(n){return this.items[n]}unregister(n){const a=this.items,h=n.id,d=this.scope;h in a&&delete a[h],d&&h in Ki[d]&&(delete Ki[d][h],this.override&&delete Va[h])}}function YE(o,n,a){const h=su(Object.create(null),[a?Ki.get(a):{},Ki.get(n),o.defaults]);Ki.set(n,h),o.defaultRoutes&&KE(n,o.defaultRoutes),o.descriptors&&Ki.describe(n,o.descriptors)}function KE(o,n){Object.keys(n).forEach(a=>{const h=a.split("."),d=h.pop(),g=[o].concat(h).join("."),v=n[a].split("."),r=v.pop(),T=v.join(".");Ki.route(g,d,T,r)})}function JE(o){return"id"in o&&"defaults"in o}class QE{constructor(){this.controllers=new Hd(ws,"datasets",!0),this.elements=new Hd(Ts,"elements"),this.plugins=new Hd(Object,"plugins"),this.scales=new Hd(Ga,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...n){this._each("register",n)}remove(...n){this._each("unregister",n)}addControllers(...n){this._each("register",n,this.controllers)}addElements(...n){this._each("register",n,this.elements)}addPlugins(...n){this._each("register",n,this.plugins)}addScales(...n){this._each("register",n,this.scales)}getController(n){return this._get(n,this.controllers,"controller")}getElement(n){return this._get(n,this.elements,"element")}getPlugin(n){return this._get(n,this.plugins,"plugin")}getScale(n){return this._get(n,this.scales,"scale")}removeControllers(...n){this._each("unregister",n,this.controllers)}removeElements(...n){this._each("unregister",n,this.elements)}removePlugins(...n){this._each("unregister",n,this.plugins)}removeScales(...n){this._each("unregister",n,this.scales)}_each(n,a,h){[...a].forEach(d=>{const g=h||this._getRegistryForType(d);h||g.isForType(d)||g===this.plugins&&d.id?this._exec(n,g,d):yi(d,v=>{const r=h||this._getRegistryForType(v);this._exec(n,r,v)})})}_exec(n,a,h){const d=am(n);Ii(h["before"+d],[],h),a[n](h),Ii(h["after"+d],[],h)}_getRegistryForType(n){for(let a=0;a<this._typedRegistries.length;a++){const h=this._typedRegistries[a];if(h.isForType(n))return h}return this.plugins}_get(n,a,h){const d=a.get(n);if(d===void 0)throw new Error('"'+n+'" is not a registered '+h+".");return d}}var cr=new QE;class e3{constructor(){this._init=[]}notify(n,a,h,d){a==="beforeInit"&&(this._init=this._createDescriptors(n,!0),this._notify(this._init,n,"install"));const g=d?this._descriptors(n).filter(d):this._descriptors(n),v=this._notify(g,n,a,h);return a==="afterDestroy"&&(this._notify(g,n,"stop"),this._notify(this._init,n,"uninstall")),v}_notify(n,a,h,d){d=d||{};for(const g of n){const v=g.plugin,r=v[h],T=[a,d,g.options];if(Ii(r,T,v)===!1&&d.cancelable)return!1}return!0}invalidate(){ei(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(n){if(this._cache)return this._cache;const a=this._cache=this._createDescriptors(n);return this._notifyStateChanges(n),a}_createDescriptors(n,a){const h=n&&n.config,d=Vt(h.options&&h.options.plugins,{}),g=t3(h);return d===!1&&!a?[]:n3(n,g,d,a)}_notifyStateChanges(n){const a=this._oldCache||[],h=this._cache,d=(g,v)=>g.filter(r=>!v.some(T=>r.plugin.id===T.plugin.id));this._notify(d(a,h),n,"stop"),this._notify(d(h,a),n,"start")}}function t3(o){const n={},a=[],h=Object.keys(cr.plugins.items);for(let g=0;g<h.length;g++)a.push(cr.getPlugin(h[g]));const d=o.plugins||[];for(let g=0;g<d.length;g++){const v=d[g];a.indexOf(v)===-1&&(a.push(v),n[v.id]=!0)}return{plugins:a,localIds:n}}function i3(o,n){return!n&&o===!1?null:o===!0?{}:o}function n3(o,{plugins:n,localIds:a},h,d){const g=[],v=o.getContext();for(const r of n){const T=r.id,C=i3(h[T],d);C!==null&&g.push({plugin:r,options:s3(o.config,{plugin:r,local:a[T]},C,v)})}return g}function s3(o,{plugin:n,local:a},h,d){const g=o.pluginScopeKeys(n),v=o.getOptionScopes(h,g);return a&&n.defaults&&v.push(n.defaults),o.createResolver(v,d,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function $_(o,n){const a=Ki.datasets[o]||{};return((n.datasets||{})[o]||{}).indexAxis||n.indexAxis||a.indexAxis||"x"}function r3(o,n){let a=o;return o==="_index_"?a=n:o==="_value_"&&(a=n==="x"?"y":"x"),a}function o3(o,n){return o===n?"_index_":"_value_"}function $y(o){if(o==="x"||o==="y"||o==="r")return o}function a3(o){if(o==="top"||o==="bottom")return"x";if(o==="left"||o==="right")return"y"}function q_(o,...n){if($y(o))return o;for(const a of n){const h=a.axis||a3(a.position)||o.length>1&&$y(o[0].toLowerCase());if(h)return h}throw new Error(`Cannot determine type of '${o}' axis. Please provide 'axis' or 'position' option.`)}function qy(o,n,a){if(a[n+"AxisID"]===o)return{axis:n}}function l3(o,n){if(n.data&&n.data.datasets){const a=n.data.datasets.filter(h=>h.xAxisID===o||h.yAxisID===o);if(a.length)return qy(o,"x",a[0])||qy(o,"y",a[0])}return{}}function c3(o,n){const a=Va[o.type]||{scales:{}},h=n.scales||{},d=$_(o.type,n),g=Object.create(null);return Object.keys(h).forEach(v=>{const r=h[v];if(!Ht(r))return console.error(`Invalid scale configuration for scale: ${v}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${v}`);const T=q_(v,r,l3(v,o),Ki.scales[r.type]),C=o3(T,d),R=a.scales||{};g[v]=Jh(Object.create(null),[{axis:T},r,R[T],R[C]])}),o.data.datasets.forEach(v=>{const r=v.type||o.type,T=v.indexAxis||$_(r,n),R=(Va[r]||{}).scales||{};Object.keys(R).forEach(F=>{const U=r3(F,T),Y=v[U+"AxisID"]||U;g[Y]=g[Y]||Object.create(null),Jh(g[Y],[{axis:U},h[Y],R[F]])})}),Object.keys(g).forEach(v=>{const r=g[v];Jh(r,[Ki.scales[r.type],Ki.scale])}),g}function v1(o){const n=o.options||(o.options={});n.plugins=Vt(n.plugins,{}),n.scales=c3(o,n)}function b1(o){return o=o||{},o.datasets=o.datasets||[],o.labels=o.labels||[],o}function h3(o){return o=o||{},o.data=b1(o.data),v1(o),o}const Wy=new Map,w1=new Set;function Xd(o,n){let a=Wy.get(o);return a||(a=n(),Wy.set(o,a),w1.add(a)),a}const Vh=(o,n,a)=>{const h=Do(n,a);h!==void 0&&o.add(h)};class u3{constructor(n){this._config=h3(n),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(n){this._config.type=n}get data(){return this._config.data}set data(n){this._config.data=b1(n)}get options(){return this._config.options}set options(n){this._config.options=n}get plugins(){return this._config.plugins}update(){const n=this._config;this.clearCache(),v1(n)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(n){return Xd(n,()=>[[`datasets.${n}`,""]])}datasetAnimationScopeKeys(n,a){return Xd(`${n}.transition.${a}`,()=>[[`datasets.${n}.transitions.${a}`,`transitions.${a}`],[`datasets.${n}`,""]])}datasetElementScopeKeys(n,a){return Xd(`${n}-${a}`,()=>[[`datasets.${n}.elements.${a}`,`datasets.${n}`,`elements.${a}`,""]])}pluginScopeKeys(n){const a=n.id,h=this.type;return Xd(`${h}-plugin-${a}`,()=>[[`plugins.${a}`,...n.additionalOptionScopes||[]]])}_cachedScopes(n,a){const h=this._scopeCache;let d=h.get(n);return(!d||a)&&(d=new Map,h.set(n,d)),d}getOptionScopes(n,a,h){const{options:d,type:g}=this,v=this._cachedScopes(n,h),r=v.get(a);if(r)return r;const T=new Set;a.forEach(R=>{n&&(T.add(n),R.forEach(F=>Vh(T,n,F))),R.forEach(F=>Vh(T,d,F)),R.forEach(F=>Vh(T,Va[g]||{},F)),R.forEach(F=>Vh(T,Ki,F)),R.forEach(F=>Vh(T,V_,F))});const C=Array.from(T);return C.length===0&&C.push(Object.create(null)),w1.has(a)&&v.set(a,C),C}chartOptionScopes(){const{options:n,type:a}=this;return[n,Va[a]||{},Ki.datasets[a]||{},{type:a},Ki,V_]}resolveNamedOptions(n,a,h,d=[""]){const g={$shared:!0},{resolver:v,subPrefixes:r}=Zy(this._resolverCache,n,d);let T=v;if(p3(v,a)){g.$shared=!1,h=zo(h)?h():h;const C=this.createResolver(n,h,r);T=ec(v,h,C)}for(const C of a)g[C]=T[C];return g}createResolver(n,a,h=[""],d){const{resolver:g}=Zy(this._resolverCache,n,h);return Ht(a)?ec(g,a,void 0,d):g}}function Zy(o,n,a){let h=o.get(n);h||(h=new Map,o.set(n,h));const d=a.join();let g=h.get(d);return g||(g={resolver:pm(n,a),subPrefixes:a.filter(r=>!r.toLowerCase().includes("hover"))},h.set(d,g)),g}const d3=o=>Ht(o)&&Object.getOwnPropertyNames(o).reduce((n,a)=>n||zo(o[a]),!1);function p3(o,n){const{isScriptable:a,isIndexable:h}=e1(o);for(const d of n){const g=a(d),v=h(d),r=(v||g)&&o[d];if(g&&(zo(r)||d3(r))||v&&zi(r))return!0}return!1}var f3="4.4.0";const _3=["top","bottom","left","right","chartArea"];function Hy(o,n){return o==="top"||o==="bottom"||_3.indexOf(o)===-1&&n==="x"}function Xy(o,n){return function(a,h){return a[o]===h[o]?a[n]-h[n]:a[o]-h[o]}}function Yy(o){const n=o.chart,a=n.options.animation;n.notifyPlugins("afterRender"),Ii(a&&a.onComplete,[o],n)}function m3(o){const n=o.chart,a=n.options.animation;Ii(a&&a.onProgress,[o],n)}function T1(o){return o1()&&typeof o=="string"?o=document.getElementById(o):o&&o.length&&(o=o[0]),o&&o.canvas&&(o=o.canvas),o}const hp={},Ky=o=>{const n=T1(o);return Object.values(hp).filter(a=>a.canvas===n).pop()};function g3(o,n,a){const h=Object.keys(o);for(const d of h){const g=+d;if(g>=n){const v=o[d];delete o[d],(a>0||g>n)&&(o[g+a]=v)}}}function y3(o,n,a,h){return!a||o.type==="mouseout"?null:h?n:o}function Yd(o,n,a){return o.options.clip?o[a]:n[a]}function x3(o,n){const{xScale:a,yScale:h}=o;return a&&h?{left:Yd(a,n,"left"),right:Yd(a,n,"right"),top:Yd(h,n,"top"),bottom:Yd(h,n,"bottom")}:n}class cs{static register(...n){cr.add(...n),Jy()}static unregister(...n){cr.remove(...n),Jy()}constructor(n,a){const h=this.config=new u3(a),d=T1(n),g=Ky(d);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");const v=h.createResolver(h.chartOptionScopes(),this.getContext());this.platform=new(h.platform||OE(d)),this.platform.updateConfig(h);const r=this.platform.acquireContext(d,v.aspectRatio),T=r&&r.canvas,C=T&&T.height,R=T&&T.width;if(this.id=b2(),this.ctx=r,this.canvas=T,this.width=R,this.height=C,this._options=v,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new e3,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=B2(F=>this.update(F),v.resizeDelay||0),this._dataChanges=[],hp[this.id]=this,!r||!T){console.error("Failed to create chart: can't acquire context from the given item");return}Rr.listen(this,"complete",Yy),Rr.listen(this,"progress",m3),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:n,maintainAspectRatio:a},width:h,height:d,_aspectRatio:g}=this;return ei(n)?a&&g?g:d?h/d:null:n}get data(){return this.config.data}set data(n){this.config.data=n}get options(){return this._options}set options(n){this.config.options=n}get registry(){return cr}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():xy(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return my(this.canvas,this.ctx),this}stop(){return Rr.stop(this),this}resize(n,a){Rr.running(this)?this._resizeBeforeDraw={width:n,height:a}:this._resize(n,a)}_resize(n,a){const h=this.options,d=this.canvas,g=h.maintainAspectRatio&&this.aspectRatio,v=this.platform.getMaximumSize(d,n,a,g),r=h.devicePixelRatio||this.platform.getDevicePixelRatio(),T=this.width?"resize":"attach";this.width=v.width,this.height=v.height,this._aspectRatio=this.aspectRatio,xy(this,r,!0)&&(this.notifyPlugins("resize",{size:v}),Ii(h.onResize,[this,v],this),this.attached&&this._doResize(T)&&this.render())}ensureScalesHaveIDs(){const a=this.options.scales||{};yi(a,(h,d)=>{h.id=d})}buildOrUpdateScales(){const n=this.options,a=n.scales,h=this.scales,d=Object.keys(h).reduce((v,r)=>(v[r]=!1,v),{});let g=[];a&&(g=g.concat(Object.keys(a).map(v=>{const r=a[v],T=q_(v,r),C=T==="r",R=T==="x";return{options:r,dposition:C?"chartArea":R?"bottom":"left",dtype:C?"radialLinear":R?"category":"linear"}}))),yi(g,v=>{const r=v.options,T=r.id,C=q_(T,r),R=Vt(r.type,v.dtype);(r.position===void 0||Hy(r.position,C)!==Hy(v.dposition))&&(r.position=v.dposition),d[T]=!0;let F=null;if(T in h&&h[T].type===R)F=h[T];else{const U=cr.getScale(R);F=new U({id:T,type:R,ctx:this.ctx,chart:this}),h[F.id]=F}F.init(r,n)}),yi(d,(v,r)=>{v||delete h[r]}),yi(h,v=>{kn.configure(this,v,v.options),kn.addBox(this,v)})}_updateMetasets(){const n=this._metasets,a=this.data.datasets.length,h=n.length;if(n.sort((d,g)=>d.index-g.index),h>a){for(let d=a;d<h;++d)this._destroyDatasetMeta(d);n.splice(a,h-a)}this._sortedMetasets=n.slice(0).sort(Xy("order","index"))}_removeUnreferencedMetasets(){const{_metasets:n,data:{datasets:a}}=this;n.length>a.length&&delete this._stacks,n.forEach((h,d)=>{a.filter(g=>g===h._dataset).length===0&&this._destroyDatasetMeta(d)})}buildOrUpdateControllers(){const n=[],a=this.data.datasets;let h,d;for(this._removeUnreferencedMetasets(),h=0,d=a.length;h<d;h++){const g=a[h];let v=this.getDatasetMeta(h);const r=g.type||this.config.type;if(v.type&&v.type!==r&&(this._destroyDatasetMeta(h),v=this.getDatasetMeta(h)),v.type=r,v.indexAxis=g.indexAxis||$_(r,this.options),v.order=g.order||0,v.index=h,v.label=""+g.label,v.visible=this.isDatasetVisible(h),v.controller)v.controller.updateIndex(h),v.controller.linkScales();else{const T=cr.getController(r),{datasetElementType:C,dataElementType:R}=Ki.datasets[r];Object.assign(T,{dataElementType:cr.getElement(R),datasetElementType:C&&cr.getElement(C)}),v.controller=new T(this,h),n.push(v.controller)}}return this._updateMetasets(),n}_resetElements(){yi(this.data.datasets,(n,a)=>{this.getDatasetMeta(a).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(n){const a=this.config;a.update();const h=this._options=a.createResolver(a.chartOptionScopes(),this.getContext()),d=this._animationsDisabled=!h.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:n,cancelable:!0})===!1)return;const g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let v=0;for(let C=0,R=this.data.datasets.length;C<R;C++){const{controller:F}=this.getDatasetMeta(C),U=!d&&g.indexOf(F)===-1;F.buildOrUpdateElements(U),v=Math.max(+F.getMaxOverflow(),v)}v=this._minPadding=h.layout.autoPadding?v:0,this._updateLayout(v),d||yi(g,C=>{C.reset()}),this._updateDatasets(n),this.notifyPlugins("afterUpdate",{mode:n}),this._layers.sort(Xy("z","_idx"));const{_active:r,_lastEvent:T}=this;T?this._eventHandler(T,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){yi(this.scales,n=>{kn.removeBox(this,n)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const n=this.options,a=new Set(Object.keys(this._listeners)),h=new Set(n.events);(!ay(a,h)||!!this._responsiveListeners!==n.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:n}=this,a=this._getUniformDataChanges()||[];for(const{method:h,start:d,count:g}of a){const v=h==="_removeElements"?-g:g;g3(n,d,v)}}_getUniformDataChanges(){const n=this._dataChanges;if(!n||!n.length)return;this._dataChanges=[];const a=this.data.datasets.length,h=g=>new Set(n.filter(v=>v[0]===g).map((v,r)=>r+","+v.splice(1).join(","))),d=h(0);for(let g=1;g<a;g++)if(!ay(d,h(g)))return;return Array.from(d).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(n){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;kn.update(this,this.width,this.height,n);const a=this.chartArea,h=a.width<=0||a.height<=0;this._layers=[],yi(this.boxes,d=>{h&&d.position==="chartArea"||(d.configure&&d.configure(),this._layers.push(...d._layers()))},this),this._layers.forEach((d,g)=>{d._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(n){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:n,cancelable:!0})!==!1){for(let a=0,h=this.data.datasets.length;a<h;++a)this.getDatasetMeta(a).controller.configure();for(let a=0,h=this.data.datasets.length;a<h;++a)this._updateDataset(a,zo(n)?n({datasetIndex:a}):n);this.notifyPlugins("afterDatasetsUpdate",{mode:n})}}_updateDataset(n,a){const h=this.getDatasetMeta(n),d={meta:h,index:n,mode:a,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",d)!==!1&&(h.controller._update(a),d.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",d))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Rr.has(this)?this.attached&&!Rr.running(this)&&Rr.start(this):(this.draw(),Yy({chart:this})))}draw(){let n;if(this._resizeBeforeDraw){const{width:h,height:d}=this._resizeBeforeDraw;this._resize(h,d),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const a=this._layers;for(n=0;n<a.length&&a[n].z<=0;++n)a[n].draw(this.chartArea);for(this._drawDatasets();n<a.length;++n)a[n].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(n){const a=this._sortedMetasets,h=[];let d,g;for(d=0,g=a.length;d<g;++d){const v=a[d];(!n||v.visible)&&h.push(v)}return h}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const n=this.getSortedVisibleDatasetMetas();for(let a=n.length-1;a>=0;--a)this._drawDataset(n[a]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(n){const a=this.ctx,h=n._clip,d=!h.disabled,g=x3(n,this.chartArea),v={meta:n,index:n.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",v)!==!1&&(d&&Lp(a,{left:h.left===!1?0:g.left-h.left,right:h.right===!1?this.width:g.right+h.right,top:h.top===!1?0:g.top-h.top,bottom:h.bottom===!1?this.height:g.bottom+h.bottom}),n.controller.draw(),d&&Dp(a),v.cancelable=!1,this.notifyPlugins("afterDatasetDraw",v))}isPointInArea(n){return jr(n,this.chartArea,this._minPadding)}getElementsAtEventForMode(n,a,h,d){const g=_E.modes[a];return typeof g=="function"?g(this,n,h,d):[]}getDatasetMeta(n){const a=this.data.datasets[n],h=this._metasets;let d=h.filter(g=>g&&g._dataset===a).pop();return d||(d={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:a&&a.order||0,index:n,_dataset:a,_parsed:[],_sorted:!1},h.push(d)),d}getContext(){return this.$context||(this.$context=Bo(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(n){const a=this.data.datasets[n];if(!a)return!1;const h=this.getDatasetMeta(n);return typeof h.hidden=="boolean"?!h.hidden:!a.hidden}setDatasetVisibility(n,a){const h=this.getDatasetMeta(n);h.hidden=!a}toggleDataVisibility(n){this._hiddenIndices[n]=!this._hiddenIndices[n]}getDataVisibility(n){return!this._hiddenIndices[n]}_updateVisibility(n,a,h){const d=h?"show":"hide",g=this.getDatasetMeta(n),v=g.controller._resolveAnimations(void 0,d);ru(a)?(g.data[a].hidden=!h,this.update()):(this.setDatasetVisibility(n,h),v.update(g,{visible:h}),this.update(r=>r.datasetIndex===n?d:void 0))}hide(n,a){this._updateVisibility(n,a,!1)}show(n,a){this._updateVisibility(n,a,!0)}_destroyDatasetMeta(n){const a=this._metasets[n];a&&a.controller&&a.controller._destroy(),delete this._metasets[n]}_stop(){let n,a;for(this.stop(),Rr.remove(this),n=0,a=this.data.datasets.length;n<a;++n)this._destroyDatasetMeta(n)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:n,ctx:a}=this;this._stop(),this.config.clearCache(),n&&(this.unbindEvents(),my(n,a),this.platform.releaseContext(a),this.canvas=null,this.ctx=null),delete hp[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...n){return this.canvas.toDataURL(...n)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const n=this._listeners,a=this.platform,h=(g,v)=>{a.addEventListener(this,g,v),n[g]=v},d=(g,v,r)=>{g.offsetX=v,g.offsetY=r,this._eventHandler(g)};yi(this.options.events,g=>h(g,d))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const n=this._responsiveListeners,a=this.platform,h=(T,C)=>{a.addEventListener(this,T,C),n[T]=C},d=(T,C)=>{n[T]&&(a.removeEventListener(this,T,C),delete n[T])},g=(T,C)=>{this.canvas&&this.resize(T,C)};let v;const r=()=>{d("attach",r),this.attached=!0,this.resize(),h("resize",g),h("detach",v)};v=()=>{this.attached=!1,d("resize",g),this._stop(),this._resize(0,0),h("attach",r)},a.isAttached(this.canvas)?r():v()}unbindEvents(){yi(this._listeners,(n,a)=>{this.platform.removeEventListener(this,a,n)}),this._listeners={},yi(this._responsiveListeners,(n,a)=>{this.platform.removeEventListener(this,a,n)}),this._responsiveListeners=void 0}updateHoverStyle(n,a,h){const d=h?"set":"remove";let g,v,r,T;for(a==="dataset"&&(g=this.getDatasetMeta(n[0].datasetIndex),g.controller["_"+d+"DatasetHoverStyle"]()),r=0,T=n.length;r<T;++r){v=n[r];const C=v&&this.getDatasetMeta(v.datasetIndex).controller;C&&C[d+"HoverStyle"](v.element,v.datasetIndex,v.index)}}getActiveElements(){return this._active||[]}setActiveElements(n){const a=this._active||[],h=n.map(({datasetIndex:g,index:v})=>{const r=this.getDatasetMeta(g);if(!r)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:r.data[v],index:v}});!xp(h,a)&&(this._active=h,this._lastEvent=null,this._updateHoverStyles(h,a))}notifyPlugins(n,a,h){return this._plugins.notify(this,n,a,h)}isPluginEnabled(n){return this._plugins._cache.filter(a=>a.plugin.id===n).length===1}_updateHoverStyles(n,a,h){const d=this.options.hover,g=(T,C)=>T.filter(R=>!C.some(F=>R.datasetIndex===F.datasetIndex&&R.index===F.index)),v=g(a,n),r=h?n:g(n,a);v.length&&this.updateHoverStyle(v,d.mode,!1),r.length&&d.mode&&this.updateHoverStyle(r,d.mode,!0)}_eventHandler(n,a){const h={event:n,replay:a,cancelable:!0,inChartArea:this.isPointInArea(n)},d=v=>(v.options.events||this.options.events).includes(n.native.type);if(this.notifyPlugins("beforeEvent",h,d)===!1)return;const g=this._handleEvent(n,a,h.inChartArea);return h.cancelable=!1,this.notifyPlugins("afterEvent",h,d),(g||h.changed)&&this.render(),this}_handleEvent(n,a,h){const{_active:d=[],options:g}=this,v=a,r=this._getActiveElements(n,d,h,v),T=A2(n),C=y3(n,this._lastEvent,h,T);h&&(this._lastEvent=null,Ii(g.onHover,[n,r,this],this),T&&Ii(g.onClick,[n,r,this],this));const R=!xp(r,d);return(R||a)&&(this._active=r,this._updateHoverStyles(r,d,a)),this._lastEvent=C,R}_getActiveElements(n,a,h,d){if(n.type==="mouseout")return[];if(!h)return a;const g=this.options.hover;return this.getElementsAtEventForMode(n,g.mode,g,d)}}ct(cs,"defaults",Ki),ct(cs,"instances",hp),ct(cs,"overrides",Va),ct(cs,"registry",cr),ct(cs,"version",f3),ct(cs,"getChart",Ky);function Jy(){return yi(cs.instances,o=>o._plugins.invalidate())}function v3(o,n,a){const{startAngle:h,pixelMargin:d,x:g,y:v,outerRadius:r,innerRadius:T}=n;let C=d/r;o.beginPath(),o.arc(g,v,r,h-C,a+C),T>d?(C=d/T,o.arc(g,v,T,a+C,h-C,!0)):o.arc(g,v,d,a+Ji,h-Ji),o.closePath(),o.clip()}function b3(o){return dm(o,["outerStart","outerEnd","innerStart","innerEnd"])}function w3(o,n,a,h){const d=b3(o.options.borderRadius),g=(a-n)/2,v=Math.min(g,h*n/2),r=T=>{const C=(a-Math.min(g,T))*h/2;return mn(T,0,Math.min(g,C))};return{outerStart:r(d.outerStart),outerEnd:r(d.outerEnd),innerStart:mn(d.innerStart,0,v),innerEnd:mn(d.innerEnd,0,v)}}function Zl(o,n,a,h){return{x:a+o*Math.cos(n),y:h+o*Math.sin(n)}}function Mp(o,n,a,h,d,g){const{x:v,y:r,startAngle:T,pixelMargin:C,innerRadius:R}=n,F=Math.max(n.outerRadius+h+a-C,0),U=R>0?R+h+a+C:0;let Y=0;const ie=d-T;if(h){const Kt=R>0?R-h:0,ti=F>0?F-h:0,xi=(Kt+ti)/2,bt=xi!==0?ie*xi/(xi+h):ie;Y=(ie-bt)/2}const ce=Math.max(.001,ie*F-a/Oi)/F,he=(ie-ce)/2,be=T+he+Y,Le=d-he-Y,{outerStart:Fe,outerEnd:qe,innerStart:Re,innerEnd:Je}=w3(n,U,F,Le-be),nt=F-Fe,st=F-qe,De=be+Fe/nt,Dt=Le-qe/st,zt=U+Re,ft=U+Je,Gt=be+Re/zt,on=Le-Je/ft;if(o.beginPath(),g){const Kt=(De+Dt)/2;if(o.arc(v,r,F,De,Kt),o.arc(v,r,F,Kt,Dt),qe>0){const Pi=Zl(st,Dt,v,r);o.arc(Pi.x,Pi.y,qe,Dt,Le+Ji)}const ti=Zl(ft,Le,v,r);if(o.lineTo(ti.x,ti.y),Je>0){const Pi=Zl(ft,on,v,r);o.arc(Pi.x,Pi.y,Je,Le+Ji,on+Math.PI)}const xi=(Le-Je/U+(be+Re/U))/2;if(o.arc(v,r,U,Le-Je/U,xi,!0),o.arc(v,r,U,xi,be+Re/U,!0),Re>0){const Pi=Zl(zt,Gt,v,r);o.arc(Pi.x,Pi.y,Re,Gt+Math.PI,be-Ji)}const bt=Zl(nt,be,v,r);if(o.lineTo(bt.x,bt.y),Fe>0){const Pi=Zl(nt,De,v,r);o.arc(Pi.x,Pi.y,Fe,be-Ji,De)}}else{o.moveTo(v,r);const Kt=Math.cos(De)*F+v,ti=Math.sin(De)*F+r;o.lineTo(Kt,ti);const xi=Math.cos(Dt)*F+v,bt=Math.sin(Dt)*F+r;o.lineTo(xi,bt)}o.closePath()}function T3(o,n,a,h,d){const{fullCircles:g,startAngle:v,circumference:r}=n;let T=n.endAngle;if(g){Mp(o,n,a,h,T,d);for(let C=0;C<g;++C)o.fill();isNaN(r)||(T=v+(r%Ri||Ri))}return Mp(o,n,a,h,T,d),o.fill(),T}function E3(o,n,a,h,d){const{fullCircles:g,startAngle:v,circumference:r,options:T}=n,{borderWidth:C,borderJoinStyle:R,borderDash:F,borderDashOffset:U}=T,Y=T.borderAlign==="inner";if(!C)return;o.setLineDash(F||[]),o.lineDashOffset=U,Y?(o.lineWidth=C*2,o.lineJoin=R||"round"):(o.lineWidth=C,o.lineJoin=R||"bevel");let ie=n.endAngle;if(g){Mp(o,n,a,h,ie,d);for(let ce=0;ce<g;++ce)o.stroke();isNaN(r)||(ie=v+(r%Ri||Ri))}Y&&v3(o,n,ie),g||(Mp(o,n,a,h,ie,d),o.stroke())}class Wh extends Ts{constructor(a){super();ct(this,"circumference");ct(this,"endAngle");ct(this,"fullCircles");ct(this,"innerRadius");ct(this,"outerRadius");ct(this,"pixelMargin");ct(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,a&&Object.assign(this,a)}inRange(a,h,d){const g=this.getProps(["x","y"],d),{angle:v,distance:r}=$x(g,{x:a,y:h}),{startAngle:T,endAngle:C,innerRadius:R,outerRadius:F,circumference:U}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],d),Y=(this.options.spacing+this.options.borderWidth)/2,ce=Vt(U,C-T)>=Ri||ou(v,T,C),he=Fr(r,R+Y,F+Y);return ce&&he}getCenterPoint(a){const{x:h,y:d,startAngle:g,endAngle:v,innerRadius:r,outerRadius:T}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],a),{offset:C,spacing:R}=this.options,F=(g+v)/2,U=(r+T+R+C)/2;return{x:h+Math.cos(F)*U,y:d+Math.sin(F)*U}}tooltipPosition(a){return this.getCenterPoint(a)}draw(a){const{options:h,circumference:d}=this,g=(h.offset||0)/4,v=(h.spacing||0)/2,r=h.circular;if(this.pixelMargin=h.borderAlign==="inner"?.33:0,this.fullCircles=d>Ri?Math.floor(d/Ri):0,d===0||this.innerRadius<0||this.outerRadius<0)return;a.save();const T=(this.startAngle+this.endAngle)/2;a.translate(Math.cos(T)*g,Math.sin(T)*g);const C=1-Math.sin(Math.min(Oi,d||0)),R=g*C;a.fillStyle=h.backgroundColor,a.strokeStyle=h.borderColor,T3(a,this,R,v,r),E3(a,this,R,v,r),a.restore()}}ct(Wh,"id","arc"),ct(Wh,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),ct(Wh,"defaultRoutes",{backgroundColor:"backgroundColor"}),ct(Wh,"descriptors",{_scriptable:!0,_indexable:a=>a!=="borderDash"});function E1(o,n,a=n){o.lineCap=Vt(a.borderCapStyle,n.borderCapStyle),o.setLineDash(Vt(a.borderDash,n.borderDash)),o.lineDashOffset=Vt(a.borderDashOffset,n.borderDashOffset),o.lineJoin=Vt(a.borderJoinStyle,n.borderJoinStyle),o.lineWidth=Vt(a.borderWidth,n.borderWidth),o.strokeStyle=Vt(a.borderColor,n.borderColor)}function M3(o,n,a){o.lineTo(a.x,a.y)}function S3(o){return o.stepped?X2:o.tension||o.cubicInterpolationMode==="monotone"?Y2:M3}function M1(o,n,a={}){const h=o.length,{start:d=0,end:g=h-1}=a,{start:v,end:r}=n,T=Math.max(d,v),C=Math.min(g,r),R=d<v&&g<v||d>r&&g>r;return{count:h,start:T,loop:n.loop,ilen:C<T&&!R?h+C-T:C-T}}function A3(o,n,a,h){const{points:d,options:g}=n,{count:v,start:r,loop:T,ilen:C}=M1(d,a,h),R=S3(g);let{move:F=!0,reverse:U}=h||{},Y,ie,ce;for(Y=0;Y<=C;++Y)ie=d[(r+(U?C-Y:Y))%v],!ie.skip&&(F?(o.moveTo(ie.x,ie.y),F=!1):R(o,ce,ie,U,g.stepped),ce=ie);return T&&(ie=d[(r+(U?C:0))%v],R(o,ce,ie,U,g.stepped)),!!T}function I3(o,n,a,h){const d=n.points,{count:g,start:v,ilen:r}=M1(d,a,h),{move:T=!0,reverse:C}=h||{};let R=0,F=0,U,Y,ie,ce,he,be;const Le=qe=>(v+(C?r-qe:qe))%g,Fe=()=>{ce!==he&&(o.lineTo(R,he),o.lineTo(R,ce),o.lineTo(R,be))};for(T&&(Y=d[Le(0)],o.moveTo(Y.x,Y.y)),U=0;U<=r;++U){if(Y=d[Le(U)],Y.skip)continue;const qe=Y.x,Re=Y.y,Je=qe|0;Je===ie?(Re<ce?ce=Re:Re>he&&(he=Re),R=(F*R+qe)/++F):(Fe(),o.lineTo(qe,Re),ie=Je,F=0,ce=he=Re),be=Re}Fe()}function W_(o){const n=o.options,a=n.borderDash&&n.borderDash.length;return!o._decimated&&!o._loop&&!n.tension&&n.cubicInterpolationMode!=="monotone"&&!n.stepped&&!a?I3:A3}function C3(o){return o.stepped?IT:o.tension||o.cubicInterpolationMode==="monotone"?CT:Ba}function P3(o,n,a,h){let d=n._path;d||(d=n._path=new Path2D,n.path(d,a,h)&&d.closePath()),E1(o,n.options),o.stroke(d)}function k3(o,n,a,h){const{segments:d,options:g}=n,v=W_(n);for(const r of d)E1(o,g,r.style),o.beginPath(),v(o,n,r,{start:a,end:a+h-1})&&o.closePath(),o.stroke()}const L3=typeof Path2D=="function";function D3(o,n,a,h){L3&&!n.options.segment?P3(o,n,a,h):k3(o,n,a,h)}class Io extends Ts{constructor(n){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,n&&Object.assign(this,n)}updateControlPoints(n,a){const h=this.options;if((h.tension||h.cubicInterpolationMode==="monotone")&&!h.stepped&&!this._pointsUpdated){const d=h.spanGaps?this._loop:this._fullLoop;vT(this._points,h,n,d,a),this._pointsUpdated=!0}}set points(n){this._points=n,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=RT(this,this.options.segment))}first(){const n=this.segments,a=this.points;return n.length&&a[n[0].start]}last(){const n=this.segments,a=this.points,h=n.length;return h&&a[n[h-1].end]}interpolate(n,a){const h=this.options,d=n[a],g=this.points,v=u1(this,{property:a,start:d,end:d});if(!v.length)return;const r=[],T=C3(h);let C,R;for(C=0,R=v.length;C<R;++C){const{start:F,end:U}=v[C],Y=g[F],ie=g[U];if(Y===ie){r.push(Y);continue}const ce=Math.abs((d-Y[a])/(ie[a]-Y[a])),he=T(Y,ie,ce,h.stepped);he[a]=n[a],r.push(he)}return r.length===1?r[0]:r}pathSegment(n,a,h){return W_(this)(n,this,a,h)}path(n,a,h){const d=this.segments,g=W_(this);let v=this._loop;a=a||0,h=h||this.points.length-a;for(const r of d)v&=g(n,this,r,{start:a,end:a+h-1});return!!v}draw(n,a,h,d){const g=this.options||{};(this.points||[]).length&&g.borderWidth&&(n.save(),D3(n,this,h,d),n.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}ct(Io,"id","line"),ct(Io,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),ct(Io,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),ct(Io,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"&&n!=="fill"});function Qy(o,n,a,h){const d=o.options,{[a]:g}=o.getProps([a],h);return Math.abs(n-g)<d.radius+d.hitRadius}class up extends Ts{constructor(a){super();ct(this,"parsed");ct(this,"skip");ct(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,a&&Object.assign(this,a)}inRange(a,h,d){const g=this.options,{x:v,y:r}=this.getProps(["x","y"],d);return Math.pow(a-v,2)+Math.pow(h-r,2)<Math.pow(g.hitRadius+g.radius,2)}inXRange(a,h){return Qy(this,a,"x",h)}inYRange(a,h){return Qy(this,a,"y",h)}getCenterPoint(a){const{x:h,y:d}=this.getProps(["x","y"],a);return{x:h,y:d}}size(a){a=a||this.options||{};let h=a.radius||0;h=Math.max(h,h&&a.hoverRadius||0);const d=h&&a.borderWidth||0;return(h+d)*2}draw(a,h){const d=this.options;this.skip||d.radius<.1||!jr(this,h,this.size(d)/2)||(a.strokeStyle=d.borderColor,a.lineWidth=d.borderWidth,a.fillStyle=d.backgroundColor,U_(a,d,this.x,this.y))}getRange(){const a=this.options||{};return a.radius+a.hitRadius}}ct(up,"id","point"),ct(up,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),ct(up,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function S1(o,n){const{x:a,y:h,base:d,width:g,height:v}=o.getProps(["x","y","base","width","height"],n);let r,T,C,R,F;return o.horizontal?(F=v/2,r=Math.min(a,d),T=Math.max(a,d),C=h-F,R=h+F):(F=g/2,r=a-F,T=a+F,C=Math.min(h,d),R=Math.max(h,d)),{left:r,top:C,right:T,bottom:R}}function Co(o,n,a,h){return o?0:mn(n,a,h)}function z3(o,n,a){const h=o.options.borderWidth,d=o.borderSkipped,g=Qx(h);return{t:Co(d.top,g.top,0,a),r:Co(d.right,g.right,0,n),b:Co(d.bottom,g.bottom,0,a),l:Co(d.left,g.left,0,n)}}function R3(o,n,a){const{enableBorderRadius:h}=o.getProps(["enableBorderRadius"]),d=o.options.borderRadius,g=Lo(d),v=Math.min(n,a),r=o.borderSkipped,T=h||Ht(d);return{topLeft:Co(!T||r.top||r.left,g.topLeft,0,v),topRight:Co(!T||r.top||r.right,g.topRight,0,v),bottomLeft:Co(!T||r.bottom||r.left,g.bottomLeft,0,v),bottomRight:Co(!T||r.bottom||r.right,g.bottomRight,0,v)}}function O3(o){const n=S1(o),a=n.right-n.left,h=n.bottom-n.top,d=z3(o,a/2,h/2),g=R3(o,a/2,h/2);return{outer:{x:n.left,y:n.top,w:a,h,radius:g},inner:{x:n.left+d.l,y:n.top+d.t,w:a-d.l-d.r,h:h-d.t-d.b,radius:{topLeft:Math.max(0,g.topLeft-Math.max(d.t,d.l)),topRight:Math.max(0,g.topRight-Math.max(d.t,d.r)),bottomLeft:Math.max(0,g.bottomLeft-Math.max(d.b,d.l)),bottomRight:Math.max(0,g.bottomRight-Math.max(d.b,d.r))}}}}function A_(o,n,a,h){const d=n===null,g=a===null,r=o&&!(d&&g)&&S1(o,h);return r&&(d||Fr(n,r.left,r.right))&&(g||Fr(a,r.top,r.bottom))}function B3(o){return o.topLeft||o.topRight||o.bottomLeft||o.bottomRight}function F3(o,n){o.rect(n.x,n.y,n.w,n.h)}function I_(o,n,a={}){const h=o.x!==a.x?-n:0,d=o.y!==a.y?-n:0,g=(o.x+o.w!==a.x+a.w?n:0)-h,v=(o.y+o.h!==a.y+a.h?n:0)-d;return{x:o.x+h,y:o.y+d,w:o.w+g,h:o.h+v,radius:o.radius}}class dp extends Ts{constructor(n){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,n&&Object.assign(this,n)}draw(n){const{inflateAmount:a,options:{borderColor:h,backgroundColor:d}}=this,{inner:g,outer:v}=O3(this),r=B3(v.radius)?ko:F3;n.save(),(v.w!==g.w||v.h!==g.h)&&(n.beginPath(),r(n,I_(v,a,g)),n.clip(),r(n,I_(g,-a,v)),n.fillStyle=h,n.fill("evenodd")),n.beginPath(),r(n,I_(g,a)),n.fillStyle=d,n.fill(),n.restore()}inRange(n,a,h){return A_(this,n,a,h)}inXRange(n,a){return A_(this,n,null,a)}inYRange(n,a){return A_(this,null,n,a)}getCenterPoint(n){const{x:a,y:h,base:d,horizontal:g}=this.getProps(["x","y","base","horizontal"],n);return{x:g?(a+d)/2:a,y:g?h:(h+d)/2}}getRange(n){return n==="x"?this.width/2:this.height/2}}ct(dp,"id","bar"),ct(dp,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),ct(dp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var N3=Object.freeze({__proto__:null,ArcElement:Wh,BarElement:dp,LineElement:Io,PointElement:up});const Z_=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],ex=Z_.map(o=>o.replace("rgb(","rgba(").replace(")",", 0.5)"));function A1(o){return Z_[o%Z_.length]}function I1(o){return ex[o%ex.length]}function j3(o,n){return o.borderColor=A1(n),o.backgroundColor=I1(n),++n}function V3(o,n){return o.backgroundColor=o.data.map(()=>A1(n++)),n}function U3(o,n){return o.backgroundColor=o.data.map(()=>I1(n++)),n}function G3(o){let n=0;return(a,h)=>{const d=o.getDatasetMeta(h).controller;d instanceof Na?n=V3(a,n):d instanceof iu?n=U3(a,n):d&&(n=j3(a,n))}}function tx(o){let n;for(n in o)if(o[n].borderColor||o[n].backgroundColor)return!0;return!1}function $3(o){return o&&(o.borderColor||o.backgroundColor)}var q3={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(o,n,a){if(!a.enabled)return;const{data:{datasets:h},options:d}=o.config,{elements:g}=d;if(!a.forceOverride&&(tx(h)||$3(d)||g&&tx(g)))return;const v=G3(o);h.forEach(v)}};function W3(o,n,a,h,d){const g=d.samples||h;if(g>=a)return o.slice(n,n+a);const v=[],r=(a-2)/(g-2);let T=0;const C=n+a-1;let R=n,F,U,Y,ie,ce;for(v[T++]=o[R],F=0;F<g-2;F++){let he=0,be=0,Le;const Fe=Math.floor((F+1)*r)+1+n,qe=Math.min(Math.floor((F+2)*r)+1,a)+n,Re=qe-Fe;for(Le=Fe;Le<qe;Le++)he+=o[Le].x,be+=o[Le].y;he/=Re,be/=Re;const Je=Math.floor(F*r)+1+n,nt=Math.min(Math.floor((F+1)*r)+1,a)+n,{x:st,y:De}=o[R];for(Y=ie=-1,Le=Je;Le<nt;Le++)ie=.5*Math.abs((st-he)*(o[Le].y-De)-(st-o[Le].x)*(be-De)),ie>Y&&(Y=ie,U=o[Le],ce=Le);v[T++]=U,R=ce}return v[T++]=o[C],v}function Z3(o,n,a,h){let d=0,g=0,v,r,T,C,R,F,U,Y,ie,ce;const he=[],be=n+a-1,Le=o[n].x,qe=o[be].x-Le;for(v=n;v<n+a;++v){r=o[v],T=(r.x-Le)/qe*h,C=r.y;const Re=T|0;if(Re===R)C<ie?(ie=C,F=v):C>ce&&(ce=C,U=v),d=(g*d+r.x)/++g;else{const Je=v-1;if(!ei(F)&&!ei(U)){const nt=Math.min(F,U),st=Math.max(F,U);nt!==Y&&nt!==Je&&he.push({...o[nt],x:d}),st!==Y&&st!==Je&&he.push({...o[st],x:d})}v>0&&Je!==Y&&he.push(o[Je]),he.push(r),R=Re,g=0,ie=ce=C,F=U=Y=v}}return he}function C1(o){if(o._decimated){const n=o._data;delete o._decimated,delete o._data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,writable:!0,value:n})}}function ix(o){o.data.datasets.forEach(n=>{C1(n)})}function H3(o,n){const a=n.length;let h=0,d;const{iScale:g}=o,{min:v,max:r,minDefined:T,maxDefined:C}=g.getUserBounds();return T&&(h=mn(Nr(n,g.axis,v).lo,0,a-1)),C?d=mn(Nr(n,g.axis,r).hi+1,h,a)-h:d=a-h,{start:h,count:d}}var X3={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(o,n,a)=>{if(!a.enabled){ix(o);return}const h=o.width;o.data.datasets.forEach((d,g)=>{const{_data:v,indexAxis:r}=d,T=o.getDatasetMeta(g),C=v||d.data;if($h([r,o.options.indexAxis])==="y"||!T.controller.supportsDecimation)return;const R=o.scales[T.xAxisID];if(R.type!=="linear"&&R.type!=="time"||o.options.parsing)return;let{start:F,count:U}=H3(T,C);const Y=a.threshold||4*h;if(U<=Y){C1(d);return}ei(v)&&(d._data=C,delete d.data,Object.defineProperty(d,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ce){this._data=ce}}));let ie;switch(a.algorithm){case"lttb":ie=W3(C,F,U,h,a);break;case"min-max":ie=Z3(C,F,U,h);break;default:throw new Error(`Unsupported decimation algorithm '${a.algorithm}'`)}d._decimated=ie})},destroy(o){ix(o)}};function Y3(o,n,a){const h=o.segments,d=o.points,g=n.points,v=[];for(const r of h){let{start:T,end:C}=r;C=ym(T,C,d);const R=H_(a,d[T],d[C],r.loop);if(!n.segments){v.push({source:r,target:R,start:d[T],end:d[C]});continue}const F=u1(n,R);for(const U of F){const Y=H_(a,g[U.start],g[U.end],U.loop),ie=h1(r,d,Y);for(const ce of ie)v.push({source:ce,target:U,start:{[a]:nx(R,Y,"start",Math.max)},end:{[a]:nx(R,Y,"end",Math.min)}})}}return v}function H_(o,n,a,h){if(h)return;let d=n[o],g=a[o];return o==="angle"&&(d=ls(d),g=ls(g)),{property:o,start:d,end:g}}function K3(o,n){const{x:a=null,y:h=null}=o||{},d=n.points,g=[];return n.segments.forEach(({start:v,end:r})=>{r=ym(v,r,d);const T=d[v],C=d[r];h!==null?(g.push({x:T.x,y:h}),g.push({x:C.x,y:h})):a!==null&&(g.push({x:a,y:T.y}),g.push({x:a,y:C.y}))}),g}function ym(o,n,a){for(;n>o;n--){const h=a[n];if(!isNaN(h.x)&&!isNaN(h.y))break}return n}function nx(o,n,a,h){return o&&n?h(o[a],n[a]):o?o[a]:n?n[a]:0}function P1(o,n){let a=[],h=!1;return zi(o)?(h=!0,a=o):a=K3(o,n),a.length?new Io({points:a,options:{tension:0},_loop:h,_fullLoop:h}):null}function sx(o){return o&&o.fill!==!1}function J3(o,n,a){let d=o[n].fill;const g=[n];let v;if(!a)return d;for(;d!==!1&&g.indexOf(d)===-1;){if(!Yi(d))return d;if(v=o[d],!v)return!1;if(v.visible)return d;g.push(d),d=v.fill}return!1}function Q3(o,n,a){const h=nM(o);if(Ht(h))return isNaN(h.value)?!1:h;let d=parseFloat(h);return Yi(d)&&Math.floor(d)===d?eM(h[0],n,d,a):["origin","start","end","stack","shape"].indexOf(h)>=0&&h}function eM(o,n,a,h){return(o==="-"||o==="+")&&(a=n+a),a===n||a<0||a>=h?!1:a}function tM(o,n){let a=null;return o==="start"?a=n.bottom:o==="end"?a=n.top:Ht(o)?a=n.getPixelForValue(o.value):n.getBasePixel&&(a=n.getBasePixel()),a}function iM(o,n,a){let h;return o==="start"?h=a:o==="end"?h=n.options.reverse?n.min:n.max:Ht(o)?h=o.value:h=n.getBaseValue(),h}function nM(o){const n=o.options,a=n.fill;let h=Vt(a&&a.target,a);return h===void 0&&(h=!!n.backgroundColor),h===!1||h===null?!1:h===!0?"origin":h}function sM(o){const{scale:n,index:a,line:h}=o,d=[],g=h.segments,v=h.points,r=rM(n,a);r.push(P1({x:null,y:n.bottom},h));for(let T=0;T<g.length;T++){const C=g[T];for(let R=C.start;R<=C.end;R++)oM(d,v[R],r)}return new Io({points:d,options:{}})}function rM(o,n){const a=[],h=o.getMatchingVisibleMetas("line");for(let d=0;d<h.length;d++){const g=h[d];if(g.index===n)break;g.hidden||a.unshift(g.dataset)}return a}function oM(o,n,a){const h=[];for(let d=0;d<a.length;d++){const g=a[d],{first:v,last:r,point:T}=aM(g,n,"x");if(!(!T||v&&r)){if(v)h.unshift(T);else if(o.push(T),!r)break}}o.push(...h)}function aM(o,n,a){const h=o.interpolate(n,a);if(!h)return{};const d=h[a],g=o.segments,v=o.points;let r=!1,T=!1;for(let C=0;C<g.length;C++){const R=g[C],F=v[R.start][a],U=v[R.end][a];if(Fr(d,F,U)){r=d===F,T=d===U;break}}return{first:r,last:T,point:h}}class k1{constructor(n){this.x=n.x,this.y=n.y,this.radius=n.radius}pathSegment(n,a,h){const{x:d,y:g,radius:v}=this;return a=a||{start:0,end:Ri},n.arc(d,g,v,a.end,a.start,!0),!h.bounds}interpolate(n){const{x:a,y:h,radius:d}=this,g=n.angle;return{x:a+Math.cos(g)*d,y:h+Math.sin(g)*d,angle:g}}}function lM(o){const{chart:n,fill:a,line:h}=o;if(Yi(a))return cM(n,a);if(a==="stack")return sM(o);if(a==="shape")return!0;const d=hM(o);return d instanceof k1?d:P1(d,h)}function cM(o,n){const a=o.getDatasetMeta(n);return a&&o.isDatasetVisible(n)?a.dataset:null}function hM(o){return(o.scale||{}).getPointPositionForValue?dM(o):uM(o)}function uM(o){const{scale:n={},fill:a}=o,h=tM(a,n);if(Yi(h)){const d=n.isHorizontal();return{x:d?h:null,y:d?null:h}}return null}function dM(o){const{scale:n,fill:a}=o,h=n.options,d=n.getLabels().length,g=h.reverse?n.max:n.min,v=iM(a,n,g),r=[];if(h.grid.circular){const T=n.getPointPositionForValue(0,g);return new k1({x:T.x,y:T.y,radius:n.getDistanceFromCenterForValue(v)})}for(let T=0;T<d;++T)r.push(n.getPointPositionForValue(T,v));return r}function C_(o,n,a){const h=lM(n),{line:d,scale:g,axis:v}=n,r=d.options,T=r.fill,C=r.backgroundColor,{above:R=C,below:F=C}=T||{};h&&d.points.length&&(Lp(o,a),pM(o,{line:d,target:h,above:R,below:F,area:a,scale:g,axis:v}),Dp(o))}function pM(o,n){const{line:a,target:h,above:d,below:g,area:v,scale:r}=n,T=a._loop?"angle":n.axis;o.save(),T==="x"&&g!==d&&(rx(o,h,v.top),ox(o,{line:a,target:h,color:d,scale:r,property:T}),o.restore(),o.save(),rx(o,h,v.bottom)),ox(o,{line:a,target:h,color:g,scale:r,property:T}),o.restore()}function rx(o,n,a){const{segments:h,points:d}=n;let g=!0,v=!1;o.beginPath();for(const r of h){const{start:T,end:C}=r,R=d[T],F=d[ym(T,C,d)];g?(o.moveTo(R.x,R.y),g=!1):(o.lineTo(R.x,a),o.lineTo(R.x,R.y)),v=!!n.pathSegment(o,r,{move:v}),v?o.closePath():o.lineTo(F.x,a)}o.lineTo(n.first().x,a),o.closePath(),o.clip()}function ox(o,n){const{line:a,target:h,property:d,color:g,scale:v}=n,r=Y3(a,h,d);for(const{source:T,target:C,start:R,end:F}of r){const{style:{backgroundColor:U=g}={}}=T,Y=h!==!0;o.save(),o.fillStyle=U,fM(o,v,Y&&H_(d,R,F)),o.beginPath();const ie=!!a.pathSegment(o,T);let ce;if(Y){ie?o.closePath():ax(o,h,F,d);const he=!!h.pathSegment(o,C,{move:ie,reverse:!0});ce=ie&&he,ce||ax(o,h,R,d)}o.closePath(),o.fill(ce?"evenodd":"nonzero"),o.restore()}}function fM(o,n,a){const{top:h,bottom:d}=n.chart.chartArea,{property:g,start:v,end:r}=a||{};g==="x"&&(o.beginPath(),o.rect(v,h,r-v,d-h),o.clip())}function ax(o,n,a,h){const d=n.interpolate(a,h);d&&o.lineTo(d.x,d.y)}var _M={id:"filler",afterDatasetsUpdate(o,n,a){const h=(o.data.datasets||[]).length,d=[];let g,v,r,T;for(v=0;v<h;++v)g=o.getDatasetMeta(v),r=g.dataset,T=null,r&&r.options&&r instanceof Io&&(T={visible:o.isDatasetVisible(v),index:v,fill:Q3(r,v,h),chart:o,axis:g.controller.options.indexAxis,scale:g.vScale,line:r}),g.$filler=T,d.push(T);for(v=0;v<h;++v)T=d[v],!(!T||T.fill===!1)&&(T.fill=J3(d,v,a.propagate))},beforeDraw(o,n,a){const h=a.drawTime==="beforeDraw",d=o.getSortedVisibleDatasetMetas(),g=o.chartArea;for(let v=d.length-1;v>=0;--v){const r=d[v].$filler;r&&(r.line.updateControlPoints(g,r.axis),h&&r.fill&&C_(o.ctx,r,g))}},beforeDatasetsDraw(o,n,a){if(a.drawTime!=="beforeDatasetsDraw")return;const h=o.getSortedVisibleDatasetMetas();for(let d=h.length-1;d>=0;--d){const g=h[d].$filler;sx(g)&&C_(o.ctx,g,o.chartArea)}},beforeDatasetDraw(o,n,a){const h=n.meta.$filler;!sx(h)||a.drawTime!=="beforeDatasetDraw"||C_(o.ctx,h,o.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const lx=(o,n)=>{let{boxHeight:a=n,boxWidth:h=n}=o;return o.usePointStyle&&(a=Math.min(a,n),h=o.pointStyleWidth||Math.min(h,n)),{boxWidth:h,boxHeight:a,itemHeight:Math.max(n,a)}},mM=(o,n)=>o!==null&&n!==null&&o.datasetIndex===n.datasetIndex&&o.index===n.index;class cx extends Ts{constructor(n){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=n.chart,this.options=n.options,this.ctx=n.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(n,a,h){this.maxWidth=n,this.maxHeight=a,this._margins=h,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const n=this.options.labels||{};let a=Ii(n.generateLabels,[this.chart],this)||[];n.filter&&(a=a.filter(h=>n.filter(h,this.chart.data))),n.sort&&(a=a.sort((h,d)=>n.sort(h,d,this.chart.data))),this.options.reverse&&a.reverse(),this.legendItems=a}fit(){const{options:n,ctx:a}=this;if(!n.display){this.width=this.height=0;return}const h=n.labels,d=hn(h.font),g=d.size,v=this._computeTitleHeight(),{boxWidth:r,itemHeight:T}=lx(h,g);let C,R;a.font=d.string,this.isHorizontal()?(C=this.maxWidth,R=this._fitRows(v,g,r,T)+10):(R=this.maxHeight,C=this._fitCols(v,d,r,T)+10),this.width=Math.min(C,n.maxWidth||this.maxWidth),this.height=Math.min(R,n.maxHeight||this.maxHeight)}_fitRows(n,a,h,d){const{ctx:g,maxWidth:v,options:{labels:{padding:r}}}=this,T=this.legendHitBoxes=[],C=this.lineWidths=[0],R=d+r;let F=n;g.textAlign="left",g.textBaseline="middle";let U=-1,Y=-R;return this.legendItems.forEach((ie,ce)=>{const he=h+a/2+g.measureText(ie.text).width;(ce===0||C[C.length-1]+he+2*r>v)&&(F+=R,C[C.length-(ce>0?0:1)]=0,Y+=R,U++),T[ce]={left:0,top:Y,row:U,width:he,height:d},C[C.length-1]+=he+r}),F}_fitCols(n,a,h,d){const{ctx:g,maxHeight:v,options:{labels:{padding:r}}}=this,T=this.legendHitBoxes=[],C=this.columnSizes=[],R=v-n;let F=r,U=0,Y=0,ie=0,ce=0;return this.legendItems.forEach((he,be)=>{const{itemWidth:Le,itemHeight:Fe}=gM(h,a,g,he,d);be>0&&Y+Fe+2*r>R&&(F+=U+r,C.push({width:U,height:Y}),ie+=U+r,ce++,U=Y=0),T[be]={left:ie,top:Y,col:ce,width:Le,height:Fe},U=Math.max(U,Le),Y+=Fe+r}),F+=U,C.push({width:U,height:Y}),F}adjustHitBoxes(){if(!this.options.display)return;const n=this._computeTitleHeight(),{legendHitBoxes:a,options:{align:h,labels:{padding:d},rtl:g}}=this,v=Xl(g,this.left,this.width);if(this.isHorizontal()){let r=0,T=Pn(h,this.left+d,this.right-this.lineWidths[r]);for(const C of a)r!==C.row&&(r=C.row,T=Pn(h,this.left+d,this.right-this.lineWidths[r])),C.top+=this.top+n+d,C.left=v.leftForLtr(v.x(T),C.width),T+=C.width+d}else{let r=0,T=Pn(h,this.top+n+d,this.bottom-this.columnSizes[r].height);for(const C of a)C.col!==r&&(r=C.col,T=Pn(h,this.top+n+d,this.bottom-this.columnSizes[r].height)),C.top=T,C.left+=this.left+d,C.left=v.leftForLtr(v.x(C.left),C.width),T+=C.height+d}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const n=this.ctx;Lp(n,this),this._draw(),Dp(n)}}_draw(){const{options:n,columnSizes:a,lineWidths:h,ctx:d}=this,{align:g,labels:v}=n,r=Ki.color,T=Xl(n.rtl,this.left,this.width),C=hn(v.font),{padding:R}=v,F=C.size,U=F/2;let Y;this.drawTitle(),d.textAlign=T.textAlign("left"),d.textBaseline="middle",d.lineWidth=.5,d.font=C.string;const{boxWidth:ie,boxHeight:ce,itemHeight:he}=lx(v,F),be=function(Je,nt,st){if(isNaN(ie)||ie<=0||isNaN(ce)||ce<0)return;d.save();const De=Vt(st.lineWidth,1);if(d.fillStyle=Vt(st.fillStyle,r),d.lineCap=Vt(st.lineCap,"butt"),d.lineDashOffset=Vt(st.lineDashOffset,0),d.lineJoin=Vt(st.lineJoin,"miter"),d.lineWidth=De,d.strokeStyle=Vt(st.strokeStyle,r),d.setLineDash(Vt(st.lineDash,[])),v.usePointStyle){const Dt={radius:ce*Math.SQRT2/2,pointStyle:st.pointStyle,rotation:st.rotation,borderWidth:De},zt=T.xPlus(Je,ie/2),ft=nt+U;Jx(d,Dt,zt,ft,v.pointStyleWidth&&ie)}else{const Dt=nt+Math.max((F-ce)/2,0),zt=T.leftForLtr(Je,ie),ft=Lo(st.borderRadius);d.beginPath(),Object.values(ft).some(Gt=>Gt!==0)?ko(d,{x:zt,y:Dt,w:ie,h:ce,radius:ft}):d.rect(zt,Dt,ie,ce),d.fill(),De!==0&&d.stroke()}d.restore()},Le=function(Je,nt,st){Ua(d,st.text,Je,nt+he/2,C,{strikethrough:st.hidden,textAlign:T.textAlign(st.textAlign)})},Fe=this.isHorizontal(),qe=this._computeTitleHeight();Fe?Y={x:Pn(g,this.left+R,this.right-h[0]),y:this.top+R+qe,line:0}:Y={x:this.left+R,y:Pn(g,this.top+qe+R,this.bottom-a[0].height),line:0},a1(this.ctx,n.textDirection);const Re=he+R;this.legendItems.forEach((Je,nt)=>{d.strokeStyle=Je.fontColor,d.fillStyle=Je.fontColor;const st=d.measureText(Je.text).width,De=T.textAlign(Je.textAlign||(Je.textAlign=v.textAlign)),Dt=ie+U+st;let zt=Y.x,ft=Y.y;T.setWidth(this.width),Fe?nt>0&&zt+Dt+R>this.right&&(ft=Y.y+=Re,Y.line++,zt=Y.x=Pn(g,this.left+R,this.right-h[Y.line])):nt>0&&ft+Re>this.bottom&&(zt=Y.x=zt+a[Y.line].width+R,Y.line++,ft=Y.y=Pn(g,this.top+qe+R,this.bottom-a[Y.line].height));const Gt=T.x(zt);if(be(Gt,ft,Je),zt=F2(De,zt+ie+U,Fe?zt+Dt:this.right,n.rtl),Le(T.x(zt),ft,Je),Fe)Y.x+=Dt+R;else if(typeof Je.text!="string"){const on=C.lineHeight;Y.y+=L1(Je,on)+R}else Y.y+=Re}),l1(this.ctx,n.textDirection)}drawTitle(){const n=this.options,a=n.title,h=hn(a.font),d=Ln(a.padding);if(!a.display)return;const g=Xl(n.rtl,this.left,this.width),v=this.ctx,r=a.position,T=h.size/2,C=d.top+T;let R,F=this.left,U=this.width;if(this.isHorizontal())U=Math.max(...this.lineWidths),R=this.top+C,F=Pn(n.align,F,this.right-U);else{const ie=this.columnSizes.reduce((ce,he)=>Math.max(ce,he.height),0);R=C+Pn(n.align,this.top,this.bottom-ie-n.labels.padding-this._computeTitleHeight())}const Y=Pn(r,F,F+U);v.textAlign=g.textAlign(hm(r)),v.textBaseline="middle",v.strokeStyle=a.color,v.fillStyle=a.color,v.font=h.string,Ua(v,a.text,Y,R,h)}_computeTitleHeight(){const n=this.options.title,a=hn(n.font),h=Ln(n.padding);return n.display?a.lineHeight+h.height:0}_getLegendItemAt(n,a){let h,d,g;if(Fr(n,this.left,this.right)&&Fr(a,this.top,this.bottom)){for(g=this.legendHitBoxes,h=0;h<g.length;++h)if(d=g[h],Fr(n,d.left,d.left+d.width)&&Fr(a,d.top,d.top+d.height))return this.legendItems[h]}return null}handleEvent(n){const a=this.options;if(!vM(n.type,a))return;const h=this._getLegendItemAt(n.x,n.y);if(n.type==="mousemove"||n.type==="mouseout"){const d=this._hoveredItem,g=mM(d,h);d&&!g&&Ii(a.onLeave,[n,d,this],this),this._hoveredItem=h,h&&!g&&Ii(a.onHover,[n,h,this],this)}else h&&Ii(a.onClick,[n,h,this],this)}}function gM(o,n,a,h,d){const g=yM(h,o,n,a),v=xM(d,h,n.lineHeight);return{itemWidth:g,itemHeight:v}}function yM(o,n,a,h){let d=o.text;return d&&typeof d!="string"&&(d=d.reduce((g,v)=>g.length>v.length?g:v)),n+a.size/2+h.measureText(d).width}function xM(o,n,a){let h=o;return typeof n.text!="string"&&(h=L1(n,a)),h}function L1(o,n){const a=o.text?o.text.length:0;return n*a}function vM(o,n){return!!((o==="mousemove"||o==="mouseout")&&(n.onHover||n.onLeave)||n.onClick&&(o==="click"||o==="mouseup"))}var bM={id:"legend",_element:cx,start(o,n,a){const h=o.legend=new cx({ctx:o.ctx,options:a,chart:o});kn.configure(o,h,a),kn.addBox(o,h)},stop(o){kn.removeBox(o,o.legend),delete o.legend},beforeUpdate(o,n,a){const h=o.legend;kn.configure(o,h,a),h.options=a},afterUpdate(o){const n=o.legend;n.buildLabels(),n.adjustHitBoxes()},afterEvent(o,n){n.replay||o.legend.handleEvent(n.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(o,n,a){const h=n.datasetIndex,d=a.chart;d.isDatasetVisible(h)?(d.hide(h),n.hidden=!0):(d.show(h),n.hidden=!1)},onHover:null,onLeave:null,labels:{color:o=>o.chart.options.color,boxWidth:40,padding:10,generateLabels(o){const n=o.data.datasets,{labels:{usePointStyle:a,pointStyle:h,textAlign:d,color:g,useBorderRadius:v,borderRadius:r}}=o.legend.options;return o._getSortedDatasetMetas().map(T=>{const C=T.controller.getStyle(a?0:void 0),R=Ln(C.borderWidth);return{text:n[T.index].label,fillStyle:C.backgroundColor,fontColor:g,hidden:!T.visible,lineCap:C.borderCapStyle,lineDash:C.borderDash,lineDashOffset:C.borderDashOffset,lineJoin:C.borderJoinStyle,lineWidth:(R.width+R.height)/4,strokeStyle:C.borderColor,pointStyle:h||C.pointStyle,rotation:C.rotation,textAlign:d||C.textAlign,borderRadius:v&&(r||C.borderRadius),datasetIndex:T.index}},this)}},title:{color:o=>o.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:o=>!o.startsWith("on"),labels:{_scriptable:o=>!["generateLabels","filter","sort"].includes(o)}}};class xm extends Ts{constructor(n){super(),this.chart=n.chart,this.options=n.options,this.ctx=n.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(n,a){const h=this.options;if(this.left=0,this.top=0,!h.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=n,this.height=this.bottom=a;const d=zi(h.text)?h.text.length:1;this._padding=Ln(h.padding);const g=d*hn(h.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=g:this.width=g}isHorizontal(){const n=this.options.position;return n==="top"||n==="bottom"}_drawArgs(n){const{top:a,left:h,bottom:d,right:g,options:v}=this,r=v.align;let T=0,C,R,F;return this.isHorizontal()?(R=Pn(r,h,g),F=a+n,C=g-h):(v.position==="left"?(R=h+n,F=Pn(r,d,a),T=Oi*-.5):(R=g-n,F=Pn(r,a,d),T=Oi*.5),C=d-a),{titleX:R,titleY:F,maxWidth:C,rotation:T}}draw(){const n=this.ctx,a=this.options;if(!a.display)return;const h=hn(a.font),g=h.lineHeight/2+this._padding.top,{titleX:v,titleY:r,maxWidth:T,rotation:C}=this._drawArgs(g);Ua(n,a.text,0,0,h,{color:a.color,maxWidth:T,rotation:C,textAlign:hm(a.align),textBaseline:"middle",translation:[v,r]})}}function wM(o,n){const a=new xm({ctx:o.ctx,options:n,chart:o});kn.configure(o,a,n),kn.addBox(o,a),o.titleBlock=a}var TM={id:"title",_element:xm,start(o,n,a){wM(o,a)},stop(o){const n=o.titleBlock;kn.removeBox(o,n),delete o.titleBlock},beforeUpdate(o,n,a){const h=o.titleBlock;kn.configure(o,h,a),h.options=a},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Kd=new WeakMap;var EM={id:"subtitle",start(o,n,a){const h=new xm({ctx:o.ctx,options:a,chart:o});kn.configure(o,h,a),kn.addBox(o,h),Kd.set(o,h)},stop(o){kn.removeBox(o,Kd.get(o)),Kd.delete(o)},beforeUpdate(o,n,a){const h=Kd.get(o);kn.configure(o,h,a),h.options=a},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Zh={average(o){if(!o.length)return!1;let n,a,h=0,d=0,g=0;for(n=0,a=o.length;n<a;++n){const v=o[n].element;if(v&&v.hasValue()){const r=v.tooltipPosition();h+=r.x,d+=r.y,++g}}return{x:h/g,y:d/g}},nearest(o,n){if(!o.length)return!1;let a=n.x,h=n.y,d=Number.POSITIVE_INFINITY,g,v,r;for(g=0,v=o.length;g<v;++g){const T=o[g].element;if(T&&T.hasValue()){const C=T.getCenterPoint(),R=j_(n,C);R<d&&(d=R,r=T)}}if(r){const T=r.tooltipPosition();a=T.x,h=T.y}return{x:a,y:h}}};function lr(o,n){return n&&(zi(n)?Array.prototype.push.apply(o,n):o.push(n)),o}function Or(o){return(typeof o=="string"||o instanceof String)&&o.indexOf(`
`)>-1?o.split(`
`):o}function MM(o,n){const{element:a,datasetIndex:h,index:d}=n,g=o.getDatasetMeta(h).controller,{label:v,value:r}=g.getLabelAndValue(d);return{chart:o,label:v,parsed:g.getParsed(d),raw:o.data.datasets[h].data[d],formattedValue:r,dataset:g.getDataset(),dataIndex:d,datasetIndex:h,element:a}}function hx(o,n){const a=o.chart.ctx,{body:h,footer:d,title:g}=o,{boxWidth:v,boxHeight:r}=n,T=hn(n.bodyFont),C=hn(n.titleFont),R=hn(n.footerFont),F=g.length,U=d.length,Y=h.length,ie=Ln(n.padding);let ce=ie.height,he=0,be=h.reduce((qe,Re)=>qe+Re.before.length+Re.lines.length+Re.after.length,0);if(be+=o.beforeBody.length+o.afterBody.length,F&&(ce+=F*C.lineHeight+(F-1)*n.titleSpacing+n.titleMarginBottom),be){const qe=n.displayColors?Math.max(r,T.lineHeight):T.lineHeight;ce+=Y*qe+(be-Y)*T.lineHeight+(be-1)*n.bodySpacing}U&&(ce+=n.footerMarginTop+U*R.lineHeight+(U-1)*n.footerSpacing);let Le=0;const Fe=function(qe){he=Math.max(he,a.measureText(qe).width+Le)};return a.save(),a.font=C.string,yi(o.title,Fe),a.font=T.string,yi(o.beforeBody.concat(o.afterBody),Fe),Le=n.displayColors?v+2+n.boxPadding:0,yi(h,qe=>{yi(qe.before,Fe),yi(qe.lines,Fe),yi(qe.after,Fe)}),Le=0,a.font=R.string,yi(o.footer,Fe),a.restore(),he+=ie.width,{width:he,height:ce}}function SM(o,n){const{y:a,height:h}=n;return a<h/2?"top":a>o.height-h/2?"bottom":"center"}function AM(o,n,a,h){const{x:d,width:g}=h,v=a.caretSize+a.caretPadding;if(o==="left"&&d+g+v>n.width||o==="right"&&d-g-v<0)return!0}function IM(o,n,a,h){const{x:d,width:g}=a,{width:v,chartArea:{left:r,right:T}}=o;let C="center";return h==="center"?C=d<=(r+T)/2?"left":"right":d<=g/2?C="left":d>=v-g/2&&(C="right"),AM(C,o,n,a)&&(C="center"),C}function ux(o,n,a){const h=a.yAlign||n.yAlign||SM(o,a);return{xAlign:a.xAlign||n.xAlign||IM(o,n,a,h),yAlign:h}}function CM(o,n){let{x:a,width:h}=o;return n==="right"?a-=h:n==="center"&&(a-=h/2),a}function PM(o,n,a){let{y:h,height:d}=o;return n==="top"?h+=a:n==="bottom"?h-=d+a:h-=d/2,h}function dx(o,n,a,h){const{caretSize:d,caretPadding:g,cornerRadius:v}=o,{xAlign:r,yAlign:T}=a,C=d+g,{topLeft:R,topRight:F,bottomLeft:U,bottomRight:Y}=Lo(v);let ie=CM(n,r);const ce=PM(n,T,C);return T==="center"?r==="left"?ie+=C:r==="right"&&(ie-=C):r==="left"?ie-=Math.max(R,U)+d:r==="right"&&(ie+=Math.max(F,Y)+d),{x:mn(ie,0,h.width-n.width),y:mn(ce,0,h.height-n.height)}}function Jd(o,n,a){const h=Ln(a.padding);return n==="center"?o.x+o.width/2:n==="right"?o.x+o.width-h.right:o.x+h.left}function px(o){return lr([],Or(o))}function kM(o,n,a){return Bo(o,{tooltip:n,tooltipItems:a,type:"tooltip"})}function fx(o,n){const a=n&&n.dataset&&n.dataset.tooltip&&n.dataset.tooltip.callbacks;return a?o.override(a):o}const D1={beforeTitle:zr,title(o){if(o.length>0){const n=o[0],a=n.chart.data.labels,h=a?a.length:0;if(this&&this.options&&this.options.mode==="dataset")return n.dataset.label||"";if(n.label)return n.label;if(h>0&&n.dataIndex<h)return a[n.dataIndex]}return""},afterTitle:zr,beforeBody:zr,beforeLabel:zr,label(o){if(this&&this.options&&this.options.mode==="dataset")return o.label+": "+o.formattedValue||o.formattedValue;let n=o.dataset.label||"";n&&(n+=": ");const a=o.formattedValue;return ei(a)||(n+=a),n},labelColor(o){const a=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{borderColor:a.borderColor,backgroundColor:a.backgroundColor,borderWidth:a.borderWidth,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(o){const a=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{pointStyle:a.pointStyle,rotation:a.rotation}},afterLabel:zr,afterBody:zr,beforeFooter:zr,footer:zr,afterFooter:zr};function Kn(o,n,a,h){const d=o[n].call(a,h);return typeof d>"u"?D1[n].call(a,h):d}class X_ extends Ts{constructor(n){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=n.chart,this.options=n.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(n){this.options=n,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const n=this._cachedAnimations;if(n)return n;const a=this.chart,h=this.options.setContext(this.getContext()),d=h.enabled&&a.options.animation&&h.animations,g=new d1(this.chart,d);return d._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=kM(this.chart.getContext(),this,this._tooltipItems))}getTitle(n,a){const{callbacks:h}=a,d=Kn(h,"beforeTitle",this,n),g=Kn(h,"title",this,n),v=Kn(h,"afterTitle",this,n);let r=[];return r=lr(r,Or(d)),r=lr(r,Or(g)),r=lr(r,Or(v)),r}getBeforeBody(n,a){return px(Kn(a.callbacks,"beforeBody",this,n))}getBody(n,a){const{callbacks:h}=a,d=[];return yi(n,g=>{const v={before:[],lines:[],after:[]},r=fx(h,g);lr(v.before,Or(Kn(r,"beforeLabel",this,g))),lr(v.lines,Kn(r,"label",this,g)),lr(v.after,Or(Kn(r,"afterLabel",this,g))),d.push(v)}),d}getAfterBody(n,a){return px(Kn(a.callbacks,"afterBody",this,n))}getFooter(n,a){const{callbacks:h}=a,d=Kn(h,"beforeFooter",this,n),g=Kn(h,"footer",this,n),v=Kn(h,"afterFooter",this,n);let r=[];return r=lr(r,Or(d)),r=lr(r,Or(g)),r=lr(r,Or(v)),r}_createItems(n){const a=this._active,h=this.chart.data,d=[],g=[],v=[];let r=[],T,C;for(T=0,C=a.length;T<C;++T)r.push(MM(this.chart,a[T]));return n.filter&&(r=r.filter((R,F,U)=>n.filter(R,F,U,h))),n.itemSort&&(r=r.sort((R,F)=>n.itemSort(R,F,h))),yi(r,R=>{const F=fx(n.callbacks,R);d.push(Kn(F,"labelColor",this,R)),g.push(Kn(F,"labelPointStyle",this,R)),v.push(Kn(F,"labelTextColor",this,R))}),this.labelColors=d,this.labelPointStyles=g,this.labelTextColors=v,this.dataPoints=r,r}update(n,a){const h=this.options.setContext(this.getContext()),d=this._active;let g,v=[];if(!d.length)this.opacity!==0&&(g={opacity:0});else{const r=Zh[h.position].call(this,d,this._eventPosition);v=this._createItems(h),this.title=this.getTitle(v,h),this.beforeBody=this.getBeforeBody(v,h),this.body=this.getBody(v,h),this.afterBody=this.getAfterBody(v,h),this.footer=this.getFooter(v,h);const T=this._size=hx(this,h),C=Object.assign({},r,T),R=ux(this.chart,h,C),F=dx(h,C,R,this.chart);this.xAlign=R.xAlign,this.yAlign=R.yAlign,g={opacity:1,x:F.x,y:F.y,width:T.width,height:T.height,caretX:r.x,caretY:r.y}}this._tooltipItems=v,this.$context=void 0,g&&this._resolveAnimations().update(this,g),n&&h.external&&h.external.call(this,{chart:this.chart,tooltip:this,replay:a})}drawCaret(n,a,h,d){const g=this.getCaretPosition(n,h,d);a.lineTo(g.x1,g.y1),a.lineTo(g.x2,g.y2),a.lineTo(g.x3,g.y3)}getCaretPosition(n,a,h){const{xAlign:d,yAlign:g}=this,{caretSize:v,cornerRadius:r}=h,{topLeft:T,topRight:C,bottomLeft:R,bottomRight:F}=Lo(r),{x:U,y:Y}=n,{width:ie,height:ce}=a;let he,be,Le,Fe,qe,Re;return g==="center"?(qe=Y+ce/2,d==="left"?(he=U,be=he-v,Fe=qe+v,Re=qe-v):(he=U+ie,be=he+v,Fe=qe-v,Re=qe+v),Le=he):(d==="left"?be=U+Math.max(T,R)+v:d==="right"?be=U+ie-Math.max(C,F)-v:be=this.caretX,g==="top"?(Fe=Y,qe=Fe-v,he=be-v,Le=be+v):(Fe=Y+ce,qe=Fe+v,he=be+v,Le=be-v),Re=Fe),{x1:he,x2:be,x3:Le,y1:Fe,y2:qe,y3:Re}}drawTitle(n,a,h){const d=this.title,g=d.length;let v,r,T;if(g){const C=Xl(h.rtl,this.x,this.width);for(n.x=Jd(this,h.titleAlign,h),a.textAlign=C.textAlign(h.titleAlign),a.textBaseline="middle",v=hn(h.titleFont),r=h.titleSpacing,a.fillStyle=h.titleColor,a.font=v.string,T=0;T<g;++T)a.fillText(d[T],C.x(n.x),n.y+v.lineHeight/2),n.y+=v.lineHeight+r,T+1===g&&(n.y+=h.titleMarginBottom-r)}}_drawColorBox(n,a,h,d,g){const v=this.labelColors[h],r=this.labelPointStyles[h],{boxHeight:T,boxWidth:C}=g,R=hn(g.bodyFont),F=Jd(this,"left",g),U=d.x(F),Y=T<R.lineHeight?(R.lineHeight-T)/2:0,ie=a.y+Y;if(g.usePointStyle){const ce={radius:Math.min(C,T)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},he=d.leftForLtr(U,C)+C/2,be=ie+T/2;n.strokeStyle=g.multiKeyBackground,n.fillStyle=g.multiKeyBackground,U_(n,ce,he,be),n.strokeStyle=v.borderColor,n.fillStyle=v.backgroundColor,U_(n,ce,he,be)}else{n.lineWidth=Ht(v.borderWidth)?Math.max(...Object.values(v.borderWidth)):v.borderWidth||1,n.strokeStyle=v.borderColor,n.setLineDash(v.borderDash||[]),n.lineDashOffset=v.borderDashOffset||0;const ce=d.leftForLtr(U,C),he=d.leftForLtr(d.xPlus(U,1),C-2),be=Lo(v.borderRadius);Object.values(be).some(Le=>Le!==0)?(n.beginPath(),n.fillStyle=g.multiKeyBackground,ko(n,{x:ce,y:ie,w:C,h:T,radius:be}),n.fill(),n.stroke(),n.fillStyle=v.backgroundColor,n.beginPath(),ko(n,{x:he,y:ie+1,w:C-2,h:T-2,radius:be}),n.fill()):(n.fillStyle=g.multiKeyBackground,n.fillRect(ce,ie,C,T),n.strokeRect(ce,ie,C,T),n.fillStyle=v.backgroundColor,n.fillRect(he,ie+1,C-2,T-2))}n.fillStyle=this.labelTextColors[h]}drawBody(n,a,h){const{body:d}=this,{bodySpacing:g,bodyAlign:v,displayColors:r,boxHeight:T,boxWidth:C,boxPadding:R}=h,F=hn(h.bodyFont);let U=F.lineHeight,Y=0;const ie=Xl(h.rtl,this.x,this.width),ce=function(st){a.fillText(st,ie.x(n.x+Y),n.y+U/2),n.y+=U+g},he=ie.textAlign(v);let be,Le,Fe,qe,Re,Je,nt;for(a.textAlign=v,a.textBaseline="middle",a.font=F.string,n.x=Jd(this,he,h),a.fillStyle=h.bodyColor,yi(this.beforeBody,ce),Y=r&&he!=="right"?v==="center"?C/2+R:C+2+R:0,qe=0,Je=d.length;qe<Je;++qe){for(be=d[qe],Le=this.labelTextColors[qe],a.fillStyle=Le,yi(be.before,ce),Fe=be.lines,r&&Fe.length&&(this._drawColorBox(a,n,qe,ie,h),U=Math.max(F.lineHeight,T)),Re=0,nt=Fe.length;Re<nt;++Re)ce(Fe[Re]),U=F.lineHeight;yi(be.after,ce)}Y=0,U=F.lineHeight,yi(this.afterBody,ce),n.y-=g}drawFooter(n,a,h){const d=this.footer,g=d.length;let v,r;if(g){const T=Xl(h.rtl,this.x,this.width);for(n.x=Jd(this,h.footerAlign,h),n.y+=h.footerMarginTop,a.textAlign=T.textAlign(h.footerAlign),a.textBaseline="middle",v=hn(h.footerFont),a.fillStyle=h.footerColor,a.font=v.string,r=0;r<g;++r)a.fillText(d[r],T.x(n.x),n.y+v.lineHeight/2),n.y+=v.lineHeight+h.footerSpacing}}drawBackground(n,a,h,d){const{xAlign:g,yAlign:v}=this,{x:r,y:T}=n,{width:C,height:R}=h,{topLeft:F,topRight:U,bottomLeft:Y,bottomRight:ie}=Lo(d.cornerRadius);a.fillStyle=d.backgroundColor,a.strokeStyle=d.borderColor,a.lineWidth=d.borderWidth,a.beginPath(),a.moveTo(r+F,T),v==="top"&&this.drawCaret(n,a,h,d),a.lineTo(r+C-U,T),a.quadraticCurveTo(r+C,T,r+C,T+U),v==="center"&&g==="right"&&this.drawCaret(n,a,h,d),a.lineTo(r+C,T+R-ie),a.quadraticCurveTo(r+C,T+R,r+C-ie,T+R),v==="bottom"&&this.drawCaret(n,a,h,d),a.lineTo(r+Y,T+R),a.quadraticCurveTo(r,T+R,r,T+R-Y),v==="center"&&g==="left"&&this.drawCaret(n,a,h,d),a.lineTo(r,T+F),a.quadraticCurveTo(r,T,r+F,T),a.closePath(),a.fill(),d.borderWidth>0&&a.stroke()}_updateAnimationTarget(n){const a=this.chart,h=this.$animations,d=h&&h.x,g=h&&h.y;if(d||g){const v=Zh[n.position].call(this,this._active,this._eventPosition);if(!v)return;const r=this._size=hx(this,n),T=Object.assign({},v,this._size),C=ux(a,n,T),R=dx(n,T,C,a);(d._to!==R.x||g._to!==R.y)&&(this.xAlign=C.xAlign,this.yAlign=C.yAlign,this.width=r.width,this.height=r.height,this.caretX=v.x,this.caretY=v.y,this._resolveAnimations().update(this,R))}}_willRender(){return!!this.opacity}draw(n){const a=this.options.setContext(this.getContext());let h=this.opacity;if(!h)return;this._updateAnimationTarget(a);const d={width:this.width,height:this.height},g={x:this.x,y:this.y};h=Math.abs(h)<.001?0:h;const v=Ln(a.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;a.enabled&&r&&(n.save(),n.globalAlpha=h,this.drawBackground(g,n,d,a),a1(n,a.textDirection),g.y+=v.top,this.drawTitle(g,n,a),this.drawBody(g,n,a),this.drawFooter(g,n,a),l1(n,a.textDirection),n.restore())}getActiveElements(){return this._active||[]}setActiveElements(n,a){const h=this._active,d=n.map(({datasetIndex:r,index:T})=>{const C=this.chart.getDatasetMeta(r);if(!C)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:C.data[T],index:T}}),g=!xp(h,d),v=this._positionChanged(d,a);(g||v)&&(this._active=d,this._eventPosition=a,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(n,a,h=!0){if(a&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const d=this.options,g=this._active||[],v=this._getActiveElements(n,g,a,h),r=this._positionChanged(v,n),T=a||!xp(v,g)||r;return T&&(this._active=v,(d.enabled||d.external)&&(this._eventPosition={x:n.x,y:n.y},this.update(!0,a))),T}_getActiveElements(n,a,h,d){const g=this.options;if(n.type==="mouseout")return[];if(!d)return a;const v=this.chart.getElementsAtEventForMode(n,g.mode,g,h);return g.reverse&&v.reverse(),v}_positionChanged(n,a){const{caretX:h,caretY:d,options:g}=this,v=Zh[g.position].call(this,n,a);return v!==!1&&(h!==v.x||d!==v.y)}}ct(X_,"positioners",Zh);var LM={id:"tooltip",_element:X_,positioners:Zh,afterInit(o,n,a){a&&(o.tooltip=new X_({chart:o,options:a}))},beforeUpdate(o,n,a){o.tooltip&&o.tooltip.initialize(a)},reset(o,n,a){o.tooltip&&o.tooltip.initialize(a)},afterDraw(o){const n=o.tooltip;if(n&&n._willRender()){const a={tooltip:n};if(o.notifyPlugins("beforeTooltipDraw",{...a,cancelable:!0})===!1)return;n.draw(o.ctx),o.notifyPlugins("afterTooltipDraw",a)}},afterEvent(o,n){if(o.tooltip){const a=n.replay;o.tooltip.handleEvent(n.event,a,n.inChartArea)&&(n.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(o,n)=>n.bodyFont.size,boxWidth:(o,n)=>n.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:D1},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:o=>o!=="filter"&&o!=="itemSort"&&o!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},DM=Object.freeze({__proto__:null,Colors:q3,Decimation:X3,Filler:_M,Legend:bM,SubTitle:EM,Title:TM,Tooltip:LM});const zM=(o,n,a,h)=>(typeof n=="string"?(a=o.push(n)-1,h.unshift({index:a,label:n})):isNaN(n)&&(a=null),a);function RM(o,n,a,h){const d=o.indexOf(n);if(d===-1)return zM(o,n,a,h);const g=o.lastIndexOf(n);return d!==g?a:d}const OM=(o,n)=>o===null?null:mn(Math.round(o),0,n);function _x(o){const n=this.getLabels();return o>=0&&o<n.length?n[o]:o}class Y_ extends Ga{constructor(n){super(n),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(n){const a=this._addedLabels;if(a.length){const h=this.getLabels();for(const{index:d,label:g}of a)h[d]===g&&h.splice(d,1);this._addedLabels=[]}super.init(n)}parse(n,a){if(ei(n))return null;const h=this.getLabels();return a=isFinite(a)&&h[a]===n?a:RM(h,n,Vt(a,n),this._addedLabels),OM(a,h.length-1)}determineDataLimits(){const{minDefined:n,maxDefined:a}=this.getUserBounds();let{min:h,max:d}=this.getMinMax(!0);this.options.bounds==="ticks"&&(n||(h=0),a||(d=this.getLabels().length-1)),this.min=h,this.max=d}buildTicks(){const n=this.min,a=this.max,h=this.options.offset,d=[];let g=this.getLabels();g=n===0&&a===g.length-1?g:g.slice(n,a+1),this._valueRange=Math.max(g.length-(h?0:1),1),this._startValue=this.min-(h?.5:0);for(let v=n;v<=a;v++)d.push({value:v});return d}getLabelForValue(n){return _x.call(this,n)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(n){return typeof n!="number"&&(n=this.parse(n)),n===null?NaN:this.getPixelForDecimal((n-this._startValue)/this._valueRange)}getPixelForTick(n){const a=this.ticks;return n<0||n>a.length-1?null:this.getPixelForValue(a[n].value)}getValueForPixel(n){return Math.round(this._startValue+this.getDecimalForPixel(n)*this._valueRange)}getBasePixel(){return this.bottom}}ct(Y_,"id","category"),ct(Y_,"defaults",{ticks:{callback:_x}});function BM(o,n){const a=[],{bounds:d,step:g,min:v,max:r,precision:T,count:C,maxTicks:R,maxDigits:F,includeBounds:U}=o,Y=g||1,ie=R-1,{min:ce,max:he}=n,be=!ei(v),Le=!ei(r),Fe=!ei(C),qe=(he-ce)/(F+1);let Re=cy((he-ce)/ie/Y)*Y,Je,nt,st,De;if(Re<1e-14&&!be&&!Le)return[{value:ce},{value:he}];De=Math.ceil(he/Re)-Math.floor(ce/Re),De>ie&&(Re=cy(De*Re/ie/Y)*Y),ei(T)||(Je=Math.pow(10,T),Re=Math.ceil(Re*Je)/Je),d==="ticks"?(nt=Math.floor(ce/Re)*Re,st=Math.ceil(he/Re)*Re):(nt=ce,st=he),be&&Le&&g&&k2((r-v)/g,Re/1e3)?(De=Math.round(Math.min((r-v)/Re,R)),Re=(r-v)/De,nt=v,st=r):Fe?(nt=be?v:nt,st=Le?r:st,De=C-1,Re=(st-nt)/De):(De=(st-nt)/Re,Qh(De,Math.round(De),Re/1e3)?De=Math.round(De):De=Math.ceil(De));const Dt=Math.max(hy(Re),hy(nt));Je=Math.pow(10,ei(T)?Dt:T),nt=Math.round(nt*Je)/Je,st=Math.round(st*Je)/Je;let zt=0;for(be&&(U&&nt!==v?(a.push({value:v}),nt<v&&zt++,Qh(Math.round((nt+zt*Re)*Je)/Je,v,mx(v,qe,o))&&zt++):nt<v&&zt++);zt<De;++zt){const ft=Math.round((nt+zt*Re)*Je)/Je;if(Le&&ft>r)break;a.push({value:ft})}return Le&&U&&st!==r?a.length&&Qh(a[a.length-1].value,r,mx(r,qe,o))?a[a.length-1].value=r:a.push({value:r}):(!Le||st===r)&&a.push({value:st}),a}function mx(o,n,{horizontal:a,minRotation:h}){const d=Ws(h),g=(a?Math.sin(d):Math.cos(d))||.001,v=.75*n*(""+o).length;return Math.min(n/g,v)}class Sp extends Ga{constructor(n){super(n),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(n,a){return ei(n)||(typeof n=="number"||n instanceof Number)&&!isFinite(+n)?null:+n}handleTickRangeOptions(){const{beginAtZero:n}=this.options,{minDefined:a,maxDefined:h}=this.getUserBounds();let{min:d,max:g}=this;const v=T=>d=a?d:T,r=T=>g=h?g:T;if(n){const T=hr(d),C=hr(g);T<0&&C<0?r(0):T>0&&C>0&&v(0)}if(d===g){let T=g===0?1:Math.abs(g*.05);r(g+T),n||v(d-T)}this.min=d,this.max=g}getTickLimit(){const n=this.options.ticks;let{maxTicksLimit:a,stepSize:h}=n,d;return h?(d=Math.ceil(this.max/h)-Math.floor(this.min/h)+1,d>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${h} would result generating up to ${d} ticks. Limiting to 1000.`),d=1e3)):(d=this.computeTickLimit(),a=a||11),a&&(d=Math.min(a,d)),d}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const n=this.options,a=n.ticks;let h=this.getTickLimit();h=Math.max(2,h);const d={maxTicks:h,bounds:n.bounds,min:n.min,max:n.max,precision:a.precision,step:a.stepSize,count:a.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:a.minRotation||0,includeBounds:a.includeBounds!==!1},g=this._range||this,v=BM(d,g);return n.bounds==="ticks"&&Gx(v,this,"value"),n.reverse?(v.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),v}configure(){const n=this.ticks;let a=this.min,h=this.max;if(super.configure(),this.options.offset&&n.length){const d=(h-a)/Math.max(n.length-1,1)/2;a-=d,h+=d}this._startValue=a,this._endValue=h,this._valueRange=h-a}getLabelForValue(n){return pu(n,this.chart.options.locale,this.options.ticks.format)}}class K_ extends Sp{determineDataLimits(){const{min:n,max:a}=this.getMinMax(!0);this.min=Yi(n)?n:0,this.max=Yi(a)?a:1,this.handleTickRangeOptions()}computeTickLimit(){const n=this.isHorizontal(),a=n?this.width:this.height,h=Ws(this.options.ticks.minRotation),d=(n?Math.sin(h):Math.cos(h))||.001,g=this._resolveTickFontOptions(0);return Math.ceil(a/Math.min(40,g.lineHeight/d))}getPixelForValue(n){return n===null?NaN:this.getPixelForDecimal((n-this._startValue)/this._valueRange)}getValueForPixel(n){return this._startValue+this.getDecimalForPixel(n)*this._valueRange}}ct(K_,"id","linear"),ct(K_,"defaults",{ticks:{callback:kp.formatters.numeric}});const lu=o=>Math.floor(Ao(o)),Da=(o,n)=>Math.pow(10,lu(o)+n);function gx(o){return o/Math.pow(10,lu(o))===1}function yx(o,n,a){const h=Math.pow(10,a),d=Math.floor(o/h);return Math.ceil(n/h)-d}function FM(o,n){const a=n-o;let h=lu(a);for(;yx(o,n,h)>10;)h++;for(;yx(o,n,h)<10;)h--;return Math.min(h,lu(o))}function NM(o,{min:n,max:a}){n=as(o.min,n);const h=[],d=lu(n);let g=FM(n,a),v=g<0?Math.pow(10,Math.abs(g)):1;const r=Math.pow(10,g),T=d>g?Math.pow(10,d):0,C=Math.round((n-T)*v)/v,R=Math.floor((n-T)/r/10)*r*10;let F=Math.floor((C-R)/Math.pow(10,g)),U=as(o.min,Math.round((T+R+F*Math.pow(10,g))*v)/v);for(;U<a;)h.push({value:U,major:gx(U),significand:F}),F>=10?F=F<15?15:20:F++,F>=20&&(g++,F=2,v=g>=0?1:v),U=Math.round((T+R+F*Math.pow(10,g))*v)/v;const Y=as(o.max,U);return h.push({value:Y,major:gx(Y),significand:F}),h}class J_ extends Ga{constructor(n){super(n),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(n,a){const h=Sp.prototype.parse.apply(this,[n,a]);if(h===0){this._zero=!0;return}return Yi(h)&&h>0?h:null}determineDataLimits(){const{min:n,max:a}=this.getMinMax(!0);this.min=Yi(n)?Math.max(0,n):null,this.max=Yi(a)?Math.max(0,a):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Yi(this._userMin)&&(this.min=n===Da(this.min,0)?Da(this.min,-1):Da(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:n,maxDefined:a}=this.getUserBounds();let h=this.min,d=this.max;const g=r=>h=n?h:r,v=r=>d=a?d:r;h===d&&(h<=0?(g(1),v(10)):(g(Da(h,-1)),v(Da(d,1)))),h<=0&&g(Da(d,-1)),d<=0&&v(Da(h,1)),this.min=h,this.max=d}buildTicks(){const n=this.options,a={min:this._userMin,max:this._userMax},h=NM(a,this);return n.bounds==="ticks"&&Gx(h,this,"value"),n.reverse?(h.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),h}getLabelForValue(n){return n===void 0?"0":pu(n,this.chart.options.locale,this.options.ticks.format)}configure(){const n=this.min;super.configure(),this._startValue=Ao(n),this._valueRange=Ao(this.max)-Ao(n)}getPixelForValue(n){return(n===void 0||n===0)&&(n=this.min),n===null||isNaN(n)?NaN:this.getPixelForDecimal(n===this.min?0:(Ao(n)-this._startValue)/this._valueRange)}getValueForPixel(n){const a=this.getDecimalForPixel(n);return Math.pow(10,this._startValue+a*this._valueRange)}}ct(J_,"id","logarithmic"),ct(J_,"defaults",{ticks:{callback:kp.formatters.logarithmic,major:{enabled:!0}}});function Q_(o){const n=o.ticks;if(n.display&&o.display){const a=Ln(n.backdropPadding);return Vt(n.font&&n.font.size,Ki.font.size)+a.height}return 0}function jM(o,n,a){return a=zi(a)?a:[a],{w:H2(o,n.string,a),h:a.length*n.lineHeight}}function xx(o,n,a,h,d){return o===h||o===d?{start:n-a/2,end:n+a/2}:o<h||o>d?{start:n-a,end:n}:{start:n,end:n+a}}function VM(o){const n={l:o.left+o._padding.left,r:o.right-o._padding.right,t:o.top+o._padding.top,b:o.bottom-o._padding.bottom},a=Object.assign({},n),h=[],d=[],g=o._pointLabels.length,v=o.options.pointLabels,r=v.centerPointLabels?Oi/g:0;for(let T=0;T<g;T++){const C=v.setContext(o.getPointLabelContext(T));d[T]=C.padding;const R=o.getPointPosition(T,o.drawingArea+d[T],r),F=hn(C.font),U=jM(o.ctx,F,o._pointLabels[T]);h[T]=U;const Y=ls(o.getIndexAngle(T)+r),ie=Math.round(lm(Y)),ce=xx(ie,R.x,U.w,0,180),he=xx(ie,R.y,U.h,90,270);UM(a,n,Y,ce,he)}o.setCenterPoint(n.l-a.l,a.r-n.r,n.t-a.t,a.b-n.b),o._pointLabelItems=qM(o,h,d)}function UM(o,n,a,h,d){const g=Math.abs(Math.sin(a)),v=Math.abs(Math.cos(a));let r=0,T=0;h.start<n.l?(r=(n.l-h.start)/g,o.l=Math.min(o.l,n.l-r)):h.end>n.r&&(r=(h.end-n.r)/g,o.r=Math.max(o.r,n.r+r)),d.start<n.t?(T=(n.t-d.start)/v,o.t=Math.min(o.t,n.t-T)):d.end>n.b&&(T=(d.end-n.b)/v,o.b=Math.max(o.b,n.b+T))}function GM(o,n,a){const h=o.drawingArea,{extra:d,additionalAngle:g,padding:v,size:r}=a,T=o.getPointPosition(n,h+d+v,g),C=Math.round(lm(ls(T.angle+Ji))),R=HM(T.y,r.h,C),F=WM(C),U=ZM(T.x,r.w,F);return{visible:!0,x:T.x,y:R,textAlign:F,left:U,top:R,right:U+r.w,bottom:R+r.h}}function $M(o,n){if(!n)return!0;const{left:a,top:h,right:d,bottom:g}=o;return!(jr({x:a,y:h},n)||jr({x:a,y:g},n)||jr({x:d,y:h},n)||jr({x:d,y:g},n))}function qM(o,n,a){const h=[],d=o._pointLabels.length,g=o.options,{centerPointLabels:v,display:r}=g.pointLabels,T={extra:Q_(g)/2,additionalAngle:v?Oi/d:0};let C;for(let R=0;R<d;R++){T.padding=a[R],T.size=n[R];const F=GM(o,R,T);h.push(F),r==="auto"&&(F.visible=$M(F,C),F.visible&&(C=F))}return h}function WM(o){return o===0||o===180?"center":o<180?"left":"right"}function ZM(o,n,a){return a==="right"?o-=n:a==="center"&&(o-=n/2),o}function HM(o,n,a){return a===90||a===270?o-=n/2:(a>270||a<90)&&(o-=n),o}function XM(o,n,a){const{left:h,top:d,right:g,bottom:v}=a,{backdropColor:r}=n;if(!ei(r)){const T=Lo(n.borderRadius),C=Ln(n.backdropPadding);o.fillStyle=r;const R=h-C.left,F=d-C.top,U=g-h+C.width,Y=v-d+C.height;Object.values(T).some(ie=>ie!==0)?(o.beginPath(),ko(o,{x:R,y:F,w:U,h:Y,radius:T}),o.fill()):o.fillRect(R,F,U,Y)}}function YM(o,n){const{ctx:a,options:{pointLabels:h}}=o;for(let d=n-1;d>=0;d--){const g=o._pointLabelItems[d];if(!g.visible)continue;const v=h.setContext(o.getPointLabelContext(d));XM(a,v,g);const r=hn(v.font),{x:T,y:C,textAlign:R}=g;Ua(a,o._pointLabels[d],T,C+r.lineHeight/2,r,{color:v.color,textAlign:R,textBaseline:"middle"})}}function z1(o,n,a,h){const{ctx:d}=o;if(a)d.arc(o.xCenter,o.yCenter,n,0,Ri);else{let g=o.getPointPosition(0,n);d.moveTo(g.x,g.y);for(let v=1;v<h;v++)g=o.getPointPosition(v,n),d.lineTo(g.x,g.y)}}function KM(o,n,a,h,d){const g=o.ctx,v=n.circular,{color:r,lineWidth:T}=n;!v&&!h||!r||!T||a<0||(g.save(),g.strokeStyle=r,g.lineWidth=T,g.setLineDash(d.dash),g.lineDashOffset=d.dashOffset,g.beginPath(),z1(o,a,v,h),g.closePath(),g.stroke(),g.restore())}function JM(o,n,a){return Bo(o,{label:a,index:n,type:"pointLabel"})}class Hh extends Sp{constructor(n){super(n),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const n=this._padding=Ln(Q_(this.options)/2),a=this.width=this.maxWidth-n.width,h=this.height=this.maxHeight-n.height;this.xCenter=Math.floor(this.left+a/2+n.left),this.yCenter=Math.floor(this.top+h/2+n.top),this.drawingArea=Math.floor(Math.min(a,h)/2)}determineDataLimits(){const{min:n,max:a}=this.getMinMax(!1);this.min=Yi(n)&&!isNaN(n)?n:0,this.max=Yi(a)&&!isNaN(a)?a:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Q_(this.options))}generateTickLabels(n){Sp.prototype.generateTickLabels.call(this,n),this._pointLabels=this.getLabels().map((a,h)=>{const d=Ii(this.options.pointLabels.callback,[a,h],this);return d||d===0?d:""}).filter((a,h)=>this.chart.getDataVisibility(h))}fit(){const n=this.options;n.display&&n.pointLabels.display?VM(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(n,a,h,d){this.xCenter+=Math.floor((n-a)/2),this.yCenter+=Math.floor((h-d)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(n,a,h,d))}getIndexAngle(n){const a=Ri/(this._pointLabels.length||1),h=this.options.startAngle||0;return ls(n*a+Ws(h))}getDistanceFromCenterForValue(n){if(ei(n))return NaN;const a=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-n)*a:(n-this.min)*a}getValueForDistanceFromCenter(n){if(ei(n))return NaN;const a=n/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-a:this.min+a}getPointLabelContext(n){const a=this._pointLabels||[];if(n>=0&&n<a.length){const h=a[n];return JM(this.getContext(),n,h)}}getPointPosition(n,a,h=0){const d=this.getIndexAngle(n)-Ji+h;return{x:Math.cos(d)*a+this.xCenter,y:Math.sin(d)*a+this.yCenter,angle:d}}getPointPositionForValue(n,a){return this.getPointPosition(n,this.getDistanceFromCenterForValue(a))}getBasePosition(n){return this.getPointPositionForValue(n||0,this.getBaseValue())}getPointLabelPosition(n){const{left:a,top:h,right:d,bottom:g}=this._pointLabelItems[n];return{left:a,top:h,right:d,bottom:g}}drawBackground(){const{backgroundColor:n,grid:{circular:a}}=this.options;if(n){const h=this.ctx;h.save(),h.beginPath(),z1(this,this.getDistanceFromCenterForValue(this._endValue),a,this._pointLabels.length),h.closePath(),h.fillStyle=n,h.fill(),h.restore()}}drawGrid(){const n=this.ctx,a=this.options,{angleLines:h,grid:d,border:g}=a,v=this._pointLabels.length;let r,T,C;if(a.pointLabels.display&&YM(this,v),d.display&&this.ticks.forEach((R,F)=>{if(F!==0){T=this.getDistanceFromCenterForValue(R.value);const U=this.getContext(F),Y=d.setContext(U),ie=g.setContext(U);KM(this,Y,T,v,ie)}}),h.display){for(n.save(),r=v-1;r>=0;r--){const R=h.setContext(this.getPointLabelContext(r)),{color:F,lineWidth:U}=R;!U||!F||(n.lineWidth=U,n.strokeStyle=F,n.setLineDash(R.borderDash),n.lineDashOffset=R.borderDashOffset,T=this.getDistanceFromCenterForValue(a.ticks.reverse?this.min:this.max),C=this.getPointPosition(r,T),n.beginPath(),n.moveTo(this.xCenter,this.yCenter),n.lineTo(C.x,C.y),n.stroke())}n.restore()}}drawBorder(){}drawLabels(){const n=this.ctx,a=this.options,h=a.ticks;if(!h.display)return;const d=this.getIndexAngle(0);let g,v;n.save(),n.translate(this.xCenter,this.yCenter),n.rotate(d),n.textAlign="center",n.textBaseline="middle",this.ticks.forEach((r,T)=>{if(T===0&&!a.reverse)return;const C=h.setContext(this.getContext(T)),R=hn(C.font);if(g=this.getDistanceFromCenterForValue(this.ticks[T].value),C.showLabelBackdrop){n.font=R.string,v=n.measureText(r.label).width,n.fillStyle=C.backdropColor;const F=Ln(C.backdropPadding);n.fillRect(-v/2-F.left,-g-R.size/2-F.top,v+F.width,R.size+F.height)}Ua(n,r.label,0,-g,R,{color:C.color,strokeColor:C.textStrokeColor,strokeWidth:C.textStrokeWidth})}),n.restore()}drawTitle(){}}ct(Hh,"id","radialLinear"),ct(Hh,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:kp.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(n){return n},padding:5,centerPointLabels:!1}}),ct(Hh,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),ct(Hh,"descriptors",{angleLines:{_fallback:"grid"}});const Rp={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Jn=Object.keys(Rp);function vx(o,n){return o-n}function bx(o,n){if(ei(n))return null;const a=o._adapter,{parser:h,round:d,isoWeekday:g}=o._parseOpts;let v=n;return typeof h=="function"&&(v=h(v)),Yi(v)||(v=typeof h=="string"?a.parse(v,h):a.parse(v)),v===null?null:(d&&(v=d==="week"&&(Ql(g)||g===!0)?a.startOf(v,"isoWeek",g):a.startOf(v,d)),+v)}function wx(o,n,a,h){const d=Jn.length;for(let g=Jn.indexOf(o);g<d-1;++g){const v=Rp[Jn[g]],r=v.steps?v.steps:Number.MAX_SAFE_INTEGER;if(v.common&&Math.ceil((a-n)/(r*v.size))<=h)return Jn[g]}return Jn[d-1]}function QM(o,n,a,h,d){for(let g=Jn.length-1;g>=Jn.indexOf(a);g--){const v=Jn[g];if(Rp[v].common&&o._adapter.diff(d,h,v)>=n-1)return v}return Jn[a?Jn.indexOf(a):0]}function eS(o){for(let n=Jn.indexOf(o)+1,a=Jn.length;n<a;++n)if(Rp[Jn[n]].common)return Jn[n]}function Tx(o,n,a){if(!a)o[n]=!0;else if(a.length){const{lo:h,hi:d}=cm(a,n),g=a[h]>=n?a[h]:a[d];o[g]=!0}}function tS(o,n,a,h){const d=o._adapter,g=+d.startOf(n[0].value,h),v=n[n.length-1].value;let r,T;for(r=g;r<=v;r=+d.add(r,1,h))T=a[r],T>=0&&(n[T].major=!0);return n}function Ex(o,n,a){const h=[],d={},g=n.length;let v,r;for(v=0;v<g;++v)r=n[v],d[r]=v,h.push({value:r,major:!1});return g===0||!a?h:tS(o,h,d,a)}class cu extends Ga{constructor(n){super(n),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(n,a={}){const h=n.time||(n.time={}),d=this._adapter=new hE._date(n.adapters.date);d.init(a),Jh(h.displayFormats,d.formats()),this._parseOpts={parser:h.parser,round:h.round,isoWeekday:h.isoWeekday},super.init(n),this._normalized=a.normalized}parse(n,a){return n===void 0?null:bx(this,n)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const n=this.options,a=this._adapter,h=n.time.unit||"day";let{min:d,max:g,minDefined:v,maxDefined:r}=this.getUserBounds();function T(C){!v&&!isNaN(C.min)&&(d=Math.min(d,C.min)),!r&&!isNaN(C.max)&&(g=Math.max(g,C.max))}(!v||!r)&&(T(this._getLabelBounds()),(n.bounds!=="ticks"||n.ticks.source!=="labels")&&T(this.getMinMax(!1))),d=Yi(d)&&!isNaN(d)?d:+a.startOf(Date.now(),h),g=Yi(g)&&!isNaN(g)?g:+a.endOf(Date.now(),h)+1,this.min=Math.min(d,g-1),this.max=Math.max(d+1,g)}_getLabelBounds(){const n=this.getLabelTimestamps();let a=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY;return n.length&&(a=n[0],h=n[n.length-1]),{min:a,max:h}}buildTicks(){const n=this.options,a=n.time,h=n.ticks,d=h.source==="labels"?this.getLabelTimestamps():this._generate();n.bounds==="ticks"&&d.length&&(this.min=this._userMin||d[0],this.max=this._userMax||d[d.length-1]);const g=this.min,v=this.max,r=R2(d,g,v);return this._unit=a.unit||(h.autoSkip?wx(a.minUnit,this.min,this.max,this._getLabelCapacity(g)):QM(this,r.length,a.minUnit,this.min,this.max)),this._majorUnit=!h.major.enabled||this._unit==="year"?void 0:eS(this._unit),this.initOffsets(d),n.reverse&&r.reverse(),Ex(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(n=>+n.value))}initOffsets(n=[]){let a=0,h=0,d,g;this.options.offset&&n.length&&(d=this.getDecimalForValue(n[0]),n.length===1?a=1-d:a=(this.getDecimalForValue(n[1])-d)/2,g=this.getDecimalForValue(n[n.length-1]),n.length===1?h=g:h=(g-this.getDecimalForValue(n[n.length-2]))/2);const v=n.length<3?.5:.25;a=mn(a,0,v),h=mn(h,0,v),this._offsets={start:a,end:h,factor:1/(a+1+h)}}_generate(){const n=this._adapter,a=this.min,h=this.max,d=this.options,g=d.time,v=g.unit||wx(g.minUnit,a,h,this._getLabelCapacity(a)),r=Vt(d.ticks.stepSize,1),T=v==="week"?g.isoWeekday:!1,C=Ql(T)||T===!0,R={};let F=a,U,Y;if(C&&(F=+n.startOf(F,"isoWeek",T)),F=+n.startOf(F,C?"day":v),n.diff(h,a,v)>1e5*r)throw new Error(a+" and "+h+" are too far apart with stepSize of "+r+" "+v);const ie=d.ticks.source==="data"&&this.getDataTimestamps();for(U=F,Y=0;U<h;U=+n.add(U,r,v),Y++)Tx(R,U,ie);return(U===h||d.bounds==="ticks"||Y===1)&&Tx(R,U,ie),Object.keys(R).sort(vx).map(ce=>+ce)}getLabelForValue(n){const a=this._adapter,h=this.options.time;return h.tooltipFormat?a.format(n,h.tooltipFormat):a.format(n,h.displayFormats.datetime)}format(n,a){const d=this.options.time.displayFormats,g=this._unit,v=a||d[g];return this._adapter.format(n,v)}_tickFormatFunction(n,a,h,d){const g=this.options,v=g.ticks.callback;if(v)return Ii(v,[n,a,h],this);const r=g.time.displayFormats,T=this._unit,C=this._majorUnit,R=T&&r[T],F=C&&r[C],U=h[a],Y=C&&F&&U&&U.major;return this._adapter.format(n,d||(Y?F:R))}generateTickLabels(n){let a,h,d;for(a=0,h=n.length;a<h;++a)d=n[a],d.label=this._tickFormatFunction(d.value,a,n)}getDecimalForValue(n){return n===null?NaN:(n-this.min)/(this.max-this.min)}getPixelForValue(n){const a=this._offsets,h=this.getDecimalForValue(n);return this.getPixelForDecimal((a.start+h)*a.factor)}getValueForPixel(n){const a=this._offsets,h=this.getDecimalForPixel(n)/a.factor-a.end;return this.min+h*(this.max-this.min)}_getLabelSize(n){const a=this.options.ticks,h=this.ctx.measureText(n).width,d=Ws(this.isHorizontal()?a.maxRotation:a.minRotation),g=Math.cos(d),v=Math.sin(d),r=this._resolveTickFontOptions(0).size;return{w:h*g+r*v,h:h*v+r*g}}_getLabelCapacity(n){const a=this.options.time,h=a.displayFormats,d=h[a.unit]||h.millisecond,g=this._tickFormatFunction(n,0,Ex(this,[n],this._majorUnit),d),v=this._getLabelSize(g),r=Math.floor(this.isHorizontal()?this.width/v.w:this.height/v.h)-1;return r>0?r:1}getDataTimestamps(){let n=this._cache.data||[],a,h;if(n.length)return n;const d=this.getMatchingVisibleMetas();if(this._normalized&&d.length)return this._cache.data=d[0].controller.getAllParsedValues(this);for(a=0,h=d.length;a<h;++a)n=n.concat(d[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(n)}getLabelTimestamps(){const n=this._cache.labels||[];let a,h;if(n.length)return n;const d=this.getLabels();for(a=0,h=d.length;a<h;++a)n.push(bx(this,d[a]));return this._cache.labels=this._normalized?n:this.normalize(n)}normalize(n){return Wx(n.sort(vx))}}ct(cu,"id","time"),ct(cu,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Qd(o,n,a){let h=0,d=o.length-1,g,v,r,T;a?(n>=o[h].pos&&n<=o[d].pos&&({lo:h,hi:d}=Nr(o,"pos",n)),{pos:g,time:r}=o[h],{pos:v,time:T}=o[d]):(n>=o[h].time&&n<=o[d].time&&({lo:h,hi:d}=Nr(o,"time",n)),{time:g,pos:r}=o[h],{time:v,pos:T}=o[d]);const C=v-g;return C?r+(T-r)*(n-g)/C:r}class em extends cu{constructor(n){super(n),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const n=this._getTimestampsForTable(),a=this._table=this.buildLookupTable(n);this._minPos=Qd(a,this.min),this._tableRange=Qd(a,this.max)-this._minPos,super.initOffsets(n)}buildLookupTable(n){const{min:a,max:h}=this,d=[],g=[];let v,r,T,C,R;for(v=0,r=n.length;v<r;++v)C=n[v],C>=a&&C<=h&&d.push(C);if(d.length<2)return[{time:a,pos:0},{time:h,pos:1}];for(v=0,r=d.length;v<r;++v)R=d[v+1],T=d[v-1],C=d[v],Math.round((R+T)/2)!==C&&g.push({time:C,pos:v/(r-1)});return g}_generate(){const n=this.min,a=this.max;let h=super.getDataTimestamps();return(!h.includes(n)||!h.length)&&h.splice(0,0,n),(!h.includes(a)||h.length===1)&&h.push(a),h.sort((d,g)=>d-g)}_getTimestampsForTable(){let n=this._cache.all||[];if(n.length)return n;const a=this.getDataTimestamps(),h=this.getLabelTimestamps();return a.length&&h.length?n=this.normalize(a.concat(h)):n=a.length?a:h,n=this._cache.all=n,n}getDecimalForValue(n){return(Qd(this._table,n)-this._minPos)/this._tableRange}getValueForPixel(n){const a=this._offsets,h=this.getDecimalForPixel(n)/a.factor-a.end;return Qd(this._table,h*this._tableRange+this._minPos,!0)}}ct(em,"id","timeseries"),ct(em,"defaults",cu.defaults);var iS=Object.freeze({__proto__:null,CategoryScale:Y_,LinearScale:K_,LogarithmicScale:J_,RadialLinearScale:Hh,TimeScale:cu,TimeSeriesScale:em});const nS=[cE,N3,DM,iS];/*!
 * chartjs-chart-matrix v2.0.1
 * https://chartjs-chart-matrix.pages.dev/
 * (c) 2023 Jukka Kurkela
 * Released under the MIT license
 */var sS="2.0.1";class Xh extends ws{initialize(){this.enableOptionSharing=!0,super.initialize()}update(n){const a=this,h=a._cachedMeta;a.updateElements(h.data,0,h.data.length,n)}updateElements(n,a,h,d){const g=this,v=d==="reset",{xScale:r,yScale:T}=g._cachedMeta,C=g.resolveDataElementOptions(a,d),R=g.getSharedOptions(d,n[a],C);for(let F=a;F<a+h;F++){const U=!v&&g.getParsed(F),Y=v?r.getBasePixel():r.getPixelForValue(U.x),ie=v?T.getBasePixel():T.getPixelForValue(U.y),ce=g.resolveDataElementOptions(F,d),{width:he,height:be,anchorX:Le,anchorY:Fe}=ce,qe={x:rS(Le,Y,he),y:oS(Fe,ie,be),width:he,height:be,options:ce};g.updateElement(n[F],F,qe,d)}g.updateSharedOptions(R,d)}draw(){const n=this,a=n.getMeta().data||[];let h,d;for(h=0,d=a.length;h<d;++h)a[h].draw(n._ctx)}}ct(Xh,"id","matrix"),ct(Xh,"version",sS),ct(Xh,"defaults",{dataElementType:"matrix",animations:{numbers:{type:"number",properties:["x","y","width","height"]}}}),ct(Xh,"overrides",{interaction:{mode:"nearest",intersect:!0},scales:{x:{type:"linear",offset:!0},y:{type:"linear",reverse:!0}}});function rS(o,n,a){return o==="left"||o==="start"?n:o==="right"||o==="end"?n-a:n-a/2}function oS(o,n,a){return o==="top"||o==="start"?n:o==="bottom"||o==="end"?n-a:n-a/2}function R1(o,n){const{x:a,y:h,width:d,height:g}=o.getProps(["x","y","width","height"],n);return{left:a,top:h,right:a+d,bottom:h+g}}function ep(o,n,a){return Math.max(Math.min(o,a),n)}function aS(o,n,a){const h=o.options.borderWidth;let d,g,v,r;return Ht(h)?(d=+h.top||0,g=+h.right||0,v=+h.bottom||0,r=+h.left||0):d=g=v=r=+h||0,{t:ep(d,0,a),r:ep(g,0,n),b:ep(v,0,a),l:ep(r,0,n)}}function lS(o){const n=R1(o),a=n.right-n.left,h=n.bottom-n.top,d=aS(o,a/2,h/2);return{outer:{x:n.left,y:n.top,w:a,h},inner:{x:n.left+d.l,y:n.top+d.t,w:a-d.l-d.r,h:h-d.t-d.b}}}function P_(o,n,a,h){const d=n===null,g=a===null,v=!o||d&&g?!1:R1(o,h);return v&&(d||n>=v.left&&n<=v.right)&&(g||a>=v.top&&a<=v.bottom)}class tm extends Ts{constructor(n){super(),this.options=void 0,this.width=void 0,this.height=void 0,n&&Object.assign(this,n)}draw(n){const a=this.options,{inner:h,outer:d}=lS(this),g=Lo(a.borderRadius);n.save(),d.w!==h.w||d.h!==h.h?(n.beginPath(),ko(n,{x:d.x,y:d.y,w:d.w,h:d.h,radius:g}),ko(n,{x:h.x,y:h.y,w:h.w,h:h.h,radius:g}),n.fillStyle=a.backgroundColor,n.fill(),n.fillStyle=a.borderColor,n.fill("evenodd")):(n.beginPath(),ko(n,{x:h.x,y:h.y,w:h.w,h:h.h,radius:g}),n.fillStyle=a.backgroundColor,n.fill()),n.restore()}inRange(n,a,h){return P_(this,n,a,h)}inXRange(n,a){return P_(this,n,null,a)}inYRange(n,a){return P_(this,null,n,a)}getCenterPoint(n){const{x:a,y:h,width:d,height:g}=this.getProps(["x","y","width","height"],n);return{x:a+d/2,y:h+g/2}}tooltipPosition(){return this.getCenterPoint()}getRange(n){return n==="x"?this.width/2:this.height/2}}ct(tm,"id","matrix"),ct(tm,"defaults",{backgroundColor:void 0,borderColor:void 0,borderWidth:void 0,borderRadius:0,anchorX:"center",anchorY:"center",width:20,height:20});cs.register(Xh,tm);const cS=document.getElementById("radar-chart"),hS=document.getElementById("bar-chart"),uS=document.getElementById("pie-chart");document.getElementById("matrix-chart");let pp,fp,Yh;function dS(){cs.defaults.font.family="Inconsolata",console.log("initializing charts");let n={type:"radar",data:{labels:["Primary School",["Secondary","School"],["Health","Center"],"Hospital","Market"],datasets:[{label:"Travel Time With All Potential Bridges",data:[],fill:"+1",backgroundColor:"rgba(117, 117, 117, 0.3)",borderColor:"rgb(48, 159, 242, 0.5)",pointBackgroundColor:"rgb(48, 159, 242, 0.5)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(48, 159, 242, 1)",clip:!1},{label:"Travel Time Without Bridges",data:[],fill:!1,backgroundColor:"rgba(206, 97, 96, 0.5)",borderColor:"rgb(227, 63, 41, 1)",pointBackgroundColor:"rgb(227, 63, 41, 1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(227, 63, 41, 1)",clip:!1}]},options:{scale:{r:{min:0,max:120},ticks:{beginAtZero:!0,min:0,max:120,stepSize:30}},elements:{line:{borderWidth:3}},interaction:{mode:"index"},plugins:{title:{display:!0,text:"Travel Time to Destinations",font:{size:16}},tooltip:{callbacks:{label:function(v){let r=v.dataset.label||"";v.dataset.data[v.dataIndex];let T=0;return console.log("label is"+v.dataset.label),r=="Travel Time With All Potential Bridges"?T=Math.round(Kh[v.dataIndex]):r=="Travel Time Without Bridges"?T=Math.round(gp[v.dataIndex]):(console.log("else"),T=v.dataset.data[v.dataIndex]),r+=": "+T+" minutes",r}},displayColors:!1}}}},a={datasets:[{label:["Female 65+","Female 50-64","Female 15-49","Female 10-14","Female 5-9","Female 0-4","Male 0-4","Male 5-9","Male 10-14","Male 15-49","Male 50-64","Male 65+"],backgroundColor:["#330C33","#4D124D","#661766","#801D80","#992399","#B329B3","#29B3B3","#239999","#1D8080","#176666","#124D4D","#0C3333"],borderWidth:1,data:[],hoverOffset:6},{label:["Female","Male"],backgroundColor:["#661766","#186969"],borderWidth:2,data:[],hoverOffset:2},{label:["Total Population"],backgroundColor:["rgb(0, 0, 0, 0.1)"],borderWidth:0,data:[],hoverOffset:0}]},h={type:"pie",data:a,labels:{font:{family:"Inconsolata"}},options:{responsive:!0,maintainAspectRatio:!0,plugins:{title:{display:!0,text:"Population Demographics",font:{size:16}},tooltip:{callbacks:{label:function(v){console.log(v);let r=v.datasetIndex;console.log(a.datasets[r].label),console.log(r);let T=a.datasets[v.datasetIndex].label[v.dataIndex],C=v.dataset.data[v.dataIndex];return T+": "+C}}}}}};const g={type:"bar",data:{labels:["Primary school","Secondary school","Health center","Hospital","Market"],datasets:[{label:"",data:[],backgroundColor:"#47474750"},{label:"Travel Time",data:[1,1,1,1,1,1],backgroundColor:"#ed0000"},{label:"",data:[],backgroundColor:"#47474750"}]},options:{indexAxis:"y",plugins:{legend:{display:!1},title:{display:!0,text:"Travel Time Distribution (without bridges)",font:{size:16}},tooltip:{callbacks:{label:function(v){return v.chart.data.datasets[0].data[v.dataIndex]+"th percentile"}},displayColors:!1}},responsive:!0,scales:{x:{beginAtZero:!0,stacked:!0,padding:0,min:0,max:100,ticks:{stepSize:50,callback:function(v,r,T){var C=["Slower","50th percentile","Faster"];return C[r]}}},y:{stacked:!0,padding:0}},aspect:1,maintainAspectRatio:!0}};pp=new cs(cS,n),fp=new cs(hS,g),Yh=new cs(uS,h)}function pS(o,n,a,h,d){console.log("updating charts"),pp.data.datasets[0].data=o,pp.data.datasets[1].data=n,Yh.data.datasets[0].data=a[2],Yh.data.datasets[1].data=a[1],Yh.data.datasets[2].data=a[0],fp.data.datasets[0].data=h,fp.data.datasets[2].data=d,pp.update(),Yh.update(),fp.update()}const fS=document.getElementById("click-panel");let _p=[],mp=[],Kh=[],gp=[],os=[],O1=[],im=[],B1=[],Mx=["ps-paths","ss-paths","hp-paths","hc-paths","hos-paths","sdu-paths","ps-paths-outline","ss-paths-outline","hp-paths-outline","hc-paths-outline","hos-paths-outline","sdu-paths-outline"];function _S(o){if(Number.isFinite(o)){var n=(o.toString().split(".")[1]||"").length;if(n>3)return parseFloat(o.toFixed(3))}return o}function mS(o,n){gS(n),yS(n),vS(n);let a=xS(n);fS.classList.add("show"),document.getElementById("summary-text").innerHTML=`This area has a population of <span class="impact-style">${n.population}</span> and an relative wealth index of <span class="impact-style">${Math.round(n.rwi*100)/100}</span>. Trail bridges currently have a <span class="impact-style">${a[1][1]}</span> impact and a <span class="impact-style">${a[1][0]}</span> potential impact`,pS(_p,mp,B1,O1,im),document.getElementById("all-data-table").innerHTML="";for(var h in n)n.hasOwnProperty(h)&&(document.getElementById("all-data-table").innerHTML+="<tr><td>"+h+"</td> <td>"+_S(n[h])+"</td></tr>");for(let d=0;d<Mx.length;d++)gi.setFilter(Mx[d],["==","h3-index",n["h3-index"]])}function gS(o){Kh=[o.travel_time_primary_schools_fixed,o.travel_time_secondary_schools_fixed,o.travel_time_health_centers_optimal,o.travel_time_major_hospitals_optimal,o.travel_time_semi_dense_urban_optimal],gp=[o.travel_time_no_sites_primary_schools_fixed,o.travel_time_no_sites_secondary_schools_fixed,o.travel_time_no_sites_health_centers_optimal,o.travel_time_no_sites_major_hospitals_optimal,o.travel_time_no_sites_semi_dense_urban_optimal],_p=[],mp=[];for(let n=0;n<Kh.length;n++)Kh[n]>120?_p.push(120):_p.push(Kh[n]),gp[n]>120?mp.push(120):mp.push(gp[n])}function yS(o){B1=[[o.population],[Math.round(o.females_0_4+o.females_5_9+o.females_10_14+o.females_15_49+o.females_50_64+o.females_65_plus),Math.round(o.males_0_4+o.males_5_9+o.males_10_14+o.males_15_49+o.males_50_64+o.males_65_plus)],[Math.round(o.females_65_plus),Math.round(o.females_50_64),Math.round(o.females_15_49),Math.round(o.females_10_14),Math.round(o.females_5_9),Math.round(o.females_0_4),Math.round(o.males_0_4),Math.round(o.males_5_9),Math.round(o.males_10_14),Math.round(o.males_15_49),Math.round(o.males_50_64),Math.round(o.males_65_plus)]]}function xS(o){const a=["total_potential_impact","total_current_impact","total_health_potential_impact","total_health_current_impact","total_school_potential_impact","total_school_current_impact","semi_dense_urban_potential_impact","semi_dense_urban_current_impact","secondary_schools_potential_impact","secondary_schools_current_impact","primary_schools_potential_impact","primary_schools_current_impact","major_hospitals_potential_impact","major_hospitals_current_impact","health_posts_potential_impact","health_posts_current_impact","health_centers_potential_impact","health_centers_current_impact"].map(d=>o[d]),h=a.map(Ox);return[a,h]}function Hl(o,n){let a=I[n][3].quantiles;if(o<=a[0])return 0;if(o>=a[a.length-1])return 100;for(let h=1;h<a.length;h++)if(o<=a[h]){const d=a[h-1],g=a[h],v=(o-d)/(g-d)*10+(h-1)*10;return Math.round(100-v)}}function vS(o){return os=[Hl(o.travel_time_no_sites_primary_schools_fixed,"travel_time_no_sites_primary_schools_fixed"),Hl(o.travel_time_no_sites_secondary_schools_fixed,"travel_time_no_sites_secondary_schools_fixed"),Hl(o.travel_time_no_sites_health_centers_optimal,"travel_time_no_sites_health_centers_optimal"),Hl(o.travel_time_no_sites_health_posts_optimal,"travel_time_no_sites_health_posts_optimal"),Hl(o.travel_time_no_sites_major_hospitals_optimal,"travel_time_no_sites_major_hospitals_optimal"),Hl(o.travel_time_no_sites_semi_dense_urban_optimal,"travel_time_no_sites_semi_dense_urban_optimal")],O1=[os[0]-1,os[1]-1,os[2]-1,os[3]-1,os[4]-1,os[5]-1],im=[100-os[0],100-os[1],100-os[2],100-os[3],100-os[4],100-os[5]],im}let ic={dropdown1:["Impact","Travel Time","Demographics","Population"],dropdown2:{Demographics:["Pregnancies","Births","Relative Wealth Index","Underweight","Female Education","Male Education"],Population:["All","Children 0-4","Children 5-9","Children 0-9","Youth 10-14","People 15-49","People 50-64","People 65+","Female 0-4","Female 5-9","Female 0-9","Female 10-14","Female 15-49","Female 50-64","Female 65+","Male 0-4","Male 5-9","Male 0-9","Male 10-14","Male 15-49","Male 50-64","Male 65+"],Impact:["Potential Impact","Current Impact"],TravelTime:["With All Bridges","With Constructed Bridges","Without Bridges"]},dropdown3:{Demographics:["N/A"],Population:["N/A"],Impact:["All","School","Healthcare","Market","Primary School","Secondary School","Health Post","Health Center","Major Hospital"],TravelTime:["To School","To Healthcare","To Market","To Primary School","To Secondary School","To Health Post","To Health Center","To Hospital"]},dropdown4:["Standard map","Satellite"]};function nc(o,n){for(;n.firstChild;)n.removeChild(n.firstChild);for(let a=0;a<o.length;a++){let h=document.createElement("option");h.text=o[a],h.value=o[a],n.appendChild(h),o[a]=="N/A"?n.disabled=!0:n.disabled=!1}}function bS(o){if(console.log(o),o=="Standard map"){let n=["satellite-base"],a=["land","national-park","landuse","pitch-outline","waterway","water","water-pattern","mapbox-mapbox-terrain-dem-v1","land-structure-polygon","land-structure-line","aeroway-polygon","aeroway-line","tunnel-simple","road-simple","bridge-case-simple","bridge-simple","building-extrusion","admin-1-boundary-bg","admin-0-boundary-bg","admin-1-boundary","admin-0-boundary","admin-0-boundary-disputed","satellite-light","building-entrance","building-number-label","block-number-label","road-label-simple","waterway-label","natural-line-label","natural-point-label","water-line-label","water-point-label","poi-label","transit-label","airport-label","settlement-subdivision-label","settlement-minor-label","settlement-major-label","state-label"];for(let h=0;h<n.length;h++)gi.setLayoutProperty(n[h],"visibility","none");for(let h=0;h<a.length;h++)gi.setLayoutProperty(a[h],"visibility","visible")}else{let n=["land","national-park","landuse","pitch-outline","waterway","water","water-pattern","mapbox-mapbox-terrain-dem-v1","land-structure-polygon","land-structure-line","aeroway-polygon","aeroway-line","tunnel-simple","road-simple","bridge-case-simple","bridge-simple","building-extrusion","admin-1-boundary-bg","admin-0-boundary-bg","admin-1-boundary","admin-0-boundary","admin-0-boundary-disputed","satellite-light","building-entrance","building-number-label","block-number-label","road-label-simple","waterway-label","natural-line-label","natural-point-label","water-line-label","water-point-label","poi-label","transit-label","airport-label","settlement-subdivision-label","settlement-minor-label","settlement-major-label","state-label"],a=["satellite-base"];for(let h=0;h<n.length;h++)gi.setLayoutProperty(n[h],"visibility","none");for(let h=0;h<a.length;h++)gi.setLayoutProperty(a[h],"visibility","visible")}}let k_=document.getElementById("trans-slider");k_.addEventListener("change",function(){console.log(k_.value),gi.setPaintProperty("hex-8-layer","fill-opacity",Number(k_.value)/100)});function wS(o){o.addSource("hex-8-source",{type:"geojson",data:"/rwa_travel_time_hex-8-mini.geojson",generateId:!0}),o.addLayer({id:"hex-8-layer",type:"fill",source:"hex-8-source",paint:{"fill-color":Bx.travel_time_all_education_facilities_fixed["fill-color"],"fill-opacity":.5,"fill-outline-color":"rgba(255, 255, 255, .1)"}},"admin-0-boundary-disputed"),o.addLayer({id:"hex-8-hover",type:"line",source:"hex-8-source",paint:{"line-color":"#66BEC7","line-width":["interpolate",["linear"],["zoom"],3,.5,15,2],"line-opacity":["case",["boolean",["feature-state","hover"],!1],.75,0]}}),o.addLayer({id:"hex-8-click",type:"fill",source:"hex-8-source",paint:{"fill-color":"#66BEC7","fill-opacity":["case",["boolean",["feature-state","click"],!1],.8,0]}},"admin-0-boundary-disputed")}function TS(o){console.log(o),console.log(JSON.stringify([o.dropdown1,o.dropdown2,o.dropdown3]));let n=Object.keys(I).find(d=>JSON.stringify(I[d][0])===JSON.stringify([o.dropdown1,o.dropdown2,o.dropdown3])),a=W[I[n][2]],h=document.querySelector(".legend-colors");gi.setPaintProperty("hex-8-layer","fill-color",Bx[n]["fill-color"]),h.style.background="linear-gradient(to right, "+a+")",document.getElementById("legend-type").innerHTML=I[n][1][0],document.getElementById("left-legend-label").innerHTML=I[n][4][0],document.getElementById("right-legend-label").innerHTML=I[n][4][1]}let L_={"info-button":"https://www.bridgestoprosperity.org/","feedback-button":"https://forms.gle/3H1hcotYYeoheCeYA","bridge-need-button":"https://forms.gle/xnuknH9SSWA5ybHg7","bug-button":"https://forms.gle/3H1hcotYYeoheCeYA"};function ES(o){if(o=="info-button"){console.log("info button clicked");var n=document.getElementById("info-modal");n.style.display="block",document.body.classList.add("modal-open")}o=="feedback-button"&&(console.log("feedback button clicked"),window.open(L_[o],"_blank")),o=="bridge-need-button"&&(console.log("bridge need button clicked"),window.open(L_[o],"_blank")),o=="bug-button"&&(console.log("bug button clicked"),window.open(L_[o],"_blank")),o=="controls-button"&&(console.log("controls button clicked"),document.getElementById("control-panel").classList.contains("hide")?(document.getElementById("control-panel").classList.remove("hide"),document.getElementById("show-controls").classList.add("bg-secondary")):(document.getElementById("control-panel").classList.add("hide"),document.getElementById("show-controls").classList.remove("bg-secondary"))),o=="control-panel-close"&&(document.getElementById("control-panel").classList.add("hide"),document.getElementById("show-controls").classList.remove("bg-secondary"))}var Zs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function F1(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function MS(o){if(o.__esModule)return o;var n=o.default;if(typeof n=="function"){var a=function h(){if(this instanceof h){var d=[null];d.push.apply(d,arguments);var g=Function.bind.apply(n,d);return new g}return n.apply(this,arguments)};a.prototype=n.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(o).forEach(function(h){var d=Object.getOwnPropertyDescriptor(o,h);Object.defineProperty(a,h,d.get?d:{enumerable:!0,get:function(){return o[h]}})}),a}var N1={exports:{}};(function(o,n){(function(a,h){o.exports=h()})(Zs,function(){var a,h,d;function g(r,T){if(!a)a=T;else if(!h)h=T;else{var C="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+h+")(sharedChunk); self.onerror = null;",R={};a(R),d=T(R),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([C],{type:"text/javascript"})))}}g(["exports"],function(r){var T=typeof self<"u"?self:{},C="2.15.0";let R;const F={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(R==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{R={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{R=t}}return R},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!F.API_URL)return null;try{const t=new URL(F.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},U={supported:!1,testSupport:function(t){!ce&&ie&&(he?be(t):Y=t)}};let Y,ie,ce=!1,he=!1;function be(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ie),t.isContextLost())return;U.supported=!0}catch{}t.deleteTexture(e),ce=!0}T.document&&(ie=T.document.createElement("img"),ie.onload=function(){Y&&be(Y),Y=null,he=!0},ie.onerror=function(){ce=!0,Y=null},ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Le="01";function Fe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var qe=Re;function Re(t,e,i,l){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=l}Re.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,l=0;l<8;l++){var u=this.sampleCurveX(i)-t;if(Math.abs(u)<e)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=u/f}var m=0,x=1;for(i=t,l=0;l<20&&(u=this.sampleCurveX(i),!(Math.abs(u-t)<e));l++)t>u?m=i:x=i,i=.5*(x-m)+m;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Je=Fe(qe),nt=st;function st(t,e){this.x=t,this.y=e}st.prototype={clone:function(){return new st(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround:function(t,e){var i=Math.cos(t),l=Math.sin(t),u=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},st.convert=function(t){return t instanceof st?t:Array.isArray(t)?new st(t[0],t[1]):t};var De=Fe(nt);const Dt=Math.PI/180,zt=180/Math.PI;function ft(t){return t*Dt}function Gt(t){return t*zt}const on=[[0,0],[1,0],[1,1],[0,1]];function Kt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function ti(t,e,i,l){const u=new Je(t,e,i,l);return function(f){return u.solve(f)}}const xi=ti(.25,.1,.25,1);function bt(t,e,i){return Math.min(i,Math.max(e,t))}function Pi(t,e,i){return(i=bt((i-t)/(e-t),0,1))*i*(3-2*i)}function vi(t,e,i){const l=i-e,u=((t-e)%l+l)%l+e;return u===e?i:u}function ki(t,e,i){if(!t.length)return i(null,[]);let l=t.length;const u=new Array(t.length);let f=null;t.forEach((m,x)=>{e(m,(w,E)=>{w&&(f=w),u[x]=E,--l==0&&i(f,u)})})}function gn(t){const e=[];for(const i in t)e.push(t[i]);return e}function _i(t,...e){for(const i of e)for(const l in i)t[l]=i[l];return t}let vn=1;function Nn(){return vn++}function bn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Es(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function $a(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ur(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Vr(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Nt(t,e,i){const l={};for(const u in t)l[u]=e.call(i||this,t[u],u,t);return l}function Ur(t,e,i){const l={};for(const u in t)e.call(i||this,t[u],u,t)&&(l[u]=t[u]);return l}function zn(t){return Array.isArray(t)?t.map(zn):typeof t=="object"&&t?Nt(t,zn):t}const Fo={};function Ei(t){Fo[t]||(typeof console<"u"&&console.warn(t),Fo[t]=!0)}function jn(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function qa(t){let e=0;for(let i,l,u=0,f=t.length,m=f-1;u<f;m=u++)i=t[u],l=t[m],e+=(l.x-i.x)*(i.y+l.y);return e}function Ms(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Rn(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,u,f)=>{const m=u||f;return e[l]=!m||m.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let No=null;function Gr(t){if(No==null){const e=t.navigator?t.navigator.userAgent:null;No=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return No}function jo(t){try{const e=T[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Hs(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const $r="mapbox-tiles";let Wa=500,Za=50,Vn,Xs;function Vo(){try{return T.caches}catch{}}function dr(){Vo()&&!Vn&&(Vn=T.caches.open($r))}function qr(t){const e=t.indexOf("?");if(e<0)return t;const i=function(u){const f=u.indexOf("?");return f>0?u.slice(f+1).split("&"):[]}(t),l=i.filter(u=>{const f=u.split("=");return f[0]==="language"||f[0]==="worldview"});return l.length?`${t.slice(0,e)}?${l.join("&")}`:t.slice(0,e)}let Uo=1/0;const pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(pr);class Ys extends Error{constructor(e,i,l){i===401&&Te(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const fr=Ms()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,_r=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(fr())&&!/^\w+:/.test(i))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return function(l,u){const f=new T.AbortController,m=new T.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:fr(),referrerPolicy:l.referrerPolicy,signal:f.signal});let x=!1,w=!1;const E=(A=m.url).indexOf("sku=")>0&&Te(A);var A;l.type==="json"&&m.headers.set("Accept","application/json");const k=(O,B,V)=>{if(w)return;if(O&&O.message!=="SecurityError"&&Ei(O.toString()),B&&V)return L(B);const Z=Date.now();T.fetch(m).then(ee=>{if(ee.ok){const le=E?ee.clone():null;return L(ee,le,Z)}return u(new Ys(ee.statusText,ee.status,l.url))}).catch(ee=>{ee.name!=="AbortError"&&u(new Error(`${ee.message} ${l.url}`))})},L=(O,B,V)=>{(l.type==="arrayBuffer"?O.arrayBuffer():l.type==="json"?O.json():O.text()).then(Z=>{w||(B&&V&&function(ee,le,te){if(dr(),!Vn)return;const oe={status:le.status,statusText:le.statusText,headers:new T.Headers};le.headers.forEach((Ie,Me)=>oe.headers.set(Me,Ie));const de=Rn(le.headers.get("Cache-Control")||"");if(de["no-store"])return;de["max-age"]&&oe.headers.set("Expires",new Date(te+1e3*de["max-age"]).toUTCString());const ue=oe.headers.get("Expires");ue&&(new Date(ue).getTime()-te<42e4||function(Ie,Me){if(Xs===void 0)try{new Response(new ReadableStream),Xs=!0}catch{Xs=!1}Xs?Me(Ie.body):Ie.blob().then(Me)}(le,Ie=>{const Me=new T.Response(Ie,oe);dr(),Vn&&Vn.then(Be=>Be.put(qr(ee.url),Me)).catch(Be=>Ei(Be.message))}))}(m,B,V),x=!0,u(null,Z,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(Z=>{w||u(new Error(Z.message))})};return E?function(O,B){if(dr(),!Vn)return B(null);const V=qr(O.url);Vn.then(Z=>{Z.match(V).then(ee=>{const le=function(te){if(!te)return!1;const oe=new Date(te.headers.get("Expires")||0),de=Rn(te.headers.get("Cache-Control")||"");return oe>Date.now()&&!de["no-cache"]}(ee);Z.delete(V),le&&Z.put(V,ee.clone()),B(null,ee,le)}).catch(B)}).catch(B)}(m,k):k(null,null),{cancel:()=>{w=!0,x||f.abort()}}}(t,e);if(Ms()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(l,u){const f=new T.XMLHttpRequest;f.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in l.headers)f.setRequestHeader(m,l.headers[m]);return l.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=l.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(l.type==="json")try{m=JSON.parse(f.response)}catch(x){return u(x)}u(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new Ys(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}}(t,e)},Wr=function(t,e){return _r(_i(t,{type:"arrayBuffer"}),e)};function Ha(t){const e=T.document.createElement("a");return e.href=t,e.protocol===T.document.location.protocol&&e.host===T.document.location.host}const ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let G,$;G=[],$=0;const re=function(t,e){if(U.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),$>=F.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return G.push(f),f}$++;let i=!1;const l=()=>{if(!i)for(i=!0,$--;G.length&&$<F.MAX_PARALLEL_IMAGE_REQUESTS;){const f=G.shift(),{requestParameters:m,callback:x,cancelled:w}=f;w||(f.cancel=re(m,x).cancel)}},u=Wr(t,(f,m,x,w)=>{l(),f?e(f):m&&(T.createImageBitmap?function(E,A){const k=new T.Blob([new Uint8Array(E)],{type:"image/png"});T.createImageBitmap(k).then(L=>{A(null,L)}).catch(L=>{A(new Error(`Could not load image because of ${L.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,A)=>e(E,A,x,w)):function(E,A){const k=new T.Image,L=T.URL;k.onload=()=>{A(null,k),L.revokeObjectURL(k.src),k.onload=null,T.requestAnimationFrame(()=>{k.src=ae})},k.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new T.Blob([new Uint8Array(E)],{type:"image/png"});k.src=E.byteLength?L.createObjectURL(O):ae}(m,(E,A)=>e(E,A,x,w)))});return{cancel:()=>{u.cancel(),l()}}},pe="NO_ACCESS_TOKEN";function ye(t){return t.indexOf("mapbox:")===0}function Te(t){return F.API_URL_REGEX.test(t)}function we(t){return F.API_CDN_URL_REGEX.test(t)}function ge(t){return F.API_STYLE_REGEX.test(t)&&!ke(t)}function ke(t){return F.API_SPRITE_REGEX.test(t)}const tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(t){const e=t.match(tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ke(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const St="mapbox.eventData";function Pt(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class At{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Pt(F.ACCESS_TOKEN);let l="";return l=i&&i.u?T.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(+("0x"+f)))):F.ACCESS_TOKEN||"",e?`${St}.${e}:${l}`:`${St}:${l}`}fetchEventData(){const e=jo("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const u=T.localStorage.getItem(i);u&&(this.eventData=JSON.parse(u));const f=T.localStorage.getItem(l);f&&(this.anonId=f)}catch{Ei("Unable to read from LocalStorage")}}saveEventData(){const e=jo("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{T.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Ei("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,l,u){if(!F.EVENTS_URL)return;const f=it(F.EVENTS_URL);f.params.push(`access_token=${u||F.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},x=i?_i(m,i):m,w={url:Ke(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(E,A){return _r(_i(E,{method:"POST"}),A)}(w,E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(u)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const kt=new class extends At{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ye(i)||Te(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Pt(F.ACCESS_TOKEN),i=e?e.u:F.ACCESS_TOKEN;let l=i!==this.eventData.tokenU;$a(this.anonId)||(this.anonId=bn(),l=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(u),x=(u-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||f.getDate()!==m.getDate()}else l=!0;l?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Le,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=i)},t):this.processRequests()}},jt=kt.postTurnstileEvent.bind(kt),Mi=new class extends At{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,l){this.skuToken=e,this.errorCb=l,F.EVENTS_URL&&(i||F.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(pe)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),$a(this.anonId)||(this.anonId=bn()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Le,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},t))}},Ni=Mi.postMapLoadEvent.bind(Mi),un=new class extends At{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){F.EVENTS_URL&&(t||F.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),l=function(u){const f=T.performance.getEntriesByType("resource"),m=T.performance.getEntriesByType("mark"),x=function(L){const O={};if(L){for(const B in L)if(B!=="other")for(const V of L[B]){const Z=`${B}ResolveRangeMin`,ee=`${B}ResolveRangeMax`,le=`${B}RequestCount`,te=`${B}RequestCachedCount`;O[Z]=Math.min(O[Z]||1/0,V.startTime),O[ee]=Math.max(O[ee]||-1/0,V.responseEnd);const oe=de=>{O[de]===void 0&&(O[de]=0),++O[de]};V.transferSize!==void 0&&V.transferSize===0&&oe(te),oe(le)}}return O}(function(L,O){const B={};if(L)for(const V of L){const Z=O(V);B[Z]===void 0&&(B[Z]=[]),B[Z].push(V)}return B}(f,_u)),w=T.devicePixelRatio,E=T.navigator.connection||T.navigator.mozConnection||T.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},k=(L,O,B)=>{B!=null&&L.push({name:O,value:B.toString()})};for(const L in x)k(A.counters,L,x[L]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(k(A.counters,"interactionRangeMin",u.interactionRange[0]),k(A.counters,"interactionRangeMax",u.interactionRange[1])),m)for(const L of Object.keys(Zr)){const O=Zr[L],B=m.find(V=>V.name===O);B&&k(A.counters,O,B.startTime)}return k(A.counters,"visibilityHidden",u.visibilityHidden),k(A.attributes,"style",function(L){if(L)for(const O of L){const B=O.name.split("?")[0];if(ge(B)){const V=B.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(f)),k(A.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),k(A.attributes,"fogEnabled",u.fogEnabled?"true":"false"),k(A.attributes,"projection",u.projection),k(A.attributes,"zoom",u.zoom),k(A.metadata,"devicePixelRatio",w),k(A.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),k(A.metadata,"navigatorUserAgent",T.navigator.userAgent),k(A.metadata,"screenWidth",T.screen.width),k(A.metadata,"screenHeight",T.screen.height),k(A.metadata,"windowWidth",T.innerWidth),k(A.metadata,"windowHeight",T.innerHeight),k(A.metadata,"mapWidth",u.width/w),k(A.metadata,"mapHeight",u.height/w),k(A.metadata,"webglRenderer",u.renderer),k(A.metadata,"webglVendor",u.vendor),k(A.metadata,"sdkVersion",C),k(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const u of l.metadata);for(const u of l.counters);for(const u of l.attributes);this.postEvent(e,l,()=>{},t)}},Hi=un.postPerformanceEvent.bind(un),hs=new class extends At{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,l){if(!F.API_URL||!F.SESSION_PATH)return;const u=it(F.API_URL+F.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${l||F.ACCESS_TOKEN||""}`);const f={url:Ke(u),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,x){return _r(_i(m,{method:"GET"}),x)}(f,m=>{this.pendingRequest=null,i(m),this.saveEventData(),this.processRequests(l)})}getSessionAPI(t,e,i,l){this.skuToken=e,this.errorCb=l,F.SESSION_PATH&&F.API_URL&&(i||F.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(pe)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},t)}},Qi=hs.getSessionAPI.bind(hs),yn=new Set,Zr={create:"create",load:"load",fullLoad:"fullLoad"},Fp={mark(t){T.performance.mark(t)},measure(t,e,i){T.performance.measure(t,e,i)}};function _u(t){const e=t.name.split("?")[0];return we(e)&&e.includes("mapbox-gl.js")?"javascript":we(e)&&e.includes("mapbox-gl.css")?"css":function(i){return F.API_FONTS_REGEX.test(i)}(e)?"fontRange":ke(e)?"sprite":ge(e)?"style":function(i){return F.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const Xt=T.performance;function oc(t){const e=t?t.url.toString():void 0;return Xt.getEntriesByName(e)}let Go,ac,Xa,us;const Ss={now:()=>Xa!==void 0?Xa:T.performance.now(),setNow(t){Xa=t},restoreNow(){Xa=void 0},frame(t){const e=T.requestAnimationFrame(t);return{cancel:()=>T.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:l}=t;us||(us=T.document.createElement("canvas"));const u=us.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>us.width||l>us.height)&&(us.width=i,us.height=l),u.clearRect(-e,-e,i+2*e,l+2*e),u.drawImage(t,0,0,i,l),u.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:t=>(Go||(Go=T.document.createElement("a")),Go.href=t,Go.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(ac==null&&(ac=T.matchMedia("(prefers-reduced-motion: reduce)")),ac.matches)}};function lc(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function cc(t,e,i){if(i&&i[t]){const l=i[t].indexOf(e);l!==-1&&i[t].splice(l,1)}}class mr{constructor(e,i={}){_i(this,i),this.type=e}}class As extends mr{constructor(e,i={}){super("error",_i({error:e},i))}}class $o{on(e,i){return this._listeners=this._listeners||{},lc(e,i,this._listeners),this}off(e,i){return cc(e,i,this._listeners),cc(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},lc(e,i,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,i){typeof e=="string"&&(e=new mr(e,i||{}));const l=e.type;if(this.listens(l)){e.target=this;const u=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of u)x.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of f)cc(l,x,this._oneTimeListeners),x.call(this,e);const m=this._eventedParent;m&&(_i(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof As&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Is(t,...e){for(const i of e)for(const l in i)t[l]=i[l];return t}function ji(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function en(t){if(Array.isArray(t))return t.map(en);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=en(t[i]);return e}return ji(t)}class mu extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var ds=mu;class hc{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,u]of i)this.bindings[l]=u}concat(e){return new hc(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var gu=hc;const Hr={kind:"null"},lt={kind:"number"},Ft={kind:"string"},Rt={kind:"boolean"},On={kind:"color"},es={kind:"object"},Ot={kind:"value"},Bn={kind:"collator"},qo={kind:"formatted"},gr={kind:"resolvedImage"};function Un(t,e){return{kind:"array",itemType:t,N:e}}function bi(t){if(t.kind==="array"){const e=bi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const yu=[Hr,lt,Ft,Rt,On,qo,es,Un(Ot),gr];function Cs(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Cs(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of yu)if(!Cs(i,e))return null}}return`Expected ${bi(t)} but found ${bi(e)} instead.`}function Wo(t,e){return e.some(i=>i.kind===t.kind)}function Zo(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var uc,xu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ho(t){return(t=Math.round(t))<0?0:t>255?255:t}function Xo(t){return Ho(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Ya(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Xr(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{uc={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in xu)return xu[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=i.indexOf("("),u=i.indexOf(")");if(l!==-1&&u+1===i.length){var f=i.substr(0,l),m=i.substr(l+1,u-(l+1)).split(","),x=1;switch(f){case"rgba":if(m.length!==4)return null;x=Ya(m.pop());case"rgb":return m.length!==3?null:[Xo(m[0]),Xo(m[1]),Xo(m[2]),x];case"hsla":if(m.length!==4)return null;x=Ya(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=Ya(m[1]),A=Ya(m[2]),k=A<=.5?A*(E+1):A+E-A*E,L=2*A-k;return[Ho(255*Xr(L,k,w+1/3)),Ho(255*Xr(L,k,w)),Ho(255*Xr(L,k,w-1/3)),x];default:return null}}return null}}catch{}class wn{constructor(e,i,l,u=1){this.r=e,this.g=i,this.b=l,this.a=u}static parse(e){if(!e)return;if(e instanceof wn)return e;if(typeof e!="string")return;const i=uc(e);return i?new wn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,l,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(l)},${u})`}toArray(){const{r:e,g:i,b:l,a:u}=this;return u===0?[0,0,0,0]:[255*e/u,255*i/u,255*l/u,u]}toArray01(){const{r:e,g:i,b:l,a:u}=this;return u===0?[0,0,0,0]:[e/u,i/u,l/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:l,a:u}=this;return[e,i,l,u]}}wn.black=new wn(0,0,0,1),wn.white=new wn(1,1,1,1),wn.transparent=new wn(0,0,0,0),wn.red=new wn(1,0,0,1),wn.blue=new wn(0,0,1,1);var Bi=wn;class dc{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pc{constructor(e,i,l,u,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=u,this.textColor=f}}class Tn{constructor(e){this.sections=e}static fromString(e){return new Tn([new pc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Tn?e:Tn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(l)}return e}}class Gn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Gn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function vu(t,e,i,l){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[t,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[t,e,i,l]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Yo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Bi||t instanceof dc||t instanceof Tn||t instanceof Gn)return!0;if(Array.isArray(t)){for(const e of t)if(!Yo(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Yo(t[e]))return!1;return!0}return!1}function Li(t){if(t===null)return Hr;if(typeof t=="string")return Ft;if(typeof t=="boolean")return Rt;if(typeof t=="number")return lt;if(t instanceof Bi)return On;if(t instanceof dc)return Bn;if(t instanceof Tn)return qo;if(t instanceof Gn)return gr;if(Array.isArray(t)){const e=t.length;let i;for(const l of t){const u=Li(l);if(i){if(i===u)continue;i=Ot;break}i=u}return Un(i||Ot,e)}return es}function Ko(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Bi||t instanceof Tn||t instanceof Gn?t.toString():JSON.stringify(t)}class fc{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Yo(e[1]))return i.error("invalid value");const l=e[1];let u=Li(l);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new fc(u,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toArray()):this.value instanceof Tn?this.value.serialize():this.value}}var yr=fc,an=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const _c={string:Ft,number:lt,boolean:Rt,object:es};class mc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,u=1;const f=e[0];if(f==="array"){let x,w;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in _c)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=_c[E],u++}else x=Ot;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],u++}l=Un(x,w)}else l=_c[f];const m=[];for(;u<e.length;u++){const x=i.parse(e[u],u,Ot);if(!x)return null;m.push(x)}return new mc(l,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!Cs(this.type,Li(l)))return l;if(i===this.args.length-1)throw new an(`Expected value to be of type ${bi(this.type)}, but found ${bi(Li(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(l=>l.serialize()))}}var Ps=mc;class Ks{constructor(e){this.type=qo,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=e.length-1;++m){const x=e[m];if(f&&typeof x=="object"&&!Array.isArray(x)){f=!1;let w=null;if(x["font-scale"]&&(w=i.parse(x["font-scale"],1,lt),!w))return null;let E=null;if(x["text-font"]&&(E=i.parse(x["text-font"],1,Un(Ft)),!E))return null;let A=null;if(x["text-color"]&&(A=i.parse(x["text-color"],1,On),!A))return null;const k=u[u.length-1];k.scale=w,k.font=E,k.textColor=A}else{const w=i.parse(e[m],1,Ot);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:w,scale:null,font:null,textColor:null})}}return new Ks(u)}evaluate(e){return new Tn(this.sections.map(i=>{const l=i.content.evaluate(e);return Li(l)===gr?new pc("",l,null,null,null):new pc(Ko(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class Ka{constructor(e){this.type=gr,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const l=i.parse(e[1],1,Ft);return l?new Ka(l):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),l=Gn.fromString(i);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(i)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Np={"to-boolean":Rt,"to-color":On,"to-number":lt,"to-string":Ft};class gc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0];if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");const u=Np[l],f=[];for(let m=1;m<e.length;m++){const x=i.parse(e[m],m,Ot);if(!x)return null;f.push(x)}return new gc(u,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const u of this.args){if(i=u.evaluate(e),l=null,i instanceof Bi)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:vu(i[0],i[1],i[2],i[3]),!l))return new Bi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new an(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new an(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Tn.fromString(Ko(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Gn.fromString(Ko(this.args[0].evaluate(e))):Ko(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ks([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ka(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Yr=gc;const ps=["Unknown","Point","LineString","Polygon"];var yc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ps[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(l*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Bi.parse(t)),e}};class xr{constructor(e,i,l,u){this.name=e,this.type=i,this._evaluate=l,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const l=e[0],u=xr.definitions[l];if(!u)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,x=m.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let w=null;for(const[E,A]of x){w=new Ec(i.registry,i.path,null,i.scope);const k=[];let L=!1;for(let O=1;O<e.length;O++){const B=e[O],V=Array.isArray(E)?E[O-1]:E.type,Z=w.parse(B,1+k.length,V);if(!Z){L=!0;break}k.push(Z)}if(!L)if(Array.isArray(E)&&E.length!==k.length)w.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let O=0;O<k.length;O++){const B=Array.isArray(E)?E[O]:E.type,V=k[O];w.concat(O+1).checkSubtype(B,V.type)}if(w.errors.length===0)return new xr(l,f,A,k)}}if(x.length===1)i.errors.push(...w.errors);else{const E=(x.length?x:m).map(([k])=>{return L=k,Array.isArray(L)?`(${L.map(bi).join(", ")})`:`(${bi(L.type)}...)`;var L}).join(" | "),A=[];for(let k=1;k<e.length;k++){const L=i.parse(e[k],1+A.length);if(!L)return null;A.push(bi(L.type))}i.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){xr.definitions=i;for(const l in i)e[l]=xr}}var ks=xr;class Jo{constructor(e,i,l){this.type=Bn,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const u=i.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Rt);if(!u)return null;const f=i.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Rt);if(!f)return null;let m=null;return l.locale&&(m=i.parse(l.locale,1,Ft),!m)?null:new Jo(u,f,m)}evaluate(e){return new dc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Ls=8192;function Ja(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Kr(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Qo(t,e){const i=(180+t[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*Ls),Math.round(l*u*Ls)]}function bu(t,e,i){const l=t[0]-e[0],u=t[1]-e[1],f=t[0]-i[0],m=t[1]-i[1];return l*m-f*u==0&&l*f<=0&&u*m<=0}function Qa(t,e){let i=!1;for(let m=0,x=e.length;m<x;m++){const w=e[m];for(let E=0,A=w.length;E<A-1;E++){if(bu(t,w[E],w[E+1]))return!1;(u=w[E])[1]>(l=t)[1]!=(f=w[E+1])[1]>l[1]&&l[0]<(f[0]-u[0])*(l[1]-u[1])/(f[1]-u[1])+u[0]&&(i=!i)}}var l,u,f;return i}function xc(t,e){for(let i=0;i<e.length;i++)if(Qa(t,e[i]))return!0;return!1}function vc(t,e,i,l){const u=l[0]-i[0],f=l[1]-i[1],m=(t[0]-i[0])*f-u*(t[1]-i[1]),x=(e[0]-i[0])*f-u*(e[1]-i[1]);return m>0&&x<0||m<0&&x>0}function Jr(t,e,i){for(const E of i)for(let A=0;A<E.length-1;++A)if((x=[(m=E[A+1])[0]-(f=E[A])[0],m[1]-f[1]])[0]*(w=[(u=e)[0]-(l=t)[0],u[1]-l[1]])[1]-x[1]*w[0]!=0&&vc(l,u,f,m)&&vc(f,m,l,u))return!0;var l,u,f,m,x,w;return!1}function Yt(t,e){for(let i=0;i<t.length;++i)if(!Qa(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Jr(t[i],t[i+1],e))return!1;return!0}function jp(t,e){for(let i=0;i<e.length;i++)if(Yt(t,e[i]))return!0;return!1}function bc(t,e,i){const l=[];for(let u=0;u<t.length;u++){const f=[];for(let m=0;m<t[u].length;m++){const x=Qo(t[u][m],i);Ja(e,x),f.push(x)}l.push(f)}return l}function wu(t,e,i){const l=[];for(let u=0;u<t.length;u++){const f=bc(t[u],e,i);l.push(f)}return l}function wc(t,e,i,l){if(t[0]<i[0]||t[0]>i[2]){const u=.5*l;let f=t[0]-i[0]>u?-l:i[0]-t[0]>u?l:0;f===0&&(f=t[0]-i[2]>u?-l:i[2]-t[0]>u?l:0),t[0]+=f}Ja(e,t)}function Tu(t,e,i,l){const u=Math.pow(2,l.z)*Ls,f=[l.x*Ls,l.y*Ls],m=[];if(!t)return m;for(const x of t)for(const w of x){const E=[w.x+f[0],w.y+f[1]];wc(E,e,i,u),m.push(E)}return m}function Tc(t,e,i,l){const u=Math.pow(2,l.z)*Ls,f=[l.x*Ls,l.y*Ls],m=[];if(!t)return m;for(const w of t){const E=[];for(const A of w){const k=[A.x+f[0],A.y+f[1]];Ja(e,k),E.push(k)}m.push(E)}if(e[2]-e[0]<=u/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of m)for(const E of w)wc(E,e,i,u)}var x;return m}class Qr{constructor(e,i){this.type=Rt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Yo(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let u=0;u<l.features.length;++u){const f=l.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Qr(l,l.features[u].geometry)}else if(l.type==="Feature"){const u=l.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Qr(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Qr(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,l){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const x=bc(l.coordinates,f,m),w=Tu(i.geometry(),u,f,m);if(!Kr(u,f))return!1;for(const E of w)if(!Qa(E,x))return!1}if(l.type==="MultiPolygon"){const x=wu(l.coordinates,f,m),w=Tu(i.geometry(),u,f,m);if(!Kr(u,f))return!1;for(const E of w)if(!xc(E,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,l){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const x=bc(l.coordinates,f,m),w=Tc(i.geometry(),u,f,m);if(!Kr(u,f))return!1;for(const E of w)if(!Yt(E,x))return!1}if(l.type==="MultiPolygon"){const x=wu(l.coordinates,f,m),w=Tc(i.geometry(),u,f,m);if(!Kr(u,f))return!1;for(const E of w)if(!jp(E,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var el=Qr;function eo(t){if(t instanceof ks&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof el)return!1;let e=!0;return t.eachChild(i=>{e&&!eo(i)&&(e=!1)}),e}function Ds(t){if(t instanceof ks&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!Ds(i)&&(e=!1)}),e}function vr(t,e){if(t instanceof ks&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(l=>{i&&!vr(l,e)&&(i=!1)}),i}class tl{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new tl(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Eu=tl;class ea{constructor(e,i=[],l,u=new gu,f=[]){this.registry=e,this.path=i,this.key=i.map(m=>`[${m}]`).join(""),this.scope=u,this.errors=f,this.expectedType=l}parse(e,i,l,u,f={}){return i?this.concat(i,l,u)._parse(e,f):this._parse(e,f)}_parse(e,i){function l(u,f,m){return m==="assert"?new Ps(f,[u]):m==="coerce"?new Yr(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if(typeof u!="string")return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const x=this.expectedType,w=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||w.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(x,w))return null}else m=l(m,x,i.typeAnnotation||"coerce");else m=l(m,x,i.typeAnnotation||"assert")}if(!(m instanceof yr)&&m.type.kind!=="resolvedImage"&&Mc(m)){const x=new yc;try{m=new yr(m.type,m.evaluate(x))}catch(w){return this.error(w.message),null}}return m}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l){const u=typeof e=="number"?this.path.concat(e):this.path,f=l?this.scope.concat(l):this.scope;return new ea(this.registry,u,i||null,f,this.errors)}error(e,...i){const l=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new ds(l,e))}checkSubtype(e,i){const l=Cs(e,i);return l&&this.error(l),l}}var Ec=ea;function Mc(t){if(t instanceof Eu)return Mc(t.boundExpression);if(t instanceof ks&&t.name==="error"||t instanceof Jo||t instanceof el)return!1;const e=t instanceof Yr||t instanceof Ps;let i=!0;return t.eachChild(l=>{i=e?i&&Mc(l):i&&l instanceof yr}),!!i&&eo(t)&&vr(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function il(t,e){const i=t.length-1;let l,u,f=0,m=i,x=0;for(;f<=m;)if(x=Math.floor((f+m)/2),l=t[x],u=t[x+1],l<=e){if(x===i||e<u)return x;f=x+1}else{if(!(l>e))throw new an("Input is not a number.");m=x-1}return 0}class nl{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of l)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,lt);if(!l)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<e.length;m+=2){const x=m===1?-1/0:e[m],w=e[m+1],E=m,A=m+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(u.length&&u[u.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const k=i.parse(w,A,f);if(!k)return null;f=f||k.type,u.push([x,k])}return new nl(f,l,u)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return l[0].evaluate(e);const f=i.length;return u>=i[f-1]?l[f-1].evaluate(e):l[il(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Sc=nl;function Ut(t,e,i){return t*(1-i)+e*i}var ta=Object.freeze({__proto__:null,array:function(t,e,i){return t.map((l,u)=>Ut(l,e[u],i))},color:function(t,e,i){return new Bi(Ut(t.r,e.r,i),Ut(t.g,e.g,i),Ut(t.b,e.b,i),Ut(t.a,e.a,i))},number:Ut});const Mu=.95047,Ac=1.08883,Su=4/29,br=6/29,Ic=3*br*br,Vp=br*br*br,Up=Math.PI/180,Gp=180/Math.PI;function Cc(t){return t>Vp?Math.pow(t,1/3):t/Ic+Su}function Pc(t){return t>br?t*t*t:Ic*(t-Su)}function kc(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function sl(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Au(t){const e=sl(t.r),i=sl(t.g),l=sl(t.b),u=Cc((.4124564*e+.3575761*i+.1804375*l)/Mu),f=Cc((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Cc((.0193339*e+.119192*i+.9503041*l)/Ac)),alpha:t.a}}function Iu(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,l=isNaN(t.b)?e:e-t.b/200;return e=1*Pc(e),i=Mu*Pc(i),l=Ac*Pc(l),new Bi(kc(3.2404542*i-1.5371385*e-.4985314*l),kc(-.969266*i+1.8760108*e+.041556*l),kc(.0556434*i-.2040259*e+1.0572252*l),t.alpha)}function $p(t,e,i){const l=e-t;return t+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const ia={forward:Au,reverse:Iu,interpolate:function(t,e,i){return{l:Ut(t.l,e.l,i),a:Ut(t.a,e.a,i),b:Ut(t.b,e.b,i),alpha:Ut(t.alpha,e.alpha,i)}}},to={forward:function(t){const{l:e,a:i,b:l}=Au(t),u=Math.atan2(l,i)*Gp;return{h:u<0?u+360:u,c:Math.sqrt(i*i+l*l),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Up,i=t.c;return Iu({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:$p(t.h,e.h,i),c:Ut(t.c,e.c,i),l:Ut(t.l,e.l,i),alpha:Ut(t.alpha,e.alpha,i)}}};var Lc=Object.freeze({__proto__:null,hcl:to,lab:ia});class na{constructor(e,i,l,u,f){this.type=e,this.operator=i,this.interpolation=l,this.input=u,this.labels=[],this.outputs=[];for(const[m,x]of f)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(e,i,l,u){let f=0;if(e.name==="exponential")f=Dc(i,e.base,l,u);else if(e.name==="linear")f=Dc(i,1,l,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new Je(m[0],m[1],m[2],m[3]).solve(Dc(i,1,l,u))}return f}static parse(e,i){let[l,u,f,...m]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const E=u[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:E}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const E=u.slice(1);if(E.length!==4||E.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,lt),!f)return null;const x=[];let w=null;l==="interpolate-hcl"||l==="interpolate-lab"?w=On:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let E=0;E<m.length;E+=2){const A=m[E],k=m[E+1],L=E+3,O=E+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(x.length&&x[x.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const B=i.parse(k,O,w);if(!B)return null;w=w||B.type,x.push([A,B])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new na(w,l,u,f,x):i.error(`Type ${bi(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return l[0].evaluate(e);const f=i.length;if(u>=i[f-1])return l[f-1].evaluate(e);const m=il(i,u),x=na.interpolationFactor(this.interpolation,u,i[m],i[m+1]),w=l[m].evaluate(e),E=l[m+1].evaluate(e);return this.operator==="interpolate"?ta[this.type.kind.toLowerCase()](w,E,x):this.operator==="interpolate-hcl"?to.reverse(to.interpolate(to.forward(w),to.forward(E),x)):ia.reverse(ia.interpolate(ia.forward(w),ia.forward(E),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function Dc(t,e,i,l){const u=l-i,f=t-i;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var fs=na;class rl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const u=i.expectedType;u&&u.kind!=="value"&&(l=u);const f=[];for(const x of e.slice(1)){const w=i.parse(x,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,f.push(w)}const m=u&&f.some(x=>Cs(u,x.type));return new rl(m?Ot:l,f)}evaluate(e){let i,l=null,u=0;for(const f of this.args){if(u++,l=f.evaluate(e),l&&l instanceof Gn&&!l.available&&(i||(i=l),l=null,u===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var zc=rl;class ol{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=i.parse(e[f+1],f+1);if(!x)return null;l.push([m,x])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return u?new ol(l,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}var Cu=ol;class Rc{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,lt),u=i.parse(e[2],2,Un(i.expectedType||Ot));return l&&u?new Rc(u.type.itemType,l,u):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new an(`Array index out of bounds: ${i} < 0.`);if(i>=l.length)throw new an(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i!==Math.floor(i))throw new an(`Array index must be an integer, but found ${i} instead.`);return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var qp=Rc;class Oc{constructor(e,i){this.type=Rt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ot),u=i.parse(e[2],2,Ot);return l&&u?Wo(l.type,[Rt,Ft,lt,Hr,Ot])?new Oc(l,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!Zo(i,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Li(i))} instead.`);if(!Zo(l,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${bi(Li(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var al=Oc;class sa{constructor(e,i,l){this.type=lt,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ot),u=i.parse(e[2],2,Ot);if(!l||!u)return null;if(!Wo(l.type,[Rt,Ft,lt,Hr,Ot]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,lt);return f?new sa(l,u,f):null}return new sa(l,u)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!Zo(i,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Li(i))} instead.`);if(!Zo(l,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${bi(Li(l))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return l.indexOf(i,u)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Pu=sa;class Bc{constructor(e,i,l,u,f,m){this.inputType=e,this.type=i,this.input=l,this.cases=u,this.outputs=f,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},m=[];for(let E=2;E<e.length-1;E+=2){let A=e[E];const k=e[E+1];Array.isArray(A)||(A=[A]);const L=i.concat(E);if(A.length===0)return L.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return L.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return L.error("Numeric branch labels must be integer values.");if(l){if(L.checkSubtype(l,Li(B)))return null}else l=Li(B);if(f[String(B)]!==void 0)return L.error("Branch labels must be unique.");f[String(B)]=m.length}const O=i.parse(k,E,u);if(!O)return null;u=u||O.type,m.push(O)}const x=i.parse(e[1],1,Ot);if(!x)return null;const w=i.parse(e[e.length-1],e.length-1,u);return w?x.type.kind!=="value"&&i.concat(1).checkSubtype(l,x.type)?null:new Bc(l,u,x,f,m,w):null}evaluate(e){const i=this.input.evaluate(e);return(Li(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],u={};for(const m of i){const x=u[this.cases[m]];x===void 0?(u[this.cases[m]]=l.length,l.push([this.cases[m],[m]])):l[x][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of l)e.push(x.length===1?f(x[0]):x.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var Wp=Bc;class Fc{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const x=i.parse(e[m],m,Rt);if(!x)return null;const w=i.parse(e[m+1],m+1,l);if(!w)return null;u.push([x,w]),l=l||w.type}const f=i.parse(e[e.length-1],e.length-1,l);return f?new Fc(l,u,f):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ku=Fc;class ra{constructor(e,i,l,u){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ot),u=i.parse(e[2],2,lt);if(!l||!u)return null;if(!Wo(l.type,[Un(Ot),Ft,Ot]))return i.error(`Expected first argument to be of type array or string, but found ${bi(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,lt);return f?new ra(l.type,l,u,f):null}return new ra(l.type,l,u)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!Zo(i,["string","array"]))throw new an(`Expected first argument to be of type array or string, but found ${bi(Li(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(l,u)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Lu=ra;function ll(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Du(t,e,i,l){return l.compare(e,i)===0}function io(t,e,i){const l=t!=="=="&&t!=="!=";return class j1{constructor(f,m,x){this.type=Rt,this.lhs=f,this.rhs=m,this.collator=x,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const x=f[0];let w=m.parse(f[1],1,Ot);if(!w)return null;if(!ll(x,w.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${bi(w.type)}'.`);let E=m.parse(f[2],2,Ot);if(!E)return null;if(!ll(x,E.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${bi(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${bi(w.type)}' and '${bi(E.type)}'.`);l&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new Ps(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new Ps(w.type,[E])));let A=null;if(f.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(f[3],3,Bn),!A)return null}return new j1(w,E,A)}evaluate(f){const m=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const w=Li(m),E=Li(x);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new an(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Li(m),E=Li(x);if(w.kind!=="string"||E.kind!=="string")return e(f,m,x)}return this.collator?i(f,m,x,this.collator.evaluate(f)):e(f,m,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const Zp=io("==",function(t,e,i){return e===i},Du),Hp=io("!=",function(t,e,i){return e!==i},function(t,e,i,l){return!Du(0,e,i,l)}),Xp=io("<",function(t,e,i){return e<i},function(t,e,i,l){return l.compare(e,i)<0}),Yp=io(">",function(t,e,i){return e>i},function(t,e,i,l){return l.compare(e,i)>0}),Kp=io("<=",function(t,e,i){return e<=i},function(t,e,i,l){return l.compare(e,i)<=0}),zu=io(">=",function(t,e,i){return e>=i},function(t,e,i,l){return l.compare(e,i)>=0});class cl{constructor(e,i,l,u,f,m){this.type=Ft,this.number=e,this.locale=i,this.currency=l,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,lt);if(!l)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parse(u.locale,1,Ft),!f))return null;let m=null;if(u.currency&&(m=i.parse(u.currency,1,Ft),!m))return null;let x=null;if(u.unit&&(x=i.parse(u.unit,1,Ft),!x))return null;let w=null;if(u["min-fraction-digits"]&&(w=i.parse(u["min-fraction-digits"],1,lt),!w))return null;let E=null;return u["max-fraction-digits"]&&(E=i.parse(u["max-fraction-digits"],1,lt),!E)?null:new cl(l,f,m,x,w,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class no{constructor(e){this.type=lt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${bi(l.type)} instead.`):new no(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new an(`Expected value to be of type string or array, but found ${bi(Li(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Ru={"==":Zp,"!=":Hp,">":Yp,"<":Xp,">=":zu,"<=":Kp,array:Ps,at:qp,boolean:Ps,case:ku,coalesce:zc,collator:Jo,format:Ks,image:Ka,in:al,"index-of":Pu,interpolate:fs,"interpolate-hcl":fs,"interpolate-lab":fs,length:no,let:Cu,literal:yr,match:Wp,number:Ps,"number-format":cl,object:Ps,slice:Lu,step:Sc,string:Ps,"to-boolean":Yr,"to-color":Yr,"to-number":Yr,"to-string":Yr,var:Eu,within:el};function Ou(t,[e,i,l,u]){e=e.evaluate(t),i=i.evaluate(t),l=l.evaluate(t);const f=u?u.evaluate(t):1,m=vu(e,i,l,f);if(m)throw new an(m);return new Bi(e/255*f,i/255*f,l/255*f,f)}function zs(t,e){return t in e}function hl(t,e){const i=e[t];return i===void 0?null:i}function $n(t){return{type:t}}ks.register(Ru,{error:[{kind:"error"},[Ft],(t,[e])=>{throw new an(e.evaluate(t))}],typeof:[Ft,[Ot],(t,[e])=>bi(Li(e.evaluate(t)))],"to-rgba":[Un(lt,4),[On],(t,[e])=>e.evaluate(t).toArray()],rgb:[On,[lt,lt,lt],Ou],rgba:[On,[lt,lt,lt,lt],Ou],has:{type:Rt,overloads:[[[Ft],(t,[e])=>zs(e.evaluate(t),t.properties())],[[Ft,es],(t,[e,i])=>zs(e.evaluate(t),i.evaluate(t))]]},get:{type:Ot,overloads:[[[Ft],(t,[e])=>hl(e.evaluate(t),t.properties())],[[Ft,es],(t,[e,i])=>hl(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ot,[Ft],(t,[e])=>hl(e.evaluate(t),t.featureState||{})],properties:[es,[],t=>t.properties()],"geometry-type":[Ft,[],t=>t.geometryType()],id:[Ot,[],t=>t.id()],zoom:[lt,[],t=>t.globals.zoom],pitch:[lt,[],t=>t.globals.pitch||0],"distance-from-center":[lt,[],t=>t.distanceFromCenter()],"heatmap-density":[lt,[],t=>t.globals.heatmapDensity||0],"line-progress":[lt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[lt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ot,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[lt,$n(lt),(t,e)=>{let i=0;for(const l of e)i+=l.evaluate(t);return i}],"*":[lt,$n(lt),(t,e)=>{let i=1;for(const l of e)i*=l.evaluate(t);return i}],"-":{type:lt,overloads:[[[lt,lt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[lt],(t,[e])=>-e.evaluate(t)]]},"/":[lt,[lt,lt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[lt,[lt,lt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[lt,[lt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))],log2:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[lt,[lt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[lt,[lt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[lt,[lt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[lt,[lt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[lt,[lt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[lt,[lt],(t,[e])=>Math.atan(e.evaluate(t))],min:[lt,$n(lt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[lt,$n(lt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[lt,[lt],(t,[e])=>Math.abs(e.evaluate(t))],round:[lt,[lt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[lt,[lt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[lt,[lt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Rt,[Ft,Ot],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Rt,[Ot],(t,[e])=>t.id()===e.value],"filter-type-==":[Rt,[Ft],(t,[e])=>t.geometryType()===e.value],"filter-<":[Rt,[Ft,Ot],(t,[e,i])=>{const l=t.properties()[e.value],u=i.value;return typeof l==typeof u&&l<u}],"filter-id-<":[Rt,[Ot],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[Rt,[Ft,Ot],(t,[e,i])=>{const l=t.properties()[e.value],u=i.value;return typeof l==typeof u&&l>u}],"filter-id->":[Rt,[Ot],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[Rt,[Ft,Ot],(t,[e,i])=>{const l=t.properties()[e.value],u=i.value;return typeof l==typeof u&&l<=u}],"filter-id-<=":[Rt,[Ot],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[Rt,[Ft,Ot],(t,[e,i])=>{const l=t.properties()[e.value],u=i.value;return typeof l==typeof u&&l>=u}],"filter-id->=":[Rt,[Ot],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[Rt,[Ot],(t,[e])=>e.value in t.properties()],"filter-has-id":[Rt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Rt,[Un(Ft)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Rt,[Un(Ot)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Rt,[Ft,Un(Ot)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Rt,[Ft,Un(Ot)],(t,[e,i])=>function(l,u,f,m){for(;f<=m;){const x=f+m>>1;if(u[x]===l)return!0;u[x]>l?m=x-1:f=x+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Rt,overloads:[[[Rt,Rt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[$n(Rt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[$n(Rt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Rt,[Rt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Rt,[Ft],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Ft,[Ft],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ft,[Ft],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ft,$n(Ot),(t,e)=>e.map(i=>Ko(i.evaluate(t))).join("")],"resolved-locale":[Ft,[Bn],(t,[e])=>e.evaluate(t).resolvedLocale()]});var oa=Ru;function Bu(t){return{result:"success",value:t}}function wr(t){return{result:"error",value:t}}function so(t){return t["property-type"]==="data-driven"}function ul(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function dl(t){return!!t.expression&&t.expression.interpolated}function $t(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function aa(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Fu(t){return t}function pl(t,e){const i=e.type==="color",l=t.stops&&typeof t.stops[0][0]=="object",u=l||!(l||t.property!==void 0),f=t.type||(dl(e)?"exponential":"interval");if(i&&((t=Is({},t)).stops&&(t.stops=t.stops.map(E=>[E[0],Bi.parse(E[1])])),t.default=Bi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Lc[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,x,w;if(f==="exponential")m=Rs;else if(f==="interval")m=fl;else if(f==="categorical"){m=Nu,x=Object.create(null);for(const E of t.stops)x[E[0]]=E[1];w=typeof t.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=ju}if(l){const E={},A=[];for(let O=0;O<t.stops.length;O++){const B=t.stops[O],V=B[0].zoom;E[V]===void 0&&(E[V]={zoom:V,type:t.type,property:t.property,default:t.default,stops:[]},A.push(V)),E[V].stops.push([B[0].value,B[1]])}const k=[];for(const O of A)k.push([E[O].zoom,pl(E[O],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:fs.interpolationFactor.bind(void 0,L),zoomStops:k.map(O=>O[0]),evaluate:({zoom:O},B)=>Rs({stops:k,base:t.base},e,O).evaluate(O,B)}}if(u){const E=f==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:fs.interpolationFactor.bind(void 0,E),zoomStops:t.stops.map(A=>A[0]),evaluate:({zoom:A})=>m(t,e,A,x,w)}}return{kind:"source",evaluate(E,A){const k=A&&A.properties?A.properties[t.property]:void 0;return k===void 0?ro(t.default,e.default):m(t,e,k,x,w)}}}function ro(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function Nu(t,e,i,l,u){return ro(typeof i===u?l[i]:void 0,t.default,e.default)}function fl(t,e,i){if($t(i)!=="number")return ro(t.default,e.default);const l=t.stops.length;if(l===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[l-1][0])return t.stops[l-1][1];const u=il(t.stops.map(f=>f[0]),i);return t.stops[u][1]}function Rs(t,e,i){const l=t.base!==void 0?t.base:1;if($t(i)!=="number")return ro(t.default,e.default);const u=t.stops.length;if(u===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[u-1][0])return t.stops[u-1][1];const f=il(t.stops.map(A=>A[0]),i),m=function(A,k,L,O){const B=O-L,V=A-L;return B===0?0:k===1?V/B:(Math.pow(k,V)-1)/(Math.pow(k,B)-1)}(i,l,t.stops[f][0],t.stops[f+1][0]),x=t.stops[f][1],w=t.stops[f+1][1];let E=ta[e.type]||Fu;if(t.colorSpace&&t.colorSpace!=="rgb"){const A=Lc[t.colorSpace];E=(k,L)=>A.reverse(A.interpolate(A.forward(k),A.forward(L),m))}return typeof x.evaluate=="function"?{evaluate(...A){const k=x.evaluate.apply(void 0,A),L=w.evaluate.apply(void 0,A);if(k!==void 0&&L!==void 0)return E(k,L,m)}}:E(x,w,m)}function ju(t,e,i){return e.type==="color"?i=Bi.parse(i):e.type==="formatted"?i=Tn.fromString(i.toString()):e.type==="resolvedImage"?i=Gn.fromString(i.toString()):$t(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),ro(i,t.default,e.default)}class _l{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new yc,this._defaultValue=i?function(l){return l.type==="color"&&(aa(l.default)||Array.isArray(l.default))?new Bi(0,0,0,0):l.type==="color"?Bi.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,l,u,f,m,x,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,u,f,m,x,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new an(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function oo(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in oa}function ao(t,e){const i=new Ec(oa,[],e?function(u){const f={color:On,string:Ft,number:lt,enum:Ft,boolean:Rt,formatted:qo,resolvedImage:gr};return u.type==="array"?Un(f[u.value]||Ot,u.length):f[u.type]}(e):void 0),l=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Bu(new _l(l,e)):wr(i.errors)}class Nc{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Ds(i.expression)}evaluateWithoutErrorHandling(e,i,l,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,u,f,m)}evaluate(e,i,l,u,f,m){return this._styleExpression.evaluate(e,i,l,u,f,m)}}class la{constructor(e,i,l,u){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Ds(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,l,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,u,f,m)}evaluate(e,i,l,u,f,m){return this._styleExpression.evaluate(e,i,l,u,f,m)}interpolationFactor(e,i,l){return this.interpolationType?fs.interpolationFactor(this.interpolationType,e,i,l):0}}function ca(t,e){if((t=ao(t,e)).result==="error")return t;const i=t.value.expression,l=eo(i);if(!l&&!so(e))return wr([new ds("","data expressions not supported")]);const u=vr(i,["zoom","pitch","distance-from-center"]);if(!u&&!ul(e))return wr([new ds("","zoom expressions not supported")]);const f=gl(i);return f||u?f instanceof ds?wr([f]):f instanceof fs&&!dl(e)?wr([new ds("",'"interpolate" expressions cannot be used with this property')]):Bu(f?new la(l?"camera":"composite",t.value,f.labels,f instanceof fs?f.interpolation:void 0):new Nc(l?"constant":"source",t.value)):wr([new ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class ml{constructor(e,i){this._parameters=e,this._specification=i,Is(this,pl(this._parameters,this._specification))}static deserialize(e){return new ml(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function gl(t){let e=null;if(t instanceof Cu)e=gl(t.result);else if(t instanceof zc){for(const i of t.args)if(e=gl(i),e)break}else(t instanceof Sc||t instanceof fs)&&t.input instanceof ks&&t.input.name==="zoom"&&(e=t);return e instanceof ds||t.eachChild(i=>{const l=gl(i);l instanceof ds?e=l:!e&&l?e=new ds("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new ds("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ht{constructor(e,i,l,u){this.message=(e?`${e}: `:"")+l,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function ts(t){const e=t.key,i=t.value,l=t.valueSpec||{},u=t.objectElementValidators||{},f=t.style,m=t.styleSpec;let x=[];const w=$t(i);if(w!=="object")return[new ht(e,i,`object expected, ${w} found`)];for(const E in i){const A=E.split(".")[0];let k;u[A]?k=u[A]:l[A]?k=dn:u["*"]?k=u["*"]:l["*"]&&(k=dn),k?x=x.concat(k({key:(e&&`${e}.`)+E,value:i[E],valueSpec:l[A]||l["*"],style:f,styleSpec:m,object:i,objectKey:E},i)):x.push(new ht(e,i[E],`unknown property "${E}"`))}for(const E in l)u[E]||l[E].required&&l[E].default===void 0&&i[E]===void 0&&x.push(new ht(e,i,`missing required property "${E}"`));return x}function Vu(t){const e=t.value,i=t.valueSpec,l=t.style,u=t.styleSpec,f=t.key,m=t.arrayElementValidator||dn;if($t(e)!=="array")return[new ht(f,e,`array expected, ${$t(e)} found`)];if(i.length&&e.length!==i.length)return[new ht(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ht(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};u.$version<7&&(x.function=i.function),$t(i.value)==="object"&&(x=i.value);let w=[];for(let E=0;E<e.length;E++)w=w.concat(m({array:e,arrayIndex:E,value:e[E],valueSpec:x,style:l,styleSpec:u,key:`${f}[${E}]`}));return w}function ha(t){const e=t.key,i=t.value,l=t.valueSpec;let u=$t(i);if(u==="number"&&i!=i&&(u="NaN"),u!=="number")return[new ht(e,i,`number expected, ${u} found`)];if("minimum"in l){let f=l.minimum;if($t(l.minimum)==="array"&&(f=l.minimum[t.arrayIndex]),i<f)return[new ht(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in l){let f=l.maximum;if($t(l.maximum)==="array"&&(f=l.maximum[t.arrayIndex]),i>f)return[new ht(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function ua(t){const e=t.valueSpec,i=ji(t.value.type);let l,u,f,m={};const x=i!=="categorical"&&t.value.property===void 0,w=!x,E=$t(t.value.stops)==="array"&&$t(t.value.stops[0])==="array"&&$t(t.value.stops[0][0])==="object",A=ts({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(O){if(i==="identity")return[new ht(O.key,O.value,'identity function may not have a "stops" property')];let B=[];const V=O.value;return B=B.concat(Vu({key:O.key,value:V,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:k})),$t(V)==="array"&&V.length===0&&B.push(new ht(O.key,V,"array must have at least one stop")),B},default:function(O){return dn({key:O.key,value:O.value,valueSpec:e,style:O.style,styleSpec:O.styleSpec})}}});return i==="identity"&&x&&A.push(new ht(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||A.push(new ht(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!dl(t.valueSpec)&&A.push(new ht(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(w&&!so(t.valueSpec)?A.push(new ht(t.key,t.value,"property functions not supported")):x&&!ul(t.valueSpec)&&A.push(new ht(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!E||t.value.property!==void 0||A.push(new ht(t.key,t.value,'"property" property is required')),A;function k(O){let B=[];const V=O.value,Z=O.key;if($t(V)!=="array")return[new ht(Z,V,`array expected, ${$t(V)} found`)];if(V.length!==2)return[new ht(Z,V,`array length 2 expected, length ${V.length} found`)];if(E){if($t(V[0])!=="object")return[new ht(Z,V,`object expected, ${$t(V[0])} found`)];if(V[0].zoom===void 0)return[new ht(Z,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new ht(Z,V,"object stop key must have value")];const ee=ji(V[0].zoom);if(typeof ee!="number")return[new ht(Z,V[0].zoom,"stop zoom values must be numbers")];if(f&&f>ee)return[new ht(Z,V[0].zoom,"stop zoom values must appear in ascending order")];ee!==f&&(f=ee,u=void 0,m={}),B=B.concat(ts({key:`${Z}[0]`,value:V[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:ha,value:L}}))}else B=B.concat(L({key:`${Z}[0]`,value:V[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},V));return oo(en(V[1]))?B.concat([new ht(`${Z}[1]`,V[1],"expressions are not allowed in function stops.")]):B.concat(dn({key:`${Z}[1]`,value:V[1],valueSpec:e,style:O.style,styleSpec:O.styleSpec}))}function L(O,B){const V=$t(O.value),Z=ji(O.value),ee=O.value!==null?O.value:B;if(l){if(V!==l)return[new ht(O.key,ee,`${V} stop domain type must match previous stop domain type ${l}`)]}else l=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new ht(O.key,ee,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&i!=="categorical"){let le=`number expected, ${V} found`;return so(e)&&i===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ht(O.key,ee,le)]}return i!=="categorical"||V!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?i!=="categorical"&&V==="number"&&typeof Z=="number"&&typeof u=="number"&&u!==void 0&&Z<u?[new ht(O.key,ee,"stop domain values must appear in ascending order")]:(u=Z,i==="categorical"&&Z in m?[new ht(O.key,ee,"stop domain values must be unique")]:(m[Z]=!0,[])):[new ht(O.key,ee,`integer expected, found ${String(Z)}`)]}}function tn(t){const e=(t.expressionContext==="property"?ca:ao)(en(t.value),t.valueSpec);if(e.result==="error")return e.value.map(l=>new ht(`${t.key}${l.key}`,t.value,l.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new ht(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Ds(i))return[new ht(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return da(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!vr(i,["zoom","feature-state"]))return[new ht(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!eo(i))return[new ht(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function da(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)i.delete(u);if(i.size===0)return[];const l=[];return t instanceof ks&&i.has(t.name)?[new ht(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{l.push(...da(u,e))}),l)}function yl(t){const e=t.key,i=t.value,l=t.valueSpec,u=[];return Array.isArray(l.values)?l.values.indexOf(ji(i))===-1&&u.push(new ht(e,i,`expected one of [${l.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(l.values).indexOf(ji(i))===-1&&u.push(new ht(e,i,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(i)} found`)),u}function jc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!jc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function xl(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};jc(t)||(t=co(t));const i=t;let l=!0;try{l=function(E){if(!lo(E))return E;let A=en(E);return vl(A),A=Uu(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const u=Oe[`filter_${e}`],f=ao(l,u);let m=null;if(f.result==="error")throw new Error(f.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,A,k)=>f.value.evaluate(E,A,{},k);let x=null,w=null;if(l!==i){const E=ao(i,u);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,k,L,O,B)=>E.value.evaluate(A,k,{},L,void 0,void 0,O,B),w=!eo(E.value.expression)}return{filter:m,dynamicFilter:x||void 0,needGeometry:Gu(l),needFeature:!!w}}function Uu(t){if(!Array.isArray(t))return t;const e=function(i){if(Vc.has(i[0])){for(let l=1;l<i.length;l++)if(lo(i[l]))return!0}return i}(t);return e===!0?e:e.map(i=>Uu(i))}function vl(t){let e=!1;const i=[];if(t[0]==="case"){for(let l=1;l<t.length-1;l+=2)e=e||lo(t[l]),i.push(t[l+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||lo(t[1]);for(let l=2;l<t.length-1;l+=2)i.push(t[l+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||lo(t[1]);for(let l=1;l<t.length-1;l+=2)i.push(t[l+1])}e&&(t.length=0,t.push("any",...i));for(let l=1;l<t.length;l++)vl(t[l])}function lo(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(lo(t[i]))return!0;return!1}const Vc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Jp(t,e){return t<e?-1:t>e?1:0}function Gu(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(Gu(t[e]))return!0;return!1}function co(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Uc(t[1],t[2],"=="):e==="!="?bl(Uc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Uc(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(co))):e==="all"?["all"].concat(t.slice(1).map(co)):e==="none"?["all"].concat(t.slice(1).map(co).map(bl)):e==="in"?Gc(t[1],t.slice(2)):e==="!in"?bl(Gc(t[1],t.slice(2))):e==="has"?$c(t[1]):e==="!has"?bl($c(t[1])):e!=="within"||t;var i}function Uc(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function Gc(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Jp)]]:["filter-in-small",t,["literal",e]]}}function $c(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function bl(t){return["!",t]}function pa(t){return jc(en(t.value))?tn(Is({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):fa(t)}function fa(t){const e=t.value,i=t.key;if($t(e)!=="array")return[new ht(i,e,`array expected, ${$t(e)} found`)];const l=t.styleSpec;let u,f=[];if(e.length<1)return[new ht(i,e,"filter array must have at least 1 element")];switch(f=f.concat(yl({key:`${i}[0]`,value:e[0],valueSpec:l.filter_operator,style:t.style,styleSpec:t.styleSpec})),ji(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ji(e[1])==="$type"&&f.push(new ht(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new ht(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=$t(e[1]),u!=="string"&&f.push(new ht(`${i}[1]`,e[1],`string expected, ${u} found`)));for(let m=2;m<e.length;m++)u=$t(e[m]),ji(e[1])==="$type"?f=f.concat(yl({key:`${i}[${m}]`,value:e[m],valueSpec:l.geometry_type,style:t.style,styleSpec:t.styleSpec})):u!=="string"&&u!=="number"&&u!=="boolean"&&f.push(new ht(`${i}[${m}]`,e[m],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(fa({key:`${i}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=$t(e[1]),e.length!==2?f.push(new ht(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="string"&&f.push(new ht(`${i}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=$t(e[1]),e.length!==2?f.push(new ht(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):u!=="object"&&f.push(new ht(`${i}[1]`,e[1],`object expected, ${u} found`))}return f}function qc(t,e){const i=t.key,l=t.style,u=t.styleSpec,f=t.value,m=t.objectKey,x=u[`${e}_${t.layerType}`];if(!x)return[];const w=m.match(/^(.*)-transition$/);if(e==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return dn({key:i,value:f,valueSpec:u.transition,style:l,styleSpec:u});const E=t.valueSpec||x[m];if(!E)return[new ht(i,f,`unknown property "${m}"`)];let A;if($t(f)==="string"&&so(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(f))){const L=`\`{ "type": "identity", "property": ${A?JSON.stringify(A[1]):'"_"'} }\``;return[new ht(i,f,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${L}.`)]}const k=[];return t.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&k.push(new ht(i,f,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&aa(en(f))&&ji(f.type)==="identity"&&k.push(new ht(i,f,'"text-font" does not support identity functions'))),k.concat(dn({key:t.key,value:f,valueSpec:E,style:l,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:m}))}function $u(t){return qc(t,"paint")}function Wc(t){return qc(t,"layout")}function qu(t){let e=[];const i=t.value,l=t.key,u=t.style,f=t.styleSpec;i.type||i.ref||e.push(new ht(l,i,'either "type" or "ref" is required'));let m=ji(i.type);const x=ji(i.ref);if(i.id){const w=ji(i.id);for(let E=0;E<t.arrayIndex;E++){const A=u.layers[E];ji(A.id)===w&&e.push(new ht(l,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&e.push(new ht(l,i[E],`"${E}" is prohibited for ref layers`))}),u.layers.forEach(E=>{ji(E.id)===x&&(w=E)}),w?w.ref?e.push(new ht(l,i.ref,"ref cannot reference another ref layer")):m=ji(w.type):typeof x=="string"&&e.push(new ht(l,i.ref,`ref layer "${x}" not found`))}else if(m!=="background"&&m!=="sky")if(i.source){const w=u.sources&&u.sources[i.source],E=w&&ji(w.type);w?E==="vector"&&m==="raster"?e.push(new ht(l,i.source,`layer "${i.id}" requires a raster source`)):E==="raster"&&m!=="raster"?e.push(new ht(l,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&m!=="hillshade"?e.push(new ht(l,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||E==="geojson"&&w.lineMetrics||e.push(new ht(l,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ht(l,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ht(l,i.source,`source "${i.source}" not found`))}else e.push(new ht(l,i,'missing required property "source"'));return e=e.concat(ts({key:l,value:i,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dn({key:`${l}.type`,value:i.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:w=>pa(Is({layerType:m},w)),layout:w=>ts({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Wc(Is({layerType:m},E))}}),paint:w=>ts({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>$u(Is({layerType:m},E))}})}})),e}function Js(t){const e=t.value,i=t.key,l=$t(e);return l!=="string"?[new ht(i,e,`string expected, ${l} found`)]:[]}const Wu={promoteId:function({key:t,value:e}){if($t(e)==="string")return Js({key:t,value:e});{const i=[];for(const l in e)i.push(...Js({key:`${t}.${l}`,value:e[l]}));return i}}};function Zu(t){const e=t.value,i=t.key,l=t.styleSpec,u=t.style;if(!e.type)return[new ht(i,e,'"type" is required')];const f=ji(e.type);let m;switch(f){case"vector":case"raster":case"raster-dem":return m=ts({key:i,value:e,valueSpec:l[`source_${f.replace("-","_")}`],style:t.style,styleSpec:l,objectElementValidators:Wu}),m;case"geojson":if(m=ts({key:i,value:e,valueSpec:l.source_geojson,style:u,styleSpec:l,objectElementValidators:Wu}),e.cluster)for(const x in e.clusterProperties){const[w,E]=e.clusterProperties[x],A=typeof w=="string"?[w,["accumulated"],["get",x]]:w;m.push(...tn({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),m.push(...tn({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return m;case"video":return ts({key:i,value:e,valueSpec:l.source_video,style:u,styleSpec:l});case"image":return ts({key:i,value:e,valueSpec:l.source_image,style:u,styleSpec:l});case"canvas":return[new ht(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return yl({key:`${i}.type`,value:e.type,valueSpec:{values:Qp(l)},style:u,styleSpec:l})}}function Qp(t){return t.source.reduce((e,i)=>{const l=t[i];return l.type.type==="enum"&&(e=e.concat(Object.keys(l.type.values))),e},[])}function Hu(t){const e=t.value,i=t.styleSpec,l=i.light,u=t.style;let f=[];const m=$t(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new ht("light",e,`object expected, ${m} found`)]),f;for(const x in e){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&l[w[1]]&&l[w[1]].transition?dn({key:x,value:e[x],valueSpec:i.transition,style:u,styleSpec:i}):l[x]?dn({key:x,value:e[x],valueSpec:l[x],style:u,styleSpec:i}):[new ht(x,e[x],`unknown property "${x}"`)])}return f}function Zc(t){const e=t.value,i=t.key,l=t.style,u=t.styleSpec,f=u.terrain;let m=[];const x=$t(e);if(e===void 0)return m;if(x!=="object")return m=m.concat([new ht("terrain",e,`object expected, ${x} found`)]),m;for(const w in e){const E=w.match(/^(.*)-transition$/);m=m.concat(E&&f[E[1]]&&f[E[1]].transition?dn({key:w,value:e[w],valueSpec:u.transition,style:l,styleSpec:u}):f[w]?dn({key:w,value:e[w],valueSpec:f[w],style:l,styleSpec:u}):[new ht(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=l.sources&&l.sources[e.source],E=w&&ji(w.type);w?E!=="raster-dem"&&m.push(new ht(i,e.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):m.push(new ht(i,e.source,`source "${e.source}" not found`))}else m.push(new ht(i,e,'terrain is missing required property "source"'));return m}function Xu(t){const e=t.value,i=t.style,l=t.styleSpec,u=l.fog;let f=[];const m=$t(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new ht("fog",e,`object expected, ${m} found`)]),f;for(const x in e){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&u[w[1]]&&u[w[1]].transition?dn({key:x,value:e[x],valueSpec:l.transition,style:i,styleSpec:l}):u[x]?dn({key:x,value:e[x],valueSpec:u[x],style:i,styleSpec:l}):[new ht(x,e[x],`unknown property "${x}"`)])}return f}const Yu={"*":()=>[],array:Vu,boolean:function(t){const e=t.value,i=t.key,l=$t(e);return l!=="boolean"?[new ht(i,e,`boolean expected, ${l} found`)]:[]},number:ha,color:function(t){const e=t.key,i=t.value,l=$t(i);return l!=="string"?[new ht(e,i,`color expected, ${l} found`)]:uc(i)===null?[new ht(e,i,`color expected, "${i}" found`)]:[]},enum:yl,filter:pa,function:ua,layer:qu,object:ts,source:Zu,light:Hu,terrain:Zc,fog:Xu,string:Js,formatted:function(t){return Js(t).length===0?[]:tn(t)},resolvedImage:function(t){return Js(t).length===0?[]:tn(t)},projection:function(t){const e=t.value,i=t.styleSpec,l=i.projection,u=t.style;let f=[];const m=$t(e);if(m==="object")for(const x in e)f=f.concat(dn({key:x,value:e[x],valueSpec:l[x],style:u,styleSpec:i}));else m!=="string"&&(f=f.concat([new ht("projection",e,`object or string expected, ${m} found`)]));return f}};function dn(t){const e=t.value,i=t.valueSpec,l=t.styleSpec;return i.expression&&aa(ji(e))?ua(t):i.expression&&oo(en(e))?tn(t):i.type&&Yu[i.type]?Yu[i.type](t):ts(Is({},t,{valueSpec:i.type?l[i.type]:i}))}function ef(t){const e=t.value,i=t.key,l=Js(t);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new ht(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new ht(i,e,'"glyphs" url must include a "{range}" token'))),l}function Ku(t,e=Oe){return qn(dn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:ef,"*":()=>[]}}))}const tf=t=>qn($u(t)),nf=t=>qn(Wc(t));function qn(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Ju(t,e){let i=!1;if(e&&e.length)for(const l of e)t.fire(new As(new Error(l.message))),i=!0;return i}var sf=_s,is=3;function _s(t,e,i){var l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(i=u[2]);for(var f=0;f<this.d*this.d;f++){var m=u[is+f],x=u[is+f+1];l.push(m===x?null:u.subarray(m,x))}var w=u[is+l.length+1];this.keys=u.subarray(u[is+l.length],w),this.bboxes=u.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var A=i/e*t;this.min=-A,this.max=t+A}_s.prototype.insert=function(t,e,i,l,u){this._forEachCell(e,i,l,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(u)},_s.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_s.prototype._insertCell=function(t,e,i,l,u,f){this.cells[u].push(f)},_s.prototype.query=function(t,e,i,l,u){var f=this.min,m=this.max;if(t<=f&&e<=f&&m<=i&&m<=l&&!u)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(t,e,i,l,this._queryCell,x,{},u),x},_s.prototype._queryCell=function(t,e,i,l,u,f,m,x){var w=this.cells[u];if(w!==null)for(var E=this.keys,A=this.bboxes,k=0;k<w.length;k++){var L=w[k];if(m[L]===void 0){var O=4*L;(x?x(A[O+0],A[O+1],A[O+2],A[O+3]):t<=A[O+2]&&e<=A[O+3]&&i>=A[O+0]&&l>=A[O+1])?(m[L]=!0,f.push(E[L])):m[L]=!1}}},_s.prototype._forEachCell=function(t,e,i,l,u,f,m,x){for(var w=this._convertToCellCoord(t),E=this._convertToCellCoord(e),A=this._convertToCellCoord(i),k=this._convertToCellCoord(l),L=w;L<=A;L++)for(var O=E;O<=k;O++){var B=this.d*O+L;if((!x||x(this._convertFromCellCoord(L),this._convertFromCellCoord(O),this._convertFromCellCoord(L+1),this._convertFromCellCoord(O+1)))&&u.call(this,t,e,i,l,B,f,m,x))return}},_s.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},_s.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},_s.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=is+this.cells.length+1+1,i=0,l=0;l<this.cells.length;l++)i+=this.cells[l].length;var u=new Int32Array(e+i+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,m=0;m<t.length;m++){var x=t[m];u[is+m]=f,u.set(x,f),f+=x.length}return u[is+t.length]=f,u.set(this.keys,f),u[is+t.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};var Tr=Fe(sf);const wl={};function ut(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),wl[e]={klass:t,omit:i.omit||[]}}ut(Object,"Object"),Tr.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},Tr.deserialize=function(t){return new Tr(t.buffer)},Object.defineProperty(Tr,"name",{value:"Grid"}),ut(Tr,"Grid"),ut(Bi,"Color"),ut(Error,"Error"),ut(Ys,"AJAXError"),ut(Gn,"ResolvedImage"),ut(ml,"StylePropertyFunction"),ut(_l,"StyleExpression",{omit:["_evaluator"]}),ut(la,"ZoomDependentExpression"),ut(Nc,"ZoomConstantExpression"),ut(ks,"CompoundExpression",{omit:["_evaluate"]});for(const t in oa)wl[oa[t]._classRegistryKey]||ut(oa[t],`Expression${t}`);function Hc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Xc(t){return T.ImageBitmap&&t instanceof T.ImageBitmap}function ho(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Hc(t)||Xc(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof T.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const l of t)i.push(ho(l,e));return i}if(typeof t=="object"){const i=t.constructor,l=i._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const u=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const f in t)t.hasOwnProperty(f)&&(wl[l].omit.indexOf(f)>=0||(u[f]=ho(t[f],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(u.$name=l),u}throw new Error("can't serialize object of type "+typeof t)}function Er(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Hc(t)||Xc(t)||ArrayBuffer.isView(t)||t instanceof T.ImageData)return t;if(Array.isArray(t))return t.map(Er);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=wl[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const l=Object.create(i.prototype);for(const u of Object.keys(t))u!=="$name"&&(l[u]=Er(t[u]));return l}throw new Error("can't deserialize object of type "+typeof t)}const at={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Yc(t){for(const e of t)if(Kc(e.charCodeAt(0)))return!0;return!1}function rf(t){for(const e of t)if(!Qu(e.charCodeAt(0)))return!1;return!0}function Qu(t){return!(at.Arabic(t)||at["Arabic Supplement"](t)||at["Arabic Extended-A"](t)||at["Arabic Presentation Forms-A"](t)||at["Arabic Presentation Forms-B"](t))}function Kc(t){return!(t!==746&&t!==747&&(t<4352||!(at["Bopomofo Extended"](t)||at.Bopomofo(t)||at["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||at["CJK Compatibility Ideographs"](t)||at["CJK Compatibility"](t)||at["CJK Radicals Supplement"](t)||at["CJK Strokes"](t)||!(!at["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||at["CJK Unified Ideographs Extension A"](t)||at["CJK Unified Ideographs"](t)||at["Enclosed CJK Letters and Months"](t)||at["Hangul Compatibility Jamo"](t)||at["Hangul Jamo Extended-A"](t)||at["Hangul Jamo Extended-B"](t)||at["Hangul Jamo"](t)||at["Hangul Syllables"](t)||at.Hiragana(t)||at["Ideographic Description Characters"](t)||at.Kanbun(t)||at["Kangxi Radicals"](t)||at["Katakana Phonetic Extensions"](t)||at.Katakana(t)&&t!==12540||!(!at["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!at["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||at["Unified Canadian Aboriginal Syllabics"](t)||at["Unified Canadian Aboriginal Syllabics Extended"](t)||at["Vertical Forms"](t)||at["Yijing Hexagram Symbols"](t)||at["Yi Syllables"](t)||at["Yi Radicals"](t))))}function ed(t){return!(Kc(t)||function(e){return!!(at["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||at["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||at["Letterlike Symbols"](e)||at["Number Forms"](e)||at["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||at["Control Pictures"](e)&&e!==9251||at["Optical Character Recognition"](e)||at["Enclosed Alphanumerics"](e)||at["Geometric Shapes"](e)||at["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||at["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||at["CJK Symbols and Punctuation"](e)||at.Katakana(e)||at["Private Use Area"](e)||at["CJK Compatibility Forms"](e)||at["Small Form Variants"](e)||at["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function td(t){return t>=1424&&t<=2303||at["Arabic Presentation Forms-A"](t)||at["Arabic Presentation Forms-B"](t)}function of(t,e){return!(!e&&td(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||at.Khmer(t))}function af(t){for(const e of t)if(td(e.charCodeAt(0)))return!0;return!1}const Jc="deferred",Qc="loading",eh="loaded";let uo=null,p="unavailable",s=null;const c=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(p="error"),uo&&uo(t)};function _(){y.fire(new mr("pluginStateChange",{pluginStatus:p,pluginURL:s}))}const y=new $o,b=function(){return p},M=function(){if(p!==Jc||!s)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");p=Qc,_(),s&&Wr({url:s},t=>{t?c(t):(p=eh,_())})},S={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>p===eh||S.applyArabicShaping!=null,isLoading:()=>p===Qc,setState(t){p=t.pluginStatus,s=t.pluginURL},isParsed:()=>S.applyArabicShaping!=null&&S.processBidirectionalText!=null&&S.processStyledBidirectionalText!=null,getPluginURL:()=>s};class P{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,l){for(const u of i)if(!of(u.charCodeAt(0),l))return!1;return!0}(e,S.isLoaded())}}class z{constructor(e,i){this.property=e,this.value=i,this.expression=function(l,u){if(aa(l))return new ml(l,u);if(oo(l)){const f=ca(l,u);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=l;return typeof l=="string"&&u.type==="color"&&(f=Bi.parse(l)),{kind:"constant",evaluate:()=>f}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l){return this.property.possiblyEvaluate(this,e,i,l)}}class D{constructor(e){this.property=e,this.value=new z(e,void 0)}transitioned(e,i){return new q(this.property,this.value,i,_i({},e.transition,this.transition),e.now)}untransitioned(){return new q(this.property,this.value,null,{},0)}}class N{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return zn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new D(this._values[e].property)),this._values[e].value=new z(this._values[e].property,i===null?void 0:zn(i))}getTransition(e){return zn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new D(this._values[e].property)),this._values[e].transition=zn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const l=new X(this._properties);for(const u of Object.keys(this._values))l._values[u]=this._values[u].transitioned(e,i._values[u]);return l}untransitioned(){const e=new X(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class q{constructor(e,i,l,u,f){const m=u.delay||0,x=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+m,this.end=this.begin+x,e.specification.transition&&(u.delay||u.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,l),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(e,i,l);{const x=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,l),f,Kt(x))}}return f}}class X{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const u=new Q(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,l);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class J{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return zn(this._values[e].value)}setValue(e,i){this._values[e]=new z(this._values[e].property,i===null?void 0:zn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l){const u=new Q(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,l);return u}}class K{constructor(e,i,l){this.property=e,this.value=i,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,u){return this.property.evaluate(this.value,this.parameters,e,i,l,u)}}class Q{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class j{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const u=ta[this.specification.type];return u?u(e,i,l):e}}class H{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,u){return new K(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},l,u)}:e.expression,i)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new K(this,{kind:"constant",value:void 0},e.parameters);const u=ta[this.specification.type];return u?new K(this,{kind:"constant",value:u(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,u,f,m){return e.kind==="constant"?e.value:e.evaluate(i,l,u,f,m)}}class ne{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,u){return!!e.expression.evaluate(i,null,{},l,u)}interpolate(){return!1}}class se{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new P(0,{});for(const l in e){const u=e[l];u.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new z(u,void 0),m=this.defaultTransitionablePropertyValues[l]=new D(u);this.defaultTransitioningPropertyValues[l]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(i)}}}function fe(t,e){return 256*(t=bt(Math.floor(t),0,255))+bt(Math.floor(e),0,255)}ut(H,"DataDrivenProperty"),ut(j,"DataConstantProperty"),ut(ne,"ColorRampProperty");const me={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _e{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ve{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xe(t,e=1){let i=0,l=0;return{members:t.map(u=>{const f=me[u.type].BYTES_PER_ELEMENT,m=i=Ae(i,Math.max(e,f)),x=u.components||1;return l=Math.max(l,f),i+=f*x,{name:u.name,type:u.type,components:x,offset:m}}),size:Ae(i,Math.max(l,e)),alignment:e}}function Ae(t,e){return Math.ceil(t/e)*e}class Ze extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=l,e}}Ze.prototype.bytesPerElement=4,ut(Ze,"StructArrayLayout2i4");class Ee extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=u,e}}Ee.prototype.bytesPerElement=6,ut(Ee,"StructArrayLayout3i6");class je extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.int16[m+2]=u,this.int16[m+3]=f,e}}je.prototype.bytesPerElement=8,ut(je,"StructArrayLayout4i8");class Ce extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,m,x)}emplace(e,i,l,u,f,m,x,w){const E=6*e,A=12*e,k=3*e;return this.int16[E+0]=i,this.int16[E+1]=l,this.uint8[A+4]=u,this.uint8[A+5]=f,this.uint8[A+6]=m,this.uint8[A+7]=x,this.float32[k+2]=w,e}}Ce.prototype.bytesPerElement=12,ut(Ce,"StructArrayLayout2i4ub1f12");class We extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=l,this.float32[m+2]=u,this.float32[m+3]=f,e}}We.prototype.bytesPerElement=16,ut(We,"StructArrayLayout4f16");class Se extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,u,f)}emplace(e,i,l,u,f,m){const x=6*e,w=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=l,this.uint16[x+2]=u,this.uint16[x+3]=f,this.float32[w+2]=m,e}}Se.prototype.bytesPerElement=12,ut(Se,"StructArrayLayout4ui1f12");class Ne extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=l,this.uint16[m+2]=u,this.uint16[m+3]=f,e}}Ne.prototype.bytesPerElement=8,ut(Ne,"StructArrayLayout4ui8");class Xe extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,u,f,m)}emplace(e,i,l,u,f,m,x){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=u,this.int16[w+3]=f,this.int16[w+4]=m,this.int16[w+5]=x,e}}Xe.prototype.bytesPerElement=12,ut(Xe,"StructArrayLayout6i12");class Ge extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,x,w,E,A,k,L){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,l,u,f,m,x,w,E,A,k,L)}emplace(e,i,l,u,f,m,x,w,E,A,k,L,O){const B=12*e;return this.int16[B+0]=i,this.int16[B+1]=l,this.int16[B+2]=u,this.int16[B+3]=f,this.uint16[B+4]=m,this.uint16[B+5]=x,this.uint16[B+6]=w,this.uint16[B+7]=E,this.int16[B+8]=A,this.int16[B+9]=k,this.int16[B+10]=L,this.int16[B+11]=O,e}}Ge.prototype.bytesPerElement=24,ut(Ge,"StructArrayLayout4i4ui4i24");class Ye extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,u,f,m)}emplace(e,i,l,u,f,m,x){const w=10*e,E=5*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=u,this.float32[E+2]=f,this.float32[E+3]=m,this.float32[E+4]=x,e}}Ye.prototype.bytesPerElement=20,ut(Ye,"StructArrayLayout3i3f20");class mt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}mt.prototype.bytesPerElement=4,ut(mt,"StructArrayLayout1ul4");class wt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,x,w,E,A,k,L,O){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,l,u,f,m,x,w,E,A,k,L,O)}emplace(e,i,l,u,f,m,x,w,E,A,k,L,O,B){const V=20*e,Z=10*e;return this.int16[V+0]=i,this.int16[V+1]=l,this.int16[V+2]=u,this.int16[V+3]=f,this.int16[V+4]=m,this.float32[Z+3]=x,this.float32[Z+4]=w,this.float32[Z+5]=E,this.float32[Z+6]=A,this.int16[V+14]=k,this.uint32[Z+8]=L,this.uint16[V+18]=O,this.uint16[V+19]=B,e}}wt.prototype.bytesPerElement=40,ut(wt,"StructArrayLayout5i4f1i1ul2ui40");class dt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,u,f,m,x)}emplace(e,i,l,u,f,m,x,w){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=l,this.int16[E+2]=u,this.int16[E+4]=f,this.int16[E+5]=m,this.int16[E+6]=x,this.int16[E+7]=w,e}}dt.prototype.bytesPerElement=16,ut(dt,"StructArrayLayout3i2i2i16");class xt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,u,f)}emplace(e,i,l,u,f,m){const x=4*e,w=8*e;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=u,this.int16[w+6]=f,this.int16[w+7]=m,e}}xt.prototype.bytesPerElement=16,ut(xt,"StructArrayLayout2f1f2i16");class Bt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=12*e,x=3*e;return this.uint8[m+0]=i,this.uint8[m+1]=l,this.float32[x+1]=u,this.float32[x+2]=f,e}}Bt.prototype.bytesPerElement=12,ut(Bt,"StructArrayLayout2ub2f12");class Lt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=l,this.float32[f+2]=u,e}}Lt.prototype.bytesPerElement=12,ut(Lt,"StructArrayLayout3f12");class _t extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,l)}emplace(e,i,l,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=l,this.uint16[f+2]=u,e}}_t.prototype.bytesPerElement=6,ut(_t,"StructArrayLayout3ui6");class Jt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,x,w,E,A,k,L,O,B,V,Z,ee,le,te,oe,de){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,i,l,u,f,m,x,w,E,A,k,L,O,B,V,Z,ee,le,te,oe,de)}emplace(e,i,l,u,f,m,x,w,E,A,k,L,O,B,V,Z,ee,le,te,oe,de,ue){const Ie=30*e,Me=15*e,Be=60*e;return this.int16[Ie+0]=i,this.int16[Ie+1]=l,this.int16[Ie+2]=u,this.float32[Me+2]=f,this.float32[Me+3]=m,this.uint16[Ie+8]=x,this.uint16[Ie+9]=w,this.uint32[Me+5]=E,this.uint32[Me+6]=A,this.uint32[Me+7]=k,this.uint16[Ie+16]=L,this.uint16[Ie+17]=O,this.uint16[Ie+18]=B,this.float32[Me+10]=V,this.float32[Me+11]=Z,this.uint8[Be+48]=ee,this.uint8[Be+49]=le,this.uint8[Be+50]=te,this.uint32[Me+13]=oe,this.int16[Ie+28]=de,this.uint8[Be+58]=ue,e}}Jt.prototype.bytesPerElement=60,ut(Jt,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ii extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f,m,x,w,E,A,k,L,O,B,V,Z,ee,le,te,oe,de,ue,Ie,Me,Be,He,Pe,Ve,Ue,$e){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,e,i,l,u,f,m,x,w,E,A,k,L,O,B,V,Z,ee,le,te,oe,de,ue,Ie,Me,Be,He,Pe,Ve,Ue,$e)}emplace(e,i,l,u,f,m,x,w,E,A,k,L,O,B,V,Z,ee,le,te,oe,de,ue,Ie,Me,Be,He,Pe,Ve,Ue,$e,Qe){const ze=38*e,rt=19*e;return this.int16[ze+0]=i,this.int16[ze+1]=l,this.int16[ze+2]=u,this.float32[rt+2]=f,this.float32[rt+3]=m,this.int16[ze+8]=x,this.int16[ze+9]=w,this.int16[ze+10]=E,this.int16[ze+11]=A,this.int16[ze+12]=k,this.int16[ze+13]=L,this.uint16[ze+14]=O,this.uint16[ze+15]=B,this.uint16[ze+16]=V,this.uint16[ze+17]=Z,this.uint16[ze+18]=ee,this.uint16[ze+19]=le,this.uint16[ze+20]=te,this.uint16[ze+21]=oe,this.uint16[ze+22]=de,this.uint16[ze+23]=ue,this.uint16[ze+24]=Ie,this.uint16[ze+25]=Me,this.uint16[ze+26]=Be,this.uint16[ze+27]=He,this.uint16[ze+28]=Pe,this.uint32[rt+15]=Ve,this.float32[rt+16]=Ue,this.float32[rt+17]=$e,this.float32[rt+18]=Qe,e}}ii.prototype.bytesPerElement=76,ut(ii,"StructArrayLayout3i2f6i15ui1ul3f76");class ni extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ni.prototype.bytesPerElement=4,ut(ni,"StructArrayLayout1f4");class si extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,u,f)}emplace(e,i,l,u,f,m){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=u,this.float32[x+3]=f,this.float32[x+4]=m,e}}si.prototype.bytesPerElement=20,ut(si,"StructArrayLayout5f20");class pn extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,u)}emplace(e,i,l,u,f){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=l,this.uint16[m+3]=u,this.uint16[m+4]=f,e}}pn.prototype.bytesPerElement=12,ut(pn,"StructArrayLayout1ul3ui12");class nn extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=l,e}}nn.prototype.bytesPerElement=4,ut(nn,"StructArrayLayout2ui4");class Wn extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Wn.prototype.bytesPerElement=2,ut(Wn,"StructArrayLayout1ui2");class ms extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=l,e}}ms.prototype.bytesPerElement=8,ut(ms,"StructArrayLayout2f8");class wi extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wi.prototype.size=40;class ri extends wt{get(e){return new wi(this,e)}}ut(ri,"CollisionBoxArray");class Wt extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wt.prototype.size=60;class Vi extends Jt{get(e){return new Wt(this,e)}}ut(Vi,"PlacedSymbolArray");class xn extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}xn.prototype.size=76;class mi extends ii{get(e){return new xn(this,e)}}ut(mi,"SymbolInstanceArray");class En extends ni{getoffsetX(e){return this.float32[1*e+0]}}ut(En,"GlyphOffsetArray");class Tl extends Ze{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ut(Tl,"SymbolLineVertexArray");class Mr extends _e{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Mr.prototype.size=12;class _a extends pn{get(e){return new Mr(this,e)}}ut(_a,"FeatureIndexArray");class Os extends nn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ut(Os,"FillExtrusionCentroidArray");const Qs=xe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Sr=xe([{name:"a_dash",components:4,type:"Uint16"}]);var El={exports:{}},ma={exports:{}};ma.exports=function(t,e){var i,l,u,f,m,x,w,E;for(l=t.length-(i=3&t.length),u=e,m=3432918353,x=461845907,E=0;E<l;)w=255&t.charCodeAt(E)|(255&t.charCodeAt(++E))<<8|(255&t.charCodeAt(++E))<<16|(255&t.charCodeAt(++E))<<24,++E,u=27492+(65535&(f=5*(65535&(u=(u^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&t.charCodeAt(E+2))<<16;case 2:w^=(255&t.charCodeAt(E+1))<<8;case 1:u^=w=(65535&(w=(w=(65535&(w^=255&t.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0};var th=ma.exports,Mm={exports:{}};Mm.exports=function(t,e){for(var i,l=t.length,u=e^l,f=0;l>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),l-=4,++f;switch(l){case 3:u^=(255&t.charCodeAt(f+2))<<16;case 2:u^=(255&t.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};var Sm=th,wv=Mm.exports;El.exports=Sm,El.exports.murmur3=Sm,El.exports.murmur2=wv;var lf=Fe(El.exports);class id{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,l,u){this.ids.push(Am(e)),this.positions.push(i,l,u)}getPositions(e){const i=Am(e);let l=0,u=this.ids.length-1;for(;l<u;){const m=l+u>>1;this.ids[m]>=i?u=m:l=m+1}const f=[];for(;this.ids[l]===i;)f.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return f}static serialize(e,i){const l=new Float64Array(e.ids),u=new Uint32Array(e.positions);return cf(l,u,0,l.length-1),i&&i.push(l.buffer,u.buffer),{ids:l,positions:u}}static deserialize(e){const i=new id;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function Am(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:lf(String(t))}function cf(t,e,i,l){for(;i<l;){const u=t[i+l>>1];let f=i-1,m=l+1;for(;;){do f++;while(t[f]<u);do m--;while(t[m]>u);if(f>=m)break;nd(t,f,m),nd(e,3*f,3*m),nd(e,3*f+1,3*m+1),nd(e,3*f+2,3*m+2)}m-i<l-m?(cf(t,e,i,m),i=m+1):(cf(t,e,m+1,l),l=m)}}function nd(t,e,i){const l=t[e];t[e]=t[i],t[i]=l}ut(id,"FeaturePositionMap");class Ar{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class sd extends Ar{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Im extends Ar{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Cm extends Ar{constructor(e){super(e),this.current=Bi.transparent}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const Tv=new Float32Array(16),Ev=new Float32Array(9),Mv=new Float32Array(4);function hf(t){return[fe(255*t.r,255*t.g),fe(255*t.b,255*t.a)]}class ih{constructor(e,i,l){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=l}setUniform(e,i,l,u,f){i.set(e,f,u.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new Cm(e):new sd(e)}}class Ml{constructor(e,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,l,u,f){const m=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;m&&i.set(e,f,m)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new Im(e):new sd(e)}}class Ir{constructor(e,i,l,u){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,l,u,f,m){const x=this.paintVertexArray.length,w=this.expression.evaluate(new P(0),i,{},f,u,m);this.paintVertexArray.resize(e),this._setPaintValue(x,e,w)}updatePaintArray(e,i,l,u,f){const m=this.expression.evaluate({zoom:0},l,u,void 0,f);this._setPaintValue(e,i,m)}_setPaintValue(e,i,l){if(this.type==="color"){const u=hf(l);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Bs{constructor(e,i,l,u,f,m){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,i,l,u,f,m){const x=this.expression.evaluate(new P(this.zoom),i,{},f,u,m),w=this.expression.evaluate(new P(this.zoom+1),i,{},f,u,m),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,x,w)}updatePaintArray(e,i,l,u,f){const m=this.expression.evaluate({zoom:this.zoom},l,u,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},l,u,void 0,f);this._setPaintValue(e,i,m,x)}_setPaintValue(e,i,l,u){if(this.type==="color"){const f=hf(l),m=hf(u);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],m[0],m[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,l,u);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,u,f){const m=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=bt(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);i.set(e,f,x)}getBinding(e,i){return new sd(e)}}class po{constructor(e,i,l,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(l==="array"?Sr:Qs).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new u}populatePaintArray(e,i,l){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,u,f,m){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(e,i,l,u){if(!u||!l)return;const f=u[l];if(!f)return;const{tl:m,br:x,pixelRatio:w}=f;for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,m[0],m[1],x[0],x[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fo{constructor(e,i,l=()=>!0){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!l(f))continue;const m=e.paint.get(f);if(!(m instanceof K&&so(m.property.specification)))continue;const x=Av(f,e.type),w=m.value,E=m.property.specification.type,A=!!m.property.useIntegerZoom,k=f==="line-dasharray"||f.endsWith("pattern"),L=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||L)if(w.kind==="source"||L||k){const O=Pm(f,E,"source");this.binders[f]=k?new po(w,x,E,O,e.id):new Ir(w,x,E,O),u.push(`/a_${f}`)}else{const O=Pm(f,E,"composite");this.binders[f]=new Bs(w,x,E,A,i,O),u.push(`/z_${f}`)}else this.binders[f]=k?new Ml(w.value,x):new ih(w.value,x,E),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ir||i instanceof Bs?i.maxValue:0}populatePaintArrays(e,i,l,u,f,m){for(const x in this.binders){const w=this.binders[x];(w instanceof Ir||w instanceof Bs||w instanceof po)&&w.populatePaintArray(e,i,l,u,f,m)}}setConstantPatternPositions(e){for(const i in this.binders){const l=this.binders[i];l instanceof Ml&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,i,l,u,f,m){let x=!1;for(const w in e){const E=i.getPositions(w);for(const A of E){const k=l.feature(A.index);for(const L in this.binders){const O=this.binders[L];if((O instanceof Ir||O instanceof Bs||O instanceof po)&&O.expression.isStateDependent===!0){const B=u.paint.get(L);O.expression=B.value,O.updatePaintArray(A.start,A.end,k,e[w],f,m),x=!0}}}}return x}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof ih||l instanceof Ml)&&e.push(...l.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof Ir||l instanceof Bs||l instanceof po)for(let u=0;u<l.paintVertexAttributes.length;u++)e.push(l.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof ih||l instanceof Ml||l instanceof Bs)for(const u of l.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const u=this.binders[l];if(u instanceof ih||u instanceof Ml||u instanceof Bs)for(const f of u.uniformNames)i.push({name:f,property:l,binding:u.getBinding(e,f)})}return i}setUniforms(e,i,l,u,f){for(const{name:m,property:x,binding:w}of l)this.binders[x].setUniform(e,w,f,u.get(x),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Ir||i instanceof Bs||i instanceof po)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof Ir||l instanceof Bs||l instanceof po)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ir||i instanceof Bs||i instanceof po)&&i.destroy()}}}class ga{constructor(e,i,l=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new fo(u,i,l);this.needsUpload=!1,this._featureMap=new id,this._bufferOffset=0}populatePaintArrays(e,i,l,u,f,m,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,u,f,m,x);i.id!==void 0&&this._featureMap.add(i.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,u,f){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,i,m,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Sv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Av(t,e){return Sv[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Iv={"line-pattern":{source:Se,composite:Se},"fill-pattern":{source:Se,composite:Se},"fill-extrusion-pattern":{source:Se,composite:Se},"line-dasharray":{source:Ne,composite:Ne}},Cv={color:{source:ms,composite:We},number:{source:ni,composite:ms}};function Pm(t,e,i){const l=Iv[t];return l&&l[i]||Cv[e][i]}ut(ih,"ConstantBinder"),ut(Ml,"PatternConstantBinder"),ut(Ir,"SourceExpressionBinder"),ut(po,"PatternCompositeBinder"),ut(Bs,"CompositeExpressionBinder"),ut(fo,"ProgramConfiguration",{omit:["_buffers"]}),ut(ga,"ProgramConfigurationSet");const km="-transition";class Fs extends $o{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new J(i.layout)),i.paint)){this._transitionablePaint=new N(i.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Q(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,l={}){i!=null&&this._validate(nf,`layers.${this.id}.layout.${e}`,e,i,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return Vr(e,km)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,l={}){if(i!=null&&this._validate(tf,`layers.${this.id}.paint.${e}`,e,i,l))return!1;if(Vr(e,km))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.value.isDataDriven(),m=u.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value,w=x.isDataDriven(),E=Vr(e,"pattern")||e==="line-dasharray";return w||f||E||this._handleOverridablePaintPropertyUpdate(e,m,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Ur(e,(i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length))}_validate(e,i,l,u,f={}){return(!f||f.validate!==!1)&&Ju(this,e.call(Ku,{key:i,layerType:this.type,objectKey:l,value:u,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof K&&so(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=xl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Pv=xe([{name:"a_pos",components:2,type:"Int16"}],4),kv=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ui{constructor(e=[]){this.segments=e}prepareSegment(e,i,l,u){let f=this.segments[this.segments.length-1];return e>Ui.MAX_VERTEX_ARRAY_LENGTH&&Ei(`Max vertices per segment is ${Ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Ui.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,u){return new Ui([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:u,vaos:{},sortKey:0}])}}Ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ut(Ui,"SegmentVector");var yt=8192;class _o{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof oi?new oi(e.lng,e.lat):oi.convert(e),this}setSouthWest(e){return this._sw=e instanceof oi?new oi(e.lng,e.lat):oi.convert(e),this}extend(e){const i=this._sw,l=this._ne;let u,f;if(e instanceof oi)u=e,f=e;else{if(!(e instanceof _o))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(_o.convert(e)):this.extend(oi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(oi.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||l?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new oi(u.lng,u.lat),this._ne=new oi(f.lng,f.lat)),this}getCenter(){return new oi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new oi(this.getWest(),this.getNorth())}getSouthEast(){return new oi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=oi.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&u}static convert(e){return!e||e instanceof _o?e:new _o(e)}}var rd=1e-6,Zn=typeof Float32Array<"u"?Float32Array:Array;function Lm(){var t=new Zn(9);return Zn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Dm(t,e,i){var l=e[0],u=e[1],f=e[2],m=e[3],x=e[4],w=e[5],E=e[6],A=e[7],k=e[8],L=i[0],O=i[1],B=i[2],V=i[3],Z=i[4],ee=i[5],le=i[6],te=i[7],oe=i[8];return t[0]=L*l+O*m+B*E,t[1]=L*u+O*x+B*A,t[2]=L*f+O*w+B*k,t[3]=V*l+Z*m+ee*E,t[4]=V*u+Z*x+ee*A,t[5]=V*f+Z*w+ee*k,t[6]=le*l+te*m+oe*E,t[7]=le*u+te*x+oe*A,t[8]=le*f+te*w+oe*k,t}function Ns(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function uf(t,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=e[4],x=e[5],w=e[6],E=e[7],A=e[8],k=e[9],L=e[10],O=e[11],B=e[12],V=e[13],Z=e[14],ee=e[15],le=i*x-l*m,te=i*w-u*m,oe=i*E-f*m,de=l*w-u*x,ue=l*E-f*x,Ie=u*E-f*w,Me=A*V-k*B,Be=A*Z-L*B,He=A*ee-O*B,Pe=k*Z-L*V,Ve=k*ee-O*V,Ue=L*ee-O*Z,$e=le*Ue-te*Ve+oe*Pe+de*He-ue*Be+Ie*Me;return $e?(t[0]=(x*Ue-w*Ve+E*Pe)*($e=1/$e),t[1]=(u*Ve-l*Ue-f*Pe)*$e,t[2]=(V*Ie-Z*ue+ee*de)*$e,t[3]=(L*ue-k*Ie-O*de)*$e,t[4]=(w*He-m*Ue-E*Be)*$e,t[5]=(i*Ue-u*He+f*Be)*$e,t[6]=(Z*oe-B*Ie-ee*te)*$e,t[7]=(A*Ie-L*oe+O*te)*$e,t[8]=(m*Ve-x*He+E*Me)*$e,t[9]=(l*He-i*Ve-f*Me)*$e,t[10]=(B*ue-V*oe+ee*le)*$e,t[11]=(k*oe-A*ue-O*le)*$e,t[12]=(x*Be-m*Pe-w*Me)*$e,t[13]=(i*Pe-l*Be+u*Me)*$e,t[14]=(V*te-B*de-Z*le)*$e,t[15]=(A*de-k*te+L*le)*$e,t):null}function ya(t,e,i){var l=e[0],u=e[1],f=e[2],m=e[3],x=e[4],w=e[5],E=e[6],A=e[7],k=e[8],L=e[9],O=e[10],B=e[11],V=e[12],Z=e[13],ee=e[14],le=e[15],te=i[0],oe=i[1],de=i[2],ue=i[3];return t[0]=te*l+oe*x+de*k+ue*V,t[1]=te*u+oe*w+de*L+ue*Z,t[2]=te*f+oe*E+de*O+ue*ee,t[3]=te*m+oe*A+de*B+ue*le,t[4]=(te=i[4])*l+(oe=i[5])*x+(de=i[6])*k+(ue=i[7])*V,t[5]=te*u+oe*w+de*L+ue*Z,t[6]=te*f+oe*E+de*O+ue*ee,t[7]=te*m+oe*A+de*B+ue*le,t[8]=(te=i[8])*l+(oe=i[9])*x+(de=i[10])*k+(ue=i[11])*V,t[9]=te*u+oe*w+de*L+ue*Z,t[10]=te*f+oe*E+de*O+ue*ee,t[11]=te*m+oe*A+de*B+ue*le,t[12]=(te=i[12])*l+(oe=i[13])*x+(de=i[14])*k+(ue=i[15])*V,t[13]=te*u+oe*w+de*L+ue*Z,t[14]=te*f+oe*E+de*O+ue*ee,t[15]=te*m+oe*A+de*B+ue*le,t}function nh(t,e,i){var l,u,f,m,x,w,E,A,k,L,O,B,V=i[0],Z=i[1],ee=i[2];return e===t?(t[12]=e[0]*V+e[4]*Z+e[8]*ee+e[12],t[13]=e[1]*V+e[5]*Z+e[9]*ee+e[13],t[14]=e[2]*V+e[6]*Z+e[10]*ee+e[14],t[15]=e[3]*V+e[7]*Z+e[11]*ee+e[15]):(u=e[1],f=e[2],m=e[3],x=e[4],w=e[5],E=e[6],A=e[7],k=e[8],L=e[9],O=e[10],B=e[11],t[0]=l=e[0],t[1]=u,t[2]=f,t[3]=m,t[4]=x,t[5]=w,t[6]=E,t[7]=A,t[8]=k,t[9]=L,t[10]=O,t[11]=B,t[12]=l*V+x*Z+k*ee+e[12],t[13]=u*V+w*Z+L*ee+e[13],t[14]=f*V+E*Z+O*ee+e[14],t[15]=m*V+A*Z+B*ee+e[15]),t}function xa(t,e,i){var l=i[0],u=i[1],f=i[2];return t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t[3]=e[3]*l,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function df(t,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[4],m=e[5],x=e[6],w=e[7],E=e[8],A=e[9],k=e[10],L=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*u+E*l,t[5]=m*u+A*l,t[6]=x*u+k*l,t[7]=w*u+L*l,t[8]=E*u-f*l,t[9]=A*u-m*l,t[10]=k*u-x*l,t[11]=L*u-w*l,t}function od(t,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[0],m=e[1],x=e[2],w=e[3],E=e[8],A=e[9],k=e[10],L=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u-E*l,t[1]=m*u-A*l,t[2]=x*u-k*l,t[3]=w*u-L*l,t[8]=f*l+E*u,t[9]=m*l+A*u,t[10]=x*l+k*u,t[11]=w*l+L*u,t}function zm(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rm(t,e,i){var l,u,f,m=i[0],x=i[1],w=i[2],E=Math.hypot(m,x,w);return E<rd?null:(m*=E=1/E,x*=E,w*=E,l=Math.sin(e),u=Math.cos(e),t[0]=m*m*(f=1-u)+u,t[1]=x*m*f+w*l,t[2]=w*m*f-x*l,t[3]=0,t[4]=m*x*f-w*l,t[5]=x*x*f+u,t[6]=w*x*f+m*l,t[7]=0,t[8]=m*w*f+x*l,t[9]=x*w*f-m*l,t[10]=w*w*f+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Lv=ya;function pf(){var t=new Zn(3);return Zn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Om(t){var e=new Zn(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function sh(t){return Math.hypot(t[0],t[1],t[2])}function Sl(t,e,i){var l=new Zn(3);return l[0]=t,l[1]=e,l[2]=i,l}function Cr(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function ff(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Bm(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function rh(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function oh(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function ns(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function ah(t,e,i,l){return t[0]=e[0]+i[0]*l,t[1]=e[1]+i[1]*l,t[2]=e[2]+i[2]*l,t}function Mn(t,e){var i=e[0],l=e[1],u=e[2],f=i*i+l*l+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function gs(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function _f(t,e,i){var l=e[0],u=e[1],f=e[2],m=i[0],x=i[1],w=i[2];return t[0]=u*w-f*x,t[1]=f*m-l*w,t[2]=l*x-u*m,t}function Fi(t,e,i){var l=e[0],u=e[1],f=e[2],m=i[3]*l+i[7]*u+i[11]*f+i[15];return t[0]=(i[0]*l+i[4]*u+i[8]*f+i[12])/(m=m||1),t[1]=(i[1]*l+i[5]*u+i[9]*f+i[13])/m,t[2]=(i[2]*l+i[6]*u+i[10]*f+i[14])/m,t}function Fm(t,e,i){var l=i[0],u=i[1],f=i[2],m=e[0],x=e[1],w=e[2],E=u*w-f*x,A=f*m-l*w,k=l*x-u*m,L=u*k-f*A,O=f*E-l*k,B=l*A-u*E,V=2*i[3];return A*=V,k*=V,O*=2,B*=2,t[0]=m+(E*=V)+(L*=2),t[1]=x+A+O,t[2]=w+k+B,t}var lh,js=ff,Dv=Bm,zv=sh;function Nm(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function jm(t,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=i*i+l*l+u*u+f*f;return m>0&&(m=1/Math.sqrt(m)),t[0]=i*m,t[1]=l*m,t[2]=u*m,t[3]=f*m,t}function va(t,e,i){var l=e[0],u=e[1],f=e[2],m=e[3];return t[0]=i[0]*l+i[4]*u+i[8]*f+i[12]*m,t[1]=i[1]*l+i[5]*u+i[9]*f+i[13]*m,t[2]=i[2]*l+i[6]*u+i[10]*f+i[14]*m,t[3]=i[3]*l+i[7]*u+i[11]*f+i[15]*m,t}function Vm(){var t=new Zn(4);return Zn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Um(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Gm(t,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],m=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=l*w+m*x,t[1]=u*w+f*x,t[2]=f*w-u*x,t[3]=m*w-l*x,t}function $m(t,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],m=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=l*w-f*x,t[1]=u*w+m*x,t[2]=f*w+l*x,t[3]=m*w-u*x,t}pf(),lh=new Zn(4),Zn!=Float32Array&&(lh[0]=0,lh[1]=0,lh[2]=0,lh[3]=0);var Rv=jm;pf(),Sl(1,0,0),Sl(0,1,0),Vm(),Vm(),Lm();const Ov=xe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:qm}=Ov,Wm=xe([{name:"a_pos_3",components:3,type:"Int16"}]);var ch=xe([{name:"a_pos",type:"Int16",components:2}]);class mf{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const u=gs(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,l){if(function(O,B){var V=O[0],Z=O[1],ee=O[2],le=B[0],te=B[1],oe=B[2];return Math.abs(V-le)<=rd*Math.max(1,Math.abs(V),Math.abs(le))&&Math.abs(Z-te)<=rd*Math.max(1,Math.abs(Z),Math.abs(te))&&Math.abs(ee-oe)<=rd*Math.max(1,Math.abs(ee),Math.abs(oe))}(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[u,f,m]=this.dir,x=this.pos[0]-e[0],w=this.pos[1]-e[1],E=this.pos[2]-e[2],A=u*u+f*f+m*m,k=2*(x*u+w*f+E*m),L=k*k-4*A*(x*x+w*w+E*E-i*i);if(L<0){const O=Math.max(-k/2,0),B=x+u*O,V=w+f*O,Z=E+m*O,ee=Math.hypot(B,V,Z);return l[0]=B*i/ee,l[1]=V*i/ee,l[2]=Z*i/ee,!1}{const O=(-k-Math.sqrt(L))/(2*A);if(O<0){const B=Math.hypot(x,w,E);return l[0]=x*i/B,l[1]=w*i/B,l[2]=E*i/B,!1}return l[0]=x+u*O,l[1]=w+f*O,l[2]=E+m*O,!0}}}class gf{constructor(e,i,l,u,f){this.TL=e,this.TR=i,this.BR=l,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,i,l){const u=[-1,1,1],f=[1,1,1],m=[1,-1,1],x=[-1,-1,1],w=Fi(u,u,e),E=Fi(f,f,e),A=Fi(m,m,e),k=Fi(x,x,e);return new gf(w,E,A,k,i/l)}}class yf{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,l,u){const f=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=va([],w,e),A=1/E[3]/i*f;return function(k,L,O){return k[0]=L[0]*O[0],k[1]=L[1]*O[1],k[2]=L[2]*O[2],k[3]=L[3]*O[3],k}(E,E,[A,A,u?1/E[3]:A,A])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Mn([],_f([],js([],m[w[0]],m[w[1]]),js([],m[w[2]],m[w[1]]))),A=-gs(E,m[w[1]]);return E.concat(A)});return new yf(m,x)}}class Sn{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const u of e)rh(i,i,u),oh(l,l,u);return new Sn(i,l)}static applyTransform(e,i){const l=e.getCorners();for(let u=0;u<l.length;++u)Fi(l[u],l[u],i);return Sn.fromPoints(l)}constructor(e,i){this.min=e,this.max=i,this.center=ns([],Cr([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=Om(this.min),u=Om(this.max);for(let f=0;f<i.length;f++)l[f]=i[f]?this.min[f]:this.center[f],u[f]=i[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Sn(l,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let l=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let m=0;for(let x=0;x<i.length;x++)m+=gs(f,i[x])+f[3]>=0;if(m===0)return 0;m!==i.length&&(l=!1)}if(l)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const w=e.points[x][u]-this.min[u];f=Math.min(f,w),m=Math.max(m,w)}if(m<0||f>this.max[u]-this.min[u])return 0}return 1}}const xf=5,Zm=6,er=yt/Math.PI/2,Bv=16383,ba=64,hh=[ba,32,16],ys=-er,xs=er,Fv=[new Sn([ys,ys,ys],[xs,xs,xs]),new Sn([ys,ys,ys],[0,0,xs]),new Sn([0,ys,ys],[xs,0,xs]),new Sn([ys,0,ys],[0,xs,xs]),new Sn([0,0,ys],[xs,xs,xs])];function ad(t){return t*er/ph}function Hm(t,e,i,l=!0){const u=ns([],t._camera.position,t.worldSize),f=[e,i,1,1];va(f,f,t.pixelMatrixInverse),Nm(f,f,1/f[3]);const m=Mn([],js([],f,u)),x=t.globeMatrix,w=[x[12],x[13],x[14]],E=js([],w,u),A=sh(E),k=Mn([],E),L=t.worldSize/(2*Math.PI),O=gs(k,m),B=Math.asin(L/A);if(B<Math.acos(O)){if(!l)return null;const He=[],Pe=[];ns(He,m,A/O),Mn(Pe,js(Pe,He,E)),Mn(m,Cr(m,E,ns(m,Pe,Math.tan(B)*A)))}const V=[];new mf(u,m).closestPointOnSphere(w,L,V);const Z=Mn([],Hs(x,0)),ee=Mn([],Hs(x,1)),le=Mn([],Hs(x,2)),te=gs(Z,V),oe=gs(ee,V),de=gs(le,V),ue=Gt(Math.asin(-oe/L));let Ie=Gt(Math.atan2(te,de));Ie=t.center.lng+function(He,Pe){const Ve=(Pe-He+180)%360-180;return Ve<-180?Ve+360:Ve}(t.center.lng,Ie);const Me=ir(Ie),Be=bt(nr(ue),0,1);return new Pl(Me,Be)}class Nv{constructor(e,i,l){this.a=js([],e,l),this.b=js([],i,l),this.center=l;const u=Mn([],this.a),f=Mn([],this.b);this.angle=Math.acos(gs(u,f))}}function vf(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(l,u,f,m){const x=Math.sin(f);return l*(Math.sin((1-m)*f)/x)+u*(Math.sin(m*f)/x)}(t.a[e],t.b[e],t.angle,bt(i,0,1))+t.center[e]}function tr(t){if(t.z<=1)return Fv[t.z+2*t.y+t.x];const e=bf(ld(t));return Sn.fromPoints(e)}function wa(t,e,i){return ns(t,t,1-i),ah(t,t,e,i)}function Xm(t,e){const i=Cl(e.zoom);if(i===0)return tr(t);const l=ld(t),u=bf(l),f=ir(l.getWest())*e.worldSize,m=ir(l.getEast())*e.worldSize,x=nr(l.getNorth())*e.worldSize,w=nr(l.getSouth())*e.worldSize,E=[f,x,0],A=[m,x,0],k=[f,w,0],L=[m,w,0],O=uf([],e.globeMatrix);return Fi(E,E,O),Fi(A,A,O),Fi(k,k,O),Fi(L,L,O),u[0]=wa(u[0],k,i),u[1]=wa(u[1],L,i),u[2]=wa(u[2],A,i),u[3]=wa(u[3],E,i),Sn.fromPoints(u)}function Ym(t,e,i){for(const l of t)Fi(l,l,e),ns(l,l,i)}function jv(t,e,i){const l=e/t.worldSize,u=t.globeMatrix;if(i.z<=1){const Me=tr(i).getCorners();return Ym(Me,u,l),Sn.fromPoints(Me)}const f=ld(i),m=bf(f);Ym(m,u,l);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(f.contains(t.center)){for(const He of m)rh(E,E,He),oh(w,w,He);w[2]=0;const Me=t.point,Be=[Me.x*l,Me.y*l,0];return rh(E,E,Be),oh(w,w,Be),new Sn(E,w)}const A=[u[12]*l,u[13]*l,u[14]*l],k=f.getCenter(),L=bt(t.center.lat,-_n,_n),O=bt(k.lat,-_n,_n),B=ir(t.center.lng),V=nr(L);let Z=B-ir(k.lng);const ee=V-nr(O);Z>.5?Z-=1:Z<-.5&&(Z+=1);let le=0;Math.abs(Z)>Math.abs(ee)?le=Z>=0?1:3:(le=ee>=0?0:2,ah(A,A,[u[4]*l,u[5]*l,u[6]*l],-Math.sin(ft(ee>=0?f.getSouth():f.getNorth()))*er));const te=m[le],oe=m[(le+1)%4],de=new Nv(te,oe,A),ue=[vf(de,0)||te[0],vf(de,1)||te[1],vf(de,2)||te[2]],Ie=Cl(t.zoom);if(Ie>0){const Me=function({x:He,y:Pe,z:Ve},Ue,$e,Qe,ze){const rt=1/(1<<Ve);let pt=He*rt,ot=pt+rt,Tt=Pe*rt,et=Tt+rt,gt=0;const Et=(pt+ot)/2-Qe;return Et>.5?gt=-1:Et<-.5&&(gt=1),pt=((pt+gt)*Ue-(Qe*=Ue))*$e+Qe,ot=((ot+gt)*Ue-Qe)*$e+Qe,Tt=(Tt*Ue-(ze*=Ue))*$e+ze,et=(et*Ue-ze)*$e+ze,[[pt,et,0],[ot,et,0],[ot,Tt,0],[pt,Tt,0]]}(i,e,t._pixelsPerMercatorPixel,B,V);for(let He=0;He<m.length;He++)wa(m[He],Me[He],Ie);const Be=Cr([],Me[le],Me[(le+1)%4]);ns(Be,Be,.5),wa(ue,Be,Ie)}for(const Me of m)rh(E,E,Me),oh(w,w,Me);return E[2]=Math.min(te[2],oe[2]),rh(E,E,ue),oh(w,w,ue),new Sn(E,w)}function ld({x:t,y:e,z:i}){const l=1/(1<<i),u=new oi(ss(t*l),fn((e+1)*l)),f=new oi(ss((t+1)*l),fn(e*l));return new _o(u,f)}function bf(t){const e=ft(t.getNorth()),i=ft(t.getSouth()),l=Math.cos(e),u=Math.cos(i),f=Math.sin(e),m=Math.sin(i),x=t.getWest(),w=t.getEast();return[Al(u,m,x),Al(u,m,w),Al(l,f,w),Al(l,f,x)]}function Al(t,e,i,l=er){return i=ft(i),[t*Math.sin(i)*l,-e*l,t*Math.cos(i)*l]}function Il(t,e,i){return Al(Math.cos(ft(t)),Math.sin(ft(t)),e,i)}function uh(t,e,i,l){const u=1<<i.z,f=(t/yt+i.x)/u;return Il(fn((e/yt+i.y)/u),ss(f),l)}function cd({min:t,max:e}){return Bv/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Km=new Float64Array(16);function dh(t){const e=cd(t),i=zm(Km,[e,e,e]);return nh(i,i,((l=[])[0]=-(u=t.min)[0],l[1]=-u[1],l[2]=-u[2],l));var l,u}function wf(t){const e=(l=t.min,(i=Km)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const u=1/cd(t);return xa(e,e,[u,u,u])}function Jm(t,e,i,l,u){const f=function(w){const E=yt/(2*Math.PI);return w/(2*Math.PI)/E}(i),m=[t,e,-i/(2*Math.PI)],x=Ns(new Float64Array(16));return nh(x,x,m),xa(x,x,[f,f,f]),df(x,x,ft(-u)),od(x,x,ft(-l)),x}function Cl(t){return Pi(xf,Zm,t)}function Qm(t,e){const i=Il(e.lat,e.lng),l=function(B){const V=Il(B._center.lat,B._center.lng);let Z=_f([],Sl(0,1,0),V);const ee=Rm([],-B.angle,V);Z=Fi(Z,Z,ee),Rm(ee,-B._pitch,Z);const le=Mn([],V);return ns(le,le,ad(B.cameraToCenterDistance/B.pixelsPerMeter)),Fi(le,le,ee),Cr([],V,le)}(t);return m=(u=ff([],l,i))[0],x=u[1],w=u[2],E=(f=i)[0],A=f[1],k=f[2],O=(L=Math.sqrt(m*m+x*x+w*w)*Math.sqrt(E*E+A*A+k*k))&&gs(u,f)/L,Math.acos(Math.min(Math.max(O,-1),1));var u,f,m,x,w,E,A,k,L,O}function Tf(t,e){return Qm(t,e)>Math.PI/2*1.01}const eg=ft(85),Vv=Math.cos(eg),Uv=Math.sin(eg),ph=63710088e-1,tg=2*Math.PI*ph;class mo{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mo(vi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,u=e.lat*i,f=Math.sin(l)*Math.sin(u)+Math.cos(l)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return ph*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new _o(new mo(this.lng-l,this.lat-i),new mo(this.lng+l,this.lat+i))}toEcef(e){const i=ad(e);return Il(this.lat,this.lng,er+i)}static convert(e){if(e instanceof mo)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mo(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mo(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var oi=mo;function Ef(t){return tg*Math.cos(t*Math.PI/180)}function ir(t){return(180+t)/360}function nr(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Vs(t,e){return t/Ef(e)}function ss(t){return 360*t-180}function fn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function ig(t,e){return t*Ef(fn(e))}const _n=85.051129;function ng(t){return 1/Math.cos(t*Math.PI/180)}class Pl{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=oi.convert(e);return new Pl(ir(l.lng),nr(l.lat),Vs(i,l.lat))}toLngLat(){return new oi(ss(this.x),fn(this.y))}toAltitude(){return ig(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/tg*ng(fn(this.y))}}function Mf(t,e,i,l,u,f,m,x,w){const E=(e+l)/2,A=(i+u)/2,k=new De(E,A);x(k),function(L,O,B,V,Z,ee){const le=B-Z,te=V-ee;return Math.abs((V-O)*le-(B-L)*te)/Math.hypot(le,te)}(k.x,k.y,f.x,f.y,m.x,m.y)>=w?(Mf(t,e,i,E,A,f,k,x,w),Mf(t,E,A,l,u,k,m,x,w)):t.push(m)}function sg(t,e,i){let l=t[0],u=l.x,f=l.y;e(l);const m=[l];for(let x=1;x<t.length;x++){const w=t[x],{x:E,y:A}=w;e(w),Mf(m,u,f,E,A,l,w,e,i),u=E,f=A,l=w}return m}function Sf(t,e,i,l){if(l(e,i)){const u=e.add(i)._mult(.5);Sf(t,e,u,l),Sf(t,u,i,l)}else t.push(i)}function Gv(t,e){let i=t[0];const l=[i];for(let u=1;u<t.length;u++){const f=t[u];Sf(l,i,f,e),i=f}return l}const Af=Math.pow(2,14)-1,rg=-Af-1;function $v(t,e){const i=Math.round(t.x*e),l=Math.round(t.y*e);return t.x=bt(i,rg,Af),t.y=bt(l,rg,Af),(i<t.x||i>t.x+1||l<t.y||l>t.y+1)&&Ei("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Pr(t,e,i){const l=t.loadGeometry(),u=t.extent,f=yt/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:x,x:w,y:E,projection:A}=i,k=L=>{const O=ss((e.x+L.x/u)/m),B=fn((e.y+L.y/u)/m),V=A.project(O,B);L.x=(V.x*x-w)*u,L.y=(V.y*x-E)*u};for(let L=0;L<l.length;L++)if(t.type!==1)l[L]=sg(l[L],k,1);else{const O=[];for(const B of l[L])B.x<0||B.x>=u||B.y<0||B.y>=u||(k(B),O.push(B));l[L]=O}}for(const m of l)for(const x of m)$v(x,f);return l}function Ta(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Pr(t):[]}}function hd(t,e,i,l,u){t.emplaceBack(2*e+(l+1)/2,2*i+(u+1)/2)}function ud(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class If{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ze,this.indexArray=new _t,this.segments=new Ui,this.programConfigurations=new ga(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,u){const f=this.layers[0],m=[];let x=null;f.type==="circle"&&(x=f.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:k,sourceLayerIndex:L}of e){const O=this.layers[0]._featureFilter.needGeometry,B=Ta(E,O);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),B,l))continue;const V=x?x.evaluate(B,{},l):void 0,Z={id:A,properties:E.properties,type:E.type,sourceLayerIndex:L,index:k,geometry:O?B.geometry:Pr(E,l,u),patterns:{},sortKey:V};m.push(Z)}x&&m.sort((E,A)=>E.sortKey-A.sortKey);let w=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new Xe,w=u.projection);for(const E of m){const{geometry:A,index:k,sourceLayerIndex:L}=E,O=e[k].feature;this.addFeature(E,A,k,i.availableImages,l,w),i.featureIndex.insert(O,A,k,L,this.index)}}update(e,i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,kv.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,l,u,f,m){for(const x of i)for(const w of x){const E=w.x,A=w.y;if(E<0||E>=yt||A<0||A>=yt)continue;if(m){const O=m.projectTilePoint(E,A,f),B=m.upVector(f,E,A),V=this.globeExtVertexArray;ud(V,O,B),ud(V,O,B),ud(V,O,B),ud(V,O,B)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),L=k.vertexLength;hd(this.layoutVertexArray,E,A,-1,-1),hd(this.layoutVertexArray,E,A,1,-1),hd(this.layoutVertexArray,E,A,1,1),hd(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(L,L+1,L+2),this.indexArray.emplaceBack(L,L+2,L+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},u,f)}}function og(t,e){for(let i=0;i<t.length;i++)if(Ea(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Ea(t,e[i]))return!0;return!!Cf(t,e)}function qv(t,e,i){return!!Ea(t,e)||!!Pf(e,t,i)}function ag(t,e){if(t.length===1)return cg(e,t[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let u=0;u<l.length;u++)if(Ea(t,l[u]))return!0}for(let i=0;i<t.length;i++)if(cg(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(Cf(t,e[i]))return!0;return!1}function Wv(t,e,i){if(t.length>1){if(Cf(t,e))return!0;for(let l=0;l<e.length;l++)if(Pf(e[l],t,i))return!0}for(let l=0;l<t.length;l++)if(Pf(t[l],e,i))return!0;return!1}function Cf(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const l=t[i],u=t[i+1];for(let f=0;f<e.length-1;f++)if(Zv(l,u,e[f],e[f+1]))return!0}return!1}function Zv(t,e,i,l){return jn(t,i,l)!==jn(e,i,l)&&jn(t,e,i)!==jn(t,e,l)}function Pf(t,e,i){const l=i*i;if(e.length===1)return t.distSqr(e[0])<l;for(let u=1;u<e.length;u++)if(lg(t,e[u-1],e[u])<l)return!0;return!1}function lg(t,e,i){const l=e.distSqr(i);if(l===0)return t.distSqr(e);const u=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/l;return t.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function cg(t,e){let i,l,u,f=!1;for(let m=0;m<t.length;m++){i=t[m];for(let x=0,w=i.length-1;x<i.length;w=x++)l=i[x],u=i[w],l.y>e.y!=u.y>e.y&&e.x<(u.x-l.x)*(e.y-l.y)/(u.y-l.y)+l.x&&(f=!f)}return f}function Ea(t,e){let i=!1;for(let l=0,u=t.length-1;l<t.length;u=l++){const f=t[l],m=t[u];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function hg(t,e,i,l,u){for(const m of t)if(e<=m.x&&i<=m.y&&l>=m.x&&u>=m.y)return!0;const f=[new De(e,i),new De(e,u),new De(l,u),new De(l,i)];if(t.length>2){for(const m of f)if(Ea(t,m))return!0}for(let m=0;m<t.length-1;m++)if(Hv(t[m],t[m+1],f))return!0;return!1}function Hv(t,e,i){const l=i[0],u=i[2];if(t.x<l.x&&e.x<l.x||t.x>u.x&&e.x>u.x||t.y<l.y&&e.y<l.y||t.y>u.y&&e.y>u.y)return!1;const f=jn(t,e,i[0]);return f!==jn(t,e,i[1])||f!==jn(t,e,i[2])||f!==jn(t,e,i[3])}function kl(t,e,i){const l=e.paint.get(t).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(t)}function dd(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ug(t,e,i,l,u){if(!e[0]&&!e[1])return t;const f=De.convert(e)._mult(u);i==="viewport"&&f._rotate(-l);const m=[];for(let x=0;x<t.length;x++)m.push(t[x].sub(f));return m}function dg(t,e,i,l){const u=De.convert(t)._mult(l);return e==="viewport"&&u._rotate(-i),u}ut(If,"CircleBucket",{omit:["layers"]});const Xv=new se({"circle-sort-key":new H(Oe.layout_circle["circle-sort-key"])});var Yv={paint:new se({"circle-radius":new H(Oe.paint_circle["circle-radius"]),"circle-color":new H(Oe.paint_circle["circle-color"]),"circle-blur":new H(Oe.paint_circle["circle-blur"]),"circle-opacity":new H(Oe.paint_circle["circle-opacity"]),"circle-translate":new j(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new j(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new j(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new j(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new H(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new H(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new H(Oe.paint_circle["circle-stroke-opacity"])}),layout:Xv};function pg(t,e,i,l,u,f,m,x,w){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(w*=t.pixelToTileUnitsFactor);const E=t.tileID.canonical,A=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const k of e)for(const L of k){const O=L.add(x),B=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(O.x,O.y,!0):0,V=i.projection.projectTilePoint(O.x,O.y,E);if(B>0){const te=i.projection.upVector(E,O.x,O.y);V.x+=te[0]*A*B,V.y+=te[1]*A*B,V.z+=te[2]*A*B}const Z=f?O:Kv(V.x,V.y,V.z,l),ee=f?t.tilespaceRays.map(te=>Qv(te,B)):t.queryGeometry.screenGeometry,le=va([],[V.x,V.y,V.z,1],l);if(!m&&f?w*=le[3]/i.cameraToCenterDistance:m&&!f&&(w*=i.cameraToCenterDistance/le[3]),f){const te=fn((L.y/yt+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(te,1)/Vs(1,te)}if(qv(ee,Z,w))return!0}return!1}function Kv(t,e,i,l){const u=va([],[t,e,i,1],l);return new De(u[0]/u[3],u[1]/u[3])}const fg=Sl(0,0,0),Jv=Sl(0,0,1);function Qv(t,e){const i=pf();return fg[2]=e,t.intersectsPlane(fg,Jv,i),new De(i[0],i[1])}class _g extends If{}function mg(t,{width:e,height:i},l,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*l)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*l);return t.width=e,t.height=i,t.data=u,t}function gg(t,e,i){const{width:l,height:u}=e;l===t.width&&u===t.height||(kf(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,l),height:Math.min(t.height,u)},i),t.width=l,t.height=u,t.data=e.data)}function kf(t,e,i,l,u,f){if(u.width===0||u.height===0)return e;if(u.width>t.width||u.height>t.height||i.x>t.width-u.width||i.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||l.x>e.width-u.width||l.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,x=e.data;for(let w=0;w<u.height;w++){const E=((i.y+w)*t.width+i.x)*f,A=((l.y+w)*e.width+l.x)*f;for(let k=0;k<u.width*f;k++)x[A+k]=m[E+k]}return e}ut(_g,"HeatmapBucket",{omit:["layers"]});class kr{constructor(e,i){mg(this,e,1,i)}resize(e){gg(this,new kr(e),1)}clone(){return new kr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,u,f){kf(e,i,l,u,f,1)}}class Hn{constructor(e,i){mg(this,e,4,i)}resize(e){gg(this,new Hn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Hn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,u,f){kf(e,i,l,u,f,4)}}ut(kr,"AlphaImage"),ut(Hn,"RGBAImage");var eb={paint:new se({"heatmap-radius":new H(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new H(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new j(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ne(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new j(Oe.paint_heatmap["heatmap-opacity"])})};function Lf(t){const e={},i=t.resolution||256,l=t.clips?t.clips.length:1,u=t.image||new Hn({width:i,height:l}),f=(m,x,w)=>{e[t.evaluationKey]=w;const E=t.expression.evaluate(e);u.data[m+x+0]=Math.floor(255*E.r/E.a),u.data[m+x+1]=Math.floor(255*E.g/E.a),u.data[m+x+2]=Math.floor(255*E.b/E.a),u.data[m+x+3]=Math.floor(255*E.a)};if(t.clips)for(let m=0,x=0;m<l;++m,x+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const A=w/(i-1),{start:k,end:L}=t.clips[m];f(x,E,k*(1-A)+L*A)}else for(let m=0,x=0;m<i;m++,x+=4)f(0,x,m/(i-1));return u}var tb={paint:new se({"hillshade-illumination-direction":new j(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new j(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new j(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new j(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new j(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new j(Oe.paint_hillshade["hillshade-accent-color"])})};const ib=xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:nb}=ib;var Df={exports:{}};function pd(t,e,i){i=i||2;var l,u,f,m,x,w,E,A=e&&e.length,k=A?e[0]*i:t.length,L=yg(t,0,k,i,!0),O=[];if(!L||L.next===L.prev)return O;if(A&&(L=function(V,Z,ee,le){var te,oe,de,ue=[];for(te=0,oe=Z.length;te<oe;te++)(de=yg(V,Z[te]*le,te<oe-1?Z[te+1]*le:V.length,le,!1))===de.next&&(de.steiner=!0),ue.push(ub(de));for(ue.sort(lb),te=0;te<ue.length;te++)ee=cb(ue[te],ee);return ee}(t,e,L,i)),t.length>80*i){l=f=t[0],u=m=t[1];for(var B=i;B<k;B+=i)(x=t[B])<l&&(l=x),(w=t[B+1])<u&&(u=w),x>f&&(f=x),w>m&&(m=w);E=(E=Math.max(f-l,m-u))!==0?32767/E:0}return fh(L,O,i,l,u,E,0),O}function yg(t,e,i,l,u){var f,m;if(u===Of(t,e,i,l)>0)for(f=e;f<i;f+=l)m=bg(f,t[f],t[f+1],m);else for(f=i-l;f>=e;f-=l)m=bg(f,t[f],t[f+1],m);return m&&fd(m,m.next)&&(mh(m),m=m.next),m}function Ma(t,e){if(!t)return t;e||(e=t);var i,l=t;do if(i=!1,l.steiner||!fd(l,l.next)&&Gi(l.prev,l,l.next)!==0)l=l.next;else{if(mh(l),(l=e=l.prev)===l.next)break;i=!0}while(i||l!==e);return e}function fh(t,e,i,l,u,f,m){if(t){!m&&f&&function(A,k,L,O){var B=A;do B.z===0&&(B.z=zf(B.x,B.y,k,L,O)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(V){var Z,ee,le,te,oe,de,ue,Ie,Me=1;do{for(ee=V,V=null,oe=null,de=0;ee;){for(de++,le=ee,ue=0,Z=0;Z<Me&&(ue++,le=le.nextZ);Z++);for(Ie=Me;ue>0||Ie>0&&le;)ue!==0&&(Ie===0||!le||ee.z<=le.z)?(te=ee,ee=ee.nextZ,ue--):(te=le,le=le.nextZ,Ie--),oe?oe.nextZ=te:V=te,te.prevZ=oe,oe=te;ee=le}oe.nextZ=null,Me*=2}while(de>1)}(B)}(t,l,u,f);for(var x,w,E=t;t.prev!==t.next;)if(x=t.prev,w=t.next,f?rb(t,l,u,f):sb(t))e.push(x.i/i|0),e.push(t.i/i|0),e.push(w.i/i|0),mh(t),t=w.next,E=w.next;else if((t=w)===E){m?m===1?fh(t=ob(Ma(t),e,i),e,i,l,u,f,2):m===2&&ab(t,e,i,l,u,f):fh(Ma(t),e,i,l,u,f,1);break}}}function sb(t){var e=t.prev,i=t,l=t.next;if(Gi(e,i,l)>=0)return!1;for(var u=e.x,f=i.x,m=l.x,x=e.y,w=i.y,E=l.y,A=u<f?u<m?u:m:f<m?f:m,k=x<w?x<E?x:E:w<E?w:E,L=u>f?u>m?u:m:f>m?f:m,O=x>w?x>E?x:E:w>E?w:E,B=l.next;B!==e;){if(B.x>=A&&B.x<=L&&B.y>=k&&B.y<=O&&Ll(u,x,f,w,m,E,B.x,B.y)&&Gi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function rb(t,e,i,l){var u=t.prev,f=t,m=t.next;if(Gi(u,f,m)>=0)return!1;for(var x=u.x,w=f.x,E=m.x,A=u.y,k=f.y,L=m.y,O=x<w?x<E?x:E:w<E?w:E,B=A<k?A<L?A:L:k<L?k:L,V=x>w?x>E?x:E:w>E?w:E,Z=A>k?A>L?A:L:k>L?k:L,ee=zf(O,B,e,i,l),le=zf(V,Z,e,i,l),te=t.prevZ,oe=t.nextZ;te&&te.z>=ee&&oe&&oe.z<=le;){if(te.x>=O&&te.x<=V&&te.y>=B&&te.y<=Z&&te!==u&&te!==m&&Ll(x,A,w,k,E,L,te.x,te.y)&&Gi(te.prev,te,te.next)>=0||(te=te.prevZ,oe.x>=O&&oe.x<=V&&oe.y>=B&&oe.y<=Z&&oe!==u&&oe!==m&&Ll(x,A,w,k,E,L,oe.x,oe.y)&&Gi(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;te&&te.z>=ee;){if(te.x>=O&&te.x<=V&&te.y>=B&&te.y<=Z&&te!==u&&te!==m&&Ll(x,A,w,k,E,L,te.x,te.y)&&Gi(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;oe&&oe.z<=le;){if(oe.x>=O&&oe.x<=V&&oe.y>=B&&oe.y<=Z&&oe!==u&&oe!==m&&Ll(x,A,w,k,E,L,oe.x,oe.y)&&Gi(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function ob(t,e,i){var l=t;do{var u=l.prev,f=l.next.next;!fd(u,f)&&xg(u,l,l.next,f)&&_h(u,f)&&_h(f,u)&&(e.push(u.i/i|0),e.push(l.i/i|0),e.push(f.i/i|0),mh(l),mh(l.next),l=t=f),l=l.next}while(l!==t);return Ma(l)}function ab(t,e,i,l,u,f){var m=t;do{for(var x=m.next.next;x!==m.prev;){if(m.i!==x.i&&db(m,x)){var w=vg(m,x);return m=Ma(m,m.next),w=Ma(w,w.next),fh(m,e,i,l,u,f,0),void fh(w,e,i,l,u,f,0)}x=x.next}m=m.next}while(m!==t)}function lb(t,e){return t.x-e.x}function cb(t,e){var i=function(u,f){var m,x=f,w=u.x,E=u.y,A=-1/0;do{if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){var k=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(k<=w&&k>A&&(A=k,m=x.x<x.next.x?x:x.next,k===w))return m}x=x.next}while(x!==f);if(!m)return null;var L,O=m,B=m.x,V=m.y,Z=1/0;x=m;do w>=x.x&&x.x>=B&&w!==x.x&&Ll(E<V?w:A,E,B,V,E<V?A:w,E,x.x,x.y)&&(L=Math.abs(E-x.y)/(w-x.x),_h(x,u)&&(L<Z||L===Z&&(x.x>m.x||x.x===m.x&&hb(m,x)))&&(m=x,Z=L)),x=x.next;while(x!==O);return m}(t,e);if(!i)return e;var l=vg(i,t);return Ma(l,l.next),Ma(i,i.next)}function hb(t,e){return Gi(t.prev,t,e.prev)<0&&Gi(e.next,t,t.next)<0}function zf(t,e,i,l,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ub(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Ll(t,e,i,l,u,f,m,x){return(u-m)*(e-x)>=(t-m)*(f-x)&&(t-m)*(l-x)>=(i-m)*(e-x)&&(i-m)*(f-x)>=(u-m)*(l-x)}function db(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,l){var u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==l.i&&u.next.i!==l.i&&xg(u,u.next,i,l))return!0;u=u.next}while(u!==i);return!1}(t,e)&&(_h(t,e)&&_h(e,t)&&function(i,l){var u=i,f=!1,m=(i.x+l.x)/2,x=(i.y+l.y)/2;do u.y>x!=u.next.y>x&&u.next.y!==u.y&&m<(u.next.x-u.x)*(x-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f}(t,e)&&(Gi(t.prev,t,e.prev)||Gi(t,e.prev,e))||fd(t,e)&&Gi(t.prev,t,t.next)>0&&Gi(e.prev,e,e.next)>0)}function Gi(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function fd(t,e){return t.x===e.x&&t.y===e.y}function xg(t,e,i,l){var u=md(Gi(t,e,i)),f=md(Gi(t,e,l)),m=md(Gi(i,l,t)),x=md(Gi(i,l,e));return u!==f&&m!==x||!(u!==0||!_d(t,i,e))||!(f!==0||!_d(t,l,e))||!(m!==0||!_d(i,t,l))||!(x!==0||!_d(i,e,l))}function _d(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function md(t){return t>0?1:t<0?-1:0}function _h(t,e){return Gi(t.prev,t,t.next)<0?Gi(t,e,t.next)>=0&&Gi(t,t.prev,e)>=0:Gi(t,e,t.prev)<0||Gi(t,t.next,e)<0}function vg(t,e){var i=new Rf(t.i,t.x,t.y),l=new Rf(e.i,e.x,e.y),u=t.next,f=e.prev;return t.next=e,e.prev=t,i.next=u,u.prev=i,l.next=i,i.prev=l,f.next=l,l.prev=f,l}function bg(t,e,i,l){var u=new Rf(t,e,i);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function mh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Rf(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Of(t,e,i,l){for(var u=0,f=e,m=i-l;f<i;f+=l)u+=(t[m]-t[f])*(t[f+1]+t[m+1]),m=f;return u}Df.exports=pd,Df.exports.default=pd,pd.deviation=function(t,e,i,l){var u=e&&e.length,f=Math.abs(Of(t,0,u?e[0]*i:t.length,i));if(u)for(var m=0,x=e.length;m<x;m++)f-=Math.abs(Of(t,e[m]*i,m<x-1?e[m+1]*i:t.length,i));var w=0;for(m=0;m<l.length;m+=3){var E=l[m]*i,A=l[m+1]*i,k=l[m+2]*i;w+=Math.abs((t[E]-t[k])*(t[A+1]-t[E+1])-(t[E]-t[A])*(t[k+1]-t[E+1]))}return f===0&&w===0?0:Math.abs((w-f)/f)},pd.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},l=0,u=0;u<t.length;u++){for(var f=0;f<t[u].length;f++)for(var m=0;m<e;m++)i.vertices.push(t[u][f][m]);u>0&&i.holes.push(l+=t[u-1].length)}return i};var Bf=Fe(Df.exports);function pb(t,e,i,l,u){wg(t,e,i||0,l||t.length-1,u||fb)}function wg(t,e,i,l,u){for(;l>i;){if(l-i>600){var f=l-i+1,m=e-i+1,x=Math.log(f),w=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*w*(f-w)/f)*(m-f/2<0?-1:1);wg(t,e,Math.max(i,Math.floor(e-m*w/f+E)),Math.min(l,Math.floor(e+(f-m)*w/f+E)),u)}var A=t[e],k=i,L=l;for(gh(t,i,e),u(t[l],A)>0&&gh(t,i,l);k<L;){for(gh(t,k,L),k++,L--;u(t[k],A)<0;)k++;for(;u(t[L],A)>0;)L--}u(t[i],A)===0?gh(t,i,L):gh(t,++L,l),L<=e&&(i=L+1),e<=L&&(l=L-1)}}function gh(t,e,i){var l=t[e];t[e]=t[i],t[i]=l}function fb(t,e){return t<e?-1:t>e?1:0}function Ff(t,e){const i=t.length;if(i<=1)return[t];const l=[];let u,f;for(let m=0;m<i;m++){const x=qa(t[m]);x!==0&&(t[m].area=Math.abs(x),f===void 0&&(f=x<0),f===x<0?(u&&l.push(u),u=[t[m]]):u.push(t[m]))}if(u&&l.push(u),e>1)for(let m=0;m<l.length;m++)l[m].length<=e||(pb(l[m],e,1,l[m].length-1,_b),l[m]=l[m].slice(0,e));return l}function _b(t,e){return e.area-t.area}function Nf(t,e,i){const l=i.patternDependencies;let u=!1;for(const f of e){const m=f.paint.get(`${t}-pattern`);m.isConstant()||(u=!0);const x=m.constantOr(null);x&&(u=!0,l[x]=!0)}return u}function jf(t,e,i,l,u){const f=u.patternDependencies;for(const m of e){const x=m.paint.get(`${t}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:l},i,{},u.availableImages);w=w&&w.name?w.name:w,f[w]=!0,i.patterns[m.id]=w}}return i}class gd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ze,this.indexArray=new _t,this.indexArray2=new nn,this.programConfigurations=new ga(e.layers,e.zoom),this.segments=new Ui,this.segments2=new Ui,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,l,u){this.hasPattern=Nf("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:w,index:E,sourceLayerIndex:A}of e){const k=this.layers[0]._featureFilter.needGeometry,L=Ta(x,k);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),L,l))continue;const O=f?f.evaluate(L,{},l,i.availableImages):void 0,B={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:E,geometry:k?L.geometry:Pr(x,l,u),patterns:{},sortKey:O};m.push(B)}f&&m.sort((x,w)=>x.sortKey-w.sortKey);for(const x of m){const{geometry:w,index:E,sourceLayerIndex:A}=x;if(this.hasPattern){const k=jf("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(k)}else this.addFeature(x,w,E,l,{},i.availableImages);i.featureIndex.insert(e[E].feature,w,E,A,this.index)}}update(e,i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,u)}addFeatures(e,i,l,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,nb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,l,u,f,m=[]){for(const x of Ff(i,500)){let w=0;for(const B of x)w+=B.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=E.vertexLength,k=[],L=[];for(const B of x){if(B.length===0)continue;B!==x[0]&&L.push(k.length/2);const V=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),Z=V.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(Z+B.length-1,Z),k.push(B[0].x),k.push(B[0].y);for(let ee=1;ee<B.length;ee++)this.layoutVertexArray.emplaceBack(B[ee].x,B[ee].y),this.indexArray2.emplaceBack(Z+ee-1,Z+ee),k.push(B[ee].x),k.push(B[ee].y);V.vertexLength+=B.length,V.primitiveLength+=B.length}const O=Bf(k,L);for(let B=0;B<O.length;B+=3)this.indexArray.emplaceBack(A+O[B],A+O[B+1],A+O[B+2]);E.vertexLength+=w,E.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,m,u)}}ut(gd,"FillBucket",{omit:["layers","patternFeatures"]});const mb=new se({"fill-sort-key":new H(Oe.layout_fill["fill-sort-key"])});var gb={paint:new se({"fill-antialias":new j(Oe.paint_fill["fill-antialias"]),"fill-opacity":new H(Oe.paint_fill["fill-opacity"]),"fill-color":new H(Oe.paint_fill["fill-color"]),"fill-outline-color":new H(Oe.paint_fill["fill-outline-color"]),"fill-translate":new j(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new j(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new H(Oe.paint_fill["fill-pattern"])}),layout:mb};const yb=xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),xb=xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),vb=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:bb}=yb;var yd={},wb=nt,Tg=Dl;function Dl(t,e,i,l,u){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=u,t.readFields(Tb,this,e)}function Tb(t,e,i){t==1?e.id=i.readVarint():t==2?function(l,u){for(var f=l.readVarint()+l.pos;l.pos<f;){var m=u._keys[l.readVarint()],x=u._values[l.readVarint()];u.properties[m]=x}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function Eb(t){for(var e,i,l=0,u=0,f=t.length,m=f-1;u<f;m=u++)l+=((i=t[m]).x-(e=t[u]).x)*(e.y+i.y);return l}Dl.types=["Unknown","Point","LineString","Polygon"],Dl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,l=1,u=0,f=0,m=0,x=[];t.pos<i;){if(u<=0){var w=t.readVarint();l=7&w,u=w>>3}if(u--,l===1||l===2)f+=t.readSVarint(),m+=t.readSVarint(),l===1&&(e&&x.push(e),e=[]),e.push(new wb(f,m));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&x.push(e),x},Dl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,l=0,u=0,f=0,m=1/0,x=-1/0,w=1/0,E=-1/0;t.pos<e;){if(l<=0){var A=t.readVarint();i=7&A,l=A>>3}if(l--,i===1||i===2)(u+=t.readSVarint())<m&&(m=u),u>x&&(x=u),(f+=t.readSVarint())<w&&(w=f),f>E&&(E=f);else if(i!==7)throw new Error("unknown command "+i)}return[m,w,x,E]},Dl.prototype.toGeoJSON=function(t,e,i){var l,u,f=this.extent*Math.pow(2,i),m=this.extent*t,x=this.extent*e,w=this.loadGeometry(),E=Dl.types[this.type];function A(O){for(var B=0;B<O.length;B++){var V=O[B];O[B]=[360*(V.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(l=0;l<w.length;l++)k[l]=w[l][0];A(w=k);break;case 2:for(l=0;l<w.length;l++)A(w[l]);break;case 3:for(w=function(O){var B=O.length;if(B<=1)return[O];for(var V,Z,ee=[],le=0;le<B;le++){var te=Eb(O[le]);te!==0&&(Z===void 0&&(Z=te<0),Z===te<0?(V&&ee.push(V),V=[O[le]]):V.push(O[le]))}return V&&ee.push(V),ee}(w),l=0;l<w.length;l++)for(u=0;u<w[l].length;u++)A(w[l][u])}w.length===1?w=w[0]:E="Multi"+E;var L={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(L.id=this.id),L};var Mb=Tg,Eg=Mg;function Mg(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Sb,this,e),this.length=this._features.length}function Sb(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(l){for(var u=null,f=l.readVarint()+l.pos;l.pos<f;){var m=l.readVarint()>>3;u=m===1?l.readString():m===2?l.readFloat():m===3?l.readDouble():m===4?l.readVarint64():m===5?l.readVarint():m===6?l.readSVarint():m===7?l.readBoolean():null}return u}(i))}Mg.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Mb(this._pbf,e,this.extent,this._keys,this._values)};var Ab=Eg;function Ib(t,e,i){if(t===3){var l=new Ab(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}var Vf=yd.VectorTile=function(t,e){this.layers=t.readFields(Ib,{},e)},xd=yd.VectorTileFeature=Tg;function vd(t,e,i,l){const u=[],f=l===0?(m,x,w,E,A,k)=>{m.push(new De(k,w+(k-x)/(E-x)*(A-w)))}:(m,x,w,E,A,k)=>{m.push(new De(x+(k-w)/(A-w)*(E-x),k))};for(const m of t){const x=[];for(const w of m){if(w.length<=2)continue;const E=[];for(let L=0;L<w.length-1;L++){const O=w[L].x,B=w[L].y,V=w[L+1].x,Z=w[L+1].y,ee=l===0?O:B,le=l===0?V:Z;ee<e?le>e&&f(E,O,B,V,Z,e):ee>i?le<i&&f(E,O,B,V,Z,i):E.push(w[L]),le<e&&ee>=e&&f(E,O,B,V,Z,e),le>i&&ee<=i&&f(E,O,B,V,Z,i)}let A=w[w.length-1];const k=l===0?A.x:A.y;k>=e&&k<=i&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),x.push(E))}x.length&&u.push(x)}return u}yd.VectorTileLayer=Eg;const Cb=xd.types,Pb=Math.pow(2,13);function yh(t,e,i,l,u,f,m,x){t.emplaceBack((e<<1)+m,(i<<1)+f,(Math.floor(l*Pb)<<1)+u,Math.round(x))}function xh(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Sg{constructor(){this.acc=new De(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new De(e.x,e.y),this.max=new De(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const l=this.min,u=this.max;e.x<l.x?l.x=e.x:e.x>u.x&&(u.x=e.x),e.y<l.y?l.y=e.y:e.y>u.y&&(u.y=e.y),((e.x===0||e.x===yt)&&e.x===i.x)!=((e.y===0||e.y===yt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,Ut(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>yt!=e.x>yt&&this.addBorderIntersection(1,Ut(i.y,e.y,(yt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ut(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>yt!=e.y>yt&&this.addBorderIntersection(3,Ut(i.x,e.x,(yt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((i,l)=>i+l.edges,0);return e!==0?this.acc.div(e)._round():new De(0,0)}span(){return new De(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class vh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new je,this.centroidVertexArray=new Os,this.indexArray=new _t,this.programConfigurations=new ga(e.layers,e.zoom),this.segments=new Ui,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,l,u){this.features=[],this.hasPattern=Nf("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/yt/(1<<f.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:m,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,A=Ta(f,E);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),A,l))continue;const k={id:m,sourceLayerIndex:w,index:x,geometry:E?A.geometry:Pr(f,l,u),properties:f.properties,type:f.type,patterns:{}},L=this.layoutVertexArray.length;this.hasPattern?this.features.push(jf("fill-extrusion",this.layers,k,this.zoom,i)):this.addFeature(k,k.geometry,x,l,{},i.availableImages,u),i.featureIndex.insert(f,k.geometry,x,w,this.index,L)}this.sortBorders()}addFeatures(e,i,l,u,f){for(const m of this.features){const{geometry:x}=m;this.addFeature(m,x,m.index,i,l,u,f)}this.sortBorders()}update(e,i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,bb),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,vb.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,xb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,u,f,m,x){const w=[new De(0,0),new De(yt,yt)],E=x.projection,A=E.name==="globe",k=this.enableTerrain&&!A?new Sg:null,L=Cb[e.type]==="Polygon";A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Xe);const O=Ff(i,500);for(let ee=O.length-1;ee>=0;ee--){const le=O[ee];(le.length===0||(B=le[0]).every(te=>te.x<=0)||B.every(te=>te.x>=yt)||B.every(te=>te.y<=0)||B.every(te=>te.y>=yt))&&O.splice(ee,1)}var B;let V;if(A)V=Dg(O,w,u);else{V=[];for(const ee of O)V.push({polygon:ee,bounds:w})}const Z=L?this.edgeRadius:0;for(const{polygon:ee,bounds:le}of V){let te=0,oe=0;for(const ue of ee)L&&!ue[0].equals(ue[ue.length-1])&&ue.push(ue[0]),oe+=L?ue.length-1:ue.length;const de=this.segments.prepareSegment((L?5:4)*oe,this.layoutVertexArray,this.indexArray);if(L){const ue=[],Ie=[];te=de.vertexLength;for(const Be of ee){let He,Pe;Be.length&&Be!==ee[0]&&Ie.push(ue.length/2),He=Be[1].sub(Be[0])._perp()._unit();for(let Ve=1;Ve<Be.length;Ve++){const Ue=Be[Ve],$e=Be[Ve===Be.length-1?1:Ve+1];let{x:Qe,y:ze}=Ue;if(Z){Pe=$e.sub(Ue)._perp()._unit();const rt=He.add(Pe)._unit(),pt=Z*Math.min(4,1/(He.x*rt.x+He.y*rt.y));Qe+=pt*rt.x,ze+=pt*rt.y,He=Pe}yh(this.layoutVertexArray,Qe,ze,0,0,1,1,0),de.vertexLength++,ue.push(Ue.x,Ue.y),A&&xh(this.layoutVertexExtArray,E.projectTilePoint(Qe,ze,u),E.upVector(u,Qe,ze))}}const Me=Bf(ue,Ie);for(let Be=0;Be<Me.length;Be+=3)this.indexArray.emplaceBack(te+Me[Be],te+Me[Be+2],te+Me[Be+1]),de.primitiveLength++}for(const ue of ee){k&&ue.length&&k.startRing(ue[0]);let Ie,Me,Be,He=ue.length>4&&Pg(ue[ue.length-2],ue[0],ue[1]),Pe=Z?kb(ue[ue.length-2],ue[0],ue[1],Z):0;Me=ue[1].sub(ue[0])._perp()._unit();let Ve=!0;for(let Ue=1,$e=0;Ue<ue.length;Ue++){let Qe=ue[Ue-1],ze=ue[Ue];const rt=ue[Ue===ue.length-1?1:Ue+1];if(k&&L&&k.currentPolyCount.top++,Cg(ze,Qe,le)){Z&&(Me=rt.sub(ze)._perp()._unit(),Ve=!Ve);continue}k&&k.append(ze,Qe);const pt=ze.sub(Qe)._perp(),ot=pt.x/(Math.abs(pt.x)+Math.abs(pt.y)),Tt=pt.y>0?1:0,et=Qe.dist(ze);if($e+et>32768&&($e=0),Z){Be=rt.sub(ze)._perp()._unit();let Mt=Ig(Qe,ze,rt,Ag(Me,Be),Z);isNaN(Mt)&&(Mt=0);const vt=ze.sub(Qe)._unit();Qe=Qe.add(vt.mult(Pe))._round(),ze=ze.add(vt.mult(-Mt))._round(),Pe=Mt,Me=Be}const gt=de.vertexLength,Et=ue.length>4&&Pg(Qe,ze,rt);let qt=kg($e,He,Ve);if(yh(this.layoutVertexArray,Qe.x,Qe.y,ot,Tt,0,0,qt),yh(this.layoutVertexArray,Qe.x,Qe.y,ot,Tt,0,1,qt),$e+=et,qt=kg($e,Et,!Ve),He=Et,yh(this.layoutVertexArray,ze.x,ze.y,ot,Tt,0,0,qt),yh(this.layoutVertexArray,ze.x,ze.y,ot,Tt,0,1,qt),de.vertexLength+=4,this.indexArray.emplaceBack(gt+0,gt+1,gt+2),this.indexArray.emplaceBack(gt+1,gt+3,gt+2),de.primitiveLength+=2,Z){const Mt=te+(Ue===1?ue.length-2:Ue-2),vt=Ue===1?te:Mt+1;if(this.indexArray.emplaceBack(gt+1,Mt,gt+3),this.indexArray.emplaceBack(Mt,vt,gt+3),de.primitiveLength+=2,Ie===void 0&&(Ie=gt),!Cg(rt,ue[Ue],le)){const fi=Ue===ue.length-1?Ie:de.vertexLength;this.indexArray.emplaceBack(gt+2,gt+3,fi),this.indexArray.emplaceBack(gt+3,fi+1,fi),this.indexArray.emplaceBack(gt+3,vt,fi+1),de.primitiveLength+=3}Ve=!Ve}if(A){const Mt=this.layoutVertexExtArray,vt=E.projectTilePoint(Qe.x,Qe.y,u),fi=E.projectTilePoint(ze.x,ze.y,u),It=E.upVector(u,Qe.x,Qe.y),Ct=E.upVector(u,ze.x,ze.y);xh(Mt,vt,It),xh(Mt,vt,It),xh(Mt,fi,Ct),xh(Mt,fi,Ct)}}L&&(te+=ue.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const ee=k.borders,le=this.featuresOnBorder.push(k)-1;for(let te=0;te<4;te++)ee[te][0]!==Number.MAX_VALUE&&this.borders[te].push(le)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,m,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,i,l=!0){let u,f;if(e)if(e.y!==0){const x=i.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+l;let m=l?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(m++,u,f);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,u,f)}}}function Ag(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function kb(t,e,i,l){const u=e.sub(t)._perp()._unit(),f=i.sub(e)._perp()._unit();return Ig(t,e,i,Ag(u,f),l)}function Ig(t,e,i,l,u){const f=Math.sqrt(1-l*l);return Math.min(t.dist(e)/3,e.dist(i)/3,u*f/l)}function Cg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function Pg(t,e,i){if(t.x<0||t.x>=yt||e.x<0||e.x>=yt||i.x<0||i.x>=yt)return!1;const l=i.sub(e),u=l.perp(),f=t.sub(e);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function kg(t,e,i){const l=e?2|t:-3&t;return i?1|l:-2&l}function Lg(){const t=Math.PI/32,e=Math.tan(t),i=ph;return i*Math.sqrt(1+2*e*e)-i}function Dg(t,e,i){const l=1<<i.z,u=ss(i.x/l),f=ss((i.x+1)/l),m=fn(i.y/l),x=fn((i.y+1)/l);return function(w,E,A,k,L=0,O){const B=[];if(!w.length||!A||!k)return B;const V=(ue,Ie)=>{for(const Me of ue)B.push({polygon:Me,bounds:Ie})},Z=Math.ceil(Math.log2(A)),ee=Math.ceil(Math.log2(k)),le=Z-ee,te=[];for(let ue=0;ue<Math.abs(le);ue++)te.push(le>0?0:1);for(let ue=0;ue<Math.min(Z,ee);ue++)te.push(0),te.push(1);let oe=w;if(oe=vd(oe,E[0].y-L,E[1].y+L,1),oe=vd(oe,E[0].x-L,E[1].x+L,0),!oe.length)return B;const de=[];for(te.length?de.push({polygons:oe,bounds:E,depth:0}):V(oe,E);de.length;){const ue=de.pop(),Ie=ue.depth,Me=te[Ie],Be=ue.bounds[0],He=ue.bounds[1],Pe=Me===0?Be.x:Be.y,Ve=Me===0?He.x:He.y,Ue=O?O(Me,Pe,Ve):.5*(Pe+Ve),$e=vd(ue.polygons,Pe-L,Ue+L,Me),Qe=vd(ue.polygons,Ue-L,Ve+L,Me);if($e.length){const ze=[Be,new De(Me===0?Ue:He.x,Me===1?Ue:He.y)];te.length>Ie+1?de.push({polygons:$e,bounds:ze,depth:Ie+1}):V($e,ze)}if(Qe.length){const ze=[new De(Me===0?Ue:Be.x,Me===1?Ue:Be.y),He];te.length>Ie+1?de.push({polygons:Qe,bounds:ze,depth:Ie+1}):V(Qe,ze)}}return B}(t,e,Math.ceil((f-u)/11.25),Math.ceil((m-x)/11.25),1,(w,E,A)=>{if(w===0)return .5*(E+A);{const k=fn((i.y+E/yt)/l);return(nr(.5*(fn((i.y+A/yt)/l)+k))*l-i.y)*yt}})}ut(vh,"FillExtrusionBucket",{omit:["layers","features"]}),ut(Sg,"PartMetadata");const Lb=new se({"fill-extrusion-edge-radius":new j(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Db={paint:new se({"fill-extrusion-opacity":new j(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new H(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new j(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new j(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new H(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new H(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new H(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new j(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new j(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new j(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new j(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Lb};function zg(t,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[t*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class bd{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=bh(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const l=function(f,m,x){var w=zg(256*f,256*(m=Math.pow(2,x)-m-1),x),E=zg(256*(f+1),256*(m+1),x);return w[0]+","+w[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),u=function(f,m,x){let w,E="";for(let A=f;A>0;A--)w=1<<A-1,E+=(m&w?1:0)+(x&w?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Rg{constructor(e,i){this.wrap=e,this.canonical=i,this.key=bh(e,i.z,i.z,i.x,i.y)}}class An{constructor(e,i,l,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new bd(l,+u,+f),this.key=i===0&&e===l?this.canonical.key:bh(i,e,l,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new An(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new An(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return bh(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return bh(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new An(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,u=2*this.canonical.y;return[new An(i,this.wrap,i,l,u),new An(i,this.wrap,i,l+1,u),new An(i,this.wrap,i,l,u+1),new An(i,this.wrap,i,l+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new An(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new An(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Rg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function bh(t,e,i,l,u){const f=1<<Math.min(i,22);let m=f*(u%f)+l%f;return t&&i<22&&(m+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}ut(bd,"CanonicalTileID"),ut(An,"OverscaledTileID",{omit:["projMatrix"]});class zl extends De{constructor(e,i,l){super(e,i),this.z=l}}function wh(t,e){return t.x*e.x+t.y*e.y}function Og(t,e){if(t.length===1){let i=0;const l=e[i++];let u;for(;!u||l.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],m=t[0],x=u.sub(l),w=f.sub(l),E=m.sub(l),A=wh(x,x),k=wh(x,w),L=wh(w,w),O=wh(E,x),B=wh(E,w),V=A*L-k*k,Z=(L*O-k*B)/V,ee=(A*B-k*O)/V,le=l.z*(1-Z-ee)+u.z*Z+f.z*ee;if(isFinite(le))return le}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function Bg(t,e,i,l,u,f,m,x){const w=m*u.getElevationAt(t,e,!0,!0),E=f[0]!==0,A=E?f[1]===0?m*(f[0]/7-450):m*function(k,L,O){const B=Math.floor(L[0]/8),V=Math.floor(L[1]/8),Z=10*(L[0]-8*B),ee=10*(L[1]-8*V),le=k.getElevationAt(B,V,!0,!0),te=k.getMeterToDEM(O),oe=Math.floor(.5*(Z*te-1)),de=Math.floor(.5*(ee*te-1)),ue=k.tileCoordToPixel(B,V),Ie=2*oe+1,Me=2*de+1,Be=function(Qe,ze,rt,pt,ot){return[Qe.getElevationAtPixel(ze,rt,!0),Qe.getElevationAtPixel(ze+ot,rt,!0),Qe.getElevationAtPixel(ze,rt+ot,!0),Qe.getElevationAtPixel(ze+pt,rt+ot,!0)]}(k,ue.x-oe,ue.y-de,Ie,Me),He=Math.abs(Be[0]-Be[1]),Pe=Math.abs(Be[2]-Be[3]),Ve=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),Ue=Math.min(.25,.5*te*(He+Pe)/Ie),$e=Math.min(.25,.5*te*Ve/Me);return le+Math.max(Ue*Z,$e*ee)}(u,f,x):w;return{base:w+(i===0)?-1:i,top:E?Math.max(A+l,w+i+2):w+l}}const zb=xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Rb}=zb,Ob=xe([{name:"a_packed",components:4,type:"Float32"}]),{members:Bb}=Ob,Fb=xd.types,Nb=Math.cos(Math.PI/180*37.5);class wd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Ce,this.layoutVertexArray2=new We,this.indexArray=new _t,this.programConfigurations=new ga(e.layers,e.zoom),this.segments=new Ui,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,u){this.hasPattern=Nf("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:A,id:k,index:L,sourceLayerIndex:O}of e){const B=this.layers[0]._featureFilter.needGeometry,V=Ta(A,B);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),V,l))continue;const Z=f?f.evaluate(V,{},l):void 0,ee={id:k,properties:A.properties,type:A.type,sourceLayerIndex:O,index:L,geometry:B?V.geometry:Pr(A,l,u),patterns:{},sortKey:Z};m.push(ee)}f&&m.sort((A,k)=>A.sortKey-k.sortKey);const{lineAtlas:x,featureIndex:w}=i,E=this.addConstantDashes(x);for(const A of m){const{geometry:k,index:L,sourceLayerIndex:O}=A;if(E&&this.addFeatureDashes(A,x),this.hasPattern){const B=jf("line",this.layers,A,this.zoom,i);this.patternFeatures.push(B)}else this.addFeature(A,k,L,l,x.positions,i.availableImages);w.insert(e[L].feature,k,L,O,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const u=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")i=!0;else{const m=f.value,x=u.value;if(!x)continue;e.addDash(x,m)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let x,w;if(f.kind==="constant"){if(x=f.value,!x)continue}else x=f.evaluate({zoom:l},e);w=m.kind==="constant"?m.value:m.evaluate({zoom:l},e),i.addDash(x,w),e.patterns[u.id]=i.getKey(x,w)}}update(e,i,l,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,u)}addFeatures(e,i,l,u,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,l,u)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Bb)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,l,u,f,m){const x=this.layers[0].layout,w=x.get("line-join").evaluate(e,{}),E=x.get("line-cap").evaluate(e,{}),A=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const L of i)this.addLine(L,e,w,E,A,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,m,u)}addLine(e,i,l,u,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=Fb[i.type]==="Polygon";let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let E=0;for(;E<w-1&&e[E].equals(e[E+1]);)E++;if(w<(x?3:2))return;l==="bevel"&&(f=1.05);const A=this.overscaling<=16?15*yt/(512*this.overscaling):0,k=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let L,O,B,V,Z;this.e1=this.e2=-1,x&&(L=e[w-2],Z=e[E].sub(L)._unit()._perp());for(let ee=E;ee<w;ee++){if(B=ee===w-1?x?e[E+1]:void 0:e[ee+1],B&&e[ee].equals(B))continue;Z&&(V=Z),L&&(O=L),L=e[ee],Z=B?B.sub(L)._unit()._perp():V,V=V||Z;let le=V.add(Z);le.x===0&&le.y===0||le._unit();const te=V.x*Z.x+V.y*Z.y,oe=le.x*Z.x+le.y*Z.y,de=oe!==0?1/oe:1/0,ue=2*Math.sqrt(2-2*oe),Ie=oe<Nb&&O&&B,Me=V.x*Z.y-V.y*Z.x>0;if(Ie&&ee>E){const Pe=L.dist(O);if(Pe>2*A){const Ve=L.sub(L.sub(O)._mult(A/Pe)._round());this.updateDistance(O,Ve),this.addCurrentVertex(Ve,V,0,0,k),O=Ve}}const Be=O&&B;let He=Be?l:x?"butt":u;if(Be&&He==="round"&&(de<m?He="miter":de<=2&&(He="fakeround")),He==="miter"&&de>f&&(He="bevel"),He==="bevel"&&(de>2&&(He="flipbevel"),de<f&&(He="miter")),O&&this.updateDistance(O,L),He==="miter")le._mult(de),this.addCurrentVertex(L,le,0,0,k);else if(He==="flipbevel"){if(de>100)le=Z.mult(-1);else{const Pe=de*V.add(Z).mag()/V.sub(Z).mag();le._perp()._mult(Pe*(Me?-1:1))}this.addCurrentVertex(L,le,0,0,k),this.addCurrentVertex(L,le.mult(-1),0,0,k)}else if(He==="bevel"||He==="fakeround"){const Pe=-Math.sqrt(de*de-1),Ve=Me?Pe:0,Ue=Me?0:Pe;if(O&&this.addCurrentVertex(L,V,Ve,Ue,k),He==="fakeround"){const $e=Math.round(180*ue/Math.PI/20);for(let Qe=1;Qe<$e;Qe++){let ze=Qe/$e;if(ze!==.5){const pt=ze-.5;ze+=ze*pt*(ze-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*pt*pt+(.848013+te*(.215638*te-1.06021)))}const rt=Z.sub(V)._mult(ze)._add(V)._unit()._mult(Me?-1:1);this.addHalfVertex(L,rt.x,rt.y,!1,Me,0,k)}}B&&this.addCurrentVertex(L,Z,-Ve,-Ue,k)}else if(He==="butt")this.addCurrentVertex(L,le,0,0,k);else if(He==="square"){const Pe=O?1:-1;O||this.addCurrentVertex(L,le,Pe,Pe,k),this.addCurrentVertex(L,le,0,0,k),O&&this.addCurrentVertex(L,le,Pe,Pe,k)}else He==="round"&&(O&&(this.addCurrentVertex(L,V,0,0,k),this.addCurrentVertex(L,V,1,1,k,!0)),B&&(this.addCurrentVertex(L,Z,-1,-1,k,!0),this.addCurrentVertex(L,Z,0,0,k)));if(Ie&&ee<w-1){const Pe=L.dist(B);if(Pe>2*A){const Ve=L.add(B.sub(L)._mult(A/Pe)._round());this.updateDistance(L,Ve),this.addCurrentVertex(Ve,Z,0,0,k),L=Ve}}}}addCurrentVertex(e,i,l,u,f,m=!1){const x=i.y*u-i.x,w=-i.y-i.x*u;this.addHalfVertex(e,i.x+i.y*l,i.y-i.x*l,m,!1,l,f),this.addHalfVertex(e,x,w,m,!0,-u,f)}addHalfVertex({x:e,y:i},l,u,f,m,x,w){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*u)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),m?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}ut(wd,"LineBucket",{omit:["layers","patternFeatures"]});const jb=new se({"line-cap":new H(Oe.layout_line["line-cap"]),"line-join":new H(Oe.layout_line["line-join"]),"line-miter-limit":new j(Oe.layout_line["line-miter-limit"]),"line-round-limit":new j(Oe.layout_line["line-round-limit"]),"line-sort-key":new H(Oe.layout_line["line-sort-key"])});var Fg={paint:new se({"line-opacity":new H(Oe.paint_line["line-opacity"]),"line-color":new H(Oe.paint_line["line-color"]),"line-translate":new j(Oe.paint_line["line-translate"]),"line-translate-anchor":new j(Oe.paint_line["line-translate-anchor"]),"line-width":new H(Oe.paint_line["line-width"]),"line-gap-width":new H(Oe.paint_line["line-gap-width"]),"line-offset":new H(Oe.paint_line["line-offset"]),"line-blur":new H(Oe.paint_line["line-blur"]),"line-dasharray":new H(Oe.paint_line["line-dasharray"]),"line-pattern":new H(Oe.paint_line["line-pattern"]),"line-gradient":new ne(Oe.paint_line["line-gradient"]),"line-trim-offset":new j(Oe.paint_line["line-trim-offset"])}),layout:jb};const Ng=new class extends H{possiblyEvaluate(t,e){return e=new P(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,l){return e=_i({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,l)}}(Fg.paint.properties["line-width"].specification);function jg(t,e){return e>0?e+2*t:t}Ng.useIntegerZoom=!0;const Vb=xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ub=xe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Gb=xe([{name:"a_projected_pos",components:4,type:"Float32"}],4);xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const $b=xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),qb=xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Vg=xe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Wb=xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xe([{name:"triangle",components:3,type:"Uint16"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xe([{type:"Float32",name:"offsetX"}]),xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ln=24;const Us=128;function Uf(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new P(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:u}=i;let f=0;for(;f<l.length&&l[f]<=t;)f++;f=Math.max(0,f-1);let m=f;for(;m<l.length&&l[m]<t+1;)m++;m=Math.min(l.length-1,m);const x=l[f],w=l[m];return i.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:u}:{kind:"camera",minZoom:x,maxZoom:w,minSize:i.evaluate(new P(x)),maxSize:i.evaluate(new P(w)),interpolationType:u}}}function Td(t,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:u}){return t.kind==="source"?l/Us:t.kind==="composite"?Ut(l/Us,u/Us,i):e}function Rl(t,e){let i=0,l=0;if(t.kind==="constant")l=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:u,minZoom:f,maxZoom:m}=t,x=u?bt(fs.interpolationFactor(u,e,f,m),0,1):0;t.kind==="camera"?l=Ut(t.minSize,t.maxSize,x):i=x}return{uSizeT:i,uSize:l}}var Zb=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Us,evaluateSizeForFeature:Td,evaluateSizeForZoom:Rl,getSizeData:Uf});function Hb(t,e,i){return t.sections.forEach(l=>{l.text=function(u,f,m){const x=f.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?u=u.toLocaleUpperCase():x==="lowercase"&&(u=u.toLocaleLowerCase()),S.applyArabicShaping&&(u=S.applyArabicShaping(u)),u}(l.text,e,i)}),t}const Th={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Xb(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function Yb(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var Ug=hi,Gg=function(t,e,i,l,u){var f,m,x=8*u-l-1,w=(1<<x)-1,E=w>>1,A=-7,k=i?u-1:0,L=i?-1:1,O=t[e+k];for(k+=L,f=O&(1<<-A)-1,O>>=-A,A+=x;A>0;f=256*f+t[e+k],k+=L,A-=8);for(m=f&(1<<-A)-1,f>>=-A,A+=l;A>0;m=256*m+t[e+k],k+=L,A-=8);if(f===0)f=1-E;else{if(f===w)return m?NaN:1/0*(O?-1:1);m+=Math.pow(2,l),f-=E}return(O?-1:1)*m*Math.pow(2,f-l)},$g=function(t,e,i,l,u,f){var m,x,w,E=8*f-u-1,A=(1<<E)-1,k=A>>1,L=u===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=l?0:f-1,B=l?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,m=A):(m=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-m))<1&&(m--,w*=2),(e+=m+k>=1?L/w:L*Math.pow(2,1-k))*w>=2&&(m++,w/=2),m+k>=A?(x=0,m=A):m+k>=1?(x=(e*w-1)*Math.pow(2,u),m+=k):(x=e*Math.pow(2,k-1)*Math.pow(2,u),m=0));u>=8;t[i+O]=255&x,O+=B,x/=256,u-=8);for(m=m<<u|x,E+=u;E>0;t[i+O]=255&m,O+=B,m/=256,E-=8);t[i+O-B]|=128*V};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function hi(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}hi.Varint=0,hi.Fixed64=1,hi.Bytes=2,hi.Fixed32=5;var Gf=4294967296,qg=1/Gf,Wg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Lr(t){return t.type===hi.Bytes?t.readVarint()+t.pos:t.pos+1}function Ol(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Zg(t,e,i){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(var u=i.pos-1;u>=t;u--)i.buf[u+l]=i.buf[u]}function Kb(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Jb(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Qb(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function ew(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function tw(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function iw(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function nw(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function sw(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function rw(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function Ed(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Bl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Hg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}hi.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var l=this.readVarint(),u=l>>3,f=this.pos;this.type=7&l,t(u,e,this),this.pos===f&&this.skip(l)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Ed(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Hg(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Ed(this.buf,this.pos)+Ed(this.buf,this.pos+4)*Gf;return this.pos+=8,t},readSFixed64:function(){var t=Ed(this.buf,this.pos)+Hg(this.buf,this.pos+4)*Gf;return this.pos+=8,t},readFloat:function(){var t=Gg(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Gg(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,l=this.buf;return e=127&(i=l[this.pos++]),i<128?e:(e|=(127&(i=l[this.pos++]))<<7,i<128?e:(e|=(127&(i=l[this.pos++]))<<14,i<128?e:(e|=(127&(i=l[this.pos++]))<<21,i<128?e:function(u,f,m){var x,w,E=m.buf;if(x=(112&(w=E[m.pos++]))>>4,w<128||(x|=(127&(w=E[m.pos++]))<<3,w<128)||(x|=(127&(w=E[m.pos++]))<<10,w<128)||(x|=(127&(w=E[m.pos++]))<<17,w<128)||(x|=(127&(w=E[m.pos++]))<<24,w<128)||(x|=(1&(w=E[m.pos++]))<<31,w<128))return Ol(u,x,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=l[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Wg?function(i,l,u){return Wg.decode(i.subarray(l,u))}(this.buf,e,t):function(i,l,u){for(var f="",m=l;m<u;){var x,w,E,A=i[m],k=null,L=A>239?4:A>223?3:A>191?2:1;if(m+L>u)break;L===1?A<128&&(k=A):L===2?(192&(x=i[m+1]))==128&&(k=(31&A)<<6|63&x)<=127&&(k=null):L===3?(w=i[m+2],(192&(x=i[m+1]))==128&&(192&w)==128&&((k=(15&A)<<12|(63&x)<<6|63&w)<=2047||k>=55296&&k<=57343)&&(k=null)):L===4&&(w=i[m+2],E=i[m+3],(192&(x=i[m+1]))==128&&(192&w)==128&&(192&E)==128&&((k=(15&A)<<18|(63&x)<<12|(63&w)<<6|63&E)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,L=1):k>65535&&(k-=65536,f+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),f+=String.fromCharCode(k),m+=L}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==hi.Bytes)return t.push(this.readVarint(e));var i=Lr(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==hi.Bytes)return t.push(this.readSVarint());var e=Lr(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==hi.Bytes)return t.push(this.readBoolean());var e=Lr(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==hi.Bytes)return t.push(this.readFloat());var e=Lr(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==hi.Bytes)return t.push(this.readDouble());var e=Lr(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==hi.Bytes)return t.push(this.readFixed32());var e=Lr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==hi.Bytes)return t.push(this.readSFixed32());var e=Lr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==hi.Bytes)return t.push(this.readFixed64());var e=Lr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==hi.Bytes)return t.push(this.readSFixed64());var e=Lr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===hi.Varint)for(;this.buf[this.pos++]>127;);else if(e===hi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===hi.Fixed32)this.pos+=4;else{if(e!==hi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Bl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Bl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Bl(this.buf,-1&t,this.pos),Bl(this.buf,Math.floor(t*qg),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Bl(this.buf,-1&t,this.pos),Bl(this.buf,Math.floor(t*qg),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var l,u;if(e>=0?(l=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(f,m,x){x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7)}(l,0,i),function(f,m){var x=(7&f)<<4;m.buf[m.pos++]|=x|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(l,u,f){for(var m,x,w=0;w<u.length;w++){if((m=u.charCodeAt(w))>55295&&m<57344){if(!x){m>56319||w+1===u.length?(l[f++]=239,l[f++]=191,l[f++]=189):x=m;continue}if(m<56320){l[f++]=239,l[f++]=191,l[f++]=189,x=m;continue}m=x-55296<<10|m-56320|65536,x=null}else x&&(l[f++]=239,l[f++]=191,l[f++]=189,x=null);m<128?l[f++]=m:(m<2048?l[f++]=m>>6|192:(m<65536?l[f++]=m>>12|224:(l[f++]=m>>18|240,l[f++]=m>>12&63|128),l[f++]=m>>6&63|128),l[f++]=63&m|128)}return f}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Zg(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),$g(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),$g(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var l=this.pos-i;l>=128&&Zg(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeMessage:function(t,e,i){this.writeTag(t,hi.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Kb,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Jb,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,tw,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Qb,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,ew,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,iw,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,nw,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,sw,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,rw,e)},writeBytesField:function(t,e){this.writeTag(t,hi.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,hi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,hi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,hi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,hi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,hi.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,hi.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,hi.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,hi.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,hi.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Md=Fe(Ug);const $f=3;function ow(t,e,i){e.glyphs=[],t===1&&i.readMessage(aw,e)}function aw(t,e,i){if(t===3){const{id:l,bitmap:u,width:f,height:m,left:x,top:w,advance:E}=i.readMessage(lw,{});e.glyphs.push({id:l,bitmap:new kr({width:f+2*$f,height:m+2*$f},u),metrics:{width:f,height:m,left:x,top:w,advance:E}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function lw(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const Xg=$f;function qf(t){let e=0,i=0;for(const m of t)e+=m.w*m.h,i=Math.max(i,m.w);t.sort((m,x)=>x.h-m.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const m of t)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===w.w&&m.h===w.h){const E=l.pop();x<l.length&&(l[x]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(l.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}const Fn=1;class Wf{constructor(e,{pixelRatio:i,version:l,stretchX:u,stretchY:f,content:m}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=u,this.stretchY=f,this.content=m,this.version=l}get tl(){return[this.paddedRect.x+Fn,this.paddedRect.y+Fn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fn,this.paddedRect.y+this.paddedRect.h-Fn]}get displaySize(){return[(this.paddedRect.w-2*Fn)/this.pixelRatio,(this.paddedRect.h-2*Fn)/this.pixelRatio]}}class Yg{constructor(e,i){const l={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,f),this.addImages(i,u,f);const{w:m,h:x}=qf(f),w=new Hn({width:m||1,height:x||1});for(const E in e){const A=e[E],k=l[E].paddedRect;Hn.copy(A.data,w,{x:0,y:0},{x:k.x+Fn,y:k.y+Fn},A.data)}for(const E in i){const A=i[E],k=u[E].paddedRect,L=k.x+Fn,O=k.y+Fn,B=A.data.width,V=A.data.height;Hn.copy(A.data,w,{x:0,y:0},{x:L,y:O},A.data),Hn.copy(A.data,w,{x:0,y:V-1},{x:L,y:O-1},{width:B,height:1}),Hn.copy(A.data,w,{x:0,y:0},{x:L,y:O+V},{width:B,height:1}),Hn.copy(A.data,w,{x:B-1,y:0},{x:L-1,y:O},{width:1,height:V}),Hn.copy(A.data,w,{x:0,y:0},{x:L+B,y:O},{width:1,height:V})}this.image=w,this.iconPositions=l,this.patternPositions=u}addImages(e,i,l){for(const u in e){const f=e[u],m={x:0,y:0,w:f.data.width+2*Fn,h:f.data.height+2*Fn};l.push(m),i[u]=new Wf(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),i),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),i)}patchUpdatedImage(e,i,l){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,f]=e.tl;l.update(i.data,void 0,{x:u,y:f})}}ut(Wf,"ImagePosition"),ut(Yg,"ImageAtlas");const rs={horizontal:1,vertical:2,horizontalOnly:3},Kg=-17;class Eh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const l=new Eh;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new Eh;return i.imageName=e,i}}class Fl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const l=new Fl;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?l.addImageSection(f):l.addTextSection(f,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,l){let u="";for(let f=0;f<i.length;f++){const m=i.charCodeAt(f+1)||null,x=i.charCodeAt(f-1)||null;u+=!l&&(m&&ed(m)&&!Th[i[f+1]]||x&&ed(x)&&!Th[i[f-1]])||!Th[i[f]]?i[f]:Th[i[f]]}return u}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Sd[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Sd[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new Fl;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Eh.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(l)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Ei("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Eh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Ei("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zf(t,e,i,l,u,f,m,x,w,E,A,k,L,O,B){const V=Fl.fromFeature(t,u);k===rs.vertical&&V.verticalizePunctuation(L);let Z=[];const ee=function(ue,Ie,Me,Be,He,Pe){if(!ue)return[];const Ve=[],Ue=function(rt,pt,ot,Tt,et,gt){let Et=0;for(let qt=0;qt<rt.length();qt++){const Mt=rt.getSection(qt);Et+=Jg(rt.getCharCode(qt),Mt,Tt,et,pt,gt)}return Et/Math.max(1,Math.ceil(Et/ot))}(ue,Ie,Me,Be,He,Pe),$e=ue.text.indexOf("​")>=0;let Qe=0;for(let rt=0;rt<ue.length();rt++){const pt=ue.getSection(rt),ot=ue.getCharCode(rt);if(Sd[ot]||(Qe+=Jg(ot,pt,Be,He,Ie,Pe)),rt<ue.length()-1){const Tt=!((ze=ot)<11904||!(at["Bopomofo Extended"](ze)||at.Bopomofo(ze)||at["CJK Compatibility Forms"](ze)||at["CJK Compatibility Ideographs"](ze)||at["CJK Compatibility"](ze)||at["CJK Radicals Supplement"](ze)||at["CJK Strokes"](ze)||at["CJK Symbols and Punctuation"](ze)||at["CJK Unified Ideographs Extension A"](ze)||at["CJK Unified Ideographs"](ze)||at["Enclosed CJK Letters and Months"](ze)||at["Halfwidth and Fullwidth Forms"](ze)||at.Hiragana(ze)||at["Ideographic Description Characters"](ze)||at["Kangxi Radicals"](ze)||at["Katakana Phonetic Extensions"](ze)||at.Katakana(ze)||at["Vertical Forms"](ze)||at["Yi Radicals"](ze)||at["Yi Syllables"](ze)));(cw[ot]||Tt||pt.imageName)&&Ve.push(e0(rt+1,Qe,Ue,Ve,hw(ot,ue.getCharCode(rt+1),Tt&&$e),!1))}}var ze;return t0(e0(ue.length(),Qe,Ue,Ve,0,!0))}(V,E,f,e,l,O),{processBidirectionalText:le,processStyledBidirectionalText:te}=S;if(le&&V.sections.length===1){const ue=le(V.toString(),ee);for(const Ie of ue){const Me=new Fl;Me.text=Ie,Me.sections=V.sections;for(let Be=0;Be<Ie.length;Be++)Me.sectionIndex.push(0);Z.push(Me)}}else if(te){const ue=te(V.text,V.sectionIndex,ee);for(const Ie of ue){const Me=new Fl;Me.text=Ie[0],Me.sectionIndex=Ie[1],Me.sections=V.sections,Z.push(Me)}}else Z=function(ue,Ie){const Me=[],Be=ue.text;let He=0;for(const Pe of Ie)Me.push(ue.substring(He,Pe)),He=Pe;return He<Be.length&&Me.push(ue.substring(He,Be.length)),Me}(V,ee);const oe=[],de={positionedLines:oe,text:V.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ue,Ie,Me,Be,He,Pe,Ve,Ue,$e,Qe,ze,rt){let pt=0,ot=0,Tt=0;const et=Ue==="right"?1:Ue==="left"?0:.5;let gt=!1;for(const It of He){const Ct=It.getSections();for(const ai of Ct){if(ai.imageName)continue;const ui=Ie[ai.fontStack];if(ui&&(gt=ui.ascender!==void 0&&ui.descender!==void 0,!gt))break}if(!gt)break}let Et=0;for(const It of He){It.trim();const Ct=It.getMaxScale(),ai=(Ct-1)*ln,ui={positionedGlyphs:[],lineOffset:0};ue.positionedLines[Et]=ui;const di=ui.positionedGlyphs;let li=0;if(!It.length()){ot+=Pe,++Et;continue}let Si=0,Di=0;for(let ci=0;ci<It.length();ci++){const Xi=It.getSection(ci),qi=It.getSectionIndex(ci),Ai=It.getCharCode(ci);let Zt=Xi.scale,Wi=null,pi=null,In=null,Zi=ln,cn=0;const sn=!($e===rs.horizontal||!ze&&!Kc(Ai)||ze&&(Sd[Ai]||(qt=Ai,at.Arabic(qt)||at["Arabic Supplement"](qt)||at["Arabic Extended-A"](qt)||at["Arabic Presentation Forms-A"](qt)||at["Arabic Presentation Forms-B"](qt))));if(Xi.imageName){const Cn=Be[Xi.imageName];if(!Cn)continue;In=Xi.imageName,ue.iconsInText=ue.iconsInText||!0,pi=Cn.paddedRect;const rn=Cn.displaySize;Zt=Zt*ln/rt,Wi={width:rn[0],height:rn[1],left:Fn,top:-Xg,advance:sn?rn[1]:rn[0],localGlyph:!1},cn=gt?-Wi.height*Zt:Kg+Ct*ln-rn[1]*Zt,Zi=Wi.advance;const qs=(sn?rn[0]:rn[1])*Zt-ln*Ct;qs>0&&qs>li&&(li=qs)}else{const Cn=Me[Xi.fontStack];if(!Cn)continue;Cn[Ai]&&(pi=Cn[Ai]);const rn=Ie[Xi.fontStack];if(!rn)continue;const qs=rn.glyphs[Ai];if(!qs)continue;if(Wi=qs.metrics,Zi=Ai!==8203?ln:0,gt){const ql=rn.ascender!==void 0?Math.abs(rn.ascender):0,zh=rn.descender!==void 0?Math.abs(rn.descender):0,Rh=(ql+zh)*Zt;Si<Rh&&(Si=Rh,Di=(ql-zh)/2*Zt),cn=-ql*Zt}else cn=Kg+(Ct-Zt)*ln}sn?(ue.verticalizable=!0,di.push({glyph:Ai,imageName:In,x:pt,y:ot+cn,vertical:sn,scale:Zt,localGlyph:Wi.localGlyph,fontStack:Xi.fontStack,sectionIndex:qi,metrics:Wi,rect:pi}),pt+=Zi*Zt+Qe):(di.push({glyph:Ai,imageName:In,x:pt,y:ot+cn,vertical:sn,scale:Zt,localGlyph:Wi.localGlyph,fontStack:Xi.fontStack,sectionIndex:qi,metrics:Wi,rect:pi}),pt+=Wi.advance*Zt+Qe)}di.length!==0&&(Tt=Math.max(pt-Qe,Tt),gt?i0(di,et,li,Di,Pe*Ct/2):i0(di,et,li,0,Pe/2)),pt=0;const $i=Pe*Ct+li;ui.lineOffset=Math.max(li,ai),ot+=$i,++Et}var qt;const Mt=ot,{horizontalAlign:vt,verticalAlign:fi}=Hf(Ve);(function(It,Ct,ai,ui,di,li){const Si=(Ct-ai)*di,Di=-li*ui;for(const $i of It)for(const ci of $i.positionedGlyphs)ci.x+=Si,ci.y+=Di})(ue.positionedLines,et,vt,fi,Tt,Mt),ue.top+=-fi*Mt,ue.bottom=ue.top+Mt,ue.left+=-vt*Tt,ue.right=ue.left+Tt,ue.hasBaseline=gt}(de,e,i,l,Z,m,x,w,k,E,L,B),!function(ue){for(const Ie of ue)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(oe)&&de}const Sd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},cw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Jg(t,e,i,l,u,f){if(e.imageName){const m=l[e.imageName];return m?m.displaySize[0]*e.scale*ln/f+u:0}{const m=i[e.fontStack],x=m&&m.glyphs[t];return x?x.metrics.advance*e.scale+u:0}}function Qg(t,e,i,l){const u=Math.pow(t-e,2);return l?t<e?u/2:2*u:u+Math.abs(i)*i}function hw(t,e,i){let l=0;return t===10&&(l-=1e4),i&&(l+=150),t!==40&&t!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function e0(t,e,i,l,u,f){let m=null,x=Qg(e,i,u,f);for(const w of l){const E=Qg(e-w.x,i,u,f)+w.badness;E<=x&&(m=w,x=E)}return{index:t,x:e,priorBreak:m,badness:x}}function t0(t){return t?t0(t.priorBreak).concat(t.index):[]}function Hf(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function i0(t,e,i,l,u){if(!(e||i||l||u))return;const f=t.length-1,m=t[f],x=(m.x+m.metrics.advance*m.scale)*e;for(let w=0;w<=f;w++)t[w].x-=x,t[w].y+=i+l+u}function uw(t,e,i){const{horizontalAlign:l,verticalAlign:u}=Hf(i),f=e[0]-t.displaySize[0]*l,m=e[1]-t.displaySize[1]*u;return{image:t,top:m,bottom:m+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function n0(t,e,i,l,u,f){const m=t.image;let x;if(m.content){const Z=m.content,ee=m.pixelRatio||1;x=[Z[0]/ee,Z[1]/ee,m.displaySize[0]-Z[2]/ee,m.displaySize[1]-Z[3]/ee]}const w=e.left*f,E=e.right*f;let A,k,L,O;i==="width"||i==="both"?(O=u[0]+w-l[3],k=u[0]+E+l[1]):(O=u[0]+(w+E-m.displaySize[0])/2,k=O+m.displaySize[0]);const B=e.top*f,V=e.bottom*f;return i==="height"||i==="both"?(A=u[1]+B-l[0],L=u[1]+V+l[2]):(A=u[1]+(B+V-m.displaySize[1])/2,L=A+m.displaySize[1]),{image:m,top:A,right:k,bottom:L,left:O,collisionPadding:x}}class Dr extends De{constructor(e,i,l,u,f){super(e,i),this.angle=u,this.z=l,f!==void 0&&(this.segment=f)}clone(){return new Dr(this.x,this.y,this.z,this.angle,this.segment)}}function s0(t,e,i,l,u){if(e.segment===void 0)return!0;let f=e,m=e.segment+1,x=0;for(;x>-i/2;){if(m--,m<0)return!1;x-=t[m].dist(f),f=t[m]}x+=t[m].dist(t[m+1]),m++;const w=[];let E=0;for(;x<i/2;){const A=t[m],k=t[m+1];if(!k)return!1;let L=t[m-1].angleTo(A)-A.angleTo(k);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:L}),E+=L;x-w[0].distance>l;)E-=w.shift().angleDelta;if(E>u)return!1;m++,x+=A.dist(k)}return!0}function r0(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function o0(t,e,i){return t?.6*e*i:0}function a0(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function dw(t,e,i,l,u,f){const m=o0(i,u,f),x=a0(i,l)*f;let w=0;const E=r0(t)/2;for(let A=0;A<t.length-1;A++){const k=t[A],L=t[A+1],O=k.dist(L);if(w+O>E){const B=(E-w)/O,V=Ut(k.x,L.x,B),Z=Ut(k.y,L.y,B),ee=new Dr(V,Z,0,L.angleTo(k),A);return!m||s0(t,ee,x,m,e)?ee:void 0}w+=O}}function pw(t,e,i,l,u,f,m,x,w){const E=o0(l,f,m),A=a0(l,u),k=A*m,L=t[0].x===0||t[0].x===w||t[0].y===0||t[0].y===w;return e-k<e/4&&(e=k+e/4),l0(t,L?e/2*x%e:(A/2+2*f)*m*x%e,e,E,i,k,L,!1,w)}function l0(t,e,i,l,u,f,m,x,w){const E=f/2,A=r0(t);let k=0,L=e-i,O=[];for(let B=0;B<t.length-1;B++){const V=t[B],Z=t[B+1],ee=V.dist(Z),le=Z.angleTo(V);for(;L+i<k+ee;){L+=i;const te=(L-k)/ee,oe=Ut(V.x,Z.x,te),de=Ut(V.y,Z.y,te);if(oe>=0&&oe<w&&de>=0&&de<w&&L-E>=0&&L+E<=A){const ue=new Dr(oe,de,0,le,B);ue._round(),l&&!s0(t,ue,f,l,u)||O.push(ue)}}k+=ee}return x||O.length||m||(O=l0(t,k/2,i,l,u,f,m,!0,w)),O}function c0(t,e,i,l,u){const f=[];for(let m=0;m<t.length;m++){const x=t[m];let w;for(let E=0;E<x.length-1;E++){let A=x[E],k=x[E+1];A.x<e&&k.x<e||(A.x<e?A=new De(e,A.y+(e-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<e&&(k=new De(e,A.y+(e-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<i&&k.y<i||(A.y<i?A=new De(A.x+(i-A.y)/(k.y-A.y)*(k.x-A.x),i)._round():k.y<i&&(k=new De(A.x+(i-A.y)/(k.y-A.y)*(k.x-A.x),i)._round()),A.x>=l&&k.x>=l||(A.x>=l?A=new De(l,A.y+(l-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=l&&(k=new De(l,A.y+(l-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=u&&k.y>=u||(A.y>=u?A=new De(A.x+(u-A.y)/(k.y-A.y)*(k.x-A.x),u)._round():k.y>=u&&(k=new De(A.x+(u-A.y)/(k.y-A.y)*(k.x-A.x),u)._round()),w&&A.equals(w[w.length-1])||(w=[A],f.push(w)),w.push(k)))))}}return f}ut(Dr,"Anchor");const Mh=1e20;function h0(t,e,i,l,u,f,m,x,w){for(let E=e;E<e+l;E++)u0(t,i*f+E,f,u,m,x,w);for(let E=i;E<i+u;E++)u0(t,E*f+e,1,l,m,x,w)}function u0(t,e,i,l,u,f,m){f[0]=0,m[0]=-Mh,m[1]=Mh,u[0]=t[e];for(let x=1,w=0,E=0;x<l;x++){u[x]=t[e+x*i];const A=x*x;do{const k=f[w];E=(u[x]-u[k]+A-k*k)/(x-k)/2}while(E<=m[w]&&--w>-1);w++,f[w]=x,m[w]=E,m[w+1]=Mh}for(let x=0,w=0;x<l;x++){for(;m[w+1]<x;)w++;const E=f[w],A=x-E;t[e+x*i]=u[E]+A*A}}const Gs=2,Xf={none:0,ideographs:1,all:2};class Nl{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[];for(const u in e)for(const f of e[u])l.push({stack:u,id:f});ki(l,({stack:u,id:f},m)=>{let x=this.entries[u];x||(x=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[f];if(w!==void 0)return void m(null,{stack:u,id:f,glyph:w});if(w=this._tinySDF(x,u,f),w)return x.glyphs[f]=w,void m(null,{stack:u,id:f,glyph:w});const E=Math.floor(f/256);if(256*E>65535)return void m(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void m(null,{stack:u,id:f,glyph:w});let A=x.requests[E];A||(A=x.requests[E]=[],Nl.loadGlyphRange(u,E,this.url,this.requestManager,(k,L)=>{if(L){x.ascender=L.ascender,x.descender=L.descender;for(const O in L.glyphs)this._doesCharSupportLocalGlyph(+O)||(x.glyphs[+O]=L.glyphs[+O]);x.ranges[E]=!0}for(const O of A)O(k,L);delete x.requests[E]})),A.push((k,L)=>{k?m(k):L&&m(null,{stack:u,id:f,glyph:L.glyphs[f]||null})})},(u,f)=>{if(u)i(u);else if(f){const m={};for(const{stack:x,id:w,glyph:E}of f)m[x]===void 0&&(m[x]={}),m[x].glyphs===void 0&&(m[x].glyphs={}),m[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},m[x].ascender=this.entries[x].ascender,m[x].descender=this.entries[x].descender;i(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Xf.none&&(this.localGlyphMode===Xf.all?!!this.localFontFamily:!!this.localFontFamily&&(at["CJK Unified Ideographs"](e)||at["Hangul Syllables"](e)||at.Hiragana(e)||at.Katakana(e)||at["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,l){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(l))return;let f=e.tinySDF;if(!f){let V="400";/bold/i.test(i)?V="900":/medium/i.test(i)?V="500":/light/i.test(i)&&(V="200"),f=e.tinySDF=new Nl.TinySDF({fontFamily:u,fontWeight:V,fontSize:24*Gs,buffer:3*Gs,radius:8*Gs}),f.fontWeight=V}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const m=String.fromCharCode(l),{data:x,width:w,height:E,glyphWidth:A,glyphHeight:k,glyphLeft:L,glyphTop:O,glyphAdvance:B}=f.draw(m);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new kr({width:w,height:E},x),metrics:{width:A/Gs,height:k/Gs,left:L/Gs,top:O/Gs-27,advance:B/Gs,localGlyph:!0}}}}Nl.loadGlyphRange=function(t,e,i,l,u){const f=256*e,m=f+255,x=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${f}-${m}`),pr.Glyphs);Wr(x,(w,E)=>{if(w)u(w);else if(E){const A={},k=function(L){return new Md(L).readFields(ow,{})}(E);for(const L of k.glyphs)A[L.id]=L;u(null,{glyphs:A,ascender:k.ascender,descender:k.descender})}})},Nl.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=i;const x=this.size=t+4*e,w=this._createCanvas(x),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${f} ${t}px ${u}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(t),m=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),w=Math.min(this.size-this.buffer,m+Math.ceil(l)),E=x+2*this.buffer,A=w+2*this.buffer,k=Math.max(E*A,0),L=new Uint8ClampedArray(k),O={data:L,width:E,height:A,glyphWidth:x,glyphHeight:w,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(x===0||w===0)return O;const{ctx:B,buffer:V,gridInner:Z,gridOuter:ee}=this;B.clearRect(V,V,x,w),B.fillText(t,V,V+m);const le=B.getImageData(V,V,x,w);ee.fill(Mh,0,k),Z.fill(0,0,k);for(let te=0;te<w;te++)for(let oe=0;oe<x;oe++){const de=le.data[4*(te*x+oe)+3]/255;if(de===0)continue;const ue=(te+V)*E+oe+V;if(de===1)ee[ue]=0,Z[ue]=Mh;else{const Ie=.5-de;ee[ue]=Ie>0?Ie*Ie:0,Z[ue]=Ie<0?Ie*Ie:0}}h0(ee,0,0,E,A,E,this.f,this.v,this.z),h0(Z,V,V,x,w,E,this.f,this.v,this.z);for(let te=0;te<k;te++){const oe=Math.sqrt(ee[te])-Math.sqrt(Z[te]);L[te]=Math.round(255-255*(oe/this.radius+this.cutoff))}return O}};const jl=Fn;function d0(t,e,i,l){const u=[],f=t.image,m=f.pixelRatio,x=f.paddedRect.w-2*jl,w=f.paddedRect.h-2*jl,E=t.right-t.left,A=t.bottom-t.top,k=f.stretchX||[[0,x]],L=f.stretchY||[[0,w]],O=(Pe,Ve)=>Pe+Ve[1]-Ve[0],B=k.reduce(O,0),V=L.reduce(O,0),Z=x-B,ee=w-V;let le=0,te=B,oe=0,de=V,ue=0,Ie=Z,Me=0,Be=ee;if(f.content&&l){const Pe=f.content;le=Ad(k,0,Pe[0]),oe=Ad(L,0,Pe[1]),te=Ad(k,Pe[0],Pe[2]),de=Ad(L,Pe[1],Pe[3]),ue=Pe[0]-le,Me=Pe[1]-oe,Ie=Pe[2]-Pe[0]-te,Be=Pe[3]-Pe[1]-de}const He=(Pe,Ve,Ue,$e)=>{const Qe=Id(Pe.stretch-le,te,E,t.left),ze=Cd(Pe.fixed-ue,Ie,Pe.stretch,B),rt=Id(Ve.stretch-oe,de,A,t.top),pt=Cd(Ve.fixed-Me,Be,Ve.stretch,V),ot=Id(Ue.stretch-le,te,E,t.left),Tt=Cd(Ue.fixed-ue,Ie,Ue.stretch,B),et=Id($e.stretch-oe,de,A,t.top),gt=Cd($e.fixed-Me,Be,$e.stretch,V),Et=new De(Qe,rt),qt=new De(ot,rt),Mt=new De(ot,et),vt=new De(Qe,et),fi=new De(ze/m,pt/m),It=new De(Tt/m,gt/m),Ct=e*Math.PI/180;if(Ct){const di=Math.sin(Ct),li=Math.cos(Ct),Si=[li,-di,di,li];Et._matMult(Si),qt._matMult(Si),vt._matMult(Si),Mt._matMult(Si)}const ai=Pe.stretch+Pe.fixed,ui=Ve.stretch+Ve.fixed;return{tl:Et,tr:qt,bl:vt,br:Mt,tex:{x:f.paddedRect.x+jl+ai,y:f.paddedRect.y+jl+ui,w:Ue.stretch+Ue.fixed-ai,h:$e.stretch+$e.fixed-ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:It,minFontScaleX:Ie/m/E,minFontScaleY:Be/m/A,isSDF:i}};if(l&&(f.stretchX||f.stretchY)){const Pe=p0(k,Z,B),Ve=p0(L,ee,V);for(let Ue=0;Ue<Pe.length-1;Ue++){const $e=Pe[Ue],Qe=Pe[Ue+1];for(let ze=0;ze<Ve.length-1;ze++)u.push(He($e,Ve[ze],Qe,Ve[ze+1]))}}else u.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return u}function Ad(t,e,i){let l=0;for(const u of t)l+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return l}function p0(t,e,i){const l=[{fixed:-jl,stretch:0}];for(const[u,f]of t){const m=l[l.length-1];l.push({fixed:u-m.stretch,stretch:m.stretch}),l.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return l.push({fixed:e+jl,stretch:i}),l}function Id(t,e,i,l){return t/e*i+l}function Cd(t,e,i,l){return t-e*i/l}function fw(t,e,i,l){const u=e+t.positionedLines[l].lineOffset;return l===0?i+u/2:i+(u+(e+t.positionedLines[l-1].lineOffset))/2}class _w{constructor(e=[],i=mw){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,u=i[e];for(;e>0;){const f=e-1>>1,m=i[f];if(l(u,m)>=0)break;i[e]=m,e=f}i[e]=u}_down(e){const{data:i,compare:l}=this,u=this.length>>1,f=i[e];for(;e<u;){let m=1+(e<<1),x=i[m];const w=m+1;if(w<this.length&&l(i[w],x)<0&&(m=w,x=i[w]),l(x,f)>=0)break;i[e]=x,e=m}i[e]=f}}function mw(t,e){return t<e?-1:t>e?1:0}function gw(t,e=1,i=!1){let l=1/0,u=1/0,f=-1/0,m=-1/0;const x=t[0];for(let O=0;O<x.length;O++){const B=x[O];(!O||B.x<l)&&(l=B.x),(!O||B.y<u)&&(u=B.y),(!O||B.x>f)&&(f=B.x),(!O||B.y>m)&&(m=B.y)}const w=Math.min(f-l,m-u);let E=w/2;const A=new _w([],yw);if(w===0)return new De(l,u);for(let O=l;O<f;O+=w)for(let B=u;B<m;B+=w)A.push(new Vl(O+E,B+E,E,t));let k=function(O){let B=0,V=0,Z=0;const ee=O[0];for(let le=0,te=ee.length,oe=te-1;le<te;oe=le++){const de=ee[le],ue=ee[oe],Ie=de.x*ue.y-ue.x*de.y;V+=(de.x+ue.x)*Ie,Z+=(de.y+ue.y)*Ie,B+=3*Ie}return new Vl(V/B,Z/B,0,O)}(t),L=A.length;for(;A.length;){const O=A.pop();(O.d>k.d||!k.d)&&(k=O,i&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,L)),O.max-k.d<=e||(E=O.h/2,A.push(new Vl(O.p.x-E,O.p.y-E,E,t)),A.push(new Vl(O.p.x+E,O.p.y-E,E,t)),A.push(new Vl(O.p.x-E,O.p.y+E,E,t)),A.push(new Vl(O.p.x+E,O.p.y+E,E,t)),L+=4)}return i&&(console.log(`num probes: ${L}`),console.log(`best distance: ${k.d}`)),k.p}function yw(t,e){return e.max-t.max}class Vl{constructor(e,i,l,u){this.p=new De(e,i),this.h=l,this.d=function(f,m){let x=!1,w=1/0;for(let E=0;E<m.length;E++){const A=m[E];for(let k=0,L=A.length,O=L-1;k<L;O=k++){const B=A[k],V=A[O];B.y>f.y!=V.y>f.y&&f.x<(V.x-B.x)*(f.y-B.y)/(V.y-B.y)+B.x&&(x=!x),w=Math.min(w,lg(f,B,V))}}return(x?1:-1)*Math.sqrt(w)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Ul=7,Yf=Number.POSITIVE_INFINITY,xw=Math.sqrt(2);function f0(t,[e,i]){let l=0,u=0;if(i===Yf){e<0&&(e=0);const f=e/xw;switch(t){case"top-right":case"top-left":u=f-Ul;break;case"bottom-right":case"bottom-left":u=-f+Ul;break;case"bottom":u=-e+Ul;break;case"top":u=e-Ul}switch(t){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":u=i-Ul;break;case"bottom-right":case"bottom-left":case"bottom":u=-i+Ul}switch(t){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,u]}function vw(t,e,i,l,u,f,m,x,w,E){t.createArrays(),t.tilePixelRatio=yt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,k=t.layers[0]._unevaluatedLayout._values,L={};if(t.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:Z}=t.textSizeData;L.compositeTextSizes=[k["text-size"].possiblyEvaluate(new P(V),x),k["text-size"].possiblyEvaluate(new P(Z),x)]}if(t.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:Z}=t.iconSizeData;L.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new P(V),x),k["icon-size"].possiblyEvaluate(new P(Z),x)]}L.layoutTextSize=k["text-size"].possiblyEvaluate(new P(w+1),x),L.layoutIconSize=k["icon-size"].possiblyEvaluate(new P(w+1),x),L.textMaxSize=k["text-size"].possiblyEvaluate(new P(18),x);const O=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size");for(const V of t.features){const Z=A.get("text-font").evaluate(V,{},x).join(","),ee=B.evaluate(V,{},x),le=L.layoutTextSize.evaluate(V,{},x),te=(L.layoutIconSize.evaluate(V,{},x),{horizontal:{},vertical:void 0}),oe=V.text;let de,ue=[0,0];if(oe){const Be=oe.toString(),He=A.get("text-letter-spacing").evaluate(V,{},x)*ln,Pe=A.get("text-line-height").evaluate(V,{},x)*ln,Ve=rf(Be)?He:0,Ue=A.get("text-anchor").evaluate(V,{},x),$e=A.get("text-variable-anchor");if(!$e){const ot=A.get("text-radial-offset").evaluate(V,{},x);ue=ot?f0(Ue,[ot*ln,Yf]):A.get("text-offset").evaluate(V,{},x).map(Tt=>Tt*ln)}let Qe=O?"center":A.get("text-justify").evaluate(V,{},x);const ze=A.get("symbol-placement")==="point",rt=ze?A.get("text-max-width").evaluate(V,{},x)*ln:1/0,pt=ot=>{t.allowVerticalPlacement&&Yc(Be)&&(te.vertical=Zf(oe,e,i,u,Z,rt,Pe,Ue,ot,Ve,ue,rs.vertical,!0,le,ee))};if(!O&&$e){const ot=Qe==="auto"?$e.map(et=>Kf(et)):[Qe];let Tt=!1;for(let et=0;et<ot.length;et++){const gt=ot[et];if(!te.horizontal[gt])if(Tt)te.horizontal[gt]=te.horizontal[0];else{const Et=Zf(oe,e,i,u,Z,rt,Pe,"center",gt,Ve,ue,rs.horizontal,!1,le,ee);Et&&(te.horizontal[gt]=Et,Tt=Et.positionedLines.length===1)}}pt("left")}else{if(Qe==="auto"&&(Qe=Kf(Ue)),ze||A.get("text-writing-mode").indexOf("horizontal")>=0||!Yc(Be)){const ot=Zf(oe,e,i,u,Z,rt,Pe,Ue,Qe,Ve,ue,rs.horizontal,!1,le,ee);ot&&(te.horizontal[Qe]=ot)}pt(ze?"left":Qe)}}let Ie=!1;if(V.icon&&V.icon.name){const Be=l[V.icon.name];Be&&(de=uw(u[V.icon.name],A.get("icon-offset").evaluate(V,{},x),A.get("icon-anchor").evaluate(V,{},x)),Ie=Be.sdf,t.sdfIcons===void 0?t.sdfIcons=Be.sdf:t.sdfIcons!==Be.sdf&&Ei("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Me=m0(te.horizontal)||te.vertical;t.iconsInText||(t.iconsInText=!!Me&&Me.iconsInText),(Me||de)&&bw(t,V,te,de,l,L,le,0,ue,Ie,m,x,E)}f&&t.generateCollisionDebugBuffers(w,t.collisionBoxArray)}function Kf(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function bw(t,e,i,l,u,f,m,x,w,E,A,k,L){let O=f.textMaxSize.evaluate(e,{},k);O===void 0&&(O=m);const B=t.layers[0].layout,V=B.get("icon-offset").evaluate(e,{},k),Z=m0(i.horizontal)||i.vertical,ee=L.name==="globe",le=ln,te=m/le,oe=t.tilePixelRatio*O/le,de=(Ue=t.overscaling,t.zoom>18&&Ue>2&&(Ue>>=1),Math.max(yt/(512*Ue),1)*B.get("symbol-spacing")),ue=B.get("text-padding")*t.tilePixelRatio,Ie=B.get("icon-padding")*t.tilePixelRatio,Me=ft(B.get("text-max-angle")),Be=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",He=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Pe=B.get("symbol-placement"),Ve=de/2;var Ue;const $e=B.get("icon-text-fit");let Qe;l&&$e!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(Qe=n0(l,i.vertical,$e,B.get("icon-text-fit-padding"),V,te)),Z&&(l=n0(l,Z,$e,B.get("icon-text-fit-padding"),V,te)));const ze=(rt,pt,ot)=>{if(pt.x<0||pt.x>=yt||pt.y<0||pt.y>=yt)return;let Tt=null;if(ee){const{x:et,y:gt,z:Et}=L.projectTilePoint(pt.x,pt.y,ot);Tt={anchor:new Dr(et,gt,Et,0,void 0),up:L.upVector(ot,pt.x,pt.y)}}(function(et,gt,Et,qt,Mt,vt,fi,It,Ct,ai,ui,di,li,Si,Di,$i,ci,Xi,qi,Ai,Zt,Wi,pi,In,Zi){const cn=et.addToLineVertexArray(gt,qt);let sn,Cn,rn,qs,ql,zh,Rh,X0=0,Y0=0,K0=0,J0=0,d_=-1,p_=-1;const ar={};let Q0=lf("");const Ia=Et?Et.anchor:gt;let f_=0,__=0;if(Ct._unevaluatedLayout.getValue("text-radial-offset")===void 0?[f_,__]=Ct.layout.get("text-offset").evaluate(Zt,{},Zi).map(Xn=>Xn*ln):(f_=Ct.layout.get("text-radial-offset").evaluate(Zt,{},Zi)*ln,__=Yf),et.allowVerticalPlacement&&Mt.vertical){const Xn=Mt.vertical;if(Di)zh=Jf(Xn),It&&(Rh=Jf(It));else{const Yn=Ct.layout.get("text-rotate").evaluate(Zt,{},Zi)+90;rn=Pd(ai,Ia,gt,ui,di,li,Xn,Si,Yn,$i),It&&(qs=Pd(ai,Ia,gt,ui,di,li,It,Xi,Yn))}}if(vt){const Xn=Ct.layout.get("icon-rotate").evaluate(Zt,{},Zi),Yn=Ct.layout.get("icon-text-fit")!=="none",Oh=d0(vt,Xn,pi,Yn),g_=It?d0(It,Xn,pi,Yn):void 0;Cn=Pd(ai,Ia,gt,ui,di,li,vt,Xi,Xn),X0=4*Oh.length;const ey=et.iconSizeData;let Ca=null;ey.kind==="source"?(Ca=[Us*Ct.layout.get("icon-size").evaluate(Zt,{},Zi)],Ca[0]>go&&Ei(`${et.layerIds[0]}: Value for "icon-size" is >= ${Sh}. Reduce your "icon-size".`)):ey.kind==="composite"&&(Ca=[Us*Wi.compositeIconSizes[0].evaluate(Zt,{},Zi),Us*Wi.compositeIconSizes[1].evaluate(Zt,{},Zi)],(Ca[0]>go||Ca[1]>go)&&Ei(`${et.layerIds[0]}: Value for "icon-size" is >= ${Sh}. Reduce your "icon-size".`)),et.addSymbols(et.icon,Oh,Ca,Ai,qi,Zt,!1,Et,gt,cn.lineStartIndex,cn.lineLength,-1,In,Zi),d_=et.icon.placedSymbolArray.length-1,g_&&(Y0=4*g_.length,et.addSymbols(et.icon,g_,Ca,Ai,qi,Zt,rs.vertical,Et,gt,cn.lineStartIndex,cn.lineLength,-1,In,Zi),p_=et.icon.placedSymbolArray.length-1)}for(const Xn in Mt.horizontal){const Yn=Mt.horizontal[Xn];sn||(Q0=lf(Yn.text),Di?ql=Jf(Yn):sn=Pd(ai,Ia,gt,ui,di,li,Yn,Si,Ct.layout.get("text-rotate").evaluate(Zt,{},Zi),$i));const Oh=Yn.positionedLines.length===1;if(K0+=_0(et,Et,gt,Yn,fi,Ct,Di,Zt,$i,cn,Mt.vertical?rs.horizontal:rs.horizontalOnly,Oh?Object.keys(Mt.horizontal):[Xn],ar,d_,Wi,In,Zi),Oh)break}Mt.vertical&&(J0+=_0(et,Et,gt,Mt.vertical,fi,Ct,Di,Zt,$i,cn,rs.vertical,["vertical"],ar,p_,Wi,In,Zi));let To=-1;const m_=(Xn,Yn)=>Xn?Math.max(Xn,Yn):Yn;To=m_(ql,To),To=m_(zh,To),To=m_(Rh,To);const Xw=To>-1?1:0;et.glyphOffsetArray.length>=xo.MAX_GLYPHS&&Ei("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,Zt.sortKey),et.symbolInstances.emplaceBack(Ia.x,Ia.y,Ia.z,gt.x,gt.y,ar.right>=0?ar.right:-1,ar.center>=0?ar.center:-1,ar.left>=0?ar.left:-1,ar.vertical>=0?ar.vertical:-1,d_,p_,Q0,sn!==void 0?sn:et.collisionBoxArray.length,sn!==void 0?sn+1:et.collisionBoxArray.length,rn!==void 0?rn:et.collisionBoxArray.length,rn!==void 0?rn+1:et.collisionBoxArray.length,Cn!==void 0?Cn:et.collisionBoxArray.length,Cn!==void 0?Cn+1:et.collisionBoxArray.length,qs||et.collisionBoxArray.length,qs?qs+1:et.collisionBoxArray.length,ui,K0,J0,X0,Y0,Xw,0,f_,__,To)})(t,pt,Tt,rt,i,l,u,Qe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ue,Be,w,0,Ie,He,V,e,f,E,A,k)};if(Pe==="line")for(const rt of c0(e.geometry,0,0,yt,yt)){const pt=pw(rt,de,Me,i.vertical||Z,l,le,oe,t.overscaling,yt);for(const ot of pt)Z&&ww(t,Z.text,Ve,ot)||ze(rt,ot,k)}else if(Pe==="line-center"){for(const rt of e.geometry)if(rt.length>1){const pt=dw(rt,Me,i.vertical||Z,l,le,oe);pt&&ze(rt,pt,k)}}else if(e.type==="Polygon")for(const rt of Ff(e.geometry,0)){const pt=gw(rt,16);ze(rt[0],new Dr(pt.x,pt.y,0,0,void 0),k)}else if(e.type==="LineString")for(const rt of e.geometry)ze(rt,new Dr(rt[0].x,rt[0].y,0,0,void 0),k);else if(e.type==="Point")for(const rt of e.geometry)for(const pt of rt)ze([pt],new Dr(pt.x,pt.y,0,0,void 0),k)}const Sh=255,go=Sh*Us;function _0(t,e,i,l,u,f,m,x,w,E,A,k,L,O,B,V,Z){const ee=function(oe,de,ue,Ie,Me,Be,He,Pe){const Ve=[];if(de.positionedLines.length===0)return Ve;const Ue=Ie.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,$e=function(ot){const Tt=ot[0],et=ot[1],gt=Tt*et;return gt>0?[Tt,-et]:gt<0?[-Tt,et]:Tt===0?[et,Tt]:[et,-Tt]}(ue);let Qe=Math.abs(de.top-de.bottom);for(const ot of de.positionedLines)Qe-=ot.lineOffset;const ze=de.positionedLines.length,rt=Qe/ze;let pt=de.top-ue[1];for(let ot=0;ot<ze;++ot){const Tt=de.positionedLines[ot];pt=fw(de,rt,pt,ot);for(const et of Tt.positionedGlyphs){if(!et.rect)continue;const gt=et.rect||{};let Et=Xg+1,qt=!0,Mt=1,vt=0;if(et.imageName){const pi=He[et.imageName];if(!pi)continue;if(pi.sdf){Ei("SDF images are not supported in formatted text and will be ignored.");continue}qt=!1,Mt=pi.pixelRatio,Et=Fn/Mt}const fi=(Me||Pe)&&et.vertical,It=et.metrics.advance*et.scale/2,Ct=et.metrics,ai=et.rect;if(ai===null)continue;Pe&&de.verticalizable&&(vt=et.imageName?It-et.metrics.width*et.scale/2:0);const ui=Me?[et.x+It,et.y]:[0,0];let di=[0,0],li=[0,0],Si=!1;Me||(fi?(li=[et.x+It+$e[0],et.y+$e[1]-vt],Si=!0):di=[et.x+It+ue[0],et.y+ue[1]-vt]);const Di=ai.w*et.scale/(Mt*(et.localGlyph?Gs:1)),$i=ai.h*et.scale/(Mt*(et.localGlyph?Gs:1));let ci,Xi,qi,Ai;if(fi){const pi=et.y-pt,In=new De(-It,It-pi),Zi=-Math.PI/2,cn=new De(...li);ci=new De(-It+di[0],di[1]),ci._rotateAround(Zi,In)._add(cn),ci.x+=-pi+It,ci.y-=(Ct.left-Et)*et.scale;const sn=et.imageName?Ct.advance*et.scale:ln*et.scale,Cn=String.fromCharCode(et.glyph);Xb(Cn)?ci.x+=(1-Et)*et.scale:Yb(Cn)?ci.x+=sn-Ct.height*et.scale+(-Et-1)*et.scale:ci.x+=et.imageName||Ct.width+2*Et===ai.w&&Ct.height+2*Et===ai.h?(sn-$i)/2:(sn-(Ct.height+2*Et)*et.scale)/2,Xi=new De(ci.x,ci.y-Di),qi=new De(ci.x+$i,ci.y),Ai=new De(ci.x+$i,ci.y-Di)}else{const pi=(Ct.left-Et)*et.scale-It+di[0],In=(-Ct.top-Et)*et.scale+di[1],Zi=pi+Di,cn=In+$i;ci=new De(pi,In),Xi=new De(Zi,In),qi=new De(pi,cn),Ai=new De(Zi,cn)}if(Ue){let pi;pi=Me?new De(0,0):Si?new De($e[0],$e[1]):new De(ue[0],ue[1]),ci._rotateAround(Ue,pi),Xi._rotateAround(Ue,pi),qi._rotateAround(Ue,pi),Ai._rotateAround(Ue,pi)}const Zt=new De(0,0),Wi=new De(0,0);Ve.push({tl:ci,tr:Xi,bl:qi,br:Ai,tex:gt,writingMode:de.writingMode,glyphOffset:ui,sectionIndex:et.sectionIndex,isSDF:qt,pixelOffsetTL:Zt,pixelOffsetBR:Wi,minFontScaleX:0,minFontScaleY:0})}}return Ve}(0,l,w,f,m,x,u,t.allowVerticalPlacement),le=t.textSizeData;let te=null;le.kind==="source"?(te=[Us*f.layout.get("text-size").evaluate(x,{},Z)],te[0]>go&&Ei(`${t.layerIds[0]}: Value for "text-size" is >= ${Sh}. Reduce your "text-size".`)):le.kind==="composite"&&(te=[Us*B.compositeTextSizes[0].evaluate(x,{},Z),Us*B.compositeTextSizes[1].evaluate(x,{},Z)],(te[0]>go||te[1]>go)&&Ei(`${t.layerIds[0]}: Value for "text-size" is >= ${Sh}. Reduce your "text-size".`)),t.addSymbols(t.text,ee,te,w,m,x,A,e,i,E.lineStartIndex,E.lineLength,O,V,Z);for(const oe of k)L[oe]=t.text.placedSymbolArray.length-1;return 4*ee.length}function m0(t){for(const e in t)return t[e];return null}function Pd(t,e,i,l,u,f,m,x,w,E){let A=m.top,k=m.bottom,L=m.left,O=m.right;const B=m.collisionPadding;if(B&&(L-=B[0],A-=B[1],O+=B[2],k+=B[3]),w){const V=new De(L,A),Z=new De(O,A),ee=new De(L,k),le=new De(O,k),te=ft(w);let oe=new De(0,0);E&&(oe=new De(E[0],E[1])),V._rotateAround(te,oe),Z._rotateAround(te,oe),ee._rotateAround(te,oe),le._rotateAround(te,oe),L=Math.min(V.x,Z.x,ee.x,le.x),O=Math.max(V.x,Z.x,ee.x,le.x),A=Math.min(V.y,Z.y,ee.y,le.y),k=Math.max(V.y,Z.y,ee.y,le.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,L,A,O,k,x,l,u,f),t.length-1}function Jf(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function ww(t,e,i,l){const u=t.compareText;if(e in u){const f=u[e];for(let m=f.length-1;m>=0;m--)if(l.dist(f[m])<i)return!0}else u[e]=[];return u[e].push(l),!1}function g0(t,e){const i=t.fovAboveCenter,l=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-l)/Math.cos(t._pitch),f=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),m=Math.sin(t._pitch)*f+u;return Math.min(1.01*m,u*(1/t._horizonShift))}function Sa(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),l=t.x*i,u=(t.x+1)*i,f=t.y*i,m=(t.y+1)*i,x=ss(l),w=ss(u),E=fn(f),A=fn(m),k=e.project(x,E),L=e.project(w,E),O=e.project(w,A),B=e.project(x,A);let V=Math.min(k.x,L.x,O.x,B.x),Z=Math.min(k.y,L.y,O.y,B.y),ee=Math.max(k.x,L.x,O.x,B.x),le=Math.max(k.y,L.y,O.y,B.y);const te=i/16;function oe(ue,Ie,Me,Be,He,Pe){const Ve=(Me+He)/2,Ue=(Be+Pe)/2,$e=e.project(ss(Ve),fn(Ue)),Qe=Math.max(0,V-$e.x,Z-$e.y,$e.x-ee,$e.y-le);V=Math.min(V,$e.x),ee=Math.max(ee,$e.x),Z=Math.min(Z,$e.y),le=Math.max(le,$e.y),Qe>te&&(oe(ue,$e,Me,Be,Ve,Ue),oe($e,Ie,Ve,Ue,He,Pe))}oe(k,L,l,f,u,f),oe(L,O,u,f,u,m),oe(O,B,u,m,l,m),oe(B,k,l,m,l,f),V-=te,Z-=te,ee+=te,le+=te;const de=1/Math.max(ee-V,le-Z);return{scale:de,x:V*de,y:Z*de,x2:ee*de,y2:le*de,projection:e}}const Tw=Ns(new Float32Array(16));class yo{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new oi(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l=!0){return e._coordinatePoint(e.locationCoordinate(i),l)}pixelsPerMeter(e,i){return Vs(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return g0(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,u){const f=e.horizonLineFromTop(!1),m=new De(i,Math.max(f,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,i,l){const u=new De(i,l);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return Tw}createTileMatrix(e,i,l){let u,f,m;const x=l.canonical,w=Ns(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Sa(x,this);u=1,f=E.x+l.wrap*E.scale,m=E.y,xa(w,w,[u/E.scale,u/E.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(x.z),f=(x.x+Math.pow(2,x.z)*l.wrap)*u,m=x.y*u;return nh(w,w,[f,m,0]),xa(w,w,[u/yt,u/yt,1]),w}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class Ew extends yo{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(ft(i));this.n=(u+Math.sin(ft(l)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:u,r0:f}=this,m=ft(e-this.center[0]),x=ft(i),w=Math.sqrt(u-2*l*Math.sin(x))/l;return{x:w*Math.sin(m*l),y:w*Math.cos(m*l)-f,z:0}}unproject(e,i){const{n:l,c:u,r0:f}=this,m=f+i;let x=Math.atan2(e,Math.abs(m))*Math.sign(m);m*l<0&&(x-=Math.PI*Math.sign(e)*Math.sign(m));const w=ft(this.center[0])*l;x=vi(x,-Math.PI-w,Math.PI-w);const E=bt(Gt(x/l)+this.center[0],-180,180),A=Math.asin(bt((u-(e*e+m*m)*l*l)/(2*l),-1,1)),k=bt(Gt(A),-_n,_n);return new oi(E,k)}}const Ah=1.340264,Ih=-.081106,Ch=893e-6,Ph=.003796,kd=Math.sqrt(3)/2;class Mw extends yo{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(kd*Math.sin(i)),u=l*l,f=u*u*u;return{x:.5*(e*Math.cos(l)/(kd*(Ah+3*Ih*u+f*(7*Ch+9*Ph*u)))/Math.PI+.5),y:1-.5*(l*(Ah+Ih*u+f*(Ch+Ph*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,u=l*l,f=u*u*u;for(let A,k,L,O=0;O<12&&(k=l*(Ah+Ih*u+f*(Ch+Ph*u))-i,L=Ah+3*Ih*u+f*(7*Ch+9*Ph*u),A=k/L,l=bt(l-A,-Math.PI/3,Math.PI/3),u=l*l,f=u*u*u,!(Math.abs(A)<1e-12));++O);const m=kd*e*(Ah+3*Ih*u+f*(7*Ch+9*Ph*u))/Math.cos(l),x=Math.asin(Math.sin(l)/kd),w=bt(180*m/Math.PI,-180,180),E=bt(180*x/Math.PI,-_n,_n);return new oi(w,E)}}class Sw extends yo{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),u=bt(360*(.5-i),-_n,_n);return new oi(l,u)}}const Gl=Math.PI/2;function Ld(t){return Math.tan((Gl+t)/2)}class Aw extends yo{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let u=ft(i),f=ft(l);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const m=Math.cos(u),x=Ld(u);this.n=u===f?Math.sin(u):Math.log(m/Math.cos(f))/Math.log(Ld(f)/x),this.f=m*Math.pow(Ld(u),this.n)/this.n}project(e,i){i=ft(i),this.southernCenter&&(i=-i),e=ft(e-this.center[0]);const l=1e-6,{n:u,f}=this;f>0?i<-Gl+l&&(i=-Gl+l):i>Gl-l&&(i=Gl-l);const m=f/Math.pow(Ld(i),u);let x=m*Math.sin(u*e),w=f-m*Math.cos(u*e);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:u}=this,f=u-i,m=Math.sign(f),x=Math.sign(l)*Math.sqrt(e*e+f*f);let w=Math.atan2(e,Math.abs(f))*m;f*l<0&&(w-=Math.PI*Math.sign(e)*m);const E=bt(Gt(w/l)+this.center[0],-180,180),A=bt(Gt(2*Math.atan(Math.pow(u/x,1/l))-Gl),-_n,_n);return new oi(E,this.southernCenter?-A:A)}}class y0 extends yo{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ir(e),y:nr(i),z:0}}unproject(e,i){const l=ss(e),u=fn(i);return new oi(l,u)}}const x0=ft(_n);class Iw extends yo{project(e,i){const l=(i=ft(i))*i,u=l*l;return{x:.5*((e=ft(e))*(.8707-.131979*l+u*(u*(.003971*l-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+u*(.028874*l-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,u=25,f=0,m=l*l;do{m=l*l;const E=m*m;f=(l*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-i)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),l=bt(l-f,-x0,x0)}while(Math.abs(f)>1e-6&&--u>0);m=l*l;const x=bt(Gt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),w=Gt(l);return new oi(x,w)}}const v0=ft(_n);class Cw extends yo{project(e,i){i=ft(i),e=ft(e);const l=Math.cos(i),u=2/Math.PI,f=Math.acos(l*Math.cos(e/2)),m=Math.sin(f)/f,x=.5*(e*u+2*l*Math.sin(e/2)/m)||0,w=.5*(i+Math.sin(i)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,f=25;const m=1e-6;let x=0,w=0;do{const E=Math.cos(u),A=Math.sin(u),k=2*A*E,L=A*A,O=E*E,B=Math.cos(l/2),V=Math.sin(l/2),Z=2*B*V,ee=V*V,le=1-O*B*B,te=le?1/le:0,oe=le?Math.acos(E*B)*Math.sqrt(1/le):0,de=.5*(2*oe*E*V+2*l/Math.PI)-e,ue=.5*(oe*A+u)-i,Ie=.5*te*(O*ee+oe*E*B*L)+1/Math.PI,Me=te*(Z*k/4-oe*A*V),Be=.125*te*(k*V-oe*A*O*Z),He=.5*te*(L*B+oe*ee*E)+.5,Pe=Me*Be-He*Ie;x=(ue*Me-de*He)/Pe,w=(de*Be-ue*Ie)/Pe,l=bt(l-x,-Math.PI,Math.PI),u=bt(u-w,-v0,v0)}while((Math.abs(x)>m||Math.abs(w)>m)&&--f>0);return new oi(Gt(l),Gt(u))}}class b0 extends yo{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ft(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:u}=this;return{x:ft(e)*u*l+.5,y:-Math.sin(ft(i))/u*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:u}=this,f=-(i-.5)/l,m=bt(Gt((e-.5)/l)/u,-180,180),x=Math.asin(bt(f*u,-1,1)),w=bt(Gt(x),-_n,_n);return new oi(m,w)}}class Pw extends y0{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const u=uh(e,i,l);return Fi(u,u,dh(tr(l))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i){const l=Il(i.lat,i.lng),u=Mn([],l),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ah(l,l,u,Vs(1,0)*yt*f);const m=Ns(new Float64Array(16));return ya(m,e.pixelMatrix,e.globeMatrix),Fi(l,l,m),new De(l[0],l[1])}pixelsPerMeter(e,i){return Vs(1,0)*i}pixelSpaceConversion(e,i,l){const u=Vs(1,e)*i,f=Ut(Vs(1,45)*i,u,l);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,l){const u=wf(tr(l.canonical));return ya(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:l}=e,u=dh(tr(i));return od(u,u,ft(l.lng)),df(u,u,ft(l.lat)),xa(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,l,u){return Hm(e,i,l,!0)||new Pl(0,0)}pointCoordinate3D(e,i,l){const u=this.pointCoordinate(e,i,l,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!Hm(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,f){const m=u.cameraToCenterDistance,x=u._centerAltitude*f,w=u._camera,E=u._camera.forward(),A=Cr([],ns([],E,-m),[0,0,x]),k=u.worldSize/(2*Math.PI),L=[0,0,-k],O=u.width/u.height,B=Math.tan(u.fovAboveCenter),V=ns([],w.up(),B),Z=ns([],w.right(),B*O),ee=Mn([],Cr([],Cr([],E,V),Z)),le=[];let te;if(new mf(A,ee).closestPointOnSphere(L,k,le)){const oe=Cr([],le,L),de=js([],oe,A);te=Math.cos(u.fovAboveCenter)*sh(de)}else{const oe=js([],A,L),de=js([],L,A);Mn(de,de);const ue=sh(oe)-k;te=Math.sqrt(ue*(ue+2*k));const Ie=Math.acos(te/(k+ue))-Math.acos(gs(E,de));te*=Math.cos(Ie)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Cl(e.zoom);if(l>0){const u=g0(e,Vs(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ut(i,u+f*(1-Math.cos(m)),Math.pow(l,10))}return i}upVector(e,i,l){return uh(i,l,e,1)}upVectorScale(e){return{metersToTile:ad(cd(tr(e)))}}}function w0(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new y0(t);case"equirectangular":return new Sw(t);case"naturalEarth":return new Iw(t);case"equalEarth":return new Mw(t);case"winkelTripel":return new Cw(t);case"albers":return i?new b0(t):new Ew(t);case"lambertConformalConic":return i?new b0(t):new Aw(t);case"globe":return new Pw(t)}throw new Error(`Invalid projection name: ${t.name}`)}const kw=xd.types,Lw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Dd(t,e,i,l,u,f,m,x,w,E,A,k,L){const O=x?Math.min(go,Math.round(x[0])):0,B=x?Math.min(go,Math.round(x[1])):0;t.emplaceBack(e,i,Math.round(32*l),Math.round(32*u),f,m,(O<<1)+(w?1:0),B,16*E,16*A,256*k,256*L)}function zd(t,e,i,l,u,f,m){t.emplaceBack(e,i,l,u,f,m)}function Rd(t,e,i,l,u){t.emplaceBack(e,i,l,u),t.emplaceBack(e,i,l,u),t.emplaceBack(e,i,l,u),t.emplaceBack(e,i,l,u)}function Dw(t){for(const e of t.sections)if(af(e.text))return!0;return!1}class Qf{constructor(e){this.layoutVertexArray=new Ge,this.indexArray=new _t,this.programConfigurations=e,this.segments=new Ui,this.dynamicLayoutVertexArray=new We,this.opacityVertexArray=new mt,this.placedSymbolArray=new Vi,this.globeExtVertexArray=new Ye}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,l,u){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Gb.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Lw,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ub.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ut(Qf,"SymbolBuffers");class e_{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new Ui,this.collisionVertexArray=new Bt,this.collisionVertexArrayExt=new Lt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$b.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,qb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ut(e_,"CollisionBuffers");class xo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ns([]),this.placementViewportMatrix=Ns([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Uf(this.zoom,i["text-size"]),this.iconSizeData=Uf(this.zoom,i["icon-size"]);const l=this.layers[0].layout,u=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(m=>rs[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Qf(new ga(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Qf(new ga(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new En,this.lineVertexArray=new Tl,this.symbolInstances=new mi}calculateGlyphDependencies(e,i,l,u,f){for(let m=0;m<e.length;m++)if(i[e.charCodeAt(m)]=!0,u&&f){const x=Th[e.charAt(m)];x&&(i[x.charCodeAt(0)]=!0)}}populate(e,i,l,u){const f=this.layers[0],m=f.layout,x=this.projection.name==="globe",w=m.get("text-font"),E=m.get("text-field"),A=m.get("icon-image"),k=(E.value.kind!=="constant"||E.value.value instanceof Tn&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),L=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!k&&!L)return;const B=i.iconDependencies,V=i.glyphDependencies,Z=i.availableImages,ee=new P(this.zoom);for(const{feature:le,id:te,index:oe,sourceLayerIndex:de}of e){const ue=f._featureFilter.needGeometry,Ie=Ta(le,ue);if(!f._featureFilter.filter(ee,Ie,l))continue;if(ue||(Ie.geometry=Pr(le,l,u)),x&&le.type!==1&&l.z<=5){const Pe=Ie.geometry,Ve=.98078528056,Ue=($e,Qe)=>gs(uh($e.x,$e.y,l,1),uh(Qe.x,Qe.y,l,1))<Ve;for(let $e=0;$e<Pe.length;$e++)Pe[$e]=Gv(Pe[$e],Ue)}let Me,Be;if(k){const Pe=f.getValueAndResolveTokens("text-field",Ie,l,Z),Ve=Tn.factory(Pe);Dw(Ve)&&(this.hasRTLText=!0),(!this.hasRTLText||b()==="unavailable"||this.hasRTLText&&S.isParsed())&&(Me=Hb(Ve,f,Ie))}if(L){const Pe=f.getValueAndResolveTokens("icon-image",Ie,l,Z);Be=Pe instanceof Gn?Pe:Gn.fromString(Pe)}if(!Me&&!Be)continue;const He=this.sortFeaturesByKey?O.evaluate(Ie,{},l):void 0;if(this.features.push({id:te,text:Me,icon:Be,index:oe,sourceLayerIndex:de,geometry:Ie.geometry,properties:le.properties,type:kw[le.type],sortKey:He}),Be&&(B[Be.name]=!0),Me){const Pe=w.evaluate(Ie,{},l).join(","),Ve=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rs.vertical)>=0;for(const Ue of Me.sections)if(Ue.image)B[Ue.image.name]=!0;else{const $e=Yc(Me.toString()),Qe=Ue.fontStack||Pe,ze=V[Qe]=V[Qe]||{};this.calculateGlyphDependencies(Ue.text,ze,Ve,this.allowVerticalPlacement,$e)}}}m.get("symbol-placement")==="line"&&(this.features=function(le){const te={},oe={},de=[];let ue=0;function Ie(Pe){de.push(le[Pe]),ue++}function Me(Pe,Ve,Ue){const $e=oe[Pe];return delete oe[Pe],oe[Ve]=$e,de[$e].geometry[0].pop(),de[$e].geometry[0]=de[$e].geometry[0].concat(Ue[0]),$e}function Be(Pe,Ve,Ue){const $e=te[Ve];return delete te[Ve],te[Pe]=$e,de[$e].geometry[0].shift(),de[$e].geometry[0]=Ue[0].concat(de[$e].geometry[0]),$e}function He(Pe,Ve,Ue){const $e=Ue?Ve[0][Ve[0].length-1]:Ve[0][0];return`${Pe}:${$e.x}:${$e.y}`}for(let Pe=0;Pe<le.length;Pe++){const Ve=le[Pe],Ue=Ve.geometry,$e=Ve.text?Ve.text.toString():null;if(!$e){Ie(Pe);continue}const Qe=He($e,Ue),ze=He($e,Ue,!0);if(Qe in oe&&ze in te&&oe[Qe]!==te[ze]){const rt=Be(Qe,ze,Ue),pt=Me(Qe,ze,de[rt].geometry);delete te[Qe],delete oe[ze],oe[He($e,de[pt].geometry,!0)]=pt,de[rt].geometry=null}else Qe in oe?Me(Qe,ze,Ue):ze in te?Be(Qe,ze,Ue):(Ie(Pe),te[Qe]=ue-1,oe[ze]=ue-1)}return de.filter(Pe=>Pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,te)=>le.sortKey-te.sortKey)}update(e,i,l,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,l,u),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,l,u))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=w0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:f}of i)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,u,f,m,x,w,E,A,k,L,O,B){const V=e.indexArray,Z=e.layoutVertexArray,ee=e.globeExtVertexArray,le=e.segments.prepareSegment(4*i.length,Z,V,this.canOverlap?m.sortKey:void 0),te=this.glyphOffsetArray.length,oe=le.vertexLength,de=this.allowVerticalPlacement&&x===rs.vertical?Math.PI/2:0,ue=m.text&&m.text.sections;for(let Me=0;Me<i.length;Me++){const{tl:Be,tr:He,bl:Pe,br:Ve,tex:Ue,pixelOffsetTL:$e,pixelOffsetBR:Qe,minFontScaleX:ze,minFontScaleY:rt,glyphOffset:pt,isSDF:ot,sectionIndex:Tt}=i[Me],et=le.vertexLength,gt=pt[1];if(Dd(Z,E.x,E.y,Be.x,gt+Be.y,Ue.x,Ue.y,l,ot,$e.x,$e.y,ze,rt),Dd(Z,E.x,E.y,He.x,gt+He.y,Ue.x+Ue.w,Ue.y,l,ot,Qe.x,$e.y,ze,rt),Dd(Z,E.x,E.y,Pe.x,gt+Pe.y,Ue.x,Ue.y+Ue.h,l,ot,$e.x,Qe.y,ze,rt),Dd(Z,E.x,E.y,Ve.x,gt+Ve.y,Ue.x+Ue.w,Ue.y+Ue.h,l,ot,Qe.x,Qe.y,ze,rt),w){const{x:Et,y:qt,z:Mt}=w.anchor,[vt,fi,It]=w.up;zd(ee,Et,qt,Mt,vt,fi,It),zd(ee,Et,qt,Mt,vt,fi,It),zd(ee,Et,qt,Mt,vt,fi,It),zd(ee,Et,qt,Mt,vt,fi,It),Rd(e.dynamicLayoutVertexArray,Et,qt,Mt,de)}else Rd(e.dynamicLayoutVertexArray,E.x,E.y,E.z,de);V.emplaceBack(et,et+1,et+2),V.emplaceBack(et+1,et+2,et+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),Me!==i.length-1&&Tt===i[Me+1].sectionIndex||e.programConfigurations.populatePaintArrays(Z.length,m,m.index,{},O,B,ue&&ue[Tt])}const Ie=w?w.anchor:E;e.placedSymbolArray.emplaceBack(Ie.x,Ie.y,Ie.z,E.x,E.y,te,this.glyphOffsetArray.length-te,oe,A,k,E.segment,l?l[0]:0,l?l[1]:0,u[0],u[1],x,0,!1,0,L,0)}_commitLayoutVertex(e,i,l,u,f,m,x){e.emplaceBack(i,l,u,f,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,l,u,f,m,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),E=w.vertexLength,A=x.tileAnchorX,k=x.tileAnchorY;for(let O=0;O<4;O++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,u,f,m,A,k,new De(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,f,m,A,k,new De(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,u,f,m,A,k,new De(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,u,f,m,A,k,new De(e.x1,e.y2)),w.vertexLength+=4;const L=l.indexArray;L.emplaceBack(E,E+1),L.emplaceBack(E+1,E+2),L.emplaceBack(E+2,E+3),L.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,u,f,m){for(let x=u;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(e,m,i,x);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,l,u,f,m){for(let x=u;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new e_(dt,Vg.members,nn),this.iconCollisionBox=new e_(dt,Vg.members,nn);const l=Rl(this.iconSizeData,e),u=Rl(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(u,e,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,e,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,e,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,i,l,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),m=Td(this.textSizeData,e,f)/ln;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,l){const u=this.icon.placedSymbolArray.get(l),f=Td(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,l){e.emplaceBack(i,-l,-l),e.emplaceBack(i,l,-l),e.emplaceBack(i,l,l),e.emplaceBack(i,-l,l)}_updateTextDebugCollisionBoxes(e,i,l,u,f,m){for(let x=u;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(e,m,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(e,i,l,u,f,m){for(let x=u;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(e,i,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Rl(this.iconSizeData,e),u=Rl(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(u,e,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(l,e,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,e,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,u,f,m,x,w,E){const A={};if(i<l){const{x1:k,y1:L,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe,featureIndex:de}=e.get(i);A.textBox={x1:k,y1:L,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe},A.textFeatureIndex=de}if(u<f){const{x1:k,y1:L,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe,featureIndex:de}=e.get(u);A.verticalTextBox={x1:k,y1:L,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe},A.verticalTextFeatureIndex=de}if(m<x){const{x1:k,y1:L,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe,featureIndex:de}=e.get(m);A.iconBox={x1:k,y1:L,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe},A.iconFeatureIndex=de}if(w<E){const{x1:k,y1:L,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe,featureIndex:de}=e.get(w);A.verticalIconBox={x1:k,y1:L,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe},A.verticalIconFeatureIndex=de}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),u=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),u=[],f=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const w=this.symbolInstances.get(x);u.push(0|Math.round(i*w.tileAnchorX+l*w.tileAnchorY)),f.push(w.featureIndex)}return m.sort((x,w)=>u[x]-u[w]||f[w]-f[x]),m}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=l;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ut(xo,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),xo.MAX_GLYPHS=65535,xo.addDynamicAttributes=Rd;const zw=new se({"symbol-placement":new j(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new j(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new j(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new H(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new j(Oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new j(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new j(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new j(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new j(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new H(Oe.layout_symbol["icon-size"]),"icon-text-fit":new j(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new j(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new H(Oe.layout_symbol["icon-image"]),"icon-rotate":new H(Oe.layout_symbol["icon-rotate"]),"icon-padding":new j(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new j(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new H(Oe.layout_symbol["icon-offset"]),"icon-anchor":new H(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new j(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new j(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new j(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new H(Oe.layout_symbol["text-field"]),"text-font":new H(Oe.layout_symbol["text-font"]),"text-size":new H(Oe.layout_symbol["text-size"]),"text-max-width":new H(Oe.layout_symbol["text-max-width"]),"text-line-height":new H(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new H(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new H(Oe.layout_symbol["text-justify"]),"text-radial-offset":new H(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new j(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new H(Oe.layout_symbol["text-anchor"]),"text-max-angle":new j(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new j(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new H(Oe.layout_symbol["text-rotate"]),"text-padding":new j(Oe.layout_symbol["text-padding"]),"text-keep-upright":new j(Oe.layout_symbol["text-keep-upright"]),"text-transform":new H(Oe.layout_symbol["text-transform"]),"text-offset":new H(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new j(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new j(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new j(Oe.layout_symbol["text-optional"])});var t_={paint:new se({"icon-opacity":new H(Oe.paint_symbol["icon-opacity"]),"icon-color":new H(Oe.paint_symbol["icon-color"]),"icon-halo-color":new H(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new H(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new H(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new j(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new j(Oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new H(Oe.paint_symbol["text-opacity"]),"text-color":new H(Oe.paint_symbol["text-color"],{runtimeType:On,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new H(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new H(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new H(Oe.paint_symbol["text-halo-blur"]),"text-translate":new j(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new j(Oe.paint_symbol["text-translate-anchor"])}),layout:zw};class T0{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Hr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ut(T0,"FormatSectionOverride",{omit:["defaultValue"]});class Od extends Fs{constructor(e){super(e,t_)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const u=[];for(const f of l)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,l,u){const f=this.layout.get(e).evaluate(i,{},l,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||oo(m.value)||!f?f:function(x,w){return w.replace(/{([^{}]+)}/g,(E,A)=>A in x?String(x[A]):"")}(i.properties,f)}createBucket(e){return new xo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of t_.paint.overridableProperties){if(!Od.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new T0(i),u=new _l(l,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Nc("source",u):new la("composite",u,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new K(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&Od.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),u=t_.paint.properties[i];let f=!1;const m=x=>{for(const w of x)if(u.overrides&&u.overrides.hasOverride(w))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Tn)m(l.value.value.sections);else if(l.value.kind==="source"){const x=E=>{f||(E instanceof yr&&Li(E.value)===qo?m(E.value.sections):E instanceof Ks?m(E.sections):E.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return f}getProgramConfiguration(e){return new fo(this,e)}}var Rw={paint:new se({"background-color":new j(Oe.paint_background["background-color"]),"background-pattern":new j(Oe.paint_background["background-pattern"]),"background-opacity":new j(Oe.paint_background["background-opacity"])})},Ow={paint:new se({"raster-opacity":new j(Oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new j(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new j(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new j(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new j(Oe.paint_raster["raster-saturation"]),"raster-contrast":new j(Oe.paint_raster["raster-contrast"]),"raster-resampling":new j(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new j(Oe.paint_raster["raster-fade-duration"])})};class Bw extends Fs{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Fw={paint:new se({"sky-type":new j(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new j(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new j(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new j(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new j(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ne(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new j(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new j(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new j(Oe.paint_sky["sky-opacity"])})};function i_(t,e,i){const l=[0,0,1],u=Um([]);return $m(u,u,i?-ft(t)+Math.PI:ft(t)),Gm(u,u,-ft(e)),Fm(l,l,u),Mn(l,l)}const Nw={circle:class extends Fs{constructor(t){super(t,Yv)}createBucket(t){return new If(t)}queryRadius(t){const e=t;return kl("circle-radius",this,e)+kl("circle-stroke-width",this,e)+dd(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,l,u,f,m,x){const w=dg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return pg(t,l,f,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new fo(this,t)}},heatmap:class extends Fs{createBucket(t){return new _g(t)}constructor(t){super(t,eb),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return kl("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,l,u,f,m,x){const w=this.paint.get("heatmap-radius").evaluate(e,i);return pg(t,l,f,m,x,!0,!0,new De(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new fo(this,t)}},hillshade:class extends Fs{constructor(t){super(t,tb)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Fs{constructor(t){super(t,gb)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new fo(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new gd(t)}queryRadius(){return dd(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,l,u,f){return!t.queryGeometry.isAboveHorizon&&ag(ug(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Fs{constructor(t){super(t,Db)}createBucket(t){return new vh(t)}queryRadius(){return dd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new fo(this,t)}queryIntersectsFeature(t,e,i,l,u,f,m,x,w){const E=dg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),k=this.paint.get("fill-extrusion-base").evaluate(e,i),L=[0,0],O=x&&f.elevation,B=f.elevation?f.elevation.exaggeration():1,V=t.tile.getBucket(this);if(O&&V instanceof vh){const oe=V.centroidVertexArray,de=w+1;de<oe.length&&(L[0]=oe.geta_centroid_pos0(de),L[1]=oe.geta_centroid_pos1(de))}if(L[0]===0&&L[1]===1)return!1;f.projection.name==="globe"&&(l=Dg([l],[new De(0,0),new De(yt,yt)],t.tileID.canonical).map(oe=>oe.polygon).flat());const Z=O?x:null,[ee,le]=function(oe,de,ue,Ie,Me,Be,He,Pe,Ve,Ue,$e){return oe.projection.name==="globe"?function(Qe,ze,rt,pt,ot,Tt,et,gt,Et,qt,Mt){const vt=[],fi=[],It=Qe.projection.upVectorScale(Mt,Qe.center.lat,Qe.worldSize).metersToTile,Ct=[0,0,0,1],ai=[0,0,0,1],ui=(li,Si,Di,$i)=>{li[0]=Si,li[1]=Di,li[2]=$i,li[3]=1},di=Lg();rt>0&&(rt+=di),pt+=di;for(const li of ze){const Si=[],Di=[];for(const $i of li){const ci=$i.x+ot.x,Xi=$i.y+ot.y,qi=Qe.projection.projectTilePoint(ci,Xi,Mt),Ai=Qe.projection.upVector(Mt,$i.x,$i.y);let Zt=rt,Wi=pt;if(et){const pi=Bg(ci,Xi,rt,pt,et,gt,Et,qt);Zt+=pi.base,Wi+=pi.top}rt!==0?ui(Ct,qi.x+Ai[0]*It*Zt,qi.y+Ai[1]*It*Zt,qi.z+Ai[2]*It*Zt):ui(Ct,qi.x,qi.y,qi.z),ui(ai,qi.x+Ai[0]*It*Wi,qi.y+Ai[1]*It*Wi,qi.z+Ai[2]*It*Wi),Fi(Ct,Ct,Tt),Fi(ai,ai,Tt),Si.push(new zl(Ct[0],Ct[1],Ct[2])),Di.push(new zl(ai[0],ai[1],ai[2]))}vt.push(Si),fi.push(Di)}return[vt,fi]}(oe,de,ue,Ie,Me,Be,He,Pe,Ve,Ue,$e):He?function(Qe,ze,rt,pt,ot,Tt,et,gt,Et){const qt=[],Mt=[],vt=[0,0,0,1];for(const fi of Qe){const It=[],Ct=[];for(const ai of fi){const ui=ai.x+pt.x,di=ai.y+pt.y,li=Bg(ui,di,ze,rt,Tt,et,gt,Et);vt[0]=ui,vt[1]=di,vt[2]=li.base,vt[3]=1,va(vt,vt,ot),vt[3]=Math.max(vt[3],1e-5);const Si=new zl(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);vt[0]=ui,vt[1]=di,vt[2]=li.top,vt[3]=1,va(vt,vt,ot),vt[3]=Math.max(vt[3],1e-5);const Di=new zl(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);It.push(Si),Ct.push(Di)}qt.push(It),Mt.push(Ct)}return[qt,Mt]}(de,ue,Ie,Me,Be,He,Pe,Ve,Ue):function(Qe,ze,rt,pt,ot){const Tt=[],et=[],gt=ot[8]*ze,Et=ot[9]*ze,qt=ot[10]*ze,Mt=ot[11]*ze,vt=ot[8]*rt,fi=ot[9]*rt,It=ot[10]*rt,Ct=ot[11]*rt;for(const ai of Qe){const ui=[],di=[];for(const li of ai){const Si=li.x+pt.x,Di=li.y+pt.y,$i=ot[0]*Si+ot[4]*Di+ot[12],ci=ot[1]*Si+ot[5]*Di+ot[13],Xi=ot[2]*Si+ot[6]*Di+ot[14],qi=ot[3]*Si+ot[7]*Di+ot[15],Ai=$i+gt,Zt=ci+Et,Wi=Xi+qt,pi=Math.max(qi+Mt,1e-5),In=$i+vt,Zi=ci+fi,cn=Xi+It,sn=Math.max(qi+Ct,1e-5);ui.push(new zl(Ai/pi,Zt/pi,Wi/pi)),di.push(new zl(In/sn,Zi/sn,cn/sn))}Tt.push(ui),et.push(di)}return[Tt,et]}(de,ue,Ie,Me,Be)}(f,l,k,A,E,m,Z,L,B,f.center.lat,t.tileID.canonical),te=t.queryGeometry;return function(oe,de,ue){let Ie=1/0;ag(ue,de)&&(Ie=Og(ue,de[0]));for(let Me=0;Me<de.length;Me++){const Be=de[Me],He=oe[Me];for(let Pe=0;Pe<Be.length-1;Pe++){const Ve=Be[Pe],Ue=[Ve,Be[Pe+1],He[Pe+1],He[Pe],Ve];og(ue,Ue)&&(Ie=Math.min(Ie,Og(ue,Ue)))}}return Ie!==1/0&&Ie}(ee,le,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends Fs{constructor(t){super(t,Fg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Sc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Ng.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new wd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new fo(this,t)}queryRadius(t){const e=t,i=jg(kl("line-width",this,e),kl("line-gap-width",this,e)),l=kl("line-offset",this,e);return i/2+Math.abs(l)+dd(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,l,u,f){if(t.queryGeometry.isAboveHorizon)return!1;const m=ug(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),x=t.pixelToTileUnitsFactor/2*jg(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(l=function(E,A){const k=[],L=new De(0,0);for(let O=0;O<E.length;O++){const B=E[O],V=[];for(let Z=0;Z<B.length;Z++){const ee=B[Z],le=B[Z+1],te=Z===0?L:ee.sub(B[Z-1])._unit()._perp(),oe=Z===B.length-1?L:le.sub(ee)._unit()._perp(),de=te._add(oe)._unit();de._mult(1/(de.x*oe.x+de.y*oe.y)),V.push(de._mult(A)._add(ee))}k.push(V)}return k}(l,w*t.pixelToTileUnitsFactor)),function(E,A,k){for(let L=0;L<A.length;L++){const O=A[L];if(E.length>=3){for(let B=0;B<O.length;B++)if(Ea(E,O[B]))return!0}if(Wv(E,O,k))return!0}return!1}(m,l,x)}isTileClipped(){return!0}},symbol:Od,background:class extends Fs{constructor(t){super(t,Rw)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Fs{constructor(t){super(t,Ow)}getProgramIds(){return["raster"]}},sky:class extends Fs{constructor(t){super(t,Fw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),u=!l,f=t.style.light,m=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&Ei("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?i_(m.azimuthal,90-m.polar,e):i_(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return i_(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class kh{constructor(e,i,l,u){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(i,u)}update(e,i,l){const{width:u,height:f}=e,{context:m}=this,{gl:x}=m,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:A,ImageData:k,ImageBitmap:L}=T;if(x.bindTexture(x.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),l||this.size&&this.size[0]===u&&this.size[1]===f){const{x:O,y:B}=l||{x:0,y:0};e instanceof w||e instanceof E||e instanceof A||e instanceof k||L&&e instanceof L?x.texSubImage2D(x.TEXTURE_2D,0,O,B,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,O,B,u,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof w||e instanceof E||e instanceof A||e instanceof k||L&&e instanceof L?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,u,f,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i){const{context:l}=this,{gl:u}=l;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class jw{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Vw{constructor(){this.tasks={},this.taskQueue=[],ur(["process"],this),this.invoker=new jw(this.process),this.nextId=0}add(e,i){const l=this.nextId++,u=function({type:f,isSymbolTile:m,zoom:x}){return x=x||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-x:f==="maybePrepare"&&m?400-x:500:200-x:100-x}(i);if(u===0){Ms();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:i,priority:u,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Ms();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class E0{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Uw=["tile","layer","source","sourceLayer","state"];class M0{constructor(e,i,l,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of Uw)this[i]!==void 0&&(e[i]=this[i]);return e}}const vs=32,sr=33,vo=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,l=0,u=0,f=0,m=0,x=0;for(1&e?u=f=m=vs:i=l=x=vs;(e>>=1)>1;){const E=i+u>>1,A=l+f>>1;1&e?(u=i,f=l,i=m,l=x):(i=u,l=f,u=m,f=x),m=E,x=A}const w=4*t;vo[w+0]=i,vo[w+1]=l,vo[w+2]=u,vo[w+3]=f}const rr=new Uint16Array(2178),bo=new Uint8Array(1089),Bd=new Uint16Array(1089);function S0(t){return t===0?-.03125:t===32?.03125:0}var A0=xe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const I0={type:2,extent:yt,loadGeometry:()=>[[new De(0,0),new De(yt+1,0),new De(yt+1,yt+1),new De(0,yt+1),new De(0,0)]]};class n_{constructor(e,i,l,u,f){this.tileID=e,this.uid=Nn(),this.uses=0,this.tileSize=i,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<Ss.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Sa(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const m={};if(!f)return m;for(const x of u){const w=x.layerIds.map(E=>f.getLayer(E)).filter(Boolean);if(w.length!==0){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>w.filter(A=>A.id===E)[0]));for(const E of w)m[E.id]=x}}return m}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof xo){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof xo&&f.hasRTLText){this.hasRTLText=!0,S.isLoading()||S.isLoaded()||b()!=="deferred"||M();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ri}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const u=this.buckets[l];u.uploadPending()&&u.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new kh(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new kh(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new kh(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,l,u,f,m,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:x,transform:m,params:f,tileTransform:this.tileTransform},e,i,l):{}}querySourceFeatures(e,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const u=l.loadVTLayers(),f=i?i.sourceLayer:"",m=u._geojsonTileLayer||u[f];if(!m)return;const x=xl(i&&i.filter),{z:w,x:E,y:A}=this.tileID.canonical,k={z:w,x:E,y:A};for(let L=0;L<m.length;L++){const O=m.feature(L);if(x.needGeometry){const Z=Ta(O,!0);if(!x.filter(new P(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!x.filter(new P(this.tileID.overscaledZ),O))continue;const B=l.getId(O,f),V=new M0(O,w,E,A,B);V.tile=k,e.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const l=Rn(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let u=!1;if(this.expirationTime>l)u=!1;else if(i)if(this.expirationTime<i)u=!0;else{const f=this.expirationTime-i;f?this.expirationTime=l+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const l=this.latestFeatureIndex.loadVTLayers(),u=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const m=this.buckets[f],x=m.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],E=e[x];if(!w||!E||Object.keys(E).length===0)continue;if(m.update(E,w,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof wd||m instanceof gd){const k=i.style._getSourceCache(m.layers[0].source);i._terrain&&i._terrain.enabled&&k&&m.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(k.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(f);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Ss.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=Ss.now()+e}setTexture(e,i){const l=i.context,u=l.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new kh(l,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,i){const l={};for(const u of i)l[u]=!0;this.dependencies[e]=l}hasDependency(e,i){for(const l of e){const u=this.dependencies[l];if(u){for(const f of i)if(u[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const l=Pr(I0,this.tileID.canonical,this.tileTransform)[0],u=new Ze,f=new Wn;for(let m=0;m<l.length;m++){const{x,y:w}=l[m];u.emplaceBack(x,w),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,ch.members),this._tileDebugSegments=Ui.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const l=Pr(I0,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const m=function(x,w){const E=Sa(x,w),A=Math.pow(2,x.z);for(let Z=0;Z<sr;Z++)for(let ee=0;ee<sr;ee++){const le=ss((x.x+(ee+S0(ee))/vs)/A),te=fn((x.y+(Z+S0(Z))/vs)/A),oe=w.project(le,te),de=Z*sr+ee;rr[2*de+0]=Math.round((oe.x*E.scale-E.x)*yt),rr[2*de+1]=Math.round((oe.y*E.scale-E.y)*yt)}bo.fill(0),Bd.fill(0);for(let Z=2045;Z>=0;Z--){const ee=4*Z,le=vo[ee+0],te=vo[ee+1],oe=vo[ee+2],de=vo[ee+3],ue=le+oe>>1,Ie=te+de>>1,Me=ue+Ie-te,Be=Ie+le-ue,He=te*sr+le,Pe=de*sr+oe,Ve=Ie*sr+ue,Ue=Math.hypot((rr[2*He+0]+rr[2*Pe+0])/2-rr[2*Ve+0],(rr[2*He+1]+rr[2*Pe+1])/2-rr[2*Ve+1])>=16;bo[Ve]=bo[Ve]||(Ue?1:0),Z<1022&&(bo[Ve]=bo[Ve]||bo[(te+Be>>1)*sr+(le+Me>>1)]||bo[(de+Be>>1)*sr+(oe+Me>>1)])}const k=new je,L=new _t;let O=0;function B(Z,ee){const le=ee*sr+Z;return Bd[le]===0&&(k.emplaceBack(rr[2*le+0],rr[2*le+1],Z*yt/vs,ee*yt/vs),Bd[le]=++O),Bd[le]-1}function V(Z,ee,le,te,oe,de){const ue=Z+le>>1,Ie=ee+te>>1;if(Math.abs(Z-oe)+Math.abs(ee-de)>1&&bo[Ie*sr+ue])V(oe,de,Z,ee,ue,Ie),V(le,te,oe,de,ue,Ie);else{const Me=B(Z,ee),Be=B(le,te),He=B(oe,de);L.emplaceBack(Me,Be,He)}}return V(0,0,vs,vs,vs,0),V(vs,vs,0,0,0,vs),{vertices:k,indices:L}}(this.tileID.canonical,i);u=m.vertices,f=m.indices}else{u=new je,f=new _t;for(const{x,y:w}of l)u.emplaceBack(x,w,0,0);const m=Bf(u.int16,void 0,4);for(let x=0;x<m.length;x+=3)f.emplaceBack(m[x],m[x+1],m[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,A0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=Ui.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,i){const l=i.projection;if(!l||l.name!=="globe"||i.freezeTileCoverage)return;const u=this.tileID.canonical,f=dh(Xm(u,i)),m=Cl(i.zoom);let x;m>0&&(x=uf(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,i,f,x,m),this._makeGlobeTileDebugTextBuffer(e,u,i,f,x,m)}_globePoint(e,i,l,u,f,m,x){let w=uh(e,i,l);if(m){const E=1<<l.z,A=ir(u.center.lng),k=nr(u.center.lat),L=(l.x+.5)/E-A;let O=0;L>.5?O=-1:L<-.5&&(O=1);let B=(e/yt+l.x)/E+O,V=(i/yt+l.y)/E;B=(B-A)*u._pixelsPerMercatorPixel+A,V=(V-k)*u._pixelsPerMercatorPixel+k;const Z=[B*u.worldSize,V*u.worldSize,0];Fi(Z,Z,m),w=wa(w,Z,x)}return Fi(w,w,f)}_makeGlobeTileDebugBorderBuffer(e,i,l,u,f,m){const x=new Ze,w=new Wn,E=new Ee,A=(L,O,B,V,Z)=>{const ee=(B-L)/(Z-1),le=(V-O)/(Z-1),te=x.length;for(let oe=0;oe<Z;oe++){const de=L+oe*ee,ue=O+oe*le;x.emplaceBack(de,ue);const Ie=this._globePoint(de,ue,i,l,u,f,m);E.emplaceBack(Ie[0],Ie[1],Ie[2]),w.emplaceBack(te+oe)}},k=yt;A(0,0,k,0,16),A(k,0,k,k,16),A(k,k,0,k,16),A(0,k,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(x,ch.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,Wm.members),this._tileDebugSegments=Ui.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(e,i,l,u,f,m){const x=yt/4,w=new Ze,E=new _t,A=new Ee,k=25;E.reserve(32),w.reserve(k),A.reserve(k);const L=(O,B)=>k*O+B;for(let O=0;O<k;O++){const B=O*x;for(let V=0;V<k;V++){const Z=V*x;w.emplaceBack(Z,B);const ee=this._globePoint(Z,B,i,l,u,f,m);A.emplaceBack(ee[0],ee[1],ee[2])}}for(let O=0;O<4;O++)for(let B=0;B<4;B++){const V=L(O,B),Z=L(O,B+1),ee=L(O+1,B),le=L(O+1,B+1);E.emplaceBack(V,Z,ee),E.emplaceBack(ee,Z,le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(E),this._tileDebugTextBuffer=e.createVertexBuffer(w,ch.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(A,Wm.members),this._tileDebugTextSegments=Ui.simpleSegment(0,0,k,32)}}class Gw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,l){const u=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},_i(this.stateChanges[e][u],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][u]===null){this.deletedStates[e][u]={};for(const f in this.state[e][u])l[f]||(this.deletedStates[e][u][f]=null)}else for(const f in l)this.deletedStates[e]&&this.deletedStates[e][u]&&this.deletedStates[e][u][f]===null&&delete this.deletedStates[e][u][f]}removeFeatureState(e,i,l){if(this.deletedStates[e]===null)return;const u=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&i!==void 0)this.deletedStates[e][u]!==null&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][l]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][u])for(l in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][l]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,i){const l=String(i),u=_i({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(f===null)return{};for(const m in f)delete u[m]}return u}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const l={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const m in this.stateChanges[u])this.state[u][m]||(this.state[u][m]={}),_i(this.state[u][m],this.stateChanges[u][m]),f[m]=this.state[u][m];l[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(this.deletedStates[u]===null)for(const m in this.state[u])f[m]={},this.state[u][m]={};else for(const m in this.deletedStates[u]){if(this.deletedStates[u][m]===null)this.state[u][m]={};else if(this.state[u][m])for(const x of Object.keys(this.deletedStates[u][m]))delete this.state[u][m][x];f[m]=this.state[u][m]}l[u]=l[u]||{},_i(l[u],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const u in e)e[u].setFeatureState(l,i)}}class C0{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function P0(t,e,i,l){let u=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(l[m])<1e-15){if(i[m]<t[m]||i[m]>e[m])return null}else{const x=1/l[m];let w=(t[m]-i[m])*x,E=(e[m]-i[m])*x;if(w>E){const A=w;w=E,E=A}if(w>u&&(u=w),E<f&&(f=E),u>f)return null}return u}function k0(t,e,i,l,u,f,m,x,w,E,A){const k=l-t,L=u-e,O=f-i,B=m-t,V=x-e,Z=w-i,ee=A[1]*Z-A[2]*V,le=A[2]*B-A[0]*Z,te=A[0]*V-A[1]*B,oe=k*ee+L*le+O*te;if(Math.abs(oe)<1e-15)return null;const de=1/oe,ue=E[0]-t,Ie=E[1]-e,Me=E[2]-i,Be=(ue*ee+Ie*le+Me*te)*de;if(Be<0||Be>1)return null;const He=Ie*O-Me*L,Pe=Me*k-ue*O,Ve=ue*L-Ie*k,Ue=(A[0]*He+A[1]*Pe+A[2]*Ve)*de;return Ue<0||Be+Ue>1?null:(B*He+V*Pe+Z*Ve)*de}function L0(t,e,i){return(t-e)/(i-e)}function D0(t,e,i,l,u,f,m,x,w){const E=1<<i,A=f-l,k=m-u,L=(t+1)/E*A+l,O=(e+0)/E*k+u,B=(e+1)/E*k+u;x[0]=(t+0)/E*A+l,x[1]=O,w[0]=L,w[1]=B}class z0{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const m=Math.ceil(Math.log2(f.dim/8)),x=[];let w=Math.ceil(Math.pow(2,m));const E=1/w,A=(O,B,V,Z,ee)=>{const le=Z?1:0,te=(O+1)*V-le,oe=B*V,de=(B+1)*V-le;ee[0]=O*V,ee[1]=oe,ee[2]=te,ee[3]=de};let k=new C0(w);const L=[];for(let O=0;O<w*w;O++){A(O%w,Math.floor(O/w),E,!1,L);const B=wo(L[0],L[1],f),V=wo(L[2],L[1],f),Z=wo(L[2],L[3],f),ee=wo(L[0],L[3],f);k.minimums.push(Math.min(B,V,Z,ee)),k.maximums.push(Math.max(B,V,Z,ee)),k.leaves.push(1)}for(x.push(k),w/=2;w>=1;w/=2){const O=x[x.length-1];k=new C0(w);for(let B=0;B<w*w;B++){A(B%w,Math.floor(B/w),2,!0,L);const V=O.getElevation(L[0],L[1]),Z=O.getElevation(L[2],L[1]),ee=O.getElevation(L[2],L[3]),le=O.getElevation(L[0],L[3]),te=O.isLeaf(L[0],L[1]),oe=O.isLeaf(L[2],L[1]),de=O.isLeaf(L[2],L[3]),ue=O.isLeaf(L[0],L[3]),Ie=Math.min(V.min,Z.min,ee.min,le.min),Me=Math.max(V.max,Z.max,ee.max,le.max),Be=te&&oe&&de&&ue;k.maximums.push(Me),k.minimums.push(Ie),k.leaves.push(Me-Ie<=5&&Be?1:0)}x.push(k)}return x}(this.dem),l=i.length-1,u=i[l];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,u,f,m,x=1){return P0([e,i,-100],[l,u,this.maximums[0]*x],f,m)}raycast(e,i,l,u,f,m,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,l,u,f,m,x);if(w==null)return null;const E=[],A=[],k=[],L=[],O=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:B,t:V,nodex:Z,nodey:ee,depth:le}=O.pop();if(this.leaves[B]){D0(Z,ee,le,e,i,l,u,k,L);const oe=1<<le,de=(Z+0)/oe,ue=(Z+1)/oe,Ie=(ee+0)/oe,Me=(ee+1)/oe,Be=wo(de,Ie,this.dem)*x,He=wo(ue,Ie,this.dem)*x,Pe=wo(ue,Me,this.dem)*x,Ve=wo(de,Me,this.dem)*x,Ue=k0(k[0],k[1],Be,L[0],k[1],He,L[0],L[1],Pe,f,m),$e=k0(L[0],L[1],Pe,k[0],L[1],Ve,k[0],k[1],Be,f,m),Qe=Math.min(Ue!==null?Ue:Number.MAX_VALUE,$e!==null?$e:Number.MAX_VALUE);if(Qe!==Number.MAX_VALUE)return Qe;{const ze=ah([],f,m,V);if(R0(Be,He,Ve,Pe,L0(ze[0],k[0],L[0]),L0(ze[1],k[1],L[1]))>=ze[2])return V}continue}let te=0;for(let oe=0;oe<this._siblingOffset.length;oe++){D0((Z<<1)+this._siblingOffset[oe][0],(ee<<1)+this._siblingOffset[oe][1],le+1,e,i,l,u,k,L),k[2]=-100,L[2]=this.maximums[this.childOffsets[B]+oe]*x;const de=P0(k,L,f,m);if(de!=null){const ue=de;E[oe]=ue;let Ie=!1;for(let Me=0;Me<te&&!Ie;Me++)ue>=E[A[Me]]&&(A.splice(Me,0,oe),Ie=!0);Ie||(A[te]=oe),te++}}for(let oe=0;oe<te;oe++){const de=A[oe];O.push({idx:this.childOffsets[B]+de,t:E[de],nodex:(Z<<1)+this._siblingOffset[de][0],nodey:(ee<<1)+this._siblingOffset[de][1],depth:le+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,u,f){if(e[u].isLeaf(i,l)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=u-1,x=e[m];let w=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const k=2*i+this._siblingOffset[A][0],L=2*l+this._siblingOffset[A][1],O=x.getElevation(k,L),B=x.isLeaf(k,L),V=this._addNode(O.min,O.max,B);B&&(w|=1<<A),E||(E=V)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*l+this._siblingOffset[A][1],m,E+A)}}function R0(t,e,i,l,u,f){return Ut(Ut(t,i,f),Ut(e,l,f),u)}function wo(t,e,i){const l=i.dim,u=bt(t*l-.5,0,l-1),f=bt(e*l-.5,0,l-1),m=Math.floor(u),x=Math.floor(f),w=Math.min(m+1,l-1),E=Math.min(x+1,l-1);return R0(i.get(m,x),i.get(w,x),i.get(m,E),i.get(w,E),u-m,f-x)}const O0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function $w(t,e,i){return(256*t*256+256*e+i)/10-1e4}function qw(t,e,i){return 256*t+e+i/256-32768}class Fd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,u=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Ei(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,x=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=l||"mapbox",this.borderReady=u,!u){for(let w=0;w<m;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(m,w)]=x[this._idx(m-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,m)]=x[this._idx(w,m-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(m,-1)]=x[this._idx(m-1,0)],x[this._idx(-1,m)]=x[this._idx(0,m-1)],x[this._idx(m,m)]=x[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new z0(this)}get(e,i,l=!1){l&&(e=bt(e,-1,this.dim),i=bt(i,-1,this.dim));const u=4*this._idx(e,i);return(this.encoding==="terrarium"?qw:$w)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return O0[e]}get unpackVector(){return O0[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],u=Fd.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new Hn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,m=l*this.dim,x=l*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(l){case-1:m=x-1;break;case 1:x=m+1}const w=-i*this.dim,E=-l*this.dim;for(let A=m;A<x;A++)for(let k=u;k<f;k++){const L=4*this._idx(k,A),O=4*this._idx(k+w,A+E);this.pixels[L+0]=e.pixels[O+0],this.pixels[L+1]=e.pixels[O+1],this.pixels[L+2]=e.pixels[O+2],this.pixels[L+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ut(Fd,"DEMData"),ut(z0,"DemMinMaxQuadTree",{omit:["dem"]});class Ww{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,l){const u=e.wrapped().key;this.data[u]===void 0&&(this.data[u]=[]);const f={value:i,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},l)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const l=e.wrapped().key,u=i===void 0?0:this.data[l].indexOf(i),f=this.data[l][u];return this.data[l].splice(u,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const l in this.data)for(const u of this.data[l])e(u.value)||i.push(u);for(const l of i)this.remove(l.value.tileID,l)}}class $l{constructor(e,i,l){this.func=e,this.mask=i,this.range=l}}$l.ReadOnly=!1,$l.ReadWrite=!0,$l.disabled=new $l(519,$l.ReadOnly,[0,1]);const s_=7680;class r_{constructor(e,i,l,u,f,m){this.test=e,this.ref=i,this.mask=l,this.fail=u,this.depthFail=f,this.pass=m}}r_.disabled=new r_({func:519,mask:0},0,0,s_,s_,s_);class or{constructor(e,i,l){this.blendFunction=e,this.blendColor=i,this.mask=l}}or.Replace=[1,0],or.disabled=new or(or.Replace,Bi.transparent,[!1,!1,!1,!1]),or.unblended=new or(or.Replace,Bi.transparent,[!0,!0,!0,!0]),or.alphaBlended=new or([1,771],Bi.transparent,[!0,!0,!0,!0]);const o_=1029,a_=2305;class $s{constructor(e,i,l){this.enable=e,this.mode=i,this.frontFace=l}}$s.disabled=new $s(!1,o_,a_),$s.backCCW=new $s(!0,o_,a_),$s.backCW=new $s(!0,o_,2304),$s.frontCW=new $s(!0,1028,2304),$s.frontCCW=new $s(!0,1028,a_);class Aa extends $o{constructor(e,i,l){super(),this.id=e,this._onlySymbols=l,i.on("data",u=>{u.dataType==="source"&&u.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&u.dataType==="source"&&u.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new Ww(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Gw,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return gn(this._tiles).map(e=>e.tileID).sort(B0).map(e=>e.key)}getRenderableIds(e){const i=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&i.push(this._tiles[l]);return e?i.sort((l,u)=>{const f=l.tileID,m=u.tileID,x=new De(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),w=new De(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||w.y-x.y||w.x-x.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort(B0).map(l=>l.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=i),this._loadTile(l,this._tileLoaded.bind(this,l,e,i)))}_tileLoaded(e,i,l,u){if(u)if(e.state="errored",u.status!==404)this._source.fire(new As(u,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=Ss.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new mr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let u=0;u<i.length;u++){const f=i[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const m=this.getTileByID(f);l(e,m),l(m,e)}}function l(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-u.tileID.canonical.x;const x=f.tileID.canonical.y-u.tileID.canonical.y,w=Math.pow(2,u.tileID.canonical.z),E=f.tileID.key;m===0&&x===0||Math.abs(x)>1||(Math.abs(m)>1&&(Math.abs(m+w)===1?m+=w:Math.abs(m-w)===1&&(m-=w)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,m,x),u.neighboringTiles&&u.neighboringTiles[E]&&(u.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,l,u){for(const f in this._tiles){let m=this._tiles[f];if(u[f]||!m.hasData()||m.tileID.overscaledZ<=i||m.tileID.overscaledZ>l)continue;let x=m.tileID;for(;m&&m.tileID.overscaledZ>i+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(x=E)}let w=x;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){u[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=e.overscaledZ-1;l>=i;l--){const u=e.scaledTo(l),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const l=Math.ceil(e.width/i)+1,u=Math.ceil(e.height/i)+1,f=Math.floor(l*u*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(x)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const l={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),l[f.tileID.key]=f}this._tiles=l;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,i,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let u;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new An(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(u=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(x=>this._source.hasTile(x)))):u=[];const f=this._updateRetainedTiles(u);if(F0(this._source.type)&&u.length!==0){const x={},w={},E=Object.keys(f);for(const k of E){const L=f[k],O=this._tiles[k];if(!O||O.fadeEndTime&&O.fadeEndTime<=Ss.now())continue;const B=this.findLoadedParent(L,Math.max(L.overscaledZ-Aa.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),x[B.tileID.key]=B.tileID),w[k]=L}const A=u[u.length-1].overscaledZ;for(const k in this._tiles){const L=this._tiles[k];if(f[k]||!L.hasData())continue;let O=L.tileID;for(;O.overscaledZ>A;){O=O.scaledTo(O.overscaledZ-1);const B=this._tiles[O.key];if(B&&B.hasData()&&w[O.key]){f[k]=L.tileID;break}}}for(const k in x)f[k]||(this._coveredTiles[k]=!0,f[k]=x[k])}for(const x in f)this._tiles[x].clearFadeHold();const m=function(x,w){const E=[];for(const A in x)A in w||E.push(A);return E}(this._tiles,f);for(const x of m){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const l={},u=e.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),f=e[0].overscaledZ,m=Math.max(f-Aa.maxOverzooming,this._source.minzoom),x=Math.max(f+Aa.maxUnderzooming,this._source.minzoom),w={};for(const E of e){const A=this._addTile(E);i[E.key]=E,A.hasData()||u<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,u,x,i);for(const E of e){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const L=E.children(this._source.maxzoom)[0],O=this.getTile(L);if(O&&O.hasData()){i[L.key]=L;continue}}else{const L=E.children(this._source.maxzoom);if(i[L[0].key]&&i[L[1].key]&&i[L[2].key]&&i[L[3].key])continue}let k=A.wasRequested();for(let L=E.overscaledZ-1;L>=m;--L){const O=E.scaledTo(L);if(l[O.key]||(l[O.key]=!0,A=this.getTile(O),!A&&k&&(A=this._addTile(O)),A&&(i[O.key]=O,k=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let l,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){l=this._loadedParentTiles[u.key];break}i.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;u=f}for(const f of i)this._loadedParentTiles[f]=l}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const l=!!i;if(!l){const u=this.map?this.map.painter:null;i=new n_(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,l||this._source.fire(new mr("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=i.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,l){const u=[],f=this.transform;if(!f)return u;const m=f.projection.name==="globe",x=ir(f.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(l&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(m){const k=E.tileID.canonical;if(k.z===0){const L=[Math.abs(bt(x,...Lh(k,-1))-x),Math.abs(bt(x,...Lh(k,1))-x)];A=[0,2*L.indexOf(Math.min(...L))-1]}else{const L=[Math.abs(bt(x,...Lh(k,-1))-x),Math.abs(bt(x,...Lh(k,0))-x),Math.abs(bt(x,...Lh(k,1))-x)];A=[L.indexOf(Math.min(...L))-1]}}else A=[0];for(const k of A){const L=e.containsTile(E,f,i,k);L&&u.push(L)}}return u}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of i)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(F0(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Ss.now())return!0}return!1}setFeatureState(e,i,l){this._state.updateState(e=e||"_geojsonTileLayer",i,l)}removeFeatureState(e,i,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,l)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,l){const u=this._tiles[e];u&&u.setDependencies(i,l)}reloadTilesForDependencies(e,i){for(const l in this._tiles)this._tiles[l].hasDependency(e,i)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(e,i))};return void this._source.on("data",x)}const l=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const x of u){const w=x.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)l.set(E.key,E);this.usedForTerrain&&x.updateElevation(!1)}ki(Array.from(l.values()),(x,w)=>{const E=new n_(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(A,E)})},i)}}function B0(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||l-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function F0(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Lh(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Aa.maxOverzooming=10,Aa.maxUnderzooming=3;class Nd{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const u=l||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,m=u.tileID,x=1<<i.canonical.z-m.canonical.z;return new Nd(u,u.tileSize/yt/x,[(i.canonical.x/x-m.canonical.x)*f.dim,(i.canonical.y/x-m.canonical.y)*f.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(l);return new De(u,f)}getElevationAt(e,i,l,u){const f=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],x=Math.floor(f),w=Math.floor(m),E=this._dem;return u=!!u,l?Ut(Ut(E.get(x,w,u),E.get(x,w+1,u),m-w),Ut(E.get(x+1,w,u),E.get(x+1,w+1,u),m-w),f-x):E.get(x,w,u)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Vs(1,e)*this._dem.stride}}class N0{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Tr(yt,16,0),this.featureIndexArray=new _a,this.promoteId=i}insert(e,i,l,u,f,m=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,u,f,m);const w=this.grid;for(let E=0;E<i.length;E++){const A=i[E],k=[1/0,1/0,-1/0,-1/0];for(let L=0;L<A.length;L++){const O=A[L];k[0]=Math.min(k[0],O.x),k[1]=Math.min(k[1],O.y),k[2]=Math.max(k[2],O.x),k[3]=Math.max(k[3],O.y)}k[0]<yt&&k[1]<yt&&k[2]>=0&&k[3]>=0&&w.insert(x,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Vf(new Md(this.rawTileData)).layers,this.sourceLayerCoder=new E0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,l,u){this.loadVTLayers();const f=e.params||{},m=xl(f.filter),x=e.tileResult,w=e.transform,E=x.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(B,V,Z,ee)=>hg(x.bufferedTilespaceGeometry,B,V,Z,ee));A.sort(Zw);let k=null;w.elevation&&A.length>0&&(k=Nd.create(w.elevation,this.tileID));const L={};let O;for(let B=0;B<A.length;B++){const V=A[B];if(V===O)continue;O=V;const Z=this.featureIndexArray.get(V);let ee=null;this.loadMatchingFeature(L,Z,m,f.layers,f.availableImages,i,l,u,(le,te,oe,de=0)=>(ee||(ee=Pr(le,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(x,le,oe,ee,this.z,e.transform,e.pixelPosMatrix,k,de)))}return L}loadMatchingFeature(e,i,l,u,f,m,x,w,E){const{featureIndex:A,bucketIndex:k,sourceLayerIndex:L,layoutVertexArrayOffset:O}=i,B=this.bucketLayerIDs[k];if(u&&!function(le,te){for(let oe=0;oe<le.length;oe++)if(te.indexOf(le[oe])>=0)return!0;return!1}(u,B))return;const V=this.sourceLayerCoder.decode(L),Z=this.vtLayers[V].feature(A);if(l.needGeometry){const le=Ta(Z,!0);if(!l.filter(new P(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!l.filter(new P(this.tileID.overscaledZ),Z))return;const ee=this.getId(Z,V);for(let le=0;le<B.length;le++){const te=B[le];if(u&&u.indexOf(te)<0)continue;const oe=m[te];if(!oe)continue;let de={};ee!==void 0&&w&&(de=w.getState(oe.sourceLayer||"_geojsonTileLayer",ee));const ue=_i({},x[te]);ue.paint=j0(ue.paint,oe.paint,Z,de,f),ue.layout=j0(ue.layout,oe.layout,Z,de,f);const Ie=!E||E(Z,oe,de,O);if(!Ie)continue;const Me=new M0(Z,this.z,this.x,this.y,ee);Me.layer=ue;let Be=e[te];Be===void 0&&(Be=e[te]=[]),Be.push({featureIndex:A,feature:Me,intersectionZ:Ie})}}lookupSymbolFeatures(e,i,l,u,f,m,x,w){const E={};this.loadVTLayers();const A=xl(f);for(const k of e)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:u,featureIndex:k,layoutVertexArrayOffset:0},A,m,x,w,i);return E}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(l),f=this.vtFeatures[u];if(f[i])return f[i];const m=this.vtLayers[u].feature(i);return f[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const u=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];u!=null&&(l=e.properties[u]),typeof l=="boolean"&&(l=Number(l))}return l}}function j0(t,e,i,l,u){return Nt(t,(f,m)=>{const x=e instanceof Q?e.get(m):null;return x&&x.evaluate?x.evaluate(i,l,u):x})}function Zw(t,e){return e-t}ut(N0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class V0{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new kr({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=Es(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const u=[];let f=e.length%2==1?-e[e.length-1]*l:0,m=e[0]*l,x=!0;u.push({left:f,right:m,isDash:x,zeroLength:e[0]===0});let w=e[0];for(let E=1;E<e.length;E++){x=!x;const A=e[E];f=w*l,w+=A,m=w*l,u.push({left:f,right:m,isDash:x,zeroLength:A===0})}return u}addRoundDash(e,i,l){const u=i/2;for(let f=-l;f<=l;f++){const m=this.width*(this.nextRow+l+f);let x=0,w=e[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=e[++x]);const A=Math.abs(E-w.left),k=Math.abs(E-w.right),L=Math.min(A,k);let O;const B=f/l*(u+1);if(w.isDash){const V=u-Math.abs(B);O=Math.sqrt(L*L+V*V)}else O=u-Math.sqrt(L*L+B*B);this.image.data[m+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const E=e[w],A=e[w+1];E.zeroLength?e.splice(w,1):A&&A.isDash===E.isDash&&(A.left=E.left,e.splice(w,1))}const l=e[0],u=e[e.length-1];l.isDash===u.isDash&&(l.left=u.left-this.width,u.right=l.right+this.width);const f=this.width*this.nextRow;let m=0,x=e[m];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++m]);const E=Math.abs(w-x.left),A=Math.abs(w-x.right),k=Math.min(E,A);this.image.data[f+w]=Math.max(0,Math.min(255,(x.isDash?k:-k)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const u=i==="round",f=u?7:0,m=2*f+1;if(this.nextRow+m>this.height)return Ei("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let A=0;A<e.length;A++)e[A]<0&&(Ei("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),x+=e[A];if(x!==0){const A=this.width/x,k=this.getDashRanges(e,this.width,A);u?this.addRoundDash(k,A,f):this.addRegularDash(k,i==="square"?.5*A:0)}const w=this.nextRow+f;this.nextRow+=m;const E={tl:[w,f],br:[x,0]};return this.positions[l]=E,E}}ut(V0,"LineAtlas");const U0=1*Gs;class G0{constructor(e){const i={},l=[];for(const x in e){const w=e[x],E=i[x]={};for(const A in w.glyphs){const k=w.glyphs[+A];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const L=k.metrics.localGlyph?U0:1,O={x:0,y:0,w:k.bitmap.width+2*L,h:k.bitmap.height+2*L};l.push(O),E[A]=O}}const{w:u,h:f}=qf(l),m=new kr({width:u||1,height:f||1});for(const x in e){const w=e[x];for(const E in w.glyphs){const A=w.glyphs[+E];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const k=i[x][E],L=A.metrics.localGlyph?U0:1;kr.copy(A.bitmap,m,{x:0,y:0},{x:k.x+L,y:k.y+L},A.bitmap)}}this.image=m,this.positions=i}}ut(G0,"GlyphAtlas");class Hw{constructor(e){this.tileID=new An(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Sa(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,l,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new ri;const m=new E0(Object.keys(e.layers).sort()),x=new N0(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},E=new V0(256,256),A={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:l},k=i.familiesBySource[this.source];for(const de in k){const ue=e.layers[de];if(!ue)continue;let Ie=!1,Me=!1;for(const Pe of k[de])Pe[0].type==="symbol"?Ie=!0:Me=!0;if(this.isSymbolTile===!0&&!Ie||this.isSymbolTile===!1&&!Me)continue;ue.version===1&&Ei(`Vector tile source "${this.source}" layer "${de}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Be=m.encode(de),He=[];for(let Pe=0;Pe<ue.length;Pe++){const Ve=ue.feature(Pe),Ue=x.getId(Ve,de);He.push({feature:Ve,id:Ue,index:Pe,sourceLayerIndex:Be})}for(const Pe of k[de]){const Ve=Pe[0];this.isSymbolTile!==void 0&&Ve.type==="symbol"!==this.isSymbolTile||Ve.minzoom&&this.zoom<Math.floor(Ve.minzoom)||Ve.maxzoom&&this.zoom>=Ve.maxzoom||Ve.visibility!=="none"&&(l_(Pe,this.zoom,l),(w[Ve.id]=Ve.createBucket({index:x.bucketLayerIDs.length,layers:Pe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Be,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(He,A,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Pe.map(Ue=>Ue.id)))}}let L,O,B,V;E.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=()=>{if(L)return f(L);if(O&&B&&V){const de=new G0(O),ue=new Yg(B,V);for(const Ie in w){const Me=w[Ie];Me instanceof xo?(l_(Me.layers,this.zoom,l),vw(Me,O,de.positions,B,ue.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):Me.hasPattern&&(Me instanceof wd||Me instanceof gd||Me instanceof vh)&&(l_(Me.layers,this.zoom,l),Me.addFeatures(A,this.tileID.canonical,ue.patternPositions,l,this.tileTransform))}this.status="done",f(null,{buckets:gn(w).filter(Ie=>!Ie.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:de.image,lineAtlas:E,imageAtlas:ue,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?de.positions:null})}},le=Nt(A.glyphDependencies,de=>Object.keys(de).map(Number));Object.keys(le).length?u.send("getGlyphs",{uid:this.uid,stacks:le},(de,ue)=>{L||(L=de,O=ue,ee())},void 0,!1,Z):O={};const te=Object.keys(A.iconDependencies);te.length?u.send("getImages",{icons:te,source:this.source,tileID:this.tileID,type:"icons"},(de,ue)=>{L||(L=de,B=ue,ee())},void 0,!1,Z):B={};const oe=Object.keys(A.patternDependencies);oe.length?u.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"patterns"},(de,ue)=>{L||(L=de,V=ue,ee())},void 0,!1,Z):V={},ee()}}function l_(t,e,i){const l=new P(e);for(const u of t)u.recalculate(l,i)}class $0{constructor(e){this.entries={},this.scheduler=e}request(e,i,l,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[m,x]=f.result;return this.scheduler?this.scheduler.add(()=>{u(m,x)},i):u(m,x),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=l((m,x)=>{f.result=[m,x];for(const w of f.callbacks)this.scheduler?this.scheduler.add(()=>{w(m,x)},i):w(m,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function q0(t,e,i){const l=JSON.stringify(t.request);return t.data&&(this.deduped.entries[l]={result:[null,t.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const f=Wr(t.request,(m,x,w,E)=>{m?u(m):x&&u(null,{vectorTile:i?void 0:new Vf(new Md(x)),rawData:x,cacheControl:w,expires:E})});return()=>{f.cancel(),u()}},e)}const W0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class c_{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=l>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=W0[15&l];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new c_(x,m,f,e)}constructor(e,i=64,l=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=W0.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return h_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:x}=this,w=[0,f.length-1,0],E=[];for(;w.length;){const A=w.pop()||0,k=w.pop()||0,L=w.pop()||0;if(k-L<=x){for(let Z=L;Z<=k;Z++){const ee=m[2*Z],le=m[2*Z+1];ee>=e&&ee<=l&&le>=i&&le<=u&&E.push(f[Z])}continue}const O=L+k>>1,B=m[2*O],V=m[2*O+1];B>=e&&B<=l&&V>=i&&V<=u&&E.push(f[O]),(A===0?e<=B:i<=V)&&(w.push(L),w.push(O-1),w.push(1-A)),(A===0?l>=B:u>=V)&&(w.push(O+1),w.push(k),w.push(1-A))}return E}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,x=[0,u.length-1,0],w=[],E=l*l;for(;x.length;){const A=x.pop()||0,k=x.pop()||0,L=x.pop()||0;if(k-L<=m){for(let Z=L;Z<=k;Z++)H0(f[2*Z],f[2*Z+1],e,i)<=E&&w.push(u[Z]);continue}const O=L+k>>1,B=f[2*O],V=f[2*O+1];H0(B,V,e,i)<=E&&w.push(u[O]),(A===0?e-l<=B:i-l<=V)&&(x.push(L),x.push(O-1),x.push(1-A)),(A===0?e+l>=B:i+l>=V)&&(x.push(O+1),x.push(k),x.push(1-A))}return w}}function h_(t,e,i,l,u,f){if(u-l<=i)return;const m=l+u>>1;Z0(t,e,m,l,u,f),h_(t,e,i,l,m-1,1-f),h_(t,e,i,m+1,u,1-f)}function Z0(t,e,i,l,u,f){for(;u>l;){if(u-l>600){const E=u-l+1,A=i-l+1,k=Math.log(E),L=.5*Math.exp(2*k/3),O=.5*Math.sqrt(k*L*(E-L)/E)*(A-E/2<0?-1:1);Z0(t,e,i,Math.max(l,Math.floor(i-A*L/E+O)),Math.min(u,Math.floor(i+(E-A)*L/E+O)),f)}const m=e[2*i+f];let x=l,w=u;for(Dh(t,e,l,i),e[2*u+f]>m&&Dh(t,e,l,u);x<w;){for(Dh(t,e,x,w),x++,w--;e[2*x+f]<m;)x++;for(;e[2*w+f]>m;)w--}e[2*l+f]===m?Dh(t,e,l,w):(w++,Dh(t,e,w,u)),w<=i&&(l=w+1),i<=w&&(u=w-1)}}function Dh(t,e,i,l){u_(t,i,l),u_(e,2*i,2*l),u_(e,2*i+1,2*l+1)}function u_(t,e,i){const l=t[e];t[e]=t[i],t[i]=l}function H0(t,e,i,l){const u=t-i,f=e-l;return u*u+f*f}r.ARRAY_TYPE=Zn,r.AUTH_ERR_MSG=pe,r.Aabb=Sn,r.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},ur(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ms()?t:T,this.scheduler=new Vw}send(t,e,i,l,u=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[m]=i);const x=Gr(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:t,hasCallback:!!i,targetMapId:l,mustQueue:u,sourceMapId:this.mapId,data:ho(e,x)},x),{cancel:()=>{i&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const l=this.cancelCallbacks[i];delete this.cancelCallbacks[i],l&&l.cancel()}else if(e.mustQueue||Ms()){const l=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),l&&l.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Er(e.error)):i(null,Er(e.data)))}else{const i=Gr(this.globalScope)?void 0:[],l=e.hasCallback?(f,m)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?ho(f):null,data:ho(m,i)},i)}:f=>{},u=Er(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,l);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},r.CanonicalTileID=bd,r.Color=Bi,r.ColorMode=or,r.CullFaceMode=$s,r.DEMData=Fd,r.DataConstantProperty=j,r.DedupedRequest=$0,r.DepthMode=$l,r.EXTENT=yt,r.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,u=Math.floor(t.x),f=Math.floor((t.x-u)*l),m=Math.floor(t.y*l),x=this.findDEMTileFor(new An(i,u,i,f,m));return!(!x||!x.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||t.y<0||t.y>1)return e;const u=l.getSource().maxzoom,f=1<<u,m=Math.floor(t.x),x=t.x-m,w=new An(u,m,u,Math.floor(x*f),Math.floor(t.y*f)),E=this.findDEMTileFor(w);if(!E||!E.dem)return e;const A=E.dem,k=1<<E.tileID.canonical.z,L=(x*k-E.tileID.canonical.x)*A.dim,O=(t.y*k-E.tileID.canonical.y)*A.dim,B=Math.floor(L),V=Math.floor(O);return(i?this.exaggeration():1)*Ut(Ut(A.get(B,V),A.get(B,V+1),O-V),Ut(A.get(B+1,V),A.get(B+1,V+1),O-V),L-B)}getAtTileOffset(t,e,i){const l=1<<t.canonical.z;return this.getAtPointOrZero(new Pl(t.wrap+(t.canonical.x+e/yt)/l,(t.canonical.y+i/yt)/l))}getAtTileOffsetFunc(t,e,i,l){return u=>{const f=this.getAtTileOffset(t,u.x,u.y),m=l.upVector(t.canonical,u.x,u.y);return ns(m,m,f*l.upVectorScale(t.canonical,e,i).metersToTile),m}}getForTilePoints(t,e,i,l){if(this.isUsingMockSource())return!1;const u=Nd.create(this,t,l);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,u=1<<t.canonical.z-l.canonical.z;let f=t.canonical.x/u-l.canonical.x,m=t.canonical.y/u-l.canonical.y,x=0;for(let w=0;w<t.canonical.z-l.canonical.z&&!i.leaves[x];w++){f*=2,m*=2;const E=2*Math.floor(m)+Math.floor(f);x=i.childOffsets[x]+E,f%=1,m%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},r.ErrorEvent=As,r.EvaluationParameters=P,r.Event=mr,r.Evented=$o,r.FillExtrusionBucket=vh,r.Frustum=yf,r.FrustumCorners=gf,r.GLOBE_RADIUS=er,r.GLOBE_SCALE_MATCH_LATITUDE=45,r.GLOBE_ZOOM_THRESHOLD_MAX=Zm,r.GLOBE_ZOOM_THRESHOLD_MIN=xf,r.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const i=new Ze,l=new _t,u=[],f=t+1+2,m=e[0]+1,x=e[0]+1+(1+e.length),w=(E,A,k)=>{let L=E===f-1?E-2:E===0?E:E-1;return L+=k?24575:0,[L,A]};for(let E=0;E<f;++E)i.emplaceBack(...w(E,0,!0));for(let E=0;E<m;++E)for(let A=0;A<f;++A)i.emplaceBack(...w(A,E,(A===0||A===f-1)&&!0));for(let E=0;E<e.length;++E){const A=e[E];for(let k=0;k<f;++k)i.emplaceBack(...w(k,A,!0))}for(let E=0;E<e.length;++E){const A=l.length,k=e[E]+1+2,L=new _t;for(let V=0;V<k-1;V++){const Z=V===k-2,ee=Z?f*(x-e.length+E-V):f;for(let le=0;le<f-1;le++){const te=V*f+le;V===0||Z||le===0||le===f-2?(L.emplaceBack(te+1,te,te+ee),L.emplaceBack(te+ee,te+ee+1,te+1)):(l.emplaceBack(te+1,te,te+ee),l.emplaceBack(te+ee,te+ee+1,te+1))}}const O=Ui.simpleSegment(0,A,i.length,l.length-A);for(let V=0;V<L.uint16.length;V+=3)l.emplaceBack(L.uint16[V],L.uint16[V+1],L.uint16[V+2]);const B=Ui.simpleSegment(0,A,i.length,l.length-A);u.push({withoutSkirts:O,withSkirts:B})}return{vertices:i,indices:l,segments:u}}_createGrid(t){const e=this._fillGridMeshWithLods(ba,hh);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,ch.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new _t;for(let u=0;u<=ba;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new si,l=new si;this._poleSegments=[];for(let u=0,f=0;u<xf;u++){const m=360/(1<<u);i.emplaceBack(0,-er,0,.5,0),l.emplaceBack(0,-er,0,.5,1);for(let x=0;x<=ba;x++){const w=x/ba,E=Ut(0,m,w),[A,k,L]=Al(Vv,Uv,E,er);i.emplaceBack(A,k,L,w,0),l.emplaceBack(A,k,L,w,1)}this._poleSegments.push(Ui.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,qm,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(l,qm,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new nn,l=ba,u=l+1+2,f=1;this._wireframeSegments=[];for(let m=0,x=0;m<hh.length;m++){const w=hh[m];for(let A=f;A<w+f;A++)for(let k=f;k<l+f;k++){const L=A*u+k;i.emplaceBack(L,L+1),i.emplaceBack(L,L+u),i.emplaceBack(L,L+u+1)}const E=w*l*3;this._wireframeSegments.push(Ui.simpleSegment(0,x,(w+1)*u,E)),x+=E}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},r.GlyphManager=Nl,r.ImagePosition=Wf,r.KDBush=c_,r.LivePerformanceUtils=Fp,r.LngLat=oi,r.LngLatBounds=_o,r.LocalGlyphMode=Xf,r.MAX_MERCATOR_LATITUDE=_n,r.MercatorCoordinate=Pl,r.ONE_EM=ln,r.OverscaledTileID=An,r.PerformanceMarkers=Zr,r.Point=De,r.Properties=se,r.RGBAImage=Hn,r.Ray=mf,r.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Le,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ye(t))return t;const i=it(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ye(t))return t;const i=it(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,l){if(!ye(t))return t;const u=it(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),i&&u.params.push(`language=${i}`),l&&u.params.push(`worldview=${l}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,l){const u=it(t);return ye(t)?(u.path=`/styles/v1${u.path}/sprite${e}${i}`,this._makeAPIURL(u,this._customAccessToken||l)):(u.path+=`${e}${i}`,Ke(u))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ye(t))return t;const l=it(t);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&l.authority!=="raster"&&i===512?"@2x":""}${U.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${F.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${F.TILE_URL_VERSION}${l.path}`);const u=this._customAccessToken||function(f){for(const m of f){const x=m.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,u)}canonicalizeTileURL(t,e){const i=it(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let l="mapbox://";i.path.match(/^\/raster\/v1\//)?l+=`raster/${i.path.replace(`/${F.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${i.path.replace(`/${F.TILE_URL_VERSION}/`,"")}`;let u=i.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(l+=`?${u.join("&")}`),l}canonicalizeTileset(t,e){const i=!!e&&ye(e),l=[];for(const u of t.tiles||[])Te(u)?l.push(this.canonicalizeTileURL(u,i)):l.push(u);return l}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=it(F.API_URL);if(t.protocol=l.protocol,t.authority=l.authority,t.protocol==="http"){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if(l.path!=="/"&&(t.path=`${l.path}${t.path}`),!F.REQUIRE_ACCESS_TOKEN)return Ke(t);if(e=e||F.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(u=>u.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ke(t)}},r.ResourceType=pr,r.SegmentVector=Ui,r.SourceCache=Aa,r.StencilMode=r_,r.StructArrayLayout1ui2=Wn,r.StructArrayLayout2f1f2i16=xt,r.StructArrayLayout2i4=Ze,r.StructArrayLayout2ui4=nn,r.StructArrayLayout3f12=Lt,r.StructArrayLayout3ui6=_t,r.StructArrayLayout4i8=je,r.StructArrayLayout5f20=si,r.Texture=kh,r.Tile=n_,r.Transitionable=N,r.Uniform1f=sd,r.Uniform1i=class extends Ar{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},r.Uniform2f=class extends Ar{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},r.Uniform3f=class extends Ar{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},r.Uniform4f=Im,r.UniformColor=Cm,r.UniformMatrix2f=class extends Ar{constructor(t){super(t),this.current=Mv}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let l=0;l<4;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},r.UniformMatrix3f=class extends Ar{constructor(t){super(t),this.current=Ev}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.UniformMatrix4f=class extends Ar{constructor(t){super(t),this.current=Tv}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let l=1;l<16;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},r.UnwrappedTileID=Rg,r.ValidationError=ht,r.VectorTileFeature=xd,r.VectorTileWorkerSource=class extends $o{constructor(t,e,i,l,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=u||q0,this.loading={},this.loaded={},this.deduped=new $0(t.scheduler),this.isSpriteLoaded=l,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,l=t&&t.request,u=l&&l.collectResourceTiming,f=this.loading[i]=new Hw(t);f.abort=this.loadVectorData(t,(m,x)=>{const w=!this.loading[i];if(delete this.loading[i],w||m||!x)return f.status="done",w||(this.loaded[i]=f),e(m);const E=x.rawData,A={};x.expires&&(A.expires=x.expires),x.cacheControl&&(A.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new Vf(new Md(E));const k=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(L,O)=>{if(L||!O)return e(L);const B={};if(u){const V=oc(l);V.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify(V)))}e(null,_i({rawTileData:E.slice(0)},O,A,B))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(t,e){const i=this.loaded,l=t.uid,u=this;if(i&&i[l]){const f=i[l];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection,f.tileTransform=Sa(t.tileID.canonical,t.projection);const m=(x,w)=>{const E=f.reloadCallback;E&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,E)),e(x,w)};f.status==="parsing"?f.reloadCallback=m:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(t,e){const i=t.uid,l=this.loading[i];l&&(l.abort&&l.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,l=t.uid;i&&i[l]&&delete i[l],e()}},r.WritingMode=rs,r.ZoomDependentExpression=la,r.add=Cr,r.addDynamicAttributes=Rd,r.adjoint=function(t,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=e[4],x=e[5],w=e[6],E=e[7],A=e[8];return t[0]=m*A-x*E,t[1]=u*E-l*A,t[2]=l*x-u*m,t[3]=x*w-f*A,t[4]=i*A-u*w,t[5]=u*f-i*x,t[6]=f*E-m*w,t[7]=l*w-i*E,t[8]=i*m-l*f,t},r.asyncAll=ki,r.bezier=ti,r.bindAll=ur,r.boundsAttributes=A0,r.bufferConvexPolygon=function(t,e){const i=[];for(let l=0;l<t.length;l++){const u=vi(l-1,-1,t.length-1),f=vi(l+1,-1,t.length-1),m=t[l],x=t[f],w=t[u].sub(m).unit(),E=x.sub(m).unit(),A=E.angleWithSep(w.x,w.y),k=w.add(E).unit().mult(-1*e/Math.sin(A/2));i.push(m.add(k))}return i},r.cacheEntryPossiblyAdded=function(t){Uo++,Uo>Za&&(t.getActor().send("enforceCacheSizeLimit",Wa),Uo=0)},r.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:l}=t.point,u=Jm(i,l,t.worldSize/t._pixelsPerMercatorPixel,0,0);return ya(u,u,wf(tr(e)))},r.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:l,lat:u}=t._center;return Jm(e,i,t.worldSize,l,u)},r.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/Vs(1,t.center.lat),l=Ns(new Float64Array(16));return nh(l,l,[t.point.x,t.point.y,0]),xa(l,l,[i,i,e]),Float32Array.from(l)},r.circumferenceAtLatitude=Ef,r.clamp=bt,r.clearTileCache=function(t){if(!Vo())return;const e=T.caches.delete($r);t&&e.catch(t).then(()=>t())},r.clipLine=c0,r.clone=function(t){var e=new Zn(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},r.clone$1=zn,r.collisionCircleLayout=Wb,r.config=F,r.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},r.create=function(){var t=new Zn(16);return Zn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},r.create$1=Lm,r.createExpression=ao,r.createLayout=xe,r.createStyleLayer=function(t){return t.type==="custom"?new Bw(t):new Nw[t.type](t)},r.cross=_f,r.degToRad=ft,r.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},r.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},r.dot=gs,r.earthRadius=ph,r.ease=xi,r.easeCubicInOut=Kt,r.ecefToLatLng=function([t,e,i]){const l=Math.hypot(t,e,i),u=Math.atan2(t,i),f=.5*Math.PI-Math.acos(-e/l);return new oi(Gt(u),Gt(f))},r.emitValidationErrors=Ju,r.endsWith=Vr,r.enforceCacheSizeLimit=function(t){dr(),Vn&&Vn.then(e=>{e.keys().then(i=>{for(let l=0;l<i.length-t;l++)e.delete(i[l])})})},r.evaluateSizeForFeature=Td,r.evaluateSizeForZoom=Rl,r.evaluateVariableOffset=f0,r.evented=y,r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},r.exported=Ss,r.exported$1=U,r.extend=_i,r.extend$1=Is,r.fillExtrusionHeightLift=Lg,r.filterObject=Ur,r.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},r.fromQuat=function(t,e){var i=e[0],l=e[1],u=e[2],f=e[3],m=i+i,x=l+l,w=u+u,E=i*m,A=l*m,k=l*x,L=u*m,O=u*x,B=u*w,V=f*m,Z=f*x,ee=f*w;return t[0]=1-k-B,t[1]=A+ee,t[2]=L-Z,t[3]=0,t[4]=A-ee,t[5]=1-E-B,t[6]=O+V,t[7]=0,t[8]=L+Z,t[9]=O-V,t[10]=1-E-k,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotation=function(t,e){var i=Math.sin(e),l=Math.cos(e);return t[0]=l,t[1]=i,t[2]=0,t[3]=-i,t[4]=l,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromScaling=zm,r.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return on[e]},r.getAABBPointSquareDist=function(t,e,i){let l=0;for(let u=0;u<2;++u){const f=i?i[u]:0;t[u]>f&&(l+=(t[u]-f)*(t[u]-f)),e[u]<f&&(l+=(f-e[u])*(f-e[u]))}return l},r.getAnchorAlignment=Hf,r.getAnchorJustification=Kf,r.getBounds=function(t){let e=1/0,i=1/0,l=-1/0,u=-1/0;for(const f of t)e=Math.min(e,f.x),i=Math.min(i,f.y),l=Math.max(l,f.x),u=Math.max(u,f.y);return{min:new De(e,i),max:new De(l,u)}},r.getColumn=Hs,r.getDefaultExportFromCjs=Fe,r.getGridMatrix=function(t,e,i,l){const u=e.getNorth(),f=e.getSouth(),m=e.getWest(),x=e.getEast(),w=1<<t.z,E=x-m,A=u-f,k=E/ba,L=-A/hh[i],O=[0,k,0,L,0,0,u,m,0];if(t.z>0){const B=180/l;Dm(O,O,[B/E+1,0,0,0,B/A+1,0,-.5*B/k,.5*B/L,1])}return O[2]=w,O[5]=t.x,O[8]=t.y,O},r.getImage=re,r.getJSON=function(t,e){return _r(_i(t,{type:"json"}),e)},r.getLatitudinalLod=function(t){const e=_n-5;t=bt(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(ft(t))),3);return Math.round(i*(hh.length-1))},r.getMapSessionAPI=Qi,r.getPerformanceMeasurement=oc,r.getProjection=w0,r.getRTLTextPluginStatus=b,r.getReferrer=fr,r.getTilePoint=function(t,{x:e,y:i},l=0){return new De(((e-l)*t.scale-t.x)*yt,(i*t.scale-t.y)*yt)},r.getTileVec3=function(t,e,i=0){return Sl(((e.x-i)*t.scale-t.x)*yt,(e.y*t.scale-t.y)*yt,ig(e.z,e.y))},r.getVideo=function(t,e){const i=T.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<t.length;l++){const u=T.document.createElement("source");Ha(t[l])||(i.crossOrigin="Anonymous"),u.src=t[l],i.appendChild(u)}return{cancel:()=>{}}},r.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=Ns(new Float64Array(16));return ya(i,t.pixelMatrix,t.globeMatrix),Fi(e,e,i),new De(e[0],e[1])},r.globeDenormalizeECEF=wf,r.globeECEFOrigin=function(t,e){const i=[0,0,0];return Fi(i,i,dh(tr(e.canonical))),Fi(i,i,t),i},r.globeMetersToEcef=ad,r.globeNormalizeECEF=dh,r.globePixelsToTileUnits=function(t,e){return yt/(512*Math.pow(2,t))*cd(tr(e))},r.globePoleMatrixForTile=function(t,e,i){const l=Ns(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return od(l,i.globeMatrix,u),Float32Array.from(l)},r.globeTileBounds=tr,r.globeTiltAtLngLat=Qm,r.globeToMercatorTransition=Cl,r.globeUseCustomAntiAliasing=function(t,e,i){const l=Cl(i.zoom),u=t.style.map._antialias,f=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return l===0&&!u&&!m&&f},r.identity=Ns,r.identity$1=Um,r.invert=uf,r.isFullscreen=function(){return!!T.document.fullscreenElement||!!T.document.webkitFullscreenElement},r.isLngLatBehindGlobe=Tf,r.isMapAuthenticated=function(t){return yn.has(t)},r.isMapboxURL=ye,r.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Gr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.latFromMercatorY=fn,r.latLngToECEF=Il,r.len=zv,r.length=sh,r.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},r.lngFromMercatorX=ss,r.loadVectorTile=q0,r.makeRequest=_r,r.mapValue=function(t,e,i,l,u){return bt((t-e)/(i-e)*(u-l)+l,l,u)},r.mercatorScale=ng,r.mercatorXfromLng=ir,r.mercatorYfromLat=nr,r.mercatorZfromAltitude=Vs,r.mul=Lv,r.mul$1=Dv,r.multiply=ya,r.multiply$1=Dm,r.multiply$2=Bm,r.nextPowerOfTwo=Es,r.normalize=Mn,r.normalize$1=Rv,r.normalize$2=jm,r.number=Ut,r.ortho=function(t,e,i,l,u,f,m){var x=1/(e-i),w=1/(l-u),E=1/(f-m);return t[0]=-2*x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*w,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*E,t[11]=0,t[12]=(e+i)*x,t[13]=(u+l)*w,t[14]=(m+f)*E,t[15]=1,t},r.pbf=Ug,r.perspective=function(t,e,i,l,u){var f,m=1/Math.tan(e/2);return t[0]=m/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,u!=null&&u!==1/0?(t[10]=(u+l)*(f=1/(l-u)),t[14]=2*u*l*f):(t[10]=-1,t[14]=-2*l),t},r.pick=function(t,e){const i={};for(let l=0;l<e.length;l++){const u=e[l];u in t&&(i[u]=t[u])}return i},r.plugin=S,r.pointGeometry=nt,r.polesInViewport=function(t){const e=Ns(new Float64Array(16));ya(e,t.pixelMatrix,t.globeMatrix);const i=[0,ys,0],l=[0,xs,0];return Fi(i,i,e),Fi(l,l,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!Tf(t,new oi(t.center.lat,90)),l[0]>0&&l[0]<=t.width&&l[1]>0&&l[1]<=t.height&&!Tf(t,new oi(t.center.lat,-90))]},r.polygonContainsPoint=Ea,r.polygonIntersectsBox=hg,r.polygonIntersectsPolygon=og,r.polygonizeBounds=function(t,e,i=0,l=!0){const u=new De(i,i),f=t.sub(u),m=e.add(u),x=[f,new De(m.x,f.y),m,new De(f.x,m.y)];return l&&x.push(f.clone()),x},r.posAttributes=ch,r.postMapLoadEvent=Ni,r.postPerformanceEvent=Hi,r.postTurnstileEvent=jt,r.potpack=qf,r.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.radToDeg=Gt,r.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.registerForPluginStateChange=function(t){return t({pluginStatus:p,pluginURL:s}),y.on("pluginStateChange",t),t},r.removeAuthState=function(t){yn.delete(t)},r.renderColorRamp=Lf,r.resample=sg,r.rotateX=df,r.rotateX$1=Gm,r.rotateY=od,r.rotateY$1=$m,r.rotateZ=function(t,e,i){var l=Math.sin(i),u=Math.cos(i),f=e[0],m=e[1],x=e[2],w=e[3],E=e[4],A=e[5],k=e[6],L=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u+E*l,t[1]=m*u+A*l,t[2]=x*u+k*l,t[3]=w*u+L*l,t[4]=E*u-f*l,t[5]=A*u-m*l,t[6]=k*u-x*l,t[7]=L*u-w*l,t},r.rotateZ$1=function(t,e,i){i*=.5;var l=e[0],u=e[1],f=e[2],m=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=l*w+u*x,t[1]=u*w-l*x,t[2]=f*w+m*x,t[3]=m*w-f*x,t},r.scale=xa,r.scale$1=Nm,r.scale$2=ns,r.scaleAndAdd=ah,r.set=function(t,e,i,l){return t[0]=e,t[1]=i,t[2]=l,t},r.setCacheLimits=function(t,e){Wa=t,Za=e},r.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.setRTLTextPlugin=function(t,e,i=!1){if(p===Jc||p===Qc||p===eh)throw new Error("setRTLTextPlugin cannot be called multiple times.");s=Ss.resolveURL(t),p=Jc,uo=e,_(),i||M()},r.smoothstep=Pi,r.spec=Oe,r.squaredLength=function(t){var e=t[0],i=t[1],l=t[2];return e*e+i*i+l*l},r.storeAuthState=function(t,e){e?yn.add(t):yn.delete(t)},r.sub=js,r.subtract=ff,r.symbolSize=Zb,r.tileAABB=function(t,e,i,l,u,f,m,x,w){if(w.name==="globe")return jv(t,e,new bd(i,l,u));const E=Sa({z:i,x:l,y:u},w);return new Sn([(f+E.x/E.scale)*e,e*(E.y/E.scale),m],[(f+E.x2/E.scale)*e,e*(E.y2/E.scale),x])},r.tileCornersToBounds=ld,r.tileTransform=Sa,r.transformMat3=function(t,e,i){var l=e[0],u=e[1],f=e[2];return t[0]=l*i[0]+u*i[3]+f*i[6],t[1]=l*i[1]+u*i[4]+f*i[7],t[2]=l*i[2]+u*i[5]+f*i[8],t},r.transformMat4=Fi,r.transformMat4$1=va,r.transformQuat=Fm,r.transitionTileAABBinECEF=Xm,r.translate=nh,r.transpose=function(t,e){if(t===e){var i=e[1],l=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=l,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},r.triggerPluginCompletionEvent=c,r.uniqueId=Nn,r.updateGlobeVertexNormal=function(t,e,i,l,u){const f=5*e+2;t.float32[f+0]=i,t.float32[f+1]=l,t.float32[f+2]=u},r.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.validateFilter=t=>qn(pa(t)),r.validateFog=t=>qn(Xu(t)),r.validateLayer=t=>qn(qu(t)),r.validateLight=t=>qn(Hu(t)),r.validateSource=t=>qn(Zu(t)),r.validateStyle=Ku,r.validateTerrain=t=>qn(Zc(t)),r.values=gn,r.vectorTile=yd,r.version=C,r.warnOnce=Ei,r.window=T,r.wrap=vi}),g(["./shared"],function(r){function T(ae){if(typeof ae=="number"||typeof ae=="boolean"||typeof ae=="string"||ae==null)return JSON.stringify(ae);if(Array.isArray(ae)){let $="[";for(const re of ae)$+=`${T(re)},`;return`${$}]`}let G="{";for(const $ of Object.keys(ae).sort())G+=`${$}:${T(ae[$])},`;return`${G}}`}function C(ae){let G="";for(const $ of r.refProperties)G+=`/${T(ae[$])}`;return G}class R{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,$){for(const pe of G)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=r.createStyleLayer(pe)).compileFilter(),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(const pe of $)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const re=function(pe,ye){const Te={};for(let ge=0;ge<pe.length;ge++){const ke=ye&&ye[pe[ge].id]||C(pe[ge]);ye&&(ye[pe[ge].id]=ke);let tt=Te[ke];tt||(tt=Te[ke]=[]),tt.push(pe[ge])}const we=[];for(const ge in Te)we.push(Te[ge]);return we}(r.values(this._layerConfigs),this.keyCache);for(const pe of re){const ye=pe.map(it=>this._layers[it.id]),Te=ye[0];if(Te.visibility==="none")continue;const we=Te.source||"";let ge=this.familiesBySource[we];ge||(ge=this.familiesBySource[we]={});const ke=Te.sourceLayer||"_geojsonTileLayer";let tt=ge[ke];tt||(tt=ge[ke]=[]),tt.push(ye)}}}class F{loadTile(G,$){const{uid:re,encoding:pe,rawImageData:ye,padding:Te,buildQuadTree:we}=G,ge=r.window.ImageBitmap&&ye instanceof r.window.ImageBitmap?this.getImageData(ye,Te):ye;$(null,new r.DEMData(re,ge,pe,Te<1,we))}getImageData(G,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const re=this.offscreenCanvasContext.getImageData(-$,-$,G.width+2*$,G.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),re}}function U(ae,G){if(ae.length!==0){Y(ae[0],G);for(var $=1;$<ae.length;$++)Y(ae[$],!G)}}function Y(ae,G){for(var $=0,re=0,pe=0,ye=ae.length,Te=ye-1;pe<ye;Te=pe++){var we=(ae[pe][0]-ae[Te][0])*(ae[Te][1]+ae[pe][1]),ge=$+we;re+=Math.abs($)>=Math.abs(we)?$-ge+we:we-ge+$,$=ge}$+re>=0!=!!G&&ae.reverse()}var ie=r.getDefaultExportFromCjs(function ae(G,$){var re,pe=G&&G.type;if(pe==="FeatureCollection")for(re=0;re<G.features.length;re++)ae(G.features[re],$);else if(pe==="GeometryCollection")for(re=0;re<G.geometries.length;re++)ae(G.geometries[re],$);else if(pe==="Feature")ae(G.geometry,$);else if(pe==="Polygon")U(G.coordinates,$);else if(pe==="MultiPolygon")for(re=0;re<G.coordinates.length;re++)U(G.coordinates[re],$);return G});const ce=r.VectorTileFeature.prototype.toGeoJSON;var he={exports:{}},be=r.pointGeometry,Le=r.vectorTile.VectorTileFeature,Fe=qe;function qe(ae,G){this.options=G||{},this.features=ae,this.length=ae.length}function Re(ae,G){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=G||4096}qe.prototype.feature=function(ae){return new Re(this.features[ae],this.options.extent)},Re.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var G=0;G<ae.length;G++){for(var $=ae[G],re=[],pe=0;pe<$.length;pe++)re.push(new be($[pe][0],$[pe][1]));this.geometry.push(re)}return this.geometry},Re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,G=1/0,$=-1/0,re=1/0,pe=-1/0,ye=0;ye<ae.length;ye++)for(var Te=ae[ye],we=0;we<Te.length;we++){var ge=Te[we];G=Math.min(G,ge.x),$=Math.max($,ge.x),re=Math.min(re,ge.y),pe=Math.max(pe,ge.y)}return[G,re,$,pe]},Re.prototype.toGeoJSON=Le.prototype.toGeoJSON;var Je=r.pbf,nt=Fe;function st(ae){var G=new Je;return function($,re){for(var pe in $.layers)re.writeMessage(3,De,$.layers[pe])}(ae,G),G.finish()}function De(ae,G){var $;G.writeVarintField(15,ae.version||1),G.writeStringField(1,ae.name||""),G.writeVarintField(5,ae.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<ae.length;$++)re.feature=ae.feature($),G.writeMessage(2,Dt,re);var pe=re.keys;for($=0;$<pe.length;$++)G.writeStringField(3,pe[$]);var ye=re.values;for($=0;$<ye.length;$++)G.writeMessage(4,Kt,ye[$])}function Dt(ae,G){var $=ae.feature;$.id!==void 0&&G.writeVarintField(1,$.id),G.writeMessage(2,zt,ae),G.writeVarintField(3,$.type),G.writeMessage(4,on,$)}function zt(ae,G){var $=ae.feature,re=ae.keys,pe=ae.values,ye=ae.keycache,Te=ae.valuecache;for(var we in $.properties){var ge=$.properties[we],ke=ye[we];if(ge!==null){ke===void 0&&(re.push(we),ye[we]=ke=re.length-1),G.writeVarint(ke);var tt=typeof ge;tt!=="string"&&tt!=="boolean"&&tt!=="number"&&(ge=JSON.stringify(ge));var it=tt+":"+ge,Ke=Te[it];Ke===void 0&&(pe.push(ge),Te[it]=Ke=pe.length-1),G.writeVarint(Ke)}}}function ft(ae,G){return(G<<3)+(7&ae)}function Gt(ae){return ae<<1^ae>>31}function on(ae,G){for(var $=ae.loadGeometry(),re=ae.type,pe=0,ye=0,Te=$.length,we=0;we<Te;we++){var ge=$[we],ke=1;re===1&&(ke=ge.length),G.writeVarint(ft(1,ke));for(var tt=re===3?ge.length-1:ge.length,it=0;it<tt;it++){it===1&&re!==1&&G.writeVarint(ft(2,tt-1));var Ke=ge[it].x-pe,St=ge[it].y-ye;G.writeVarint(Gt(Ke)),G.writeVarint(Gt(St)),pe+=Ke,ye+=St}re===3&&G.writeVarint(ft(7,1))}}function Kt(ae,G){var $=typeof ae;$==="string"?G.writeStringField(1,ae):$==="boolean"?G.writeBooleanField(7,ae):$==="number"&&(ae%1!=0?G.writeDoubleField(3,ae):ae<0?G.writeSVarintField(6,ae):G.writeVarintField(5,ae))}he.exports=st,he.exports.fromVectorTileJs=st,he.exports.fromGeojsonVt=function(ae,G){G=G||{};var $={};for(var re in ae)$[re]=new nt(ae[re].features,G),$[re].name=re,$[re].version=G.version,$[re].extent=G.extent;return st({layers:$})},he.exports.GeoJSONWrapper=nt;var ti=r.getDefaultExportFromCjs(he.exports);const xi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},bt=Math.fround||(Pi=new Float32Array(1),ae=>(Pi[0]=+ae,Pi[0]));var Pi;const vi=3,ki=5,gn=6;class _i{constructor(G){this.options=Object.assign(Object.create(xi),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:$,minZoom:re,maxZoom:pe}=this.options;$&&console.time("total time");const ye=`prepare ${G.length} points`;$&&console.time(ye),this.points=G;const Te=[];for(let ge=0;ge<G.length;ge++){const ke=G[ge];if(!ke.geometry)continue;const[tt,it]=ke.geometry.coordinates,Ke=bt(bn(tt)),St=bt(Es(it));Te.push(Ke,St,1/0,ge,-1,1),this.options.reduce&&Te.push(0)}let we=this.trees[pe+1]=this._createTree(Te);$&&console.timeEnd(ye);for(let ge=pe;ge>=re;ge--){const ke=+Date.now();we=this.trees[ge]=this._createTree(this._cluster(we,ge)),$&&console.log("z%d: %d clusters in %dms",ge,we.numItems,+Date.now()-ke)}return $&&console.timeEnd("total time"),this}getClusters(G,$){let re=((G[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,G[1]));let ye=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)re=-180,ye=180;else if(re>ye){const it=this.getClusters([re,pe,180,Te],$),Ke=this.getClusters([-180,pe,ye,Te],$);return it.concat(Ke)}const we=this.trees[this._limitZoom($)],ge=we.range(bn(re),Es(Te),bn(ye),Es(pe)),ke=we.data,tt=[];for(const it of ge){const Ke=this.stride*it;tt.push(ke[Ke+ki]>1?vn(ke,Ke,this.clusterProps):this.points[ke[Ke+vi]])}return tt}getChildren(G){const $=this._getOriginId(G),re=this._getOriginZoom(G),pe="No cluster with the specified id.",ye=this.trees[re];if(!ye)throw new Error(pe);const Te=ye.data;if($*this.stride>=Te.length)throw new Error(pe);const we=this.options.radius/(this.options.extent*Math.pow(2,re-1)),ge=ye.within(Te[$*this.stride],Te[$*this.stride+1],we),ke=[];for(const tt of ge){const it=tt*this.stride;Te[it+4]===G&&ke.push(Te[it+ki]>1?vn(Te,it,this.clusterProps):this.points[Te[it+vi]])}if(ke.length===0)throw new Error(pe);return ke}getLeaves(G,$,re){const pe=[];return this._appendLeaves(pe,G,$=$||10,re=re||0,0),pe}getTile(G,$,re){const pe=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:Te,radius:we}=this.options,ge=we/Te,ke=(re-ge)/ye,tt=(re+1+ge)/ye,it={features:[]};return this._addTileFeatures(pe.range(($-ge)/ye,ke,($+1+ge)/ye,tt),pe.data,$,re,ye,it),$===0&&this._addTileFeatures(pe.range(1-ge/ye,ke,1,tt),pe.data,ye,re,ye,it),$===ye-1&&this._addTileFeatures(pe.range(0,ke,ge/ye,tt),pe.data,-1,re,ye,it),it.features.length?it:null}getClusterExpansionZoom(G){let $=this._getOriginZoom(G)-1;for(;$<=this.options.maxZoom;){const re=this.getChildren(G);if($++,re.length!==1)break;G=re[0].properties.cluster_id}return $}_appendLeaves(G,$,re,pe,ye){const Te=this.getChildren($);for(const we of Te){const ge=we.properties;if(ge&&ge.cluster?ye+ge.point_count<=pe?ye+=ge.point_count:ye=this._appendLeaves(G,ge.cluster_id,re,pe,ye):ye<pe?ye++:G.push(we),G.length===re)break}return ye}_createTree(G){const $=new r.KDBush(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<G.length;re+=this.stride)$.add(G[re],G[re+1]);return $.finish(),$.data=G,$}_addTileFeatures(G,$,re,pe,ye,Te){for(const we of G){const ge=we*this.stride,ke=$[ge+ki]>1;let tt,it,Ke;if(ke)tt=Nn($,ge,this.clusterProps),it=$[ge],Ke=$[ge+1];else{const At=this.points[$[ge+vi]];tt=At.properties;const[kt,jt]=At.geometry.coordinates;it=bn(kt),Ke=Es(jt)}const St={type:1,geometry:[[Math.round(this.options.extent*(it*ye-re)),Math.round(this.options.extent*(Ke*ye-pe))]],tags:tt};let Pt;Pt=ke||this.options.generateId?$[ge+vi]:this.points[$[ge+vi]].id,Pt!==void 0&&(St.id=Pt),Te.features.push(St)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,$){const{radius:re,extent:pe,reduce:ye,minPoints:Te}=this.options,we=re/(pe*Math.pow(2,$)),ge=G.data,ke=[],tt=this.stride;for(let it=0;it<ge.length;it+=tt){if(ge[it+2]<=$)continue;ge[it+2]=$;const Ke=ge[it],St=ge[it+1],Pt=G.within(ge[it],ge[it+1],we),At=ge[it+ki];let kt=At;for(const jt of Pt){const Mi=jt*tt;ge[Mi+2]>$&&(kt+=ge[Mi+ki])}if(kt>At&&kt>=Te){let jt,Mi=Ke*At,Ni=St*At,un=-1;const Hi=((it/tt|0)<<5)+($+1)+this.points.length;for(const hs of Pt){const Qi=hs*tt;if(ge[Qi+2]<=$)continue;ge[Qi+2]=$;const yn=ge[Qi+ki];Mi+=ge[Qi]*yn,Ni+=ge[Qi+1]*yn,ge[Qi+4]=Hi,ye&&(jt||(jt=this._map(ge,it,!0),un=this.clusterProps.length,this.clusterProps.push(jt)),ye(jt,this._map(ge,Qi)))}ge[it+4]=Hi,ke.push(Mi/kt,Ni/kt,1/0,Hi,-1,kt),ye&&ke.push(un)}else{for(let jt=0;jt<tt;jt++)ke.push(ge[it+jt]);if(kt>1)for(const jt of Pt){const Mi=jt*tt;if(!(ge[Mi+2]<=$)){ge[Mi+2]=$;for(let Ni=0;Ni<tt;Ni++)ke.push(ge[Mi+Ni])}}}}return ke}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,$,re){if(G[$+ki]>1){const Te=this.clusterProps[G[$+gn]];return re?Object.assign({},Te):Te}const pe=this.points[G[$+vi]].properties,ye=this.options.map(pe);return re&&ye===pe?Object.assign({},ye):ye}}function vn(ae,G,$){return{type:"Feature",id:ae[G+vi],properties:Nn(ae,G,$),geometry:{type:"Point",coordinates:[(re=ae[G],360*(re-.5)),$a(ae[G+1])]}};var re}function Nn(ae,G,$){const re=ae[G+ki],pe=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,ye=ae[G+gn],Te=ye===-1?{}:Object.assign({},$[ye]);return Object.assign(Te,{cluster:!0,cluster_id:ae[G+vi],point_count:re,point_count_abbreviated:pe})}function bn(ae){return ae/360+.5}function Es(ae){const G=Math.sin(ae*Math.PI/180),$=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return $<0?0:$>1?1:$}function $a(ae){const G=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function ur(ae,G,$,re){for(var pe,ye=re,Te=$-G>>1,we=$-G,ge=ae[G],ke=ae[G+1],tt=ae[$],it=ae[$+1],Ke=G+3;Ke<$;Ke+=3){var St=Vr(ae[Ke],ae[Ke+1],ge,ke,tt,it);if(St>ye)pe=Ke,ye=St;else if(St===ye){var Pt=Math.abs(Ke-Te);Pt<we&&(pe=Ke,we=Pt)}}ye>re&&(pe-G>3&&ur(ae,G,pe,re),ae[pe+2]=ye,$-pe>3&&ur(ae,pe,$,re))}function Vr(ae,G,$,re,pe,ye){var Te=pe-$,we=ye-re;if(Te!==0||we!==0){var ge=((ae-$)*Te+(G-re)*we)/(Te*Te+we*we);ge>1?($=pe,re=ye):ge>0&&($+=Te*ge,re+=we*ge)}return(Te=ae-$)*Te+(we=G-re)*we}function Nt(ae,G,$,re){var pe={id:ae===void 0?null:ae,type:G,geometry:$,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var Te=ye.geometry,we=ye.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")Ur(ye,Te);else if(we==="Polygon"||we==="MultiLineString")for(var ge=0;ge<Te.length;ge++)Ur(ye,Te[ge]);else if(we==="MultiPolygon")for(ge=0;ge<Te.length;ge++)for(var ke=0;ke<Te[ge].length;ke++)Ur(ye,Te[ge][ke])}(pe),pe}function Ur(ae,G){for(var $=0;$<G.length;$+=3)ae.minX=Math.min(ae.minX,G[$]),ae.minY=Math.min(ae.minY,G[$+1]),ae.maxX=Math.max(ae.maxX,G[$]),ae.maxY=Math.max(ae.maxY,G[$+1])}function zn(ae,G,$,re){if(G.geometry){var pe=G.geometry.coordinates,ye=G.geometry.type,Te=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),we=[],ge=G.id;if($.promoteId?ge=G.properties[$.promoteId]:$.generateId&&(ge=re||0),ye==="Point")Fo(pe,we);else if(ye==="MultiPoint")for(var ke=0;ke<pe.length;ke++)Fo(pe[ke],we);else if(ye==="LineString")Ei(pe,we,Te,!1);else if(ye==="MultiLineString"){if($.lineMetrics){for(ke=0;ke<pe.length;ke++)Ei(pe[ke],we=[],Te,!1),ae.push(Nt(ge,"LineString",we,G.properties));return}jn(pe,we,Te,!1)}else if(ye==="Polygon")jn(pe,we,Te,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(ke=0;ke<G.geometry.geometries.length;ke++)zn(ae,{id:ge,geometry:G.geometry.geometries[ke],properties:G.properties},$,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<pe.length;ke++){var tt=[];jn(pe[ke],tt,Te,!0),we.push(tt)}}ae.push(Nt(ge,ye,we,G.properties))}}function Fo(ae,G){G.push(qa(ae[0])),G.push(Ms(ae[1])),G.push(0)}function Ei(ae,G,$,re){for(var pe,ye,Te=0,we=0;we<ae.length;we++){var ge=qa(ae[we][0]),ke=Ms(ae[we][1]);G.push(ge),G.push(ke),G.push(0),we>0&&(Te+=re?(pe*ke-ge*ye)/2:Math.sqrt(Math.pow(ge-pe,2)+Math.pow(ke-ye,2))),pe=ge,ye=ke}var tt=G.length-3;G[2]=1,ur(G,0,tt,$),G[tt+2]=1,G.size=Math.abs(Te),G.start=0,G.end=G.size}function jn(ae,G,$,re){for(var pe=0;pe<ae.length;pe++){var ye=[];Ei(ae[pe],ye,$,re),G.push(ye)}}function qa(ae){return ae/360+.5}function Ms(ae){var G=Math.sin(ae*Math.PI/180),$=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return $<0?0:$>1?1:$}function Rn(ae,G,$,re,pe,ye,Te,we){if(re/=G,ye>=($/=G)&&Te<re)return ae;if(Te<$||ye>=re)return null;for(var ge=[],ke=0;ke<ae.length;ke++){var tt=ae[ke],it=tt.geometry,Ke=tt.type,St=pe===0?tt.minX:tt.minY,Pt=pe===0?tt.maxX:tt.maxY;if(St>=$&&Pt<re)ge.push(tt);else if(!(Pt<$||St>=re)){var At=[];if(Ke==="Point"||Ke==="MultiPoint")No(it,At,$,re,pe);else if(Ke==="LineString")Gr(it,At,$,re,pe,!1,we.lineMetrics);else if(Ke==="MultiLineString")Hs(it,At,$,re,pe,!1);else if(Ke==="Polygon")Hs(it,At,$,re,pe,!0);else if(Ke==="MultiPolygon")for(var kt=0;kt<it.length;kt++){var jt=[];Hs(it[kt],jt,$,re,pe,!0),jt.length&&At.push(jt)}if(At.length){if(we.lineMetrics&&Ke==="LineString"){for(kt=0;kt<At.length;kt++)ge.push(Nt(tt.id,Ke,At[kt],tt.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(At.length===1?(Ke="LineString",At=At[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=At.length===3?"Point":"MultiPoint"),ge.push(Nt(tt.id,Ke,At,tt.tags))}}}return ge.length?ge:null}function No(ae,G,$,re,pe){for(var ye=0;ye<ae.length;ye+=3){var Te=ae[ye+pe];Te>=$&&Te<=re&&(G.push(ae[ye]),G.push(ae[ye+1]),G.push(ae[ye+2]))}}function Gr(ae,G,$,re,pe,ye,Te){for(var we,ge,ke=jo(ae),tt=pe===0?Wa:Za,it=ae.start,Ke=0;Ke<ae.length-3;Ke+=3){var St=ae[Ke],Pt=ae[Ke+1],At=ae[Ke+2],kt=ae[Ke+3],jt=ae[Ke+4],Mi=pe===0?St:Pt,Ni=pe===0?kt:jt,un=!1;Te&&(we=Math.sqrt(Math.pow(St-kt,2)+Math.pow(Pt-jt,2))),Mi<$?Ni>$&&(ge=tt(ke,St,Pt,kt,jt,$),Te&&(ke.start=it+we*ge)):Mi>re?Ni<re&&(ge=tt(ke,St,Pt,kt,jt,re),Te&&(ke.start=it+we*ge)):$r(ke,St,Pt,At),Ni<$&&Mi>=$&&(ge=tt(ke,St,Pt,kt,jt,$),un=!0),Ni>re&&Mi<=re&&(ge=tt(ke,St,Pt,kt,jt,re),un=!0),!ye&&un&&(Te&&(ke.end=it+we*ge),G.push(ke),ke=jo(ae)),Te&&(it+=we)}var Hi=ae.length-3;St=ae[Hi],Pt=ae[Hi+1],At=ae[Hi+2],(Mi=pe===0?St:Pt)>=$&&Mi<=re&&$r(ke,St,Pt,At),Hi=ke.length-3,ye&&Hi>=3&&(ke[Hi]!==ke[0]||ke[Hi+1]!==ke[1])&&$r(ke,ke[0],ke[1],ke[2]),ke.length&&G.push(ke)}function jo(ae){var G=[];return G.size=ae.size,G.start=ae.start,G.end=ae.end,G}function Hs(ae,G,$,re,pe,ye){for(var Te=0;Te<ae.length;Te++)Gr(ae[Te],G,$,re,pe,ye,!1)}function $r(ae,G,$,re){ae.push(G),ae.push($),ae.push(re)}function Wa(ae,G,$,re,pe,ye){var Te=(ye-G)/(re-G);return ae.push(ye),ae.push($+(pe-$)*Te),ae.push(1),Te}function Za(ae,G,$,re,pe,ye){var Te=(ye-$)/(pe-$);return ae.push(G+(re-G)*Te),ae.push(ye),ae.push(1),Te}function Vn(ae,G){for(var $=[],re=0;re<ae.length;re++){var pe,ye=ae[re],Te=ye.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")pe=Xs(ye.geometry,G);else if(Te==="MultiLineString"||Te==="Polygon"){pe=[];for(var we=0;we<ye.geometry.length;we++)pe.push(Xs(ye.geometry[we],G))}else if(Te==="MultiPolygon")for(pe=[],we=0;we<ye.geometry.length;we++){for(var ge=[],ke=0;ke<ye.geometry[we].length;ke++)ge.push(Xs(ye.geometry[we][ke],G));pe.push(ge)}$.push(Nt(ye.id,Te,pe,ye.tags))}return $}function Xs(ae,G){var $=[];$.size=ae.size,ae.start!==void 0&&($.start=ae.start,$.end=ae.end);for(var re=0;re<ae.length;re+=3)$.push(ae[re]+G,ae[re+1],ae[re+2]);return $}function Vo(ae,G){if(ae.transformed)return ae;var $,re,pe,ye=1<<ae.z,Te=ae.x,we=ae.y;for($=0;$<ae.features.length;$++){var ge=ae.features[$],ke=ge.geometry,tt=ge.type;if(ge.geometry=[],tt===1)for(re=0;re<ke.length;re+=2)ge.geometry.push(dr(ke[re],ke[re+1],G,ye,Te,we));else for(re=0;re<ke.length;re++){var it=[];for(pe=0;pe<ke[re].length;pe+=2)it.push(dr(ke[re][pe],ke[re][pe+1],G,ye,Te,we));ge.geometry.push(it)}}return ae.transformed=!0,ae}function dr(ae,G,$,re,pe,ye){return[Math.round($*(ae*re-pe)),Math.round($*(G*re-ye))]}function qr(ae,G,$,re,pe){for(var ye=G===pe.maxZoom?0:pe.tolerance/((1<<G)*pe.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:re,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<ae.length;we++){Te.numFeatures++,Uo(Te,ae[we],ye,pe);var ge=ae[we].minX,ke=ae[we].minY,tt=ae[we].maxX,it=ae[we].maxY;ge<Te.minX&&(Te.minX=ge),ke<Te.minY&&(Te.minY=ke),tt>Te.maxX&&(Te.maxX=tt),it>Te.maxY&&(Te.maxY=it)}return Te}function Uo(ae,G,$,re){var pe=G.geometry,ye=G.type,Te=[];if(ye==="Point"||ye==="MultiPoint")for(var we=0;we<pe.length;we+=3)Te.push(pe[we]),Te.push(pe[we+1]),ae.numPoints++,ae.numSimplified++;else if(ye==="LineString")pr(Te,pe,ae,$,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(we=0;we<pe.length;we++)pr(Te,pe[we],ae,$,ye==="Polygon",we===0);else if(ye==="MultiPolygon")for(var ge=0;ge<pe.length;ge++){var ke=pe[ge];for(we=0;we<ke.length;we++)pr(Te,ke[we],ae,$,!0,we===0)}if(Te.length){var tt=G.tags||null;if(ye==="LineString"&&re.lineMetrics){for(var it in tt={},G.tags)tt[it]=G.tags[it];tt.mapbox_clip_start=pe.start/pe.size,tt.mapbox_clip_end=pe.end/pe.size}var Ke={geometry:Te,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:tt};G.id!==null&&(Ke.id=G.id),ae.features.push(Ke)}}function pr(ae,G,$,re,pe,ye){var Te=re*re;if(re>0&&G.size<(pe?Te:re))$.numPoints+=G.length/3;else{for(var we=[],ge=0;ge<G.length;ge+=3)(re===0||G[ge+2]>Te)&&($.numSimplified++,we.push(G[ge]),we.push(G[ge+1])),$.numPoints++;pe&&function(ke,tt){for(var it=0,Ke=0,St=ke.length,Pt=St-2;Ke<St;Pt=Ke,Ke+=2)it+=(ke[Ke]-ke[Pt])*(ke[Ke+1]+ke[Pt+1]);if(it>0===tt)for(Ke=0,St=ke.length;Ke<St/2;Ke+=2){var At=ke[Ke],kt=ke[Ke+1];ke[Ke]=ke[St-2-Ke],ke[Ke+1]=ke[St-1-Ke],ke[St-2-Ke]=At,ke[St-1-Ke]=kt}}(we,ye),ae.push(we)}}function Ys(ae,G){var $=(G=this.options=function(pe,ye){for(var Te in ye)pe[Te]=ye[Te];return pe}(Object.create(this.options),G)).debug;if($&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var re=function(pe,ye){var Te=[];if(pe.type==="FeatureCollection")for(var we=0;we<pe.features.length;we++)zn(Te,pe.features[we],ye,we);else zn(Te,pe.type==="Feature"?pe:{geometry:pe},ye);return Te}(ae,G);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),re=function(pe,ye){var Te=ye.buffer/ye.extent,we=pe,ge=Rn(pe,1,-1-Te,Te,0,-1,2,ye),ke=Rn(pe,1,1-Te,2+Te,0,-1,2,ye);return(ge||ke)&&(we=Rn(pe,1,-Te,1+Te,0,-1,2,ye)||[],ge&&(we=Vn(ge,1).concat(we)),ke&&(we=we.concat(Vn(ke,-1)))),we}(re,G),re.length&&this.splitTile(re,0,0,0),$&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fr(ae,G,$){return 32*((1<<ae)*$+G)+ae}function _r(ae,G){const $=ae.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const re=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!re)return G(null,null);const pe=new class{constructor(Te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.EXTENT,this.length=Te.length,this._features=Te}feature(Te){return new class{constructor(we){this._feature=we,this.extent=r.EXTENT,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const ge of this._feature.geometry)we.push([new r.Point(ge[0],ge[1])]);return we}{const we=[];for(const ge of this._feature.geometry){const ke=[];for(const tt of ge)ke.push(new r.Point(tt[0],tt[1]));we.push(ke)}return we}}toGeoJSON(we,ge,ke){return ce.call(this,we,ge,ke)}}(this._features[Te])}}(re.features);let ye=ti(pe);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),G(null,{vectorTile:pe,rawData:ye.buffer})}Ys.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ys.prototype.splitTile=function(ae,G,$,re,pe,ye,Te){for(var we=[ae,G,$,re],ge=this.options,ke=ge.debug;we.length;){re=we.pop(),$=we.pop(),G=we.pop(),ae=we.pop();var tt=1<<G,it=fr(G,$,re),Ke=this.tiles[it];if(!Ke&&(ke>1&&console.time("creation"),Ke=this.tiles[it]=qr(ae,G,$,re,ge),this.tileCoords.push({z:G,x:$,y:re}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,$,re,Ke.numFeatures,Ke.numPoints,Ke.numSimplified),console.timeEnd("creation"));var St="z"+G;this.stats[St]=(this.stats[St]||0)+1,this.total++}if(Ke.source=ae,pe){if(G===ge.maxZoom||G===pe)continue;var Pt=1<<pe-G;if($!==Math.floor(ye/Pt)||re!==Math.floor(Te/Pt))continue}else if(G===ge.indexMaxZoom||Ke.numPoints<=ge.indexMaxPoints)continue;if(Ke.source=null,ae.length!==0){ke>1&&console.time("clipping");var At,kt,jt,Mi,Ni,un,Hi=.5*ge.buffer/ge.extent,hs=.5-Hi,Qi=.5+Hi,yn=1+Hi;At=kt=jt=Mi=null,Ni=Rn(ae,tt,$-Hi,$+Qi,0,Ke.minX,Ke.maxX,ge),un=Rn(ae,tt,$+hs,$+yn,0,Ke.minX,Ke.maxX,ge),ae=null,Ni&&(At=Rn(Ni,tt,re-Hi,re+Qi,1,Ke.minY,Ke.maxY,ge),kt=Rn(Ni,tt,re+hs,re+yn,1,Ke.minY,Ke.maxY,ge),Ni=null),un&&(jt=Rn(un,tt,re-Hi,re+Qi,1,Ke.minY,Ke.maxY,ge),Mi=Rn(un,tt,re+hs,re+yn,1,Ke.minY,Ke.maxY,ge),un=null),ke>1&&console.timeEnd("clipping"),we.push(At||[],G+1,2*$,2*re),we.push(kt||[],G+1,2*$,2*re+1),we.push(jt||[],G+1,2*$+1,2*re),we.push(Mi||[],G+1,2*$+1,2*re+1)}}},Ys.prototype.getTile=function(ae,G,$){var re=this.options,pe=re.extent,ye=re.debug;if(ae<0||ae>24)return null;var Te=1<<ae,we=fr(ae,G=(G%Te+Te)%Te,$);if(this.tiles[we])return Vo(this.tiles[we],pe);ye>1&&console.log("drilling down to z%d-%d-%d",ae,G,$);for(var ge,ke=ae,tt=G,it=$;!ge&&ke>0;)ke--,tt=Math.floor(tt/2),it=Math.floor(it/2),ge=this.tiles[fr(ke,tt,it)];return ge&&ge.source?(ye>1&&console.log("found parent tile z%d-%d-%d",ke,tt,it),ye>1&&console.time("drilling down"),this.splitTile(ge.source,ke,tt,it,ae,G,$),ye>1&&console.timeEnd("drilling down"),this.tiles[we]?Vo(this.tiles[we],pe):null):null};class Wr extends r.VectorTileWorkerSource{constructor(G,$,re,pe,ye){super(G,$,re,pe,_r),ye&&(this.loadGeoJSON=ye)}loadData(G,$){const re=G&&G.request,pe=re&&re.collectResourceTiming;this.loadGeoJSON(G,(ye,Te)=>{if(ye||!Te)return $(ye);if(typeof Te!="object")return $(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{ie(Te,!0);try{if(G.filter){const ge=r.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));Te={type:"FeatureCollection",features:Te.features.filter(tt=>ge.value.evaluate({zoom:0},tt))}}this._geoJSONIndex=G.cluster?new _i(function({superclusterOptions:ge,clusterProperties:ke}){if(!ke||!ge)return ge;const tt={},it={},Ke={accumulated:null,zoom:0},St={properties:null},Pt=Object.keys(ke);for(const At of Pt){const[kt,jt]=ke[At],Mi=r.createExpression(jt),Ni=r.createExpression(typeof kt=="string"?[kt,["accumulated"],["get",At]]:kt);tt[At]=Mi.value,it[At]=Ni.value}return ge.map=At=>{St.properties=At;const kt={};for(const jt of Pt)kt[jt]=tt[jt].evaluate(Ke,St);return kt},ge.reduce=(At,kt)=>{St.properties=kt;for(const jt of Pt)Ke.accumulated=At[jt],At[jt]=it[jt].evaluate(Ke,St)},ge}(G)).load(Te.features):function(ge,ke){return new Ys(ge,ke)}(Te,G.geojsonVtOptions)}catch(ge){return $(ge)}this.loaded={};const we={};if(pe){const ge=r.getPerformanceMeasurement(re);ge&&(we.resourceTiming={},we.resourceTiming[G.source]=JSON.parse(JSON.stringify(ge)))}$(null,we)}})}reloadTile(G,$){const re=this.loaded;return re&&re[G.uid]?super.reloadTile(G,$):this.loadTile(G,$)}loadGeoJSON(G,$){if(G.request)r.getJSON(G.request,$);else{if(typeof G.data!="string")return $(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(G.data))}catch{return $(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(re){$(re)}}getClusterChildren(G,$){try{$(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(re){$(re)}}getClusterLeaves(G,$){try{$(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(re){$(re)}}}class Ha{constructor(G){this.self=G,this.actor=new r.Actor(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.getProjection({name:"mercator"}),this.workerSourceTypes={vector:r.VectorTileWorkerSource,geojson:Wr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,re)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=re},this.self.registerRTLTextPlugin=$=>{if(r.plugin.isParsed())throw new Error("RTL text plugin already registered.");r.plugin.applyArabicShaping=$.applyArabicShaping,r.plugin.processBidirectionalText=$.processBidirectionalText,r.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(G,$,re){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],re()}checkIfReady(G,$,re){re()}setReferrer(G,$){this.referrer=$}spriteLoaded(G,$){this.isSpriteLoaded[G]=$;for(const re in this.workerSources[G]){const pe=this.workerSources[G][re];for(const ye in pe)pe[ye]instanceof r.VectorTileWorkerSource&&(pe[ye].isSpriteLoaded=$,pe[ye].fire(new r.Event("isSpriteLoaded")))}}setImages(G,$,re){this.availableImages[G]=$;for(const pe in this.workerSources[G]){const ye=this.workerSources[G][pe];for(const Te in ye)ye[Te].availableImages=$}re()}enableTerrain(G,$,re){this.terrain=$,re()}setProjection(G,$){this.projections[G]=r.getProjection($)}setLayers(G,$,re){this.getLayerIndex(G).replace($),re()}updateLayers(G,$,re){this.getLayerIndex(G).update($.layers,$.removedIds),re()}loadTile(G,$,re){const pe=this.enableTerrain?r.extend({enableTerrain:this.terrain},$):$;pe.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,$.type,$.source).loadTile(pe,re)}loadDEMTile(G,$,re){const pe=this.enableTerrain?r.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(G,$.source).loadTile(pe,re)}reloadTile(G,$,re){const pe=this.enableTerrain?r.extend({enableTerrain:this.terrain},$):$;pe.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,$.type,$.source).reloadTile(pe,re)}abortTile(G,$,re){this.getWorkerSource(G,$.type,$.source).abortTile($,re)}removeTile(G,$,re){this.getWorkerSource(G,$.type,$.source).removeTile($,re)}removeSource(G,$,re){if(!this.workerSources[G]||!this.workerSources[G][$.type]||!this.workerSources[G][$.type][$.source])return;const pe=this.workerSources[G][$.type][$.source];delete this.workerSources[G][$.type][$.source],pe.removeSource!==void 0?pe.removeSource($,re):re()}loadWorkerSource(G,$,re){try{this.self.importScripts($.url),re()}catch(pe){re(pe.toString())}}syncRTLPluginState(G,$,re){try{r.plugin.setState($);const pe=r.plugin.getPluginURL();if(r.plugin.isLoaded()&&!r.plugin.isParsed()&&pe!=null){this.self.importScripts(pe);const ye=r.plugin.isParsed();re(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pe}`),ye)}}catch(pe){re(pe.toString())}}getAvailableImages(G){let $=this.availableImages[G];return $||($=[]),$}getLayerIndex(G){let $=this.layerIndexes[G];return $||($=this.layerIndexes[G]=new R),$}getWorkerSource(G,$,re){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][$]||(this.workerSources[G][$]={}),!this.workerSources[G][$][re]){const pe={send:(ye,Te,we,ge,ke,tt)=>{this.actor.send(ye,Te,we,G,ke,tt)},scheduler:this.actor.scheduler};this.workerSources[G][$][re]=new this.workerSourceTypes[$](pe,this.getLayerIndex(G),this.getAvailableImages(G),this.isSpriteLoaded[G])}return this.workerSources[G][$][re]}getDEMWorkerSource(G,$){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][$]||(this.demWorkerSources[G][$]=new F),this.demWorkerSources[G][$]}enforceCacheSizeLimit(G,$){r.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(G,$,re){re(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ha(self)),Ha}),g(["./shared"],function(r){function T(p,s){if(Array.isArray(p)){if(!Array.isArray(s)||p.length!==s.length)return!1;for(let c=0;c<p.length;c++)if(!T(p[c],s[c]))return!1;return!0}if(typeof p=="object"&&p!==null&&s!==null){if(typeof s!="object"||Object.keys(p).length!==Object.keys(s).length)return!1;for(const c in p)if(!T(p[c],s[c]))return!1;return!0}return p===s}var C=R;function R(p){return!function(s){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,y,b=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(b);try{y=new Worker(M),_=!0}catch{_=!1}return y&&y.terminate(),URL.revokeObjectURL(M),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var y=_.getContext("2d");if(!y)return!1;var b=y.getImageData(0,0,1,1);return b&&b.width===_.width}()?(F[c=s&&s.failIfMajorPerformanceCaveat]===void 0&&(F[c]=function(_){var y,b=function(M){var S=document.createElement("canvas"),P=Object.create(R.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=M,S.getContext("webgl",P)||S.getContext("experimental-webgl",P)}(_);if(!b)return!1;try{y=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!y||b.isContextLost())&&(b.shaderSource(y,"void main() {}"),b.compileShader(y),b.getShaderParameter(y,b.COMPILE_STATUS)===!0)}(c)),F[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(p)}var F={};function U(p,s,c){const _=r.window.document.createElement(p);return s!==void 0&&(_.className=s),c&&c.appendChild(_),_}function Y(p,s,c){const _=r.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const y of Object.keys(s))_.setAttributeNS(null,y,s[y]);return c&&c.appendChild(_),_}R.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ie=r.window.document&&r.window.document.documentElement.style,ce=ie&&ie.userSelect!==void 0?"userSelect":"WebkitUserSelect";let he;function be(){ie&&ce&&(he=ie[ce],ie[ce]="none")}function Le(){ie&&ce&&(ie[ce]=he)}function Fe(p){p.preventDefault(),p.stopPropagation(),r.window.removeEventListener("click",Fe,!0)}function qe(){r.window.addEventListener("click",Fe,!0),r.window.setTimeout(()=>{r.window.removeEventListener("click",Fe,!0)},0)}function Re(p,s){const c=p.getBoundingClientRect();return st(p,c,s)}function Je(p,s){const c=p.getBoundingClientRect(),_=[];for(let y=0;y<s.length;y++)_.push(st(p,c,s[y]));return _}function nt(p){return r.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&r.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function st(p,s,c){const _=p.offsetWidth===s.width?1:p.offsetWidth/s.width;return new r.Point((c.clientX-s.left)*_,(c.clientY-s.top)*_)}function De(p,s){var c=s[0],_=s[1],y=s[2],b=s[3],M=c*b-y*_;return M?(p[0]=b*(M=1/M),p[1]=-_*M,p[2]=-y*M,p[3]=c*M,p):null}function Dt(p){const{userImage:s}=p;return!!(s&&s.render&&s.render())&&(p.data.replace(new Uint8Array(s.data.buffer)),!0)}class zt extends r.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new r.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:c,callback:_}of this.requestors)this._notify(c,_);this.requestors=[]}}hasImage(s){return!!this.getImage(s)}getImage(s){return this.images[s]}addImage(s,c){this._validate(s,c)&&(this.images[s]=c)}_validate(s,c){let _=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.ErrorEvent(new Error(`Image "${s}" has invalid "stretchX" value`))),_=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.ErrorEvent(new Error(`Image "${s}" has invalid "stretchY" value`))),_=!1),this._validateContent(c.content,c)||(this.fire(new r.ErrorEvent(new Error(`Image "${s}" has invalid "content" value`))),_=!1),_}_validateStretch(s,c){if(!s)return!0;let _=0;for(const y of s){if(y[0]<_||y[1]<y[0]||c<y[1])return!1;_=y[1]}return!0}_validateContent(s,c){return!(s&&(s.length!==4||s[0]<0||c.data.width<s[0]||s[1]<0||c.data.height<s[1]||s[2]<0||c.data.width<s[2]||s[3]<0||c.data.height<s[3]||s[2]<s[0]||s[3]<s[1]))}updateImage(s,c){c.version=this.images[s].version+1,this.images[s]=c,this.updatedImages[s]=!0}removeImage(s){const c=this.images[s];delete this.images[s],delete this.patterns[s],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s,c){let _=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(_=!1);this.isLoaded()||_?this._notify(s,c):this.requestors.push({ids:s,callback:c})}_notify(s,c){const _={};for(const y of s){this.images[y]||this.fire(new r.Event("styleimagemissing",{id:y}));const b=this.images[y];b?_[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:r.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,_)}getPixelSize(){const{width:s,height:c}=this.atlasImage;return{width:s,height:c}}getPattern(s){const c=this.patterns[s],_=this.getImage(s);if(!_)return null;if(c&&c.position.version===_.version)return c.position;if(c)c.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new r.ImagePosition(y,_);this.patterns[s]={bin:y,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const c=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new r.Texture(s,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:c,h:_}=r.potpack(s),y=this.atlasImage;y.resize({width:c||1,height:_||1});for(const b in this.patterns){const{bin:M}=this.patterns[b],S=M.x+1,P=M.y+1,z=this.images[b].data,D=z.width,N=z.height;r.RGBAImage.copy(z,y,{x:0,y:0},{x:S,y:P},{width:D,height:N}),r.RGBAImage.copy(z,y,{x:0,y:N-1},{x:S,y:P-1},{width:D,height:1}),r.RGBAImage.copy(z,y,{x:0,y:0},{x:S,y:P+N},{width:D,height:1}),r.RGBAImage.copy(z,y,{x:D-1,y:0},{x:S-1,y:P},{width:1,height:N}),r.RGBAImage.copy(z,y,{x:0,y:0},{x:S+D,y:P},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const c of s){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const _=this.images[c];Dt(_)&&this.updateImage(c,_)}}}const ft=new r.Properties({anchor:new r.DataConstantProperty(r.spec.light.anchor),position:new class{constructor(){this.specification=r.spec.light.position}possiblyEvaluate(p,s){return function([c,_,y]){const b=r.degToRad(_+90),M=r.degToRad(y);return{x:c*Math.cos(b)*Math.sin(M),y:c*Math.sin(b)*Math.sin(M),z:c*Math.cos(M),azimuthal:_,polar:y}}(p.expression.evaluate(s))}interpolate(p,s,c){return{x:r.number(p.x,s.x,c),y:r.number(p.y,s.y,c),z:r.number(p.z,s.z,c),azimuthal:r.number(p.azimuthal,s.azimuthal,c),polar:r.number(p.polar,s.polar,c)}}},color:new r.DataConstantProperty(r.spec.light.color),intensity:new r.DataConstantProperty(r.spec.light.intensity)});class Gt extends r.Evented{constructor(s){super(),this._transitionable=new r.Transitionable(ft),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,c={}){if(!this._validate(r.validateLight,s,c))for(const _ in s){const y=s[_];r.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,_){return(!_||_.validate!==!1)&&r.emitValidationErrors(this,s.call(r.validateStyle,r.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}const on=new r.Properties({source:new r.DataConstantProperty(r.spec.terrain.source),exaggeration:new r.DataConstantProperty(r.spec.terrain.exaggeration)});let Kt=class extends r.Evented{constructor(p,s){super(),this._transitionable=new r.Transitionable(on),this.set(p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=s}get(){return this._transitionable.serialize()}set(p){for(const s in p){const c=p[s];r.endsWith(s,"-transition")?this._transitionable.setTransition(s.slice(0,-11),c):this._transitionable.setValue(s,c)}}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}};function ti(p,s,c,_){const y=r.smoothstep(45,65,c),[b,M]=xi(p,_),S=r.length(s);let P=1-Math.min(1,Math.exp((S-b)/(M-b)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*y*p.alpha}function xi(p,s){const c=.5/Math.tan(.5*s);return[p.range[0]+c,p.range[1]+c]}const bt=new r.Properties({range:new r.DataConstantProperty(r.spec.fog.range),color:new r.DataConstantProperty(r.spec.fog.color),"high-color":new r.DataConstantProperty(r.spec.fog["high-color"]),"space-color":new r.DataConstantProperty(r.spec.fog["space-color"]),"horizon-blend":new r.DataConstantProperty(r.spec.fog["horizon-blend"]),"star-intensity":new r.DataConstantProperty(r.spec.fog["star-intensity"])});class Pi extends r.Evented{constructor(s,c){super(),this._transitionable=new r.Transitionable(bt),this.set(s),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const s=this._transform,c=s.projection.name==="globe",_=r.globeToMercatorTransition(s.zoom),y=this.properties.get("range"),b=[.5,3];return{range:c?[r.number(b[0],y[0],_),r.number(b[1],y[1],_)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(s,c={}){if(!this._validate(r.validateFog,s,c)){for(const _ of Object.keys(r.spec.fog))s&&s[_]===void 0&&(s[_]=r.spec.fog[_].default);for(const _ in s){const y=s[_];r.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getOpacity(s){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.smoothstep(45,65,s))*c.a}getOpacityAtLatLng(s,c){return this._transform.projection.supportsFog?function(_,y,b){const M=r.MercatorCoordinate.fromLngLat(y),S=b.elevation?b.elevation.getAtPointOrZero(M):0,P=[M.x,M.y,S];return r.transformMat4(P,P,b.mercatorFogMatrix),ti(_,P,b.pitch,b._fov)}(this.state,s,c):0}getFovAdjustedRange(s){return this._transform.projection.supportsFog?xi(this.state,s):[0,1]}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,c,_){return(!_||_.validate!==!1)&&r.emitValidationErrors(this,s.call(r.validateStyle,r.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}class vi{constructor(s,c){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=r.uniqueId();const _=this.workerPool.acquire(this.id);for(let y=0;y<_.length;y++){const b=new vi.Actor(_[y],c,this.id);b.name=`Worker ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(s,c,_){r.asyncAll(this.actors,(y,b)=>{y.send(s,c,b)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(s=>{s.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ki(p,s,c){return s*(r.EXTENT/(p.tileSize*Math.pow(2,c-p.tileID.overscaledZ)))}vi.Actor=r.Actor;class gn{constructor(s,c,_,y){this.screenBounds=s,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(s,c){let _,y;if(s instanceof r.Point||typeof s[0]=="number"){const b=r.Point.convert(s);_=[b],y=c.isPointAboveHorizon(b)}else{const b=r.Point.convert(s[0]),M=r.Point.convert(s[1]);_=[b,M],y=r.polygonizeBounds(b,M).every(S=>c.isPointAboveHorizon(S))}return new gn(_,c.getCameraPoint(),y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(s){return r.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],s)}bufferedCameraGeometry(s){const c=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new r.Point(1,1)):this.screenBounds[1],y=r.polygonizeBounds(c,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<_.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),r.bufferConvexPolygon(y,s)}bufferedCameraGeometryGlobe(s){const c=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new r.Point(1,1)):this.screenBounds[1],y=r.polygonizeBounds(c,_,s),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>_.y))+((b.x>c.x)+(b.x>_.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(s,c,_,y=0){const b=s.queryPadding/c._pixelsPerMercatorPixel+1,M=_?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c);let S=s.tileID.wrap+(M.unwrapped?y:0);const P=M.polygon.map(Q=>r.getTilePoint(s.tileTransform,Q,S));if(!r.polygonIntersectsBox(P,0,0,r.EXTENT,r.EXTENT))return;S=s.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const z=this.screenGeometryMercator.polygon.map(Q=>r.getTileVec3(s.tileTransform,Q,S)),D=z.map(Q=>new r.Point(Q[0],Q[1])),N=c.getFreeCameraOptions().position||new r.MercatorCoordinate(0,0,0),q=r.getTileVec3(s.tileTransform,N,S),X=z.map(Q=>{const j=r.sub(Q,Q,q);return r.normalize(j,j),new r.Ray(q,j)}),J=ki(s,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:X,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(K=r.getBounds(P),K.min.x=r.clamp(K.min.x,0,r.EXTENT),K.min.y=r.clamp(K.min.y,0,r.EXTENT),K.max.x=r.clamp(K.max.x,0,r.EXTENT),K.max.y=r.clamp(K.max.y,0,r.EXTENT),K),tile:s,tileID:s.tileID,pixelToTileUnitsFactor:J};var K}_bufferedScreenMercator(s,c){const _=Nn(s);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(s),c):{polygon:this.bufferedScreenGeometry(s).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[_]=y,y}}_bufferedCameraMercator(s,c){const _=Nn(s);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(s),c):{polygon:this.bufferedCameraGeometry(s).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[_]=y,y}}_projectAndResample(s,c){const _=function(b,M){const S=r.multiply([],M.pixelMatrix,M.globeMatrix),P=[0,-r.GLOBE_RADIUS,0,1],z=[0,r.GLOBE_RADIUS,0,1],D=[0,0,0,1];r.transformMat4$1(P,P,S),r.transformMat4$1(z,z,S),r.transformMat4$1(D,D,S);const N=new r.Point(P[0]/P[3],P[1]/P[3]),q=new r.Point(z[0]/z[3],z[1]/z[3]),X=r.polygonContainsPoint(b,N)&&P[3]<D[3],J=r.polygonContainsPoint(b,q)&&z[3]<D[3];if(!X&&!J)return null;const K=function(_e,ve,xe){for(let Ae=1;Ae<_e.length;Ae++){const Ze=vn(ve.pointCoordinate3D(_e[Ae-1]).x),Ee=vn(ve.pointCoordinate3D(_e[Ae]).x);if(xe<0){if(Ze<Ee)return{idx:Ae,t:-Ze/(Ee-1-Ze)}}else if(Ee<Ze)return{idx:Ae,t:(1-Ze)/(Ee+1-Ze)}}return null}(b,M,X?-1:1);if(!K)return null;const{idx:Q,t:j}=K;let H=Q>1?_i(b.slice(0,Q),M):[],ne=Q<b.length?_i(b.slice(Q),M):[];H=H.map(_e=>new r.Point(vn(_e.x),_e.y)),ne=ne.map(_e=>new r.Point(vn(_e.x),_e.y));const se=[...H];se.length===0&&se.push(ne[ne.length-1]);const fe=r.number(se[se.length-1].y,(ne.length===0?H[0]:ne[0]).y,j);let me;return me=X?[new r.Point(0,fe),new r.Point(0,0),new r.Point(1,0),new r.Point(1,fe)]:[new r.Point(1,fe),new r.Point(1,1),new r.Point(0,1),new r.Point(0,fe)],se.push(...me),ne.length===0?se.push(H[0]):se.push(...ne),{polygon:se.map(_e=>new r.MercatorCoordinate(_e.x,_e.y)),unwrapped:!1}}(s,c);if(_)return _;const y=function(b,M){let S=!1,P=-1/0,z=0;for(let N=0;N<b.length-1;N++)b[N].x>P&&(P=b[N].x,z=N);for(let N=0;N<b.length-1;N++){const q=(z+N)%(b.length-1),X=b[q],J=b[q+1];Math.abs(X.x-J.x)>.5&&(X.x<J.x?(X.x+=1,q===0&&(b[b.length-1].x+=1)):(J.x+=1,q+1===b.length-1&&(b[0].x+=1)),S=!0)}const D=r.mercatorXfromLng(M.center.lng);return S&&D<Math.abs(D-1)&&b.forEach(N=>{N.x-=1}),{polygon:b,unwrapped:S}}(_i(s,c).map(b=>new r.Point(vn(b.x),b.y)),c);return{polygon:y.polygon.map(b=>new r.MercatorCoordinate(b.x,b.y)),unwrapped:y.unwrapped}}}function _i(p,s){return r.resample(p,c=>{const _=s.pointCoordinate3D(c);c.x=_.x,c.y=_.y},1/256)}function vn(p){return p<0?1+p%1:p%1}function Nn(p){return 100*p|0}function bn(p,s,c,_,y){const b=function(M,S){if(M)return y(M);if(S){p.url&&S.tiles&&p.tiles&&delete p.tiles;const P=r.pick(r.extend(S,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(P.vectorLayers=S.vector_layers,P.vectorLayerIds=P.vectorLayers.map(z=>z.id)),P.tiles=s.canonicalizeTileset(P,p.url),y(null,P)}};return p.url?r.getJSON(s.transformRequest(s.normalizeSourceURL(p.url,null,c,_),r.ResourceType.Source),b):r.exported.frame(()=>b(null,p))}class Es{constructor(s,c,_){this.bounds=r.LngLatBounds.convert(this.validateBounds(s)),this.minzoom=c||0,this.maxzoom=_||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const c=Math.pow(2,s.z),_=Math.floor(r.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(r.mercatorYfromLat(this.bounds.getNorth())*c),b=Math.ceil(r.mercatorXfromLng(this.bounds.getEast())*c),M=Math.ceil(r.mercatorYfromLat(this.bounds.getSouth())*c);return s.x>=_&&s.x<b&&s.y>=y&&s.y<M}}class $a{constructor(s,c,_){this.context=s;const y=s.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ur={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vr{constructor(s,c,_,y){this.length=c.length,this.attributes=_,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,c){for(let _=0;_<this.attributes.length;_++){const y=c.attributes[this.attributes[_].name];y!==void 0&&s.enableVertexAttribArray(y)}}setVertexAttribPointers(s,c,_){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],M=c.attributes[b.name];M!==void 0&&s.vertexAttribPointer(M,b.components,s[ur[b.type]],!1,this.itemSize,b.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nt{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ur extends Nt{getDefault(){return r.Color.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class zn extends Nt{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class Fo extends Nt{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Ei extends Nt{getDefault(){return[!0,!0,!0,!0]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class jn extends Nt{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class qa extends Nt{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Ms extends Nt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const c=this.current;(s.func!==c.func||s.ref!==c.ref||s.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Rn extends Nt{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class No extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=s,this.dirty=!1}}class Gr extends Nt{getDefault(){return[0,1]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class jo extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=s,this.dirty=!1}}class Hs extends Nt{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class $r extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.BLEND):c.disable(c.BLEND),this.current=s,this.dirty=!1}}class Wa extends Nt{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class Za extends Nt{getDefault(){return r.Color.transparent}set(s){const c=this.current;(s.r!==c.r||s.g!==c.g||s.b!==c.b||s.a!==c.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Vn extends Nt{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Xs extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;s?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=s,this.dirty=!1}}class Vo extends Nt{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class dr extends Nt{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}let qr,Uo=class extends Nt{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class pr extends Nt{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class Ys extends Nt{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const c=this.current;(s[0]!==c[0]||s[1]!==c[1]||s[2]!==c[2]||s[3]!==c[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class fr extends Nt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class _r extends Nt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Wr extends Nt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class Ha extends Nt{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class ae extends Nt{getDefault(){return null}set(s){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class G extends Nt{constructor(s){super(s),this.vao=s.extVertexArrayObject}getDefault(){return null}set(s){this.vao&&(s!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(s),this.current=s,this.dirty=!1)}}class $ extends Nt{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class re extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class pe extends Nt{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class ye extends Nt{constructor(s,c){super(s),this.context=s,this.parent=c}getDefault(){return null}}class Te extends ye{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class we extends ye{attachment(){return this.gl.DEPTH_ATTACHMENT}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class ge extends we{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ke{constructor(s,c,_,y){this.context=s,this.width=c,this.height=_;const b=this.framebuffer=s.gl.createFramebuffer();this.colorAttachment=new Te(s,b),y&&(this.depthAttachment=new we(s,b))}destroy(){const s=this.context.gl,c=this.colorAttachment.get();if(c&&s.deleteTexture(c),this.depthAttachment){const _=this.depthAttachment.get();_&&s.deleteRenderbuffer(_)}s.deleteFramebuffer(this.framebuffer)}}class tt{constructor(s,c=!1){if(this.gl=s,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const _=s;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(s),deleteVertexArrayOES:_.deleteVertexArray.bind(s),bindVertexArrayOES:_.bindVertexArray.bind(s)}}this.clearColor=new Ur(this),this.clearDepth=new zn(this),this.clearStencil=new Fo(this),this.colorMask=new Ei(this),this.depthMask=new jn(this),this.stencilMask=new qa(this),this.stencilFunc=new Ms(this),this.stencilOp=new Rn(this),this.stencilTest=new No(this),this.depthRange=new Gr(this),this.depthTest=new jo(this),this.depthFunc=new Hs(this),this.blend=new $r(this),this.blendFunc=new Wa(this),this.blendColor=new Za(this),this.blendEquation=new Vn(this),this.cullFace=new Xs(this),this.cullFaceSide=new Vo(this),this.frontFace=new dr(this),this.program=new Uo(this),this.activeTexture=new pr(this),this.viewport=new Ys(this),this.bindFramebuffer=new fr(this),this.bindRenderbuffer=new _r(this),this.bindTexture=new Wr(this),this.bindVertexBuffer=new Ha(this),this.bindElementBuffer=new ae(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new G(this),this.pixelStoreUnpack=new $(this),this.pixelStoreUnpackPremultiplyAlpha=new re(this),this.pixelStoreUnpackFlipY=new pe(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=s.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=s.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=s.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=s.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&s.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=s.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||s.getExtension("OES_standard_derivatives"),this.extTimerQuery=s.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,c){return new $a(this,s,c)}createVertexBuffer(s,c,_){return new Vr(this,s,c,_)}createRenderbuffer(s,c,_){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,s,c,_),this.bindRenderbuffer.set(null),b}createFramebuffer(s,c,_){return new ke(this,s,c,_)}clear({color:s,depth:c,stencil:_}){const y=this.gl;let b=0;s&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),_!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(b)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){T(s.blendFunction,r.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class it extends r.Evented{constructor(s,c,_,y){if(super(),this.id=s,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.extend(this,r.pick(c,["url","scheme","tileSize","promoteId"])),this._options=r.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.DedupedRequest}load(s){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=bn(this._options,this.map._requestManager,c,_,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new r.ErrorEvent(y))):b&&(r.extend(this,b),b.bounds&&(this.tileBounds=new Es(b.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(y)})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}loadTile(s,c){const _=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(_,r.ResourceType.Tile),data:void 0,uid:s.uid,tileID:s.tileID,tileZoom:s.tileZoom,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:s.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,s.actor&&s.state!=="expired")s.state==="loading"?s.reloadCallback=c:s.request=s.actor.send("reloadTile",y,b.bind(this));else if(s.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)s.request=s.actor.send("loadTile",y,b.bind(this),void 0,!0);else{const M=r.loadVectorTile.call({deduped:this._deduped},y,(S,P)=>{S||!P?b.call(this,S):(y.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},s.actor&&s.actor.send("loadTile",y,b.bind(this),void 0,!0))},!0);s.request={cancel:M}}function b(M,S){return delete s.request,s.aborted?c(null):M&&M.status!==404?c(M):(S&&S.resourceTiming&&(s.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&s.setExpiryData(S),s.loadVectorData(S,this.map.painter),r.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(s.reloadCallback&&(this.loadTile(s,s.reloadCallback),s.reloadCallback=null)))}}abortTile(s){s.request&&(s.request.cancel(),delete s.request),s.actor&&s.actor.send("abortTile",{uid:s.uid,type:this.type,source:this.id})}unloadTile(s){s.unloadVectorData(),s.actor&&s.actor.send("removeTile",{uid:s.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ke extends r.Evented{constructor(s,c,_,y){super(),this.id=s,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.extend({type:"raster"},c),r.extend(this,r.pick(c,["url","scheme","tileSize"]))}load(s){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bn(this._options,this.map._requestManager,null,null,(c,_)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new r.ErrorEvent(c)):_&&(r.extend(this,_),_.bounds&&(this.tileBounds=new Es(_.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(_.tiles),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),s&&s(c)})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(s){return this._options.tiles=s,this.reload(),this}setUrl(s){return this.url=s,this._options.url=s,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s,c){const _=r.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(s.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);s.request=r.getImage(this.map._requestManager.transformRequest(y,r.ResourceType.Tile),(b,M,S,P)=>(delete s.request,s.aborted?(s.state="unloaded",c(null)):b?(s.state="errored",c(b)):M?(this.map._refreshExpiredTiles&&s.setExpiryData({cacheControl:S,expires:P}),s.setTexture(M,this.map.painter),s.state="loaded",r.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(s,c,_){s.setTexture(c,_)}static unloadTileData(s,c){s.texture&&c.saveTileTexture(s.texture)}abortTile(s,c){s.request&&(s.request.cancel(),delete s.request),c()}unloadTile(s,c){s.texture&&this.map.painter.saveTileTexture(s.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function St(p,s,c,_,y,b,M,S){const P=[p,c,y,s,_,b,1,1,1],z=[M,S,1],D=r.adjoint([],P),[N,q,X]=r.transformMat3(z,z,r.transpose(D,D));return r.multiply$1(P,[N,0,0,0,q,0,0,0,X],P)}class Pt extends r.Evented{constructor(s,c,_,y){super(),this.id=s,this.dispatcher=_,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c,this._dirty=!1}load(s,c){this._loaded=c||!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=r.getImage(this.map._requestManager.transformRequest(this.url,r.ResourceType.Image),(_,y)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new r.ErrorEvent(_));else if(y){const{HTMLImageElement:b}=r.window;this.image=y instanceof b?r.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,s&&(this.coordinates=s),this._finishLoading()}})}loaded(){return this._loaded}updateImage(s){return this.image&&s.url?(this._imageRequest&&s.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=s.url,this.load(s.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(s){this.coordinates=s,this._boundsArray=void 0;const c=s.map(r.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let y=1/0,b=1/0,M=-1/0,S=-1/0;for(const N of _)y=Math.min(y,N.x),b=Math.min(b,N.y),M=Math.max(M,N.x),S=Math.max(S,N.y);const P=Math.max(M-y,S-b),z=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),D=Math.pow(2,z);return new r.CanonicalTileID(z,Math.floor((y+M)/2*D),Math.floor((b+S)/2*D))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(s){for(const P in this.tiles){const z=this.tiles[P];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;const c=r.tileTransform(this.tileID,this.map.transform.projection),[_,y,b,M]=this.coordinates.map(P=>{const z=c.projection.project(P[0],P[1]);return r.getTilePoint(c,z)._round()});this.perspectiveTransform=function(P,z,D,N,q,X,J,K,Q,j){const H=St(0,0,P,0,0,z,P,z),ne=St(D,N,q,X,J,K,Q,j);return r.multiply$1(ne,r.adjoint(H,H),ne),[ne[6]/ne[8]*P/r.EXTENT,ne[7]/ne[8]*z/r.EXTENT]}(this.width,this.height,_.x,_.y,y.x,y.y,M.x,M.y,b.x,b.y);const S=this._boundsArray=new r.StructArrayLayout4i8;S.emplaceBack(_.x,_.y,0,0),S.emplaceBack(y.x,y.y,r.EXTENT,0),S.emplaceBack(M.x,M.y,0,r.EXTENT),S.emplaceBack(b.x,b.y,r.EXTENT,r.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=s.createVertexBuffer(S,r.boundsAttributes.members),this.boundsSegments=r.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,c=s.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new r.Texture(s,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(s)}loadTile(s,c){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={},c(null)):(s.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const At={vector:it,raster:Ke,"raster-dem":class extends Ke{constructor(p,s,c,_){super(p,s,c,_),this.type="raster-dem",this.maxzoom=22,this._options=r.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}loadTile(p,s){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(y,b){y&&(p.state="errored",s(y)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",s(null))}p.request=r.getImage(this.map._requestManager.transformRequest(c,r.ResourceType.Tile),(function(y,b,M,S){if(delete p.request,p.aborted)p.state="unloaded",s(null);else if(y)p.state="errored",s(y);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:M,expires:S});const P=r.window.ImageBitmap&&b instanceof r.window.ImageBitmap&&(qr==null&&(qr=r.window.OffscreenCanvas&&new r.window.OffscreenCanvas(1,1).getContext("2d")&&typeof r.window.createImageBitmap=="function"),qr),z=1-(b.width-r.prevPowerOfTwo(b.width))/2;z<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const D=P?b:r.exported.getImageData(b,z),N={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:D,encoding:this.encoding,padding:z};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",N,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const s=p.canonical,c=Math.pow(2,s.z),_=(s.x-1+c)%c,y=s.x===0?p.wrap-1:p.wrap,b=(s.x+1+c)%c,M=s.x+1===c?p.wrap+1:p.wrap,S={};return S[new r.OverscaledTileID(p.overscaledZ,y,s.z,_,s.y).key]={backfilled:!1},S[new r.OverscaledTileID(p.overscaledZ,M,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(S[new r.OverscaledTileID(p.overscaledZ,y,s.z,_,s.y-1).key]={backfilled:!1},S[new r.OverscaledTileID(p.overscaledZ,p.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},S[new r.OverscaledTileID(p.overscaledZ,M,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<c&&(S[new r.OverscaledTileID(p.overscaledZ,y,s.z,_,s.y+1).key]={backfilled:!1},S[new r.OverscaledTileID(p.overscaledZ,p.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},S[new r.OverscaledTileID(p.overscaledZ,M,s.z,b,s.y+1).key]={backfilled:!1}),S}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends r.Evented{constructor(p,s,c,_){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(_),this._data=s.data,this._options=r.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const y=r.EXTENT/this.tileSize;this.workerOptions=r.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*y,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*y,extent:r.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:r.EXTENT,radius:(s.clusterRadius!==void 0?s.clusterRadius:50)*y,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},s),this}getClusterChildren(p,s){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},s),this}getClusterLeaves(p,s,c,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:s,offset:c},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=r.extend({},this.workerOptions),s=this._data;typeof s=="string"?(p.request=this.map._requestManager.transformRequest(r.exported.resolveURL(s),r.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(s),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,_)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new r.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),this.fire(new r.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,s){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(c,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,y)=>(delete p.request,p.unloadVectorData(),p.aborted?s(null):_?s(_):(p.loadVectorData(y,this.map.painter,c==="reloadTile"),s(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Pt{constructor(p,s,c,_){super(p,s,c,_),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const s of p.urls)this.urls.push(this.map._requestManager.transformRequest(s,r.ResourceType.Source).url);r.getVideo(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new r.ErrorEvent(s)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const s=this.video.seekable;p<s.start(0)||p>s.end(0)?this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,s=p.gl;this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new r.Texture(p,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Pt,canvas:class extends Pt{constructor(p,s,c,_){super(p,s,c,_),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof r.window.HTMLCanvasElement||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof r.window.HTMLCanvasElement?this.options.canvas:r.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.Texture(s,this.canvas,s.gl.RGBA,{premultiply:!0}),this._prepareData(s)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.Evented{constructor(p,s,c,_){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=s,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Es(this._implementation.bounds,this.minzoom,this.maxzoom)),s.update=this._update.bind(this),s.clearTiles=this._clearTiles.bind(this),s.coveringTiles=this._coveringTiles.bind(this),r.extend(this,r.pick(s,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:s,y:c,z:_}=p.canonical;return this._implementation.hasTile({x:s,y:c,z:_})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,s){const{x:c,y:_,z:y}=p.tileID.canonical,b=new r.window.AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:_,z:y},{signal:b.signal})).then((function(M){return delete p.request,p.aborted?(p.state="unloaded",s(null)):M===void 0?(p.state="errored",s(null)):M===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",s(null)):function(S){return S instanceof r.window.ImageData||S instanceof r.window.HTMLCanvasElement||S instanceof r.window.ImageBitmap||S instanceof r.window.HTMLImageElement}(M)?(this.loadTileData(p,M),p.state="loaded",void s(null)):(p.state="errored",s(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(M=>{M.code!==20&&(p.state="errored",s(M))}),p.request.cancel=()=>b.abort()}loadTileData(p,s){Ke.loadTileData(p,s,this._map.painter)}unloadTileData(p){Ke.unloadTileData(p,this._map.painter)}unloadTile(p,s){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:c,y:_,z:y}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:_,z:y})}s()}abortTile(p,s){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),s()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}}},kt=function(p,s,c,_){const y=new At[s.type](p,s,c,_);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return r.bindAll(["load","abort","unload","serialize","prepare"],y),y};function jt(p,s){const c=r.identity([]);return r.scale(c,c,[.5*p.width,.5*-p.height,1]),r.translate(c,c,[1,-1,0]),r.multiply(c,c,p.calculateProjMatrix(s.toUnwrapped())),Float32Array.from(c)}function Mi(p,s,c,_,y,b,M,S=!1){const P=p.tilesIn(_,M,S);P.sort(un);const z=[];for(const N of P)z.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(s,c,p._state,N,y,b,jt(p.transform,N.tile.tileID),S)});const D=function(N){const q={},X={};for(const J of N){const K=J.queryResults,Q=J.wrappedTileID,j=X[Q]=X[Q]||{};for(const H in K){const ne=K[H],se=j[H]=j[H]||{},fe=q[H]=q[H]||[];for(const me of ne)se[me.featureIndex]||(se[me.featureIndex]=!0,fe.push(me))}}return q}(z);for(const N in D)D[N].forEach(q=>{const X=q.feature,J=X.layer;J&&J.type!=="background"&&J.type!=="sky"&&(X.source=J.source,J["source-layer"]&&(X.sourceLayer=J["source-layer"]),X.state=X.id!==void 0?p.getFeatureState(J["source-layer"],X.id):{})});return D}function Ni(p,s){const c=p.getRenderableIds().map(b=>p.getTileByID(b)),_=[],y={};for(let b=0;b<c.length;b++){const M=c[b],S=M.tileID.canonical.key;y[S]||(y[S]=!0,M.querySourceFeatures(_,s))}return _}function un(p,s){const c=p.tileID,_=s.tileID;return c.overscaledZ-_.overscaledZ||c.canonical.y-_.canonical.y||c.wrap-_.wrap||c.canonical.x-_.canonical.x}function Hi(){return uo.workerClass!=null?new uo.workerClass:new r.window.Worker(uo.workerUrl)}const hs="mapboxgl_preloaded_worker_pool";class Qi{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Qi.workerCount;)this.workers.push(new Hi);return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[hs]}numActive(){return Object.keys(this.active).length}}let yn;function Zr(){return yn||(yn=new Qi),yn}function Fp(p,s){const c={};for(const _ in p)_!=="ref"&&(c[_]=p[_]);return r.refProperties.forEach(_=>{_ in s&&(c[_]=s[_])}),c}function _u(p){p=p.slice();const s=Object.create(null);for(let c=0;c<p.length;c++)s[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Fp(p[c],s[p[c].ref]));return p}Qi.workerCount=2;const Xt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function oc(p,s,c){c.push({command:Xt.addSource,args:[p,s[p]]})}function Go(p,s,c){s.push({command:Xt.removeSource,args:[p]}),c[p]=!0}function ac(p,s,c,_){Go(p,c,_),oc(p,s,c)}function Xa(p,s,c){let _;for(_ in p[c])if(p[c].hasOwnProperty(_)&&_!=="data"&&!T(p[c][_],s[c][_]))return!1;for(_ in s[c])if(s[c].hasOwnProperty(_)&&_!=="data"&&!T(p[c][_],s[c][_]))return!1;return!0}function us(p,s,c,_,y,b){let M;for(M in s=s||{},p=p||{})p.hasOwnProperty(M)&&(T(p[M],s[M])||c.push({command:b,args:[_,M,s[M],y]}));for(M in s)s.hasOwnProperty(M)&&!p.hasOwnProperty(M)&&(T(p[M],s[M])||c.push({command:b,args:[_,M,s[M],y]}))}function Ss(p){return p.id}function lc(p,s){return p[s.id]=s,p}class cc{constructor(s,c){this.reset(s,c)}reset(s,c){this.points=s||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=r.clamp(s,0,1);let c=1,_=this._distances[c];const y=s*this.paddedLength+this.padding;for(;_<y&&c<this._distances.length;)_=this._distances[++c];const b=c-1,M=this._distances[b],S=_-M,P=S>0?(y-M)/S:0;return this.points[b].mult(1-P).add(this.points[c].mult(P))}}class mr{constructor(s,c,_){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/_),this.yCellCount=Math.ceil(c/_);for(let M=0;M<this.xCellCount*this.yCellCount;M++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=c,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,c,_,y,b){this._forEachCell(c,_,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(c),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(s,c,_,y){this._forEachCell(c-y,_-y,c+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(c),this.circles.push(_),this.circles.push(y)}_insertBoxCell(s,c,_,y,b,M){this.boxCells[b].push(M)}_insertCircleCell(s,c,_,y,b,M){this.circleCells[b].push(M)}_query(s,c,_,y,b,M){if(_<0||s>this.width||y<0||c>this.height)return!b&&[];const S=[];if(s<=0&&c<=0&&this.width<=_&&this.height<=y){if(b)return!0;for(let P=0;P<this.boxKeys.length;P++)S.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],D=this.circles[3*P+1],N=this.circles[3*P+2];S.push({key:this.circleKeys[P],x1:z-N,y1:D-N,x2:z+N,y2:D+N})}return M?S.filter(M):S}return this._forEachCell(s,c,_,y,this._queryCell,S,{hitTest:b,seenUids:{box:{},circle:{}}},M),b?S.length>0:S}_queryCircle(s,c,_,y,b){const M=s-_,S=s+_,P=c-_,z=c+_;if(S<0||M>this.width||z<0||P>this.height)return!y&&[];const D=[];return this._forEachCell(M,P,S,z,this._queryCellCircle,D,{hitTest:y,circle:{x:s,y:c,radius:_},seenUids:{box:{},circle:{}}},b),y?D.length>0:D}query(s,c,_,y,b){return this._query(s,c,_,y,!1,b)}hitTest(s,c,_,y,b){return this._query(s,c,_,y,!0,b)}hitTestCircle(s,c,_,y){return this._queryCircle(s,c,_,!0,y)}_queryCell(s,c,_,y,b,M,S,P){const z=S.seenUids,D=this.boxCells[b];if(D!==null){const q=this.bboxes;for(const X of D)if(!z.box[X]){z.box[X]=!0;const J=4*X;if(s<=q[J+2]&&c<=q[J+3]&&_>=q[J+0]&&y>=q[J+1]&&(!P||P(this.boxKeys[X]))){if(S.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[X],x1:q[J],y1:q[J+1],x2:q[J+2],y2:q[J+3]})}}}const N=this.circleCells[b];if(N!==null){const q=this.circles;for(const X of N)if(!z.circle[X]){z.circle[X]=!0;const J=3*X;if(this._circleAndRectCollide(q[J],q[J+1],q[J+2],s,c,_,y)&&(!P||P(this.circleKeys[X]))){if(S.hitTest)return M.push(!0),!0;{const K=q[J],Q=q[J+1],j=q[J+2];M.push({key:this.circleKeys[X],x1:K-j,y1:Q-j,x2:K+j,y2:Q+j})}}}}}_queryCellCircle(s,c,_,y,b,M,S,P){const z=S.circle,D=S.seenUids,N=this.boxCells[b];if(N!==null){const X=this.bboxes;for(const J of N)if(!D.box[J]){D.box[J]=!0;const K=4*J;if(this._circleAndRectCollide(z.x,z.y,z.radius,X[K+0],X[K+1],X[K+2],X[K+3])&&(!P||P(this.boxKeys[J])))return M.push(!0),!0}}const q=this.circleCells[b];if(q!==null){const X=this.circles;for(const J of q)if(!D.circle[J]){D.circle[J]=!0;const K=3*J;if(this._circlesCollide(X[K],X[K+1],X[K+2],z.x,z.y,z.radius)&&(!P||P(this.circleKeys[J])))return M.push(!0),!0}}}_forEachCell(s,c,_,y,b,M,S,P){const z=this._convertToXCellCoord(s),D=this._convertToYCellCoord(c),N=this._convertToXCellCoord(_),q=this._convertToYCellCoord(y);for(let X=z;X<=N;X++)for(let J=D;J<=q;J++)if(b.call(this,s,c,_,y,this.xCellCount*J+X,M,S,P))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,c,_,y,b,M){const S=y-s,P=b-c,z=_+M;return z*z>S*S+P*P}_circleAndRectCollide(s,c,_,y,b,M,S){const P=(M-y)/2,z=Math.abs(s-(y+P));if(z>P+_)return!1;const D=(S-b)/2,N=Math.abs(c-(b+D));if(N>D+_)return!1;if(z<=P||N<=D)return!0;const q=z-P,X=N-D;return q*q+X*X<=_*_}}const As={unknown:0,flipRequired:1,flipNotRequired:2},$o=Math.tan(85*Math.PI/180);function Oe(p,s,c,_,y,b,M){const S=r.create();if(c)if(b.name==="globe"){const P=r.calculateGlobeLabelMatrix(y,s);r.multiply(S,S,P)}else{const P=De([],M);S[0]=P[0],S[1]=P[1],S[4]=P[2],S[5]=P[3],_||r.rotateZ(S,S,y.angle)}else r.multiply(S,y.labelPlaneMatrix,p);return S}function Is(p,s,c,_,y,b,M){const S=Oe(p,s,c,_,y,b,M);return b.name==="globe"&&c||(S[2]=S[6]=S[10]=S[14]=0),S}function ji(p,s,c,_,y,b,M){if(c){if(b.name==="globe"){const S=Oe(p,s,c,_,y,b,M);return r.invert(S,S),r.multiply(S,p,S),S}{const S=r.clone(p),P=r.identity([]);return P[0]=M[0],P[1]=M[1],P[4]=M[2],P[5]=M[3],r.multiply(S,S,P),_||r.rotateZ(S,S,-y.angle),S}}return y.glCoordMatrix}function en(p,s,c,_){const y=[p,s,c,1];c?r.transformMat4$1(y,y,_):Ot(y,y,_);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function mu(p,s){return Math.min(.5+p/s*.5,1.5)}function ds(p,s){const c=p[0]/p[3],_=p[1]/p[3];return c>=-s[0]&&c<=s[0]&&_>=-s[1]&&_<=s[1]}function hc(p,s,c,_,y,b,M,S,P,z){const D=c.transform,N=_?p.textSizeData:p.iconSizeData,q=r.evaluateSizeForZoom(N,c.transform.zoom),X=D.projection.name==="globe",J=[256/c.width*2+1,256/c.height*2+1],K=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;K.clear();let Q=null;X&&(Q=_?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const j=p.lineVertexArray,H=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,ne=c.transform.width/c.transform.height;let se,fe=!1;for(let me=0;me<H.length;me++){const _e=H.get(me),{numGlyphs:ve,writingMode:xe}=_e;if(xe!==r.WritingMode.vertical||fe||se===r.WritingMode.horizontal||(fe=!0),se=xe,(_e.hidden||xe===r.WritingMode.vertical)&&!fe){es(ve,K);continue}fe=!1;const Ae=new r.Point(_e.tileAnchorX,_e.tileAnchorY);let{x:Ze,y:Ee,z:je}=D.projection.projectTilePoint(Ae.x,Ae.y,z.canonical);if(P){const[wt,dt,xt]=P(Ae);Ze+=wt,Ee+=dt,je+=xt}const Ce=[Ze,Ee,je,1];if(r.transformMat4$1(Ce,Ce,s),!ds(Ce,J)){es(ve,K);continue}const We=mu(c.transform.cameraToCenterDistance,Ce[3]),Se=r.evaluateSizeForFeature(N,q,_e),Ne=M?Se/We:Se*We,Xe=en(Ze,Ee,je,y);if(Xe[3]<=0){es(ve,K);continue}let Ge={};const Ye=M?null:P,mt=lt(_e,Ne,!1,S,s,y,b,p.glyphOffsetArray,j,K,Q,Xe,Ae,Ge,ne,Ye,D.projection,z,M);fe=mt.useVertical,Ye&&mt.needsFlipping&&(Ge={}),(mt.notEnoughRoom||fe||mt.needsFlipping&&lt(_e,Ne,!0,S,s,y,b,p.glyphOffsetArray,j,K,Q,Xe,Ae,Ge,ne,Ye,D.projection,z,M).notEnoughRoom)&&es(ve,K)}_?(p.text.dynamicLayoutVertexBuffer.updateData(K),Q&&p.text.globeExtVertexBuffer.updateData(Q)):(p.icon.dynamicLayoutVertexBuffer.updateData(K),Q&&p.icon.globeExtVertexBuffer.updateData(Q))}function gu(p,s,c,_,y,b,M,S,P,z,D,N,q,X,J,K){const{lineStartIndex:Q,glyphStartIndex:j,segment:H}=S,ne=j+S.numGlyphs,se=Q+S.lineLength,fe=s.getoffsetX(j),me=s.getoffsetX(ne-1),_e=On(p*fe,c,_,y,b,M,H,Q,se,P,z,D,N,q,!0,X,J,K);if(!_e)return null;const ve=On(p*me,c,_,y,b,M,H,Q,se,P,z,D,N,q,!0,X,J,K);return ve?{first:_e,last:ve}:null}function Hr(p,s,c,_){return p===r.WritingMode.horizontal&&Math.abs(_)>Math.abs(c)?{useVertical:!0}:p===r.WritingMode.vertical?_>0?{needsFlipping:!0}:null:s!==As.unknown&&function(y,b){return y===0||Math.abs(b/y)>$o}(c,_)?s===As.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function lt(p,s,c,_,y,b,M,S,P,z,D,N,q,X,J,K,Q,j,H){const ne=s/24,se=p.lineOffsetX*ne,fe=p.lineOffsetY*ne,{lineStartIndex:me,glyphStartIndex:_e,numGlyphs:ve,segment:xe,writingMode:Ae,flipState:Ze}=p,Ee=me+p.lineLength,je=Ce=>{if(D){const[Xe,Ge,Ye]=Ce.up,mt=z.length;r.updateGlobeVertexNormal(D,mt+0,Xe,Ge,Ye),r.updateGlobeVertexNormal(D,mt+1,Xe,Ge,Ye),r.updateGlobeVertexNormal(D,mt+2,Xe,Ge,Ye),r.updateGlobeVertexNormal(D,mt+3,Xe,Ge,Ye)}const[We,Se,Ne]=Ce.point;r.addDynamicAttributes(z,We,Se,Ne,Ce.angle)};if(ve>1){const Ce=gu(ne,S,se,fe,c,N,q,p,P,b,X,K,!1,Q,j,H);if(!Ce)return{notEnoughRoom:!0};if(_&&!c){let[We,Se,Ne]=Ce.first.point,[Xe,Ge,Ye]=Ce.last.point;[We,Se]=en(We,Se,Ne,M),[Xe,Ge]=en(Xe,Ge,Ye,M);const mt=Hr(Ae,Ze,(Xe-We)*J,Ge-Se);if(p.flipState=mt&&mt.needsFlipping?As.flipRequired:As.flipNotRequired,mt)return mt}je(Ce.first);for(let We=_e+1;We<_e+ve-1;We++){const Se=On(ne*S.getoffsetX(We),se,fe,c,N,q,xe,me,Ee,P,b,X,K,!1,!1,Q,j,H);if(!Se)return z.length-=4*(We-_e),{notEnoughRoom:!0};je(Se)}je(Ce.last)}else{if(_&&!c){const We=en(q.x,q.y,0,y),Se=me+xe+1,Ne=new r.Point(P.getx(Se),P.gety(Se)),Xe=en(Ne.x,Ne.y,0,y),Ge=Xe[3]>0?Xe:Rt(q,Ne,We,1,y,void 0,Q,j.canonical),Ye=Hr(Ae,Ze,(Ge[0]-We[0])*J,Ge[1]-We[1]);if(p.flipState=Ye&&Ye.needsFlipping?As.flipRequired:As.flipNotRequired,Ye)return Ye}const Ce=On(ne*S.getoffsetX(_e),se,fe,c,N,q,xe,me,Ee,P,b,X,K,!1,!1,Q,j,H);if(!Ce)return{notEnoughRoom:!0};je(Ce)}return{}}function Ft(p,s,c,_,y){const{x:b,y:M,z:S}=_.projectTilePoint(p.x,p.y,s);if(!y)return en(b,M,S,c);const[P,z,D]=y(p);return en(b+P,M+z,S+D,c)}function Rt(p,s,c,_,y,b,M,S){const P=Ft(p.sub(s)._unit()._add(p),S,y,M,b);return r.sub(P,c,P),r.normalize(P,P),r.scaleAndAdd(P,c,P,_)}function On(p,s,c,_,y,b,M,S,P,z,D,N,q,X,J,K,Q,j){const H=_?p-s:p+s;let ne=H>0?1:-1,se=0;_&&(ne*=-1,se=Math.PI),ne<0&&(se+=Math.PI);let fe=S+M+(ne>0?0:1)|0,me=y,_e=y,ve=0,xe=0;const Ae=Math.abs(H),Ze=[],Ee=[];let je=b,Ce=je;const We=()=>Rt(Ce,je,_e,Ae-ve+1,D,q,K,Q.canonical);for(;ve+xe<=Ae;){if(fe+=ne,fe<S||fe>=P)return null;if(_e=me,Ce=je,Ze.push(_e),X&&Ee.push(Ce),je=new r.Point(z.getx(fe),z.gety(fe)),me=N[fe],!me){const xt=Ft(je,Q.canonical,D,K,q);me=xt[3]>0?N[fe]=xt:We()}ve+=xe,xe=r.distance(_e,me)}J&&q&&(N[fe]&&(me=We(),xe=r.distance(_e,me)),N[fe]=me);const Se=(Ae-ve)/xe,Ne=je.sub(Ce)._mult(Se)._add(Ce),Xe=r.sub([],me,_e),Ge=r.scaleAndAdd([],_e,Xe,Se);let Ye=[0,0,1],mt=Xe[0],wt=Xe[1];if(j&&(Ye=K.upVector(Q.canonical,Ne.x,Ne.y),Ye[0]!==0||Ye[1]!==0||Ye[2]!==1)){const xt=[Ye[2],0,-Ye[0]],Bt=r.cross([],Ye,xt);r.normalize(xt,xt),r.normalize(Bt,Bt),mt=r.dot(Xe,xt),wt=r.dot(Xe,Bt)}if(c){const xt=r.cross([],Ye,Xe);r.normalize(xt,xt),r.scaleAndAdd(Ge,Ge,xt,c*ne)}const dt=se+Math.atan2(wt,mt);return Ze.push(Ge),X&&Ee.push(Ne),{point:Ge,angle:dt,path:Ze,tilePath:Ee,up:Ye}}function es(p,s){const c=s.length,_=c+4*p;s.resize(_),s.float32.fill(-1/0,4*c,4*_)}function Ot(p,s,c){const _=s[0],y=s[1];return p[0]=c[0]*_+c[4]*y+c[12],p[1]=c[1]*_+c[5]*y+c[13],p[3]=c[3]*_+c[7]*y+c[15],p}const Bn=100;class qo{constructor(s,c,_=new mr(s.width+200,s.height+200,25),y=new mr(s.width+200,s.height+200,25)){this.transform=s,this.grid=_,this.ignoredGrid=y,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+Bn,this.screenBottomBoundary=s.height+Bn,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.fogState=c}placeCollisionBox(s,c,_,y,b,M,S,P){let z=_.projectedAnchorX,D=_.projectedAnchorY,N=_.projectedAnchorZ;const q=_.elevation,X=_.tileID,J=s.getProjection();if(q&&X){const[me,_e,ve]=J.upVector(X.canonical,_.tileAnchorX,_.tileAnchorY),xe=J.upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=me*q*xe,D+=_e*q*xe,N+=ve*q*xe}const K=this.projectAndGetPerspectiveRatio(S,z,D,N,_.tileID,J.name==="globe"||!!q||this.transform.pitch>0,J),Q=M*K.perspectiveRatio,j=(_.x1*c+y.x-_.padding)*Q+K.point.x,H=(_.y1*c+y.y-_.padding)*Q+K.point.y,ne=(_.x2*c+y.x+_.padding)*Q+K.point.x,se=(_.y2*c+y.y+_.padding)*Q+K.point.y,fe=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(j,H,ne,se)||!b&&this.grid.hitTest(j,H,ne,se,P)||fe?{box:[],offscreen:!1,occluded:K.occluded}:{box:[j,H,ne,se],offscreen:this.isOffscreen(j,H,ne,se),occluded:!1}}placeCollisionCircles(s,c,_,y,b,M,S,P,z,D,N,q,X,J,K){const Q=[],j=this.transform.elevation,H=s.getProjection(),ne=j?j.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,H):null,se=new r.Point(_.tileAnchorX,_.tileAnchorY);let{x:fe,y:me,z:_e}=H.projectTilePoint(se.x,se.y,K.canonical);if(ne){const[Ne,Xe,Ge]=ne(se);fe+=Ne,me+=Xe,_e+=Ge}const ve=H.name==="globe",xe=this.projectAndGetPerspectiveRatio(S,fe,me,_e,K,ve||!!j||this.transform.pitch>0,H),{perspectiveRatio:Ae}=xe,Ze=(N?M/Ae:M*Ae)/r.ONE_EM,Ee=en(fe,me,_e,P),je=xe.signedDistanceFromCamera>0?gu(Ze,b,_.lineOffsetX*Ze,_.lineOffsetY*Ze,!1,Ee,se,_,y,P,{},j&&!N?ne:null,N&&!!j,H,K,N):null;let Ce=!1,We=!1,Se=!0;if(je&&!xe.occluded){const Ne=.5*X*Ae+J,Xe=new r.Point(-100,-100),Ge=new r.Point(this.screenRightBoundary,this.screenBottomBoundary),Ye=new cc,{first:mt,last:wt}=je,dt=mt.path.length;let xt=[];for(let _t=dt-1;_t>=1;_t--)xt.push(mt.path[_t]);for(let _t=1;_t<wt.path.length;_t++)xt.push(wt.path[_t]);const Bt=2.5*Ne;z&&(xt=xt.map(([_t,Jt,ii],ni)=>(ne&&!ve&&(ii=ne(ni<dt-1?mt.tilePath[dt-1-ni]:wt.tilePath[ni-dt+2])[2]),en(_t,Jt,ii,z))),xt.some(_t=>_t[3]<=0)&&(xt=[]));let Lt=[];if(xt.length>0){let _t=1/0,Jt=-1/0,ii=1/0,ni=-1/0;for(const si of xt)_t=Math.min(_t,si[0]),ii=Math.min(ii,si[1]),Jt=Math.max(Jt,si[0]),ni=Math.max(ni,si[1]);Jt>=Xe.x&&_t<=Ge.x&&ni>=Xe.y&&ii<=Ge.y&&(Lt=[xt.map(si=>new r.Point(si[0],si[1]))],(_t<Xe.x||Jt>Ge.x||ii<Xe.y||ni>Ge.y)&&(Lt=r.clipLine(Lt,Xe.x,Xe.y,Ge.x,Ge.y)))}for(const _t of Lt){Ye.reset(_t,.25*Ne);let Jt=0;Jt=Ye.length<=.5*Ne?1:Math.ceil(Ye.paddedLength/Bt)+1;for(let ii=0;ii<Jt;ii++){const ni=ii/Math.max(Jt-1,1),si=Ye.lerp(ni),pn=si.x+Bn,nn=si.y+Bn;Q.push(pn,nn,Ne,0);const Wn=pn-Ne,ms=nn-Ne,wi=pn+Ne,ri=nn+Ne;if(Se=Se&&this.isOffscreen(Wn,ms,wi,ri),We=We||this.isInsideGrid(Wn,ms,wi,ri),!c&&this.grid.hitTestCircle(pn,nn,Ne,q)&&(Ce=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ce,occluded:!1}}}}return{circles:!D&&Ce||!We?[]:Q,offscreen:Se,collisionDetected:Ce,occluded:xe.occluded}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let _=1/0,y=1/0,b=-1/0,M=-1/0;for(const D of s){const N=new r.Point(D.x+Bn,D.y+Bn);_=Math.min(_,N.x),y=Math.min(y,N.y),b=Math.max(b,N.x),M=Math.max(M,N.y),c.push(N)}const S=this.grid.query(_,y,b,M).concat(this.ignoredGrid.query(_,y,b,M)),P={},z={};for(const D of S){const N=D.key;if(P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]={}),P[N.bucketInstanceId][N.featureIndex])continue;const q=[new r.Point(D.x1,D.y1),new r.Point(D.x2,D.y1),new r.Point(D.x2,D.y2),new r.Point(D.x1,D.y2)];r.polygonIntersectsPolygon(c,q)&&(P[N.bucketInstanceId][N.featureIndex]=!0,z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]=[]),z[N.bucketInstanceId].push(N.featureIndex))}return z}insertCollisionBox(s,c,_,y,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:y,collisionGroupID:b},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,c,_,y,b){const M=c?this.ignoredGrid:this.grid,S={bucketInstanceId:_,featureIndex:y,collisionGroupID:b};for(let P=0;P<s.length;P+=4)M.insertCircle(S,s[P],s[P+1],s[P+2])}projectAndGetPerspectiveRatio(s,c,_,y,b,M,S){const P=[c,_,y,1];let z=!1;y||this.transform.pitch>0?(r.transformMat4$1(P,P,s),this.fogState&&b&&S.name!=="globe"&&(z=function(q,X,J,K,Q,j){const H=j.calculateFogTileMatrix(Q),ne=[X,J,K];return r.transformMat4(ne,ne,H),ti(q,ne,j.pitch,j._fov)}(this.fogState,c,_,y,b.toUnwrapped(),this.transform)>.9)):Ot(P,P,s);const D=P[3];return{point:new r.Point((P[0]/D+1)/2*this.transform.width+Bn,(-P[1]/D+1)/2*this.transform.height+Bn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/D*.5,1.5),signedDistanceFromCamera:D,occluded:M&&P[2]>D||z}}isOffscreen(s,c,_,y){return _<Bn||s>=this.screenRightBoundary||y<Bn||c>this.screenBottomBoundary}isInsideGrid(s,c,_,y){return _>=0&&s<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const s=r.identity([]);return r.translate(s,s,[-100,-100,0]),s}}function gr(p,s,c){const _=s.createTileMatrix(p,p.worldSize,c.toUnwrapped());return r.multiply(new Float32Array(16),p.projMatrix,_)}function Un(p,s,c){if(s.projection.name===c.projection.name)return p.projMatrix;const _=c.clone();return _.setProjection(s.projection),gr(_,s.getProjection(),p)}function bi(p,s,c){return s.name===c.projection.name?p.projMatrix:gr(c,s,p)}class yu{constructor(s,c,_,y){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?c:-c))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Cs{constructor(s,c,_,y,b,M=!1){this.text=new yu(s?s.text:null,c,_,b),this.icon=new yu(s?s.icon:null,c,y,b),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Wo{constructor(s,c,_,y=!1){this.text=s,this.icon=c,this.skipFade=_,this.clipped=y}}class Zo{constructor(){this.invProjMatrix=r.create(),this.viewportMatrix=r.create(),this.circles=[]}}class uc{constructor(s,c,_,y,b){this.bucketInstanceId=s,this.featureIndex=c,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=b}}class xu{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const c=++this.maxGroupID;this.collisionGroups[s]={ID:c,predicate:_=>_.collisionGroupID===c}}return this.collisionGroups[s]}}function Ho(p,s,c,_,y){const{horizontalAlign:b,verticalAlign:M}=r.getAnchorAlignment(p),S=-(b-.5)*s,P=-(M-.5)*c,z=r.evaluateVariableOffset(p,_);return new r.Point(S+z[0]*y,P+z[1]*y)}function Xo(p,s,c,_,y){const b=new r.Point(p,s);return c&&b._rotate(_?y:-y),b}class Ya{constructor(s,c,_,y,b){this.transform=s.clone(),this.projection=s.projection.name,this.collisionIndex=new qo(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new xu(_),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,c,_,y){const b=_.getBucket(c),M=_.latestFeatureIndex;if(!b||!M||c.id!==b.layerIds[0])return;const S=b.layers[0].layout,P=_.collisionBoxArray,z=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),D=_.tileSize/r.EXTENT,N=_.tileID.toUnwrapped();this.transform.setProjection(b.projection);const q=(X=_.tileID,J=b.getProjection(),K=this.transform,J.name===this.projection?K.calculateProjMatrix(X.toUnwrapped()):gr(K,J,X));var X,J,K;const Q=S.get("text-pitch-alignment")==="map",j=S.get("text-rotation-alignment")==="map";c.compileFilter();const H=c.dynamicFilter(),ne=c.dynamicFilterNeedsFeature(),se=this.transform.calculatePixelsToTileUnitsMatrix(_),fe=Is(q,_.tileID.canonical,Q,j,this.transform,b.getProjection(),se);let me=null;if(Q){const xe=ji(q,_.tileID.canonical,Q,j,this.transform,b.getProjection(),se);me=r.multiply([],this.transform.labelPlaneMatrix,xe)}let _e=null;H&&_.latestFeatureIndex&&(_e={unwrappedTileID:N,dynamicFilter:H,dynamicFilterNeedsFeature:ne,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new uc(b.bucketInstanceId,M,b.sourceLayerIndex,b.index,_.tileID);const ve={bucket:b,layout:S,posMatrix:q,textLabelPlaneMatrix:fe,labelToScreenMatrix:me,clippingData:_e,scale:z,textPixelRatio:D,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:r.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(y)for(const xe of b.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:Ze,symbolInstanceEnd:Ee}=xe;s.push({sortKey:Ae,symbolInstanceStart:Ze,symbolInstanceEnd:Ee,parameters:ve})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(s,c,_,y,b,M,S,P,z,D,N,q,X,J,K,Q,j,H){const{textOffset0:ne,textOffset1:se,crossTileID:fe}=q,me=[ne,se],_e=Ho(s,_,y,me,b),ve=this.collisionIndex.placeCollisionBox(J,b,c,Xo(_e.x,_e.y,M,S,this.transform.angle),N,P,z,D.predicate);if(Q){const xe=J.getSymbolInstanceIconSize(H,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,xe,Q,Xo(_e.x,_e.y,M,S,this.transform.angle),N,P,z,D.predicate).box.length===0)return}if(ve.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(xe=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:me,width:_,height:y,anchor:s,textScale:b,prevAnchor:xe},this.markUsedJustification(J,s,q,K),J.allowVerticalPlacement&&(this.markUsedOrientation(J,K,q),this.placedOrientations[fe]=K),{shift:_e,placedGlyphBoxes:ve}}}placeLayerBucketPart(s,c,_,y){const{bucket:b,layout:M,posMatrix:S,textLabelPlaneMatrix:P,labelToScreenMatrix:z,clippingData:D,textPixelRatio:N,holdingForFade:q,collisionBoxArray:X,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:K,collisionGroup:Q}=s.parameters,j=M.get("text-optional"),H=M.get("icon-optional"),ne=M.get("text-allow-overlap"),se=M.get("icon-allow-overlap"),fe=M.get("text-rotation-alignment")==="map",me=M.get("text-pitch-alignment")==="map",_e=M.get("icon-text-fit")!=="none",ve=M.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let xe=ne&&(se||!b.hasIconData()||H),Ae=se&&(ne||!b.hasTextData()||j);!b.collisionArrays&&X&&b.deserializeCollisionBoxes(X),_&&y&&b.updateCollisionDebugBuffers(this.transform.zoom,X);const Ze=(Ee,je,Ce)=>{const{crossTileID:We,numVerticalGlyphVertices:Se}=Ee;if(D){const wi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ri=null;if(D.dynamicFilterNeedsFeature){const Wt=this.retainedQueryData[b.bucketInstanceId];ri=D.featureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:Wt.bucketIndex,sourceLayerIndex:Wt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,D.dynamicFilter)(wi,ri,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.Point(Ee.tileAnchorX,Ee.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[We]=new Wo(!1,!1,!1,!0),void c.add(We)}if(c.has(We))return;if(q)return void(this.placements[We]=new Wo(!1,!1,!1));let Ne=!1,Xe=!1,Ge=!0,Ye=!1,mt=!1,wt=null,dt={box:null,offscreen:null,occluded:null},xt={box:null,offscreen:null,occluded:null},Bt=null,Lt=null,_t=null,Jt=0,ii=0,ni=0;Ce.textFeatureIndex?Jt=Ce.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(Jt=Ee.featureIndex),Ce.verticalTextFeatureIndex&&(ii=Ce.verticalTextFeatureIndex);const si=wi=>{wi.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const ri=this.transform.elevation;(ri||wi.elevation)&&(wi.elevation=ri?ri.getAtTileOffset(wi.tileID,wi.tileAnchorX,wi.tileAnchorY):0)},pn=Ce.textBox;if(pn){si(pn);const wi=Wt=>{let Vi=r.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Wt&&this.prevPlacement){const xn=this.prevPlacement.placedOrientations[We];xn&&(this.placedOrientations[We]=xn,Vi=xn,this.markUsedOrientation(b,Vi,Ee))}return Vi},ri=(Wt,Vi)=>{if(b.allowVerticalPlacement&&Se>0&&Ce.verticalTextBox){for(const xn of b.writingModes)if(xn===r.WritingMode.vertical?(dt=Vi(),xt=dt):dt=Wt(),dt&&dt.box&&dt.box.length)break}else dt=Wt()};if(M.get("text-variable-anchor")){let Wt=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[We]){const mi=this.prevPlacement.variableOffsets[We];Wt.indexOf(mi.anchor)>0&&(Wt=Wt.filter(En=>En!==mi.anchor),Wt.unshift(mi.anchor))}const Vi=(mi,En,Tl)=>{const Mr=b.getSymbolInstanceTextSize(J,Ee,this.transform.zoom,je),_a=(mi.x2-mi.x1)*Mr+2*mi.padding,Os=(mi.y2-mi.y1)*Mr+2*mi.padding,Qs=_e&&!se?En:null;Qs&&si(Qs);let Sr={box:[],offscreen:!1,occluded:!1};const El=ne?2*Wt.length:Wt.length;for(let ma=0;ma<El;++ma){const th=this.attemptAnchorPlacement(Wt[ma%Wt.length],mi,_a,Os,Mr,fe,me,N,S,Q,ma>=Wt.length,Ee,je,b,Tl,Qs,J,K);if(th&&(Sr=th.placedGlyphBoxes,Sr&&Sr.box&&Sr.box.length)){Ne=!0,wt=th.shift;break}}return Sr};ri(()=>Vi(pn,Ce.iconBox,r.WritingMode.horizontal),()=>{const mi=Ce.verticalTextBox;return mi&&si(mi),b.allowVerticalPlacement&&!(dt&&dt.box&&dt.box.length)&&Se>0&&mi?Vi(mi,Ce.verticalIconBox,r.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),dt&&(Ne=dt.box,Ge=dt.offscreen,Ye=dt.occluded);const xn=wi(!(!dt||!dt.box));if(!Ne&&this.prevPlacement){const mi=this.prevPlacement.variableOffsets[We];mi&&(this.variableOffsets[We]=mi,this.markUsedJustification(b,mi.anchor,Ee,xn))}}else{const Wt=(Vi,xn)=>{const mi=b.getSymbolInstanceTextSize(J,Ee,this.transform.zoom,je),En=this.collisionIndex.placeCollisionBox(b,mi,Vi,new r.Point(0,0),ne,N,S,Q.predicate);return En&&En.box&&En.box.length&&(this.markUsedOrientation(b,xn,Ee),this.placedOrientations[We]=xn),En};ri(()=>Wt(pn,r.WritingMode.horizontal),()=>{const Vi=Ce.verticalTextBox;return b.allowVerticalPlacement&&Se>0&&Vi?(si(Vi),Wt(Vi,r.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),wi(!!(dt&&dt.box&&dt.box.length))}}if(Bt=dt,Ne=Bt&&Bt.box&&Bt.box.length>0,Ge=Bt&&Bt.offscreen,Ye=Bt&&Bt.occluded,Ee.useRuntimeCollisionCircles){const wi=b.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex>=0?Ee.centerJustifiedTextSymbolIndex:Ee.verticalPlacedTextSymbolIndex),ri=r.evaluateSizeForFeature(b.textSizeData,J,wi),Wt=M.get("text-padding");Lt=this.collisionIndex.placeCollisionCircles(b,ne,wi,b.lineVertexArray,b.glyphOffsetArray,ri,S,P,z,_,me,Q.predicate,Ee.collisionCircleDiameter*ri/r.ONE_EM,Wt,this.retainedQueryData[b.bucketInstanceId].tileID),Ne=ne||Lt.circles.length>0&&!Lt.collisionDetected,Ge=Ge&&Lt.offscreen,Ye=Lt.occluded}if(Ce.iconFeatureIndex&&(ni=Ce.iconFeatureIndex),Ce.iconBox){const wi=ri=>{si(ri);const Wt=_e&&wt?Xo(wt.x,wt.y,fe,me,this.transform.angle):new r.Point(0,0),Vi=b.getSymbolInstanceIconSize(K,this.transform.zoom,Ee.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Vi,ri,Wt,se,N,S,Q.predicate)};xt&&xt.box&&xt.box.length&&Ce.verticalIconBox?(_t=wi(Ce.verticalIconBox),Xe=_t.box.length>0):(_t=wi(Ce.iconBox),Xe=_t.box.length>0),Ge=Ge&&_t.offscreen,mt=_t.occluded}const nn=j||Ee.numHorizontalGlyphVertices===0&&Se===0,Wn=H||Ee.numIconVertices===0;if(nn||Wn?Wn?nn||(Xe=Xe&&Ne):Ne=Xe&&Ne:Xe=Ne=Xe&&Ne,Ne&&Bt&&Bt.box&&this.collisionIndex.insertCollisionBox(Bt.box,M.get("text-ignore-placement"),b.bucketInstanceId,xt&&xt.box&&ii?ii:Jt,Q.ID),Xe&&_t&&this.collisionIndex.insertCollisionBox(_t.box,M.get("icon-ignore-placement"),b.bucketInstanceId,ni,Q.ID),Lt&&(Ne&&this.collisionIndex.insertCollisionCircles(Lt.circles,M.get("text-ignore-placement"),b.bucketInstanceId,Jt,Q.ID),_)){const wi=b.bucketInstanceId;let ri=this.collisionCircleArrays[wi];ri===void 0&&(ri=this.collisionCircleArrays[wi]=new Zo);for(let Wt=0;Wt<Lt.circles.length;Wt+=4)ri.circles.push(Lt.circles[Wt+0]),ri.circles.push(Lt.circles[Wt+1]),ri.circles.push(Lt.circles[Wt+2]),ri.circles.push(Lt.collisionDetected?1:0)}const ms=b.projection.name!=="globe";xe=xe&&(ms||!Ye),Ae=Ae&&(ms||!mt),this.placements[We]=new Wo(Ne||xe,Xe||Ae,Ge||b.justReloaded),c.add(We)};if(ve){const Ee=b.getSortedSymbolIndexes(this.transform.angle);for(let je=Ee.length-1;je>=0;--je){const Ce=Ee[je];Ze(b.symbolInstances.get(Ce),Ce,b.collisionArrays[Ce])}}else for(let Ee=s.symbolInstanceStart;Ee<s.symbolInstanceEnd;Ee++)Ze(b.symbolInstances.get(Ee),Ee,b.collisionArrays[Ee]);if(_&&b.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[b.bucketInstanceId];r.invert(Ee.invProjMatrix,S),Ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(s,c,_,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:P,crossTileID:z}=_,D=r.getAnchorJustification(c),N=y===r.WritingMode.vertical?P:D==="left"?b:D==="center"?M:D==="right"?S:-1;b>=0&&(s.text.placedSymbolArray.get(b).crossTileID=N>=0&&b!==N?0:z),M>=0&&(s.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:z),S>=0&&(s.text.placedSymbolArray.get(S).crossTileID=N>=0&&S!==N?0:z),P>=0&&(s.text.placedSymbolArray.get(P).crossTileID=N>=0&&P!==N?0:z)}markUsedOrientation(s,c,_){const y=c===r.WritingMode.horizontal||c===r.WritingMode.horizontalOnly?c:0,b=c===r.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:z}=_,D=s.text.placedSymbolArray;M>=0&&(D.get(M).placedOrientation=y),S>=0&&(D.get(S).placedOrientation=y),P>=0&&(D.get(P).placedOrientation=y),z>=0&&(D.get(z).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let _=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(s):1,b=c?c.opacities:{},M=c?c.variableOffsets:{},S=c?c.placedOrientations:{};for(const P in this.placements){const z=this.placements[P],D=b[P];D?(this.opacities[P]=new Cs(D,y,z.text,z.icon,null,z.clipped),_=_||z.text!==D.text.placed||z.icon!==D.icon.placed):(this.opacities[P]=new Cs(null,y,z.text,z.icon,z.skipFade,z.clipped),_=_||z.text||z.icon)}for(const P in b){const z=b[P];if(!this.opacities[P]){const D=new Cs(z,y,!1,!1);D.isHidden()||(this.opacities[P]=D,_=_||z.text.placed||z.icon.placed)}}for(const P in M)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=M[P]);for(const P in S)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=S[P]);_?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:s)}updateLayerOpacities(s,c){const _=new Set;for(const y of c){const b=y.getBucket(s);b&&y.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,_,y.collisionBoxArray)}}updateBucketOpacities(s,c,_){s.hasTextData()&&s.text.opacityVertexArray.clear(),s.hasIconData()&&s.icon.opacityVertexArray.clear(),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const y=s.layers[0].layout,b=!!s.layers[0].dynamicFilter(),M=new Cs(null,0,!1,!1,!0),S=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),z=y.get("text-variable-anchor"),D=y.get("text-rotation-alignment")==="map",N=y.get("text-pitch-alignment")==="map",q=y.get("icon-text-fit")!=="none",X=new Cs(null,0,S&&(P||!s.hasIconData()||y.get("icon-optional")),P&&(S||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&_&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(_);const J=(Q,j,H)=>{for(let ne=0;ne<j/4;ne++)Q.opacityVertexArray.emplaceBack(H)};let K=0;for(let Q=0;Q<s.symbolInstances.length;Q++){const j=s.symbolInstances.get(Q),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:ne,crossTileID:se,numIconVertices:fe}=j,me=c.has(se);let _e=this.opacities[se];me?_e=M:_e||(_e=X,this.opacities[se]=_e),c.add(se);const ve=H>0||ne>0,xe=fe>0,Ae=this.placedOrientations[se],Ze=Ae===r.WritingMode.vertical,Ee=Ae===r.WritingMode.horizontal||Ae===r.WritingMode.horizontalOnly;if(!ve&&!xe||_e.isHidden()||K++,ve){const je=Yo(_e.text);J(s.text,H,Ze?Li:je),J(s.text,ne,Ee?Li:je);const Ce=_e.text.isHidden(),{leftJustifiedTextSymbolIndex:We,centerJustifiedTextSymbolIndex:Se,rightJustifiedTextSymbolIndex:Ne,verticalPlacedTextSymbolIndex:Xe}=j,Ge=s.text.placedSymbolArray,Ye=Ce||Ze?1:0;We>=0&&(Ge.get(We).hidden=Ye),Se>=0&&(Ge.get(Se).hidden=Ye),Ne>=0&&(Ge.get(Ne).hidden=Ye),Xe>=0&&(Ge.get(Xe).hidden=Ce||Ee?1:0);const mt=this.variableOffsets[se];mt&&this.markUsedJustification(s,mt.anchor,j,Ae);const wt=this.placedOrientations[se];wt&&(this.markUsedJustification(s,"left",j,wt),this.markUsedOrientation(s,wt,j))}if(xe){const je=Yo(_e.icon),{placedIconSymbolIndex:Ce,verticalPlacedIconSymbolIndex:We}=j,Se=s.icon.placedSymbolArray,Ne=_e.icon.isHidden()?1:0;Ce>=0&&(J(s.icon,fe,Ze?Li:je),Se.get(Ce).hidden=Ne),We>=0&&(J(s.icon,j.numVerticalIconVertices,Ee?Li:je),Se.get(We).hidden=Ne)}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const je=s.collisionArrays[Q];if(je){let Ce=new r.Point(0,0),We=!0;if(je.textBox||je.verticalTextBox){if(z){const Ne=this.variableOffsets[se];Ne?(Ce=Ho(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textScale),D&&Ce._rotate(N?this.transform.angle:-this.transform.angle)):We=!1}b&&(We=!_e.clipped),je.textBox&&Xr(s.textCollisionBox.collisionVertexArray,_e.text.placed,!We||Ze,Ce.x,Ce.y),je.verticalTextBox&&Xr(s.textCollisionBox.collisionVertexArray,_e.text.placed,!We||Ee,Ce.x,Ce.y)}const Se=We&&!!(!Ee&&je.verticalIconBox);je.iconBox&&Xr(s.iconCollisionBox.collisionVertexArray,_e.icon.placed,Se,q?Ce.x:0,q?Ce.y:0),je.verticalIconBox&&Xr(s.iconCollisionBox.collisionVertexArray,_e.icon.placed,!Se,q?Ce.x:0,q?Ce.y:0)}}}if(s.fullyClipped=K===0,s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=Q.invProjMatrix,s.placementViewportMatrix=Q.viewportMatrix,s.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,c){const _=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*_>s}setStale(){this.stale=!0}}function Xr(p,s,c,_,y){p.emplaceBack(s?1:0,c?1:0,_||0,y||0),p.emplaceBack(s?1:0,c?1:0,_||0,y||0),p.emplaceBack(s?1:0,c?1:0,_||0,y||0),p.emplaceBack(s?1:0,c?1:0,_||0,y||0)}const wn=Math.pow(2,25),Bi=Math.pow(2,24),dc=Math.pow(2,17),pc=Math.pow(2,16),Tn=Math.pow(2,9),Gn=Math.pow(2,8),vu=Math.pow(2,1);function Yo(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const s=p.placed?1:0,c=Math.floor(127*p.opacity);return c*wn+s*Bi+c*dc+s*pc+c*Tn+s*Gn+c*vu+s}const Li=0;class Ko{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&s.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(s,c,_,y,b){const M=this._bucketParts;for(;this._currentTileIndex<s.length;)if(c.getBucketParts(M,y,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((S,P)=>S.sortKey-P.sortKey));this._currentPartIndex<M.length;){const S=M[this._currentPartIndex];if(c.placeLayerBucketPart(S,this._seenCrossTileIDs,_,S.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class fc{constructor(s,c,_,y,b,M,S,P){this.placement=new Ya(s,b,M,S,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,c,_){const y=r.exported.now(),b=()=>{const M=r.exported.now()-y;return!this._forceFullPlacement&&M>2};for(;this._currentPlacementIndex>=0;){const M=c[s[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(M.type==="symbol"&&(!M.minzoom||M.minzoom<=S)&&(!M.maxzoom||M.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ko(M)),this._inProgressLayer.continuePlacement(_[M.source],this.placement,this._showCollisionBoxes,M,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const yr=512/r.EXTENT/2;class an{constructor(s,c,_){this.tileID=s,this.bucketInstanceId=_,this.index=new r.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=s.canonical.x*r.EXTENT,b=s.canonical.y*r.EXTENT;for(let M=0;M<c.length;M++){const{key:S,crossTileID:P,tileAnchorX:z,tileAnchorY:D}=c.get(M),N=Math.floor((y+z)*yr),q=Math.floor((b+D)*yr);this.index.add(N,q),this.keys.push(S),this.crossTileIDs.push(P)}this.index.finish()}findMatches(s,c,_){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),b=yr/Math.pow(2,c.canonical.z-this.tileID.canonical.z),M=c.canonical.x*r.EXTENT,S=c.canonical.y*r.EXTENT;for(let P=0;P<s.length;P++){const z=s.get(P);if(z.crossTileID)continue;const{key:D,tileAnchorX:N,tileAnchorY:q}=z,X=Math.floor((M+N)*b),J=Math.floor((S+q)*b),K=this.index.range(X-y,J-y,X+y,J+y);for(const Q of K){const j=this.crossTileIDs[Q];if(this.keys[Q]===D&&!_.has(j)){_.add(j),z.crossTileID=j;break}}}}}class _c{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class mc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const c=Math.round((s-this.lng)/360);if(c!==0)for(const _ in this.indexes){const y=this.indexes[_],b={};for(const M in y){const S=y[M];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+c),b[S.tileID.key]=S}this.indexes[_]=b}this.lng=s}addBucket(s,c,_){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]=new Set);const y=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const M=this.indexes[b];if(Number(b)>s.overscaledZ)for(const S in M){const P=M[S];P.tileID.isChildOf(s)&&P.findMatches(c.symbolInstances,s,y)}else{const S=M[s.scaledTo(Number(b)).key];S&&S.findMatches(c.symbolInstances,s,y)}}for(let b=0;b<c.symbolInstances.length;b++){const M=c.symbolInstances.get(b);M.crossTileID||(M.crossTileID=_.generate(),y.add(M.crossTileID))}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new an(s,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(s,c){for(const _ of c.crossTileIDs)this.usedCrossTileIDs[s].delete(_)}removeStaleBuckets(s){let c=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const b in y)s[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[b]),delete y[b],c=!0)}return c}}class Ps{constructor(){this.layerIndexes={},this.crossTileIDs=new _c,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,c,_,y){let b=this.layerIndexes[s.id];b===void 0&&(b=this.layerIndexes[s.id]=new mc);let M=!1;const S={};y.name!=="globe"&&b.handleWrapJump(_);for(const P of c){const z=P.getBucket(s);z&&s.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(P.tileID,z,this.crossTileIDs)&&(M=!0),S[z.bucketInstanceId]=!0)}return b.removeStaleBuckets(S)&&(M=!0),M}pruneUnusedLayers(s){const c={};s.forEach(_=>{c[_]=!0});for(const _ in this.layerIndexes)c[_]||delete this.layerIndexes[_]}}const Ks=(p,s)=>r.emitValidationErrors(p,s&&s.filter(c=>c.identifier!=="source.canvas")),Ka=r.pick(Xt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Np=r.pick(Xt,["setCenter","setZoom","setBearing","setPitch"]),gc={version:8,layers:[],sources:{}},Yr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ps extends r.Evented{constructor(s,c={}){super(),this.map=s,this.dispatcher=new vi(Zr(),this),this.imageManager=new zt,this.imageManager.setEventedParent(this),this.glyphManager=new r.GlyphManager(s._requestManager,c.localFontFamily?r.LocalGlyphMode.all:c.localIdeographFontFamily?r.LocalGlyphMode.ideographs:r.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Ps,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",r.getReferrer());const _=this;this._rtlTextPluginCallback=ps.registerForPluginStateChange(y=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,M)=>{if(r.triggerPluginCompletionEvent(b),M&&M.every(S=>S))for(const S in _._sourceCaches){const P=_._sourceCaches[S],z=P.getSource().type;z!=="vector"&&z!=="geojson"||P.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getSource(y.sourceId);if(b&&b.vectorLayerIds)for(const M in this._layers){const S=this._layers[M];S.source===b.id&&this._validateLayer(S)}})}loadURL(s,c={}){this.fire(new r.Event("dataloading",{dataType:"style"}));const _=typeof c.validate=="boolean"?c.validate:!r.isMapboxURL(s);s=this.map._requestManager.normalizeStyleURL(s,c.accessToken);const y=this.map._requestManager.transformRequest(s,r.ResourceType.Style);this._request=r.getJSON(y,(b,M)=>{this._request=null,b?this.fire(new r.ErrorEvent(b)):M&&this._load(M,_)})}loadJSON(s,c={}){this.fire(new r.Event("dataloading",{dataType:"style"})),this._request=r.exported.frame(()=>{this._request=null,this._load(s,c.validate!==!1)})}loadEmpty(){this.fire(new r.Event("dataloading",{dataType:"style"})),this._load(gc,!1)}_updateLayerCount(s,c){const _=c?1:-1;s.is3D()&&(this._num3DLayers+=_),s.type==="circle"&&(this._numCircleLayers+=_),s.type==="symbol"&&(this._numSymbolLayers+=_)}_load(s,c){if(c&&Ks(this,r.validateStyle(s)))return;this._loaded=!0,this.stylesheet=r.clone$1(s),this._updateMapProjection();for(const y in s.sources)this.addSource(y,s.sources[y],{validate:!1});this._changed=!1,s.sprite?this._loadSprite(s.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(s.glyphs);const _=_u(this.stylesheet.layers);this._order=_.map(y=>y.id),this._layers={},this._serializedLayers={};for(const y of _){const b=r.createStyleLayer(y);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Gt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new r.Event("data",{dataType:"style"})),this.fire(new r.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(s){s?this.stylesheet.projection=s:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(s){this._spriteRequest=function(c,_,y){let b,M,S;const P=r.exported.devicePixelRatio>1?"@2x":"";let z=r.getJSON(_.transformRequest(_.normalizeSpriteURL(c,P,".json"),r.ResourceType.SpriteJSON),(q,X)=>{z=null,S||(S=q,b=X,N())}),D=r.getImage(_.transformRequest(_.normalizeSpriteURL(c,P,".png"),r.ResourceType.SpriteImage),(q,X)=>{D=null,S||(S=q,M=X,N())});function N(){if(S)y(S);else if(b&&M){const q=r.exported.getImageData(M),X={};for(const J in b){const{width:K,height:Q,x:j,y:H,sdf:ne,pixelRatio:se,stretchX:fe,stretchY:me,content:_e}=b[J],ve=new r.RGBAImage({width:K,height:Q});r.RGBAImage.copy(q,ve,{x:j,y:H},{x:0,y:0},{width:K,height:Q}),X[J]={data:ve,pixelRatio:se,sdf:ne,stretchX:fe,stretchY:me,content:_e}}y(null,X)}}return{cancel(){z&&(z.cancel(),z=null),D&&(D.cancel(),D=null)}}}(s,this.map._requestManager,(c,_)=>{if(this._spriteRequest=null,c)this.fire(new r.ErrorEvent(c));else if(_)for(const y in _)this.imageManager.addImage(y,_[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new r.Event("data",{dataType:"style"}))})}_validateLayer(s){const c=this.getSource(s.source);if(!c)return;const _=s.sourceLayer;_&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(_)===-1)&&this.fire(new r.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${c.id}" as specified by style layer "${s.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this._sourceCaches)if(!this._sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(s){const c=[];for(const _ of s){const y=this._layers[_];y.type!=="custom"&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const s in this._sourceCaches)if(this._sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(s){return!!this.terrain&&(typeof s.isLayerDraped=="function"?s.isLayerDraped():Yr[s.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(s){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(y.length||b.length)&&this._updateWorkerLayers(y,b);for(const M in this._updatedSources){const S=this._updatedSources[M];S==="reload"?this._reloadSource(M):S==="clear"&&this._clearSource(M)}this._updateTilesForChangedImages();for(const M in this._updatedPaintProps)this._layers[M].updateTransitions(s);this.light.updateTransitions(s),this.fog&&this.fog.updateTransitions(s),this._resetUpdates()}const _={};for(const y in this._sourceCaches){const b=this._sourceCaches[y];_[y]=b.used,b.used=!1}for(const y of this._order){const b=this._layers[y];if(b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)){const S=this._getLayerSourceCache(b);S&&(S.used=!0)}const M=this.map.painter;if(M){const S=b.getProgramIds();if(!S)continue;const P=b.getProgramConfiguration(s.zoom);for(const z of S)M.useProgram(z,P)}}for(const y in _){const b=this._sourceCaches[y];_[y]!==b.used&&b.getSource().fire(new r.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(s),this.terrain&&this.terrain.recalculate(s),this.fog&&this.fog.recalculate(s),this.z=s.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new r.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateWorkerLayers(s,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(s),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(s){if(this._checkLoaded(),Ks(this,r.validateStyle(s)))return!1;(s=r.clone$1(s)).layers=_u(s.layers);const c=function(y,b){if(!y)return[{command:Xt.setStyle,args:[b]}];let M=[];try{if(!T(y.version,b.version))return[{command:Xt.setStyle,args:[b]}];T(y.center,b.center)||M.push({command:Xt.setCenter,args:[b.center]}),T(y.zoom,b.zoom)||M.push({command:Xt.setZoom,args:[b.zoom]}),T(y.bearing,b.bearing)||M.push({command:Xt.setBearing,args:[b.bearing]}),T(y.pitch,b.pitch)||M.push({command:Xt.setPitch,args:[b.pitch]}),T(y.sprite,b.sprite)||M.push({command:Xt.setSprite,args:[b.sprite]}),T(y.glyphs,b.glyphs)||M.push({command:Xt.setGlyphs,args:[b.glyphs]}),T(y.transition,b.transition)||M.push({command:Xt.setTransition,args:[b.transition]}),T(y.light,b.light)||M.push({command:Xt.setLight,args:[b.light]}),T(y.fog,b.fog)||M.push({command:Xt.setFog,args:[b.fog]}),T(y.projection,b.projection)||M.push({command:Xt.setProjection,args:[b.projection]});const S={},P=[];(function(N,q,X,J){let K;for(K in q=q||{},N=N||{})N.hasOwnProperty(K)&&(q.hasOwnProperty(K)||Go(K,X,J));for(K in q){if(!q.hasOwnProperty(K))continue;const Q=q[K];N.hasOwnProperty(K)?T(N[K],Q)||(N[K].type==="geojson"&&Q.type==="geojson"&&Xa(N,q,K)?X.push({command:Xt.setGeoJSONSourceData,args:[K,Q.data]}):ac(K,q,X,J)):oc(K,q,X)}})(y.sources,b.sources,P,S);const z=[];y.layers&&y.layers.forEach(N=>{N.source&&S[N.source]?M.push({command:Xt.removeLayer,args:[N.id]}):z.push(N)});let D=y.terrain;D&&S[D.source]&&(M.push({command:Xt.setTerrain,args:[void 0]}),D=void 0),M=M.concat(P),T(D,b.terrain)||M.push({command:Xt.setTerrain,args:[b.terrain]}),function(N,q,X){q=q||[];const J=(N=N||[]).map(Ss),K=q.map(Ss),Q=N.reduce(lc,{}),j=q.reduce(lc,{}),H=J.slice(),ne=Object.create(null);let se,fe,me,_e,ve,xe,Ae;for(se=0,fe=0;se<J.length;se++)me=J[se],j.hasOwnProperty(me)?fe++:(X.push({command:Xt.removeLayer,args:[me]}),H.splice(H.indexOf(me,fe),1));for(se=0,fe=0;se<K.length;se++)me=K[K.length-1-se],H[H.length-1-se]!==me&&(Q.hasOwnProperty(me)?(X.push({command:Xt.removeLayer,args:[me]}),H.splice(H.lastIndexOf(me,H.length-fe),1)):fe++,xe=H[H.length-se],X.push({command:Xt.addLayer,args:[j[me],xe]}),H.splice(H.length-se,0,me),ne[me]=!0);for(se=0;se<K.length;se++)if(me=K[se],_e=Q[me],ve=j[me],!ne[me]&&!T(_e,ve))if(T(_e.source,ve.source)&&T(_e["source-layer"],ve["source-layer"])&&T(_e.type,ve.type)){for(Ae in us(_e.layout,ve.layout,X,me,null,Xt.setLayoutProperty),us(_e.paint,ve.paint,X,me,null,Xt.setPaintProperty),T(_e.filter,ve.filter)||X.push({command:Xt.setFilter,args:[me,ve.filter]}),T(_e.minzoom,ve.minzoom)&&T(_e.maxzoom,ve.maxzoom)||X.push({command:Xt.setLayerZoomRange,args:[me,ve.minzoom,ve.maxzoom]}),_e)_e.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?us(_e[Ae],ve[Ae],X,me,Ae.slice(6),Xt.setPaintProperty):T(_e[Ae],ve[Ae])||X.push({command:Xt.setLayerProperty,args:[me,Ae,ve[Ae]]}));for(Ae in ve)ve.hasOwnProperty(Ae)&&!_e.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?us(_e[Ae],ve[Ae],X,me,Ae.slice(6),Xt.setPaintProperty):T(_e[Ae],ve[Ae])||X.push({command:Xt.setLayerProperty,args:[me,Ae,ve[Ae]]}))}else X.push({command:Xt.removeLayer,args:[me]}),xe=H[H.lastIndexOf(me)+1],X.push({command:Xt.addLayer,args:[ve,xe]})}(z,b.layers,M)}catch(S){console.warn("Unable to compute style diff:",S),M=[{command:Xt.setStyle,args:[b]}]}return M}(this.serialize(),s).filter(y=>!(y.command in Np));if(c.length===0)return!1;const _=c.filter(y=>!(y.command in Ka));if(_.length>0)throw new Error(`Unimplemented: ${_.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)}),this.stylesheet=s,this._updateMapProjection(),!0}addImage(s,c){return this.getImage(s)?this.fire(new r.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(s,c),this._afterImageUpdated(s),this)}updateImage(s,c){this.imageManager.updateImage(s,c)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){return this.getImage(s)?(this.imageManager.removeImage(s),this._afterImageUpdated(s),this):this.fire(new r.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new r.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(s,c,_={}){if(this._checkLoaded(),this.getSource(s)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(r.validateSource,`sources.${s}`,c,null,_))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=kt(s,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(s),source:y.serialize(),sourceId:s}));const b=M=>{const S=(M?"symbol:":"other:")+s,P=this._sourceCaches[S]=new r.SourceCache(S,y,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[s]=P,P.style=this,P.onAdd(this.map)};b(!1),c.type!=="vector"&&c.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(s){this._checkLoaded();const c=this.getSource(s);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===s)return this.fire(new r.ErrorEvent(new Error(`Source "${s}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===s)return this.fire(new r.ErrorEvent(new Error(`Source "${s}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(s);for(const y of _)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new r.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[s],delete this._symbolSourceCaches[s],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(s,c){this._checkLoaded(),this.getSource(s).setData(c),this._changed=!0}getSource(s){const c=this._getSourceCache(s);return c&&c.getSource()}_getSources(){const s=[];for(const c in this._otherSourceCaches){const _=this._getSourceCache(c);_&&s.push(_.getSource())}return s}addLayer(s,c,_={}){this._checkLoaded();const y=s.id;if(this.getLayer(y))return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(s.type==="custom"){if(Ks(this,r.validateCustomStyleLayer(s)))return;b=r.createStyleLayer(s)}else{if(typeof s.source=="object"&&(this.addSource(y,s.source),s=r.clone$1(s),s=r.extend(s,{source:y})),this._validate(r.validateLayer,`layers.${y}`,s,{arrayIndex:-1},_))return;b=r.createStyleLayer(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const M=c?this._order.indexOf(c):this._order.length;if(c&&M===-1)return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(M,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const S=this._getLayerSourceCache(b);if(this._removedLayers[y]&&b.source&&S&&b.type!=="custom"){const P=this._removedLayers[y];delete this._removedLayers[y],P.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",S.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(s,c){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new r.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===c)return;const _=this._order.indexOf(s);this._order.splice(_,1);const y=c?this._order.indexOf(c):this._order.length;c&&y===-1?this.fire(new r.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,s),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(s){this._checkLoaded();const c=this._layers[s];if(!c)return void this.fire(new r.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const _=this._order.indexOf(s);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=c,delete this._layers[s],delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(s){return this._layers[s]}hasLayer(s){return s in this._layers}hasLayerType(s){for(const c in this._layers)if(this._layers[c].type===s)return!0;return!1}setLayerZoomRange(s,c,_){this._checkLoaded();const y=this.getLayer(s);y?y.minzoom===c&&y.maxzoom===_||(c!=null&&(y.minzoom=c),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new r.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(s,c,_={}){this._checkLoaded();const y=this.getLayer(s);if(y){if(!T(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(r.validateFilter,`layers.${y.id}.filter`,c,{layerType:y.type},_)||(y.filter=r.clone$1(c),this._updateLayer(y)))}else this.fire(new r.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be filtered.`)))}getFilter(s){const c=this.getLayer(s);return c&&r.clone$1(c.filter)}setLayoutProperty(s,c,_,y={}){this._checkLoaded();const b=this.getLayer(s);b?T(b.getLayoutProperty(c),_)||(b.setLayoutProperty(c,_,y),this._updateLayer(b)):this.fire(new r.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(s,c){const _=this.getLayer(s);if(_)return _.getLayoutProperty(c);this.fire(new r.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style.`)))}setPaintProperty(s,c,_,y={}){this._checkLoaded();const b=this.getLayer(s);b?T(b.getPaintProperty(c),_)||(b.setPaintProperty(c,_,y)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new r.ErrorEvent(new Error(`The layer '${s}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(s,c){const _=this.getLayer(s);return _&&_.getPaintProperty(c)}setFeatureState(s,c){this._checkLoaded();const _=s.source,y=s.sourceLayer,b=this.getSource(_);if(!b)return void this.fire(new r.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const M=b.type;if(M==="geojson"&&y)return void this.fire(new r.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!y)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));s.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided.")));const S=this._getSourceCaches(_);for(const P of S)P.setFeatureState(y,s.id,c)}removeFeatureState(s,c){this._checkLoaded();const _=s.source,y=this.getSource(_);if(!y)return void this.fire(new r.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const b=y.type,M=b==="vector"?s.sourceLayer:void 0;if(b==="vector"&&!M)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof s.id!="string"&&typeof s.id!="number")return void this.fire(new r.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const S=this._getSourceCaches(_);for(const P of S)P.removeFeatureState(M,s.id,c)}getFeatureState(s){this._checkLoaded();const c=s.source,_=s.sourceLayer,y=this.getSource(c);if(y){if(y.type!=="vector"||_)return s.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(_,s.id);this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new r.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return r.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const s={};for(const c in this._sourceCaches){const _=this._sourceCaches[c].getSource();s[_.id]||(s[_.id]=_.serialize())}return r.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:s,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0;const c=this._getLayerSourceCache(s);s.source&&!this._updatedSources[s.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",c.pause()),this._changed=!0,s.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(s){const c=M=>this._layers[M].type==="fill-extrusion",_={},y=[];for(let M=this._order.length-1;M>=0;M--){const S=this._order[M];if(c(S)){_[S]=M;for(const P of s){const z=P[S];if(z)for(const D of z)y.push(D)}}}y.sort((M,S)=>S.intersectionZ-M.intersectionZ);const b=[];for(let M=this._order.length-1;M>=0;M--){const S=this._order[M];if(c(S))for(let P=y.length-1;P>=0;P--){const z=y[P].feature;if(_[z.layer.id]<M)break;b.push(z),y.pop()}else for(const P of s){const z=P[S];if(z)for(const D of z)b.push(D.feature)}}return b}queryRenderedFeatures(s,c,_){c&&c.filter&&this._validate(r.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const z=this._layers[P];if(!z)return this.fire(new r.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const b=[];c.availableImages=this._availableImages;const M=c&&c.layers?c.layers.some(P=>{const z=this.getLayer(P);return z&&z.is3D()}):this.has3DLayers(),S=gn.createFromScreenPoints(s,_);for(const P in this._sourceCaches){const z=this._sourceCaches[P].getSource().id;c.layers&&!y[z]||b.push(Mi(this._sourceCaches[P],this._layers,this._serializedLayers,S,c,_,M,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(P,z,D,N,q,X,J){const K={},Q=X.queryRenderedSymbols(N),j=[];for(const H of Object.keys(Q).map(Number))j.push(J[H]);j.sort(un);for(const H of j){const ne=H.featureIndex.lookupSymbolFeatures(Q[H.bucketInstanceId],z,H.bucketIndex,H.sourceLayerIndex,q.filter,q.layers,q.availableImages,P);for(const se in ne){const fe=K[se]=K[se]||[],me=ne[se];me.sort((_e,ve)=>{const xe=H.featureSortOrder;if(xe){const Ae=xe.indexOf(_e.featureIndex);return xe.indexOf(ve.featureIndex)-Ae}return ve.featureIndex-_e.featureIndex});for(const _e of me)fe.push(_e)}}for(const H in K)K[H].forEach(ne=>{const se=ne.feature,fe=D(P[H]);if(!fe)return;const me=fe.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=me});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),S.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,c){c&&c.filter&&this._validate(r.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const _=this._getSourceCaches(s);let y=[];for(const b of _)y=y.concat(Ni(b,c));return y}addSourceType(s,c,_){return ps.getSourceType(s)?_(new Error(`A source type called "${s}" already exists.`)):(ps.setSourceType(s,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:s,url:c.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(s,c={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const M in s)if(!T(s[M],_[M])){y=!0;break}if(!y)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(s,c),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(s,c=1){if(this._checkLoaded(),!s)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=s;if(c===1){if(typeof _.source=="object"){const y="terrain-dem-src";this.addSource(y,_.source),_=r.clone$1(_),_=r.extend(_,{source:y})}if(this._validate(r.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,c)}else{const y=this.terrain,b=y.get();for(const M of Object.keys(r.spec.terrain))!_.hasOwnProperty(M)&&r.spec.terrain[M].default&&(_[M]=r.spec.terrain[M].default);for(const M in _)if(!T(_[M],b[M])){y.set(_),this.stylesheet.terrain=_;const S=this._setTransitionParameters({duration:0});y.updateTransitions(S);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(s){const c=this.fog=new Pi(s,this.map.transform);this.stylesheet.fog=s;const _=this._setTransitionParameters({duration:0});c.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const s of this.map._markers)s._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(s){if(this._checkLoaded(),!s)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,_=c.get();Object.keys(s).length===0&&c.set(s);for(const y in s)if(!T(s[y],_[y])){c.set(s),this.stylesheet.fog=s;const b=this._setTransitionParameters({duration:0});c.updateTransitions(b);break}}else this._createFog(s);this._markersNeedUpdate=!0}_setTransitionParameters(s){return{now:r.exported.now(),transition:r.extend(s,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const s=this._order.filter(_=>this.isLayerDraped(this._layers[_])),c=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...s),this._drapedFirstOrder.push(...c)}_createTerrain(s,c){const _=this.terrain=new Kt(s,c);this.stylesheet.terrain=s,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});_.updateTransitions(y)}_force3DLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const s in this._layers){const c=this._layers[s];c.type==="symbol"&&this._updateLayer(c)}}_validate(s,c,_,y,b={}){return(!b||b.validate!==!1)&&Ks(this,s.call(r.validateStyle,r.extend({key:c,style:this.serialize(),value:_,styleSpec:r.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this._sourceCaches)this._sourceCaches[s].clearTiles(),this._sourceCaches[s].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(s){const c=this._getSourceCaches(s);for(const _ of c)_.clearTiles()}_reloadSource(s){const c=this._getSourceCaches(s);for(const _ of c)_.resume(),_.reload()}_reloadSources(){for(const s of this._getSources())s.reload&&s.reload()}_updateSources(s){for(const c in this._sourceCaches)this._sourceCaches[c].update(s)}_generateCollisionBoxes(){for(const s in this._sourceCaches){const c=this._sourceCaches[s];c.resume(),c.reload()}}_updatePlacement(s,c,_,y,b=!1){let M=!1,S=!1;const P={};for(const z of this._order){const D=this._layers[z];if(D.type!=="symbol")continue;if(!P[D.source]){const q=this._getLayerSourceCache(D);if(!q)continue;P[D.source]=q.getRenderableIds(!0).map(X=>q.getTileByID(X)).sort((X,J)=>J.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(J.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(D,P[D.source],s.center.lng,s.projection);M=M||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new r.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.exported.now(),s.zoom))&&(this.pauseablePlacement=new fc(s,this._order,b,c,_,y,this.placement,this.fog&&s.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.exported.now()),S=!0),M&&this.pauseablePlacement.placement.setStale()),S||M)for(const z of this._order){const D=this._layers[z];D.type==="symbol"&&this.placement.updateLayerOpacities(D,P[D.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.exported.now())}_releaseSymbolFadeTiles(){for(const s in this._sourceCaches)this._sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,c,_){this.imageManager.getImages(c.icons,_),this._updateTilesForChangedImages();const y=b=>{b&&b.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(s,c,_){this.glyphManager.getGlyphs(c.stacks,_)}getResource(s,c,_){return r.makeRequest(c,_)}_getSourceCache(s){return this._otherSourceCaches[s]}_getLayerSourceCache(s){return s.type==="symbol"?this._symbolSourceCaches[s.source]:this._otherSourceCaches[s.source]}_getSourceCaches(s){const c=[];return this._otherSourceCaches[s]&&c.push(this._otherSourceCaches[s]),this._symbolSourceCaches[s]&&c.push(this._symbolSourceCaches[s]),c}_isSourceCacheLoaded(s){const c=this._getSourceCaches(s);return c.length===0?(this.fire(new r.ErrorEvent(new Error(`There is no source with ID '${s}'`))),!1):c.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ps.getSourceType=function(p){return At[p]},ps.setSourceType=function(p,s){At[p]=s},ps.registerForPluginStateChange=r.registerForPluginStateChange;var yc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,xr="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ks=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Jo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ls=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Ja={},Kr={};const Qo=[];Jr(yc,Qo),Jr(ks,Qo),Jr(Jo,Qo),Jr(Ls,Qo),Ja=Yt("",ks),Kr=Yt(Ls,Jo);const bu=Yt(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Qa=yc,xc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var vc={background:Yt(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Yt(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Yt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Yt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Yt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Yt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Yt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Yt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Yt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Yt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Yt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Yt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Yt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Yt(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Yt(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Yt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Yt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Yt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Yt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Yt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Yt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Yt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Yt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Yt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Yt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Yt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,xr),skyboxGradient:Yt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,xr),skyboxCapture:Yt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Yt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Yt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Jr(p,s){const c=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of c)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=_.split(" ");for(const b of y)s.includes(b)||s.push(b)}}function Yt(p,s){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=s.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},b=[...Qo];return Jr(p,b),Jr(s,b),{fragmentSource:p=p.replace(c,(M,S,P,z,D)=>(y[D]=!0,S==="define"?`
#ifndef HAS_UNIFORM_u_${D}
varying ${P} ${z} ${D};
#else
uniform ${P} ${z} u_${D};
#endif
`:`
#ifdef HAS_UNIFORM_u_${D}
    ${P} ${z} ${D} = u_${D};
#endif
`)),vertexSource:s=s.replace(c,(M,S,P,z,D)=>{const N=z==="float"?"vec2":"vec4",q=D.match(/color/)?"color":N;return y[D]?S==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${P} ${N} a_${D};
varying ${P} ${z} ${D};
#else
uniform ${P} ${z} u_${D};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = a_${D};
#else
    ${P} ${z} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${D} = unpack_mix_${q}(a_${D}, u_${D}_t);
#else
    ${P} ${z} ${D} = u_${D};
#endif
`:S==="define"?`
#ifndef HAS_UNIFORM_u_${D}
uniform lowp float u_${D}_t;
attribute ${P} ${N} a_${D};
#else
uniform ${P} ${z} u_${D};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${D}
    ${P} ${z} ${D} = a_${D};
#else
    ${P} ${z} ${D} = u_${D};
#endif
`:`
#ifndef HAS_UNIFORM_u_${D}
    ${P} ${z} ${D} = unpack_mix_${q}(a_${D}, u_${D}_t);
#else
    ${P} ${z} ${D} = u_${D};
#endif
`}),staticAttributes:_,usedDefines:b}}class jp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(s,c,_,y,b,M,S){this.context=s;let P=this.boundPaintVertexBuffers.length!==y.length;for(let D=0;!P&&D<y.length;D++)this.boundPaintVertexBuffers[D]!==y[D]&&(P=!0);let z=this.boundDynamicVertexBuffers.length!==S.length;for(let D=0;!z&&D<S.length;D++)this.boundDynamicVertexBuffers[D]!==S[D]&&(z=!0);if(!s.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==_||P||z||this.boundIndexBuffer!==b||this.boundVertexOffset!==M)this.freshBind(c,_,y,b,M,S);else{s.bindVertexArrayOES.set(this.vao);for(const D of S)D&&D.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(s,c,_,y,b,M){let S;const P=s.numAttributes,z=this.context,D=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),S=0,this.boundProgram=s,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=M;else{S=z.currentNumAttributes||0;for(let N=P;N<S;N++)D.disableVertexAttribArray(N)}c.enableAttributes(D,s),c.bind(),c.setVertexAttribPointers(D,s,b);for(const N of _)N.enableAttributes(D,s),N.bind(),N.setVertexAttribPointers(D,s,b);for(const N of M)N&&(N.enableAttributes(D,s),N.bind(),N.setVertexAttribPointers(D,s,b));y&&y.bind(),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function bc(p,s){const c=Math.pow(2,s.canonical.z),_=s.canonical.y;return[new r.MercatorCoordinate(0,_/c).toLngLat().lat,new r.MercatorCoordinate(0,(_+1)/c).toLngLat().lat]}function wu(p,s,c,_,y,b,M){const S=p.context,P=S.gl,z=c.fbo;if(!z)return;p.prepareDrawTile();const D=p.useProgram("hillshade");S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,z.colorAttachment.get());const N=((K,Q,j,H)=>{const ne=j.paint.get("hillshade-shadow-color"),se=j.paint.get("hillshade-highlight-color"),fe=j.paint.get("hillshade-accent-color");let me=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(me-=K.transform.angle);const _e=!K.options.moving;return{u_matrix:H||K.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),_e),u_image:0,u_latrange:bc(0,Q.tileID),u_light:[j.paint.get("hillshade-exaggeration"),me],u_shadow:ne,u_highlight:se,u_accent:fe}})(p,c,_,p.terrain?s.projMatrix:null);p.prepareDrawProgram(S,D,s.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:X,tileBoundsSegments:J}=p.getTileBoundsBuffers(c);D.draw(S,P.TRIANGLES,y,b,M,r.CullFaceMode.disabled,N,_.id,q,X,J)}function wc(p,s,c){if(!s.needsDEMTextureUpload)return;const _=p.context,y=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||p.getTileTexture(c.stride);const b=c.getPixels();s.demTexture?s.demTexture.update(b,{premultiply:!1}):s.demTexture=new r.Texture(_,b,y.RGBA,{premultiply:!1}),s.needsDEMTextureUpload=!1}function Tu(p,s,c,_,y,b){const M=p.context,S=M.gl;if(!s.dem)return;const P=s.dem;if(M.activeTexture.set(S.TEXTURE1),wc(p,s,P),!s.demTexture)return;s.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);const z=P.dim;M.activeTexture.set(S.TEXTURE0);let D=s.fbo;if(!D){const J=new r.Texture(M,{width:z,height:z,data:null},S.RGBA);J.bind(S.LINEAR,S.CLAMP_TO_EDGE),D=s.fbo=M.createFramebuffer(z,z,!0),D.colorAttachment.set(J.texture)}M.bindFramebuffer.set(D.framebuffer),M.viewport.set([0,0,z,z]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:q,tileBoundsSegments:X}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(M,S.TRIANGLES,_,y,b,r.CullFaceMode.disabled,((J,K)=>{const Q=K.stride,j=r.create();return r.ortho(j,0,r.EXTENT,-r.EXTENT,0,0,1),r.translate(j,j,[0,-r.EXTENT,0]),{u_matrix:j,u_image:1,u_dimension:[Q,Q],u_zoom:J.overscaledZ,u_unpack:K.unpackVector}})(s.tileID,P),c.id,N,q,X),s.needsHillshadePrepare=!1}const Tc=p=>({u_matrix:new r.UniformMatrix4f(p),u_image0:new r.Uniform1i(p),u_skirt_height:new r.Uniform1f(p)}),Qr=(p,s)=>({u_matrix:p,u_image0:0,u_skirt_height:s}),el=(p,s,c,_,y,b,M,S,P,z,D,N,q,X,J)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:s,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:M,u_frustum_tr:S,u_frustum_br:P,u_frustum_bl:z,u_globe_pos:D,u_globe_radius:N,u_viewport:q,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:X});function eo(p,s){return p!=null&&s!=null&&!(!p.hasData()||!s.hasData())&&p.demTexture!=null&&s.demTexture!=null&&p.tileID.key!==s.tileID.key}const Ds=new class{constructor(){this.operations={}}newMorphing(p,s,c,_,y){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[p]={startTime:_,phase:0,duration:y,from:s,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const s=this.operations[p];return{from:s.from,to:s.to,phase:s.phase}}update(p){for(const s in this.operations){const c=this.operations[s];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[s];break}}}_nextOp(p,s){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=s,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},vr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function tl(p){return 6*Math.pow(1.5,22-p)}function Eu(p,s){const c=1<<p.z;return!s&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}const ea=p=>({u_matrix:p});function Ec(p,s,c,_,y){if(y>0){const b=r.exported.now(),M=(b-p.timeAdded)/y,S=s?(b-s.timeAdded)/y:-1,P=c.getSource(),z=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),D=!s||Math.abs(s.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),N=D&&p.refreshedUponExpiration?1:r.clamp(D?M:1-S,0,1);return p.refreshedUponExpiration&&M>=1&&(p.refreshedUponExpiration=!1),s?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Mc extends r.SourceCache{constructor(s){const c={type:"raster-dem",maxzoom:s.transform.maxZoom},_=new vi(Zr(),null),y=kt("mock-dem",c,_,s.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(s,c){s.state="loaded",c(null)}}class il extends r.SourceCache{constructor(s){const c=kt("proxy",{type:"geojson",maxzoom:s.transform.maxZoom},new vi(Zr(),null),s.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=s,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(s,c,_){if(s.freezeTileCoverage)return;this.transform=s;const y=s.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,M)=>{if(b[M.key]="",!this._tiles[M.key]){const S=new r.Tile(M,this._source.tileSize*M.overscaleFactor(),s.tileZoom);S.state="loaded",this._tiles[M.key]=S}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(s){const c=this.proxyCachedFBO[s];if(c!==void 0){const _=Object.values(c);this.renderCachePool.push(..._),delete this.proxyCachedFBO[s]}}deallocRenderCache(){this.renderCache.forEach(s=>s.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class nl extends r.OverscaledTileID{constructor(s,c,_){super(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y),this.proxyTileKey=c,this.projMatrix=_}}class Sc extends r.Elevation{constructor(s,c){super(),this.painter=s,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,y,b]=function(P){const z=new r.StructArrayLayout2i4,D=new r.StructArrayLayout3ui6,N=131;z.reserve(17161),D.reserve(33800);const q=r.EXTENT/128,X=r.EXTENT+q/2,J=X+q;for(let Q=-q;Q<J;Q+=q)for(let j=-q;j<J;j+=q){const H=j<0||j>X||Q<0||Q>X?24575:0,ne=r.clamp(Math.round(j),0,r.EXTENT),se=r.clamp(Math.round(Q),0,r.EXTENT);z.emplaceBack(ne+H,se)}const K=(Q,j)=>{const H=j*N+Q;D.emplaceBack(H+1,H,H+N),D.emplaceBack(H+N,H+N+1,H+1)};for(let Q=1;Q<129;Q++)for(let j=1;j<129;j++)K(j,Q);return[0,129].forEach(Q=>{for(let j=0;j<130;j++)K(j,Q),K(Q,j)}),[z,D,32768]}(),M=s.context;this.gridBuffer=M.createVertexBuffer(_,r.posAttributes.members),this.gridIndexBuffer=M.createIndexBuffer(y),this.gridSegments=r.SegmentVector.simpleSegment(0,0,_.length,y.length),this.gridNoSkirtSegments=r.SegmentVector.simpleSegment(0,0,_.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new il(c.map),this.orthoMatrix=r.create(),r.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.EXTENT,0,r.EXTENT,0,1);const S=M.gl;this._overlapStencilMode=new r.StencilMode({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=s.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Mc(c.map)}set style(s){s.on("data",this._onStyleDataEvent.bind(this)),s.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=s,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(s,c,_){if(s&&s.terrain){this._style!==s&&(this.style=s),this.enabled=!0;const y=s.terrain.properties;this.sourceCache=s.terrain.drapeRenderMode===0?this._mockSourceCache:s._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const b=()=>{this.sourceCache.used&&r.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const M=this.getScaledDemTileSize();this.sourceCache.update(c,M,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),c.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(s){this._findCoveringTileCache[s]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const s=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||s.efficiency!==100&&r.warnOnce(`Terrain render cache efficiency is not optimal (${s.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${s.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(s){s.coord&&s.dataType==="source"?this._clearRenderCacheForTile(s.sourceCacheId,s.coord):s.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const s in this._style._sourceCaches)this._style._sourceCaches[s].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(s=>s.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const s=2*this.proxySourceCache.getSource().tileSize;return[s,s]}set useVertexMorphing(s){this._useVertexMorphing=s}updateTileBinding(s){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(P=>{const z=c.getTileByID(P).tileID;return z.projMatrix=_.calculateProjMatrix(z.toUnwrapped()),z});(function(P,z){const D=z.transform.pointCoordinate(z.transform.getCameraPoint()),N=new r.Point(D.x,D.y);P.sort((q,X)=>{if(X.overscaledZ-q.overscaledZ)return X.overscaledZ-q.overscaledZ;const J=new r.Point(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),K=new r.Point(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),Q=N.mult(1<<q.canonical.z);return Q.x-=.5,Q.y-=.5,Q.distSqr(J)-Q.distSqr(K)})})(y,this.painter),this._previousZoom=_.zoom;const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const M=this._style._sourceCaches;for(const P in M){const z=M[P];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,s[P],b),z.usedForTerrain))continue;const D=s[P];z.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[c.id]=y.map(P=>new nl(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=r.exported.now();const S={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const z=this.terrainTileForTile[P.key];if(!z)continue;const D=z.tileID.key;D in S||(this._visibleDemTiles.push(z),S[D]=D)}}_assignTerrainTiles(s){this._initializing||s.forEach(c=>{if(this.terrainTileForTile[c.key])return;const _=this._findTileCoveringTileID(c,this.sourceCache);_&&(this.terrainTileForTile[c.key]=_)})}_prepareDEMTextures(){const s=this.painter.context,c=s.gl;for(const _ in this.terrainTileForTile){const y=this.terrainTileForTile[_],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(s.activeTexture.set(c.TEXTURE1),wc(this.painter,y,b))}}_prepareDemTileUniforms(s,c,_,y){if(!c||c.demTexture==null)return!1;const b=s.tileID.canonical,M=Math.pow(2,c.tileID.canonical.z-b.z),S=y||"";return _[`u_dem_tl${S}`]=[b.x*M%1,b.y*M%1],_[`u_dem_scale${S}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const s=this.painter.context,c=s.gl;if(!this._emptyDepthBufferTexture){const _=new r.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.Texture(s,_,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let s=0;const c=this._visibleDemTiles.reduce((_,y)=>{if(!y.dem)return _;const b=y.dem.tree.minimums[0];return b>0&&s++,_+b},0);return s?c/s:0}_updateEmptyDEMTexture(){const s=this.painter.context,c=s.gl;s.activeTexture.set(c.TEXTURE2);const _=this._getLoadedAreaMinimum(),y=new r.RGBAImage({width:1,height:1},new Uint8Array(r.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new r.Texture(s,y,c.RGBA,{premultiply:!1}),b}setupElevationDraw(s,c,_){const y=this.painter.context,b=y.gl,M=(S=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:r.DEMData.getUnpackVector(S),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var S;M.u_dem_size=this.sourceCache.getSource().tileSize,M.u_exaggeration=this.exaggeration();let P=null,z=null,D=1;if(_&&_.morphing&&this._useVertexMorphing){const N=_.morphing.srcDemTile,q=_.morphing.dstDemTile;D=_.morphing.phase,N&&q&&(this._prepareDemTileUniforms(s,N,M,"_prev")&&(z=N),this._prepareDemTileUniforms(s,q,M)&&(P=q))}if(z&&P?(y.activeTexture.set(b.TEXTURE2),P.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),y.activeTexture.set(b.TEXTURE4),z.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),M.u_dem_lerp=D):(P=this.terrainTileForTile[s.tileID.key],y.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(s,P,M)?P.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),y.activeTexture.set(b.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&P){const N=(1<<P.tileID.canonical.z)*r.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=N}if(_&&_.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),c.setTerrainUniformValues(y,M),this.painter.transform.projection.name==="globe"){const N=this.globeUniformValues(this.painter.transform,s.tileID.canonical,_&&_.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,N)}}globeUniformValues(s,c,_){const y=s.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,r.EXTENT,0),u_tile_br_up:y.upVector(c,r.EXTENT,r.EXTENT),u_tile_bl_up:y.upVector(c,0,r.EXTENT),u_tile_up_scale:_?r.globeMetersToEcef(1):y.upVectorScale(c,s.center.lat,s.worldSize).metersToTile}}renderToBackBuffer(s){const c=this.painter,_=this.painter.context;s.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,M,S,P){if(y.transform.projection.name==="globe")(function(z,D,N,q,X){const J=z.context,K=J.gl;let Q,j;const H=z.options.showTerrainWireframe?2:0,ne=z.transform,se=r.globeUseCustomAntiAliasing(z,J,ne),fe=(We,Se)=>{if(j===We)return;const Ne=[vr[We],"PROJECTION_GLOBE_VIEW"];se&&Ne.push("CUSTOM_ANTIALIASING"),Se&&Ne.push(vr[H]),Q=z.useProgram("globeRaster",null,Ne),j=We},me=z.colorModeForRenderPass(),_e=new r.DepthMode(K.LEQUAL,r.DepthMode.ReadWrite,z.depthRangeFor3D);Ds.update(X);const ve=r.calculateGlobeMercatorMatrix(ne),xe=[r.mercatorXfromLng(ne.center.lng),r.mercatorYfromLat(ne.center.lat)],Ae=H?[!1,!0]:[!1],Ze=z.globeSharedBuffers,Ee=[ne.width*r.exported.devicePixelRatio,ne.height*r.exported.devicePixelRatio],je=Float32Array.from(ne.globeMatrix),Ce={useDenormalizedUpVectorScale:!0};if(Ae.forEach(We=>{const Se=z.transform,Ne=tl(Se.zoom)*D.exaggeration();j=-1;const Xe=We?K.LINES:K.TRIANGLES;for(const Ge of q){const Ye=N.getTile(Ge),mt=r.StencilMode.disabled,wt=D.prevTerrainTileForTile[Ge.key],dt=D.terrainTileForTile[Ge.key];eo(wt,dt)&&Ds.newMorphing(Ge.key,wt,dt,X,250),J.activeTexture.set(K.TEXTURE0),Ye.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const xt=Ds.getMorphValuesForProxy(Ge.key),Bt=xt?1:0;xt&&r.extend$1(Ce,{morphing:{srcDemTile:xt.from,dstDemTile:xt.to,phase:r.easeCubicInOut(xt.phase)}});const Lt=r.tileCornersToBounds(Ge.canonical),_t=r.getLatitudinalLod(Lt.getCenter().lat),Jt=r.getGridMatrix(Ge.canonical,Lt,_t,Se.worldSize/Se._pixelsPerMercatorPixel),ii=r.globeNormalizeECEF(r.globeTileBounds(Ge.canonical)),ni=el(Se.projMatrix,je,ve,ii,r.globeToMercatorTransition(Se.zoom),xe,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,Ee,Ne,Jt);if(fe(Bt,We),D.setupElevationDraw(Ye,Q,Ce),z.prepareDrawProgram(J,Q,Ge.toUnwrapped()),Ze){const[si,pn,nn]=We?Ze.getWirefameBuffers(z.context,_t):Ze.getGridBuffers(_t,Ne!==0);Q.draw(J,Xe,_e,mt,me,r.CullFaceMode.backCCW,ni,"globe_raster",si,pn,nn)}}}),Ze){const We=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&We.push("CUSTOM_ANTIALIASING"),Q=z.useProgram("globeRaster",null,We);for(const Se of q){const{x:Ne,y:Xe,z:Ge}=Se.canonical,Ye=Xe===0,mt=Xe===(1<<Ge)-1,[wt,dt,xt,Bt]=Ze.getPoleBuffers(Ge);if(Bt&&(Ye||mt)){const Lt=N.getTile(Se);J.activeTexture.set(K.TEXTURE0),Lt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let _t=r.globePoleMatrixForTile(Ge,Ne,ne);const Jt=r.globeNormalizeECEF(r.globeTileBounds(Se.canonical)),ii=(ni,si)=>ni.draw(J,K.TRIANGLES,_e,r.StencilMode.disabled,me,r.CullFaceMode.disabled,el(ne.projMatrix,_t,_t,Jt,0,xe,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ee,0),"globe_pole_raster",si,xt,Bt);D.setupElevationDraw(Lt,Q,Ce),z.prepareDrawProgram(J,Q,Se.toUnwrapped()),Ye&&ii(Q,wt),mt&&(_t=r.scale(r.create(),_t,[1,-1,1]),ii(Q,dt))}}}})(y,b,M,S,P);else{const z=y.context,D=z.gl;let N,q;const X=y.options.showTerrainWireframe?2:0,J=(ne,se)=>{if(q===ne)return;const fe=[vr[ne]];se&&fe.push(vr[X]),N=y.useProgram("terrainRaster",null,fe),q=ne},K=y.colorModeForRenderPass(),Q=new r.DepthMode(D.LEQUAL,r.DepthMode.ReadWrite,y.depthRangeFor3D);Ds.update(P);const j=y.transform,H=tl(j.zoom)*b.exaggeration();(X?[!1,!0]:[!1]).forEach(ne=>{q=-1;const se=ne?D.LINES:D.TRIANGLES,[fe,me]=ne?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const _e of S){const ve=M.getTile(_e),xe=r.StencilMode.disabled,Ae=b.prevTerrainTileForTile[_e.key],Ze=b.terrainTileForTile[_e.key];eo(Ae,Ze)&&Ds.newMorphing(_e.key,Ae,Ze,P,250),z.activeTexture.set(D.TEXTURE0),ve.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE,D.LINEAR_MIPMAP_NEAREST);const Ee=Ds.getMorphValuesForProxy(_e.key),je=Ee?1:0;let Ce;Ee&&(Ce={morphing:{srcDemTile:Ee.from,dstDemTile:Ee.to,phase:r.easeCubicInOut(Ee.phase)}});const We=Qr(_e.projMatrix,Eu(_e.canonical,j.renderWorldCopies)?H/10:H);J(je,ne),b.setupElevationDraw(ve,N,Ce),y.prepareDrawProgram(z,N,_e.toUnwrapped()),N.draw(z,se,Q,xe,K,r.CullFaceMode.backCCW,We,"terrain_raster",b.gridBuffer,fe,me)}})}}(c,this,this.proxySourceCache,s,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),s.splice(0,s.length))}renderBatch(s){if(this._drapedRenderBatches.length===0)return s+1;this.renderingToTexture=!0;const c=this.painter,_=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],M=this._drapedRenderBatches.shift(),S=[],P=c.style.order;let z=0;for(const D of b){const N=y.getTileByID(D.proxyTileKey),q=y.proxyCachedFBO[D.key]?y.proxyCachedFBO[D.key][s]:void 0,X=q!==void 0?y.renderCache[q]:this.pool[z++],J=q!==void 0;if(N.texture=X.tex,J&&!X.dirty){S.push(N.tileID);continue}let K;_.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(_.clear({color:r.Color.transparent,stencil:0}),X.dirty=!1);for(let Q=M.start;Q<=M.end;++Q){const j=c.style._layers[P[Q]];if(j.isHidden(c.transform.zoom))continue;const H=c.style._getLayerSourceCache(j),ne=H?this.proxyToSource[D.key][H.id]:[D];if(!ne)continue;const se=ne;_.viewport.set([0,0,X.fb.width,X.fb.height]),K!==(H?H.id:null)&&(this._setupStencil(X,ne,j,H),K=H?H.id:null),c.renderLayer(c,H,j,se)}this.renderedToTile?(X.dirty=!0,S.push(N.tileID)):J||--z,z===5&&(z=0,this.renderToBackBuffer(S))}return this.renderToBackBuffer(S),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),M.end+1}postRender(){}renderCacheEfficiency(s){const c=s.order.length;if(c===0)return{efficiency:100};let _,y=0,b=0,M=!1;for(let S=0;S<c;++S){const P=s._layers[s.order[S]];this._style.isLayerDraped(P)?(M&&++y,++b):M||(M=!0,_=P.id)}return b===0?{efficiency:100}:{efficiency:100*(1-y/b),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let s=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{s=Math.min(s,c.dem.tree.minimums[0])}),s===0?s:(s-30)*this._exaggeration}raycast(s,c,_){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const M=b.tileID,S=1<<M.overscaledZ,{x:P,y:z}=M.canonical,D=P/S,N=(P+1)/S,q=z/S,X=(z+1)/S;return{minx:D,miny:q,maxx:N,maxy:X,t:b.dem.tree.raycastRoot(D,q,N,X,s,c,_),tile:b}});y.sort((b,M)=>(b.t!==null?b.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const M=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,s,c,_);if(M!=null)return M}return null}_createFBO(){const s=this.painter.context,c=s.gl,_=this.drapeBufferSize;s.activeTexture.set(c.TEXTURE0);const y=new r.Texture(s,{width:_[0],height:_[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=s.createFramebuffer(_[0],_[1],!1);return b.colorAttachment.set(y.texture),b.depthAttachment=new ge(s,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=s.createRenderbuffer(s.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),s.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),s.extTextureFilterAnisotropic&&!s.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const s in this._style._sourceCaches)if(this._style._sourceCaches[s].hasTransition())return!0;return this._style.order.some(s=>{const c=this._style._layers[s],_=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!_&&c.shouldRedrape():!_&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let s=!1;for(const _ of this._style._getSources())if(_ instanceof it){s=!0;break}if(!s)return;const c={};for(let _=0;_<this._style.order.length;++_){const y=this._style._layers[this._style.order[_]],b=this._style._getLayerSourceCache(y);if(b&&!c[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof r.ZoomDependentExpression){c[b.id]=!0;for(const M of this.proxyCoords){const S=this.proxyToSource[M.key][b.id];if(S)for(const P of S)this._clearRenderCacheForTile(b.id,P)}}}}_clearRasterLayersFromRenderCache(){let s=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Ke){s=!0;break}if(!s)return;const c={};for(let _=0;_<this._style.order.length;++_){const y=this._style._layers[this._style.order[_]],b=this._style._getLayerSourceCache(y);if(!b||c[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const M=y.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const P=this.proxyToSource[S.key][b.id];if(P)for(const z of P){const D=Ec(b.getTile(z),b.findLoadedParent(z,0),b,this.painter.transform,M);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(b.id,z)}}}}_setupDrapedRenderBatches(){const s=this._style.order,c=s.length;if(c===0)return;const _=[];let y,b=0,M=this._style._layers[s[b]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++b<c;)M=this._style._layers[s[b]];for(;b<c;++b){const S=this._style._layers[s[b]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?y===void 0&&(y=b):y!==void 0&&(_.push({start:y,end:b-1}),y=void 0))}y!==void 0&&_.push({start:y,end:b-1}),this._drapedRenderBatches=_}_setupRenderCache(s){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const M=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let S=0;S<M.length;++S){const P=Object.values(M[S]);c.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,y=this._tilesDirty;for(let M=_.length-1;M>=0;M--){const S=_[M];if(c.getTileByID(S.key),c.proxyCachedFBO[S.key]!==void 0){const P=s[S.key],z=this.proxyToSource[S.key];let D=0;for(const N in z){const q=z[N],X=P[N];if(!X||X.length!==q.length||q.some((J,K)=>J!==X[K]||y[N]&&y[N].hasOwnProperty(J.key))){D=-1;break}++D}for(const N in c.proxyCachedFBO[S.key])c.renderCache[c.proxyCachedFBO[S.key][N]].dirty=D<0||D!==Object.values(P).length}}const b=[...this._drapedRenderBatches];b.sort((M,S)=>S.end-S.start-(M.end-M.start));for(const M of b)for(const S of _){if(c.proxyCachedFBO[S.key])continue;let P=c.renderCachePool.pop();P===void 0&&c.renderCache.length<50&&(P=c.renderCache.length,c.renderCache.push(this._createFBO())),P!==void 0&&(c.proxyCachedFBO[S.key]={},c.proxyCachedFBO[S.key][M.start]=P,c.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(s,c,_,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,M=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let S;if(_.isTileClipped())S=c.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(s){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[s.key]),this._overlapStencilMode):r.StencilMode.disabled}_renderTileClippingMasks(s,c){const _=this.painter,y=this.painter.context,b=y.gl;_._tileClippingMaskIDs={},y.setColorMode(r.ColorMode.disabled),y.setDepthMode(r.DepthMode.disabled);const M=_.useProgram("clippingMask");for(const S of s){const P=_._tileClippingMaskIDs[S.key]=--c;M.draw(y,b.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:b.ALWAYS,mask:0},P,255,b.KEEP,b.KEEP,b.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,ea(S.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(s){const c=this.painter.transform;if(s.x<0||s.x>c.width||s.y<0||s.y>c.height)return null;const _=[s.x,s.y,1,1];r.transformMat4$1(_,_,c.pixelMatrixInverse),r.scale$1(_,_,1/_[3]),_[0]/=c.worldSize,_[1]/=c.worldSize;const y=c._camera.position,b=r.mercatorZfromAltitude(1,c.center.lat),M=[y[0],y[1],y[2]/b,0],S=r.subtract([],_.slice(0,3),M);r.normalize(S,S);const P=this.raycast(M,S,this._exaggeration);return P!==null&&P?(r.scaleAndAdd(M,M,S,P),M[3]=M[2],M[2]*=b,M):null}drawDepth(){const s=this.painter,c=s.context,_=this.proxySourceCache,y=Math.ceil(s.width),b=Math.ceil(s.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=c.gl,S=c.createFramebuffer(y,b,!0);c.activeTexture.set(M.TEXTURE0);const P=new r.Texture(c,{width:y,height:b,data:null},M.RGBA);P.bind(M.NEAREST,M.CLAMP_TO_EDGE),S.colorAttachment.set(P.texture);const z=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,b);S.depthAttachment.set(z),this._depthFBO=S,this._depthTexture=P}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,b]),function(M,S,P,z){if(M.transform.projection.name==="globe")return;const D=M.context,N=D.gl;D.clear({depth:1});const q=M.useProgram("terrainDepth"),X=new r.DepthMode(N.LESS,r.DepthMode.ReadWrite,M.depthRangeFor3D);for(const J of z){const K=P.getTile(J),Q=Qr(J.projMatrix,0);S.setupElevationDraw(K,q),q.draw(D,N.TRIANGLES,X,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.backCCW,Q,"terrain_depth",S.gridBuffer,S.gridIndexBuffer,S.gridNoSkirtSegments)}}(s,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(s,c,_){if(s.getSource()instanceof Pt)return this._setupProxiedCoordsForImageSource(s,c,_);this._findCoveringTileCache[s.id]=this._findCoveringTileCache[s.id]||{};const y=this.proxiedCoords[s.id]=[],b=this.proxyCoords;for(let S=0;S<b.length;S++){const P=b[S],z=this._findTileCoveringTileID(P,s);if(z){const D=this._createProxiedId(P,z,_[P.key]&&_[P.key][s.id]);y.push(D),this.proxyToSource[P.key][s.id]=[D]}}let M=!1;for(let S=0;S<c.length;S++){const P=s.getTile(c[S]);if(!P||!P.hasData())continue;const z=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==P.tileID.canonical.z){const D=this.proxyToSource[z.tileID.key][s.id],N=this._createProxiedId(z.tileID,P,_[z.tileID.key]&&_[z.tileID.key][s.id]);D?D.splice(D.length-1,0,N):this.proxyToSource[z.tileID.key][s.id]=[N],y.push(N),M=!0}}this._sourceTilesOverlap[s.id]=M}_setupProxiedCoordsForImageSource(s,c,_){if(!s.getSource().loaded())return;const y=this.proxiedCoords[s.id]=[],b=this.proxyCoords,M=s.getSource(),S=new r.Point(M.tileID.x,M.tileID.y)._div(1<<M.tileID.z),P=M.coordinates.map(r.MercatorCoordinate.fromLngLat).reduce((D,N)=>(D.min.x=Math.min(D.min.x,N.x-S.x),D.min.y=Math.min(D.min.y,N.y-S.y),D.max.x=Math.max(D.max.x,N.x-S.x),D.max.y=Math.max(D.max.y,N.y-S.y),D),{min:new r.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(D,N)=>{const q=D.wrap+D.canonical.x/(1<<D.canonical.z),X=D.canonical.y/(1<<D.canonical.z),J=r.EXTENT/(1<<D.canonical.z),K=N.wrap+N.canonical.x/(1<<N.canonical.z),Q=N.canonical.y/(1<<N.canonical.z);return q+J<K+P.min.x||q>K+P.max.x||X+J<Q+P.min.y||X>Q+P.max.y};for(let D=0;D<b.length;D++){const N=b[D];for(let q=0;q<c.length;q++){const X=s.getTile(c[q]);if(!X||!X.hasData()||z(N,X.tileID))continue;const J=this._createProxiedId(N,X,_[N.key]&&_[N.key][s.id]),K=this.proxyToSource[N.key][s.id];K?K.push(J):this.proxyToSource[N.key][s.id]=[J],y.push(J)}}}_createProxiedId(s,c,_){let y=this.orthoMatrix;if(_){const b=_.find(M=>M.key===c.tileID.key);if(b)return b}if(c.tileID.key!==s.key){const b=s.canonical.z-c.tileID.canonical.z;let M,S,P;y=r.create();const z=c.tileID.wrap-s.wrap<<s.overscaledZ;b>0?(M=r.EXTENT>>b,S=M*((c.tileID.canonical.x<<b)-s.canonical.x+z),P=M*((c.tileID.canonical.y<<b)-s.canonical.y)):(M=r.EXTENT<<-b,S=r.EXTENT*(c.tileID.canonical.x-(s.canonical.x+z<<-b)),P=r.EXTENT*(c.tileID.canonical.y-(s.canonical.y<<-b))),r.ortho(y,0,M,0,M,0,1),r.translate(y,y,[S,P,0])}return new nl(c.tileID,s.key,y)}_findTileCoveringTileID(s,c){let _=c.getTile(s);if(_&&_.hasData())return _;const y=this._findCoveringTileCache[c.id],b=y[s.key];if(_=b?c.getTileByID(b):null,_&&_.hasData()||b===null)return _;let M=_?_.tileID:s,S=M.overscaledZ;const P=c.getSource().minzoom,z=[];if(!b){const N=c.getSource().maxzoom;if(s.canonical.z>=N){const q=s.canonical.z-N;c.getSource().reparseOverscaled?(S=Math.max(s.canonical.z+2,c.transform.tileZoom),M=new r.OverscaledTileID(S,s.wrap,N,s.canonical.x>>q,s.canonical.y>>q)):q!==0&&(S=N,M=new r.OverscaledTileID(S,s.wrap,N,s.canonical.x>>q,s.canonical.y>>q))}M.key!==s.key&&(z.push(M.key),_=c.getTile(M))}const D=N=>{z.forEach(q=>{y[q]=N}),z.length=0};for(S-=1;S>=P&&(!_||!_.hasData());S--){_&&D(_.tileID.key);const N=M.calculateScaledKey(S);if(_=c.getTileByID(N),_&&_.hasData())break;const q=y[N];if(q===null)break;q===void 0?z.push(N):_=c.getTileByID(q)}return D(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(s){return this.enabled?this._findTileCoveringTileID(s,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(s,c){let _=this._tilesDirty[s];_||(_=this._tilesDirty[s]={}),_[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const s=function(c){let _=0;const y=new r.StructArrayLayout2ui4,b=131;for(let M=1;M<129;M++){for(let S=1;S<129;S++)_=M*b+S,y.emplaceBack(_,_+1),y.emplaceBack(_,_+b),y.emplaceBack(_+1,_+b),M===128&&y.emplaceBack(_+b,_+b+1);y.emplaceBack(_+1,_+1+b)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(s),this.wireframeSegments=r.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,s.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ut{static cacheKey(s,c,_,y){let b=`${c}${y?y.cacheKey:""}`;for(const M of _)s.usedDefines.includes(M)&&(b+=`/${M}`);return b}constructor(s,c,_,y,b,M){const S=s.gl;this.program=S.createProgram();const P=function(j){const H=[];for(let ne=0;ne<j.length;ne++){if(j[ne]===null)continue;const se=j[ne].split(" ");H.push(se.pop())}return H}(_.staticAttributes),z=y?y.getBinderAttributes():[],D=P.concat(z);let N=y?y.defines():[];N=N.concat(M.map(j=>`#define ${j}`));const q=s.isWebGL2?`#version 300 es
`:"",X=q+N.concat(s.extStandardDerivatives&&q.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(xc):xc,xc,Qa,bu.fragmentSource,Kr.fragmentSource,_.fragmentSource).join(`
`),J=q+N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Qa,bu.vertexSource,Kr.vertexSource,Ja.vertexSource,_.vertexSource).join(`
`),K=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(K,X),S.compileShader(K),S.attachShader(this.program,K);const Q=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(Q,J),S.compileShader(Q),S.attachShader(this.program,Q),this.attributes={},this.numAttributes=D.length;for(let j=0;j<this.numAttributes;j++)D[j]&&(S.bindAttribLocation(this.program,j,D[j]),this.attributes[D[j]]=j);S.linkProgram(this.program),S.deleteShader(Q),S.deleteShader(K),this.fixedUniforms=b(s),this.binderUniforms=y?y.getUniforms(s):[],M.includes("TERRAIN")&&(this.terrainUniforms=(j=>({u_dem:new r.Uniform1i(j),u_dem_prev:new r.Uniform1i(j),u_dem_unpack:new r.Uniform4f(j),u_dem_tl:new r.Uniform2f(j),u_dem_scale:new r.Uniform1f(j),u_dem_tl_prev:new r.Uniform2f(j),u_dem_scale_prev:new r.Uniform1f(j),u_dem_size:new r.Uniform1f(j),u_dem_lerp:new r.Uniform1f(j),u_exaggeration:new r.Uniform1f(j),u_depth:new r.Uniform1i(j),u_depth_size_inv:new r.Uniform2f(j),u_meter_to_dem:new r.Uniform1f(j),u_label_plane_matrix_inv:new r.UniformMatrix4f(j)}))(s)),M.includes("GLOBE")&&(this.globeUniforms=(j=>({u_tile_tl_up:new r.Uniform3f(j),u_tile_tr_up:new r.Uniform3f(j),u_tile_br_up:new r.Uniform3f(j),u_tile_bl_up:new r.Uniform3f(j),u_tile_up_scale:new r.Uniform1f(j)}))(s)),M.includes("FOG")&&(this.fogUniforms=(j=>({u_fog_matrix:new r.UniformMatrix4f(j),u_fog_range:new r.Uniform2f(j),u_fog_color:new r.Uniform4f(j),u_fog_horizon_blend:new r.Uniform1f(j),u_fog_temporal_offset:new r.Uniform1f(j),u_frustum_tl:new r.Uniform3f(j),u_frustum_tr:new r.Uniform3f(j),u_frustum_br:new r.Uniform3f(j),u_frustum_bl:new r.Uniform3f(j),u_globe_pos:new r.Uniform3f(j),u_globe_radius:new r.Uniform1f(j),u_globe_transition:new r.Uniform1f(j),u_is_globe:new r.Uniform1i(j),u_viewport:new r.Uniform2f(j)}))(s))}}setTerrainUniformValues(s,c){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)_[y]&&_[y].set(this.program,y,c[y])}}setGlobeUniformValues(s,c){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)_[y]&&_[y].set(this.program,y,c[y])}}setFogUniformValues(s,c){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){s.program.set(this.program);for(const y in c)_[y].set(this.program,y,c[y])}}draw(s,c,_,y,b,M,S,P,z,D,N,q,X,J,K){const Q=s.gl;if(this.failedToCreate)return;s.program.set(this.program),s.setDepthMode(_),s.setStencilMode(y),s.setColorMode(b),s.setCullFace(M);for(const H of Object.keys(this.fixedUniforms))this.fixedUniforms[H].set(this.program,H,S[H]);J&&J.setUniforms(this.program,s,this.binderUniforms,q,{zoom:X});const j={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[c];for(const H of N.get()){const ne=H.vaos||(H.vaos={});(ne[P]||(ne[P]=new jp)).bind(s,this,z,J?J.getPaintVertexBuffers():[],D,H.vertexOffset,K||[]),Q.drawElements(c,H.primitiveLength*j,Q.UNSIGNED_SHORT,H.primitiveOffset*j*2)}}}function ta(p,s){const c=Math.pow(2,s.tileID.overscaledZ),_=s.tileSize*Math.pow(2,p.transform.tileZoom)/c,y=_*(s.tileID.canonical.x+s.tileID.wrap*c),b=_*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_tile_units_to_pixels:1/ki(s,1,p.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const Mu=r.create(),Ac=(p,s,c,_,y,b,M,S,P,z,D)=>{const N=s.style.light,q=N.properties.get("position"),X=[q.x,q.y,q.z],J=r.create$1();N.properties.get("anchor")==="viewport"&&(r.fromRotation(J,-s.transform.angle),r.transformMat3(X,X,J));const K=N.properties.get("color"),Q=s.transform,j={u_matrix:p,u_lightpos:X,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+c,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Mu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:b};return Q.projection.name==="globe"&&(j.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],j.u_zoom_transition=P,j.u_inv_rot_matrix=D,j.u_merc_center=z,j.u_up_dir=Q.projection.upVector(new r.CanonicalTileID(0,0,0),z[0]*r.EXTENT,z[1]*r.EXTENT),j.u_height_lift=S),j},Su=(p,s,c,_,y,b,M,S,P,z,D,N)=>{const q=Ac(p,s,c,_,y,b,M,P,z,D,N),X={u_height_factor:-Math.pow(2,M.overscaledZ)/S.tileSize/8};return r.extend(q,ta(s,S),X)},br=p=>({u_matrix:p}),Ic=(p,s,c)=>r.extend(br(p),ta(s,c)),Vp=(p,s)=>({u_matrix:p,u_world:s}),Up=(p,s,c,_)=>r.extend(Ic(p,s,c),{u_world:_}),Gp=r.create(),Cc=(p,s,c,_,y,b)=>{const M=p.transform,S=M.projection.name==="globe";let P;if(b.paint.get("circle-pitch-alignment")==="map")if(S){const D=r.globePixelsToTileUnits(M.zoom,s.canonical)*M._pixelsPerMercatorPixel;P=Float32Array.from([D,0,0,D])}else P=M.calculatePixelsToTileUnitsMatrix(c);else P=new Float32Array([M.pixelsToGLUnits[0],0,0,M.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:M.cameraToCenterDistance,u_matrix:p.translatePosMatrix(s.projMatrix,c,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:r.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Gp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(S){z.u_inv_rot_matrix=_,z.u_merc_center=y,z.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],z.u_zoom_transition=r.globeToMercatorTransition(M.zoom);const D=y[0]*r.EXTENT,N=y[1]*r.EXTENT;z.u_up_dir=M.projection.upVector(new r.CanonicalTileID(0,0,0),D,N)}return z},Pc=p=>{const s=[];return p.paint.get("circle-pitch-alignment")==="map"&&s.push("PITCH_WITH_MAP"),p.paint.get("circle-pitch-scale")==="map"&&s.push("SCALE_WITH_MAP"),s},kc=(p,s,c,_)=>{const y=r.EXTENT/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:s.getCameraToCenterDistance(_),u_extrude_scale:[s.pixelsToGLUnits[0]/y,s.pixelsToGLUnits[1]/y]}},sl=(p,s,c=1)=>({u_matrix:p,u_color:s,u_overlay:0,u_overlay_scale:c}),Au=r.create(),Iu=(p,s,c,_,y,b,M)=>{const S=p.transform,P=S.projection.name==="globe",z=P?r.globePixelsToTileUnits(S.zoom,s.canonical)*S._pixelsPerMercatorPixel:ki(c,1,b),D={u_matrix:s.projMatrix,u_extrude_scale:z,u_intensity:M,u_inv_rot_matrix:Au,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){D.u_inv_rot_matrix=_,D.u_merc_center=y,D.u_tile_id=[s.canonical.x,s.canonical.y,1<<s.canonical.z],D.u_zoom_transition=r.globeToMercatorTransition(S.zoom);const N=y[0]*r.EXTENT,q=y[1]*r.EXTENT;D.u_up_dir=S.projection.upVector(new r.CanonicalTileID(0,0,0),N,q)}return D},$p=(p,s,c,_,y,b,M)=>{const S=p.transform,P=S.calculatePixelsToTileUnitsMatrix(s);return{u_matrix:Lc(p,s,c,_),u_pixels_to_tile_units:P,u_device_pixel_ratio:b,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:na(c)?s.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:to(s,p.transform),u_alpha_discard_threshold:0,u_trim_offset:M}},ia=(p,s,c,_,y)=>{const b=p.transform;return{u_matrix:Lc(p,s,c,_),u_texsize:s.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(s),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:to(s,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function to(p,s){return 1/ki(p,1,s.tileZoom)}function Lc(p,s,c,_){return p.translatePosMatrix(_||s.tileID.projMatrix,s,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function na(p){const s=p.paint.get("line-dasharray").value;return s.value||s.kind!=="constant"}const Dc=(p,s,c,_,y,b)=>{return{u_matrix:p,u_tl_parent:s,u_scale_parent:c,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(S=y.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(M=y.paint.get("raster-contrast"),M>0?1/(1-M):1+M),u_spin_weights:fs(y.paint.get("raster-hue-rotate")),u_perspective_transform:b};var M,S};function fs(p){p*=Math.PI/180;const s=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*s-c+1)/3,(Math.sqrt(3)*s-c+1)/3]}const rl=r.create(),zc=(p,s,c,_,y,b,M,S,P,z,D,N,q,X,J,K)=>{const Q=y.transform,j={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:Q.width/Q.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:M,u_coord_matrix:S,u_is_text:+P,u_pitch_with_map:+_,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:rl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:rl,u_up_vector:[0,-1,0]};return K.name==="globe"&&(j.u_tile_id=[D.canonical.x,D.canonical.y,1<<D.canonical.z],j.u_zoom_transition=N,j.u_inv_rot_matrix=X,j.u_merc_center=q,j.u_camera_forward=Q._camera.forward(),j.u_ecef_origin=r.globeECEFOrigin(Q.globeMatrix,D.toUnwrapped()),j.u_tile_matrix=Float32Array.from(Q.globeMatrix),j.u_up_vector=J),j},ol=(p,s,c,_,y,b,M,S,P,z,D,N,q,X,J,K,Q)=>r.extend(zc(p,s,c,_,y,b,M,S,P,z,N,q,X,J,K,Q),{u_gamma_scale:_?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:r.exported.devicePixelRatio,u_is_halo:+D}),Cu=(p,s,c,_,y,b,M,S,P,z,D,N,q,X,J,K)=>r.extend(ol(p,s,c,_,y,b,M,S,!0,P,!0,D,N,q,X,J,K),{u_texsize_icon:z,u_texture_icon:1}),Rc=(p,s,c)=>({u_matrix:p,u_opacity:s,u_color:c}),qp=(p,s,c,_,y)=>r.extend(function(b,M,S){const P=M.imageManager.getPattern(b.toString()),{width:z,height:D}=M.imageManager.getPixelSize(),N=Math.pow(2,S.tileID.overscaledZ),q=S.tileSize*Math.pow(2,M.transform.tileZoom)/N,X=q*(S.tileID.canonical.x+S.tileID.wrap*N),J=q*S.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[z,D],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/ki(S,1,M.transform.tileZoom),u_pixel_coord_upper:[X>>16,J>>16],u_pixel_coord_lower:[65535&X,65535&J]}}(_,c,y),{u_matrix:p,u_opacity:s}),Oc={fillExtrusion:p=>({u_matrix:new r.UniformMatrix4f(p),u_lightpos:new r.Uniform3f(p),u_lightintensity:new r.Uniform1f(p),u_lightcolor:new r.Uniform3f(p),u_vertical_gradient:new r.Uniform1f(p),u_opacity:new r.Uniform1f(p),u_edge_radius:new r.Uniform1f(p),u_ao:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_up_dir:new r.Uniform3f(p),u_height_lift:new r.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_lightpos:new r.Uniform3f(p),u_lightintensity:new r.Uniform1f(p),u_lightcolor:new r.Uniform3f(p),u_vertical_gradient:new r.Uniform1f(p),u_height_factor:new r.Uniform1f(p),u_edge_radius:new r.Uniform1f(p),u_ao:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_up_dir:new r.Uniform3f(p),u_height_lift:new r.Uniform1f(p),u_image:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_pixel_coord_upper:new r.Uniform2f(p),u_pixel_coord_lower:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p),u_opacity:new r.Uniform1f(p)}),fill:p=>({u_matrix:new r.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_image:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_pixel_coord_upper:new r.Uniform2f(p),u_pixel_coord_lower:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p)}),fillOutline:p=>({u_matrix:new r.UniformMatrix4f(p),u_world:new r.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_world:new r.Uniform2f(p),u_image:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_pixel_coord_upper:new r.Uniform2f(p),u_pixel_coord_lower:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new r.Uniform1f(p),u_extrude_scale:new r.UniformMatrix2f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_up_dir:new r.Uniform3f(p)}),collisionBox:p=>({u_matrix:new r.UniformMatrix4f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_extrude_scale:new r.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new r.UniformMatrix4f(p),u_inv_matrix:new r.UniformMatrix4f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_viewport_size:new r.Uniform2f(p)}),debug:p=>({u_color:new r.UniformColor(p),u_matrix:new r.UniformMatrix4f(p),u_overlay:new r.Uniform1i(p),u_overlay_scale:new r.Uniform1f(p)}),clippingMask:p=>({u_matrix:new r.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new r.Uniform1f(p),u_intensity:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_up_dir:new r.Uniform3f(p)}),heatmapTexture:p=>({u_image:new r.Uniform1i(p),u_color_ramp:new r.Uniform1i(p),u_opacity:new r.Uniform1f(p)}),hillshade:p=>({u_matrix:new r.UniformMatrix4f(p),u_image:new r.Uniform1i(p),u_latrange:new r.Uniform2f(p),u_light:new r.Uniform2f(p),u_shadow:new r.UniformColor(p),u_highlight:new r.UniformColor(p),u_accent:new r.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new r.UniformMatrix4f(p),u_image:new r.Uniform1i(p),u_dimension:new r.Uniform2f(p),u_zoom:new r.Uniform1f(p),u_unpack:new r.Uniform4f(p)}),line:p=>({u_matrix:new r.UniformMatrix4f(p),u_pixels_to_tile_units:new r.UniformMatrix2f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_units_to_pixels:new r.Uniform2f(p),u_dash_image:new r.Uniform1i(p),u_gradient_image:new r.Uniform1i(p),u_image_height:new r.Uniform1f(p),u_texsize:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p),u_alpha_discard_threshold:new r.Uniform1f(p),u_trim_offset:new r.Uniform2f(p)}),linePattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_texsize:new r.Uniform2f(p),u_pixels_to_tile_units:new r.UniformMatrix2f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_image:new r.Uniform1i(p),u_units_to_pixels:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p),u_alpha_discard_threshold:new r.Uniform1f(p)}),raster:p=>({u_matrix:new r.UniformMatrix4f(p),u_tl_parent:new r.Uniform2f(p),u_scale_parent:new r.Uniform1f(p),u_fade_t:new r.Uniform1f(p),u_opacity:new r.Uniform1f(p),u_image0:new r.Uniform1i(p),u_image1:new r.Uniform1i(p),u_brightness_low:new r.Uniform1f(p),u_brightness_high:new r.Uniform1f(p),u_saturation_factor:new r.Uniform1f(p),u_contrast_factor:new r.Uniform1f(p),u_spin_weights:new r.Uniform3f(p),u_perspective_transform:new r.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new r.Uniform1i(p),u_is_size_feature_constant:new r.Uniform1i(p),u_size_t:new r.Uniform1f(p),u_size:new r.Uniform1f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_rotate_symbol:new r.Uniform1i(p),u_aspect_ratio:new r.Uniform1f(p),u_fade_change:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_label_plane_matrix:new r.UniformMatrix4f(p),u_coord_matrix:new r.UniformMatrix4f(p),u_is_text:new r.Uniform1i(p),u_pitch_with_map:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_camera_forward:new r.Uniform3f(p),u_tile_matrix:new r.UniformMatrix4f(p),u_up_vector:new r.Uniform3f(p),u_ecef_origin:new r.Uniform3f(p),u_texture:new r.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new r.Uniform1i(p),u_is_size_feature_constant:new r.Uniform1i(p),u_size_t:new r.Uniform1f(p),u_size:new r.Uniform1f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_rotate_symbol:new r.Uniform1i(p),u_aspect_ratio:new r.Uniform1f(p),u_fade_change:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_label_plane_matrix:new r.UniformMatrix4f(p),u_coord_matrix:new r.UniformMatrix4f(p),u_is_text:new r.Uniform1i(p),u_pitch_with_map:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_texture:new r.Uniform1i(p),u_gamma_scale:new r.Uniform1f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_camera_forward:new r.Uniform3f(p),u_tile_matrix:new r.UniformMatrix4f(p),u_up_vector:new r.Uniform3f(p),u_ecef_origin:new r.Uniform3f(p),u_is_halo:new r.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new r.Uniform1i(p),u_is_size_feature_constant:new r.Uniform1i(p),u_size_t:new r.Uniform1f(p),u_size:new r.Uniform1f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_rotate_symbol:new r.Uniform1i(p),u_aspect_ratio:new r.Uniform1f(p),u_fade_change:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_label_plane_matrix:new r.UniformMatrix4f(p),u_coord_matrix:new r.UniformMatrix4f(p),u_is_text:new r.Uniform1i(p),u_pitch_with_map:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_texsize_icon:new r.Uniform2f(p),u_texture:new r.Uniform1i(p),u_texture_icon:new r.Uniform1i(p),u_gamma_scale:new r.Uniform1f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_is_halo:new r.Uniform1i(p)}),background:p=>({u_matrix:new r.UniformMatrix4f(p),u_opacity:new r.Uniform1f(p),u_color:new r.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_opacity:new r.Uniform1f(p),u_image:new r.Uniform1i(p),u_pattern_tl:new r.Uniform2f(p),u_pattern_br:new r.Uniform2f(p),u_texsize:new r.Uniform2f(p),u_pattern_size:new r.Uniform2f(p),u_pixel_coord_upper:new r.Uniform2f(p),u_pixel_coord_lower:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p)}),terrainRaster:Tc,terrainDepth:Tc,skybox:p=>({u_matrix:new r.UniformMatrix4f(p),u_sun_direction:new r.Uniform3f(p),u_cubemap:new r.Uniform1i(p),u_opacity:new r.Uniform1f(p),u_temporal_offset:new r.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new r.UniformMatrix4f(p),u_color_ramp:new r.Uniform1i(p),u_center_direction:new r.Uniform3f(p),u_radius:new r.Uniform1f(p),u_opacity:new r.Uniform1f(p),u_temporal_offset:new r.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new r.UniformMatrix3f(p),u_sun_direction:new r.Uniform3f(p),u_sun_intensity:new r.Uniform1f(p),u_color_tint_r:new r.Uniform4f(p),u_color_tint_m:new r.Uniform4f(p),u_luminance:new r.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new r.UniformMatrix4f(p),u_globe_matrix:new r.UniformMatrix4f(p),u_normalize_matrix:new r.UniformMatrix4f(p),u_merc_matrix:new r.UniformMatrix4f(p),u_zoom_transition:new r.Uniform1f(p),u_merc_center:new r.Uniform2f(p),u_image0:new r.Uniform1i(p),u_grid_matrix:new r.UniformMatrix3f(p),u_skirt_height:new r.Uniform1f(p),u_frustum_tl:new r.Uniform3f(p),u_frustum_tr:new r.Uniform3f(p),u_frustum_br:new r.Uniform3f(p),u_frustum_bl:new r.Uniform3f(p),u_globe_pos:new r.Uniform3f(p),u_globe_radius:new r.Uniform1f(p),u_viewport:new r.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.Uniform3f(p),u_frustum_tr:new r.Uniform3f(p),u_frustum_br:new r.Uniform3f(p),u_frustum_bl:new r.Uniform3f(p),u_horizon:new r.Uniform1f(p),u_transition:new r.Uniform1f(p),u_fadeout_range:new r.Uniform1f(p),u_color:new r.Uniform4f(p),u_high_color:new r.Uniform4f(p),u_space_color:new r.Uniform4f(p),u_star_intensity:new r.Uniform1f(p),u_star_density:new r.Uniform1f(p),u_star_size:new r.Uniform1f(p),u_temporal_offset:new r.Uniform1f(p),u_horizon_angle:new r.Uniform1f(p),u_rotation_matrix:new r.UniformMatrix4f(p)})};let al;function sa(p,s,c,_,y,b,M){const S=p.context,P=S.gl,z=p.transform,D=p.useProgram("collisionBox"),N=[];let q=0,X=0;for(let se=0;se<_.length;se++){const fe=_[se],me=s.getTile(fe),_e=me.getBucket(c);if(!_e)continue;const ve=Un(fe,_e,z);let xe=ve;y[0]===0&&y[1]===0||(xe=p.translatePosMatrix(ve,me,y,b));const Ae=M?_e.textCollisionBox:_e.iconCollisionBox,Ze=_e.collisionCircleArray;if(Ze.length>0){const Ee=r.create(),je=xe;r.mul(Ee,_e.placementInvProjMatrix,z.glCoordMatrix),r.mul(Ee,Ee,_e.placementViewportMatrix),N.push({circleArray:Ze,circleOffset:X,transform:je,invTransform:Ee,projection:_e.getProjection()}),q+=Ze.length/4,X=q}Ae&&(p.terrain&&p.terrain.setupElevationDraw(me,D),D.draw(S,P.LINES,r.DepthMode.disabled,r.StencilMode.disabled,p.colorModeForRenderPass(),r.CullFaceMode.disabled,kc(xe,z,me,_e.getProjection()),c.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,z.zoom,null,[Ae.collisionVertexBuffer,Ae.collisionVertexBufferExt]))}if(!M||!N.length)return;const J=p.useProgram("collisionCircle"),K=new r.StructArrayLayout2f1f2i16;K.resize(4*q),K._trim();let Q=0;for(const se of N)for(let fe=0;fe<se.circleArray.length/4;fe++){const me=4*fe,_e=se.circleArray[me+0],ve=se.circleArray[me+1],xe=se.circleArray[me+2],Ae=se.circleArray[me+3];K.emplace(Q++,_e,ve,xe,Ae,0),K.emplace(Q++,_e,ve,xe,Ae,1),K.emplace(Q++,_e,ve,xe,Ae,2),K.emplace(Q++,_e,ve,xe,Ae,3)}(!al||al.length<2*q)&&(al=function(se){const fe=2*se,me=new r.StructArrayLayout3ui6;me.resize(fe),me._trim();for(let _e=0;_e<fe;_e++){const ve=6*_e;me.uint16[ve+0]=4*_e+0,me.uint16[ve+1]=4*_e+1,me.uint16[ve+2]=4*_e+2,me.uint16[ve+3]=4*_e+2,me.uint16[ve+4]=4*_e+3,me.uint16[ve+5]=4*_e+0}return me}(q));const j=S.createIndexBuffer(al,!0),H=S.createVertexBuffer(K,r.collisionCircleLayout.members,!0);for(const se of N){const fe={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(ne=z).getCameraToCenterDistance(se.projection),u_viewport_size:[ne.width,ne.height]};J.draw(S,P.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,p.colorModeForRenderPass(),r.CullFaceMode.disabled,fe,c.id,H,j,r.SegmentVector.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,z.zoom)}var ne;H.destroy(),j.destroy()}const Pu=r.create();function Bc({width:p,height:s,anchor:c,textOffset:_,textScale:y},b){const{horizontalAlign:M,verticalAlign:S}=r.getAnchorAlignment(c),P=-(M-.5)*p,z=-(S-.5)*s,D=r.evaluateVariableOffset(c,_);return new r.Point((P/y+D[0])*b,(z/y+D[1])*b)}function Wp(p,s,c,_,y,b,M,S,P,z,D){const N=p.text.placedSymbolArray,q=p.text.dynamicLayoutVertexArray,X=p.icon.dynamicLayoutVertexArray,J={},K=p.getProjection(),Q=bi(S,K,b),j=b.elevation,H=K.upVectorScale(S.canonical,b.center.lat,b.worldSize).metersToTile;q.clear();for(let ne=0;ne<N.length;ne++){const se=N.get(ne),{tileAnchorX:fe,tileAnchorY:me,numGlyphs:_e}=se,ve=se.hidden||!se.crossTileID||p.allowVerticalPlacement&&!se.placedOrientation?null:_[se.crossTileID];if(ve){let xe=0,Ae=0,Ze=0;if(j){const Ye=j?j.getAtTileOffset(S,fe,me):0,[mt,wt,dt]=K.upVector(S.canonical,fe,me);xe=Ye*mt*H,Ae=Ye*wt*H,Ze=Ye*dt*H}let[Ee,je,Ce,We]=en(se.projectedAnchorX+xe,se.projectedAnchorY+Ae,se.projectedAnchorZ+Ze,c?Q:M);const Se=mu(b.getCameraToCenterDistance(K),We);let Ne=y.evaluateSizeForFeature(p.textSizeData,z,se)*Se/r.ONE_EM;c&&(Ne*=p.tilePixelRatio/P);const Xe=Bc(ve,Ne);c?({x:Ee,y:je,z:Ce}=K.projectTilePoint(fe+Xe.x,me+Xe.y,S.canonical),[Ee,je,Ce]=en(Ee+xe,je+Ae,Ce+Ze,M)):(s&&Xe._rotate(-b.angle),Ee+=Xe.x,je+=Xe.y,Ce=0);const Ge=p.allowVerticalPlacement&&se.placedOrientation===r.WritingMode.vertical?Math.PI/2:0;for(let Ye=0;Ye<_e;Ye++)r.addDynamicAttributes(q,Ee,je,Ce,Ge);D&&se.associatedIconIndex>=0&&(J[se.associatedIconIndex]={x:Ee,y:je,z:Ce,angle:Ge})}else es(_e,q)}if(D){X.clear();const ne=p.icon.placedSymbolArray;for(let se=0;se<ne.length;se++){const fe=ne.get(se),{numGlyphs:me}=fe,_e=J[se];if(fe.hidden||!_e)es(me,X);else{const{x:ve,y:xe,z:Ae,angle:Ze}=_e;for(let Ee=0;Ee<me;Ee++)r.addDynamicAttributes(X,ve,xe,Ae,Ze)}}p.icon.dynamicLayoutVertexBuffer.updateData(X)}p.text.dynamicLayoutVertexBuffer.updateData(q)}function Fc(p,s,c){return c.iconsInText&&s?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function ku(p,s,c,_,y,b,M,S,P,z,D,N){const q=p.context,X=q.gl,J=p.transform,K=S==="map",Q=P==="map",j=K&&c.layout.get("symbol-placement")!=="point",H=K&&!Q&&!j,ne=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let se=!1;const fe=p.depthModeForSublayer(0,r.DepthMode.ReadOnly),me=[r.mercatorXfromLng(J.center.lng),r.mercatorYfromLat(J.center.lat)],_e=c.layout.get("text-variable-anchor"),ve=J.projection.name==="globe",xe=[],Ae=[0,-1,0];let Ze=Ae;!ve&&!J.mercatorFromTransition||K||(Ze=function(Ee){const je=Ee._camera.getWorldToCamera(Ee.worldSize,1),Ce=r.multiply([],je,Ee.globeMatrix);r.invert(Ce,Ce);const We=[0,0,0],Se=[0,1,0,0];return r.transformMat4$1(Se,Se,Ce),We[0]=Se[0],We[1]=Se[1],We[2]=Se[2],r.normalize(We,We),We}(J));for(const Ee of _){const je=s.getTile(Ee),Ce=je.getBucket(c);if(!Ce||Ce.projection.name==="mercator"&&ve)continue;const We=y?Ce.text:Ce.icon;if(!We||Ce.fullyClipped||!We.segments.get().length)continue;const Se=We.programConfigurations.get(c.id),Ne=y||Ce.sdfIcons,Xe=y?Ce.textSizeData:Ce.iconSizeData,Ge=Q||J.pitch!==0,Ye=r.evaluateSizeForZoom(Xe,J.zoom);let mt,wt,dt,xt,Bt=[0,0],Lt=null;if(y)wt=je.glyphAtlasTexture,dt=X.LINEAR,mt=je.glyphAtlasTexture.size,Ce.iconsInText&&(Bt=je.imageAtlasTexture.size,Lt=je.imageAtlasTexture,xt=Ge||p.options.rotating||p.options.zooming||Xe.kind==="composite"||Xe.kind==="camera"?X.LINEAR:X.NEAREST);else{const Os=c.layout.get("icon-size").constantOr(0)!==1||Ce.iconsNeedLinear;wt=je.imageAtlasTexture,dt=Ne||p.options.rotating||p.options.zooming||Os||Ge?X.LINEAR:X.NEAREST,mt=je.imageAtlasTexture.size}const _t=Ce.projection.name==="globe",Jt=_t?Ze:Ae,ii=_t?r.globeToMercatorTransition(J.zoom):0,ni=bi(Ee,Ce.getProjection(),J),si=J.calculatePixelsToTileUnitsMatrix(je),pn=Oe(ni,je.tileID.canonical,Q,K,J,Ce.getProjection(),si),nn=p.terrain&&Q&&j?r.invert(r.create(),pn):Pu,Wn=ji(ni,je.tileID.canonical,Q,K,J,Ce.getProjection(),si),ms=_e&&Ce.hasTextData(),wi=c.layout.get("icon-text-fit")!=="none"&&ms&&Ce.hasIconData();if(j){const Os=J.elevation,Qs=Os?Os.getAtTileOffsetFunc(Ee,J.center.lat,J.worldSize,Ce.getProjection()):null,Sr=Is(ni,je.tileID.canonical,Q,K,J,Ce.getProjection(),si);hc(Ce,ni,p,y,Sr,Wn,Q,z,Qs,Ee)}const ri=j||y&&_e||wi,Wt=p.translatePosMatrix(ni,je,b,M),Vi=ri?Pu:pn,xn=p.translatePosMatrix(Wn,je,b,M,!0),mi=Ce.getProjection().createInversionMatrix(J,Ee.canonical),En=[];p.terrainRenderModeElevated()&&Q&&En.push("PITCH_WITH_MAP_TERRAIN"),_t&&En.push("PROJECTION_GLOBE_VIEW"),ri&&En.push("PROJECTED_POS_ON_VIEWPORT");const Tl=Ne&&c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Mr;Mr=Ne?Ce.iconsInText?Cu(Xe.kind,Ye,H,Q,p,Wt,Vi,xn,mt,Bt,Ee,ii,me,mi,Jt,Ce.getProjection()):ol(Xe.kind,Ye,H,Q,p,Wt,Vi,xn,y,mt,!0,Ee,ii,me,mi,Jt,Ce.getProjection()):zc(Xe.kind,Ye,H,Q,p,Wt,Vi,xn,y,mt,Ee,ii,me,mi,Jt,Ce.getProjection());const _a={program:p.useProgram(Fc(Ne,y,Ce),Se,En),buffers:We,uniformValues:Mr,atlasTexture:wt,atlasTextureIcon:Lt,atlasInterpolation:dt,atlasInterpolationIcon:xt,isSDF:Ne,hasHalo:Tl,tile:je,labelPlaneMatrixInv:nn};if(ne&&Ce.canOverlap){se=!0;const Os=We.segments.get();for(const Qs of Os)xe.push({segments:new r.SegmentVector([Qs]),sortKey:Qs.sortKey,state:_a})}else xe.push({segments:We.segments,sortKey:0,state:_a})}se&&xe.sort((Ee,je)=>Ee.sortKey-je.sortKey);for(const Ee of xe){const je=Ee.state;if(p.terrain&&p.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!ve,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),q.activeTexture.set(X.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,X.CLAMP_TO_EDGE),je.atlasTextureIcon&&(q.activeTexture.set(X.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),je.isSDF){const Ce=je.uniformValues;je.hasHalo&&(Ce.u_is_halo=1,ra(je.buffers,Ee.segments,c,p,je.program,fe,D,N,Ce)),Ce.u_is_halo=0}ra(je.buffers,Ee.segments,c,p,je.program,fe,D,N,je.uniformValues)}}function ra(p,s,c,_,y,b,M,S,P){const z=_.context,D=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];y.draw(z,z.gl.TRIANGLES,b,M,S,r.CullFaceMode.disabled,P,c.id,p.layoutVertexBuffer,p.indexBuffer,s,c.paint,_.transform.zoom,p.programConfigurations.get(c.id),D)}function Lu(p,s,c,_,y,b,M){const S=p.context.gl,P=c.paint.get("fill-pattern"),z=P&&P.constantOr(1);let D,N,q,X,J;M?(N=z&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=S.LINES):(N=z?"fillPattern":"fill",D=S.TRIANGLES);for(const K of _){const Q=s.getTile(K);if(z&&!Q.patternsLoaded())continue;const j=Q.getBucket(c);if(!j)continue;p.prepareDrawTile();const H=j.programConfigurations.get(c.id),ne=p.useProgram(N,H);z&&(p.context.activeTexture.set(S.TEXTURE0),Q.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),H.updatePaintBuffers());const se=P.constantOr(null);if(se&&Q.imageAtlas){const me=Q.imageAtlas.patternPositions[se.toString()];me&&H.setConstantPatternPositions(me)}const fe=p.translatePosMatrix(K.projMatrix,Q,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(M){X=j.indexBuffer2,J=j.segments2;const me=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[S.drawingBufferWidth,S.drawingBufferHeight];q=N==="fillOutlinePattern"&&z?Up(fe,p,Q,me):Vp(fe,me)}else X=j.indexBuffer,J=j.segments,q=z?Ic(fe,p,Q):br(fe);p.prepareDrawProgram(p.context,ne,K.toUnwrapped()),ne.draw(p.context,D,y,p.stencilModeForClipping(K),b,r.CullFaceMode.disabled,q,c.id,j.layoutVertexBuffer,X,J,c.paint,p.transform.zoom,H)}}function ll(p,s,c,_,y,b,M){const S=p.context,P=S.gl,z=p.transform,D=c.paint.get("fill-extrusion-pattern"),N=D.constantOr(1),q=c.paint.get("fill-extrusion-opacity"),X=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],J=c.layout.get("fill-extrusion-edge-radius"),K=J>0&&!c.paint.get("fill-extrusion-rounded-roof"),Q=K?0:J,j=z.projection.name==="globe"?r.fillExtrusionHeightLift():0,H=z.projection.name==="globe",ne=H?r.globeToMercatorTransition(z.zoom):0,se=[r.mercatorXfromLng(z.center.lng),r.mercatorYfromLat(z.center.lat)],fe=[];H&&fe.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&fe.push("FAUX_AO"),K&&fe.push("ZERO_ROOF_RADIUS");for(const me of _){const _e=s.getTile(me),ve=_e.getBucket(c);if(!ve||ve.projection.name!==z.projection.name)continue;const xe=ve.programConfigurations.get(c.id),Ae=p.useProgram(N?"fillExtrusionPattern":"fillExtrusion",xe,fe);if(p.terrain){const Ne=p.terrain;if(p.style.terrainSetForDrapingOnly())Ne.setupElevationDraw(_e,Ae,{useMeterToDem:!0});else{if(!ve.enableTerrain)continue;if(Ne.setupElevationDraw(_e,Ae,{useMeterToDem:!0}),Du(S,s,me,ve,c,Ne),!ve.centroidVertexBuffer){const Xe=Ae.attributes.a_centroid_pos;Xe!==void 0&&P.vertexAttrib2f(Xe,0,0)}}}N&&(p.context.activeTexture.set(P.TEXTURE0),_e.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),xe.updatePaintBuffers());const Ze=D.constantOr(null);if(Ze&&_e.imageAtlas){const Ne=_e.imageAtlas.patternPositions[Ze.toString()];Ne&&xe.setConstantPatternPositions(Ne)}const Ee=p.translatePosMatrix(me.projMatrix,_e,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),je=z.projection.createInversionMatrix(z,me.canonical),Ce=c.paint.get("fill-extrusion-vertical-gradient"),We=N?Su(Ee,p,Ce,q,X,Q,me,_e,j,ne,se,je):Ac(Ee,p,Ce,q,X,Q,me,j,ne,se,je);p.prepareDrawProgram(S,Ae,me.toUnwrapped());const Se=[];p.terrain&&Se.push(ve.centroidVertexBuffer),H&&Se.push(ve.layoutVertexExtBuffer),Ae.draw(S,S.gl.TRIANGLES,y,b,M,r.CullFaceMode.backCCW,We,c.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,c.paint,p.transform.zoom,xe,Se)}}function Du(p,s,c,_,y,b){const M=[j=>{let H=j.canonical.x-1,ne=j.wrap;return H<0&&(H=(1<<j.canonical.z)-1,ne--),new r.OverscaledTileID(j.overscaledZ,ne,j.canonical.z,H,j.canonical.y)},j=>{let H=j.canonical.x+1,ne=j.wrap;return H===1<<j.canonical.z&&(H=0,ne++),new r.OverscaledTileID(j.overscaledZ,ne,j.canonical.z,H,j.canonical.y)},j=>new r.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,(j.canonical.y===0?1<<j.canonical.z:j.canonical.y)-1),j=>new r.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y===(1<<j.canonical.z)-1?0:j.canonical.y+1)],S=j=>{const H=s.getSource().minzoom,ne=fe=>{const me=s.getTileByID(fe);if(me&&me.hasData())return me.getBucket(y)},se=[0,-1,1];for(const fe of se){if(j.overscaledZ+fe<H)continue;const me=ne(j.calculateScaledKey(j.overscaledZ+fe));if(me)return me}},P=[0,0,0],z=(j,H)=>(P[0]=Math.min(j.min.y,H.min.y),P[1]=Math.max(j.max.y,H.max.y),P[2]=r.EXTENT-H.min.x>j.max.x?H.min.x-r.EXTENT:j.max.x,P),D=(j,H)=>(P[0]=Math.min(j.min.x,H.min.x),P[1]=Math.max(j.max.x,H.max.x),P[2]=r.EXTENT-H.min.y>j.max.y?H.min.y-r.EXTENT:j.max.y,P),N=[(j,H)=>z(j,H),(j,H)=>z(H,j),(j,H)=>D(j,H),(j,H)=>D(H,j)],q=new r.Point(0,0);let X,J,K;const Q=(j,H,ne,se,fe)=>{const me=[[se?ne:j,se?j:ne,0],[se?ne:H,se?H:ne,0]],_e=fe<0?r.EXTENT+fe:fe,ve=[se?_e:(j+H)/2,se?(j+H)/2:_e,0];return ne===0&&fe<0||ne!==0&&fe>0?b.getForTilePoints(K,[ve],!0,J):me.push(ve),b.getForTilePoints(c,me,!0,X),Math.max(me[0][2],me[1][2],ve[2])/b.exaggeration()};for(let j=0;j<4;j++){const H=(j<2?1:5)-j,ne=_.borders[j];if(ne.length===0)continue;const se=K=M[j](c),fe=S(se);if(!(fe&&fe instanceof r.FillExtrusionBucket&&fe.enableTerrain)||_.borderDoneWithNeighborZ[j]===fe.canonical.z&&fe.borderDoneWithNeighborZ[H]===_.canonical.z||(J=b.findDEMTileFor(se),!J||!J.dem))continue;if(!X){const xe=b.findDEMTileFor(c);if(!xe||!xe.dem)return;X=xe}const me=fe.borders[H];let _e=0;const ve=fe.borderDoneWithNeighborZ[H]!==_.canonical.z;if(_.canonical.z===fe.canonical.z){for(let xe=0;xe<ne.length;xe++){const Ae=_.featuresOnBorder[ne[xe]],Ze=Ae.borders[j];let Ee;for(;_e<me.length&&(Ee=fe.featuresOnBorder[me[_e]],!(Ee.borders[H][1]>Ze[0]+3));)ve&&fe.encodeCentroid(void 0,Ee,!1),_e++;if(Ee&&_e<me.length){const je=_e;let Ce=0;for(;!(Ee.borders[H][0]>Ze[1]-3)&&(Ce++,++_e!==me.length);)Ee=fe.featuresOnBorder[me[_e]];if(Ee=fe.featuresOnBorder[me[je]],Ae.intersectsCount()>1||Ee.intersectsCount()>1||Ce!==1){Ce!==1&&(_e=je),_.encodeCentroid(void 0,Ae,!1),ve&&fe.encodeCentroid(void 0,Ee,!1);continue}const We=N[j](Ae,Ee),Se=j%2?r.EXTENT-1:0;q.x=Q(We[0],Math.min(r.EXTENT-1,We[1]),Se,j<2,We[2]),q.y=0,_.encodeCentroid(q,Ae,!1),ve&&fe.encodeCentroid(q,Ee,!1)}else _.encodeCentroid(void 0,Ae,!1)}_.borderDoneWithNeighborZ[j]=fe.canonical.z,_.needsCentroidUpdate=!0,ve&&(fe.borderDoneWithNeighborZ[H]=_.canonical.z,fe.needsCentroidUpdate=!0)}else{for(const xe of ne)_.encodeCentroid(void 0,_.featuresOnBorder[xe],!1);if(ve){for(const xe of me)fe.encodeCentroid(void 0,fe.featuresOnBorder[xe],!1);fe.borderDoneWithNeighborZ[H]=_.canonical.z,fe.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[j]=fe.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(p)}const io=new r.Color(1,0,0,1),Zp=new r.Color(0,1,0,1),Hp=new r.Color(0,0,1,1),Xp=new r.Color(1,0,1,1),Yp=new r.Color(0,1,1,1);function Kp(p,s,c){const _=p.context,y=p.transform,b=_.gl,M=y.projection.name==="globe",S=M?["PROJECTION_GLOBE_VIEW"]:null;let P=c.projMatrix;if(M&&r.globeToMercatorTransition(y.zoom)>0){const Ae=r.transitionTileAABBinECEF(c.canonical,y),Ze=r.globeDenormalizeECEF(Ae);P=r.multiply(new Float32Array(16),y.globeMatrix,Ze),r.multiply(P,y.projMatrix,P)}const z=p.useProgram("debug",null,S),D=s.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(D,z);const N=r.DepthMode.disabled,q=r.StencilMode.disabled,X=p.colorModeForRenderPass(),J="$debug";_.activeTexture.set(b.TEXTURE0),p.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),M?D._makeGlobeTileDebugBuffers(p.context,y):D._makeDebugTileBoundsBuffers(p.context,y.projection);const K=D._tileDebugBuffer||p.debugBuffer,Q=D._tileDebugIndexBuffer||p.debugIndexBuffer,j=D._tileDebugSegments||p.debugSegments;z.draw(_,b.LINE_STRIP,N,q,X,r.CullFaceMode.disabled,sl(P,r.Color.red),J,K,Q,j,null,null,null,[D._globeTileDebugBorderBuffer]);const H=D.latestRawTileData,ne=Math.floor((H&&H.byteLength||0)/1024),se=s.getTile(c).tileSize,fe=512/Math.min(se,512)*(c.overscaledZ/y.zoom)*.5;let me=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(me+=` => ${c.overscaledZ}`),me+=` ${ne}kb`,function(Ae,Ze){Ae.initDebugOverlayCanvas();const Ee=Ae.debugOverlayCanvas,je=Ae.context.gl,Ce=Ae.debugOverlayCanvas.getContext("2d");Ce.clearRect(0,0,Ee.width,Ee.height),Ce.shadowColor="white",Ce.shadowBlur=2,Ce.lineWidth=1.5,Ce.strokeStyle="white",Ce.textBaseline="top",Ce.font="bold 36px Open Sans, sans-serif",Ce.fillText(Ze,5,5),Ce.strokeText(Ze,5,5),Ae.debugOverlayTexture.update(Ee),Ae.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(p,me);const _e=D._tileDebugTextBuffer||p.debugBuffer,ve=D._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,xe=D._tileDebugTextSegments||p.debugSegments;z.draw(_,b.TRIANGLES,N,q,r.ColorMode.alphaBlended,r.CullFaceMode.disabled,sl(P,r.Color.transparent,fe),J,_e,ve,xe,null,null,null,[D._globeTileDebugTextBuffer])}function zu(p,s,c,_){no(p,0,s+c/2,p.transform.width,c,_)}function cl(p,s,c,_){no(p,s-c/2,0,c,p.transform.height,_)}function no(p,s,c,_,y,b){const M=p.context,S=M.gl;S.enable(S.SCISSOR_TEST),S.scissor(s*r.exported.devicePixelRatio,c*r.exported.devicePixelRatio,_*r.exported.devicePixelRatio,y*r.exported.devicePixelRatio),M.clear({color:b}),S.disable(S.SCISSOR_TEST)}const Ru=r.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ou}=Ru;function zs(p,s,c,_){p.emplaceBack(s,c,_)}class hl{constructor(s){this.vertexArray=new r.StructArrayLayout3f12,this.indices=new r.StructArrayLayout3ui6,zs(this.vertexArray,-1,-1,1),zs(this.vertexArray,1,-1,1),zs(this.vertexArray,-1,1,1),zs(this.vertexArray,1,1,1),zs(this.vertexArray,-1,-1,-1),zs(this.vertexArray,1,-1,-1),zs(this.vertexArray,-1,1,-1),zs(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=s.createVertexBuffer(this.vertexArray,Ou),this.indexBuffer=s.createIndexBuffer(this.indices),this.segment=r.SegmentVector.simpleSegment(0,0,36,12)}}function $n(p,s,c,_,y,b){const M=p.gl,S=s.paint.get("sky-atmosphere-color"),P=s.paint.get("sky-atmosphere-halo-color"),z=s.paint.get("sky-atmosphere-sun-intensity"),D=((N,q,X,J,K)=>({u_matrix_3f:N,u_sun_direction:q,u_sun_intensity:X,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(r.fromMat4(r.create$1(),_),y,z,S,P);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+b,s.skyboxTexture,0),c.draw(p,M.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.frontCW,D,"skyboxCapture",s.skyboxGeometry.vertexBuffer,s.skyboxGeometry.indexBuffer,s.skyboxGeometry.segment)}const oa=r.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Bu{constructor(s){const c=new r.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const _=new r.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=s.createVertexBuffer(c,oa.members),this.indexBuffer=s.createIndexBuffer(_),this.segments=r.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const wr={symbol:function(p,s,c,_,y){if(p.renderPass!=="translucent")return;const b=r.StencilMode.disabled,M=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(S,P,z,D,N,q,X){const J=P.transform,K=N==="map",Q=q==="map";for(const j of S){const H=D.getTile(j),ne=H.getBucket(z);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const se=r.evaluateSizeForZoom(ne.textSizeData,J.zoom),fe=bi(j,ne.getProjection(),J),me=J.calculatePixelsToTileUnitsMatrix(H),_e=Oe(fe,H.tileID.canonical,Q,K,J,ne.getProjection(),me),ve=z.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(se){const xe=Math.pow(2,J.zoom-H.tileID.overscaledZ);Wp(ne,K,Q,X,r.symbolSize,J,_e,j,xe,se,ve)}}}(_,p,c,s,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),c.paint.get("icon-opacity").constantOr(1)!==0&&ku(p,s,c,_,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),b,M),c.paint.get("text-opacity").constantOr(1)!==0&&ku(p,s,c,_,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),b,M),s.map.showCollisionBoxes&&(sa(p,s,c,_,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),sa(p,s,c,_,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,s,c,_){if(p.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),M=c.paint.get("circle-stroke-opacity"),S=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(b.constantOr(1)===0||M.constantOr(1)===0))return;const P=p.context,z=P.gl,D=p.transform,N=p.depthModeForSublayer(0,r.DepthMode.ReadOnly),q=r.StencilMode.disabled,X=p.colorModeForRenderPass(),J=D.projection.name==="globe",K=[r.mercatorXfromLng(D.center.lng),r.mercatorYfromLat(D.center.lat)],Q=[];for(let H=0;H<_.length;H++){const ne=_[H],se=s.getTile(ne),fe=se.getBucket(c);if(!fe||fe.projection.name!==D.projection.name)continue;const me=fe.programConfigurations.get(c.id),_e=Pc(c);J&&_e.push("PROJECTION_GLOBE_VIEW");const ve=p.useProgram("circle",me,_e),xe=fe.layoutVertexBuffer,Ae=fe.globeExtVertexBuffer,Ze=fe.indexBuffer,Ee=D.projection.createInversionMatrix(D,ne.canonical),je={programConfiguration:me,program:ve,layoutVertexBuffer:xe,globeExtVertexBuffer:Ae,indexBuffer:Ze,uniformValues:Cc(p,ne,se,Ee,K,c),tile:se};if(S){const Ce=fe.segments.get();for(const We of Ce)Q.push({segments:new r.SegmentVector([We]),sortKey:We.sortKey,state:je})}else Q.push({segments:fe.segments,sortKey:0,state:je})}S&&Q.sort((H,ne)=>H.sortKey-ne.sortKey);const j={useDepthForOcclusion:!J};for(const H of Q){const{programConfiguration:ne,program:se,layoutVertexBuffer:fe,globeExtVertexBuffer:me,indexBuffer:_e,uniformValues:ve,tile:xe}=H.state,Ae=H.segments;p.terrain&&p.terrain.setupElevationDraw(xe,se,j),p.prepareDrawProgram(P,se,xe.tileID.toUnwrapped()),se.draw(P,z.TRIANGLES,N,q,X,r.CullFaceMode.disabled,ve,c.id,fe,_e,Ae,c.paint,D.zoom,ne,[me])}},heatmap:function(p,s,c,_){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const y=p.context,b=y.gl,M=r.StencilMode.disabled,S=new r.ColorMode([b.ONE,b.ONE],r.Color.transparent,[!0,!0,!0,!0]);(function(X,J,K,Q){const j=X.gl,H=J.width*Q,ne=J.height*Q;X.activeTexture.set(j.TEXTURE1),X.viewport.set([0,0,H,ne]);let se=K.heatmapFbo;if(!se||se&&(se.width!==H||se.height!==ne)){se&&se.destroy();const fe=j.createTexture();j.bindTexture(j.TEXTURE_2D,fe),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),se=K.heatmapFbo=X.createFramebuffer(H,ne,!1),function(me,_e,ve,xe,Ae,Ze){const Ee=me.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,me.isWebGL2&&me.extRenderToTextureHalfFloat?Ee.RGBA16F:Ee.RGBA,Ae,Ze,0,Ee.RGBA,me.extRenderToTextureHalfFloat?me.isWebGL2?Ee.HALF_FLOAT:me.extTextureHalfFloat.HALF_FLOAT_OES:Ee.UNSIGNED_BYTE,null),xe.colorAttachment.set(ve)}(X,0,fe,se,H,ne)}else j.bindTexture(j.TEXTURE_2D,se.colorAttachment.get()),X.bindFramebuffer.set(se.framebuffer)})(y,p,c,p.transform.projection.name==="globe"?.5:.25),y.clear({color:r.Color.transparent});const P=p.transform,z=P.projection.name==="globe",D=z?["PROJECTION_GLOBE_VIEW"]:null,N=z?r.CullFaceMode.frontCCW:r.CullFaceMode.disabled,q=[r.mercatorXfromLng(P.center.lng),r.mercatorYfromLat(P.center.lat)];for(let X=0;X<_.length;X++){const J=_[X];if(s.hasRenderableParent(J))continue;const K=s.getTile(J),Q=K.getBucket(c);if(!Q||Q.projection.name!==P.projection.name)continue;const j=Q.programConfigurations.get(c.id),H=p.useProgram("heatmap",j,D),{zoom:ne}=p.transform;p.terrain&&p.terrain.setupElevationDraw(K,H),p.prepareDrawProgram(y,H,J.toUnwrapped());const se=P.projection.createInversionMatrix(P,J.canonical);H.draw(y,b.TRIANGLES,r.DepthMode.disabled,M,S,N,Iu(p,J,K,se,q,ne,c.paint.get("heatmap-intensity")),c.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,c.paint,p.transform.zoom,j,z?[Q.globeExtVertexBuffer]:null)}y.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(y,b){const M=y.context,S=M.gl,P=b.heatmapFbo;if(!P)return;M.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,P.colorAttachment.get()),M.activeTexture.set(S.TEXTURE1);let z=b.colorRampTexture;z||(z=b.colorRampTexture=new r.Texture(M,b.colorRamp,S.RGBA)),z.bind(S.LINEAR,S.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(M,S.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,y.colorModeForRenderPass(),r.CullFaceMode.disabled,((D,N,q,X)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(p,c))},line:function(p,s,c,_){if(p.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const M=p.depthModeForSublayer(0,r.DepthMode.ReadOnly),S=p.colorModeForRenderPass(),P=p.terrain&&p.terrain.renderingToTexture?1:r.exported.devicePixelRatio,z=c.paint.get("line-dasharray"),D=z.constantOr(1),N=c.layout.get("line-cap"),q=c.paint.get("line-pattern"),X=q.constantOr(1),J=c.paint.get("line-gradient"),K=X?"linePattern":"line",Q=p.context,j=Q.gl,H=(se=>{const fe=[];na(se)&&fe.push("RENDER_LINE_DASH"),se.paint.get("line-gradient")&&fe.push("RENDER_LINE_GRADIENT");const me=se.paint.get("line-trim-offset");me[0]===0&&me[1]===0||fe.push("RENDER_LINE_TRIM_OFFSET");const _e=se.paint.get("line-pattern").constantOr(1),ve=se.paint.get("line-opacity").constantOr(1)!==1;return!_e&&ve&&fe.push("RENDER_LINE_ALPHA_DISCARD"),fe})(c);let ne=H.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const se of _){const fe=s.getTile(se);if(X&&!fe.patternsLoaded())continue;const me=fe.getBucket(c);if(!me)continue;p.prepareDrawTile();const _e=me.programConfigurations.get(c.id),ve=p.useProgram(K,_e,H),xe=q.constantOr(null);if(xe&&fe.imageAtlas){const Ne=fe.imageAtlas.patternPositions[xe.toString()];Ne&&_e.setConstantPatternPositions(Ne)}const Ae=z.constantOr(null),Ze=N.constantOr(null);if(!X&&Ae&&Ze&&fe.lineAtlas){const Ne=fe.lineAtlas.getDash(Ae,Ze);Ne&&_e.setConstantPatternPositions(Ne)}let[Ee,je]=c.paint.get("line-trim-offset");(Ze==="round"||Ze==="square")&&Ee!==je&&(Ee===0&&(Ee-=1),je===1&&(je+=1));const Ce=p.terrain?se.projMatrix:null,We=X?ia(p,fe,c,Ce,P):$p(p,fe,c,Ce,me.lineClipsArray.length,P,[Ee,je]);if(J){const Ne=me.gradients[c.id];let Xe=Ne.texture;if(c.gradientVersion!==Ne.version){let Ge=256;if(c.stepInterpolant){const Ye=s.getSource().maxzoom,mt=se.canonical.z===Ye?Math.ceil(1<<p.transform.maxZoom-se.canonical.z):1;Ge=r.clamp(r.nextPowerOfTwo(me.maxLineLength/r.EXTENT*1024*mt),256,Q.maxTextureSize)}Ne.gradient=r.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ge,image:Ne.gradient||void 0,clips:me.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new r.Texture(Q,Ne.gradient,j.RGBA),Ne.version=c.gradientVersion,Xe=Ne.texture}Q.activeTexture.set(j.TEXTURE1),Xe.bind(c.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}D&&(Q.activeTexture.set(j.TEXTURE0),fe.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),_e.updatePaintBuffers()),X&&(Q.activeTexture.set(j.TEXTURE0),fe.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),_e.updatePaintBuffers()),p.prepareDrawProgram(Q,ve,se.toUnwrapped());const Se=Ne=>{ve.draw(Q,j.TRIANGLES,M,Ne,S,r.CullFaceMode.disabled,We,c.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,c.paint,p.transform.zoom,_e,[me.layoutVertexBuffer2])};if(ne){const Ne=p.stencilModeForClipping(se).ref;Ne===0&&p.terrain&&Q.clear({stencil:0});const Xe={func:j.EQUAL,mask:255};We.u_alpha_discard_threshold=.8,Se(new r.StencilMode(Xe,Ne,255,j.KEEP,j.KEEP,j.INVERT)),We.u_alpha_discard_threshold=0,Se(new r.StencilMode(Xe,Ne,255,j.KEEP,j.KEEP,j.KEEP))}else Se(p.stencilModeForClipping(se))}ne&&(p.resetStencilClippingMasks(),p.terrain&&Q.clear({stencil:0}))},fill:function(p,s,c,_){const y=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const M=p.colorModeForRenderPass(),S=c.paint.get("fill-pattern"),P=p.opaquePassEnabledForLayer()&&!S.constantOr(1)&&y.constantOr(r.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===P){const z=p.depthModeForSublayer(1,p.renderPass==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly);Lu(p,s,c,_,z,M,!1)}if(p.renderPass==="translucent"&&c.paint.get("fill-antialias")){const z=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,r.DepthMode.ReadOnly);Lu(p,s,c,_,z,M,!0)}},"fill-extrusion":function(p,s,c,_){const y=c.paint.get("fill-extrusion-opacity");if(y!==0&&p.renderPass==="translucent"){const b=new r.DepthMode(p.context.gl.LEQUAL,r.DepthMode.ReadWrite,p.depthRangeFor3D);if(y!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))ll(p,s,c,_,b,r.StencilMode.disabled,r.ColorMode.disabled),ll(p,s,c,_,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const M=p.colorModeForRenderPass();ll(p,s,c,_,b,r.StencilMode.disabled,M)}}},hillshade:function(p,s,c,_){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const y=p.context,b=p.depthModeForSublayer(0,r.DepthMode.ReadOnly),M=p.colorModeForRenderPass(),S=p.terrain&&p.terrain.renderingToTexture,[P,z]=p.renderPass!=="translucent"||S?[{},_]:p.stencilConfigForOverlap(_);for(const D of z){const N=s.getTile(D);if(N.needsHillshadePrepare&&p.renderPass==="offscreen")Tu(p,N,c,b,r.StencilMode.disabled,M);else if(p.renderPass==="translucent"){const q=S&&p.terrain?p.terrain.stencilModeForRTTOverlap(D):P[D.overscaledZ];wu(p,D,N,c,b,q,M)}}y.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,s,c,_,y,b){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!_.length)return;const M=p.context,S=M.gl,P=s.getSource(),z=p.useProgram("raster"),D=p.colorModeForRenderPass(),N=p.terrain&&p.terrain.renderingToTexture,[q,X]=P instanceof Pt||N?[{},_]:p.stencilConfigForOverlap(_),J=X[X.length-1].overscaledZ,K=!p.options.moving;for(const Q of X){const j=N?r.DepthMode.disabled:p.depthModeForSublayer(Q.overscaledZ-J,c.paint.get("raster-opacity")===1?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly,S.LESS),H=Q.toUnwrapped(),ne=s.getTile(Q);if(N&&(!ne||!ne.hasData()))continue;const se=N?Q.projMatrix:p.transform.calculateProjMatrix(H,K),fe=p.terrain&&N?p.terrain.stencilModeForRTTOverlap(Q):q[Q.overscaledZ],me=b?0:c.paint.get("raster-fade-duration");ne.registerFadeDuration(me);const _e=s.findLoadedParent(Q,0),ve=Ec(ne,_e,s,p.transform,me);let xe,Ae;p.terrain&&p.terrain.prepareDrawTile();const Ze=c.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;M.activeTexture.set(S.TEXTURE0),ne.texture.bind(Ze,S.CLAMP_TO_EDGE),M.activeTexture.set(S.TEXTURE1),_e?(_e.texture.bind(Ze,S.CLAMP_TO_EDGE),xe=Math.pow(2,_e.tileID.overscaledZ-ne.tileID.overscaledZ),Ae=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Ze,S.CLAMP_TO_EDGE),ne.texture.useMipmap&&M.extTextureFilterAnisotropic&&p.transform.pitch>20&&S.texParameterf(S.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const Ee=Dc(se,Ae||[0,0],xe||1,ve,c,P instanceof Pt?P.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(M,z,H),P instanceof Pt)P.boundsBuffer&&P.boundsSegments&&z.draw(M,S.TRIANGLES,j,r.StencilMode.disabled,D,r.CullFaceMode.disabled,Ee,c.id,P.boundsBuffer,p.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Ce,tileBoundsSegments:We}=p.getTileBoundsBuffers(ne);z.draw(M,S.TRIANGLES,j,fe,D,r.CullFaceMode.disabled,Ee,c.id,je,Ce,We)}}p.resetStencilClippingMasks()},background:function(p,s,c,_){const y=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b===0)return;const M=p.context,S=M.gl,P=p.transform,z=P.tileSize,D=c.paint.get("background-pattern");if(p.isPatternMissing(D))return;const N=!D&&y.a===1&&b===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==N)return;const q=r.StencilMode.disabled,X=p.depthModeForSublayer(0,N==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly),J=p.colorModeForRenderPass(),K=p.useProgram(D?"backgroundPattern":"background");let Q,j=_;j||(Q=p.getBackgroundTiles(),j=Object.values(Q).map(H=>H.tileID)),D&&(M.activeTexture.set(S.TEXTURE0),p.imageManager.bind(p.context));for(const H of j){const ne=H.toUnwrapped(),se=_?H.projMatrix:p.transform.calculateProjMatrix(ne);p.prepareDrawTile();const fe=s?s.getTile(H):Q?Q[H.key]:new r.Tile(H,z,P.zoom,p),me=D?qp(se,b,p,D,{tileID:H,tileSize:z}):Rc(se,b,y);p.prepareDrawProgram(M,K,ne);const{tileBoundsBuffer:_e,tileBoundsIndexBuffer:ve,tileBoundsSegments:xe}=p.getTileBoundsBuffers(fe);K.draw(M,S.TRIANGLES,X,q,J,r.CullFaceMode.disabled,me,c.id,_e,ve,xe)}},sky:function(p,s,c){const _=p.transform,y=_.projection.name==="mercator"||_.projection.name==="globe"?1:r.smoothstep(7,8,_.zoom),b=c.paint.get("sky-opacity")*y;if(b===0)return;const M=p.context,S=c.paint.get("sky-type"),P=new r.DepthMode(M.gl.LEQUAL,r.DepthMode.ReadOnly,[0,1]),z=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(D,N,q,X){const J=D.context,K=J.gl;let Q=N.skyboxFbo;if(!Q){Q=N.skyboxFbo=J.createFramebuffer(32,32,!1),N.skyboxGeometry=new hl(J),N.skyboxTexture=J.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,N.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let se=0;se<6;++se)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(Q.framebuffer),J.viewport.set([0,0,32,32]);const j=N.getCenter(D,!0),H=D.useProgram("skyboxCapture"),ne=new Float64Array(16);r.identity(ne),r.rotateY(ne,ne,.5*-Math.PI),$n(J,N,H,ne,j,0),r.identity(ne),r.rotateY(ne,ne,.5*Math.PI),$n(J,N,H,ne,j,1),r.identity(ne),r.rotateX(ne,ne,.5*-Math.PI),$n(J,N,H,ne,j,2),r.identity(ne),r.rotateX(ne,ne,.5*Math.PI),$n(J,N,H,ne,j,3),r.identity(ne),$n(J,N,H,ne,j,4),r.identity(ne),r.rotateY(ne,ne,Math.PI),$n(J,N,H,ne,j,5),J.viewport.set([0,0,D.width,D.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(D,N,q,X,J){const K=D.context,Q=K.gl,j=D.transform,H=D.useProgram("skybox");K.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,N.skyboxTexture);const ne=((se,fe,me,_e,ve)=>({u_matrix:se,u_sun_direction:fe,u_cubemap:0,u_opacity:_e,u_temporal_offset:ve}))(j.skyboxMatrix,N.getCenter(D,!1),0,X,J);D.prepareDrawProgram(K,H),H.draw(K,Q.TRIANGLES,q,r.StencilMode.disabled,D.colorModeForRenderPass(),r.CullFaceMode.backCW,ne,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,c,P,b,z):S==="gradient"&&p.renderPass==="sky"&&function(D,N,q,X,J){const K=D.context,Q=K.gl,j=D.transform,H=D.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new hl(K)),K.activeTexture.set(Q.TEXTURE0);let ne=N.colorRampTexture;ne||(ne=N.colorRampTexture=new r.Texture(K,N.colorRamp,Q.RGBA)),ne.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const se=((fe,me,_e,ve,xe)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:me,u_radius:r.degToRad(_e),u_opacity:ve,u_temporal_offset:xe}))(j.skyboxMatrix,N.getCenter(D,!1),N.paint.get("sky-gradient-radius"),X,J);D.prepareDrawProgram(K,H),H.draw(K,Q.TRIANGLES,q,r.StencilMode.disabled,D.colorModeForRenderPass(),r.CullFaceMode.backCW,se,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,c,P,b,z)},debug:function(p,s,c){for(let _=0;_<c.length;_++)Kp(p,s,c[_])},custom:function(p,s,c,_){const y=p.context,b=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isLayerDraped()){if(p.renderPass==="offscreen"){const M=b.prerender;if(M){if(p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const S=p.transform.pointMerc;M.call(b,y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(p.transform.zoom),[S.x,S.y],p.transform.pixelsPerMeterRatio)}else M.call(b,y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const S=b.renderToTile;if(S){const P=_[0].canonical,z=new r.MercatorCoordinate(P.x+_[0].wrap*(1<<P.z),P.y,P.z);y.setDepthMode(r.DepthMode.disabled),y.setStencilMode(r.StencilMode.disabled),y.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),S.call(b,y.gl,z),y.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),y.setStencilMode(r.StencilMode.disabled);const M=b.renderingMode==="3d"?new r.DepthMode(p.context.gl.LEQUAL,r.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,r.DepthMode.ReadOnly);if(y.setDepthMode(M),p.transform.projection.name==="globe"){const S=p.transform.pointMerc;b.render(y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(p.transform.zoom),[S.x,S.y],p.transform.pixelsPerMeterRatio)}else b.render(y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState(),y.bindFramebuffer.set(null)}}else r.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class so{constructor(s,c,_=!1){this.context=new tt(s,_),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=r.SourceCache.maxUnderzooming+r.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(s,c){const _=!!s&&!!s.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Sc(this,s));const y=this._terrain;this.transform.elevation=_?y:null,y.update(s,this.transform,c)}_updateFog(s){const c=s.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,y]=c.getFovAdjustedRange(this.transform._fov);if(_>y)return void(this.transform.fogCullDistSq=null);const b=_+.78*(y-_);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(s,c){if(this.width=s*r.exported.devicePixelRatio,this.height=c*r.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const s=this.context,c=new r.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(r.EXTENT,0),c.emplaceBack(0,r.EXTENT),c.emplaceBack(r.EXTENT,r.EXTENT),this.tileExtentBuffer=s.createVertexBuffer(c,r.posAttributes.members),this.tileExtentSegments=r.SegmentVector.simpleSegment(0,0,4,2);const _=new r.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(r.EXTENT,0),_.emplaceBack(0,r.EXTENT),_.emplaceBack(r.EXTENT,r.EXTENT),this.debugBuffer=s.createVertexBuffer(_,r.posAttributes.members),this.debugSegments=r.SegmentVector.simpleSegment(0,0,4,5);const y=new r.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,r.posAttributes.members),this.viewportSegments=r.SegmentVector.simpleSegment(0,0,4,2);const b=new r.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(r.EXTENT,0,r.EXTENT,0),b.emplaceBack(0,r.EXTENT,0,r.EXTENT),b.emplaceBack(r.EXTENT,r.EXTENT,r.EXTENT,r.EXTENT),this.mercatorBoundsBuffer=s.createVertexBuffer(b,r.boundsAttributes.members),this.mercatorBoundsSegments=r.SegmentVector.simpleSegment(0,0,4,2);const M=new r.StructArrayLayout3ui6;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(M);const S=new r.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])S.emplaceBack(z);this.debugIndexBuffer=s.createIndexBuffer(S),this.emptyTexture=new r.Texture(s,new r.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),s.gl.RGBA),this.identityMat=r.create();const P=this.context.gl;this.stencilClearMode=new r.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(r.window.performance.now()),this.atmosphereBuffer=new Bu(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(s){return s._makeTileBoundsBuffers(this.context,this.transform.projection),s._tileBoundsBuffer?{tileBoundsBuffer:s._tileBoundsBuffer,tileBoundsIndexBuffer:s._tileBoundsIndexBuffer,tileBoundsSegments:s._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const s=this.context,c=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(s,c.TRIANGLES,r.DepthMode.disabled,this.stencilClearMode,r.ColorMode.disabled,r.CullFaceMode.disabled,ea(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(s,c,_){if(!c||this.currentStencilSource===c.id||!s.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const P of _)if(this._tileClippingMaskIDs[P.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=c.id;const y=this.context,b=y.gl;this.nextStencilID+_.length>256&&this.clearStencil(),y.setColorMode(r.ColorMode.disabled),y.setDepthMode(r.DepthMode.disabled);const M=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of _){const P=c.getTile(S),z=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:N,tileBoundsSegments:q}=this.getTileBoundsBuffers(P);M.draw(y,b.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,ea(S.projMatrix),"$clipping",D,N,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,c=this.context.gl;return new r.StencilMode({func:c.NOTEQUAL,mask:255},s,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(s){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(s);const c=this.context.gl;return new r.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(s){const c=this.context.gl,_=s.sort((M,S)=>S.overscaledZ-M.overscaledZ),y=_[_.length-1].overscaledZ,b=_[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const M={};for(let S=0;S<b;S++)M[S+y]=new r.StencilMode({func:c.GEQUAL,mask:255},S+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[M,_]}return[{[y]:r.StencilMode.disabled},_]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new r.ColorMode([s.CONSTANT_COLOR,s.ONE],new r.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.ColorMode.unblended:r.ColorMode.alphaBlended}depthModeForSublayer(s,c,_){if(!this.opaquePassEnabledForLayer())return r.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new r.DepthMode(_||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,c){this.style=s,this.options=c,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(r.exported.now()),this.imageManager.beginFrame();const _=this.style.order,y=this.style._sourceCaches;for(const z in y){const D=y[z];D.used&&D.prepare(this.context)}const b={},M={},S={};for(const z in y){const D=y[z];b[z]=D.getVisibleCoordinates(),M[z]=b[z].slice().reverse(),S[z]=D.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<_.length;z++)if(this.style._layers[_[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(S),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.GlobeSharedBuffers(this.context)),!r.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of _){const D=this.style._layers[z],N=s._getLayerSourceCache(D);if(!D.hasOffscreenPass()||D.isHidden(this.transform.zoom))continue;const q=N?M[N.id]:void 0;(D.type==="custom"||D.isSky()||q&&q.length)&&this.renderLayer(this,N,D,q)}this.depthRangeFor3D=[0,1-(s.order.length+2)*this.numSublayers*this.depthEpsilon];const P=this.terrain;if(P&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&P.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?r.Color.black:r.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[_[this.currentLayer]],D=s._getLayerSourceCache(z);if(z.isSky())continue;const N=D?M[D.id]:void 0;this._renderTileClippingMasks(z,D,N),this.renderLayer(this,D,z,N)}if(this.style.fog&&this.transform.projection.supportsFog&&function(z,D){const N=z.context,q=N.gl,X=z.transform,J=new r.DepthMode(q.LEQUAL,r.DepthMode.ReadOnly,[0,1]),K=z.useProgram("globeAtmosphere",null,X.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=r.globeToMercatorTransition(X.zoom),j=D.properties.get("color").toArray01(),H=D.properties.get("high-color").toArray01(),ne=D.properties.get("space-color").toArray01PremultipliedAlpha(),se=r.identity$1([]);r.rotateY$1(se,se,-r.degToRad(X._center.lng)),r.rotateX$1(se,se,r.degToRad(X._center.lat)),r.rotateZ$1(se,se,X.angle),r.rotateX$1(se,se,-X._pitch);const fe=r.fromQuat(new Float32Array(16),se),me=r.mapValue(D.properties.get("star-intensity"),0,1,0,.25),_e=5e-4,ve=r.mapValue(D.properties.get("horizon-blend"),0,1,_e,.25),xe=r.globeUseCustomAntiAliasing(z,N,X)&&ve===_e?X.worldSize/(2*Math.PI*1.025)-1:X.globeRadius,Ae=z.frameCounter/1e3%1,Ze=r.length(X.globeCenterInViewSpace),Ee=Math.sqrt(Math.pow(Ze,2)-Math.pow(xe,2)),je=Math.acos(Ee/Ze),Ce=((Se,Ne,Xe,Ge,Ye,mt,wt,dt,xt,Bt,Lt,_t,Jt,ii)=>({u_frustum_tl:Se,u_frustum_tr:Ne,u_frustum_br:Xe,u_frustum_bl:Ge,u_horizon:Ye,u_transition:mt,u_fadeout_range:wt,u_color:dt,u_high_color:xt,u_space_color:Bt,u_star_intensity:Lt,u_star_size:5*r.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:_t,u_horizon_angle:Jt,u_rotation_matrix:ii}))(X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.frustumCorners.horizon,Q,ve,j,H,ne,me,Ae,je,fe);z.prepareDrawProgram(N,K);const We=z.atmosphereBuffer;We&&K.draw(N,q.TRIANGLES,J,r.StencilMode.disabled,r.ColorMode.alphaBlended,r.CullFaceMode.backCW,Ce,"skybox",We.vertexBuffer,We.indexBuffer,We.segments)}(this,this.style.fog),this.renderPass="sky",(r.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const z=this.style._layers[_[this.currentLayer]],D=s._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,D,z,D?M[D.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const z=this.style._layers[_[this.currentLayer]],D=s._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=D?(z.type==="symbol"?S:M)[D.id]:void 0;this._renderTileClippingMasks(z,D,D?b[D.id]:void 0),this.renderLayer(this,D,z,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let z=null;r.values(this.style._layers).forEach(D=>{const N=s._getLayerSourceCache(D);N&&!D.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<N.getSource().maxzoom)&&(z=N)}),z&&this.options.showTileBoundaries&&wr.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const D=z.transform.padding;zu(z,z.transform.height-(D.top||0),3,io),zu(z,D.bottom||0,3,Zp),cl(z,D.left||0,3,Hp),cl(z,z.transform.width-(D.right||0),3,Xp);const N=z.transform.centerPoint;(function(q,X,J,K){no(q,X-1,J-10,2,20,K),no(q,X-10,J-1,20,2,K)})(z,N.x,z.transform.height-N.y,Yp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(r.window.performance.now()),this.saveCanvasCopy())}renderLayer(s,c,_,y){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||y&&y.length)&&(this.id=_.id,this.gpuTimingStart(_),(!s.transform.projection.unsupportedLayers||!s.transform.projection.unsupportedLayers.includes(_.type)||s.terrain&&_.type==="custom")&&wr[_.type](s,c,_,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(s){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let _=this.gpuTimers[s.id];_||(_=this.gpuTimers[s.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),_.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const s=this.context.extTimerQuery,c=s.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),s.beginQueryEXT(s.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;s.endQueryEXT(s.TIME_ELAPSED_EXT)}collectGpuTimers(){const s=this.gpuTimers;return this.gpuTimers={},s}collectDeferredRenderGpuQueries(){const s=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],s}queryGpuTimers(s){const c={};for(const _ in s){const y=s[_],b=this.context.extTimerQuery,M=b.getQueryObjectEXT(y.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(y.query),c[_]=M}return c}queryGpuTimeDeferredRender(s){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let _=0;for(const y of s)_+=c.getQueryObjectEXT(y,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(y);return _}translatePosMatrix(s,c,_,y,b){if(!_[0]&&!_[1])return s;const M=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(M){const z=Math.sin(M),D=Math.cos(M);_=[_[0]*D-_[1]*z,_[0]*z+_[1]*D]}const S=[b?_[0]:ki(c,_[0],this.transform.zoom),b?_[1]:ki(c,_[1],this.transform.zoom),0],P=new Float32Array(16);return r.translate(P,s,S),P}saveTileTexture(s){const c=this._tileTextures[s.size[0]];c?c.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const c=this._tileTextures[s];return c&&c.length>0?c.pop():null}isPatternMissing(s){return s===null||s!==void 0&&!this.imageManager.getPattern(s.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const s=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&this.terrain.exaggeration()===0,_=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),this.transform.projection.name==="globe"&&y.push("GLOBE"),c&&y.push("ZERO_EXAGGERATION"),_&&!s&&_.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),s&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(s,c,_){this.cache=this.cache||{};const y=_||[],b=this.currentGlobalDefines().concat(y),M=Ut.cacheKey(vc[s],s,b,c);return this.cache[M]||(this.cache[M]=new Ut(this.context,s,vc[s],c,Oc[s],b)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=r.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(s,c,_){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const b=y.getOpacity(this.transform.pitch),M=((S,P,z,D,N,q,X,J,K,Q,j)=>{const H=S.transform,ne=P.properties.get("color").toArray01();ne[3]=D;const se=S.frameCounter/1e3%1;return{u_fog_matrix:z?H.calculateFogTileMatrix(z):S.identityMat,u_fog_range:P.getFovAdjustedRange(H._fov),u_fog_color:ne,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:se,u_frustum_tl:N,u_frustum_tr:q,u_frustum_br:X,u_frustum_bl:J,u_globe_pos:K,u_globe_radius:Q,u_viewport:j,u_globe_transition:r.globeToMercatorTransition(H.zoom),u_is_globe:+(H.projection.name==="globe")}})(this,y,_,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.exported.devicePixelRatio,this.transform.height*r.exported.devicePixelRatio]);c.setFogUniformValues(s,M)}}setTileLoadedFlag(s){this.tileLoaded=s}saveCanvasCopy(){const s=this.canvasCopy();s&&(this.frameCopies.push(s),this.tileLoaded=!1)}canvasCopy(){const s=this.context.gl,c=s.createTexture();return s.bindTexture(s.TEXTURE_2D,c),s.copyTexImage2D(s.TEXTURE_2D,0,s.RGBA,0,0,s.drawingBufferWidth,s.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const s=this.style&&this.style.fog;return!!s&&s.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const s=this._backgroundTiles,c=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const y of _)c[y.key]=s[y.key]||new r.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class ul{constructor(s=0,c=0,_=0,y=0){if(isNaN(s)||s<0||isNaN(c)||c<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=c,this.left=_,this.right=y}interpolate(s,c,_){return c.top!=null&&s.top!=null&&(this.top=r.number(s.top,c.top,_)),c.bottom!=null&&s.bottom!=null&&(this.bottom=r.number(s.bottom,c.bottom,_)),c.left!=null&&s.left!=null&&(this.left=r.number(s.left,c.left,_)),c.right!=null&&s.right!=null&&(this.right=r.number(s.right,c.right,_)),this}getCenter(s,c){const _=r.clamp((this.left+s-this.right)/2,0,s),y=r.clamp((this.top+c-this.bottom)/2,0,c);return new r.Point(_,y)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new ul(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function dl(p,s){const c=r.getColumn(p,3);r.fromQuat(p,s),r.setColumn(p,3,c)}function $t(p,s){const c=r.identity$1([]);return r.rotateZ$1(c,c,-s),r.rotateX$1(c,c,-p),c}function aa(p,s){const c=[p[0],p[1],0],_=[s[0],s[1],0];if(r.length(c)>=1e-15){const M=r.normalize([],c);r.scale$2(_,M,r.dot(_,M)),s[0]=_[0],s[1]=_[1]}const y=r.cross([],s,p);if(r.len(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return $t(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class Fu{constructor(s,c){this.position=s,this.orientation=c}get position(){return this._position}set position(s){if(s){const c=s instanceof r.MercatorCoordinate?s:new r.MercatorCoordinate(s[0],s[1],s[2]);this._renderWorldCopies&&(c.x=r.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(s,c){if(this.orientation=null,!this.position)return;const _=this.position,y=this._elevation?this._elevation.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(s)):0,b=r.MercatorCoordinate.fromLngLat(s,y),M=[b.x-_.x,b.y-_.y,b.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=aa(M,c)}setPitchBearing(s,c){this.orientation=$t(r.degToRad(s),r.degToRad(-c))}}class pl{constructor(s,c){this._transform=r.identity([]),this.orientation=c,this.position=s}get mercatorPosition(){const s=this.position;return new r.MercatorCoordinate(s[0],s[1],s[2])}get position(){const s=r.getColumn(this._transform,3);return[s[0],s[1],s[2]]}set position(s){var c;s&&r.setColumn(this._transform,3,[(c=s)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(s){this._orientation=s||r.identity$1([]),s&&dl(this._transform,this._orientation)}getPitchBearing(){const s=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(s[0]*s[0]+s[1]*s[1]),-s[2])}}setPitchBearing(s,c){this._orientation=$t(s,c),dl(this._transform,this._orientation)}forward(){const s=r.getColumn(this._transform,2);return[-s[0],-s[1],-s[2]]}up(){const s=r.getColumn(this._transform,1);return[-s[0],-s[1],-s[2]]}right(){const s=r.getColumn(this._transform,0);return[s[0],s[1],s[2]]}getCameraToWorld(s,c){const _=new Float64Array(16);return r.invert(_,this.getWorldToCamera(s,c)),_}getWorldToCameraPosition(s,c,_){const y=this.position;r.scale$2(y,y,-s);const b=new Float64Array(16);return r.fromScaling(b,[_,_,_]),r.translate(b,b,y),b[10]*=c,b}getWorldToCamera(s,c){const _=new Float64Array(16),y=new Float64Array(4),b=this.position;return r.conjugate(y,this._orientation),r.scale$2(b,b,-s),r.fromQuat(_,y),r.translate(_,_,b),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=c,_[9]*=c,_[10]*=c,_[11]*=c,_}getCameraToClipPerspective(s,c,_,y){const b=new Float64Array(16);return r.perspective(b,s,c,_,y),b}getDistanceToElevation(s,c=!1){const _=s===0?0:r.mercatorZfromAltitude(s,c?r.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(_-this.position[2])/y[2]}clone(){return new pl([...this.position],[...this.orientation])}}function ro(p,s){const c=fl(p.projection,p.zoom,p.width,p.height),_=function(b,M,S,P,z){const D=new r.LngLat(S.lng-180*Rs,S.lat),N=new r.LngLat(S.lng+180*Rs,S.lat),q=b.project(D.lng,D.lat),X=b.project(N.lng,N.lat),J=-Math.atan2(X.y-q.y,X.x-q.x),K=r.MercatorCoordinate.fromLngLat(S);K.y=r.clamp(K.y,-1+Rs,1-Rs);const Q=K.toLngLat(),j=b.project(Q.lng,Q.lat),H=r.MercatorCoordinate.fromLngLat(Q);H.x+=Rs;const ne=H.toLngLat(),se=b.project(ne.lng,ne.lat),fe=_l(se.x-j.x,se.y-j.y,J),me=r.MercatorCoordinate.fromLngLat(Q);me.y+=Rs;const _e=me.toLngLat(),ve=b.project(_e.lng,_e.lat),xe=_l(ve.x-j.x,ve.y-j.y,J),Ae=Math.abs(fe.x)/Math.abs(xe.y),Ze=r.identity([]);r.rotateZ(Ze,Ze,-J*(1-(z?0:P)));const Ee=r.identity([]);return r.scale(Ee,Ee,[1,1-(1-Ae)*P,1]),Ee[4]=-xe.x/xe.y*P,r.rotateZ(Ee,Ee,J),r.multiply(Ee,Ze,Ee),Ee}(p.projection,0,p.center,c,s),y=Nu(p);return r.scale(_,_,[y,y,1]),_}function Nu(p){const s=p.projection,c=fl(p.projection,p.zoom,p.width,p.height),_=ju(s,p.center),y=ju(s,r.LngLat.convert(s.center));return Math.pow(2,_*c+(1-c)*y)}function fl(p,s,c,_,y=1/0){const b=p.range;if(!b)return 0;const M=Math.min(y,Math.max(c,_)),S=Math.log(M/1024)/Math.LN2;return r.smoothstep(b[0]+S,b[1]+S,s)}const Rs=1/4e4;function ju(p,s){const c=r.clamp(s.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),_=new r.LngLat(s.lng-180*Rs,c),y=new r.LngLat(s.lng+180*Rs,c),b=p.project(_.lng,c),M=p.project(y.lng,c),S=r.MercatorCoordinate.fromLngLat(_),P=r.MercatorCoordinate.fromLngLat(y),z=M.x-b.x,D=M.y-b.y,N=P.x-S.x,q=P.y-S.y,X=Math.sqrt((N*N+q*q)/(z*z+D*D));return Math.log(X)/Math.LN2}function _l(p,s,c){const _=Math.cos(c),y=Math.sin(c);return{x:p*_-s*y,y:p*y+s*_}}class oo{constructor(s,c,_,y,b,M,S){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=s||0,this._maxZoom=c||22,this._minPitch=_??0,this._maxPitch=y??60,this.setProjection(M),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new r.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ul,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new pl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const s=new oo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return s._elevation=this._elevation,s._centerAltitude=this._centerAltitude,s._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,s.tileSize=this.tileSize,s.mercatorFromTransition=this.mercatorFromTransition,s.width=this.width,s.height=this.height,s.cameraElevationReference=this.cameraElevationReference,s._center=this._center,s._setZoom(this.zoom),s._seaLevelZoom=this._seaLevelZoom,s.angle=this.angle,s._fov=this._fov,s._pitch=this._pitch,s._nearZ=this._nearZ,s._farZ=this._farZ,s._averageElevation=this._averageElevation,s._unmodified=this._unmodified,s._edgeInsets=this._edgeInsets.clone(),s._camera=this._camera.clone(),s._calcMatrices(),s.freezeTileCoverage=this.freezeTileCoverage,s.frustumCorners=this.frustumCorners,s}get elevation(){return this._elevation}set elevation(s){this._elevation!==s&&(this._elevation=s,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(s,c=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(s||_)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.pick(this.projection,["name","center","parallels"])}setProjection(s){this.projectionOptions=s||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=r.getProjection(this.projectionOptions);const _=!T(c,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const s=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.getProjection({name:"mercator"});const c=s!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get cameraWorldSize(){const s=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(s))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.Point(this.width,this.height)}get bearing(){return r.wrap(this.rotation,-180,180)}set bearing(s){this.rotation=s}get rotation(){return-this.angle/Math.PI*180}set rotation(s){const c=-s*Math.PI/180;var _;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(_=new r.ARRAY_TYPE(4),r.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(y,b,M){var S=b[0],P=b[1],z=b[2],D=b[3],N=Math.sin(M),q=Math.cos(M);y[0]=S*q+z*N,y[1]=P*q+D*N,y[2]=S*-N+z*q,y[3]=P*-N+D*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const c=r.clamp(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const s=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/s)}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=r.degToRad(s),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(s){this._averageElevation=s,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(s){const c=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(s){this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const s=this._elevation;this._centerAltitude=s.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=s.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const s=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let y=0,b=0;for(let M=0;M<c.length;M++){const S=new r.Point(c[M][0]*this.width,_+c[M][1]*(this.height-_)),P=s.pointCoordinate(S);if(!P)continue;const z=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);y+=P[3]*z,b+=z}return b===0?NaN:y/b}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const s=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(s),b=this._mercatorZfromZoom(this._maxZoom),M=Math.max(y-_,b);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}computeZoomRelativeTo(s){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,s.toAltitude()));let _;_=s.z<this._camera.position[2]?[c.x,c.y,c.z]:[s.x,s.y,s.z];const y=r.length(r.sub([],this._camera.position,_));return r.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(s){if(!this.height||!s.position&&!s.orientation)return;this._updateCameraState();let c=!1;if(s.orientation&&!r.exactEquals(s.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(s.orientation)),s.position){const _=[s.position.x,s.position.y,s.position.z];r.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const s=this._camera.position,c=new Fu;return c.position=new r.MercatorCoordinate(s[0],s[1],s[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(s){if(!r.length$1(s))return!1;r.normalize$1(s,s);const c=r.transformQuat([],[0,0,-1],s),_=r.transformQuat([],[0,-1,0],s);if(_[2]<0)return!1;const y=aa(c,_);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(s){const c=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;s[2]=r.clamp(s[2],y/_,y/c),this._camera.position=s}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,c,_){this._unmodified=!1,this._edgeInsets.interpolate(s,c,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const c=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(s){const c=[new r.UnwrappedTileID(0,s)];if(this.renderWorldCopies){const _=this.pointCoordinate(new r.Point(0,0)),y=this.pointCoordinate(new r.Point(this.width,0)),b=this.pointCoordinate(new r.Point(this.width,this.height)),M=this.pointCoordinate(new r.Point(0,this.height)),S=Math.floor(Math.min(_.x,y.x,b.x,M.x)),P=Math.floor(Math.max(_.x,y.x,b.x,M.x)),z=1;for(let D=S-z;D<=P+z;D++)D!==0&&c.push(new r.UnwrappedTileID(D,s))}return c}coveringTiles(s){let c=this.coveringZoomLevel(s);const _=c,y=this.elevation&&!s.isTerrainDEM,b=this.projection.name==="mercator";if(s.minzoom!==void 0&&c<s.minzoom)return[];s.maxzoom!==void 0&&c>s.maxzoom&&(c=s.maxzoom);const M=this.locationCoordinate(this.center),S=this.center.lat,P=1<<c,z=[P*M.x,P*M.y,0],D=this.projection.name==="globe",N=!D,q=r.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,N),X=D?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=P*r.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/r.mercatorZfromAltitude(1,this.center.lat),Q=[P*X.x,P*X.y,K*(N?1:J)],j=this.cameraToCenterDistance/s.tileSize*(s.roundZoom?1:.502),H=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ne=s.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,se=s.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?Nu(this):1,me=Se=>{const Xe=new r.MercatorCoordinate(Se.x+25e-6,Se.y,Se.z),Ge=new r.MercatorCoordinate(Se.x,Se.y+25e-6,Se.z),Ye=Se.toLngLat(),mt=Xe.toLngLat(),wt=Ge.toLngLat(),dt=this.locationCoordinate(Ye),xt=this.locationCoordinate(mt),Bt=this.locationCoordinate(wt),Lt=Math.hypot(xt.x-dt.x,xt.y-dt.y),_t=Math.hypot(Bt.x-dt.x,Bt.y-dt.y);return Math.sqrt(Lt*_t)*fe/25e-6},_e=Se=>{const Ne=ne,Xe=se;return{aabb:r.tileAABB(this,P,0,0,0,Se,Xe,Ne,this.projection),zoom:0,x:0,y:0,minZ:Xe,maxZ:Ne,wrap:Se,fullyVisible:!1}},ve=[];let xe=[];const Ae=c,Ze=s.reparseOverscaled?_:c,Ee=Se=>Se*Se,je=Ee((K-this._centerAltitude)*J),Ce=Se=>{if(!this._elevation||!Se.tileID||!b)return;const Ne=this._elevation.getMinMaxForTile(Se.tileID),Xe=Se.aabb;Ne?(Xe.min[2]=Ne.min,Xe.max[2]=Ne.max,Xe.center[2]=(Xe.min[2]+Xe.max[2])/2):(Se.shouldSplit=We(Se),Se.shouldSplit||(Xe.min[2]=Xe.max[2]=Xe.center[2]=this._centerAltitude))},We=Se=>{if(Se.zoom<H)return!0;if(Se.zoom===Ae)return!1;if(Se.shouldSplit!=null)return Se.shouldSplit;const Ne=Se.aabb.distanceX(Q),Xe=Se.aabb.distanceY(Q);let Ge=je,Ye=1;if(D){Ge=Ee(Se.aabb.distanceZ(Q));const dt=Math.pow(2,Se.zoom),xt=r.latFromMercatorY((Se.y+1)/dt),Bt=r.latFromMercatorY(Se.y/dt),Lt=Math.min(Math.max(S,xt),Bt),_t=r.circumferenceAtLatitude(Lt)/r.circumferenceAtLatitude(S);if(Ye=Lt===S?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_t/this._mercatorScaleRatio),this.zoom<=r.GLOBE_ZOOM_THRESHOLD_MIN&&Se.zoom===Ae-1&&_t>=.9)return!0}else if(y&&(Ge=Ee(Se.aabb.distanceZ(Q)*J)),this.projection.isReprojectedInTileSpace&&_<=5){const dt=Math.pow(2,Se.zoom),xt=me(new r.MercatorCoordinate((Se.x+.5)/dt,(Se.y+.5)/dt));Ye=xt>.85?1:xt}const mt=Ne*Ne+Xe*Xe+Ge,wt=Ee((1<<Ae-Se.zoom)*j*Ye*((dt,xt)=>{if(xt*Ee(.707)<dt)return 1;const Bt=Math.sqrt(xt/dt);return Bt/(1.4144271570014144+(Math.pow(1.1,Bt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ge,je),mt));return mt<wt};if(this.renderWorldCopies)for(let Se=1;Se<=3;Se++)ve.push(_e(-Se)),ve.push(_e(Se));for(ve.push(_e(0));ve.length>0;){const Se=ve.pop(),Ne=Se.x,Xe=Se.y;let Ge=Se.fullyVisible;if(!Ge){const Ye=Se.aabb.intersects(q);if(Ye===0)continue;Ge=Ye===2}if(Se.zoom!==Ae&&We(Se))for(let Ye=0;Ye<4;Ye++){const mt=(Ne<<1)+Ye%2,wt=(Xe<<1)+(Ye>>1),dt={aabb:b?Se.aabb.quadrant(Ye):r.tileAABB(this,P,Se.zoom+1,mt,wt,Se.wrap,Se.minZ,Se.maxZ,this.projection),zoom:Se.zoom+1,x:mt,y:wt,wrap:Se.wrap,fullyVisible:Ge,tileID:void 0,shouldSplit:void 0,minZ:Se.minZ,maxZ:Se.maxZ};y&&!D&&(dt.tileID=new r.OverscaledTileID(Se.zoom+1===Ae?Ze:Se.zoom+1,Se.wrap,Se.zoom+1,mt,wt),Ce(dt)),ve.push(dt)}else{const Ye=Se.zoom===Ae?Ze:Se.zoom;if(s.minzoom&&s.minzoom>Ye)continue;const mt=z[0]-(.5+Ne+(Se.wrap<<Se.zoom))*(1<<c-Se.zoom),wt=z[1]-.5-Xe,dt=Se.tileID?Se.tileID:new r.OverscaledTileID(Ye,Se.wrap,Se.zoom,Ne,Xe);xe.push({tileID:dt,distanceSq:mt*mt+wt*wt})}}if(this.fogCullDistSq){const Se=this.fogCullDistSq,Ne=this.horizonLineFromTop();xe=xe.filter(Xe=>{const Ge=[0,0,0,1],Ye=[r.EXTENT,r.EXTENT,0,1],mt=this.calculateFogTileMatrix(Xe.tileID.toUnwrapped());r.transformMat4$1(Ge,Ge,mt),r.transformMat4$1(Ye,Ye,mt);const wt=r.getAABBPointSquareDist(Ge,Ye);if(wt===0)return!0;let dt=!1;const xt=this._elevation;if(xt&&wt>Se&&Ne!==0){const Bt=this.calculateProjMatrix(Xe.tileID.toUnwrapped());let Lt;s.isTerrainDEM||(Lt=xt.getMinMaxForTile(Xe.tileID)),Lt||(Lt={min:se,max:ne});const _t=r.furthestTileCorner(this.rotation),Jt=[_t[0]*r.EXTENT,_t[1]*r.EXTENT,Lt.max];r.transformMat4(Jt,Jt,Bt),dt=(1-Jt[1])*this.height*.5<Ne}return wt<Se||dt})}return xe.sort((Se,Ne)=>Se.distanceSq-Ne.distanceSq).map(Se=>Se.tileID)}resize(s,c){this.width=s,this.height=c,this.pixelsToGLUnits=[2/s,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const c=r.clamp(s.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),_=this.projection.project(s.lng,c);return new r.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(s){return this.projection.unproject(s.x/this.worldSize,s.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(s,c){let _,y;const b=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;_=(c.x-b.x)/S,y=(c.y-b.y)/S}else{const S=this.pointCoordinate(c),P=this.pointCoordinate(b);_=S.x-P.x,y=S.y-P.y}const M=this.locationCoordinate(s);this.setLocation(new r.MercatorCoordinate(M.x-_,M.y-y))}setLocation(s){this.center=this.coordinateLocation(s),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(s){return this.projection.locationPoint(this,s)}locationPoint3D(s){return this.projection.locationPoint(this,s,!0)}pointLocation(s){return this.coordinateLocation(this.pointCoordinate(s))}pointLocation3D(s){return this.coordinateLocation(this.pointCoordinate3D(s))}locationCoordinate(s,c){const _=c?r.mercatorZfromAltitude(c,s.lat):void 0,y=this.projection.project(s.lng,s.lat);return new r.MercatorCoordinate(y.x,y.y,_)}coordinateLocation(s){return this.projection.unproject(s.x,s.y)}pointRayIntersection(s,c){const _=c??this._centerAltitude,y=[s.x,s.y,0,1],b=[s.x,s.y,1,1];r.transformMat4$1(y,y,this.pixelMatrixInverse),r.transformMat4$1(b,b,this.pixelMatrixInverse);const M=b[3];r.scale$1(y,y,1/y[3]),r.scale$1(b,b,1/M);const S=y[2],P=b[2];return{p0:y,p1:b,t:S===P?0:(_-S)/(P-S)}}screenPointToMercatorRay(s){const c=[s.x,s.y,0,1],_=[s.x,s.y,1,1];return r.transformMat4$1(c,c,this.pixelMatrixInverse),r.transformMat4$1(_,_,this.pixelMatrixInverse),r.scale$1(c,c,1/c[3]),r.scale$1(_,_,1/_[3]),c[2]=r.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,_[2]=r.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,r.scale$1(c,c,1/this.worldSize),r.scale$1(_,_,1/this.worldSize),new r.Ray([c[0],c[1],c[2]],r.normalize([],r.sub([],_,c)))}rayIntersectionCoordinate(s){const{p0:c,p1:_,t:y}=s,b=r.mercatorZfromAltitude(c[2],this._center.lat),M=r.mercatorZfromAltitude(_[2],this._center.lat);return new r.MercatorCoordinate(r.number(c[0],_[0],y)/this.worldSize,r.number(c[1],_[1],y)/this.worldSize,r.number(b,M,y))}pointCoordinate(s,c=this._centerAltitude){return this.projection.pointCoordinate(this,s.x,s.y,c)}pointCoordinate3D(s){if(!this.elevation)return this.pointCoordinate(s);let c=this.projection.pointCoordinate3D(this,s.x,s.y);if(c)return new r.MercatorCoordinate(c[0],c[1],c[2]);let _=0,y=this.horizonLineFromTop();if(s.y>y)return this.pointCoordinate(s);const b=.02*y,M=s.clone();for(let S=0;S<10&&y-_>b;S++){M.y=r.number(_,y,.66);const P=this.projection.pointCoordinate3D(this,M.x,M.y);P?(y=M.y,c=P):_=M.y}return c?new r.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(s)}isPointAboveHorizon(s){return this.projection.isPointAboveHorizon(this,s)}isPointOnSurface(s){if(s.y<0||s.y>this.height||s.x<0||s.x>this.width)return!1;if(this.elevation||this.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(s);const c=this.pointCoordinate(s);return c.y>=0&&c.y<=1}_coordinatePoint(s,c){const _=c&&this.elevation?this.elevation.getAtPointOrZero(s,this._centerAltitude):this._centerAltitude,y=[s.x*this.worldSize,s.y*this.worldSize,_+s.toAltitude(),1];return r.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new r.Point(y[0]/y[3],y[1]/y[3]):new r.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:s,left:c}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.Point(c,s)),M=this.pointLocation3D(new r.Point(y,s)),S=this.pointLocation3D(new r.Point(y,_)),P=this.pointLocation3D(new r.Point(c,_));let z=Math.min(b.lng,M.lng,S.lng,P.lng),D=Math.max(b.lng,M.lng,S.lng,P.lng),N=Math.min(b.lat,M.lat,S.lat,P.lat),q=Math.max(b.lat,M.lat,S.lat,P.lat);const X=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,K=(Q,j,H,ne,se)=>{const fe=(Q+H)/2,me=(j+ne)/2,_e=new r.Point(fe,me),{lng:ve,lat:xe}=this.pointLocation3D(_e),Ae=Math.max(0,z-ve,N-xe,ve-D,xe-q);z=Math.min(z,ve),D=Math.max(D,ve),N=Math.min(N,xe),q=Math.max(q,xe),(se<J||Ae>X)&&(K(Q,j,fe,me,se+1),K(fe,me,H,ne,se+1))};if(K(c,s,y,s,1),K(y,s,y,_,1),K(y,_,c,_,1),K(c,_,c,s,1),this.projection.name==="globe"){const[Q,j]=r.polesInViewport(this);Q?(q=90,D=180,z=-180):j&&(N=-90,D=180,z=-180)}return new r.LngLatBounds(new r.LngLat(z,N),new r.LngLat(D,q))}_getBoundsRectangular(s,c){const{top:_,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,S=new r.Point(y,_),P=new r.Point(M,_),z=new r.Point(M,b),D=new r.Point(y,b);let N=this.pointCoordinate(S,s),q=this.pointCoordinate(P,s);const X=this.pointCoordinate(z,c),J=this.pointCoordinate(D,c),K=(Q,j)=>(j.y-Q.y)/(j.x-Q.x);return N.y>1&&q.y>=0?N=new r.MercatorCoordinate((1-J.y)/K(J,N)+J.x,1):N.y<0&&q.y<=1&&(N=new r.MercatorCoordinate(-J.y/K(J,N)+J.x,0)),q.y>1&&N.y>=0?q=new r.MercatorCoordinate((1-X.y)/K(X,q)+X.x,1):q.y<0&&N.y<=1&&(q=new r.MercatorCoordinate(-X.y/K(X,q)+X.x,0)),new r.LngLatBounds().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){const s=this.elevation;if(!s.visibleDemTiles.length||s.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=s.visibleDemTiles.reduce((_,y)=>{if(y.dem){const b=y.dem.tree;_.min=Math.min(_.min,b.minimums[0]),_.max=Math.max(_.max,b.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*s.exaggeration(),c.max*s.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(s=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-c*(1-this._horizonShift);return s?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(s){this.maxBounds=s,this.minLat=-r.MAX_MERCATOR_LATITUDE,this.maxLat=r.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,s&&(this.minLat=s.getSouth(),this.maxLat=s.getNorth(),this.minLng=s.getWest(),this.maxLng=s.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=r.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=r.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=r.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(s,c){return this.projection.createTileMatrix(this,c,s)}calculateDistanceTileData(s){const c=s.key,_=this._distanceTileDataCache;if(_[c])return _[c];const y=s.canonical,b=1/this.height,M=this.cameraWorldSize,S=M/this.zoomScale(y.z),P=(y.x+Math.pow(2,y.z)*s.wrap)*S,z=y.y*S,D=this.point;D.x*=M/this.worldSize,D.y*=M/this.worldSize;const N=this.angle,q=Math.sin(-N),X=-Math.cos(-N);return _[c]={bearing:[q,X],center:[(D.x-P)*b,(D.y-z)*b],scale:S/r.EXTENT*b},_[c]}calculateFogTileMatrix(s){const c=s.key,_=this._fogTileMatrixCache;if(_[c])return _[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,s);return r.multiply(y,this.worldToFogMatrix,y),_[c]=new Float32Array(y),_[c]}calculateProjMatrix(s,c=!1){const _=s.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[_])return y[_];const b=this.calculatePosMatrix(s,this.worldSize);return r.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,b),y[_]=new Float32Array(b),y[_]}calculatePixelsToTileUnitsMatrix(s){const c=s.tileID.key,_=this._pixelsToTileUnitsCache;if(_[c])return _[c];const y=function(b,M){const{scale:S}=b.tileTransform,P=S*r.EXTENT/(b.tileSize*Math.pow(2,M.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return z=new Float32Array(4),q=(D=M.inverseAdjustmentMatrix)[1],X=D[2],J=D[3],Q=(N=[P,P])[1],z[0]=D[0]*(K=N[0]),z[1]=q*K,z[2]=X*Q,z[3]=J*Q,z;var z,D,N,q,X,J,K,Q}(s,this);return _[c]=y,_[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const s=1/this.worldSize,c=r.fromScaling([],[s,s,s]);return r.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const s=this._elevation;this._updateCameraState();const c=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(c),y=this._camera.forward(),b=r.mercatorZfromAltitude(1,this._center.lat);_[2]/=b,y[2]/=b,r.normalize(y,y);const M=s.raycast(_,y,s.exaggeration());if(M){const S=r.scaleAndAdd([],_,y,M),P=new r.MercatorCoordinate(S[0],S[1],r.mercatorZfromAltitude(S[2],r.latFromMercatorY(S[1]))),z=(P.z+r.length([P.x-_[0],P.y-_[1],P.z-_[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(s=!1){if(!this._elevation)return;const c=this._elevation,_=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(_),b=c.getAtPointOrZero(new r.MercatorCoordinate(...y)),M=this.pixelsPerMeter/this.worldSize*b,S=this._minimumHeightOverTerrain(),P=y[2]-M;if(P<=S)if(P<0||s){const z=this.locationCoordinate(this._center,this._centerAltitude),D=[y[0],y[1],z.z-y[2]],N=r.length(D);D[2]-=(S-P)/this._pixelsPerMercatorPixel;const q=r.length(D);if(q===0)return;r.scale$2(D,D,N/q*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],z.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||s){const q=this.center;return q.lat=r.clamp(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!s)&&(q.lng=r.clamp(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const c=this._unmodified,{x:_,y}=this.point;let b=0,M=_,S=y;const P=this.width/2,z=this.height/2,D=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(y-z<D&&(S=D+z),y+z>N&&(S=N-z),N-D<this.height&&(b=Math.max(b,this.height/(N-D)),S=(N+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,J=this.worldSize/2-(q+X)/2;M=(_+J+this.worldSize)%this.worldSize-J,M-P<q&&(M=q+P),M+P>X&&(M=X-P),X-q<this.width&&(b=Math.max(b,this.width/(X-q)),M=(X+q)/2)}M===_&&S===y||(this.center=this.unproject(new r.Point(M,S))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let s=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(s=Math.max(s,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),s}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.mercatorZfromAltitude(1,this.center.lat)/r.mercatorZfromAltitude(1,r.GLOBE_SCALE_MATCH_LATITUDE));const _=fl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?c:1,b=this._camera.getWorldToCamera(this.worldSize,y),M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);M[8]=2*-s.x/this.width,M[9]=2*s.y/this.height;let S=r.mul([],M,b);if(this.projection.isReprojectedInTileSpace){const me=this.locationCoordinate(this.center),_e=r.identity([]);r.translate(_e,_e,[me.x*this.worldSize,me.y*this.worldSize,0]),r.multiply(_e,_e,ro(this)),r.translate(_e,_e,[-me.x*this.worldSize,-me.y*this.worldSize,0]),r.multiply(S,S,_e),this.inverseAdjustmentMatrix=function(ve){const xe=ro(ve,!0);return De([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=r.scale([],S,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=S,this.invProjMatrix=r.invert(new Float64Array(16),this.projMatrix);const P=r.invert([],M);this.frustumCorners=r.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const z=new Float32Array(16);r.identity(z),r.scale(z,z,[1,-1,1]),r.rotateX(z,z,this._pitch),r.rotateZ(z,z,this.angle);const D=r.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),N=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;D[8]=2*-s.x/this.width,D[9]=2*(s.y+N)/this.height,this.skyboxMatrix=r.multiply(z,D,z);const q=this.point,X=q.x,J=q.y,K=this.width%2/2,Q=this.height%2/2,j=Math.cos(this.angle),H=Math.sin(this.angle),ne=X-Math.round(X)+j*K+H*Q,se=J-Math.round(J)+j*Q+H*K,fe=new Float64Array(S);if(r.translate(fe,fe,[ne>.5?ne-1:ne,se>.5?se-1:se,0]),this.alignedProjMatrix=fe,S=r.create(),r.scale(S,S,[this.width/2,-this.height/2,1]),r.translate(S,S,[1,-1,0]),this.labelPlaneMatrix=S,S=r.create(),r.scale(S,S,[1,-1,1]),r.translate(S,S,[-1,-1,0]),r.scale(S,S,[2/this.width,2/this.height,1]),this.glCoordMatrix=S,this.pixelMatrix=r.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},S=r.invert(new Float64Array(16),this.pixelMatrix),!S)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=S,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.calculateGlobeMatrix(this);const me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.transformMat4(me,me,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=S;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const s=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,_=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[s,s,c];r.scale$2(b,b,y),r.scale$2(_,_,-1),r.multiply$2(_,_,b);const M=r.create();r.translate(M,M,_),r.scale(M,M,b),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(s,c,y)}_computeCameraPosition(s){const c=(s=s||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-s/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-_[0]*b,y.y/this.worldSize-_[1]*b,s/this.worldSize*this._centerAltitude-_[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(s){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],y=s[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((c-_)/y,1)),this._camera.position=r.scaleAndAdd([],this._camera.position,s,b),this._updateStateFromCamera()}_updateStateFromCamera(){const s=this._camera.position,c=this._camera.forward(),{pitch:_,bearing:y}=this._camera.getPitchBearing(),b=r.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.degToRad(this._maxPitch)),S=Math.max((s[2]-b)/Math.cos(_),M),P=this._zoomFromMercatorZ(S);r.scaleAndAdd(s,s,c,S),this._pitch=r.clamp(_,r.degToRad(this.minPitch),r.degToRad(this.maxPitch)),this.angle=r.wrap(y,-Math.PI,Math.PI),this._setZoom(r.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.MercatorCoordinate(s[0],s[1],s[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(s){return Math.pow(2,s)*this.tileSize}_mercatorZfromZoom(s){return this.cameraToCenterDistance/this._worldSizeFromZoom(s)}_minimumHeightOverTerrain(){const s=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(s)}_zoomFromMercatorZ(s){return this.scaleZoom(this.cameraToCenterDistance/(s*this.tileSize))}zoomFromMercatorZAdjusted(s){let c=0,_=r.GLOBE_ZOOM_THRESHOLD_MAX,y=0,b=1/0;for(;_-c>1e-6&&_>c;){const M=c+.5*(_-c),S=this.tileSize*Math.pow(2,M),P=this.getCameraToCenterDistance(this.projection,M,S),z=this.scaleZoom(P/(s*this.tileSize)),D=Math.abs(M-z);D<b&&(b=D,y=M),M<z?c=M:_=M}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(s,c){const _=Math.min(s.x,c.x),y=Math.max(s.x,c.x),b=Math.min(s.y,c.y),M=Math.max(s.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new r.Point(_,b),new r.Point(y,M),new r.Point(_,M),new r.Point(y,b)],P=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const D of S){const N=this.pointRayIntersection(D);if(N.t<0)return!0;const q=this.rayIntersectionCoordinate(N);if(q.x<P||q.y<0||q.x>z||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.Point(0,0),new r.Point(this.width,this.height))}zoomDeltaToMovement(s,c){const _=r.length(r.sub([],this._camera.position,s)),y=this._zoomFromMercatorZ(_)+c;return _-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const s=function([c,_,y],b){const M=[c,_,y,1];r.transformMat4$1(M,M,b);const S=M[3]=Math.max(M[3],1e-6);return M[0]/=S,M[1]/=S,M[2]/=S,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.Point(s[0],s[1])}{const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.Point(0,s))}}getCameraToCenterDistance(s,c=this.zoom,_=this.worldSize){const y=fl(s,c,this.width,this.height,1024),b=s.pixelSpaceConversion(this.center.lat,_,y);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const s=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.multiply(s,s,this.globeMatrix),s}}function ao(p,s){let c=!1,_=null;const y=()=>{_=null,c&&(p(),_=setTimeout(y,s),c=!1)};return()=>(c=!0,_||y(),_)}class Nc{constructor(s){this._hashName=s&&encodeURIComponent(s),r.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ao(this._updateHashUnthrottled.bind(this),300)}addTo(s){return this._map=s,r.window.addEventListener("hashchange",this._onHashChange,!1),s.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),r.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const s=this._map;if(!s)return"";const c=la(s);if(this._hashName){const _=this._hashName;let y=!1;const b=r.window.location.hash.slice(1).split("&").map(M=>{const S=M.split("=")[0];return S===_?(y=!0,`${S}=${c}`):M}).filter(M=>M);return y||b.push(`${_}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){const s=r.window.location.hash.replace("#","");if(this._hashName){let c;return s.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(c=_)}),(c&&c[1]||"").split("/")}return s.split("/")}_onHashChange(){const s=this._map;if(!s)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(_=>isNaN(_))){const _=s.dragRotate.isEnabled()&&s.touchZoomRotate.isEnabled()?+(c[3]||0):s.getBearing();return s.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:_,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const s=r.window.location.href.replace(/(#.+)?$/,this.getHashString());r.window.history.replaceState(r.window.history.state,null,s)}}function la(p,s){const c=p.getCenter(),_=Math.round(100*p.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),M=Math.round(c.lng*b)/b,S=Math.round(c.lat*b)/b,P=p.getBearing(),z=p.getPitch();let D=s?`/${M}/${S}/${_}`:`${_}/${S}/${M}`;return(P||z)&&(D+="/"+Math.round(10*P)/10),z&&(D+=`/${Math.round(z)}`),D}const ca={linearity:.3,easing:r.bezier(0,0,.3,1)},ml=r.extend({deceleration:2500,maxSpeed:1400},ca),gl=r.extend({deceleration:20,maxSpeed:1400},ca),ht=r.extend({deceleration:1e3,maxSpeed:360},ca),ts=r.extend({deceleration:1e3,maxSpeed:90},ca);class Vu{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.exported.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,c=r.exported.now();for(;s.length>0&&c-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new r.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const b=ua(c.pan.mag(),_,r.extend({},ml,s||{}));y.offset=c.pan.mult(b.amount/c.pan.mag()),y.center=this._map.transform.center,ha(y,b)}if(c.zoom){const b=ua(c.zoom,_,gl);y.zoom=this._map.transform.zoom+b.amount,ha(y,b)}if(c.bearing){const b=ua(c.bearing,_,ht);y.bearing=this._map.transform.bearing+r.clamp(b.amount,-179,179),ha(y,b)}if(c.pitch){const b=ua(c.pitch,_,ts);y.pitch=this._map.transform.pitch+b.amount,ha(y,b)}if(y.zoom||y.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function ha(p,s){(!p.duration||p.duration<s.duration)&&(p.duration=s.duration,p.easing=s.easing)}function ua(p,s,c){const{maxSpeed:_,linearity:y,deceleration:b}=c,M=r.clamp(p*y/(s/1e3),-_,_),S=Math.abs(M)/(b*y);return{easing:c.easing,duration:1e3*S,amount:M*(S/2)}}class tn extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,_,y={}){const b=Re(c.getCanvasContainer(),_),M=c.unproject(b);super(s,r.extend({point:b,lngLat:M,originalEvent:_},y)),this._defaultPrevented=!1,this.target=c}}class da extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,_){const y=s==="touchend"?_.changedTouches:_.touches,b=Je(c.getCanvasContainer(),y),M=b.map(P=>c.unproject(P)),S=b.reduce((P,z,D,N)=>P.add(z.div(N.length)),new r.Point(0,0));super(s,{points:b,point:S,lngLats:M,lngLat:c.unproject(S),originalEvent:_}),this._defaultPrevented=!1}}class yl extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,c,_){super(s,{originalEvent:_}),this._defaultPrevented=!1}}class jc{constructor(s,c){this._map=s,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(s){return this._firePreventable(new yl(s.type,this._map,s))}mousedown(s,c){return this._mousedownPos=c,this._firePreventable(new tn(s.type,this._map,s))}mouseup(s){this._map.fire(new tn(s.type,this._map,s))}preclick(s){const c=r.extend({},s);c.type="preclick",this._map.fire(new tn(c.type,this._map,c))}click(s,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(s),this._map.fire(new tn(s.type,this._map,s)))}dblclick(s){return this._firePreventable(new tn(s.type,this._map,s))}mouseover(s){this._map.fire(new tn(s.type,this._map,s))}mouseout(s){this._map.fire(new tn(s.type,this._map,s))}touchstart(s){return this._firePreventable(new da(s.type,this._map,s))}touchmove(s){this._map.fire(new da(s.type,this._map,s))}touchend(s){this._map.fire(new da(s.type,this._map,s))}touchcancel(s){this._map.fire(new da(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class xl{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(s){this._map.fire(new tn(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._map.fire(new tn(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Uu{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,c){this.isEnabled()&&s.shiftKey&&s.button===0&&(be(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(s,c){if(!this._active)return;const _=c,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(_)||!this._box&&_.dist(y)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",s));const M=Math.min(y.x,_.x),S=Math.max(y.x,_.x),P=Math.min(y.y,_.y),z=Math.max(y.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${P}px)`,this._box.style.width=S-M+"px",this._box.style.height=z-P+"px")})}mouseupWindow(s,c){if(!this._active)return;const _=this._startPos,y=c;if(_&&s.button===0){if(this.reset(),qe(),_.x!==y.x||_.y!==y.y)return this._map.fire(new r.Event("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(_,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",s)}}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Le(),delete this._startPos,delete this._lastPos}_fireEvent(s,c){return this._map.fire(new r.Event(s,{originalEvent:c}))}}function vl(p,s){const c={};for(let _=0;_<p.length;_++)c[p[_].identifier]=s[_];return c}class lo{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(s,c,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=s.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const b=new r.Point(0,0);for(const M of y)b._add(M);return b.div(y.length)}(c),this.touches=vl(_,c)))}touchmove(s,c,_){if(this.aborted||!this.centroid)return;const y=vl(_,c);for(const b in this.touches){const M=y[b];(!M||M.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(s,c,_){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Vc{constructor(s){this.singleTap=new lo(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(s,c,_){this.singleTap.touchstart(s,c,_)}touchmove(s,c,_){this.singleTap.touchmove(s,c,_)}touchend(s,c,_){const y=this.singleTap.touchend(s,c,_);if(y){const b=s.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(y)<30;if(b&&M||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Jp{constructor(){this._zoomIn=new Vc({numTouches:1,numTaps:2}),this._zoomOut=new Vc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,c,_){this._zoomIn.touchstart(s,c,_),this._zoomOut.touchstart(s,c,_)}touchmove(s,c,_){this._zoomIn.touchmove(s,c,_),this._zoomOut.touchmove(s,c,_)}touchend(s,c,_){const y=this._zoomIn.touchend(s,c,_),b=this._zoomOut.touchend(s,c,_);return y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(y)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Gu={0:1,2:2};class co{constructor(s){this.reset(),this._clickTolerance=s.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(s,c){return!1}_move(s,c){return{}}mousedown(s,c){if(this._lastPoint)return;const _=nt(s);this._correctButton(s,_)&&(this._lastPoint=c,this._eventButton=_)}mousemoveWindow(s,c){const _=this._lastPoint;if(_){if(s.preventDefault(),this._eventButton!=null&&function(y,b){const M=Gu[b];return y.buttons===void 0||(y.buttons&M)!==M}(s,this._eventButton))this.reset();else if(this._moved||!(c.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(_,c)}}mouseupWindow(s){this._lastPoint&&nt(s)===this._eventButton&&(this._moved&&qe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Uc extends co{mousedown(s,c){super.mousedown(s,c),this._lastPoint&&(this._active=!0)}_correctButton(s,c){return c===0&&!s.ctrlKey}_move(s,c){return{around:c,panDelta:c.sub(s)}}}class Gc extends co{_correctButton(s,c){return c===0&&s.ctrlKey||c===2}_move(s,c){const _=.8*(c.x-s.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(s){s.preventDefault()}}class $c extends co{_correctButton(s,c){return c===0&&s.ctrlKey||c===2}_move(s,c){const _=-.5*(c.y-s.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(s){s.preventDefault()}}class bl{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.Point(0,0)}touchstart(s,c,_){return this._calculateTransform(s,c,_)}touchmove(s,c,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!r.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return s.cancelable&&s.preventDefault(),this._calculateTransform(s,c,_)}}touchend(s,c,_){this._calculateTransform(s,c,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,c,_){_.length>0&&(this._active=!0);const y=vl(_,c),b=new r.Point(0,0),M=new r.Point(0,0);let S=0;for(const z in y){const D=y[z],N=this._touches[z];N&&(b._add(D),M._add(D.sub(N)),S++,y[z]=D)}if(this._touches=y,S<this._minTouches||!M.mag())return;const P=M.div(S);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(S),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class pa{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(s){}_move(s,c,_){return{}}touchstart(s,c,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([c[0],c[1]]))}touchmove(s,c,_){const y=this._firstTwoTouches;if(!y)return;s.preventDefault();const[b,M]=y,S=fa(_,c,b),P=fa(_,c,M);if(!S||!P)return;const z=this._aroundCenter?null:S.add(P).div(2);return this._move([S,P],z,s)}touchend(s,c,_){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,M=fa(_,c,y),S=fa(_,c,b);M&&S||(this._active&&qe(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fa(p,s,c){for(let _=0;_<p.length;_++)if(p[_].identifier===c)return s[_]}function qc(p,s){return Math.log(p/s)/Math.LN2}class $u extends pa{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,c){const _=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(qc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qc(this._distance,_),pinchAround:c}}}function Wc(p,s){return 180*p.angleWith(s)/Math.PI}class qu extends pa{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,c){const _=this._vector;if(this._vector=s[0].sub(s[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Wc(this._vector,_),pinchAround:c}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const c=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const y=Wc(s,_);return Math.abs(y)<c}}function Js(p){return Math.abs(p.y)>Math.abs(p.x)}class Wu extends pa{constructor(s){super(),this._map=s}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(s){this._lastPoints=s,Js(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,c,_){const y=this._lastPoints;if(!y)return;const b=s[0].sub(y[0]),M=s[1].sub(y[1]);return this._map._cooperativeGestures&&!r.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(b,M,_.timeStamp),!this._valid)?void 0:(this._lastPoints=s,this._active=!0,{pitchDelta:(b.y+M.y)/2*-.5})}gestureBeginsVertically(s,c,_){if(this._valid!==void 0)return this._valid;const y=s.mag()>=2,b=c.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const M=s.y>0==c.y>0;return Js(s)&&Js(c)&&M}}const Zu={panStep:100,bearingStep:15,pitchStep:10};class Qp{constructor(){const s=Zu;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let c=0,_=0,y=0,b=0,M=0;switch(s.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:s.shiftKey?_=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?_=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?y=1:(s.preventDefault(),M=-1);break;case 40:s.shiftKey?y=-1:(s.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:S=>{const P=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:Hu,zoom:c?Math.round(P)+c*(s.shiftKey?2:1):P,bearing:S.getBearing()+_*this._bearingStep,pitch:S.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-M*this._panStep],center:S.getCenter()},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hu(p){return p*(2-p)}const Zc=4.000244140625;class Xu{constructor(s,c){this._map=s,this._el=s.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,r.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(s){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(s.ctrlKey||s.metaKey||this.isZooming()||r.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=s.deltaMode===r.window.WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const _=r.exported.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,c!==0&&c%Zc==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),s.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=s,this._delta-=c,this._active||this._start(s)),s.preventDefault()}_onTimeout(s){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(s)}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Re(this._el,s);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._map.transform;this._type==="wheel"&&s.projection.wrap&&(s._center.lng>=180||s._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>s._terrainEnabled()&&this._aroundCoord?s.computeZoomRelativeTo(this._aroundCoord):s.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Zc?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&z!==0&&(z=1/z);const D=c(),N=Math.pow(2,D),q=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(q*z))),this._type==="wheel"&&(this._startZoom=D,this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,b=this._easing;let M,S=!1;if(this._type==="wheel"&&y&&b){const P=Math.min((r.exported.now()-this._lastWheelEventTime)/200,1),z=b(P);M=r.number(y,_,z),P<1?this._frameId||(this._frameId=!0):S=!0}else M=_,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:M-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let c=r.ease;if(this._prevEase){const _=this._prevEase,y=(r.exported.now()-_.start)/_.duration,b=_.easing(y+.01)-_.easing(y),M=.27/Math.sqrt(b*b+1e-4)*.01,S=Math.sqrt(.0729-M*M);c=r.bezier(M,S,.25,1)}return this._prevEase={start:r.exported.now(),duration:s,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(r.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Yu{constructor(s,c){this._clickZoom=s,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(s,c){return s.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(s.shiftKey?-1:1),around:_.unproject(c)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ef{constructor(){this._tap=new Vc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(s,c,_){this._swipePoint||(this._tapTime&&s.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=c[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(s,c,_))}touchmove(s,c,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=c[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,c,_)}touchend(s,c,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(s,c,_)&&(this._tapTime=s.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ku{constructor(s,c,_){this._el=s,this._mousePan=c,this._touchPan=_}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class tf{constructor(s,c,_){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=c,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class nf{constructor(s,c,_,y){this._el=s,this._touchZoom=c,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qn=p=>p.zoom||p.drag||p.pitch||p.rotate;class Ju extends r.Event{}class sf{constructor(){this.constants=[1,1,.01],this.radius=0}setup(s,c){const _=r.sub([],c,s);this.radius=r.length(_[2]<0?r.div([],_,this.constants):[_[0],_[1],0])}projectRay(s){r.div(s,s,this.constants),r.normalize(s,s),r.mul$1(s,s,this.constants);const c=r.scale$2([],s,this.radius);if(c[2]>0){const _=r.scale$2([],[0,0,1],r.dot(c,[0,0,1])),y=r.scale$2([],r.normalize([],[c[0],c[1],0]),this.radius),b=r.add([],c,r.scale$2([],r.sub([],r.add([],y,_),c),2));c[0]=b[0],c[1]=b[1]}return c}}function is(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class _s{constructor(s,c){this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vu(s),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new sf,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[r.window.document,"mousemove",{capture:!0}],[r.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[r.window,"blur",void 0]];for(const[y,b,M]of this._listeners)y.addEventListener(b,y===r.window.document?this.handleWindowEvent:this.handleEvent,M)}destroy(){for(const[s,c,_]of this._listeners)s.removeEventListener(c,s===r.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(s){const c=this._map,_=c.getCanvasContainer();this._add("mapEvent",new jc(c,s));const y=c.boxZoom=new Uu(c,s);this._add("boxZoom",y);const b=new Jp,M=new dn;c.doubleClickZoom=new Yu(M,b),this._add("tapZoom",b),this._add("clickZoom",M);const S=new ef;this._add("tapDragZoom",S);const P=c.touchPitch=new Wu(c);this._add("touchPitch",P);const z=new Gc(s),D=new $c(s);c.dragRotate=new tf(s,z,D),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const N=new Uc(s),q=new bl(c,s);c.dragPan=new Ku(_,N,q),this._add("mousePan",N),this._add("touchPan",q,["touchZoom","touchRotate"]);const X=new qu,J=new $u;c.touchZoomRotate=new nf(_,J,X,S),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new xl(c));const K=c.scrollZoom=new Xu(c,this);this._add("scrollZoom",K,["mousePan"]);const Q=c.keyboard=new Qp;this._add("keyboard",Q);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])s.interactive&&s[j]&&c[j].enable(s[j])}_add(s,c,_){this._handlers.push({handlerName:s,handler:c,allowed:_}),this._handlersById[s]=c}stop(s){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(s,c,_){for(const y in s)if(y!==_&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(s){this.handleEvent(s,`${s.type}Window`)}_getMapTouches(s){const c=[];for(const _ of s)this._el.contains(_.target)&&c.push(_);return c}handleEvent(s,c){this._updatingCamera=!0;const _=s.type==="renderFrame",y=_?void 0:s,b={needsRenderFrame:!1},M={},S={},P=s.touches?this._getMapTouches(s.touches):void 0,z=P?Je(this._el,P):_?void 0:Re(this._el,s);for(const{handlerName:q,handler:X,allowed:J}of this._handlers){if(!X.isEnabled())continue;let K;this._blockedByActive(S,J,q)?X.reset():X[c||s.type]&&(K=X[c||s.type](s,z,P),this.mergeHandlerResult(b,M,K,q,y),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||X.isActive())&&(S[q]=X)}const D={};for(const q in this._previousActiveHandlers)S[q]||(D[q]=y);this._previousActiveHandlers=S,(Object.keys(D).length||is(b))&&(this._changes.push([b,M,D]),this._triggerRenderFrame()),(Object.keys(S).length||is(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(s,c,_,y,b){if(!_)return;r.extend(s,_);const M={handlerName:y,originalEvent:_.originalEvent||b};_.zoomDelta!==void 0&&(c.zoom=M),_.panDelta!==void 0&&(c.drag=M),_.pitchDelta!==void 0&&(c.pitch=M),_.bearingDelta!==void 0&&(c.rotate=M)}_applyChanges(){const s={},c={},_={};for(const[y,b,M]of this._changes)y.panDelta&&(s.panDelta=(s.panDelta||new r.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(s.around=y.around),y.aroundCoord!==void 0&&(s.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(s.pinchAround=y.pinchAround),y.noInertia&&(s.noInertia=y.noInertia),r.extend(c,b),r.extend(_,M);this._updateMapTransform(s,c,_),this._changes=[]}_updateMapTransform(s,c,_){const y=this._map,b=y.transform,M=H=>[H.x,H.y,H.z];if((H=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!is(s)){const H=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",H!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!is(s))return void this._fireEvents(c,_,!0);let{panDelta:S,zoomDelta:P,bearingDelta:z,pitchDelta:D,around:N,aroundCoord:q,pinchAround:X}=s;b._isCameraConstrained&&(P>0&&(P=0),b._isCameraConstrained=!1),X!==void 0&&(N=X),(P||(H=>c[H]&&!this._eventsInProgress[H])("drag"))&&N&&(this._dragOrigin=M(b.pointCoordinate3D(N)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),N=N||y.transform.centerPoint,z&&(b.bearing+=z),D&&(b.pitch+=D),b._updateCameraState();const J=[0,0,0];if(S)if(b.projection.name==="mercator"){const H=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N).dir),ne=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N.sub(S)).dir);J[0]=ne[0]-H[0],J[1]=ne[1]-H[1]}else{const H=b.pointCoordinate(N);if(b.projection.name==="globe"){S=S.rotate(-b.angle);const ne=b._pixelsPerMercatorPixel/b.worldSize;J[0]=-S.x*r.mercatorScale(r.latFromMercatorY(H.y))*ne,J[1]=-S.y*r.mercatorScale(b.center.lat)*ne}else{const ne=b.pointCoordinate(N.sub(S));H&&ne&&(J[0]=ne.x-H.x,J[1]=ne.y-H.y)}}const K=b.zoom,Q=[0,0,0];if(P){const H=M(q||b.pointCoordinate3D(N)),ne={dir:r.normalize([],r.sub([],H,b._camera.position))};if(ne.dir[2]<0){const se=b.zoomDeltaToMovement(H,P);r.scale$2(Q,ne.dir,se)}}const j=r.add(J,J,Q);b._translateCameraConstrained(j),P&&Math.abs(b.zoom-K)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(c,_,!0)}_fireEvents(s,c,_){const y=qn(this._eventsInProgress),b=qn(s),M={};for(const D in s){const{originalEvent:N}=s[D];this._eventsInProgress[D]||(M[`${D}start`]=N),this._eventsInProgress[D]=s[D]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const D in M)this._fireEvent(D,M[D]);b&&this._fireEvent("move",b.originalEvent);for(const D in s){const{originalEvent:N}=s[D];this._fireEvent(D,N)}const S={};let P;for(const D in this._eventsInProgress){const{handlerName:N,originalEvent:q}=this._eventsInProgress[D];this._handlersById[N].isActive()||(delete this._eventsInProgress[D],P=c[N]||q,S[`${D}end`]=P)}for(const D in S)this._fireEvent(D,S[D]);const z=qn(this._eventsInProgress);if(_&&(y||b)&&!z){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;D?(N(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:P})):(this._map.fire(new r.Event("moveend",{originalEvent:P})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(s,c){this._map.fire(new r.Event(s,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{this._frameId=void 0,this.handleEvent(new Ju("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Tr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class wl extends r.Evented{constructor(s,c){super(),this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,r.bindAll(["_renderFrameCallback"],this)}getCenter(){return new r.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(s,c){return this.jumpTo({center:s},c)}panBy(s,c,_){return s=r.Point.convert(s).mult(-1),this.panTo(this.transform.center,r.extend({offset:s},c),_)}panTo(s,c,_){return this.easeTo(r.extend({center:s},c),_)}getZoom(){return this.transform.zoom}setZoom(s,c){return this.jumpTo({zoom:s},c),this}zoomTo(s,c,_){return this.easeTo(r.extend({zoom:s},c),_)}zoomIn(s,c){return this.zoomTo(this.getZoom()+1,s,c),this}zoomOut(s,c){return this.zoomTo(this.getZoom()-1,s,c),this}getBearing(){return this.transform.bearing}setBearing(s,c){return this.jumpTo({bearing:s},c),this}getPadding(){return this.transform.padding}setPadding(s,c){return this.jumpTo({padding:s},c),this}rotateTo(s,c,_){return this.easeTo(r.extend({bearing:s},c),_)}resetNorth(s,c){return this.rotateTo(0,r.extend({duration:1e3},s),c),this}resetNorthPitch(s,c){return this.easeTo(r.extend({bearing:0,pitch:0,duration:1e3},s),c),this}snapToNorth(s,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,c):this}getPitch(){return this.transform.pitch}setPitch(s,c){return this.jumpTo({pitch:s},c),this}cameraForBounds(s,c){s=r.LngLatBounds.convert(s);const _=c&&c.bearing||0,y=c&&c.pitch||0,b=s.getNorthWest(),M=s.getSouthEast();return this._cameraForBounds(this.transform,b,M,_,y,c)}_extendCameraOptions(s){const c={top:0,bottom:0,right:0,left:0};if(typeof(s=r.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},s)).padding=="number"){const _=s.padding;s.padding={top:_,bottom:_,right:_,left:_}}return s.padding=r.extend(c,s.padding),s}_minimumAABBFrustumDistance(s,c){const _=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return _/y>s.aspect?_/(2*Math.tan(.5*s.fovX)*s.aspect):y/(2*Math.tan(.5*s.fovY)*s.aspect)}_cameraForBoundsOnGlobe(s,c,_,y,b,M){const S=s.clone(),P=this._extendCameraOptions(M);S.bearing=y,S.pitch=b;const z=r.LngLat.convert(c),D=r.LngLat.convert(_),N=.5*(z.lat+D.lat),q=.5*(z.lng+D.lng),X=r.latLngToECEF(N,q),J=r.normalize([],X),K=r.normalize([],r.cross([],J,[0,1,0])),Q=r.cross([],K,J),j=[K[0],K[1],K[2],0,Q[0],Q[1],Q[2],0,J[0],J[1],J[2],0,0,0,0,1],H=[X,r.latLngToECEF(z.lat,z.lng),r.latLngToECEF(D.lat,z.lng),r.latLngToECEF(D.lat,D.lng),r.latLngToECEF(z.lat,D.lng),r.latLngToECEF(N,z.lng),r.latLngToECEF(N,D.lng),r.latLngToECEF(z.lat,q),r.latLngToECEF(D.lat,q)];let ne=r.Aabb.fromPoints(H.map(Ge=>[r.dot(K,Ge),r.dot(Q,Ge),r.dot(J,Ge)]));const se=r.transformMat4([],ne.center,j);r.squaredLength(se)===0&&r.set(se,0,0,1),r.normalize(se,se),r.scale$2(se,se,r.GLOBE_RADIUS),S.center=r.ecefToLatLng(se);const fe=S.getWorldToCameraMatrix(),me=r.invert(new Float64Array(16),fe);ne=r.Aabb.applyTransform(ne,r.multiply([],fe,j)),r.transformMat4(se,se,fe);const _e=.5*(ne.max[2]-ne.min[2]),ve=this._minimumAABBFrustumDistance(S,ne),xe=r.scale$2([],[0,0,1],_e),Ae=r.add(xe,se,xe),Ze=ve+(S.pitch===0?0:r.distance(se,Ae)),Ee=S.globeCenterInViewSpace,je=r.sub([],se,[Ee[0],Ee[1],Ee[2]]);r.normalize(je,je),r.scale$2(je,je,Ze);const Ce=r.add([],se,je);r.transformMat4(Ce,Ce,me);const We=r.earthRadius/r.GLOBE_RADIUS,Se=r.length(Ce),Ne=r.mercatorZfromAltitude(Math.max(Se*We-r.earthRadius,Number.EPSILON),0),Xe=Math.min(S.zoomFromMercatorZAdjusted(Ne),P.maxZoom);return Xe>.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"mercator"}),S.zoom=Xe,this._cameraForBounds(S,c,_,y,b,M)):{center:S.center,zoom:Xe,bearing:y,pitch:b}}queryTerrainElevation(s,c){const _=this.transform.elevation;return _?(c=r.extend({},{exaggerated:!0},c),_.getAtPoint(r.MercatorCoordinate.fromLngLat(s),null,c.exaggerated)):null}_cameraForBounds(s,c,_,y,b,M){if(s.projection.name==="globe")return this._cameraForBoundsOnGlobe(s,c,_,y,b,M);const S=s.clone(),P=this._extendCameraOptions(M),z=S.padding;S.bearing=y,S.pitch=b;const D=r.LngLat.convert(c),N=r.LngLat.convert(_),q=new r.LngLat(D.lng,N.lat),X=new r.LngLat(N.lng,D.lat),J=S.project(D),K=S.project(N),Q=this.queryTerrainElevation(D),j=this.queryTerrainElevation(N),H=this.queryTerrainElevation(q),ne=this.queryTerrainElevation(X),se=[[J.x,J.y,Math.min(Q||0,j||0,H||0,ne||0)],[K.x,K.y,Math.max(Q||0,j||0,H||0,ne||0)]];let fe=r.Aabb.fromPoints(se);const me=S.getWorldToCameraMatrix(),_e=r.invert(new Float64Array(16),me);fe=r.Aabb.applyTransform(fe,me);const ve=r.sub([],fe.max,fe.min),xe=z.left||0,Ae=z.right||0,Ze=z.bottom||0,Ee=z.top||0,{left:je,right:Ce,top:We,bottom:Se}=P.padding,Ne=.5*(xe+Ae),Xe=.5*(Ee+Ze),Ge=Math.min(S.scaleZoom(S.scale*Math.min((S.width-(xe+Ae+je+Ce))/ve[0],(S.height-(Ze+Ee+Se+We))/ve[1])),P.maxZoom),Ye=S.scale/S.zoomScale(Ge);fe=new r.Aabb([fe.min[0]-(je+Ne)*Ye,fe.min[1]-(Se+Xe)*Ye,fe.min[2]],[fe.max[0]+(Ce+Ne)*Ye,fe.max[1]+(We+Xe)*Ye,fe.max[2]]);const mt=.5*ve[2],wt=this._minimumAABBFrustumDistance(S,fe),dt=[0,0,1,0];r.transformMat4$1(dt,dt,me),r.normalize$2(dt,dt);const xt=r.scale$2([],dt,wt+mt),Bt=r.add([],fe.center,xt),Lt=(typeof P.offset.x=="number"&&typeof P.offset.y=="number"?new r.Point(P.offset.x,P.offset.y):r.Point.convert(P.offset)).rotate(-r.degToRad(y));fe.center[0]-=Lt.x*Ye,fe.center[1]+=Lt.y*Ye,r.transformMat4(fe.center,fe.center,_e),r.transformMat4(Bt,Bt,_e);const _t=[fe.center[0],fe.center[1],Bt[2]*S.pixelsPerMeter];r.scale$2(_t,_t,1/S.worldSize);const Jt=r.lngFromMercatorX(_t[0]),ii=r.latFromMercatorY(_t[1]),ni=Math.min(S._zoomFromMercatorZ(_t[2]),P.maxZoom),si=new r.LngLat(Jt,ii);return S.mercatorFromTransition&&ni<.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(S.setProjection({name:"globe"}),S.zoom=ni,this._cameraForBounds(S,c,_,y,b,M)):{center:si,zoom:ni,bearing:y,pitch:b}}fitBounds(s,c,_){const y=this.cameraForBounds(s,c);return this._fitInternal(y,c,_)}fitScreenCoordinates(s,c,_,y,b){const M=r.Point.convert(s),S=r.Point.convert(c),P=new r.Point(Math.min(M.x,S.x),Math.min(M.y,S.y)),z=new r.Point(Math.max(M.x,S.x),Math.max(M.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(M,S))return this;const D=this.transform.pointLocation3D(P),N=this.transform.pointLocation3D(z),q=this.transform.pointLocation3D(new r.Point(P.x,z.y)),X=this.transform.pointLocation3D(new r.Point(z.x,P.y)),J=[Math.min(D.lng,N.lng,q.lng,X.lng),Math.min(D.lat,N.lat,q.lat,X.lat)],K=[Math.max(D.lng,N.lng,q.lng,X.lng),Math.max(D.lat,N.lat,q.lat,X.lat)],Q=y&&y.pitch?y.pitch:this.getPitch(),j=this._cameraForBounds(this.transform,J,K,_,Q,y);return this._fitInternal(j,y,b)}_fitInternal(s,c,_){return s?(delete(c=r.extend(s,c)).padding,c.linear?this.easeTo(c,_):this.flyTo(c,_)):this}jumpTo(s,c){this.stop();const _=s.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,M=!1;return"zoom"in s&&_.zoom!==+s.zoom&&(y=!0,_.zoom=+s.zoom),s.center!==void 0&&(_.center=r.LngLat.convert(s.center)),"bearing"in s&&_.bearing!==+s.bearing&&(b=!0,_.bearing=+s.bearing),"pitch"in s&&_.pitch!==+s.pitch&&(M=!0,_.pitch=+s.pitch),s.padding==null||_.isPaddingEqual(s.padding)||(_.padding=s.padding),s.preloadOnly?(this._preloadTiles(_),this):(this.fire(new r.Event("movestart",c)).fire(new r.Event("move",c)),y&&this.fire(new r.Event("zoomstart",c)).fire(new r.Event("zoom",c)).fire(new r.Event("zoomend",c)),b&&this.fire(new r.Event("rotatestart",c)).fire(new r.Event("rotate",c)).fire(new r.Event("rotateend",c)),M&&this.fire(new r.Event("pitchstart",c)).fire(new r.Event("pitch",c)).fire(new r.Event("pitchend",c)),this.fire(new r.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.warnOnce(Tr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(s,c){const _=this.transform;if(!_.projection.supportsFreeCamera)return r.warnOnce(Tr),this;this.stop();const y=_.zoom,b=_.pitch,M=_.bearing;_.setFreeCameraOptions(s);const S=y!==_.zoom,P=b!==_.pitch,z=M!==_.bearing;return this.fire(new r.Event("movestart",c)).fire(new r.Event("move",c)),S&&this.fire(new r.Event("zoomstart",c)).fire(new r.Event("zoom",c)).fire(new r.Event("zoomend",c)),z&&this.fire(new r.Event("rotatestart",c)).fire(new r.Event("rotate",c)).fire(new r.Event("rotateend",c)),P&&this.fire(new r.Event("pitchstart",c)).fire(new r.Event("pitch",c)).fire(new r.Event("pitchend",c)),this.fire(new r.Event("moveend",c)),this}easeTo(s,c){this._stop(!1,s.easeId),((s=r.extend({offset:[0,0],duration:500,easing:r.ease},s)).animate===!1||this._prefersReducedMotion(s))&&(s.duration=0);const _=this.transform,y=this.getZoom(),b=this.getBearing(),M=this.getPitch(),S=this.getPadding(),P="zoom"in s?+s.zoom:y,z="bearing"in s?this._normalizeBearing(s.bearing,b):b,D="pitch"in s?+s.pitch:M,N="padding"in s?s.padding:_.padding,q=r.Point.convert(s.offset);let X,J,K;if(_.projection.name==="globe"){const xe=r.MercatorCoordinate.fromLngLat(_.center),Ae=q.rotate(-_.angle);xe.x+=Ae.x/_.worldSize,xe.y+=Ae.y/_.worldSize;const Ze=xe.toLngLat(),Ee=r.LngLat.convert(s.center||Ze);this._normalizeCenter(Ee),X=_.centerPoint.add(Ae),J=new r.Point(xe.x,xe.y).mult(_.worldSize),K=new r.Point(r.mercatorXfromLng(Ee.lng),r.mercatorYfromLat(Ee.lat)).mult(_.worldSize).sub(J)}else{X=_.centerPoint.add(q);const xe=_.pointLocation(X),Ae=r.LngLat.convert(s.center||xe);this._normalizeCenter(Ae),J=_.project(xe),K=_.project(Ae).sub(J)}const Q=_.zoomScale(P-y);let j,H;s.around&&(j=r.LngLat.convert(s.around),H=_.locationPoint(j));const ne=this._zooming||P!==y,se=this._rotating||b!==z,fe=this._pitching||D!==M,me=!_.isPaddingEqual(N),_e=xe=>Ae=>{if(ne&&(xe.zoom=r.number(y,P,Ae)),se&&(xe.bearing=r.number(b,z,Ae)),fe&&(xe.pitch=r.number(M,D,Ae)),me&&(xe.interpolatePadding(S,N,Ae),X=xe.centerPoint.add(q)),j)xe.setLocationAtPoint(j,H);else{const Ze=xe.zoomScale(xe.zoom-y),Ee=P>y?Math.min(2,Q):Math.max(.5,Q),je=Math.pow(Ee,1-Ae),Ce=xe.unproject(J.add(K.mult(Ae*je)).mult(Ze));xe.setLocationAtPoint(xe.renderWorldCopies?Ce.wrap():Ce,X)}return s.preloadOnly||this._fireMoveEvents(c),xe};if(s.preloadOnly){const xe=this._emulate(_e,s.duration,_);return this._preloadTiles(xe),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=se,this._pitching=fe,this._padding=me,this._easeId=s.easeId,this._prepareEase(c,s.noMoveStart,ve),this._ease(_e(_),xe=>{_.recenterOnTerrain(),this._afterEase(c,xe)},s),this}_prepareEase(s,c,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||_.moving||this.fire(new r.Event("movestart",s)),this._zooming&&!_.zooming&&this.fire(new r.Event("zoomstart",s)),this._rotating&&!_.rotating&&this.fire(new r.Event("rotatestart",s)),this._pitching&&!_.pitching&&this.fire(new r.Event("pitchstart",s))}_fireMoveEvents(s){this.fire(new r.Event("move",s)),this._zooming&&this.fire(new r.Event("zoom",s)),this._rotating&&this.fire(new r.Event("rotate",s)),this._pitching&&this.fire(new r.Event("pitch",s))}_afterEase(s,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new r.Event("zoomend",s)),y&&this.fire(new r.Event("rotateend",s)),b&&this.fire(new r.Event("pitchend",s)),this.fire(new r.Event("moveend",s))}flyTo(s,c){if(this._prefersReducedMotion(s)){const Ge=r.pick(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ge,c)}this.stop(),s=r.extend({offset:[0,0],speed:1.2,curve:1.42,easing:r.ease},s);const _=this.transform,y=this.getZoom(),b=this.getBearing(),M=this.getPitch(),S=this.getPadding(),P="zoom"in s?r.clamp(+s.zoom,_.minZoom,_.maxZoom):y,z="bearing"in s?this._normalizeBearing(s.bearing,b):b,D="pitch"in s?+s.pitch:M,N="padding"in s?s.padding:_.padding,q=_.zoomScale(P-y),X=r.Point.convert(s.offset);let J=_.centerPoint.add(X);const K=_.pointLocation(J),Q=r.LngLat.convert(s.center||K);this._normalizeCenter(Q);const j=_.project(K),H=_.project(Q).sub(j);let ne=s.curve;const se=Math.max(_.width,_.height),fe=se/q,me=H.mag();if("minZoom"in s){const Ge=r.clamp(Math.min(s.minZoom,y,P),_.minZoom,_.maxZoom),Ye=se/_.zoomScale(Ge-y);ne=Math.sqrt(Ye/me*2)}const _e=ne*ne;function ve(Ge){const Ye=(fe*fe-se*se+(Ge?-1:1)*_e*_e*me*me)/(2*(Ge?fe:se)*_e*me);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function xe(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Ae(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Ze=ve(0);let Ee=function(Ge){return Ae(Ze)/Ae(Ze+ne*Ge)},je=function(Ge){return se*((Ae(Ze)*(xe(Ye=Ze+ne*Ge)/Ae(Ye))-xe(Ze))/_e)/me;var Ye},Ce=(ve(1)-Ze)/ne;if(Math.abs(me)<1e-6||!isFinite(Ce)){if(Math.abs(se-fe)<1e-6)return this.easeTo(s,c);const Ge=fe<se?-1:1;Ce=Math.abs(Math.log(fe/se))/ne,je=function(){return 0},Ee=function(Ye){return Math.exp(Ge*ne*Ye)}}s.duration="duration"in s?+s.duration:1e3*Ce/("screenSpeed"in s?+s.screenSpeed/ne:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0);const We=b!==z,Se=D!==M,Ne=!_.isPaddingEqual(N),Xe=Ge=>Ye=>{const mt=Ye*Ce,wt=1/Ee(mt);Ge.zoom=Ye===1?P:y+Ge.scaleZoom(wt),We&&(Ge.bearing=r.number(b,z,Ye)),Se&&(Ge.pitch=r.number(M,D,Ye)),Ne&&(Ge.interpolatePadding(S,N,Ye),J=Ge.centerPoint.add(X));const dt=Ye===1?Q:Ge.unproject(j.add(H.mult(je(mt))).mult(wt));return Ge.setLocationAtPoint(Ge.renderWorldCopies?dt.wrap():dt,J),Ge._updateCameraOnTerrain(),s.preloadOnly||this._fireMoveEvents(c),Ge};if(s.preloadOnly){const Ge=this._emulate(Xe,s.duration,_);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=We,this._pitching=Se,this._padding=Ne,this._prepareEase(c,!1),this._ease(Xe(_),()=>this._afterEase(c),s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,c)}if(!s){const _=this.handlers;_&&_.stop(!1)}return this}_ease(s,c,_){_.animate===!1||_.duration===0?(s(1),c()):(this._easeStart=r.exported.now(),this._easeOptions=_,this._onEaseFrame=s,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const s=Math.min((r.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(s)),s<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(s,c){s=r.wrap(s,-180,180);const _=Math.abs(s-c);return Math.abs(s-360-c)<_&&(s-=360),Math.abs(s+360-c)<_&&(s+=360),s}_normalizeCenter(s){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const _=s.lng-c.center.lng;s.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(s){return this._respectPrefersReducedMotion&&r.exported.prefersReducedMotion&&!(s&&s.essential)}_emulate(s,c,_){const y=Math.ceil(15*c/1e3),b=[],M=s(_.clone());for(let S=0;S<=y;S++){const P=M(S/y);b.push(P.clone())}return b}}class ut{constructor(s={}){this.options=s,r.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(s){const c=this.options&&this.options.compact;return this._map=s,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),U("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(s,c){const _=this._map._getUIString(`AttributionControl.${c}`);s.setAttribute("aria-label",_),s.removeAttribute("title"),s.firstElementChild&&s.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let s=this._editLink;s||(s=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.config.ACCESS_TOKEN}];if(s){const _=c.reduce((y,b,M)=>(b.value&&(y+=`${b.key}=${b.value}${M<c.length-1?"&":""}`),y),"?");s.href=`${r.config.FEEDBACK_URL}/${_}#${la(this._map,!0)}`,s.rel="noopener nofollow",this._setElementTitle(s,"MapFeedback")}}_updateData(s){!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let s=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const b=c[y];if(b.used){const M=b.getSource();M.attribution&&s.indexOf(M.attribution)<0&&s.push(M.attribution)}}s.sort((y,b)=>y.length-b.length),s=s.filter((y,b)=>{for(let M=b+1;M<s.length;M++)if(s[M].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=[...this.options.customAttribution,...s]:s.unshift(this.options.customAttribution));const _=s.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,s.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Hc{constructor(){r.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(s){this._map=s,this._container=U("div","mapboxgl-ctrl");const c=U("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(s){s&&s.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const s=this._map.style._sourceCaches;if(Object.entries(s).length===0)return!0;for(const c in s){const _=s[c].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const s=this._container.children;if(s.length){const c=s[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Xc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const c=++this._id;return this._queue.push({callback:s,id:c,cancelled:!1}),c}remove(s){const c=this._currentlyRunning,_=c?this._queue.concat(c):this._queue;for(const y of _)if(y.id===s)return void(y.cancelled=!0)}run(s=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const _ of c)if(!_.cancelled&&(_.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ho(p,s,c){if(p=new r.LngLat(p.lng,p.lat),s){const _=new r.LngLat(p.lng-360,p.lat),y=new r.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),M=c.locationPoint(p).distSqr(s),S=s.x<0||s.y<0||s.x>c.width||s.y>c.height;c.locationPoint(_).distSqr(s)<M&&(S||Math.abs(_.lng-c.center.lng)<b)?p=_:c.locationPoint(y).distSqr(s)<M&&(S||Math.abs(y.lng-c.center.lng)<b)&&(p=y)}for(;Math.abs(p.lng-c.center.lng)>180;){const _=c.locationPoint(p);if(_.x>=0&&_.y>=0&&_.x<=c.width&&_.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const Er={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class at extends r.Evented{constructor(s,c){if(super(),(s instanceof r.window.HTMLElement||c)&&(s=r.extend({element:s},c)),r.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=s&&s.occludedOpacity||.2,s&&s.element)this._element=s.element,this._offset=r.Point.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=U("div");const y=41,b=27,M=Y("svg",{display:"block",height:y*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${y}`},this._element),S=Y("radialGradient",{id:"shadowGradient"},Y("defs",{},M));Y("stop",{offset:"10%","stop-opacity":.4},S),Y("stop",{offset:"100%","stop-opacity":.05},S),Y("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},M),Y("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},M),Y("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},M),Y("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},M),this._offset=r.Point.convert(s&&s.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const _=this._element.classList;for(const y in Er)_.remove(`mapboxgl-marker-anchor-${y}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(s){return s===this._map||(this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._updateMoving),s.on("moveend",this._update),s.on("remove",this._clearFadeTimer),s._addMarker(this),this.setDraggable(this._draggable),this._update(),s.on("click",this._onMapClick)),this}remove(){const s=this._map;return s&&(s.off("click",this._onMapClick),s.off("move",this._updateMoving),s.off("moveend",this._update),s.off("mousedown",this._addDragHandler),s.off("touchstart",this._addDragHandler),s.off("mouseup",this._onUp),s.off("touchend",this._onUp),s.off("mousemove",this._onMove),s.off("touchmove",this._onMove),s.off("remove",this._clearFadeTimer),s._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=r.LngLat.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,s._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(s){const c=s.code,_=s.charCode||s.keyCode;c!=="Space"&&c!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(s){const c=s.originalEvent.target,_=this._element;this._popup&&(c===_||_.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const s=this._popup;return s?(s.isOpen()?(s.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(s.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const s=this._map,c=this._pos;if(!s||!c)return!1;const _=s.unproject(c),y=s.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(_)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const s=this._map;if(!s)return;const c=this._pos;if(!c||c.x<0||c.x>s.transform.width||c.y<0||c.y>s.transform.height)return void this._clearFadeTimer();const _=s.unproject(c);let y;s._showingGlobe()&&r.isLngLatBehindGlobe(s.transform,this._lngLat)?y=0:(y=1-s._queryFogOpacity(_),s.transform._terrainEnabled()&&s.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const s=this._pos;if(!s||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${s.x}px,${s.y}px)
            ${Er[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const s=this._pos,c=this._map,_=this.getPitchAlignment();if(!c||!s||_!=="map")return"";if(!c._showingGlobe()){const P=c.getPitch();return P?`rotateX(${P}deg)`:""}const y=r.radToDeg(r.globeTiltAtLngLat(c.transform,this._lngLat)),b=s.sub(r.globeCenterToScreenPoint(c.transform)),M=Math.abs(b.x)+Math.abs(b.y);if(M===0)return"";const S=y/M;return`rotateX(${-b.y*S}deg) rotateY(${b.x*S}deg)`}_calculateZTransform(){const s=this._pos,c=this._map;if(!c||!s)return"";let _=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const b=c.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),M=c.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);_=r.radToDeg(Math.atan2(M.y,M.x))-90}else _=-c.getBearing();else if(y==="horizon"){const b=r.smoothstep(4,6,c.getZoom()),M=r.globeCenterToScreenPoint(c.transform);M.y+=b*c.transform.height;const S=s.sub(M),P=r.radToDeg(Math.atan2(S.y,S.x));_=(P>90?P-270:P+90)*(1-b)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(s){r.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=ho(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),s===!0?this._updateFrameId=r.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(s){return this._offset=r.Point.convert(s),this._update(),this}_onMove(s){const c=this._map;if(!c)return;const _=this._pointerdownPos,y=this._positionDelta;if(_&&y){if(!this._isDragging){const b=this._clickTolerance||c._clickTolerance;if(s.point.dist(_)<b)return;this._isDragging=!0}this._pos=s.point.sub(y),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.Event("dragstart"))),this.fire(new r.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const s=this._map;s&&(s.off("mousemove",this._onMove),s.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.Event("dragend")),this._state="inactive"}_addDragHandler(s){const c=this._map,_=this._pos;c&&_&&this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(_),this._pointerdownPos=s.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(s){this._draggable=!!s;const c=this._map;return c&&(s?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(s){return this._occludedOpacity=s||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Yc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},rf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Qu(p=new r.Point(0,0),s="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(s){case"top":return new r.Point(0,p);case"top-left":return new r.Point(c,c);case"top-right":return new r.Point(-c,c);case"bottom":return new r.Point(0,-p);case"bottom-left":return new r.Point(c,-c);case"bottom-right":return new r.Point(-c,-c);case"left":return new r.Point(p,0);case"right":return new r.Point(-p,0)}return new r.Point(0,0)}return p instanceof r.Point||Array.isArray(p)?r.Point.convert(p):r.Point.convert(p[s]||[0,0])}class Kc{constructor(s){this.jumpTo(s)}getValue(s){if(s<=this._startTime)return this._start;if(s>=this._endTime)return this._end;const c=r.easeCubicInOut((s-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(s){return s>=this._startTime&&s<=this._endTime}jumpTo(s){this._startTime=-1/0,this._endTime=-1/0,this._start=s,this._end=s}easeTo(s,c,_){this._start=this.getValue(c),this._end=s,this._startTime=c,this._endTime=c+_}}const ed={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},td={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},of={showCompass:!0,showZoom:!0,visualizePitch:!1};class af{constructor(s,c,_=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Gc({clickTolerance:s.dragRotate._mouseRotate._clickTolerance}),this.map=s,_&&(this.mousePitch=new $c({clickTolerance:s.dragRotate._mousePitch._clickTolerance})),r.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(s,c){this.mouseRotate.mousedown(s,c),this.mousePitch&&this.mousePitch.mousedown(s,c),be()}move(s,c){const _=this.map,y=this.mouseRotate.mousemoveWindow(s,c),b=y&&y.bearingDelta;if(b&&_.setBearing(_.getBearing()+b),this.mousePitch){const M=this.mousePitch.mousemoveWindow(s,c),S=M&&M.pitchDelta;S&&_.setPitch(_.getPitch()+S)}}off(){const s=this.element;s.removeEventListener("mousedown",this.mousedown),s.removeEventListener("touchstart",this.touchstart,{passive:!1}),s.removeEventListener("touchmove",this.touchmove),s.removeEventListener("touchend",this.touchend),s.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Le(),r.window.removeEventListener("mousemove",this.mousemove),r.window.removeEventListener("mouseup",this.mouseup)}mousedown(s){this.down(r.extend({},s,{ctrlKey:!0,preventDefault:()=>s.preventDefault()}),Re(this.element,s)),r.window.addEventListener("mousemove",this.mousemove),r.window.addEventListener("mouseup",this.mouseup)}mousemove(s){this.move(s,Re(this.element,s))}mouseup(s){this.mouseRotate.mouseupWindow(s),this.mousePitch&&this.mousePitch.mouseupWindow(s),this.offTemp()}touchstart(s){s.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Je(this.element,s.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>s.preventDefault()},this._startPos))}touchmove(s){s.targetTouches.length!==1?this.reset():(this._lastPos=Je(this.element,s.targetTouches)[0],this.move({preventDefault:()=>s.preventDefault()},this._lastPos))}touchend(s){s.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Jc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Qc={maxWidth:100,unit:"metric"},eh={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},uo={version:r.version,supported:C,setRTLTextPlugin:r.setRTLTextPlugin,getRTLTextPluginStatus:r.getRTLTextPluginStatus,Map:class extends wl{constructor(p){if(r.LivePerformanceUtils.mark(r.PerformanceMarkers.create),(p=r.extend({},td,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.isSafariWithAntialiasingBug(r.window)&&(p.antialias=!1,r.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new oo(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._useWebGL2=p.useWebGL2,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Xc,this._domRenderTaskQueue=new Xc,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.uniqueId(),this._locale=r.extend({},ed,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Kc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,typeof p.container=="string"){if(this._container=r.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof r.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),r.window!==void 0&&(r.window.addEventListener("online",this._onWindowOnline,!1),r.window.addEventListener("resize",this._onWindowResize,!1),r.window.addEventListener("orientationchange",this._onWindowResize,!1),r.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new _s(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new Nc(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,r.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new ut({customAttribution:p.customAttribution})),this._logoControl=new Hc,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new r.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new r.Event(`${s.dataType}dataloading`,s))})}_getMapId(){return this._mapId}addControl(p,s){if(s===void 0&&(s=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const _=this._controlPositions[s];return s.indexOf("bottom")!==-1?_.insertBefore(c,_.firstChild):_.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(p);return s>-1&&this._controls.splice(s,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const s=!this._moving;return s&&this.fire(new r.Event("movestart",p)).fire(new r.Event("move",p)),this.fire(new r.Event("resize",p)),s&&this.fire(new r.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?r.window.navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(s=>s==="auto"?r.window.navigator.language:s):p}setLanguage(p){const s=this._parseLanguage(p);if(!this.style||s===this._language)return this;this._language=s,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,s=p.projection.name;let c;s==="globe"&&p.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),c=!0):s==="mercator"&&p.zoom<r.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,s){return this._updateProjection(p||s||{name:"mercator"})}_updateProjection(p){let s;if(s=p.name==="globe"&&this.transform.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),s){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(p){return this.transform.locationPoint3D(r.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(r.Point.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,s,c){if(p==="mouseenter"||p==="mouseover"){let _=!1;const y=M=>{const S=s.filter(z=>this.getLayer(z)),P=S.length?this.queryRenderedFeatures(M.point,{layers:S}):[];P.length?_||(_=!0,c.call(this,new tn(p,this,M.originalEvent,{features:P}))):_=!1},b=()=>{_=!1};return{layers:new Set(s),listener:c,delegates:{mousemove:y,mouseout:b}}}if(p==="mouseleave"||p==="mouseout"){let _=!1;const y=M=>{const S=s.filter(P=>this.getLayer(P));(S.length?this.queryRenderedFeatures(M.point,{layers:S}):[]).length?_=!0:_&&(_=!1,c.call(this,new tn(p,this,M.originalEvent)))},b=M=>{_&&(_=!1,c.call(this,new tn(p,this,M.originalEvent)))};return{layers:new Set(s),listener:c,delegates:{mousemove:y,mouseout:b}}}{const _=y=>{const b=s.filter(S=>this.getLayer(S)),M=b.length?this.queryRenderedFeatures(y.point,{layers:b}):[];M.length&&(y.features=M,c.call(this,y),delete y.features)};return{layers:new Set(s),listener:c,delegates:{[p]:_}}}}on(p,s,c){if(c===void 0)return super.on(p,s);Array.isArray(s)||(s=[s]);const _=this._createDelegatedListener(p,s,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(p,s,c){if(c===void 0)return super.once(p,s);Array.isArray(s)||(s=[s]);const _=this._createDelegatedListener(p,s,c);for(const y in _.delegates)this.once(y,_.delegates[y]);return this}off(p,s,c){if(c===void 0)return super.off(p,s);s=new Set(Array.isArray(s)?s:[s]);const _=(b,M)=>{if(b.size!==M.size)return!1;for(const S of b)if(!M.has(S))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[p]:void 0;return y&&(b=>{for(let M=0;M<b.length;M++){const S=b[M];if(S.listener===c&&_(S.layers,s)){for(const P in S.delegates)this.off(P,S.delegates[P]);return b.splice(M,1),this}}})(y),this}queryRenderedFeatures(p,s){return this.style?(s!==void 0||p===void 0||p instanceof r.Point||Array.isArray(p)||(s=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],s=s||{},this.transform)):[]}querySourceFeatures(p,s){return this.style.querySourceFeatures(p,s)}isPointOnSurface(p){const{name:s}=this.transform.projection;return s!=="globe"&&s!=="mercator"&&r.warnOnce(`${s} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.Point.convert(p))}setStyle(p,s){return(s=r.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&s.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._localFontFamily=s.localFontFamily,this._updateStyle(p,s))}_getUIString(p){const s=this._locale[p];if(s==null)throw new Error(`Missing UI string '${p}'`);return s}_updateStyle(p,s){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new ps(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ps(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,s){if(typeof p=="string"){const c=this._requestManager.normalizeStyleURL(p),_=this._requestManager.transformRequest(c,r.ResourceType.Style);r.getJSON(_,(y,b)=>{y?this.fire(new r.ErrorEvent(y)):b&&this._updateDiff(b,s)})}else typeof p=="object"&&this._updateDiff(p,s)}_updateDiff(p,s){try{this.style.setState(p)&&this._update(!0)}catch(c){r.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.warnOnce("There is no style added to the map."),!1)}addSource(p,s){return this._lazyInitEmptyStyle(),this.style.addSource(p,s),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const s in p){const c=p[s]._tiles;for(const _ in c){const y=c[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(p,s,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,s,c)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,s,{pixelRatio:c=1,sdf:_=!1,stretchX:y,stretchY:b,content:M}={}){if(this._lazyInitEmptyStyle(),s instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&s instanceof r.window.ImageBitmap){const{width:S,height:P,data:z}=r.exported.getImageData(s);this.style.addImage(p,{data:new r.RGBAImage({width:S,height:P},z),pixelRatio:c,stretchX:y,stretchY:b,content:M,sdf:_,version:0})}else if(s.width===void 0||s.height===void 0)this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:S,height:P}=s,z=s;this.style.addImage(p,{data:new r.RGBAImage({width:S,height:P},new Uint8Array(z.data)),pixelRatio:c,stretchX:y,stretchY:b,content:M,sdf:_,version:0,userImage:z}),z.onAdd&&z.onAdd(this,p)}}updateImage(p,s){const c=this.style.getImage(p);if(!c)return void this.fire(new r.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=s instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&s instanceof r.window.ImageBitmap?r.exported.getImageData(s):s,{width:y,height:b}=_;y!==void 0&&b!==void 0?y===c.data.width&&b===c.data.height?(c.data.replace(_.data,!(s instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&s instanceof r.window.ImageBitmap)),this.style.updateImage(p,c)):this.fire(new r.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new r.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,s){r.getImage(this._requestManager.transformRequest(p,r.ResourceType.Image),(c,_)=>{s(c,_ instanceof r.window.HTMLImageElement?r.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(p,s){return this._lazyInitEmptyStyle(),this.style.addLayer(p,s),this._update(!0)}moveLayer(p,s){return this.style.moveLayer(p,s),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,s,c){return this.style.setLayerZoomRange(p,s,c),this._update(!0)}setFilter(p,s,c={}){return this.style.setFilter(p,s,c),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,s,c,_={}){return this.style.setPaintProperty(p,s,c,_),this._update(!0)}getPaintProperty(p,s){return this.style.getPaintProperty(p,s)}setLayoutProperty(p,s,c,_={}){return this.style.setLayoutProperty(p,s,c,_),this._update(!0)}getLayoutProperty(p,s){return this.style.getLayoutProperty(p,s)}setLight(p,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,s),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.LngLat.convert(p),this.transform):0}setFeatureState(p,s){return this.style.setFeatureState(p,s),this._update()}removeFeatureState(p,s){return this.style.removeFeatureState(p,s),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,s=this._container.getBoundingClientRect().height||300;let c,_,y,b=this._container;for(;b&&(!_||!y);){const M=r.window.getComputedStyle(b).transform;M&&M!=="none"&&(c=M.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(_=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),b=b.parentElement}this._containerWidth=_?Math.abs(p/_):p,this._containerHeight=y?Math.abs(s/y):s}_detectMissingCSS(){r.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const s=this._canvasContainer=U("div","mapboxgl-canvas-container",p);this._interactive&&s.classList.add("mapboxgl-interactive"),this._canvas=U("canvas","mapboxgl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=U("div","mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{_[y]=U("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,s){const c=r.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(s),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${s}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const s=this._markers.indexOf(p);s!==-1&&this._markers.splice(s,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const s=this._popups.indexOf(p);s!==-1&&this._popups.splice(s,1)}_setupPainter(){const p=r.extend({},C.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),s=this._useWebGL2&&this._canvas.getContext("webgl2",p),c=s||this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);c?(this._useWebGL2&&!s&&r.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),r.storeAuthState(c,!0),this.painter=new so(c,this.transform,!!s),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.exported$1.testSupport(c)):this.fire(new r.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new r.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let s;const c=this.painter.context.extTimerQuery,_=r.exported.now();if(this.listens("gpu-timing-frame")&&(s=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,s)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],r.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],r.window.performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const S=this.transform.zoom,P=this.transform.pitch,z=r.exported.now(),D=new r.EvaluationParameters(S,{now:z,fadeDuration:y,pitch:P,transition:this.style.getTransition()});this.style.update(D)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),s){const S=r.exported.now()-_;c.endQueryEXT(c.TIME_ELAPSED_EXT,s),setTimeout(()=>{const P=c.getQueryObjectEXT(s,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(s),this.fire(new r.Event("gpu-timing-frame",{cpuTime:S,gpuTime:P})),r.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const S=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(S);this.fire(new r.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const S=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(S);this.fire(new r.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const M=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(M||this._repaint)this.triggerRepaint();else{const S=!this.isMoving()&&this.loaded();if(S&&(b=this._updateAverageElevation(_,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),S&&(this.fire(new r.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new r.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||M||(this._fullyLoaded=!0,r.LivePerformanceUtils.mark(r.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&r.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const s of this._markers)p&&!this.getRenderWorldCopies()&&(s._lngLat=s._lngLat.wrap()),s._update();for(const s of this._popups)!p||this.getRenderWorldCopies()||s._trackPointer||(s._lngLat=s._lngLat.wrap()),s._update()}_updateAverageElevation(p,s=!1){const c=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((s||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=p;const M=Math.abs(_-y);if(M>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,p,300)}else if(M>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){r.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===r.AUTH_ERR_MSG||p.status===401)){const s=this.painter.context.gl;r.storeAuthState(s,!1),this._logoControl instanceof Hc&&this._logoControl._updateLogo(),s&&s.clear(s.DEPTH_BUFFER_BIT|s.COLOR_BUFFER_BIT|s.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),s=this.painter.getCanvasCopiesAndTimestamps();s.timeStamps.push(performance.now());const c=this.painter.context.gl,_=c.createFramebuffer();function y(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const M=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,M),M}return c.bindFramebuffer(c.FRAMEBUFFER,_),this._canvasPixelComparison(y(p),s.canvasCopies.map(y),s.timeStamps)}_canvasPixelComparison(p,s,c){let _=c[1]-c[0];const y=p.length/4;for(let b=0;b<s.length;b++){const M=s[b];let S=0;for(let P=0;P<M.length;P+=4)M[P]===p[P]&&M[P+1]===p[P+1]&&M[P+2]===p[P+2]&&M[P+3]===p[P+3]&&(S+=1);_+=(c[b+2]-c[b+1])*(1-S/y)}return _}remove(){this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),r.window!==void 0&&(r.window.removeEventListener("resize",this._onWindowResize,!1),r.window.removeEventListener("orientationchange",this._onWindowResize,!1),r.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.removeEventListener("online",this._onWindowOnline,!1),r.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new r.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.exported.frame(s=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(s)}))}_preloadTiles(p){const s=this.style?Object.values(this.style._sourceCaches):[];return r.asyncAll(s,(c,_)=>c._preloadTiles(p,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){r.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,s){r.setCacheLimits(p,s)}get version(){return r.version}},NavigationControl:class{constructor(p){this.options=r.extend({},of,p),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(r.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",s=>{this._map&&this._map.zoomIn({},{originalEvent:s})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",s=>{this._map&&this._map.zoomOut({},{originalEvent:s})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",s=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:s}):c.resetNorth({},{originalEvent:s}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const s=p.getZoom(),c=s===p.getMaxZoom(),_=s===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=s)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new af(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,s){const c=U("button",p,this._container);return c.type="button",c.addEventListener("click",s),c}_setButtonTitle(p,s){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${s}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.Evented{constructor(p){super(),this.options=r.extend({geolocation:r.window.navigator.geolocation},Jc,p),r.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ao(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const s=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):r.window.navigator.permissions!==void 0?r.window.navigator.permissions.query({name:"geolocation"}).then(c=>s(c.state!=="denied")).catch(()=>s()):s()}_isOutOfMapMaxBounds(p){const s=this._map.getMaxBounds(),c=p.coords;return!!s&&(c.longitude<s.getWest()||c.longitude>s.getEast()||c.latitude<s.getSouth()||c.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("geolocate",p)),this._finish()}}_updateCamera(p){const s=new r.LngLat(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,_=this._map.getBearing(),y=r.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(s.toBounds(c),y,{geolocateSource:!0})}_updateMarker(p){if(p){const s=new r.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,s=r.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*s);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",s=>s.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",s),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new at({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new at({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.Event("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{r.window.addEventListener("ondeviceorientationabsolute"in r.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};r.window.DeviceMotionEvent!==void 0&&typeof r.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(s=>{s==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),r.window.removeEventListener("deviceorientation",this._onDeviceOrientation),r.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ut,ScaleControl:class{constructor(p){this.options=r.extend({},Qc,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,s=this._map,c=s._containerHeight/2,_=s._containerWidth/2-p/2,y=s.unproject([_,c]),b=s.unproject([_+p,c]),M=y.distanceTo(b);if(this.options.unit==="imperial"){const S=3.2808*M;S>5280?this._setScale(p,S/5280,"mile"):this._setScale(p,S,"foot")}else this.options.unit==="nautical"?this._setScale(p,M/1852,"nautical-mile"):M>=1e3?this._setScale(p,M/1e3,"kilometer"):this._setScale(p,M,"meter")}_setScale(p,s,c){this._map._requestDomTask(()=>{const _=function(b){const M=Math.pow(10,`${Math.floor(b)}`.length-1);let S=b/M;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(P){const z=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*z)/z}(S),M*S}(s),y=_/s;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(_):`${_}&nbsp;${eh[c]}`,this._container.style.width=p*y+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof r.window.HTMLElement?this._container=p.container:r.warnOnce("Full screen control 'container' must be a DOM element.")),r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in r.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in r.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,r.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!r.window.document.fullscreenEnabled&&!r.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),r.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(r.window.document.fullscreenElement||r.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?r.window.document.exitFullscreen?r.window.document.exitFullscreen():r.window.document.webkitCancelFullScreen&&r.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.Evented{constructor(p){super(),this.options=r.extend(Object.create(Yc),p),r.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const s=this._map;return s&&(s.on("move",this._update),s.off("mousemove",this._onMouseEvent),s._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(r.window.document.createTextNode(p))}setHTML(p){const s=r.window.document.createDocumentFragment(),c=r.window.document.createElement("body");let _;for(c.innerHTML=p;_=c.firstChild,_;)s.appendChild(_);return this.setDOMContent(s)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let s=this._content;if(s)for(;s.hasChildNodes();)s.firstChild&&s.removeChild(s.firstChild);else s=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(s.appendChild(p),this.options.closeButton){const c=this._closeButton=U("button","mapboxgl-popup-close-button",s);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let s;return this._classList.delete(p)?s=!1:(this._classList.add(p),s=!0),this._updateClassList(),s}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const s=this._map,c=this._container,_=this._pos;if(!s||!c||!_)return"bottom";const y=c.offsetWidth,b=c.offsetHeight,M=_.x<y/2,S=_.x>s.transform.width-y/2;if(_.y+p<b)return M?"top-left":S?"top-right":"top";if(_.y>s.transform.height-b){if(M)return"bottom-left";if(S)return"bottom-right"}return M?"left":S?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const s=[...this._classList];s.push("mapboxgl-popup"),this._anchor&&s.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&s.push("mapboxgl-popup-track-pointer"),p.className=s.join(" ")}_update(p){const s=this._map,c=this._content;if(!s||!this._lngLat&&!this._trackPointer||!c)return;let _=this._container;if(_||(_=this._container=U("div","mapboxgl-popup",s.getContainer()),this._tip=U("div","mapboxgl-popup-tip",_),_.appendChild(c)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),s.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ho(this._lngLat,this._pos,s.transform)),!this._trackPointer||p){const y=this._pos=this._trackPointer&&p?p:s.project(this._lngLat),b=Qu(this.options.offset),M=this._anchor=this._getAnchor(b.y),S=Qu(this.options.offset,M),P=y.add(S).round();s._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${Er[M]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&s._showingGlobe()){const y=r.isLngLatBehindGlobe(s.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(rf);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:at,Style:ps,LngLat:r.LngLat,LngLatBounds:r.LngLatBounds,Point:r.Point,MercatorCoordinate:r.MercatorCoordinate,FreeCameraOptions:Fu,Evented:r.Evented,config:r.config,prewarm:function(){Zr().acquire(hs)},clearPrewarmedResources:function(){const p=yn;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(hs),yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return r.config.ACCESS_TOKEN},set accessToken(p){r.config.ACCESS_TOKEN=p},get baseApiUrl(){return r.config.API_URL},set baseApiUrl(p){r.config.API_URL=p},get workerCount(){return Qi.workerCount},set workerCount(p){Qi.workerCount=p},get maxParallelImageRequests(){return r.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:r.exported.setNow,restoreNow:r.exported.restoreNow};return uo});var v=d;return v})})(N1);var SS=N1.exports;const hu=F1(SS);var rc=IS,AS=Object.prototype.hasOwnProperty;function IS(){for(var o={},n=0;n<arguments.length;n++){var a=arguments[n];for(var h in a)AS.call(a,h)&&(o[h]=a[h])}return o}var V1={exports:{}};(function(o,n){(function(){var a={};o.exports=a,a.simpleFilter=function(h,d){return d.filter(function(g){return a.test(h,g)})},a.test=function(h,d){return a.match(h,d)!==null},a.match=function(h,d,g){g=g||{};var v=0,r=[],T=d.length,C=0,R=0,F=g.pre||"",U=g.post||"",Y=g.caseSensitive&&d||d.toLowerCase(),ie;h=g.caseSensitive&&h||h.toLowerCase();for(var ce=0;ce<T;ce++)ie=d[ce],Y[ce]===h[v]?(ie=F+ie+U,v+=1,R+=1+R):R=0,C+=R,r[r.length]=ie;return v===h.length?(C=Y===h?1/0:C,{rendered:r.join(""),score:C}):null},a.filter=function(h,d,g){return!d||d.length===0?[]:typeof h!="string"?d:(g=g||{},d.reduce(function(v,r,T,C){var R=r;g.extract&&(R=g.extract(r));var F=a.match(h,R,g);return F!=null&&(v[v.length]={string:F.rendered,score:F.score,index:T,original:r}),v},[]).sort(function(v,r){var T=r.score-v.score;return T||v.index-r.index}))}})()})(V1);var CS=V1.exports,Qn=function(o){return this.component=o,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,o.el.parentNode.insertBefore(this.wrapper,o.el.nextSibling),this};Qn.prototype.show=function(){this.element.style.display="block"};Qn.prototype.hide=function(){this.element.style.display="none"};Qn.prototype.add=function(o){this.items.push(o)};Qn.prototype.clear=function(){this.items=[],this.active=0};Qn.prototype.isEmpty=function(){return!this.items.length};Qn.prototype.isVisible=function(){return this.element.style.display==="block"};Qn.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var o=0;o<this.items.length;o++)this.drawItem(this.items[o],this.active===o);this.show()};Qn.prototype.drawItem=function(o,n){var a=document.createElement("li"),h=document.createElement("a");n&&(a.className+=" active"),h.innerHTML=o.string,a.appendChild(h),this.element.appendChild(a),a.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),a.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,o)}).bind(this))};Qn.prototype.handleMouseUp=function(o){this.selectingListItem=!1,this.component.value(o.original),this.clear(),this.draw()};Qn.prototype.move=function(o){this.active=o,this.draw()};Qn.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Qn.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Qn.prototype.drawError=function(o){var n=document.createElement("li");n.innerHTML=o,this.element.appendChild(n),this.show()};var PS=Qn,kS=rc,LS=CS,DS=PS,Dn=function(o,n,a){return a=a||{},this.options=kS({minLength:2,limit:5,filter:!0,hideOnBlur:!0},a),this.el=o,this.data=n||[],this.list=new DS(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(h){this.handleKeyUp(h.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(h){this.handleKeyDown(h)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(h){this.handlePaste(h)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Dn.prototype.handleKeyUp=function(o){o===40||o===38||o===27||o===13||o===9||this.handleInputChange(this.el.value)};Dn.prototype.handleKeyDown=function(o){switch(o.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&o.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Dn.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Dn.prototype.handlePaste=function(o){if(o.clipboardData)this.handleInputChange(o.clipboardData.getData("Text"));else{var n=this;setTimeout(function(){n.handleInputChange(o.target.value)},100)}};Dn.prototype.handleInputChange=function(o){if(this.query=this.normalize(o),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(n){for(var a=0;a<n.length&&(this.list.add(n[a]),a!==this.options.limit-1);a++);this.list.draw()}).bind(this))};Dn.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Dn.prototype.update=function(o){this.data=o,this.handleKeyUp()};Dn.prototype.clear=function(){this.data=[],this.list.clear()};Dn.prototype.normalize=function(o){return o=o.toLowerCase(),o};Dn.prototype.match=function(o,n){return o.indexOf(n)>-1};Dn.prototype.value=function(o){if(this.selected=o,this.el.value=this.getItemValue(o),document.createEvent){var n=document.createEvent("HTMLEvents");n.initEvent("change",!0,!1),this.el.dispatchEvent(n)}else this.el.fireEvent("onchange")};Dn.prototype.getCandidates=function(o){var n={pre:"<strong>",post:"</strong>",extract:(function(h){return this.getItemValue(h)}).bind(this)},a;this.options.filter?(a=LS.filter(this.query,this.data,n),a=a.map((function(h){return{original:h.original,string:this.render(h.original,h.string)}}).bind(this))):a=this.data.map((function(h){var d=this.render(h);return{original:h,string:d}}).bind(this)),o(a)};Dn.prototype.getItemValue=function(o){return o};Dn.prototype.render=function(o,n){if(n)return n;for(var a=o.original?this.getItemValue(o.original):this.getItemValue(o),h=this.normalize(a),d=h.lastIndexOf(this.query);d>-1;){var g=d+this.query.length;a=a.slice(0,d)+"<strong>"+a.slice(d,g)+"</strong>"+a.slice(g),d=h.slice(0,d).lastIndexOf(this.query)}return a};Dn.prototype.renderError=function(o){this.list.drawError(o)};var zS=Dn,U1=zS,RS=U1;typeof window<"u"&&(window.Suggestions=U1);var OS="Expected a function",Sx=0/0,BS="[object Symbol]",FS=/^\s+|\s+$/g,NS=/^[-+]0x[0-9a-f]+$/i,jS=/^0b[01]+$/i,VS=/^0o[0-7]+$/i,US=parseInt,GS=typeof Zs=="object"&&Zs&&Zs.Object===Object&&Zs,$S=typeof self=="object"&&self&&self.Object===Object&&self,qS=GS||$S||Function("return this")(),WS=Object.prototype,ZS=WS.toString,HS=Math.max,XS=Math.min,D_=function(){return qS.Date.now()};function YS(o,n,a){var h,d,g,v,r,T,C=0,R=!1,F=!1,U=!0;if(typeof o!="function")throw new TypeError(OS);n=Ax(n)||0,nm(a)&&(R=!!a.leading,F="maxWait"in a,g=F?HS(Ax(a.maxWait)||0,n):g,U="trailing"in a?!!a.trailing:U);function Y(Je){var nt=h,st=d;return h=d=void 0,C=Je,v=o.apply(st,nt),v}function ie(Je){return C=Je,r=setTimeout(be,n),R?Y(Je):v}function ce(Je){var nt=Je-T,st=Je-C,De=n-nt;return F?XS(De,g-st):De}function he(Je){var nt=Je-T,st=Je-C;return T===void 0||nt>=n||nt<0||F&&st>=g}function be(){var Je=D_();if(he(Je))return Le(Je);r=setTimeout(be,ce(Je))}function Le(Je){return r=void 0,U&&h?Y(Je):(h=d=void 0,v)}function Fe(){r!==void 0&&clearTimeout(r),C=0,h=T=d=r=void 0}function qe(){return r===void 0?v:Le(D_())}function Re(){var Je=D_(),nt=he(Je);if(h=arguments,d=this,T=Je,nt){if(r===void 0)return ie(T);if(F)return r=setTimeout(be,n),Y(T)}return r===void 0&&(r=setTimeout(be,n)),v}return Re.cancel=Fe,Re.flush=qe,Re}function nm(o){var n=typeof o;return!!o&&(n=="object"||n=="function")}function KS(o){return!!o&&typeof o=="object"}function JS(o){return typeof o=="symbol"||KS(o)&&ZS.call(o)==BS}function Ax(o){if(typeof o=="number")return o;if(JS(o))return Sx;if(nm(o)){var n=typeof o.valueOf=="function"?o.valueOf():o;o=nm(n)?n+"":n}if(typeof o!="string")return o===0?o:+o;o=o.replace(FS,"");var a=jS.test(o);return a||VS.test(o)?US(o.slice(2),a?2:8):NS.test(o)?Sx:+o}var QS=YS,vm={exports:{}},Yl=typeof Reflect=="object"?Reflect:null,Ix=Yl&&typeof Yl.apply=="function"?Yl.apply:function(n,a,h){return Function.prototype.apply.call(n,a,h)},yp;Yl&&typeof Yl.ownKeys=="function"?yp=Yl.ownKeys:Object.getOwnPropertySymbols?yp=function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:yp=function(n){return Object.getOwnPropertyNames(n)};function eA(o){console&&console.warn&&console.warn(o)}var G1=Number.isNaN||function(n){return n!==n};function Ti(){Ti.init.call(this)}vm.exports=Ti;vm.exports.once=sA;Ti.EventEmitter=Ti;Ti.prototype._events=void 0;Ti.prototype._eventsCount=0;Ti.prototype._maxListeners=void 0;var Cx=10;function Op(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}Object.defineProperty(Ti,"defaultMaxListeners",{enumerable:!0,get:function(){return Cx},set:function(o){if(typeof o!="number"||o<0||G1(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");Cx=o}});Ti.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ti.prototype.setMaxListeners=function(n){if(typeof n!="number"||n<0||G1(n))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+n+".");return this._maxListeners=n,this};function $1(o){return o._maxListeners===void 0?Ti.defaultMaxListeners:o._maxListeners}Ti.prototype.getMaxListeners=function(){return $1(this)};Ti.prototype.emit=function(n){for(var a=[],h=1;h<arguments.length;h++)a.push(arguments[h]);var d=n==="error",g=this._events;if(g!==void 0)d=d&&g.error===void 0;else if(!d)return!1;if(d){var v;if(a.length>0&&(v=a[0]),v instanceof Error)throw v;var r=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw r.context=v,r}var T=g[n];if(T===void 0)return!1;if(typeof T=="function")Ix(T,this,a);else for(var C=T.length,R=X1(T,C),h=0;h<C;++h)Ix(R[h],this,a);return!0};function q1(o,n,a,h){var d,g,v;if(Op(a),g=o._events,g===void 0?(g=o._events=Object.create(null),o._eventsCount=0):(g.newListener!==void 0&&(o.emit("newListener",n,a.listener?a.listener:a),g=o._events),v=g[n]),v===void 0)v=g[n]=a,++o._eventsCount;else if(typeof v=="function"?v=g[n]=h?[a,v]:[v,a]:h?v.unshift(a):v.push(a),d=$1(o),d>0&&v.length>d&&!v.warned){v.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=o,r.type=n,r.count=v.length,eA(r)}return o}Ti.prototype.addListener=function(n,a){return q1(this,n,a,!1)};Ti.prototype.on=Ti.prototype.addListener;Ti.prototype.prependListener=function(n,a){return q1(this,n,a,!0)};function tA(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function W1(o,n,a){var h={fired:!1,wrapFn:void 0,target:o,type:n,listener:a},d=tA.bind(h);return d.listener=a,h.wrapFn=d,d}Ti.prototype.once=function(n,a){return Op(a),this.on(n,W1(this,n,a)),this};Ti.prototype.prependOnceListener=function(n,a){return Op(a),this.prependListener(n,W1(this,n,a)),this};Ti.prototype.removeListener=function(n,a){var h,d,g,v,r;if(Op(a),d=this._events,d===void 0)return this;if(h=d[n],h===void 0)return this;if(h===a||h.listener===a)--this._eventsCount===0?this._events=Object.create(null):(delete d[n],d.removeListener&&this.emit("removeListener",n,h.listener||a));else if(typeof h!="function"){for(g=-1,v=h.length-1;v>=0;v--)if(h[v]===a||h[v].listener===a){r=h[v].listener,g=v;break}if(g<0)return this;g===0?h.shift():iA(h,g),h.length===1&&(d[n]=h[0]),d.removeListener!==void 0&&this.emit("removeListener",n,r||a)}return this};Ti.prototype.off=Ti.prototype.removeListener;Ti.prototype.removeAllListeners=function(n){var a,h,d;if(h=this._events,h===void 0)return this;if(h.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):h[n]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete h[n]),this;if(arguments.length===0){var g=Object.keys(h),v;for(d=0;d<g.length;++d)v=g[d],v!=="removeListener"&&this.removeAllListeners(v);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(a=h[n],typeof a=="function")this.removeListener(n,a);else if(a!==void 0)for(d=a.length-1;d>=0;d--)this.removeListener(n,a[d]);return this};function Z1(o,n,a){var h=o._events;if(h===void 0)return[];var d=h[n];return d===void 0?[]:typeof d=="function"?a?[d.listener||d]:[d]:a?nA(d):X1(d,d.length)}Ti.prototype.listeners=function(n){return Z1(this,n,!0)};Ti.prototype.rawListeners=function(n){return Z1(this,n,!1)};Ti.listenerCount=function(o,n){return typeof o.listenerCount=="function"?o.listenerCount(n):H1.call(o,n)};Ti.prototype.listenerCount=H1;function H1(o){var n=this._events;if(n!==void 0){var a=n[o];if(typeof a=="function")return 1;if(a!==void 0)return a.length}return 0}Ti.prototype.eventNames=function(){return this._eventsCount>0?yp(this._events):[]};function X1(o,n){for(var a=new Array(n),h=0;h<n;++h)a[h]=o[h];return a}function iA(o,n){for(;n+1<o.length;n++)o[n]=o[n+1];o.pop()}function nA(o){for(var n=new Array(o.length),a=0;a<n.length;++a)n[a]=o[a].listener||o[a];return n}function sA(o,n){return new Promise(function(a,h){function d(v){o.removeListener(n,g),h(v)}function g(){typeof o.removeListener=="function"&&o.removeListener("error",d),a([].slice.call(arguments))}Y1(o,n,g,{once:!0}),n!=="error"&&rA(o,d,{once:!0})})}function rA(o,n,a){typeof o.on=="function"&&Y1(o,"error",n,a)}function Y1(o,n,a,h){if(typeof o.on=="function")h.once?o.once(n,a):o.on(n,a);else if(typeof o.addEventListener=="function")o.addEventListener(n,function d(g){h.once&&o.removeEventListener(n,d),a(g)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o)}var oA=vm.exports,aA={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function lA(o){var n=o.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return n?{key:n[1],value:n[2]}:null}function cA(o){var n=o.match(/<?([^>]*)>(.*)/);if(!n)return null;var a=n[1],h=n[2].split(";"),d=null,g=h.reduce(function(v,r){var T=lA(r);return T?T.key==="rel"?(d||(d=T.value),v):(v[T.key]=T.value,v):v},{});return d?{url:a,rel:d,params:g}:null}function hA(o){return o?o.split(/,\s*</).reduce(function(n,a){var h=cA(a);if(!h)return n;var d=h.rel.split(/\s+/);return d.forEach(function(g){n[g]||(n[g]={url:h.url,params:h.params})}),n},{}):{}}var uA=hA,dA=uA;function bm(o,n){this.request=o,this.headers=n.headers,this.rawBody=n.body,this.statusCode=n.statusCode;try{this.body=JSON.parse(n.body||"{}")}catch{this.body=n.body}this.links=dA(this.headers.link)}bm.prototype.hasNextPage=function(){return!!this.links.next};bm.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var pA=bm,Bp={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},Px=Bp;function fA(o){var n=o.type||Px.ERROR_HTTP,a;if(o.body)try{a=JSON.parse(o.body)}catch{a=o.body}else a=null;var h=o.message||null;h||(typeof a=="string"?h=a:a&&typeof a.message=="string"?h=a.message:n===Px.ERROR_REQUEST_ABORTED&&(h="Request aborted")),this.message=h,this.type=n,this.statusCode=o.statusCode||null,this.request=o.request,this.body=a}var _A=fA;function mA(o){var n=o.indexOf(":"),a=o.substring(0,n).trim().toLowerCase(),h=o.substring(n+1).trim();return{name:a,value:h}}function gA(o){var n={};return o&&o.trim().split(/[\r|\n]+/).forEach(function(a){var h=mA(a);n[h.name]=h.value}),n}var yA=gA,xA=pA,kx=_A,z_=Bp,vA=yA,Ap={};function bA(o){var n=Ap[o.id];n&&(n.abort(),delete Ap[o.id])}function wA(o,n){return new xA(o,{body:n.response,headers:vA(n.getAllResponseHeaders()),statusCode:n.status})}function Lx(o){var n=o.total,a=o.loaded,h=100*a/n;return{total:n,transferred:a,percent:h}}function K1(o,n){return new Promise(function(a,h){n.onprogress=function(v){o.emitter.emit(z_.EVENT_PROGRESS_DOWNLOAD,Lx(v))};var d=o.file;d&&(n.upload.onprogress=function(v){o.emitter.emit(z_.EVENT_PROGRESS_UPLOAD,Lx(v))}),n.onerror=function(v){h(v)},n.onabort=function(){var v=new kx({request:o,type:z_.ERROR_REQUEST_ABORTED});h(v)},n.onload=function(){if(delete Ap[o.id],n.status<200||n.status>=400){var v=new kx({request:o,body:n.response,statusCode:n.status});h(v);return}a(n)};var g=o.body;typeof g=="string"?n.send(g):g?n.send(JSON.stringify(g)):d?n.send(d):n.send(),Ap[o.id]=n}).then(function(a){return wA(o,a)})}function J1(o,n){var a=o.url(n),h=new window.XMLHttpRequest;return h.open(o.method,a),Object.keys(o.headers).forEach(function(d){h.setRequestHeader(d,o.headers[d])}),h}function TA(o){return Promise.resolve().then(function(){var n=J1(o,o.client.accessToken);return K1(o,n)})}var EA={browserAbort:bA,sendRequestXhr:K1,browserSend:TA,createRequestXhr:J1},Ip={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */Ip.exports;(function(o,n){(function(a){var h=n,d=o&&o.exports==h&&o,g=typeof Zs=="object"&&Zs;(g.global===g||g.window===g)&&(a=g);var v=function(ie){this.message=ie};v.prototype=new Error,v.prototype.name="InvalidCharacterError";var r=function(ie){throw new v(ie)},T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",C=/[\t\n\f\r ]/g,R=function(ie){ie=String(ie).replace(C,"");var ce=ie.length;ce%4==0&&(ie=ie.replace(/==?$/,""),ce=ie.length),(ce%4==1||/[^+a-zA-Z0-9/]/.test(ie))&&r("Invalid character: the string to be decoded is not correctly encoded.");for(var he=0,be,Le,Fe="",qe=-1;++qe<ce;)Le=T.indexOf(ie.charAt(qe)),be=he%4?be*64+Le:Le,he++%4&&(Fe+=String.fromCharCode(255&be>>(-2*he&6)));return Fe},F=function(ie){ie=String(ie),/[^\0-\xFF]/.test(ie)&&r("The string to be encoded contains characters outside of the Latin1 range.");for(var ce=ie.length%3,he="",be=-1,Le,Fe,qe,Re,Je=ie.length-ce;++be<Je;)Le=ie.charCodeAt(be)<<16,Fe=ie.charCodeAt(++be)<<8,qe=ie.charCodeAt(++be),Re=Le+Fe+qe,he+=T.charAt(Re>>18&63)+T.charAt(Re>>12&63)+T.charAt(Re>>6&63)+T.charAt(Re&63);return ce==2?(Le=ie.charCodeAt(be)<<8,Fe=ie.charCodeAt(++be),Re=Le+Fe,he+=T.charAt(Re>>10)+T.charAt(Re>>4&63)+T.charAt(Re<<2&63)+"="):ce==1&&(Re=ie.charCodeAt(be),he+=T.charAt(Re>>2)+T.charAt(Re<<4&63)+"=="),he},U={encode:F,decode:R,version:"0.1.0"};if(h&&!h.nodeType)if(d)d.exports=U;else for(var Y in U)U.hasOwnProperty(Y)&&(h[Y]=U[Y]);else a.base64=U})(Zs)})(Ip,Ip.exports);var MA=Ip.exports,SA=MA,R_={};function AA(o){if(R_[o])return R_[o];var n=o.split("."),a=n[0],h=n[1];if(!h)throw new Error("Invalid token");var d=IA(h),g={usage:a,user:d.u};return za(d,"a")&&(g.authorization=d.a),za(d,"exp")&&(g.expires=d.exp*1e3),za(d,"iat")&&(g.created=d.iat*1e3),za(d,"scopes")&&(g.scopes=d.scopes),za(d,"client")&&(g.client=d.client),za(d,"ll")&&(g.lastLogin=d.ll),za(d,"iu")&&(g.impersonator=d.iu),R_[o]=g,g}function IA(o){try{return JSON.parse(SA.decode(o))}catch{throw new Error("Invalid token")}}function za(o,n){return Object.prototype.hasOwnProperty.call(o,n)}var Q1=AA,ev={exports:{}};(function(o){var n=Object.prototype.hasOwnProperty,a="~";function h(){}Object.create&&(h.prototype=Object.create(null),new h().__proto__||(a=!1));function d(T,C,R){this.fn=T,this.context=C,this.once=R||!1}function g(T,C,R,F,U){if(typeof R!="function")throw new TypeError("The listener must be a function");var Y=new d(R,F||T,U),ie=a?a+C:C;return T._events[ie]?T._events[ie].fn?T._events[ie]=[T._events[ie],Y]:T._events[ie].push(Y):(T._events[ie]=Y,T._eventsCount++),T}function v(T,C){--T._eventsCount===0?T._events=new h:delete T._events[C]}function r(){this._events=new h,this._eventsCount=0}r.prototype.eventNames=function(){var C=[],R,F;if(this._eventsCount===0)return C;for(F in R=this._events)n.call(R,F)&&C.push(a?F.slice(1):F);return Object.getOwnPropertySymbols?C.concat(Object.getOwnPropertySymbols(R)):C},r.prototype.listeners=function(C){var R=a?a+C:C,F=this._events[R];if(!F)return[];if(F.fn)return[F.fn];for(var U=0,Y=F.length,ie=new Array(Y);U<Y;U++)ie[U]=F[U].fn;return ie},r.prototype.listenerCount=function(C){var R=a?a+C:C,F=this._events[R];return F?F.fn?1:F.length:0},r.prototype.emit=function(C,R,F,U,Y,ie){var ce=a?a+C:C;if(!this._events[ce])return!1;var he=this._events[ce],be=arguments.length,Le,Fe;if(he.fn){switch(he.once&&this.removeListener(C,he.fn,void 0,!0),be){case 1:return he.fn.call(he.context),!0;case 2:return he.fn.call(he.context,R),!0;case 3:return he.fn.call(he.context,R,F),!0;case 4:return he.fn.call(he.context,R,F,U),!0;case 5:return he.fn.call(he.context,R,F,U,Y),!0;case 6:return he.fn.call(he.context,R,F,U,Y,ie),!0}for(Fe=1,Le=new Array(be-1);Fe<be;Fe++)Le[Fe-1]=arguments[Fe];he.fn.apply(he.context,Le)}else{var qe=he.length,Re;for(Fe=0;Fe<qe;Fe++)switch(he[Fe].once&&this.removeListener(C,he[Fe].fn,void 0,!0),be){case 1:he[Fe].fn.call(he[Fe].context);break;case 2:he[Fe].fn.call(he[Fe].context,R);break;case 3:he[Fe].fn.call(he[Fe].context,R,F);break;case 4:he[Fe].fn.call(he[Fe].context,R,F,U);break;default:if(!Le)for(Re=1,Le=new Array(be-1);Re<be;Re++)Le[Re-1]=arguments[Re];he[Fe].fn.apply(he[Fe].context,Le)}}return!0},r.prototype.on=function(C,R,F){return g(this,C,R,F,!1)},r.prototype.once=function(C,R,F){return g(this,C,R,F,!0)},r.prototype.removeListener=function(C,R,F,U){var Y=a?a+C:C;if(!this._events[Y])return this;if(!R)return v(this,Y),this;var ie=this._events[Y];if(ie.fn)ie.fn===R&&(!U||ie.once)&&(!F||ie.context===F)&&v(this,Y);else{for(var ce=0,he=[],be=ie.length;ce<be;ce++)(ie[ce].fn!==R||U&&!ie[ce].once||F&&ie[ce].context!==F)&&he.push(ie[ce]);he.length?this._events[Y]=he.length===1?he[0]:he:v(this,Y)}return this},r.prototype.removeAllListeners=function(C){var R;return C?(R=a?a+C:C,this._events[R]&&v(this,R)):(this._events=new h,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=a,r.EventEmitter=r,o.exports=r})(ev);var CA=ev.exports;function PA(o){return o.map(encodeURIComponent).join(",")}function tv(o){return Array.isArray(o)?PA(o):encodeURIComponent(String(o))}function iv(o,n,a){if(a===!1||a===null)return o;var h=/\?/.test(o)?"&":"?",d=encodeURIComponent(n);return a!==void 0&&a!==""&&a!==!0&&(d+="="+tv(a)),""+o+h+d}function kA(o,n){if(!n)return o;var a=o;return Object.keys(n).forEach(function(h){var d=n[h];d!==void 0&&(Array.isArray(d)&&(d=d.filter(function(g){return g!=null}).join(",")),a=iv(a,h,d))}),a}function LA(o,n){if(!n||o.slice(0,4)==="http")return o;var a=o[0]==="/"?"":"/";return""+n.replace(/\/$/,"")+a+o}function DA(o,n){return n?o.replace(/\/:([a-zA-Z0-9]+)/g,function(a,h){var d=n[h];if(d===void 0)throw new Error("Unspecified route parameter "+h);var g=tv(d);return"/"+g}):o}var zA={appendQueryObject:kA,appendQueryParam:iv,prependOrigin:LA,interpolateRouteParams:DA},RA=Q1,wm=rc,OA=CA,tp=zA,Dx=Bp,BA=1;function Ro(o,n){if(!o)throw new Error("MapiRequest requires a client");if(!n||!n.path||!n.method)throw new Error("MapiRequest requires an options object with path and method properties");var a={};n.body&&(a["content-type"]="application/json");var h=wm(a,n.headers),d=Object.keys(h).reduce(function(g,v){return g[v.toLowerCase()]=h[v],g},{});this.id=BA++,this._options=n,this.emitter=new OA,this.client=o,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=n.path,this.method=n.method,this.origin=n.origin||o.origin,this.query=n.query||{},this.params=n.params||{},this.body=n.body||null,this.file=n.file||null,this.encoding=n.encoding||"utf8",this.sendFileAs=n.sendFileAs||null,this.headers=d}Ro.prototype.url=function(n){var a=tp.prependOrigin(this.path,this.origin);a=tp.appendQueryObject(a,this.query);var h=this.params,d=n??this.client.accessToken;if(d){a=tp.appendQueryParam(a,"access_token",d);var g=RA(d).user;h=wm({ownerId:g},h)}return a=tp.interpolateRouteParams(a,h),a};Ro.prototype.send=function(){var n=this;if(n.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return n.sent=!0,n.client.sendRequest(n).then(function(a){return n.response=a,n.emitter.emit(Dx.EVENT_RESPONSE,a),a},function(a){throw n.error=a,n.emitter.emit(Dx.EVENT_ERROR,a),a})};Ro.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Ro.prototype.eachPage=function(n){var a=this;function h(v){function r(){delete a._nextPageRequest;var T=v.nextPage();T&&(a._nextPageRequest=T,g(T))}n(null,v,r)}function d(v){n(v,null,function(){})}function g(v){v.send().then(h,d)}g(this)};Ro.prototype.clone=function(){return this._extend()};Ro.prototype._extend=function(n){var a=wm(this._options,n);return new Ro(this.client,a)};var FA=Ro,NA=Q1,jA=FA,VA=Bp;function nv(o){if(!o||!o.accessToken)throw new Error("Cannot create a client without an access token");NA(o.accessToken),this.accessToken=o.accessToken,this.origin=o.origin||VA.API_ORIGIN}nv.prototype.createRequest=function(n){return new jA(this,n)};var sv=nv,rv=EA,ov=sv;function sc(o){ov.call(this,o)}sc.prototype=Object.create(ov.prototype);sc.prototype.constructor=sc;sc.prototype.sendRequest=rv.browserSend;sc.prototype.abortRequest=rv.browserAbort;function UA(o){return new sc(o)}var av=UA,GA=av,$A=GA,qA=Object.prototype.toString,WA=function(o){var n;return qA.call(o)==="[object Object]"&&(n=Object.getPrototypeOf(o),n===null||n===Object.getPrototypeOf({}))},ZA=WA,HA=rc,lv="value",O_=`
  `,Ci={};Ci.assert=function(o,n){return n=n||{},function(a){var h=Oo(o,a);if(h){var d=Tm(h,n);throw n.apiName&&(d=n.apiName+": "+d),new Error(d)}}};Ci.shape=function(n){var a=JA(n);return function(d){var g=Oo(Ci.plainObject,d);if(g)return g;for(var v,r,T=[],C=0;C<a.length;C++)v=a[C].key,r=a[C].value,g=Oo(r,d[v]),g&&T.push([v].concat(g));return T.length<2?T[0]:function(R){T=T.map(function(Y){var ie=Y[0],ce=Tm(Y,R).split(`
`).join(O_);return"- "+ie+": "+ce});var F=R.path.join("."),U=F===lv?"":" of "+F;return"The following properties"+U+" have invalid values:"+O_+T.join(O_)}}};Ci.strictShape=function(n){var a=Ci.shape(n);return function(d){var g=a(d);if(g)return g;var v=Object.keys(d).reduce(function(r,T){return n[T]===void 0&&r.push(T),r},[]);if(v.length!==0)return function(){return"The following keys are invalid: "+v.join(", ")}}};Ci.arrayOf=function(n){return cv(n)};Ci.tuple=function(){var n=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return cv(n)};function cv(o){var n=Array.isArray(o),a=function(h){return n?o[h]:o};return function(d){var g=Oo(Ci.plainArray,d);if(g)return g;if(n&&d.length!==o.length)return"an array with "+o.length+" items";for(var v=0;v<d.length;v++)if(g=Oo(a(v),d[v]),g)return[v].concat(g)}}Ci.required=function(n){function a(h){return h==null?function(d){return hv(d,uv(d.path)?"cannot be undefined/null.":"is required.")}:n.apply(this,arguments)}return a.__required=!0,a};Ci.oneOfType=function(){var n=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(h){var d=n.map(function(g){return Oo(g,h)}).filter(Boolean);if(d.length===n.length)return d.every(function(g){return g.length===1&&typeof g[0]=="string"})?XA(d.map(function(g){return g[0]})):d.reduce(function(g,v){return v.length>g.length?v:g})}};Ci.equal=function(n){return function(h){if(h!==n)return JSON.stringify(n)}};Ci.oneOf=function(){var n=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),a=n.map(function(h){return Ci.equal(h)});return Ci.oneOfType.apply(this,a)};Ci.range=function(n){var a=n[0],h=n[1];return function(g){var v=Oo(Ci.number,g);if(v||g<a||g>h)return"number between "+a+" & "+h+" (inclusive)"}};Ci.any=function(){};Ci.boolean=function(n){if(typeof n!="boolean")return"boolean"};Ci.number=function(n){if(typeof n!="number")return"number"};Ci.plainArray=function(n){if(!Array.isArray(n))return"array"};Ci.plainObject=function(n){if(!ZA(n))return"object"};Ci.string=function(n){if(typeof n!="string")return"string"};Ci.func=function(n){if(typeof n!="function")return"function"};function Oo(o,n){if(!(n==null&&!o.hasOwnProperty("__required"))){var a=o(n);if(a)return Array.isArray(a)?a:[a]}}function Tm(o,n){var a=o.length,h=o[a-1],d=o.slice(0,a-1);return d.length===0&&(d=[lv]),n=HA(n,{path:d}),typeof h=="function"?h(n):hv(n,YA(h))}function XA(o){return o.length<2?o[0]:o.length===2?o.join(" or "):o.slice(0,-1).join(", ")+", or "+o.slice(-1)}function YA(o){return"must be "+KA(o)+"."}function KA(o){return/^an? /.test(o)?o:/^[aeiou]/i.test(o)?"an "+o:/^[a-z]/i.test(o)?"a "+o:o}function hv(o,n){var a=uv(o.path),h=o.path.join(".")+" "+n,d=a?"Item at position ":"";return d+h}function uv(o){return typeof o[o.length-1]=="number"||typeof o[0]=="number"}function JA(o){return Object.keys(o||{}).map(function(n){return{key:n,value:o[n]}})}Ci.validate=Oo;Ci.processMessage=Tm;var QA=Ci,eI=rc,Kl=QA;function tI(o){if(typeof window<"u")return o instanceof Zs.Blob||o instanceof Zs.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof o=="string"||o.pipe!==void 0))return"Filename or Readable stream"}function iI(o,n){return Kl.assert(Kl.strictShape(o),n)}function nI(o){var n="date";if(typeof o=="boolean")return n;try{var a=new Date(o);if(a.getTime&&isNaN(a.getTime()))return n}catch{return n}}function sI(o){return Kl.tuple(Kl.number,Kl.number)(o)}var rI=eI(Kl,{file:tI,date:nI,coordinates:sI,assertShape:iI});function oI(o,n){var a=function(h,d){return n.indexOf(h)!==-1&&d!==void 0};return typeof n=="function"&&(a=n),Object.keys(o).filter(function(h){return a(h,o[h])}).reduce(function(h,d){return h[d]=o[d],h},{})}var aI=oI;function lI(o,n){return Object.keys(o).reduce(function(a,h){return a[h]=n(h,o[h]),a},{})}var cI=lI,hI=cI;function uI(o){return hI(o,function(n,a){return typeof a=="boolean"?JSON.stringify(a):a})}var dI=uI,pI=sv,fI=av;function _I(o){return function(n){var a;pI.prototype.isPrototypeOf(n)?a=n:a=fI(n);var h=Object.create(o);return h.client=a,h}}var mI=_I,dv=rc,Qt=rI,Cp=aI,pv=dI,gI=mI,Em={},fv=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Em.forwardGeocode=function(o){Qt.assertShape({query:Qt.required(Qt.string),mode:Qt.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qt.arrayOf(Qt.string),proximity:Qt.oneOf(Qt.coordinates,"ip"),types:Qt.arrayOf(Qt.oneOf(fv)),autocomplete:Qt.boolean,bbox:Qt.arrayOf(Qt.number),limit:Qt.number,language:Qt.arrayOf(Qt.string),routing:Qt.boolean,fuzzyMatch:Qt.boolean,worldview:Qt.string})(o),o.mode=o.mode||"mapbox.places";var n=pv(dv({country:o.countries},Cp(o,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Cp(o,["mode","query"]),query:n})};Em.reverseGeocode=function(o){Qt.assertShape({query:Qt.required(Qt.coordinates),mode:Qt.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qt.arrayOf(Qt.string),types:Qt.arrayOf(Qt.oneOf(fv)),bbox:Qt.arrayOf(Qt.number),limit:Qt.number,language:Qt.arrayOf(Qt.string),reverseMode:Qt.oneOf("distance","score"),routing:Qt.boolean,worldview:Qt.string})(o),o.mode=o.mode||"mapbox.places";var n=pv(dv({country:o.countries},Cp(o,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Cp(o,["mode","query"]),query:n})};var yI=gI(Em);let xI="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",_v=o=>crypto.getRandomValues(new Uint8Array(o)),mv=(o,n,a)=>{let h=(2<<Math.log(o.length-1)/Math.LN2)-1,d=-~(1.6*h*n/o.length);return(g=n)=>{let v="";for(;;){let r=a(d),T=d;for(;T--;)if(v+=o[r[T]&h]||"",v.length===g)return v}}},vI=(o,n=21)=>mv(o,n,_v),bI=(o=21)=>crypto.getRandomValues(new Uint8Array(o)).reduce((n,a)=>(a&=63,a<36?n+=a.toString(36):a<62?n+=(a-26).toString(36).toUpperCase():a>62?n+="-":n+="_",n),"");const wI=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:vI,customRandom:mv,nanoid:bI,random:_v,urlAlphabet:xI},Symbol.toStringTag,{value:"Module"})),TI=MS(wI);var EI=TI.nanoid;function gv(o){this.origin=o.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=o.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=o,this.send=this.send.bind(this),this.countries=o.countries?o.countries.split(","):null,this.types=o.types?o.types.split(","):null,this.bbox=o.bbox?o.bbox:null,this.language=o.language?o.language.split(","):null,this.limit=o.limit?+o.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(o),this.eventQueue=new Array,this.flushInterval=o.flushInterval||1e3,this.maxQueueSize=o.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}gv.prototype={select:function(o,n){var a=this.getSelectedIndex(o,n),h=this.getEventPayload("search.select",n);if(h.resultIndex=a,h.resultPlaceName=o.place_name,h.resultId=o.id,!(a===this.lastSentIndex&&h.queryString===this.lastSentInput||a==-1)&&(this.lastSentIndex=a,this.lastSentInput=h.queryString,!!h.queryString))return this.push(h)},start:function(o){var n=this.getEventPayload("search.start",o);if(n.queryString)return this.push(n)},keyevent:function(o,n){if(o.key&&!(o.metaKey||[9,27,37,39,13,38,40].indexOf(o.keyCode)!==-1)){var a=this.getEventPayload("search.keystroke",n);if(a.lastAction=o.key,!!a.queryString)return this.push(a)}},send:function(o,n){if(!this.enableEventLogging)return n?n():void 0;var a=this.getRequestOptions(o);this.request(a,(function(h){if(h)return this.handleError(h,n);if(n)return n()}).bind(this))},getRequestOptions:function(o){Array.isArray(o)||(o=[o]);var n={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};return n},getEventPayload:function(o,n){var a;n.options.proximity?typeof n.options.proximity=="object"?a=[n.options.proximity.longitude,n.options.proximity.latitude]:n.options.proximity==="ip"?a=[999,999]:a=n.options.proximity:a=null;var h=n._map?n._map.getZoom():void 0,d={event:o,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:n.options.autocomplete,fuzzyMatch:n.options.fuzzyMatch,proximity:a,limit:n.options.limit,routing:n.options.routing,worldview:n.options.worldview,mapZoom:h,keyboardLocale:this.locale};return o==="search.select"?d.queryString=n.inputString:o!="search.select"&&n._inputEl?d.queryString=n._inputEl.value:d.queryString=n.inputString,d},request:function(o,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(this.readyState==4)return this.status==204?n(null):n(this.statusText)},a.open(o.method,o.host+"/"+o.path,!0);for(var h in o.headers){var d=o.headers[h];a.setRequestHeader(h,d)}a.send(o.body)},handleError:function(o,n){if(n)return n(o)},generateSessionID:function(){return EI()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(o,n){if(n._typeahead){var a=n._typeahead.data,h=o.id,d=a.map(function(v){return v.id}),g=d.indexOf(h);return g}},shouldEnableLogging:function(o){return!(o.enableEventLogging===!1||o.origin&&o.origin!=="https://api.mapbox.com"||o.localGeocoder||o.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(o,n){this.eventQueue.push(o),(this.eventQueue.length>=this.maxQueueSize||n)&&this.flush()},remove:function(){this.flush()}};var MI=gv,SI={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},AI={placeholder:SI},yv={exports:{}};(function(o){(function(n,a,h){o.exports?o.exports=h():n[a]=h()})(Zs,"subtag",function(){var n="",a=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function h(T){return T.match(a)||[]}function d(T){return h(T).filter(function(C,R){return C&&R})}function g(T){return T=h(T),{language:T[1]||n,extlang:T[2]||n,script:T[3]||n,region:T[4]||n}}function v(T,C,R){Object.defineProperty(T,C,{value:R,enumerable:!0})}function r(T,C,R){function F(U){return h(U)[T]||n}v(F,"pattern",C),v(g,R,F)}return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),v(g,"split",d),g})})(yv);var II=yv.exports;function xv(){}xv.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const o={enableHighAccuracy:!0};return new Promise(function(n,a){window.navigator.geolocation.getCurrentPosition(n,a,o)})}};var CI=xv;function PI(o,n){const a=vv(o),h=["address","street","place","country"];var d;if(typeof n=="function")return n(a);const g=h.indexOf(n);return g===-1?d=h:d=h.slice(g),d.reduce(function(v,r){return a[r]?(v!==""&&(v=v+", "),v+a[r]):v},"")}function vv(o){const n=o.address||"",a=o.text||"",h=o.place_name||"",g={address:h.split(",")[0],houseNumber:n,street:a,placeName:h};return o.context.forEach(function(v){const r=v.id.split(".")[0];g[r]=v.text}),g}const kI=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var LI={transformFeatureToGeolocationText:PI,getAddressInfo:vv,REVERSE_GEOCODE_COORD_RGX:kI},DI=RS,zI=QS,Fa=rc,RI=oA.EventEmitter,zx=aA,B_=$A,F_=yI,OI=MI,BI=AI,FI=II,NI=CI,Rx=LI;const Mo={FORWARD:0,LOCAL:1,REVERSE:2};function jI(){var o=document.createElement("div");return o.className="mapboxgl-ctrl-geocoder--powered-by",o.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',o}function bv(o){this._eventEmitter=new RI,this.options=Fa({},this.options,o),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new NI}bv.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(o){return o.place_name},render:function(o){var n=o.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+n[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+n.splice(1,n.length).join(",")+"</div></div>"}},addTo:function(o){function n(a,h){if(!document.body.contains(h))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const d=a.onAdd();h.appendChild(d)}if(o._controlContainer)o.addControl(this);else if(o instanceof HTMLElement)n(this,o);else if(typeof o=="string"){const a=document.querySelectorAll(o);if(a.length===0)throw new Error("Element ",o,"not found.");if(a.length>1)throw new Error("Geocoder can only be added to a single html element");n(this,a[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(o){if(o&&typeof o!="string"&&(this._map=o),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=F_(B_({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new OI(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var n=this.container=document.createElement("div");n.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var a=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",zI(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(C){this.eventManager.keyevent(C,this)}).bind(this));var h=document.createElement("div");h.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var d=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(d),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),h.appendChild(this._clearEl),h.appendChild(this._loadingEl),n.appendChild(a),n.appendChild(this._inputEl),n.appendChild(h),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var g=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(g),h.appendChild(this._geolocateEl),this._showGeolocateButton()}var v=this._typeahead=new DI(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),v.getItemValue=this.options.getItemValue;var r=v.list.draw,T=this._footerNode=jI();return v.list.draw=function(){r.call(this),T.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),T.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(T)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),n},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(o){this._hideLoadingIcon();const n={geometry:{type:"Point",coordinates:[o.coords.longitude,o.coords.latitude]}};this._handleMarker(n),this._fly(n),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(n),this._showClearButton(),this.fresh=!1;const a={limit:1,language:[this.options.language],query:n.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const h=n.geometry.coordinates[0]+","+n.geometry.coordinates[1];this._setInputValue(h),this._eventEmitter.emit("result",{result:n})}else this.geocoderService.reverseGeocode(a).send().then((function(h){const d=h.body.features[0];if(d){const g=Rx.transformFeatureToGeolocationText(d,this.options.addressAccuracy);this._setInputValue(g),d.user_coordinates=n.geometry.coordinates,this._eventEmitter.emit("result",{result:d})}else this._eventEmitter.emit("result",{result:{user_coordinates:n.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(o){o.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(o,n){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+o),a.setAttribute("viewBox","0 0 18 18"),a.setAttribute("xml:space","preserve"),a.setAttribute("width",18),a.setAttribute("height",18),a.innerHTML=n,a},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(o){this._inputEl.value=o,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(o){var n=(o.clipboardData||window.clipboardData).getData("text");n.length>=this.options.minLength&&this._geocode(n)},_onKeyDown:function(o){var n=27,a=9;if(o.keyCode===n&&this.options.clearAndBlurOnEsc)return this._clear(o),this._inputEl.blur();var h=o.target&&o.target.shadowRoot?o.target.shadowRoot.activeElement:o.target,d=h?h.value:"";if(!d)return this.fresh=!0,o.keyCode!==a&&this.clear(o),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(o.metaKey||[a,n,37,39,13,38,40].indexOf(o.keyCode)!==-1)&&h.value.length>=this.options.minLength&&this._geocode(h.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(o){this.options.clearOnBlur&&this._clearOnBlur(o),this.options.collapsed&&this._collapse()},_onChange:function(){var o=this._typeahead.selected;o&&JSON.stringify(o)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(o),this.options.marker&&this._mapboxgl&&this._handleMarker(o),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(o),this._eventEmitter.emit("result",{result:o}),this.eventManager.select(o,this))},_fly:function(o){var n;if(o.properties&&zx[o.properties.short_code])n=Fa({},this.options.flyTo),this._map&&this._map.fitBounds(zx[o.properties.short_code].bbox,n);else if(o.bbox){var a=o.bbox;n=Fa({},this.options.flyTo),this._map&&this._map.fitBounds([[a[0],a[1]],[a[2],a[3]]],n)}else{var h={zoom:this.options.zoom};n=Fa({},h,this.options.flyTo),o.center?n.center=o.center:o.geometry&&o.geometry.type&&o.geometry.type==="Point"&&o.geometry.coordinates&&(n.center=o.geometry.coordinates),this._map&&this._map.flyTo(n)}},_requestType:function(o,n){var a;return o.localGeocoderOnly?a=Mo.LOCAL:o.reverseGeocode&&Rx.REVERSE_GEOCODE_COORD_RGX.test(n)?a=Mo.REVERSE:a=Mo.FORWARD,a},_setupConfig:function(o,n){const a=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],h=/[\s,]+/;var d=this,g=a.reduce(function(r,T){if(d.options[T]===void 0||d.options[T]===null)return r;["countries","types","language"].indexOf(T)>-1?r[T]=d.options[T].split(h):r[T]=d.options[T];const C=typeof d.options[T].longitude=="number"&&typeof d.options[T].latitude=="number";if(T==="proximity"&&C){const R=d.options[T].longitude,F=d.options[T].latitude;r[T]=[R,F]}return r},{});switch(o){case Mo.REVERSE:{var v=n.split(h).map(function(r){return parseFloat(r,10)});d.options.flipCoordinates||v.reverse(),g.types&&g.types[0],g=Fa(g,{query:v,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(r){r in g&&delete g[r]})}break;case Mo.FORWARD:{const r=n.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(r)&&(n=n.replace(/,/g," ")),g=Fa(g,{query:n})}break}return g},_geocode:function(o){this.inputString=o,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:o});const n=this._requestType(this.options,o),a=this._setupConfig(n,o);var h;switch(n){case Mo.LOCAL:h=Promise.resolve();break;case Mo.FORWARD:h=this.geocoderService.forwardGeocode(a).send();break;case Mo.REVERSE:h=this.geocoderService.reverseGeocode(a).send();break}var d=this.options.localGeocoder?this.options.localGeocoder(o)||[]:[],g=[],v=null;return h.catch((function(r){v=r}).bind(this)).then((function(r){this._hideLoadingIcon();var T={};return r?r.statusCode=="200"&&(T=r.body,T.request=r.request,T.headers=r.headers):T={type:"FeatureCollection",features:[]},T.config=a,this.fresh&&(this.eventManager.start(this),this.fresh=!1),T.features=T.features?d.concat(T.features):d,this.options.externalGeocoder?(g=this.options.externalGeocoder(o,T.features)||Promise.resolve([]),g.then(function(C){return T.features=T.features?C.concat(T.features):C,T},function(){return T})):T}).bind(this)).then((function(r){if(v)throw v;this.options.filter&&r.features.length&&(r.features=r.features.filter(this.options.filter)),r.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",r),this._typeahead.update(r.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",r))}).bind(this)).catch((function(r){this._hideLoadingIcon(),this._hideAttribution(),d.length&&this.options.localGeocoder||g.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(d)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:d}),this._eventEmitter.emit("error",{error:r})}).bind(this)),h},_clear:function(o){o&&o.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(o){this._clear(o),this._inputEl.focus()},_clearOnBlur:function(o){var n=this;o.relatedTarget&&n._clear(o)},_onQueryResult:function(o){var n=o.body;if(n.features.length){var a=n.features[0];this._typeahead.selected=a,this._inputEl.value=a.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var o=this._map.getCenter().wrap();this.setProximity({longitude:o.lng,latitude:o.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(o){return this._geocode(o).then(this._onQueryResult),this},_renderError:function(){var o="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(o)},_renderLocationError:function(){var o="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(o)},_renderNoResults:function(){var o="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(o)},_renderUserDeniedGeolocationError:function(){var o="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(o)},_renderMessage:function(o){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(o)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var o=this.options.language.split(",")[0],n=FI.language(o),a=BI.placeholder[n];if(a)return a}return"Search"},setInput:function(o){return this._inputEl.value=o,this._typeahead.selected=null,this._typeahead.clear(),o.length>=this.options.minLength&&this._geocode(o),this},setProximity:function(o,n=!0){return this.options.proximity=o,n&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(o){return o&&typeof o=="function"&&(this._typeahead.render=o),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(o){var n=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=o||this.options.language||n,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(o){return this.options.zoom=o,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(o){return this.options.flyTo=o,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(o){return this.placeholder=o||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(o){return this.options.bbox=o,this},getCountries:function(){return this.options.countries},setCountries:function(o){return this.options.countries=o,this},getTypes:function(){return this.options.types},setTypes:function(o){return this.options.types=o,this},getMinLength:function(){return this.options.minLength},setMinLength:function(o){return this.options.minLength=o,this._typeahead&&(this._typeahead.options.minLength=o),this},getLimit:function(){return this.options.limit},setLimit:function(o){return this.options.limit=o,this._typeahead&&(this._typeahead.options.limit=o),this},getFilter:function(){return this.options.filter},setFilter:function(o){return this.options.filter=o,this},setOrigin:function(o){return this.options.origin=o,this.geocoderService=F_(B_({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(o){return this.options.accessToken=o,this.geocoderService=F_(B_({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(o){return this.options.autocomplete=o,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(o){return this.options.fuzzyMatch=o,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(o){return this.options.routing=o,this},getRouting:function(){return this.options.routing},setWorldview:function(o){return this.options.worldview=o,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(o){if(this._map){this._removeMarker();var n={color:"#4668F2"},a=Fa({},n,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(a),o.center?this.mapMarker.setLngLat(o.center).addTo(this._map):o.geometry&&o.geometry.type&&o.geometry.type==="Point"&&o.geometry.coordinates&&this.mapMarker.setLngLat(o.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(o,n){return this._eventEmitter.on(o,n),this},off:function(o,n){return this._eventEmitter.removeListener(o,n),this.eventManager.remove(),this}};var VI=bv;const UI=F1(VI);cs.register(...nS);let Ra=["villages-travel-time-simple","villages-travel-time-detailed"],ip=["villages-travel-time-detailed","villages-travel-time-simple"];hu.accessToken="pk.eyJ1IjoiaGlnaGVzdHJvYWQiLCJhIjoiY2lzNjlpa3c3MGQ3cDJ6cDFzMXZpZTNmMCJ9.M1X4AOcuj4n3VT01ze0x5Q";const gi=new hu.Map({container:"map",style:"mapbox://styles/highestroad/clg35ltys000m01nhht5my9n3",center:[29.519,-1.956],zoom:8.2,hash:!0,maxBounds:[[26.856,-4.84],[32.8954,1.0546]],minZoom:7.1}),GI=new hu.NavigationControl;gi.addControl(GI,"bottom-left");let uu=[];for(let o=1;o<=4;o++){let n=document.getElementById("dropdown"+o);uu.push(n)}function Pp(o){return o.replace(/\s/g,"")}nc(ic.dropdown1,dropdown1);dropdown1.value="Travel Time";nc(ic.dropdown2[Pp(dropdown1.value)],dropdown2);dropdown2.value="With All Bridges";nc(ic.dropdown3[Pp(dropdown1.value)],dropdown3);dropdown3.value="To School";nc(ic.dropdown4,dropdown4);dropdown4.disabled=!1;let Jl={};for(let o=1;o<=4;o++){let n="dropdown"+o;Jl[n]=uu[o-1].value}function $I(){for(let o=0;o<4;o++)Jl[uu[o].id]=uu[o].value}uu.forEach(o=>{o.addEventListener("change",function(){o.id=="dropdown1"&&(nc(ic.dropdown2[Pp(o.value)],dropdown2),nc(ic.dropdown3[Pp(o.value)],dropdown3)),o.id=="dropdown4"&&bS(dropdown4.value),$I(),TS(Jl)})});dS();gi.on("load",function(){wS(gi);const o=new UI({accessToken:hu.accessToken,mapboxgl:hu,bbox:[28.856,-2.84,30.8954,-1.0546]});document.getElementById("geocoder").appendChild(o.onAdd(gi));let n=null;ip=["hex-8-layer"],Ra=["hex-8-layer","bridge-point","health-point","edu-point"];for(let a=0;a<Ra.length;a++)gi.on("mousemove",Ra[a],function(h){h.features[0].id&&(h.features[0].id,gi.getCanvas().style.cursor="pointer",ty(Ra[a],h.features[0]))});for(let a=0;a<Ra.length;a++)gi.on("mouseleave",Ra[a],function(h){ty(Ra[a]),gi.getCanvas().style.cursor=""});for(let a=0;a<ip.length;a++)gi.on("click",function(h){document.getElementById("click-panel").classList.remove("show"),document.getElementById("control-panel").classList.remove("left"),n!==null&&gi.setFeatureState({source:"hex-8-source",id:n},{click:!1}),n=null}),gi.on("click",ip[a],function(h){mS(ip[a],h.features[0].properties),document.getElementById("control-panel").classList.add("left"),h.features.length>0&&(n!==null&&gi.setFeatureState({source:"hex-8-source",id:n},{click:!1}),n=h.features[0].id,gi.setFeatureState({source:"hex-8-source",id:n},{click:!0}))})});let np=["info-button","feedback-button","bridge-need-button","bug-button","controls-button","control-panel-close"];for(let o=0;o<np.length;o++)document.getElementById(np[o]).addEventListener("click",function(){console.log(np[o]),ES(np[o])});document.getElementById("close-button").addEventListener("click",function(){document.getElementById("click-panel").classList.remove("show"),document.getElementById("control-panel").classList.remove("left")});document.getElementById("close-modal-button").addEventListener("click",function(){var o=document.getElementById("info-modal");o.style.display="none",document.body.classList.remove("modal-open")});
