var R2=Object.defineProperty;var O2=(o,s,a)=>s in o?R2(o,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[s]=a;var ut=(o,s,a)=>(O2(o,typeof s!="symbol"?s+"":s,a),a);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const v of g.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&u(v)}).observe(document,{childList:!0,subtree:!0});function a(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(d){if(d.ep)return;d.ep=!0;const g=a(d);fetch(d.href,g)}})();const k={key:["Menu Options","hover panel text","color scheme"],"h3-index":[["N/A"],["H3 Index",""],"rainbow"],row_col:[["N/A"],["Row/Col",""],"rainbow"],female_educational_attainment_mean:[["Demographics","Female Education","N/A"],["Avg. Female Education","years"],"rdylgn",{max:8.6589,min:3.4551,mean:4.8228326,median:4.7054,"98_percentile":6.68306,"99_percentile":7.185144,"2_percentile":3.999912,"1_percentile":3.921612,quantiles:[3.4551,4.26988,4.4051,4.5131,4.6083,4.7054,4.80628,4.9392,5.11134,5.48352,8.6589],style_stops_99:[3.921612,4.737495005130768,5.553377985954285,6.3692609667778015,7.185144],style_stops_98:[3.999912,4.670699059963226,5.341486096382141,6.012273132801056,6.68306],style_stops_maxmin:[3.4551,4.756050109863281,6.057000160217285,7.357950210571289,8.6589]}],females_0_4:[["Population","Female 0-4","N/A"],["Population","females"],"magma",{max:1174,min:0,mean:39.94789195806871,median:33,"98_percentile":135,"99_percentile":198,"2_percentile":2,"1_percentile":1,quantiles:[0,10,17,23,28,33,38,44,52,68.29999999999927,1174],style_stops_99:[1,50.25,99.5,148.75,198],style_stops_98:[2,35.25,68.5,101.75,135],style_stops_maxmin:[0,293.5,587,880.5,1174]}],females_0_9:[["Population","Female 0-9","N/A"],["Population","females"],"magma",{max:2347,min:0,mean:86.69309051955008,median:72,"98_percentile":287,"99_percentile":414.89000000000306,"2_percentile":5,"1_percentile":2,quantiles:[0,21,38,51,62,72,83,96,114,148,2347],style_stops_99:[2,105.22250000000076,208.44500000000153,311.6675000000023,414.89000000000306],style_stops_98:[5,75.5,146,216.5,287],style_stops_maxmin:[0,586.75,1173.5,1760.25,2347]}],females_10_14:[["Population","Female 10-14","N/A"],["Population","females"],"magma",{max:1087,min:0,mean:43.51254877955467,median:36,"98_percentile":145,"99_percentile":207,"2_percentile":2,"1_percentile":1,quantiles:[0,11,19,26,31,36,42,48,57,75,1087],style_stops_99:[1,52.5,104,155.5,207],style_stops_98:[2,37.75,73.5,109.25,145],style_stops_maxmin:[0,271.75,543.5,815.25,1087]}],females_15_49:[["Population","Female 15-49","N/A"],["Population","females"],"magma",{max:5236,min:0,mean:176.1674573418012,median:147,"98_percentile":583.2599999999984,"99_percentile":847.630000000001,"2_percentile":10,"1_percentile":5,quantiles:[0,43,77,104,126,147,168,193,228,296,5236],style_stops_99:[5,215.65750000000025,426.3150000000005,636.9725000000008,847.630000000001],style_stops_98:[10,153.3149999999996,296.6299999999992,439.9449999999988,583.2599999999984],style_stops_maxmin:[0,1309,2618,3927,5236]}],females_50_64:[["Population","Female 50-64","N/A"],["Population","females"],"magma",{max:487,min:0,mean:25.222740837095415,median:22,"98_percentile":81,"99_percentile":106,"2_percentile":1,"1_percentile":0,quantiles:[0,6,11,15,19,22,25,29,34,44,487],style_stops_99:[0,26.5,53,79.5,106],style_stops_98:[1,21,41,61,81],style_stops_maxmin:[0,121.75,243.5,365.25,487]}],females_5_9:[["Population","Female 5-9","N/A"],["Population","females"],"magma",{max:1173,min:0,mean:46.2448542352131,median:39,"98_percentile":151,"99_percentile":218.63000000000102,"2_percentile":2,"1_percentile":1,quantiles:[0,11,20,27,33,39,45,51,61,80,1173],style_stops_99:[1,55.407500000000255,109.81500000000051,164.22250000000076,218.63000000000102],style_stops_98:[2,39.25,76.5,113.75,151],style_stops_maxmin:[0,293.25,586.5,879.75,1173]}],females_65_plus:[["Population","Female 65+","N/A"],["Population","females"],"magma",{max:181,min:0,mean:10.05325579615885,median:9,"98_percentile":33,"99_percentile":44,"2_percentile":0,"1_percentile":0,quantiles:[0,2,4,6,7,9,10,12,14,18,181],style_stops_99:[0,11,22,33,44],style_stops_98:[0,8.25,16.5,24.75,33],style_stops_maxmin:[0,45.25,90.5,135.75,181]}],male_educational_attainment_mean:[["Demographics","Male Education","N/A"],["Avg. Male Education","years"],"rdylgn",{max:8.9661,min:4.0105,mean:5.114354,median:4.9656,"98_percentile":7.050552,"99_percentile":7.602576,"2_percentile":4.444456,"1_percentile":4.357428,quantiles:[4.0105,4.6616,4.7679,4.8369,4.8977,4.9656,5.0479,5.152,5.3074403,5.70886,8.9661],style_stops_99:[4.357428,5.168715000152588,5.980001926422119,6.79128885269165,7.602576],style_stops_98:[4.444456,5.0959800481796265,5.747503995895386,6.399027943611145,7.050552],style_stops_maxmin:[4.0105,5.249399900436401,6.48829984664917,7.7271997928619385,8.9661]}],males_0_4:[["Population","Male 0-4","N/A"],["Population","males"],"magma",{max:1239,min:0,mean:40.78728288315862,median:34,"98_percentile":138,"99_percentile":200,"2_percentile":2,"1_percentile":1,quantiles:[0,10,18,24,29,34,39,45,53,70,1239],style_stops_99:[1,50.75,100.5,150.25,200],style_stops_98:[2,36,70,104,138],style_stops_maxmin:[0,309.75,619.5,929.25,1239]}],males_0_9:[["Population","Male 0-9","N/A"],["Population","males"],"magma",{max:2413,min:0,mean:88.35660723850333,median:74,"98_percentile":293,"99_percentile":421.630000000001,"2_percentile":5,"1_percentile":2,quantiles:[0,22,39,52,63,74,84,98,116,151,2413],style_stops_99:[2,106.90750000000025,211.8150000000005,316.72250000000076,421.630000000001],style_stops_98:[5,77,149,221,293],style_stops_maxmin:[0,603.25,1206.5,1809.75,2413]}],males_10_14:[["Population","Male 10-14","N/A"],["Population","males"],"magma",{max:987,min:0,mean:44.25835947662407,median:37,"98_percentile":147,"99_percentile":207.63000000000102,"2_percentile":2,"1_percentile":1,quantiles:[0,11,20,26,32,37,43,49,59,77,987],style_stops_99:[1,52.657500000000255,104.31500000000051,155.97250000000076,207.63000000000102],style_stops_98:[2,38.25,74.5,110.75,147],style_stops_maxmin:[0,246.75,493.5,740.25,987]}],males_15_49:[["Population","Male 15-49","N/A"],["Population","males"],"magma",{max:7696,min:0,mean:175.09771214323973,median:137,"98_percentile":614.2599999999984,"99_percentile":973.890000000003,"2_percentile":9,"1_percentile":5,quantiles:[0,41,73,98,118,137,157,181,215,287,7696],style_stops_99:[5,247.22250000000076,489.4450000000015,731.6675000000023,973.890000000003],style_stops_98:[9,160.3149999999996,311.6299999999992,462.9449999999988,614.2599999999984],style_stops_maxmin:[0,1924,3848,5772,7696]}],males_50_64:[["Population","Male 50-64","N/A"],["Population","males"],"magma",{max:626,min:0,mean:24.470005356186395,median:20,"98_percentile":85,"99_percentile":123,"2_percentile":1,"1_percentile":0,quantiles:[0,6,11,14,17,20,23,27,32,42,626],style_stops_99:[0,30.75,61.5,92.25,123],style_stops_98:[1,22,43,64,85],style_stops_maxmin:[0,156.5,313,469.5,626]}],males_5_9:[["Population","Male 5-9","N/A"],["Population","males"],"magma",{max:1173,min:0,mean:47.07093121126329,median:40,"98_percentile":154,"99_percentile":222,"2_percentile":2,"1_percentile":1,quantiles:[0,11,21,28,34,40,45,52,62,81,1173],style_stops_99:[1,56.25,111.5,166.75,222],style_stops_98:[2,40,78,116,154],style_stops_maxmin:[0,293.25,586.5,879.75,1173]}],males_65_plus:[["Population","Male 65+","N/A"],["Population","males"],"magma",{max:116,min:0,mean:7.452827301247226,median:6,"98_percentile":25,"99_percentile":33,"2_percentile":0,"1_percentile":0,quantiles:[0,2,3,4,5,6,7,9,10,13,116],style_stops_99:[0,8.25,16.5,24.75,33],style_stops_98:[0,6.25,12.5,18.75,25],style_stops_maxmin:[0,29,58,87,116]}],pop_0_4:[["Population","Children 0-4","N/A"],["Population","people"],"magma",{max:2414,min:0,mean:81.23295584972071,median:67,"98_percentile":273.2599999999984,"99_percentile":401.630000000001,"2_percentile":4,"1_percentile":2,quantiles:[0,20,36,48,58,67,77,89,106,139,2414],style_stops_99:[2,101.90750000000025,201.8150000000005,301.72250000000076,401.630000000001],style_stops_98:[4,71.3149999999996,138.6299999999992,205.9449999999988,273.2599999999984],style_stops_maxmin:[0,603.5,1207,1810.5,2414]}],pop_0_9:[["Population","Children 0-9","N/A"],["Population","people"],"magma",{max:4761,min:0,mean:175.5523375927768,median:146,"98_percentile":581,"99_percentile":837,"2_percentile":10,"1_percentile":5,quantiles:[0,44,78,104,126,146,168,194,230,300,4761],style_stops_99:[5,213,421,629,837],style_stops_98:[10,152.75,295.5,438.25,581],style_stops_maxmin:[0,1190.25,2380.5,3570.75,4761]}],pop_10_14:[["Population","Youth 10-14","N/A"],["Population","people"],"magma",{max:2074,min:0,mean:88.26807712908409,median:74,"98_percentile":293,"99_percentile":413,"2_percentile":5,"1_percentile":2,quantiles:[0,22,39,53,63,74,85,98,117,153,2074],style_stops_99:[2,104.75,207.5,310.25,413],style_stops_98:[5,77,149,221,293],style_stops_maxmin:[0,518.5,1037,1555.5,2074]}],pop_15_49:[["Population","People 15-49","N/A"],["Population","people"],"magma",{max:12933,min:0,mean:351.7657051036805,median:285,"98_percentile":1182,"99_percentile":1817.260000000002,"2_percentile":19,"1_percentile":10,quantiles:[0,86,152,203,245,285,327,374,444,585,12933],style_stops_99:[10,461.8150000000005,913.630000000001,1365.4450000000015,1817.260000000002],style_stops_98:[19,309.75,600.5,891.25,1182],style_stops_maxmin:[0,3233.25,6466.5,9699.75,12933]}],pop_50_64:[["Population","People 50-64","N/A"],["Population","people"],"magma",{max:1e3,min:0,mean:50.18991506618716,median:43,"98_percentile":164,"99_percentile":228,"2_percentile":3,"1_percentile":1,quantiles:[0,12,23,30,37,43,49,56,66,87,1e3],style_stops_99:[1,57.75,114.5,171.25,228],style_stops_98:[3,43.25,83.5,123.75,164],style_stops_maxmin:[0,250,500,750,1e3]}],pop_5_9:[["Population","Children 5-9","N/A"],["Population","people"],"magma",{max:2347,min:0,mean:93.82137118371719,median:79,"98_percentile":304,"99_percentile":442,"2_percentile":5,"1_percentile":2,quantiles:[0,23,42,56,68,79,90,104,124,161,2347],style_stops_99:[2,112,222,332,442],style_stops_98:[5,79.75,154.5,229.25,304],style_stops_maxmin:[0,586.75,1173.5,1760.25,2347]}],pop_65_plus:[["Population","People 65+","N/A"],["Population","people"],"magma",{max:295,min:0,mean:17.99812533476165,median:16,"98_percentile":57,"99_percentile":78,"2_percentile":1,"1_percentile":0,quantiles:[0,4,8,11,13,16,18,21,24,32,295],style_stops_99:[0,19.5,39,58.5,78],style_stops_98:[1,15,29,43,57],style_stops_maxmin:[0,73.75,147.5,221.25,295]}],population:[["Population","All","N/A"],["Population","people"],"magma",{max:19813,min:0,mean:685.0027928686204,median:568,"98_percentile":2282.0399999999936,"99_percentile":3354.150000000005,"2_percentile":39,"1_percentile":21,quantiles:[0,169,302,405,488,568,649,746,885,1153,19813],style_stops_99:[21,854.2875000000013,1687.5750000000025,2520.862500000004,3354.150000000005],style_stops_98:[39,599.7599999999984,1160.5199999999968,1721.2799999999952,2282.0399999999936],style_stops_maxmin:[0,4953.25,9906.5,14859.75,19813]}],pregnancies:[["Demographics","Pregnancies","N/A"],["Pregnancies"],"magma",{max:1470,min:0,mean:24.80560869232535,median:22,"98_percentile":69,"99_percentile":98,"2_percentile":1,"1_percentile":0,quantiles:[0,6,12,15,19,22,25,28,33,40,1470],style_stops_99:[0,24.5,49,73.5,98],style_stops_98:[1,18,35,52,69],style_stops_maxmin:[0,367.5,735,1102.5,1470]}],births:[["Demographics","Births","N/A"],["Births"],"magma",{max:1038,min:0,mean:17.36693702655138,median:15,"98_percentile":48,"99_percentile":69,"2_percentile":1,"1_percentile":0,quantiles:[0,4,8,11,13,15,17,20,23,28,1038],style_stops_99:[0,17.25,34.5,51.75,69],style_stops_98:[1,12.75,24.5,36.25,48],style_stops_maxmin:[0,259.5,519,778.5,1038]}],rwi:[["Demographics","Relative Wealth Index","N/A"],["Relative Wealth Index"],"rdylgn",{max:1.8281,min:-.6764,mean:.037351005,median:-.0138,"98_percentile":.79605,"99_percentile":1.014425,"2_percentile":-.3014,"1_percentile":-.341575,quantiles:[-.6764,-.1962,-.1374,-.0932,-.0529,-.0138,.0312,.0852,.1652,.3208,1.8281],style_stops_99:[-.341575,-.0025749802589416504,.3364250361919403,.6754250526428223,1.014425],style_stops_98:[-.3014,-.027037501335144043,.24732500314712524,.5216875076293945,.79605],style_stops_maxmin:[-.6764,-.05027502775192261,.5758499503135681,1.2019749283790588,1.8281]}],underweight:[["Demographics","Underweight","N/A"],["Underweight"],"rdylgn",{max:.2202,min:.047,mean:.085901745,median:.0853,"98_percentile":.11585,"99_percentile":.128375,"2_percentile":.0609,"1_percentile":.055725,quantiles:[.047,.0731,.0773,.0803,.0828,.0853,.0876,.0902,.0936,.0986,.2202],style_stops_99:[.055725,.07388749904930592,.09204999729990959,.11021249555051327,.128375],style_stops_98:[.0609,.07463749963790178,.08837500028312206,.10211250092834234,.11585],style_stops_maxmin:[.047,.09030000120401382,.13360000401735306,.1769000068306923,.2202]}],time_delta_constructed_sites_all_education_facilities_fixed:[["Impact","Current Impact","School"],["Time Difference","minutes"],"magma",{max:984,min:0,mean:2.2178437523911545,median:0,"98_percentile":23,"99_percentile":56.63000000000102,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,984],style_stops_99:[0,14.157500000000255,28.31500000000051,42.472500000000764,56.63000000000102],style_stops_98:[0,5.75,11.5,17.25,23],style_stops_maxmin:[0,246,492,738,984]}],time_delta_constructed_sites_all_health_facilities_optimal:[["Impact","Current Impact","Healthcare"],["Time Difference","minutes"],"magma",{max:215,min:0,mean:.8765016451143929,median:0,"98_percentile":14,"99_percentile":24,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,215],style_stops_99:[0,6,12,18,24],style_stops_98:[0,3.5,7,10.5,14],style_stops_maxmin:[0,53.75,107.5,161.25,215]}],time_delta_constructed_sites_health_centers_optimal:[["Impact","Current Impact","Health Center"],["Time Difference","minutes"],"magma",{max:179,min:0,mean:1.3734409671742291,median:0,"98_percentile":21,"99_percentile":36,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,179],style_stops_99:[0,9,18,27,36],style_stops_98:[0,5.25,10.5,15.75,21],style_stops_maxmin:[0,44.75,89.5,134.25,179]}],time_delta_constructed_sites_health_posts_optimal:[["Impact","Current Impact","Health Post"],["Time Difference","minutes"],"magma",{max:301,min:0,mean:1.6678016680694774,median:0,"98_percentile":26,"99_percentile":44,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,301],style_stops_99:[0,11,22,33,44],style_stops_98:[0,6.5,13,19.5,26],style_stops_maxmin:[0,75.25,150.5,225.75,301]}],time_delta_constructed_sites_major_hospitals_optimal:[["Impact","Current Impact","Major Hospital"],["Time Difference","minutes"],"magma",{max:500,min:0,mean:3.8687734333154795,median:0,"98_percentile":48,"99_percentile":84.63000000000102,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,3,500],style_stops_99:[0,21.157500000000255,42.31500000000051,63.472500000000764,84.63000000000102],style_stops_98:[0,12,24,36,48],style_stops_maxmin:[0,125,250,375,500]}],time_delta_constructed_sites_primary_schools_fixed:[["Impact","Current Impact","Primary School"],["Time Difference","minutes"],"magma",{max:984.2857142857143,min:0,mean:2.4244854139979255,median:0,"98_percentile":26.295314285714245,"99_percentile":61.05442105263124,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,984.2857142857143],style_stops_99:[0,15.26360526315781,30.52721052631562,45.79081578947343,61.05442105263124],style_stops_98:[0,6.573828571428561,13.147657142857122,19.721485714285684,26.295314285714245],style_stops_maxmin:[0,246.07142857142858,492.14285714285717,738.2142857142858,984.2857142857143]}],time_delta_constructed_sites_secondary_schools_fixed:[["Impact","Current Impact","Secondary School"],["Time Difference","minutes"],"magma",{max:1168.7777777777778,min:0,mean:3.2023103719349346,median:0,"98_percentile":37.900140350877166,"99_percentile":81.75732142857136,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,.3448275862068966,1168.7777777777778],style_stops_99:[0,20.43933035714284,40.87866071428568,61.31799107142852,81.75732142857136],style_stops_98:[0,9.475035087719291,18.950070175438583,28.425105263157874,37.900140350877166],style_stops_maxmin:[0,292.19444444444446,584.3888888888889,876.5833333333334,1168.7777777777778]}],time_delta_constructed_sites_semi_dense_urban_optimal:[["Impact","Current Impact","Semi Dense Urban"],["Time Difference","minutes"],"magma",{max:429,min:0,mean:3.1003137194888666,median:0,"98_percentile":40.2599999999984,"99_percentile":74,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,2,429],style_stops_99:[0,18.5,37,55.5,74],style_stops_98:[0,10.0649999999996,20.1299999999992,30.1949999999988,40.2599999999984],style_stops_maxmin:[0,107.25,214.5,321.75,429]}],time_delta_no_sites_all_education_facilities_fixed:[["Impact","Potential Impact","School"],["Time Difference","minutes"],"magma",{max:984,min:0,mean:2.5740301476777105,median:0,"98_percentile":29,"99_percentile":65,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,984],style_stops_99:[0,16.25,32.5,48.75,65],style_stops_98:[0,7.25,14.5,21.75,29],style_stops_maxmin:[0,246,492,738,984]}],time_delta_no_sites_all_health_facilities_optimal:[["Impact","Potential Impact","Healthcare"],["Time Difference","minutes"],"magma",{max:220,min:0,mean:1.0444563470808783,median:0,"98_percentile":16,"99_percentile":28,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,220],style_stops_99:[0,7,14,21,28],style_stops_98:[0,4,8,12,16],style_stops_maxmin:[0,55,110,165,220]}],time_delta_no_sites_health_centers_optimal:[["Impact","Potential Impact","Health Center"],["Time Difference","minutes"],"magma",{max:247,min:0,mean:1.6273242023108119,median:0,"98_percentile":24,"99_percentile":41,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,1,247],style_stops_99:[0,10.25,20.5,30.75,41],style_stops_98:[0,6,12,18,24],style_stops_maxmin:[0,61.75,123.5,185.25,247]}],time_delta_no_sites_health_posts_optimal:[["Impact","Potential Impact","Health Post"],["Time Difference","minutes"],"magma",{max:301,min:0,mean:2.122580151503558,median:0,"98_percentile":32,"99_percentile":55,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,1,301],style_stops_99:[0,13.75,27.5,41.25,55],style_stops_98:[0,8,16,24,32],style_stops_maxmin:[0,75.25,150.5,225.75,301]}],time_delta_no_sites_major_hospitals_optimal:[["Impact","Potential Impact","Major Hospital"],["Time Difference","minutes"],"magma",{max:500,min:0,mean:4.578047287474176,median:0,"98_percentile":60,"99_percentile":100,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,5,500],style_stops_99:[0,25,50,75,100],style_stops_98:[0,15,30,45,60],style_stops_maxmin:[0,125,250,375,500]}],time_delta_no_sites_primary_schools_fixed:[["Impact","Potential Impact","Primary School"],["Time Difference","minutes"],"magma",{max:984.2857142857143,min:0,mean:2.775999912072367,median:0,"98_percentile":32.230967741935395,"99_percentile":68.03264971287933,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,.08906199285946287,984.2857142857143],style_stops_99:[0,17.008162428219833,34.01632485643967,51.0244872846595,68.03264971287933],style_stops_98:[0,8.057741935483849,16.115483870967697,24.173225806451548,32.230967741935395],style_stops_maxmin:[0,246.07142857142858,492.14285714285717,738.2142857142858,984.2857142857143]}],time_delta_no_sites_secondary_schools_fixed:[["Impact","Potential Impact","Secondary School"],["Time Difference","minutes"],"magma",{max:1244.7777777777778,min:0,mean:3.750867800777929,median:0,"98_percentile":46.34266666666663,"99_percentile":96.37395652173863,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,.9583333333333334,1244.7777777777778],style_stops_99:[0,24.09348913043466,48.18697826086932,72.28046739130397,96.37395652173863],style_stops_98:[0,11.585666666666658,23.171333333333315,34.75699999999998,46.34266666666663],style_stops_maxmin:[0,311.19444444444446,622.3888888888889,933.5833333333334,1244.7777777777778]}],time_delta_no_sites_semi_dense_urban_optimal:[["Impact","Potential Impact","Market"],["Time Difference","minutes"],"magma",{max:429,min:0,mean:3.8696151197490245,median:0,"98_percentile":51,"99_percentile":93,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,4,429],style_stops_99:[0,23.25,46.5,69.75,93],style_stops_98:[0,12.75,25.5,38.25,51],style_stops_maxmin:[0,107.25,214.5,321.75,429]}],travel_time_all_education_facilities_fixed:[["Travel Time","With All Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:64.64993496059377,median:46,"98_percentile":280.2599999999984,"99_percentile":431,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,39,46,53,63,76,104,1700],style_stops_99:[10,30,46,60,431],style_stops_98:[11,30,46,60,280.2599999999984],style_stops_maxmin:[5,428.75,852.5,1276.25,1700]}],travel_time_all_health_facilities_optimal:[["Travel Time","With All Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:87.18452062131762,median:73,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,29,42,53,63,73,83,96,112,140,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,420,833,1246,1659]}],travel_time_constructed_sites_all_education_facilities_fixed:[["Travel Time","With Constructed Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:66.77672354426505,median:47,"98_percentile":295.2599999999984,"99_percentile":450.630000000001,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,40,47,55,64,78,110,1700],style_stops_99:[10,30,46,60,450.63],style_stops_98:[11,30,46,60,295.2599999999984],style_stops_maxmin:[5,30,46,60,1700]}],travel_time_constructed_sites_all_health_facilities_optimal:[["Travel Time","With Constructed Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:87.94938403856455,median:74,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,30,43,53,64,74,84.19999999999891,97,114,141,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,45,90,135,1659]}],travel_time_constructed_sites_health_centers_optimal:[["Travel Time","With Constructed Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:122.2729359553141,median:104,"98_percentile":376,"99_percentile":499.630000000001,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,76,90,104,119,136,159,199,1775],style_stops_99:[15,45,90,135,499.630000000001],style_stops_98:[19,45,90,135,376],style_stops_maxmin:[7,45,90,135,1775]}],travel_time_constructed_sites_health_posts_optimal:[["Travel Time","With Constructed Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:129.43029305991277,median:112,"98_percentile":342,"99_percentile":446.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,62,79,96,112,130,151,178,221,1659],style_stops_99:[15,45,90,135,446.26000000000204],style_stops_98:[19,45,90,135,342],style_stops_maxmin:[7,45,90,135,1659]}],travel_time_constructed_sites_major_hospitals_optimal:[["Travel Time","With Constructed Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:368.4278827760349,median:340,"98_percentile":967.2599999999984,"99_percentile":1111.630000000001,"2_percentile":60,"1_percentile":41,quantiles:[10,141,203,253,298,340,384,432,498,608,1774],style_stops_99:[41,60,120,180,1111.630000000001],style_stops_98:[60,286.8149999999996,513.6299999999992,740.4449999999988,967.2599999999984],style_stops_maxmin:[10,451,892,1333,1774]}],travel_time_constructed_sites_primary_schools_fixed:[["Travel Time","With Constructed Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:71.40767275974714,median:51.16,"98_percentile":299.1866666666659,"99_percentile":453.08733333333294,"2_percentile":12.863636363636363,"1_percentile":11.499789473684212,quantiles:[5.133333333333334,20.91176470588235,29.540317460317464,36.85981900452488,43.947908232118756,51.16,59.46153846153846,69.9280423280423,85.59285714285718,119.18817567567568,1700.3636363636363],style_stops_99:[11.499789473684212,30,46,60,453.08733333333294],style_stops_98:[12.863636363636363,84.44439393939373,156.02515151515112,227.60590909090848,299.1866666666659],style_stops_maxmin:[5.133333333333334,428.94090909090903,852.7484848484847,1276.5560606060606,1700.3636363636363]}],travel_time_constructed_sites_secondary_schools_fixed:[["Travel Time","With Constructed Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:98.89652336748952,median:75.22361111111111,"98_percentile":400.1361212121209,"99_percentile":529.9095833333323,"2_percentile":14.24649202047576,"1_percentile":12.264347980786338,quantiles:[5.133333333333334,28.119918699186993,41.086656671664166,52.58320895522388,63.80250000000001,75.22361111111111,87.87391304347825,103.48525252525252,125.79307692307694,169.3693633952255,1725.75],style_stops_99:[12.264347980786338,30,46,60,529.9095833333323],style_stops_98:[14.24649202047576,110.71889931838703,207.1913066162983,303.6637139142096,400.1361212121209],style_stops_maxmin:[5.133333333333334,435.28749999999997,865.4416666666666,1295.5958333333333,1725.75]}],travel_time_constructed_sites_semi_dense_urban_optimal:[["Travel Time","With Constructed Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:376.9627362460785,median:330,"98_percentile":1011,"99_percentile":1101,"2_percentile":27,"1_percentile":21,quantiles:[10,91,156,216,272,330,396,474,571,732,1758],style_stops_99:[21,60,120,180,1101],style_stops_98:[27,273,519,765,1011],style_stops_maxmin:[10,447,884,1321,1758]}],travel_time_health_centers_optimal:[["Travel Time","With All Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:120.95638533935266,median:103,"98_percentile":376,"99_percentile":497.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,60,75,89,103,118,135,157,196,1775],style_stops_99:[15,30,46,60,497.26000000000204],style_stops_98:[19,30,46,60,376],style_stops_maxmin:[7,30,46,60,1775]}],travel_time_health_posts_optimal:[["Travel Time","With All Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:127.87585125105211,median:110,"98_percentile":338,"99_percentile":445,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,78,94,110,128,149,176,219,1659],style_stops_99:[15,30,46,60,445],style_stops_98:[19,30,46,60,338],style_stops_maxmin:[7,30,46,60,1659]}],travel_time_major_hospitals_optimal:[["Travel Time","With All Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:364.9125793863341,median:336,"98_percentile":954.2599999999984,"99_percentile":1084,"2_percentile":59,"1_percentile":41,quantiles:[10,139,201,250,294,336,380,429,494,605,1774],style_stops_99:[41,60,120,180,1084],style_stops_98:[59,60,120,180,954.2599999999984],style_stops_maxmin:[10,60,120,180,1774]}],travel_time_no_sites_all_education_facilities_fixed:[["Travel Time","Without Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:67.1364297191828,median:47,"98_percentile":299,"99_percentile":450.630000000001,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,40,47,55,65,79,111,1700],style_stops_99:[10,30,45,60,450.630000000001],style_stops_98:[11,30,45,60,299],style_stops_maxmin:[5,30,45,60,1700]}],travel_time_no_sites_all_health_facilities_optimal:[["Travel Time","Without Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:88.12170020659576,median:74,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,30,43,53,64,74,85,97,114,141,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,45,90,135,1659]}],travel_time_no_sites_health_centers_optimal:[["Travel Time","Without Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:122.52620705486265,median:104,"98_percentile":376,"99_percentile":499.630000000001,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,77,90,104,119,136.89999999999782,159,199,1775],style_stops_99:[15,45,90,135,499.630000000001],style_stops_98:[19,45,90,135,376],style_stops_maxmin:[7,45,90,135,1775]}],travel_time_no_sites_health_posts_optimal:[["Travel Time","Without Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:129.89023643737087,median:113,"98_percentile":343,"99_percentile":446.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,62,79,96,113,131,152,179,222,1659],style_stops_99:[15,45,90,135,446.26000000000204],style_stops_98:[19,45,90,135,262,343],style_stops_maxmin:[7,45,90,135,1659]}],travel_time_no_sites_major_hospitals_optimal:[["Travel Time","Without Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:369.13463157089296,median:341,"98_percentile":967.2599999999984,"99_percentile":1111.630000000001,"2_percentile":60,"1_percentile":41,quantiles:[10,142,204,253,299,341,384,433,498,610,1774],style_stops_99:[41,60,120,180,1111.630000000001],style_stops_98:[60,60,120,180,967.2599999999984],style_stops_maxmin:[10,60,120,180,1774]}],travel_time_no_sites_primary_schools_fixed:[["Travel Time","Without Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:71.75796345160377,median:51.32727272727273,"98_percentile":301.51599999999945,"99_percentile":453.08733333333294,"2_percentile":12.864895104895105,"1_percentile":11.511820931639443,quantiles:[5.133333333333334,20.92804399057345,29.61742654508612,36.931419457735245,44.04545454545455,51.32727272727273,59.71318681318681,70.25,86.03045761440363,119.87186009538954,1700.3636363636363],style_stops_99:[11.511820931639443,30,45,60,453.08733333333294],style_stops_98:[12.864895104895105,30,45,60,301.51599999999945],style_stops_maxmin:[5.133333333333334,30,45,60,1700.3636363636363]}],travel_time_no_sites_secondary_schools_fixed:[["Travel Time","Without Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:99.44496852814716,median:75.47935435435436,"98_percentile":404.03360139860104,"99_percentile":529.9095833333323,"2_percentile":14.24649202047576,"1_percentile":12.264347980786338,quantiles:[5.133333333333334,28.146439024390244,41.16964285714287,52.75548780487805,64.05233821445442,75.47935435435436,88.23946388682054,104.18397534668718,126.51818181818189,170.43190476190478,1725.75],style_stops_99:[12.264347980786338,30,45,60,529.9095833333323],style_stops_98:[14.24649202047576,30,45,60,404.03360139860104],style_stops_maxmin:[5.133333333333334,30,45,60,1725.75]}],travel_time_no_sites_semi_dense_urban_optimal:[["Travel Time","Without Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:377.7297803963578,median:331,"98_percentile":1012,"99_percentile":1101,"2_percentile":27,"1_percentile":21,quantiles:[10,91,157,216,272,331,396,475,573,733,1758],style_stops_99:[21,60,120,180,1101],style_stops_98:[27,60,120,180,1012],style_stops_maxmin:[10,60,120,180,1758]}],travel_time_primary_schools_fixed:[["Travel Time","With All Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:69.20764038727852,median:50.241379310344826,"98_percentile":284.9642105263155,"99_percentile":430.96133333333273,"2_percentile":12.767935916542474,"1_percentile":11.439333333333334,quantiles:[5.133333333333334,20.678656126482217,29.225929127052726,36.3762987012987,43.2402962962963,50.241379310344826,58.142857142857146,68,82.70089399744576,113.63214285714288,1700.3636363636363],style_stops_99:[11.439333333333334,30,45,60,430.96133333333273],style_stops_98:[12.767935916542474,30,45,60,284.9642105263155],style_stops_maxmin:[5.133333333333334,30,45,60,1700.3636363636363]}],travel_time_secondary_schools_fixed:[["Travel Time","With All Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:95.76174201155379,median:73.67567567567568,"98_percentile":385.59878787878796,"99_percentile":512.0158169934646,"2_percentile":14.202546583850932,"1_percentile":12.222857142857142,quantiles:[5.133333333333334,27.86842105263158,40.67359667359667,51.854602675059006,62.82921832884097,73.67567567567568,86,100.54747474747472,121.08325358851685,160.87112299465244,1725.75],style_stops_99:[12.222857142857142,30,45,60,512.0158169934646],style_stops_98:[14.202546583850932,30,45,60,385.59878787878796],style_stops_maxmin:[5.133333333333334,30,45,60,1725.75]}],travel_time_semi_dense_urban_optimal:[["Travel Time","With All Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:373.7797842222052,median:327,"98_percentile":1007.2599999999984,"99_percentile":1093.630000000001,"2_percentile":27,"1_percentile":21,quantiles:[10,90,155,213,268,327,391,469,567,728,1758],style_stops_99:[21,60,120,180,1093.630000000001],style_stops_98:[27,60,120,180,1007.2599999999984],style_stops_maxmin:[10,60,120,180,1758]}]},X={inferno:["#000004","#57106e","#bc3754","#f98e09","#fcffa4"],magma:["#000004","#51127c","#b73779","#fc8961","#fcfdbf"],plasma:["#0d0887","#7e03a8","#cc4778","#f89540","#f0f921"],viridis:["#440154","#3b528b","#21918c","#5ec962","#fde725"],cividis:["#002051","#3c4d6e","#7f7c75","#bbaf71","#fdea45"],turbo:["#23171b","#26bce1","#95fb51","#ff821d","#900c00"],warm:["#6e40aa","#d23ea7","#ff5e63","#efa72f","#aff05b"],cool:["#6e40aa","#417de0","#1ac7c2","#40f373","#aff05b"],blues:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],greens:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],grays:["#f7f7f7","#cccccc","#969696","#636363","#252525"],oranges:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],purples:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],reds:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],bugn:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],bupu:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],gnbu:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],orrd:["#fee8c8","#fdbb84","#e34a33","#b30000"],pubu:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],pubugn:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],puor:["#f1a340","#f7f7f7","#998ec3","#762a83"],purd:["#e7e1ef","#c994c7","#dd1c77","#980043"],rdpu:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],ylgn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#31a354"],ylgnbu:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],ylorbr:["#ffffe5","#fff7bc","#fec44f","#d95f0e","#993404"],ylorrd:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],brbg:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],prgn:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],piyg:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],puor:["#5e3c99","#b2abd2","#f7f7f7","#fdb863","#e66101"],rdbu:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],rdgy:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],rdylbu:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],rdylgn:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],spectral:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],rainbow:["#6e40aa","#ff5e63","#aff05b","#1ac7c2","#6e40aa"],sinebow:["#ff4040","#7fee11","#00bfbf","#7f11ee","#ff4040"],tableau10:["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],pastel:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},C_={female_educational_attainment_mean:{"fill-color":["interpolate",["linear"],["get","female_educational_attainment_mean"],k.female_educational_attainment_mean[3].style_stops_99[0],X[k.female_educational_attainment_mean[2]][0],k.female_educational_attainment_mean[3].style_stops_99[1],X[k.female_educational_attainment_mean[2]][1],k.female_educational_attainment_mean[3].style_stops_99[2],X[k.female_educational_attainment_mean[2]][2],k.female_educational_attainment_mean[3].style_stops_99[3],X[k.female_educational_attainment_mean[2]][3],k.female_educational_attainment_mean[3].style_stops_99[4],X[k.female_educational_attainment_mean[2]][4]]},females_0_4:{"fill-color":["interpolate",["linear"],["get","females_0_4"],k.females_0_4[3].style_stops_99[0],X[k.females_0_4[2]][4],k.females_0_4[3].style_stops_99[1],X[k.females_0_4[2]][3],k.females_0_4[3].style_stops_99[2],X[k.females_0_4[2]][2],k.females_0_4[3].style_stops_99[3],X[k.females_0_4[2]][1],k.females_0_4[3].style_stops_99[4],X[k.females_0_4[2]][0]]},females_0_9:{"fill-color":["interpolate",["linear"],["get","females_0_9"],k.females_0_9[3].style_stops_99[0],X[k.females_0_9[2]][4],k.females_0_9[3].style_stops_99[1],X[k.females_0_9[2]][3],k.females_0_9[3].style_stops_99[2],X[k.females_0_9[2]][2],k.females_0_9[3].style_stops_99[3],X[k.females_0_9[2]][1],k.females_0_9[3].style_stops_99[4],X[k.females_0_9[2]][0]]},females_10_14:{"fill-color":["interpolate",["linear"],["get","females_10_14"],k.females_10_14[3].style_stops_99[0],X[k.females_10_14[2]][4],k.females_10_14[3].style_stops_99[1],X[k.females_10_14[2]][3],k.females_10_14[3].style_stops_99[2],X[k.females_10_14[2]][2],k.females_10_14[3].style_stops_99[3],X[k.females_10_14[2]][1],k.females_10_14[3].style_stops_99[4],X[k.females_10_14[2]][0]]},females_15_49:{"fill-color":["interpolate",["linear"],["get","females_15_49"],k.females_15_49[3].style_stops_99[0],X[k.females_15_49[2]][4],k.females_15_49[3].style_stops_99[1],X[k.females_15_49[2]][3],k.females_15_49[3].style_stops_99[2],X[k.females_15_49[2]][2],k.females_15_49[3].style_stops_99[3],X[k.females_15_49[2]][1],k.females_15_49[3].style_stops_99[4],X[k.females_15_49[2]][0]]},females_50_64:{"fill-color":["interpolate",["linear"],["get","females_50_64"],k.females_50_64[3].style_stops_99[0],X[k.females_50_64[2]][4],k.females_50_64[3].style_stops_99[1],X[k.females_50_64[2]][3],k.females_50_64[3].style_stops_99[2],X[k.females_50_64[2]][2],k.females_50_64[3].style_stops_99[3],X[k.females_50_64[2]][1],k.females_50_64[3].style_stops_99[4],X[k.females_50_64[2]][0]]},females_5_9:{"fill-color":["interpolate",["linear"],["get","females_5_9"],k.females_5_9[3].style_stops_99[0],X[k.females_5_9[2]][4],k.females_5_9[3].style_stops_99[1],X[k.females_5_9[2]][3],k.females_5_9[3].style_stops_99[2],X[k.females_5_9[2]][2],k.females_5_9[3].style_stops_99[3],X[k.females_5_9[2]][1],k.females_5_9[3].style_stops_99[4],X[k.females_5_9[2]][0]]},females_65_plus:{"fill-color":["interpolate",["linear"],["get","females_65_plus"],k.females_65_plus[3].style_stops_99[0],X[k.females_65_plus[2]][4],k.females_65_plus[3].style_stops_99[1],X[k.females_65_plus[2]][3],k.females_65_plus[3].style_stops_99[2],X[k.females_65_plus[2]][2],k.females_65_plus[3].style_stops_99[3],X[k.females_65_plus[2]][1],k.females_65_plus[3].style_stops_99[4],X[k.females_65_plus[2]][0]]},male_educational_attainment_mean:{"fill-color":["interpolate",["linear"],["get","male_educational_attainment_mean"],k.male_educational_attainment_mean[3].style_stops_99[0],X[k.male_educational_attainment_mean[2]][0],k.male_educational_attainment_mean[3].style_stops_99[1],X[k.male_educational_attainment_mean[2]][1],k.male_educational_attainment_mean[3].style_stops_99[2],X[k.male_educational_attainment_mean[2]][2],k.male_educational_attainment_mean[3].style_stops_99[3],X[k.male_educational_attainment_mean[2]][3],k.male_educational_attainment_mean[3].style_stops_99[4],X[k.male_educational_attainment_mean[2]][4]]},males_0_4:{"fill-color":["interpolate",["linear"],["get","males_0_4"],k.males_0_4[3].style_stops_99[0],X[k.males_0_4[2]][4],k.males_0_4[3].style_stops_99[1],X[k.males_0_4[2]][3],k.males_0_4[3].style_stops_99[2],X[k.males_0_4[2]][2],k.males_0_4[3].style_stops_99[3],X[k.males_0_4[2]][1],k.males_0_4[3].style_stops_99[4],X[k.males_0_4[2]][0]]},males_0_9:{"fill-color":["interpolate",["linear"],["get","males_0_9"],k.males_0_9[3].style_stops_99[0],X[k.males_0_9[2]][4],k.males_0_9[3].style_stops_99[1],X[k.males_0_9[2]][3],k.males_0_9[3].style_stops_99[2],X[k.males_0_9[2]][2],k.males_0_9[3].style_stops_99[3],X[k.males_0_9[2]][1],k.males_0_9[3].style_stops_99[4],X[k.males_0_9[2]][0]]},males_10_14:{"fill-color":["interpolate",["linear"],["get","males_10_14"],k.males_10_14[3].style_stops_99[0],X[k.males_10_14[2]][4],k.males_10_14[3].style_stops_99[1],X[k.males_10_14[2]][3],k.males_10_14[3].style_stops_99[2],X[k.males_10_14[2]][2],k.males_10_14[3].style_stops_99[3],X[k.males_10_14[2]][1],k.males_10_14[3].style_stops_99[4],X[k.males_10_14[2]][0]]},males_15_49:{"fill-color":["interpolate",["linear"],["get","males_15_49"],k.males_15_49[3].style_stops_99[0],X[k.males_15_49[2]][4],k.males_15_49[3].style_stops_99[1],X[k.males_15_49[2]][3],k.males_15_49[3].style_stops_99[2],X[k.males_15_49[2]][2],k.males_15_49[3].style_stops_99[3],X[k.males_15_49[2]][1],k.males_15_49[3].style_stops_99[4],X[k.males_15_49[2]][0]]},males_50_64:{"fill-color":["interpolate",["linear"],["get","males_50_64"],k.males_50_64[3].style_stops_99[0],X[k.males_50_64[2]][4],k.males_50_64[3].style_stops_99[1],X[k.males_50_64[2]][3],k.males_50_64[3].style_stops_99[2],X[k.males_50_64[2]][2],k.males_50_64[3].style_stops_99[3],X[k.males_50_64[2]][1],k.males_50_64[3].style_stops_99[4],X[k.males_50_64[2]][0]]},males_5_9:{"fill-color":["interpolate",["linear"],["get","males_5_9"],k.males_5_9[3].style_stops_99[0],X[k.males_5_9[2]][4],k.males_5_9[3].style_stops_99[1],X[k.males_5_9[2]][3],k.males_5_9[3].style_stops_99[2],X[k.males_5_9[2]][2],k.males_5_9[3].style_stops_99[3],X[k.males_5_9[2]][1],k.males_5_9[3].style_stops_99[4],X[k.males_5_9[2]][0]]},males_65_plus:{"fill-color":["interpolate",["linear"],["get","males_65_plus"],k.males_65_plus[3].style_stops_99[0],X[k.males_65_plus[2]][4],k.males_65_plus[3].style_stops_99[1],X[k.males_65_plus[2]][3],k.males_65_plus[3].style_stops_99[2],X[k.males_65_plus[2]][2],k.males_65_plus[3].style_stops_99[3],X[k.males_65_plus[2]][1],k.males_65_plus[3].style_stops_99[4],X[k.males_65_plus[2]][0]]},pop_0_4:{"fill-color":["interpolate",["linear"],["get","pop_0_4"],k.pop_0_4[3].style_stops_99[0],X[k.pop_0_4[2]][4],k.pop_0_4[3].style_stops_99[1],X[k.pop_0_4[2]][3],k.pop_0_4[3].style_stops_99[2],X[k.pop_0_4[2]][2],k.pop_0_4[3].style_stops_99[3],X[k.pop_0_4[2]][1],k.pop_0_4[3].style_stops_99[4],X[k.pop_0_4[2]][0]]},pop_0_9:{"fill-color":["interpolate",["linear"],["get","pop_0_9"],k.pop_0_9[3].style_stops_99[0],X[k.pop_0_9[2]][4],k.pop_0_9[3].style_stops_99[1],X[k.pop_0_9[2]][3],k.pop_0_9[3].style_stops_99[2],X[k.pop_0_9[2]][2],k.pop_0_9[3].style_stops_99[3],X[k.pop_0_9[2]][1],k.pop_0_9[3].style_stops_99[4],X[k.pop_0_9[2]][0]]},pop_10_14:{"fill-color":["interpolate",["linear"],["get","pop_10_14"],k.pop_10_14[3].style_stops_99[0],X[k.pop_10_14[2]][4],k.pop_10_14[3].style_stops_99[1],X[k.pop_10_14[2]][3],k.pop_10_14[3].style_stops_99[2],X[k.pop_10_14[2]][2],k.pop_10_14[3].style_stops_99[3],X[k.pop_10_14[2]][1],k.pop_10_14[3].style_stops_99[4],X[k.pop_10_14[2]][0]]},pop_15_49:{"fill-color":["interpolate",["linear"],["get","pop_15_49"],k.pop_15_49[3].style_stops_99[0],X[k.pop_15_49[2]][4],k.pop_15_49[3].style_stops_99[1],X[k.pop_15_49[2]][3],k.pop_15_49[3].style_stops_99[2],X[k.pop_15_49[2]][2],k.pop_15_49[3].style_stops_99[3],X[k.pop_15_49[2]][1],k.pop_15_49[3].style_stops_99[4],X[k.pop_15_49[2]][0]]},pop_50_64:{"fill-color":["interpolate",["linear"],["get","pop_50_64"],k.pop_50_64[3].style_stops_99[0],X[k.pop_50_64[2]][4],k.pop_50_64[3].style_stops_99[1],X[k.pop_50_64[2]][3],k.pop_50_64[3].style_stops_99[2],X[k.pop_50_64[2]][2],k.pop_50_64[3].style_stops_99[3],X[k.pop_50_64[2]][1],k.pop_50_64[3].style_stops_99[4],X[k.pop_50_64[2]][0]]},pop_5_9:{"fill-color":["interpolate",["linear"],["get","pop_5_9"],k.pop_5_9[3].style_stops_99[0],X[k.pop_5_9[2]][4],k.pop_5_9[3].style_stops_99[1],X[k.pop_5_9[2]][3],k.pop_5_9[3].style_stops_99[2],X[k.pop_5_9[2]][2],k.pop_5_9[3].style_stops_99[3],X[k.pop_5_9[2]][1],k.pop_5_9[3].style_stops_99[4],X[k.pop_5_9[2]][0]]},pop_65_plus:{"fill-color":["interpolate",["linear"],["get","pop_65_plus"],k.pop_65_plus[3].style_stops_99[0],X[k.pop_65_plus[2]][4],k.pop_65_plus[3].style_stops_99[1],X[k.pop_65_plus[2]][3],k.pop_65_plus[3].style_stops_99[2],X[k.pop_65_plus[2]][2],k.pop_65_plus[3].style_stops_99[3],X[k.pop_65_plus[2]][1],k.pop_65_plus[3].style_stops_99[4],X[k.pop_65_plus[2]][0]]},population:{"fill-color":["interpolate",["linear"],["get","population"],k.population[3].style_stops_99[0],X[k.population[2]][4],k.population[3].style_stops_99[1],X[k.population[2]][3],k.population[3].style_stops_99[2],X[k.population[2]][2],k.population[3].style_stops_99[3],X[k.population[2]][1],k.population[3].style_stops_99[4],X[k.population[2]][0]]},pregnancies:{"fill-color":["interpolate",["linear"],["get","pregnancies"],k.pregnancies[3].style_stops_99[0],X[k.pregnancies[2]][4],k.pregnancies[3].style_stops_99[1],X[k.pregnancies[2]][3],k.pregnancies[3].style_stops_99[2],X[k.pregnancies[2]][2],k.pregnancies[3].style_stops_99[3],X[k.pregnancies[2]][1],k.pregnancies[3].style_stops_99[4],X[k.pregnancies[2]][0]]},births:{"fill-color":["interpolate",["linear"],["get","births"],k.births[3].style_stops_99[0],X[k.births[2]][4],k.births[3].style_stops_99[1],X[k.births[2]][3],k.births[3].style_stops_99[2],X[k.births[2]][2],k.births[3].style_stops_99[3],X[k.births[2]][1],k.births[3].style_stops_99[4],X[k.births[2]][0]]},rwi:{"fill-color":["interpolate",["linear"],["get","rwi"],k.rwi[3].style_stops_99[0],X[k.rwi[2]][0],k.rwi[3].style_stops_99[1],X[k.rwi[2]][1],k.rwi[3].style_stops_99[2],X[k.rwi[2]][2],k.rwi[3].style_stops_99[3],X[k.rwi[2]][3],k.rwi[3].style_stops_99[4],X[k.rwi[2]][4]]},underweight:{"fill-color":["interpolate",["linear"],["get","underweight"],k.underweight[3].style_stops_99[0],X[k.underweight[2]][4],k.underweight[3].style_stops_99[1],X[k.underweight[2]][3],k.underweight[3].style_stops_99[2],X[k.underweight[2]][2],k.underweight[3].style_stops_99[3],X[k.underweight[2]][1],k.underweight[3].style_stops_99[4],X[k.underweight[2]][0]]},time_delta_constructed_sites_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","time_delta_constructed_sites_all_education_facilities_fixed"],k.time_delta_constructed_sites_all_education_facilities_fixed[3].style_stops_99[0],X[k.time_delta_constructed_sites_all_education_facilities_fixed[2]][0],k.time_delta_constructed_sites_all_education_facilities_fixed[3].style_stops_99[1],X[k.time_delta_constructed_sites_all_education_facilities_fixed[2]][1],k.time_delta_constructed_sites_all_education_facilities_fixed[3].style_stops_99[2],X[k.time_delta_constructed_sites_all_education_facilities_fixed[2]][2],k.time_delta_constructed_sites_all_education_facilities_fixed[3].style_stops_99[3],X[k.time_delta_constructed_sites_all_education_facilities_fixed[2]][3],k.time_delta_constructed_sites_all_education_facilities_fixed[3].style_stops_99[4],X[k.time_delta_constructed_sites_all_education_facilities_fixed[2]][4]]},time_delta_constructed_sites_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_constructed_sites_all_health_facilities_optimal"],k.time_delta_constructed_sites_all_health_facilities_optimal[3].style_stops_99[0],X[k.time_delta_constructed_sites_all_health_facilities_optimal[2]][0],k.time_delta_constructed_sites_all_health_facilities_optimal[3].style_stops_99[1],X[k.time_delta_constructed_sites_all_health_facilities_optimal[2]][1],k.time_delta_constructed_sites_all_health_facilities_optimal[3].style_stops_99[2],X[k.time_delta_constructed_sites_all_health_facilities_optimal[2]][2],k.time_delta_constructed_sites_all_health_facilities_optimal[3].style_stops_99[3],X[k.time_delta_constructed_sites_all_health_facilities_optimal[2]][3],k.time_delta_constructed_sites_all_health_facilities_optimal[3].style_stops_99[4],X[k.time_delta_constructed_sites_all_health_facilities_optimal[2]][4]]},time_delta_constructed_sites_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_constructed_sites_health_centers_optimal"],k.time_delta_constructed_sites_health_centers_optimal[3].style_stops_99[0],X[k.time_delta_constructed_sites_health_centers_optimal[2]][0],k.time_delta_constructed_sites_health_centers_optimal[3].style_stops_99[1],X[k.time_delta_constructed_sites_health_centers_optimal[2]][1],k.time_delta_constructed_sites_health_centers_optimal[3].style_stops_99[2],X[k.time_delta_constructed_sites_health_centers_optimal[2]][2],k.time_delta_constructed_sites_health_centers_optimal[3].style_stops_99[3],X[k.time_delta_constructed_sites_health_centers_optimal[2]][3],k.time_delta_constructed_sites_health_centers_optimal[3].style_stops_99[4],X[k.time_delta_constructed_sites_health_centers_optimal[2]][4]]},time_delta_constructed_sites_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_constructed_sites_health_posts_optimal"],k.time_delta_constructed_sites_health_posts_optimal[3].style_stops_99[0],X[k.time_delta_constructed_sites_health_posts_optimal[2]][0],k.time_delta_constructed_sites_health_posts_optimal[3].style_stops_99[1],X[k.time_delta_constructed_sites_health_posts_optimal[2]][1],k.time_delta_constructed_sites_health_posts_optimal[3].style_stops_99[2],X[k.time_delta_constructed_sites_health_posts_optimal[2]][2],k.time_delta_constructed_sites_health_posts_optimal[3].style_stops_99[3],X[k.time_delta_constructed_sites_health_posts_optimal[2]][3],k.time_delta_constructed_sites_health_posts_optimal[3].style_stops_99[4],X[k.time_delta_constructed_sites_health_posts_optimal[2]][4]]},time_delta_constructed_sites_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_constructed_sites_major_hospitals_optimal"],k.time_delta_constructed_sites_major_hospitals_optimal[3].style_stops_99[0],X[k.time_delta_constructed_sites_major_hospitals_optimal[2]][0],k.time_delta_constructed_sites_major_hospitals_optimal[3].style_stops_99[1],X[k.time_delta_constructed_sites_major_hospitals_optimal[2]][1],k.time_delta_constructed_sites_major_hospitals_optimal[3].style_stops_99[2],X[k.time_delta_constructed_sites_major_hospitals_optimal[2]][2],k.time_delta_constructed_sites_major_hospitals_optimal[3].style_stops_99[3],X[k.time_delta_constructed_sites_major_hospitals_optimal[2]][3],k.time_delta_constructed_sites_major_hospitals_optimal[3].style_stops_99[4],X[k.time_delta_constructed_sites_major_hospitals_optimal[2]][4]]},time_delta_constructed_sites_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","time_delta_constructed_sites_primary_schools_fixed"],k.time_delta_constructed_sites_primary_schools_fixed[3].style_stops_99[0],X[k.time_delta_constructed_sites_primary_schools_fixed[2]][0],k.time_delta_constructed_sites_primary_schools_fixed[3].style_stops_99[1],X[k.time_delta_constructed_sites_primary_schools_fixed[2]][1],k.time_delta_constructed_sites_primary_schools_fixed[3].style_stops_99[2],X[k.time_delta_constructed_sites_primary_schools_fixed[2]][2],k.time_delta_constructed_sites_primary_schools_fixed[3].style_stops_99[3],X[k.time_delta_constructed_sites_primary_schools_fixed[2]][3],k.time_delta_constructed_sites_primary_schools_fixed[3].style_stops_99[4],X[k.time_delta_constructed_sites_primary_schools_fixed[2]][4]]},time_delta_constructed_sites_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","time_delta_constructed_sites_secondary_schools_fixed"],k.time_delta_constructed_sites_secondary_schools_fixed[3].style_stops_99[0],X[k.time_delta_constructed_sites_secondary_schools_fixed[2]][0],k.time_delta_constructed_sites_secondary_schools_fixed[3].style_stops_99[1],X[k.time_delta_constructed_sites_secondary_schools_fixed[2]][1],k.time_delta_constructed_sites_secondary_schools_fixed[3].style_stops_99[2],X[k.time_delta_constructed_sites_secondary_schools_fixed[2]][2],k.time_delta_constructed_sites_secondary_schools_fixed[3].style_stops_99[3],X[k.time_delta_constructed_sites_secondary_schools_fixed[2]][3],k.time_delta_constructed_sites_secondary_schools_fixed[3].style_stops_99[4],X[k.time_delta_constructed_sites_secondary_schools_fixed[2]][4]]},time_delta_constructed_sites_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_constructed_sites_semi_dense_urban_optimal"],k.time_delta_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[0],X[k.time_delta_constructed_sites_semi_dense_urban_optimal[2]][0],k.time_delta_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[1],X[k.time_delta_constructed_sites_semi_dense_urban_optimal[2]][1],k.time_delta_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[2],X[k.time_delta_constructed_sites_semi_dense_urban_optimal[2]][2],k.time_delta_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[3],X[k.time_delta_constructed_sites_semi_dense_urban_optimal[2]][3],k.time_delta_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[4],X[k.time_delta_constructed_sites_semi_dense_urban_optimal[2]][4]]},time_delta_no_sites_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","time_delta_no_sites_all_education_facilities_fixed"],k.time_delta_no_sites_all_education_facilities_fixed[3].style_stops_99[0],X[k.time_delta_no_sites_all_education_facilities_fixed[2]][0],k.time_delta_no_sites_all_education_facilities_fixed[3].style_stops_99[1],X[k.time_delta_no_sites_all_education_facilities_fixed[2]][1],k.time_delta_no_sites_all_education_facilities_fixed[3].style_stops_99[2],X[k.time_delta_no_sites_all_education_facilities_fixed[2]][2],k.time_delta_no_sites_all_education_facilities_fixed[3].style_stops_99[3],X[k.time_delta_no_sites_all_education_facilities_fixed[2]][3],k.time_delta_no_sites_all_education_facilities_fixed[3].style_stops_99[4],X[k.time_delta_no_sites_all_education_facilities_fixed[2]][4]]},time_delta_no_sites_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_no_sites_all_health_facilities_optimal"],k.time_delta_no_sites_all_health_facilities_optimal[3].style_stops_99[0],X[k.time_delta_no_sites_all_health_facilities_optimal[2]][0],k.time_delta_no_sites_all_health_facilities_optimal[3].style_stops_99[1],X[k.time_delta_no_sites_all_health_facilities_optimal[2]][1],k.time_delta_no_sites_all_health_facilities_optimal[3].style_stops_99[2],X[k.time_delta_no_sites_all_health_facilities_optimal[2]][2],k.time_delta_no_sites_all_health_facilities_optimal[3].style_stops_99[3],X[k.time_delta_no_sites_all_health_facilities_optimal[2]][3],k.time_delta_no_sites_all_health_facilities_optimal[3].style_stops_99[4],X[k.time_delta_no_sites_all_health_facilities_optimal[2]][4]]},time_delta_no_sites_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_no_sites_health_centers_optimal"],k.time_delta_no_sites_health_centers_optimal[3].style_stops_99[0],X[k.time_delta_no_sites_health_centers_optimal[2]][0],k.time_delta_no_sites_health_centers_optimal[3].style_stops_99[1],X[k.time_delta_no_sites_health_centers_optimal[2]][1],k.time_delta_no_sites_health_centers_optimal[3].style_stops_99[2],X[k.time_delta_no_sites_health_centers_optimal[2]][2],k.time_delta_no_sites_health_centers_optimal[3].style_stops_99[3],X[k.time_delta_no_sites_health_centers_optimal[2]][3],k.time_delta_no_sites_health_centers_optimal[3].style_stops_99[4],X[k.time_delta_no_sites_health_centers_optimal[2]][4]]},time_delta_no_sites_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_no_sites_health_posts_optimal"],k.time_delta_no_sites_health_posts_optimal[3].style_stops_99[0],X[k.time_delta_no_sites_health_posts_optimal[2]][0],k.time_delta_no_sites_health_posts_optimal[3].style_stops_99[1],X[k.time_delta_no_sites_health_posts_optimal[2]][1],k.time_delta_no_sites_health_posts_optimal[3].style_stops_99[2],X[k.time_delta_no_sites_health_posts_optimal[2]][2],k.time_delta_no_sites_health_posts_optimal[3].style_stops_99[3],X[k.time_delta_no_sites_health_posts_optimal[2]][3],k.time_delta_no_sites_health_posts_optimal[3].style_stops_99[4],X[k.time_delta_no_sites_health_posts_optimal[2]][4]]},time_delta_no_sites_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_no_sites_major_hospitals_optimal"],k.time_delta_no_sites_major_hospitals_optimal[3].style_stops_99[0],X[k.time_delta_no_sites_major_hospitals_optimal[2]][0],k.time_delta_no_sites_major_hospitals_optimal[3].style_stops_99[1],X[k.time_delta_no_sites_major_hospitals_optimal[2]][1],k.time_delta_no_sites_major_hospitals_optimal[3].style_stops_99[2],X[k.time_delta_no_sites_major_hospitals_optimal[2]][2],k.time_delta_no_sites_major_hospitals_optimal[3].style_stops_99[3],X[k.time_delta_no_sites_major_hospitals_optimal[2]][3],k.time_delta_no_sites_major_hospitals_optimal[3].style_stops_99[4],X[k.time_delta_no_sites_major_hospitals_optimal[2]][4]]},time_delta_no_sites_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","time_delta_no_sites_primary_schools_fixed"],k.time_delta_no_sites_primary_schools_fixed[3].style_stops_99[0],X[k.time_delta_no_sites_primary_schools_fixed[2]][0],k.time_delta_no_sites_primary_schools_fixed[3].style_stops_99[1],X[k.time_delta_no_sites_primary_schools_fixed[2]][1],k.time_delta_no_sites_primary_schools_fixed[3].style_stops_99[2],X[k.time_delta_no_sites_primary_schools_fixed[2]][2],k.time_delta_no_sites_primary_schools_fixed[3].style_stops_99[3],X[k.time_delta_no_sites_primary_schools_fixed[2]][3],k.time_delta_no_sites_primary_schools_fixed[3].style_stops_99[4],X[k.time_delta_no_sites_primary_schools_fixed[2]][4]]},time_delta_no_sites_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","time_delta_no_sites_secondary_schools_fixed"],k.time_delta_no_sites_secondary_schools_fixed[3].style_stops_99[0],X[k.time_delta_no_sites_secondary_schools_fixed[2]][0],k.time_delta_no_sites_secondary_schools_fixed[3].style_stops_99[1],X[k.time_delta_no_sites_secondary_schools_fixed[2]][1],k.time_delta_no_sites_secondary_schools_fixed[3].style_stops_99[2],X[k.time_delta_no_sites_secondary_schools_fixed[2]][2],k.time_delta_no_sites_secondary_schools_fixed[3].style_stops_99[3],X[k.time_delta_no_sites_secondary_schools_fixed[2]][3],k.time_delta_no_sites_secondary_schools_fixed[3].style_stops_99[4],X[k.time_delta_no_sites_secondary_schools_fixed[2]][4]]},time_delta_no_sites_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","time_delta_no_sites_semi_dense_urban_optimal"],k.time_delta_no_sites_semi_dense_urban_optimal[3].style_stops_99[0],X[k.time_delta_no_sites_semi_dense_urban_optimal[2]][0],k.time_delta_no_sites_semi_dense_urban_optimal[3].style_stops_99[1],X[k.time_delta_no_sites_semi_dense_urban_optimal[2]][1],k.time_delta_no_sites_semi_dense_urban_optimal[3].style_stops_99[2],X[k.time_delta_no_sites_semi_dense_urban_optimal[2]][2],k.time_delta_no_sites_semi_dense_urban_optimal[3].style_stops_99[3],X[k.time_delta_no_sites_semi_dense_urban_optimal[2]][3],k.time_delta_no_sites_semi_dense_urban_optimal[3].style_stops_99[4],X[k.time_delta_no_sites_semi_dense_urban_optimal[2]][4]]},travel_time_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_all_education_facilities_fixed"],k.travel_time_all_education_facilities_fixed[3].style_stops_99[0],X[k.travel_time_all_education_facilities_fixed[2]][4],k.travel_time_all_education_facilities_fixed[3].style_stops_99[1],X[k.travel_time_all_education_facilities_fixed[2]][3],k.travel_time_all_education_facilities_fixed[3].style_stops_99[2],X[k.travel_time_all_education_facilities_fixed[2]][2],k.travel_time_all_education_facilities_fixed[3].style_stops_99[3],X[k.travel_time_all_education_facilities_fixed[2]][1],k.travel_time_all_education_facilities_fixed[3].style_stops_99[4],X[k.travel_time_all_education_facilities_fixed[2]][0]]},travel_time_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_all_health_facilities_optimal"],k.travel_time_all_health_facilities_optimal[3].style_stops_99[0],X[k.travel_time_all_health_facilities_optimal[2]][4],k.travel_time_all_health_facilities_optimal[3].style_stops_99[1],X[k.travel_time_all_health_facilities_optimal[2]][3],k.travel_time_all_health_facilities_optimal[3].style_stops_99[2],X[k.travel_time_all_health_facilities_optimal[2]][2],k.travel_time_all_health_facilities_optimal[3].style_stops_99[3],X[k.travel_time_all_health_facilities_optimal[2]][1],k.travel_time_all_health_facilities_optimal[3].style_stops_99[4],X[k.travel_time_all_health_facilities_optimal[2]][0]]},travel_time_constructed_sites_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_all_education_facilities_fixed"],k.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[0],X[k.travel_time_constructed_sites_all_education_facilities_fixed[2]][4],k.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[1],X[k.travel_time_constructed_sites_all_education_facilities_fixed[2]][3],k.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[2],X[k.travel_time_constructed_sites_all_education_facilities_fixed[2]][2],k.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[3],X[k.travel_time_constructed_sites_all_education_facilities_fixed[2]][1],k.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[4],X[k.travel_time_constructed_sites_all_education_facilities_fixed[2]][0]]},travel_time_constructed_sites_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_all_health_facilities_optimal"],k.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[0],X[k.travel_time_constructed_sites_all_health_facilities_optimal[2]][4],k.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[1],X[k.travel_time_constructed_sites_all_health_facilities_optimal[2]][3],k.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[2],X[k.travel_time_constructed_sites_all_health_facilities_optimal[2]][2],k.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[3],X[k.travel_time_constructed_sites_all_health_facilities_optimal[2]][1],k.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[4],X[k.travel_time_constructed_sites_all_health_facilities_optimal[2]][0]]},travel_time_constructed_sites_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_health_centers_optimal"],k.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[0],X[k.travel_time_constructed_sites_health_centers_optimal[2]][4],k.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[1],X[k.travel_time_constructed_sites_health_centers_optimal[2]][3],k.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[2],X[k.travel_time_constructed_sites_health_centers_optimal[2]][2],k.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[3],X[k.travel_time_constructed_sites_health_centers_optimal[2]][1],k.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[4],X[k.travel_time_constructed_sites_health_centers_optimal[2]][0]]},travel_time_constructed_sites_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_health_posts_optimal"],k.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[0],X[k.travel_time_constructed_sites_health_posts_optimal[2]][4],k.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[1],X[k.travel_time_constructed_sites_health_posts_optimal[2]][3],k.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[2],X[k.travel_time_constructed_sites_health_posts_optimal[2]][2],k.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[3],X[k.travel_time_constructed_sites_health_posts_optimal[2]][1],k.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[4],X[k.travel_time_constructed_sites_health_posts_optimal[2]][0]]},travel_time_constructed_sites_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_major_hospitals_optimal"],k.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[0],X[k.travel_time_constructed_sites_major_hospitals_optimal[2]][4],k.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[1],X[k.travel_time_constructed_sites_major_hospitals_optimal[2]][3],k.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[2],X[k.travel_time_constructed_sites_major_hospitals_optimal[2]][2],k.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[3],X[k.travel_time_constructed_sites_major_hospitals_optimal[2]][1],k.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[4],X[k.travel_time_constructed_sites_major_hospitals_optimal[2]][0]]},travel_time_constructed_sites_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_primary_schools_fixed"],k.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[0],X[k.travel_time_constructed_sites_primary_schools_fixed[2]][4],k.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[1],X[k.travel_time_constructed_sites_primary_schools_fixed[2]][3],k.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[2],X[k.travel_time_constructed_sites_primary_schools_fixed[2]][2],k.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[3],X[k.travel_time_constructed_sites_primary_schools_fixed[2]][1],k.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[4],X[k.travel_time_constructed_sites_primary_schools_fixed[2]][0]]},travel_time_constructed_sites_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_secondary_schools_fixed"],k.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[0],X[k.travel_time_constructed_sites_secondary_schools_fixed[2]][4],k.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[1],X[k.travel_time_constructed_sites_secondary_schools_fixed[2]][3],k.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[2],X[k.travel_time_constructed_sites_secondary_schools_fixed[2]][2],k.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[3],X[k.travel_time_constructed_sites_secondary_schools_fixed[2]][1],k.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[4],X[k.travel_time_constructed_sites_secondary_schools_fixed[2]][0]]},travel_time_constructed_sites_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_semi_dense_urban_optimal"],k.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[0],X[k.travel_time_constructed_sites_semi_dense_urban_optimal[2]][4],k.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[1],X[k.travel_time_constructed_sites_semi_dense_urban_optimal[2]][3],k.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[2],X[k.travel_time_constructed_sites_semi_dense_urban_optimal[2]][2],k.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[3],X[k.travel_time_constructed_sites_semi_dense_urban_optimal[2]][1],k.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[4],X[k.travel_time_constructed_sites_semi_dense_urban_optimal[2]][0]]},travel_time_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_health_centers_optimal"],k.travel_time_health_centers_optimal[3].style_stops_99[0],X[k.travel_time_health_centers_optimal[2]][4],k.travel_time_health_centers_optimal[3].style_stops_99[1],X[k.travel_time_health_centers_optimal[2]][3],k.travel_time_health_centers_optimal[3].style_stops_99[2],X[k.travel_time_health_centers_optimal[2]][2],k.travel_time_health_centers_optimal[3].style_stops_99[3],X[k.travel_time_health_centers_optimal[2]][1],k.travel_time_health_centers_optimal[3].style_stops_99[4],X[k.travel_time_health_centers_optimal[2]][0]]},travel_time_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_health_posts_optimal"],k.travel_time_health_posts_optimal[3].style_stops_99[0],X[k.travel_time_health_posts_optimal[2]][4],k.travel_time_health_posts_optimal[3].style_stops_99[1],X[k.travel_time_health_posts_optimal[2]][3],k.travel_time_health_posts_optimal[3].style_stops_99[2],X[k.travel_time_health_posts_optimal[2]][2],k.travel_time_health_posts_optimal[3].style_stops_99[3],X[k.travel_time_health_posts_optimal[2]][1],k.travel_time_health_posts_optimal[3].style_stops_99[4],X[k.travel_time_health_posts_optimal[2]][0]]},travel_time_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_major_hospitals_optimal"],k.travel_time_major_hospitals_optimal[3].style_stops_99[0],X[k.travel_time_major_hospitals_optimal[2]][4],k.travel_time_major_hospitals_optimal[3].style_stops_99[1],X[k.travel_time_major_hospitals_optimal[2]][3],k.travel_time_major_hospitals_optimal[3].style_stops_99[2],X[k.travel_time_major_hospitals_optimal[2]][2],k.travel_time_major_hospitals_optimal[3].style_stops_99[3],X[k.travel_time_major_hospitals_optimal[2]][1],k.travel_time_major_hospitals_optimal[3].style_stops_99[4],X[k.travel_time_major_hospitals_optimal[2]][0]]},travel_time_no_sites_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_all_education_facilities_fixed"],k.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[0],X[k.travel_time_no_sites_all_education_facilities_fixed[2]][4],k.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[1],X[k.travel_time_no_sites_all_education_facilities_fixed[2]][3],k.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[2],X[k.travel_time_no_sites_all_education_facilities_fixed[2]][2],k.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[3],X[k.travel_time_no_sites_all_education_facilities_fixed[2]][1],k.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[4],X[k.travel_time_no_sites_all_education_facilities_fixed[2]][0]]},travel_time_no_sites_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_all_health_facilities_optimal"],k.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[0],X[k.travel_time_no_sites_all_health_facilities_optimal[2]][4],k.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[1],X[k.travel_time_no_sites_all_health_facilities_optimal[2]][3],k.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[2],X[k.travel_time_no_sites_all_health_facilities_optimal[2]][2],k.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[3],X[k.travel_time_no_sites_all_health_facilities_optimal[2]][1],k.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[4],X[k.travel_time_no_sites_all_health_facilities_optimal[2]][0]]},travel_time_no_sites_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_health_centers_optimal"],k.travel_time_no_sites_health_centers_optimal[3].style_stops_99[0],X[k.travel_time_no_sites_health_centers_optimal[2]][4],k.travel_time_no_sites_health_centers_optimal[3].style_stops_99[1],X[k.travel_time_no_sites_health_centers_optimal[2]][3],k.travel_time_no_sites_health_centers_optimal[3].style_stops_99[2],X[k.travel_time_no_sites_health_centers_optimal[2]][2],k.travel_time_no_sites_health_centers_optimal[3].style_stops_99[3],X[k.travel_time_no_sites_health_centers_optimal[2]][1],k.travel_time_no_sites_health_centers_optimal[3].style_stops_99[4],X[k.travel_time_no_sites_health_centers_optimal[2]][0]]},travel_time_no_sites_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_health_posts_optimal"],k.travel_time_no_sites_health_posts_optimal[3].style_stops_99[0],X[k.travel_time_no_sites_health_posts_optimal[2]][4],k.travel_time_no_sites_health_posts_optimal[3].style_stops_99[1],X[k.travel_time_no_sites_health_posts_optimal[2]][3],k.travel_time_no_sites_health_posts_optimal[3].style_stops_99[2],X[k.travel_time_no_sites_health_posts_optimal[2]][2],k.travel_time_no_sites_health_posts_optimal[3].style_stops_99[3],X[k.travel_time_no_sites_health_posts_optimal[2]][1],k.travel_time_no_sites_health_posts_optimal[3].style_stops_99[4],X[k.travel_time_no_sites_health_posts_optimal[2]][0]]},travel_time_no_sites_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_major_hospitals_optimal"],k.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[0],X[k.travel_time_no_sites_major_hospitals_optimal[2]][4],k.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[1],X[k.travel_time_no_sites_major_hospitals_optimal[2]][3],k.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[2],X[k.travel_time_no_sites_major_hospitals_optimal[2]][2],k.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[3],X[k.travel_time_no_sites_major_hospitals_optimal[2]][1],k.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[4],X[k.travel_time_no_sites_major_hospitals_optimal[2]][0]]},travel_time_no_sites_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_primary_schools_fixed"],k.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[0],X[k.travel_time_no_sites_primary_schools_fixed[2]][4],k.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[1],X[k.travel_time_no_sites_primary_schools_fixed[2]][3],k.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[2],X[k.travel_time_no_sites_primary_schools_fixed[2]][2],k.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[3],X[k.travel_time_no_sites_primary_schools_fixed[2]][1],k.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[4],X[k.travel_time_no_sites_primary_schools_fixed[2]][0]]},travel_time_no_sites_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_secondary_schools_fixed"],k.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[0],X[k.travel_time_no_sites_secondary_schools_fixed[2]][4],k.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[1],X[k.travel_time_no_sites_secondary_schools_fixed[2]][3],k.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[2],X[k.travel_time_no_sites_secondary_schools_fixed[2]][2],k.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[3],X[k.travel_time_no_sites_secondary_schools_fixed[2]][1],k.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[4],X[k.travel_time_no_sites_secondary_schools_fixed[2]][0]]},travel_time_no_sites_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_semi_dense_urban_optimal"],k.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[0],X[k.travel_time_no_sites_semi_dense_urban_optimal[2]][4],k.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[1],X[k.travel_time_no_sites_semi_dense_urban_optimal[2]][3],k.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[2],X[k.travel_time_no_sites_semi_dense_urban_optimal[2]][2],k.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[3],X[k.travel_time_no_sites_semi_dense_urban_optimal[2]][1],k.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[4],X[k.travel_time_no_sites_semi_dense_urban_optimal[2]][0]]},travel_time_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_primary_schools_fixed"],k.travel_time_primary_schools_fixed[3].style_stops_99[0],X[k.travel_time_primary_schools_fixed[2]][4],k.travel_time_primary_schools_fixed[3].style_stops_99[1],X[k.travel_time_primary_schools_fixed[2]][3],k.travel_time_primary_schools_fixed[3].style_stops_99[2],X[k.travel_time_primary_schools_fixed[2]][2],k.travel_time_primary_schools_fixed[3].style_stops_99[3],X[k.travel_time_primary_schools_fixed[2]][1],k.travel_time_primary_schools_fixed[3].style_stops_99[4],X[k.travel_time_primary_schools_fixed[2]][0]]},travel_time_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_secondary_schools_fixed"],k.travel_time_secondary_schools_fixed[3].style_stops_99[0],X[k.travel_time_secondary_schools_fixed[2]][4],k.travel_time_secondary_schools_fixed[3].style_stops_99[1],X[k.travel_time_secondary_schools_fixed[2]][3],k.travel_time_secondary_schools_fixed[3].style_stops_99[2],X[k.travel_time_secondary_schools_fixed[2]][2],k.travel_time_secondary_schools_fixed[3].style_stops_99[3],X[k.travel_time_secondary_schools_fixed[2]][1],k.travel_time_secondary_schools_fixed[3].style_stops_99[4],X[k.travel_time_secondary_schools_fixed[2]][0]]},travel_time_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_semi_dense_urban_optimal"],k.travel_time_semi_dense_urban_optimal[3].style_stops_99[0],X[k.travel_time_semi_dense_urban_optimal[2]][4],k.travel_time_semi_dense_urban_optimal[3].style_stops_99[1],X[k.travel_time_semi_dense_urban_optimal[2]][3],k.travel_time_semi_dense_urban_optimal[3].style_stops_99[2],X[k.travel_time_semi_dense_urban_optimal[2]][2],k.travel_time_semi_dense_urban_optimal[3].style_stops_99[3],X[k.travel_time_semi_dense_urban_optimal[2]][1],k.travel_time_semi_dense_urban_optimal[3].style_stops_99[4],X[k.travel_time_semi_dense_urban_optimal[2]][0]]}};let Nh=null;function B2(){Mi.setFilter("hover-bridge",["==",["id"],0]),Mi.setFilter("hover-health",["==",["id"],0]),Mi.setFilter("hover-edu",["==",["id"],0]),Mi.setFeatureState({source:"hex-8-source",id:Nh},{hover:!1}),document.getElementById("hover-panel").classList.remove("show")}function To(o){return o.toLowerCase().split(" ").map(function(s){return s.charAt(0).toUpperCase()+s.slice(1)}).join(" ")}function G0(o,s){let a=Object.keys(k).find(u=>JSON.stringify(k[u][0])===JSON.stringify([Xl.dropdown1,Xl.dropdown2,Xl.dropdown3]));B2(),s&&document.getElementById("hover-panel").classList.add("show"),o==="hex-8-layer"&&s?(Nh!==null&&Mi.setFeatureState({source:"hex-8-source",id:Nh},{hover:!1}),Nh=s.id,Mi.setFeatureState({source:"hex-8-source",id:Nh},{hover:!0}),a=="female_educational_attainment_mean"||a=="male_educational_attainment_mean"||a=="rwi"?document.getElementById("hover-text").innerHTML="<strong>Geographic Area</strong> </br>Population: "+s.properties.population+"</br>Wealth Index: "+s.properties.rwi.toFixed(3)+"</br>"+k[a][1][0]+": "+s.properties[a].toFixed(1)+" "+k[a][1][1]:document.getElementById("hover-text").innerHTML="<strong>Geographic Area</strong> </br>Population: "+s.properties.population+"</br>Wealth Index: "+s.properties.rwi.toFixed(3)+"</br>"+k[a][1][0]+": "+s.properties[a].toFixed(0)+" "+k[a][1][1],document.getElementById("hover-icon").src="/assets/geo-hex.svg"):o==="bridge-point"&&s?(Mi.setFilter("hover-bridge",["==",["id"],s.id]),document.getElementById("hover-text").innerHTML="<strong>Bridge Site</strong> </br>Status: "+s.properties.stage_public+" Site </br>Region: "+s.properties.level_2_government+"</br>Population Served: "+s.properties.individuals_directly_served,document.getElementById("hover-icon").src="/assets/bridge-hex.svg"):o==="health-point"&&s?(Mi.setFilter("hover-health",["==",["id"],s.id]),document.getElementById("hover-text").innerHTML="<strong>"+To(s.properties.category)+"</strong> </br>District: "+To(s.properties.district)+"</br> Sector: "+To(s.properties.sector)+"</br> Village: "+To(s.properties.village),document.getElementById("hover-icon").src="/assets/health-hex.svg"):o==="edu-point"&&s&&(Mi.setFilter("hover-edu",["==",["id"],s.id]),document.getElementById("hover-text").innerHTML="<strong>"+To(s.properties.category)+"</strong> </br>District: "+To(s.properties.district)+"</br> Sector: "+To(s.properties.sector)+"</br> Village: "+To(s.properties.village),document.getElementById("hover-icon").src="/assets/edu-hex.svg")}const F2=document.getElementById("click-panel");let Od=[],Bd=[],jh=[],Qd=[],$0=[],q0=["ps-paths","ss-paths","hp-paths","hc-paths","hos-paths","sdu-paths","ps-paths-outline","ss-paths-outline","hp-paths-outline","hc-paths-outline","hos-paths-outline","sdu-paths-outline"];function N2(o,s){jh=[s.travel_time_education_primary,s.travel_time_education_secondary,s.travel_time_health_centers,s.travel_time_health_major,s.travel_time_markets],Qd=[s.travel_time_all_removed_fixed_education_primary,s.travel_time_all_removed_fixed_education_secondary,s.travel_time_all_removed_optimal_health_centers,s.travel_time_all_removed_optimal_health_major,s.travel_time_all_removed_fixed_markets],Od=[],Bd=[];for(let d=0;d<jh.length;d++)jh[d]>120?Od.push(120):Od.push(jh[d]),Qd[d]>120?Bd.push(120):Bd.push(Qd[d]);document.getElementById("words-click").innerHTML="",F2.classList.add("show"),$0=[Math.round(s.kids_0_9),Math.round(s.kids_10_14),Math.round(s.males_15_49),Math.round(s.females_15_49),Math.round(s.people_65_plus)],A_.data.datasets[0].data=Od,A_.data.datasets[1].data=Bd,Sx.data.datasets[0].data=$0,A_.update(),Sx.update();for(var a in s)s.hasOwnProperty(a)&&(document.getElementById("words-click").innerHTML+=a+" -> "+s[a]+"<br>");var u=s["h3-index"];for(let d=0;d<q0.length;d++)Mi.setFilter(q0[d],["==","h3-index",u])}let Yl={dropdown1:["Demographics","Population","Impact","Travel Time"],dropdown2:{Demographics:["Pregnancies","Births","Relative Wealth Index","Underweight","Female Education","Male Education"],Population:["All","Children 0-4","Children 5-9","Children 0-9","Youth 10-14","People 15-49","People 50-64","People 65+","Female 0-4","Female 5-9","Female 0-9","Female 10-14","Female 15-49","Female 50-64","Female 65+","Male 0-4","Male 5-9","Male 0-9","Male 10-14","Male 15-49","Male 50-64","Male 65+"],Impact:["Potential Impact","Current Impact"],TravelTime:["Without Bridges","With Constructed Bridges","With All Bridges"]},dropdown3:{Demographics:["N/A"],Population:["N/A"],Impact:["School","Healthcare","Market","Primary School","Secondary School","Health Post","Health Center","Major Hospital"],TravelTime:["To School","To Healthcare","To Market","To Primary School","To Secondary School","To Health Post","To Health Center","To Hospital"]},dropdown4:["Standard map","Satellite"]};function Kl(o,s){for(;s.firstChild;)s.removeChild(s.firstChild);for(let a=0;a<o.length;a++){let u=document.createElement("option");u.text=o[a],u.value=o[a],s.appendChild(u),o[a]=="N/A"?s.disabled=!0:s.disabled=!1}}function j2(o){console.log(o),o=="Standard basemap"?Mi.setLayoutProperty("satellite-base","visibility","none"):Mi.setLayoutProperty("satellite-base","visibility","visible")}let l_=document.getElementById("trans-slider");l_.addEventListener("change",function(){console.log(l_.value),Mi.setPaintProperty("hex-8-layer","fill-opacity",Number(l_.value)/100)});function V2(o){o.addSource("hex-8-source",{type:"geojson",data:"./rwa_travel_time_hex-8.geojson",generateId:!0}),o.addLayer({id:"hex-8-layer",type:"fill",source:"hex-8-source",paint:{"fill-color":C_.male_educational_attainment_mean["fill-color"],"fill-opacity":.5,"fill-outline-color":"rgba(255, 255, 255, .1)"}},"admin-0-boundary-disputed"),o.addLayer({id:"hex-8-hover",type:"line",source:"hex-8-source",paint:{"line-color":"#66BEC7","line-width":["interpolate",["linear"],["zoom"],3,.5,15,2],"line-opacity":["case",["boolean",["feature-state","hover"],!1],.75,0]}}),o.addLayer({id:"hex-8-click",type:"fill",source:"hex-8-source",paint:{"fill-color":"#66BEC7","fill-opacity":["case",["boolean",["feature-state","click"],!1],.8,0]}},"admin-0-boundary-disputed")}function U2(o){console.log(o),console.log(JSON.stringify([o.dropdown1,o.dropdown2,o.dropdown3]));let s=Object.keys(k).find(a=>JSON.stringify(k[a][0])===JSON.stringify([o.dropdown1,o.dropdown2,o.dropdown3]));console.log(s),console.log(C_[s]),Mi.setPaintProperty("hex-8-layer","fill-color",C_[s]["fill-color"])}var Us=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mx(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function G2(o){if(o.__esModule)return o;var s=o.default;if(typeof s=="function"){var a=function u(){if(this instanceof u){var d=[null];d.push.apply(d,arguments);var g=Function.bind.apply(s,d);return new g}return s.apply(this,arguments)};a.prototype=s.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(o).forEach(function(u){var d=Object.getOwnPropertyDescriptor(o,u);Object.defineProperty(a,u,d.get?d:{enumerable:!0,get:function(){return o[u]}})}),a}var Ax={exports:{}};(function(o,s){(function(a,u){o.exports=u()})(Us,function(){var a,u,d;function g(r,T){if(!a)a=T;else if(!u)u=T;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",R={};a(R),d=T(R),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}g(["exports"],function(r){var T=typeof self<"u"?self:{},I="2.15.0";let R;const F={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(R==null){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{R={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):t}catch{R=t}}return R},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!F.API_URL)return null;try{const t=new URL(F.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},U={supported:!1,testSupport:function(t){!ce&&ie&&(he?be(t):Y=t)}};let Y,ie,ce=!1,he=!1;function be(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ie),t.isContextLost())return;U.supported=!0}catch{}t.deleteTexture(e),ce=!0}T.document&&(ie=T.document.createElement("img"),ie.onload=function(){Y&&be(Y),Y=null,he=!0},ie.onerror=function(){ce=!0,Y=null},ie.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const De="01";function Fe(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var We=Re;function Re(t,e,i,l){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(l-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=i,this.p2y=l}Re.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var i=t,l=0;l<8;l++){var h=this.sampleCurveX(i)-t;if(Math.abs(h)<e)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=h/f}var m=0,x=1;for(i=t,l=0;l<20&&(h=this.sampleCurveX(i),!(Math.abs(h-t)<e));l++)t>h?m=i:x=i,i=.5*(x-m)+m;return i},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Je=Fe(We),nt=st;function st(t,e){this.x=t,this.y=e}st.prototype={clone:function(){return new st(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),l=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=l,this},_rotateAround:function(t,e){var i=Math.cos(t),l=Math.sin(t),h=e.y+l*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-l*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},st.convert=function(t){return t instanceof st?t:Array.isArray(t)?new st(t[0],t[1]):t};var Le=Fe(nt);const Lt=Math.PI/180,zt=180/Math.PI;function ft(t){return t*Lt}function Gt(t){return t*zt}const on=[[0,0],[1,0],[1,1],[0,1]];function Kt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)}function ti(t,e,i,l){const h=new Je(t,e,i,l);return function(f){return h.solve(f)}}const yi=ti(.25,.1,.25,1);function bt(t,e,i){return Math.min(i,Math.max(e,t))}function Pi(t,e,i){return(i=bt((i-t)/(e-t),0,1))*i*(3-2*i)}function xi(t,e,i){const l=i-e,h=((t-e)%l+l)%l+e;return h===e?i:h}function ki(t,e,i){if(!t.length)return i(null,[]);let l=t.length;const h=new Array(t.length);let f=null;t.forEach((m,x)=>{e(m,(w,E)=>{w&&(f=w),h[x]=E,--l==0&&i(f,h)})})}function gn(t){const e=[];for(const i in t)e.push(t[i]);return e}function _i(t,...e){for(const i of e)for(const l in i)t[l]=i[l];return t}let vn=1;function Nn(){return vn++}function bn(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function vs(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Ua(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function hr(t,e){t.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function jr(t,e){return t.indexOf(e,t.length-e.length)!==-1}function Nt(t,e,i){const l={};for(const h in t)l[h]=e.call(i||this,t[h],h,t);return l}function Vr(t,e,i){const l={};for(const h in t)e.call(i||this,t[h],h,t)&&(l[h]=t[h]);return l}function zn(t){return Array.isArray(t)?t.map(zn):typeof t=="object"&&t?Nt(t,zn):t}const Ro={};function Ti(t){Ro[t]||(typeof console<"u"&&console.warn(t),Ro[t]=!0)}function jn(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)}function Ga(t){let e=0;for(let i,l,h=0,f=t.length,m=f-1;h<f;m=h++)i=t[h],l=t[m],e+=(l.x-i.x)*(i.y+l.y);return e}function bs(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Rn(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,h,f)=>{const m=h||f;return e[l]=!m||m.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Oo=null;function Ur(t){if(Oo==null){const e=t.navigator?t.navigator.userAgent:null;Oo=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Oo}function Bo(t){try{const e=T[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Ws(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const Gr="mapbox-tiles";let $a=500,qa=50,Vn,Zs;function Fo(){try{return T.caches}catch{}}function ur(){Fo()&&!Vn&&(Vn=T.caches.open(Gr))}function $r(t){const e=t.indexOf("?");if(e<0)return t;const i=function(h){const f=h.indexOf("?");return f>0?h.slice(f+1).split("&"):[]}(t),l=i.filter(h=>{const f=h.split("=");return f[0]==="language"||f[0]==="worldview"});return l.length?`${t.slice(0,e)}?${l.join("&")}`:t.slice(0,e)}let No=1/0;const dr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(dr);class Hs extends Error{constructor(e,i,l){i===401&&Te(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const pr=bs()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,fr=function(t,e){if(!(/^file:/.test(i=t.url)||/^file:/.test(pr())&&!/^\w+:/.test(i))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return function(l,h){const f=new T.AbortController,m=new T.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:pr(),referrerPolicy:l.referrerPolicy,signal:f.signal});let x=!1,w=!1;const E=(A=m.url).indexOf("sku=")>0&&Te(A);var A;l.type==="json"&&m.headers.set("Accept","application/json");const P=(O,B,V)=>{if(w)return;if(O&&O.message!=="SecurityError"&&Ti(O.toString()),B&&V)return D(B);const W=Date.now();T.fetch(m).then(ee=>{if(ee.ok){const le=E?ee.clone():null;return D(ee,le,W)}return h(new Hs(ee.statusText,ee.status,l.url))}).catch(ee=>{ee.name!=="AbortError"&&h(new Error(`${ee.message} ${l.url}`))})},D=(O,B,V)=>{(l.type==="arrayBuffer"?O.arrayBuffer():l.type==="json"?O.json():O.text()).then(W=>{w||(B&&V&&function(ee,le,te){if(ur(),!Vn)return;const oe={status:le.status,statusText:le.statusText,headers:new T.Headers};le.headers.forEach((Ce,Se)=>oe.headers.set(Se,Ce));const de=Rn(le.headers.get("Cache-Control")||"");if(de["no-store"])return;de["max-age"]&&oe.headers.set("Expires",new Date(te+1e3*de["max-age"]).toUTCString());const ue=oe.headers.get("Expires");ue&&(new Date(ue).getTime()-te<42e4||function(Ce,Se){if(Zs===void 0)try{new Response(new ReadableStream),Zs=!0}catch{Zs=!1}Zs?Se(Ce.body):Ce.blob().then(Se)}(le,Ce=>{const Se=new T.Response(Ce,oe);ur(),Vn&&Vn.then(Be=>Be.put($r(ee.url),Se)).catch(Be=>Ti(Be.message))}))}(m,B,V),x=!0,h(null,W,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(W=>{w||h(new Error(W.message))})};return E?function(O,B){if(ur(),!Vn)return B(null);const V=$r(O.url);Vn.then(W=>{W.match(V).then(ee=>{const le=function(te){if(!te)return!1;const oe=new Date(te.headers.get("Expires")||0),de=Rn(te.headers.get("Cache-Control")||"");return oe>Date.now()&&!de["no-cache"]}(ee);W.delete(V),le&&W.put(V,ee.clone()),B(null,ee,le)}).catch(B)}).catch(B)}(m,P):P(null,null),{cancel:()=>{w=!0,x||f.abort()}}}(t,e);if(bs()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var i;return function(l,h){const f=new T.XMLHttpRequest;f.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in l.headers)f.setRequestHeader(m,l.headers[m]);return l.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=l.credentials==="include",f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(l.type==="json")try{m=JSON.parse(f.response)}catch(x){return h(x)}h(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new Hs(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}}(t,e)},qr=function(t,e){return fr(_i(t,{type:"arrayBuffer"}),e)};function Wa(t){const e=T.document.createElement("a");return e.href=t,e.protocol===T.document.location.protocol&&e.host===T.document.location.host}const ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let G,$;G=[],$=0;const re=function(t,e){if(U.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),$>=F.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return G.push(f),f}$++;let i=!1;const l=()=>{if(!i)for(i=!0,$--;G.length&&$<F.MAX_PARALLEL_IMAGE_REQUESTS;){const f=G.shift(),{requestParameters:m,callback:x,cancelled:w}=f;w||(f.cancel=re(m,x).cancel)}},h=qr(t,(f,m,x,w)=>{l(),f?e(f):m&&(T.createImageBitmap?function(E,A){const P=new T.Blob([new Uint8Array(E)],{type:"image/png"});T.createImageBitmap(P).then(D=>{A(null,D)}).catch(D=>{A(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,A)=>e(E,A,x,w)):function(E,A){const P=new T.Image,D=T.URL;P.onload=()=>{A(null,P),D.revokeObjectURL(P.src),P.onload=null,T.requestAnimationFrame(()=>{P.src=ae})},P.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new T.Blob([new Uint8Array(E)],{type:"image/png"});P.src=E.byteLength?D.createObjectURL(O):ae}(m,(E,A)=>e(E,A,x,w)))});return{cancel:()=>{h.cancel(),l()}}},pe="NO_ACCESS_TOKEN";function ye(t){return t.indexOf("mapbox:")===0}function Te(t){return F.API_URL_REGEX.test(t)}function we(t){return F.API_CDN_URL_REGEX.test(t)}function ge(t){return F.API_STYLE_REGEX.test(t)&&!ke(t)}function ke(t){return F.API_SPRITE_REGEX.test(t)}const tt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(t){const e=t.match(tt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ke(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Mt="mapbox.eventData";function Pt(t){if(!t)return null;const e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class At{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Pt(F.ACCESS_TOKEN);let l="";return l=i&&i.u?T.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(+("0x"+f)))):F.ACCESS_TOKEN||"",e?`${Mt}.${e}:${l}`:`${Mt}:${l}`}fetchEventData(){const e=Bo("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{const h=T.localStorage.getItem(i);h&&(this.eventData=JSON.parse(h));const f=T.localStorage.getItem(l);f&&(this.anonId=f)}catch{Ti("Unable to read from LocalStorage")}}saveEventData(){const e=Bo("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(e)try{T.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Ti("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,l,h){if(!F.EVENTS_URL)return;const f=it(F.EVENTS_URL);f.params.push(`access_token=${h||F.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},x=i?_i(m,i):m,w={url:Ke(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(E,A){return fr(_i(E,{method:"POST"}),A)}(w,E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(h)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const kt=new class extends At{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(t)&&t.some(i=>ye(i)||Te(i))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Pt(F.ACCESS_TOKEN),i=e?e.u:F.ACCESS_TOKEN;let l=i!==this.eventData.tokenU;Ua(this.anonId)||(this.anonId=bn(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||f.getDate()!==m.getDate()}else l=!0;l?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:De,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=i)},t):this.processRequests()}},jt=kt.postTurnstileEvent.bind(kt),Ei=new class extends At{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,i,l){this.skuToken=e,this.errorCb=l,F.EVENTS_URL&&(i||F.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(pe)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Ua(this.anonId)||(this.anonId=bn()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:De,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},t))}},Ni=Ei.postMapLoadEvent.bind(Ei),un=new class extends At{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){F.EVENTS_URL&&(t||F.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),l=function(h){const f=T.performance.getEntriesByType("resource"),m=T.performance.getEntriesByType("mark"),x=function(D){const O={};if(D){for(const B in D)if(B!=="other")for(const V of D[B]){const W=`${B}ResolveRangeMin`,ee=`${B}ResolveRangeMax`,le=`${B}RequestCount`,te=`${B}RequestCachedCount`;O[W]=Math.min(O[W]||1/0,V.startTime),O[ee]=Math.max(O[ee]||-1/0,V.responseEnd);const oe=de=>{O[de]===void 0&&(O[de]=0),++O[de]};V.transferSize!==void 0&&V.transferSize===0&&oe(te),oe(le)}}return O}(function(D,O){const B={};if(D)for(const V of D){const W=O(V);B[W]===void 0&&(B[W]=[]),B[W].push(V)}return B}(f,uu)),w=T.devicePixelRatio,E=T.navigator.connection||T.navigator.mozConnection||T.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},P=(D,O,B)=>{B!=null&&D.push({name:O,value:B.toString()})};for(const D in x)P(A.counters,D,x[D]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(P(A.counters,"interactionRangeMin",h.interactionRange[0]),P(A.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const D of Object.keys(Wr)){const O=Wr[D],B=m.find(V=>V.name===O);B&&P(A.counters,O,B.startTime)}return P(A.counters,"visibilityHidden",h.visibilityHidden),P(A.attributes,"style",function(D){if(D)for(const O of D){const B=O.name.split("?")[0];if(ge(B)){const V=B.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(f)),P(A.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),P(A.attributes,"fogEnabled",h.fogEnabled?"true":"false"),P(A.attributes,"projection",h.projection),P(A.attributes,"zoom",h.zoom),P(A.metadata,"devicePixelRatio",w),P(A.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),P(A.metadata,"navigatorUserAgent",T.navigator.userAgent),P(A.metadata,"screenWidth",T.screen.width),P(A.metadata,"screenHeight",T.screen.height),P(A.metadata,"windowWidth",T.innerWidth),P(A.metadata,"windowHeight",T.innerHeight),P(A.metadata,"mapWidth",h.width/w),P(A.metadata,"mapHeight",h.height/w),P(A.metadata,"webglRenderer",h.renderer),P(A.metadata,"webglVendor",h.vendor),P(A.metadata,"sdkVersion",I),P(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const h of l.metadata);for(const h of l.counters);for(const h of l.attributes);this.postEvent(e,l,()=>{},t)}},Hi=un.postPerformanceEvent.bind(un),ls=new class extends At{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,i,l){if(!F.API_URL||!F.SESSION_PATH)return;const h=it(F.API_URL+F.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${l||F.ACCESS_TOKEN||""}`);const f={url:Ke(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,x){return fr(_i(m,{method:"GET"}),x)}(f,m=>{this.pendingRequest=null,i(m),this.saveEventData(),this.processRequests(l)})}getSessionAPI(t,e,i,l){this.skuToken=e,this.errorCb=l,F.SESSION_PATH&&F.API_URL&&(i||F.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},i):this.errorCb(new Error(pe)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,l=>{l?this.errorCb(l):e&&(this.success[e]=!0)},t)}},Qi=ls.getSessionAPI.bind(ls),yn=new Set,Wr={create:"create",load:"load",fullLoad:"fullLoad"},Cp={mark(t){T.performance.mark(t)},measure(t,e,i){T.performance.measure(t,e,i)}};function uu(t){const e=t.name.split("?")[0];return we(e)&&e.includes("mapbox-gl.js")?"javascript":we(e)&&e.includes("mapbox-gl.css")?"css":function(i){return F.API_FONTS_REGEX.test(i)}(e)?"fontRange":ke(e)?"sprite":ge(e)?"style":function(i){return F.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}const Ht=T.performance;function nc(t){const e=t?t.url.toString():void 0;return Ht.getEntriesByName(e)}let jo,sc,Za,cs;const ws={now:()=>Za!==void 0?Za:T.performance.now(),setNow(t){Za=t},restoreNow(){Za=void 0},frame(t){const e=T.requestAnimationFrame(t);return{cancel:()=>T.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:i,height:l}=t;cs||(cs=T.document.createElement("canvas"));const h=cs.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>cs.width||l>cs.height)&&(cs.width=i,cs.height=l),h.clearRect(-e,-e,i+2*e,l+2*e),h.drawImage(t,0,0,i,l),h.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:t=>(jo||(jo=T.document.createElement("a")),jo.href=t,jo.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(sc==null&&(sc=T.matchMedia("(prefers-reduced-motion: reduce)")),sc.matches)}};function rc(t,e,i){i[t]&&i[t].indexOf(e)!==-1||(i[t]=i[t]||[],i[t].push(e))}function oc(t,e,i){if(i&&i[t]){const l=i[t].indexOf(e);l!==-1&&i[t].splice(l,1)}}class _r{constructor(e,i={}){_i(this,i),this.type=e}}class Ts extends _r{constructor(e,i={}){super("error",_i({error:e},i))}}class Vo{on(e,i){return this._listeners=this._listeners||{},rc(e,i,this._listeners),this}off(e,i){return oc(e,i,this._listeners),oc(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},rc(e,i,this._oneTimeListeners),this):new Promise(l=>this.once(e,l))}fire(e,i){typeof e=="string"&&(e=new _r(e,i||{}));const l=e.type;if(this.listens(l)){e.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of h)x.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of f)oc(l,x,this._oneTimeListeners),x.call(this,e);const m=this._eventedParent;m&&(_i(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof Ts&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Oe=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Es(t,...e){for(const i of e)for(const l in i)t[l]=i[l];return t}function ji(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function en(t){if(Array.isArray(t))return t.map(en);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const i in t)e[i]=en(t[i]);return e}return ji(t)}class du extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var hs=du;class ac{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,h]of i)this.bindings[l]=h}concat(e){return new ac(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var pu=ac;const Zr={kind:"null"},lt={kind:"number"},Ft={kind:"string"},Rt={kind:"boolean"},On={kind:"color"},es={kind:"object"},Ot={kind:"value"},Bn={kind:"collator"},Uo={kind:"formatted"},mr={kind:"resolvedImage"};function Un(t,e){return{kind:"array",itemType:t,N:e}}function vi(t){if(t.kind==="array"){const e=vi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}const fu=[Zr,lt,Ft,Rt,On,Uo,es,Un(Ot),mr];function Ss(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Ss(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(const i of fu)if(!Ss(i,e))return null}}return`Expected ${vi(t)} but found ${vi(e)} instead.`}function Go(t,e){return e.some(i=>i.kind===t.kind)}function $o(t,e){return e.some(i=>i==="null"?t===null:i==="array"?Array.isArray(t):i==="object"?t&&!Array.isArray(t)&&typeof t=="object":i===typeof t)}var lc,_u={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function qo(t){return(t=Math.round(t))<0?0:t>255?255:t}function Wo(t){return qo(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function Ha(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Hr(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}try{lc={}.parseCSSColor=function(t){var e,i=t.replace(/ /g,"").toLowerCase();if(i in _u)return _u[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var l=i.indexOf("("),h=i.indexOf(")");if(l!==-1&&h+1===i.length){var f=i.substr(0,l),m=i.substr(l+1,h-(l+1)).split(","),x=1;switch(f){case"rgba":if(m.length!==4)return null;x=Ha(m.pop());case"rgb":return m.length!==3?null:[Wo(m[0]),Wo(m[1]),Wo(m[2]),x];case"hsla":if(m.length!==4)return null;x=Ha(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=Ha(m[1]),A=Ha(m[2]),P=A<=.5?A*(E+1):A+E-A*E,D=2*A-P;return[qo(255*Hr(D,P,w+1/3)),qo(255*Hr(D,P,w)),qo(255*Hr(D,P,w-1/3)),x];default:return null}}return null}}catch{}class wn{constructor(e,i,l,h=1){this.r=e,this.g=i,this.b=l,this.a=h}static parse(e){if(!e)return;if(e instanceof wn)return e;if(typeof e!="string")return;const i=lc(e);return i?new wn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,l,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(l)},${h})`}toArray(){const{r:e,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*i/h,255*l/h,h]}toArray01(){const{r:e,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[e/h,i/h,l/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:l,a:h}=this;return[e,i,l,h]}}wn.black=new wn(0,0,0,1),wn.white=new wn(1,1,1,1),wn.transparent=new wn(0,0,0,0),wn.red=new wn(1,0,0,1),wn.blue=new wn(0,0,1,1);var Oi=wn;class cc{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class hc{constructor(e,i,l,h,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=h,this.textColor=f}}class Tn{constructor(e){this.sections=e}static fromString(e){return new Tn([new hc(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof Tn?e:Tn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.name]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(l)}return e}}class Gn{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new Gn({name:e,available:!1}):null}serialize(){return["image",this.name]}}function mu(t,e,i,l){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[t,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[t,e,i,l]:[t,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Zo(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Oi||t instanceof cc||t instanceof Tn||t instanceof Gn)return!0;if(Array.isArray(t)){for(const e of t)if(!Zo(e))return!1;return!0}if(typeof t=="object"){for(const e in t)if(!Zo(t[e]))return!1;return!0}return!1}function Di(t){if(t===null)return Zr;if(typeof t=="string")return Ft;if(typeof t=="boolean")return Rt;if(typeof t=="number")return lt;if(t instanceof Oi)return On;if(t instanceof cc)return Bn;if(t instanceof Tn)return Uo;if(t instanceof Gn)return mr;if(Array.isArray(t)){const e=t.length;let i;for(const l of t){const h=Di(l);if(i){if(i===h)continue;i=Ot;break}i=h}return Un(i||Ot,e)}return es}function Ho(t){const e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Oi||t instanceof Tn||t instanceof Gn?t.toString():JSON.stringify(t)}class uc{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Zo(e[1]))return i.error("invalid value");const l=e[1];let h=Di(l);const f=i.expectedType;return h.kind!=="array"||h.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(h=f),new uc(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Oi?["rgba"].concat(this.value.toArray()):this.value instanceof Tn?this.value.serialize():this.value}}var gr=uc,an=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const dc={string:Ft,number:lt,boolean:Rt,object:es};class pc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,h=1;const f=e[0];if(f==="array"){let x,w;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in dc)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=dc[E],h++}else x=Ot;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],h++}l=Un(x,w)}else l=dc[f];const m=[];for(;h<e.length;h++){const x=i.parse(e[h],h,Ot);if(!x)return null;m.push(x)}return new pc(l,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!Ss(this.type,Di(l)))return l;if(i===this.args.length-1)throw new an(`Expected value to be of type ${vi(this.type)}, but found ${vi(Di(l))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(l=>l.serialize()))}}var Ms=pc;class Xs{constructor(e){this.type=Uo,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const h=[];let f=!1;for(let m=1;m<=e.length-1;++m){const x=e[m];if(f&&typeof x=="object"&&!Array.isArray(x)){f=!1;let w=null;if(x["font-scale"]&&(w=i.parse(x["font-scale"],1,lt),!w))return null;let E=null;if(x["text-font"]&&(E=i.parse(x["text-font"],1,Un(Ft)),!E))return null;let A=null;if(x["text-color"]&&(A=i.parse(x["text-color"],1,On),!A))return null;const P=h[h.length-1];P.scale=w,P.font=E,P.textColor=A}else{const w=i.parse(e[m],1,Ot);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new Xs(h)}evaluate(e){return new Tn(this.sections.map(i=>{const l=i.content.evaluate(e);return Di(l)===mr?new hc("",l,null,null,null):new hc(Ho(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class Xa{constructor(e){this.type=mr,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const l=i.parse(e[1],1,Ft);return l?new Xa(l):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),l=Gn.fromString(i);return l&&e.availableImages&&(l.available=e.availableImages.indexOf(i)>-1),l}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ip={"to-boolean":Rt,"to-color":On,"to-number":lt,"to-string":Ft};class fc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0];if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");const h=Ip[l],f=[];for(let m=1;m<e.length;m++){const x=i.parse(e[m],m,Ot);if(!x)return null;f.push(x)}return new fc(h,f)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const h of this.args){if(i=h.evaluate(e),l=null,i instanceof Oi)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:mu(i[0],i[1],i[2],i[3]),!l))return new Oi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new an(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new an(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Tn.fromString(Ho(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Gn.fromString(Ho(this.args[0].evaluate(e))):Ho(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Xs([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xa(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Xr=fc;const us=["Unknown","Point","LineString","Polygon"];var _c=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?us[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-t[0])+this.featureDistanceData.bearing[1]*(l*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Oi.parse(t)),e}};class yr{constructor(e,i,l,h){this.name=e,this.type=i,this._evaluate=l,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const l=e[0],h=yr.definitions[l];if(!h)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=m.filter(([E])=>!Array.isArray(E)||E.length===e.length-1);let w=null;for(const[E,A]of x){w=new bc(i.registry,i.path,null,i.scope);const P=[];let D=!1;for(let O=1;O<e.length;O++){const B=e[O],V=Array.isArray(E)?E[O-1]:E.type,W=w.parse(B,1+P.length,V);if(!W){D=!0;break}P.push(W)}if(!D)if(Array.isArray(E)&&E.length!==P.length)w.error(`Expected ${E.length} arguments, but found ${P.length} instead.`);else{for(let O=0;O<P.length;O++){const B=Array.isArray(E)?E[O]:E.type,V=P[O];w.concat(O+1).checkSubtype(B,V.type)}if(w.errors.length===0)return new yr(l,f,A,P)}}if(x.length===1)i.errors.push(...w.errors);else{const E=(x.length?x:m).map(([P])=>{return D=P,Array.isArray(D)?`(${D.map(vi).join(", ")})`:`(${vi(D.type)}...)`;var D}).join(" | "),A=[];for(let P=1;P<e.length;P++){const D=i.parse(e[P],1+A.length);if(!D)return null;A.push(vi(D.type))}i.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){yr.definitions=i;for(const l in i)e[l]=yr}}var As=yr;class Xo{constructor(e,i,l){this.type=Bn,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const h=i.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Rt);if(!h)return null;const f=i.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Rt);if(!f)return null;let m=null;return l.locale&&(m=i.parse(l.locale,1,Ft),!m)?null:new Xo(h,f,m)}evaluate(e){return new cc(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Cs=8192;function Ya(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Yr(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Yo(t,e){const i=(180+t[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Cs),Math.round(l*h*Cs)]}function gu(t,e,i){const l=t[0]-e[0],h=t[1]-e[1],f=t[0]-i[0],m=t[1]-i[1];return l*m-f*h==0&&l*f<=0&&h*m<=0}function Ka(t,e){let i=!1;for(let m=0,x=e.length;m<x;m++){const w=e[m];for(let E=0,A=w.length;E<A-1;E++){if(gu(t,w[E],w[E+1]))return!1;(h=w[E])[1]>(l=t)[1]!=(f=w[E+1])[1]>l[1]&&l[0]<(f[0]-h[0])*(l[1]-h[1])/(f[1]-h[1])+h[0]&&(i=!i)}}var l,h,f;return i}function mc(t,e){for(let i=0;i<e.length;i++)if(Ka(t,e[i]))return!0;return!1}function gc(t,e,i,l){const h=l[0]-i[0],f=l[1]-i[1],m=(t[0]-i[0])*f-h*(t[1]-i[1]),x=(e[0]-i[0])*f-h*(e[1]-i[1]);return m>0&&x<0||m<0&&x>0}function Kr(t,e,i){for(const E of i)for(let A=0;A<E.length-1;++A)if((x=[(m=E[A+1])[0]-(f=E[A])[0],m[1]-f[1]])[0]*(w=[(h=e)[0]-(l=t)[0],h[1]-l[1]])[1]-x[1]*w[0]!=0&&gc(l,h,f,m)&&gc(f,m,l,h))return!0;var l,h,f,m,x,w;return!1}function Xt(t,e){for(let i=0;i<t.length;++i)if(!Ka(t[i],e))return!1;for(let i=0;i<t.length-1;++i)if(Kr(t[i],t[i+1],e))return!1;return!0}function Pp(t,e){for(let i=0;i<e.length;i++)if(Xt(t,e[i]))return!0;return!1}function yc(t,e,i){const l=[];for(let h=0;h<t.length;h++){const f=[];for(let m=0;m<t[h].length;m++){const x=Yo(t[h][m],i);Ya(e,x),f.push(x)}l.push(f)}return l}function yu(t,e,i){const l=[];for(let h=0;h<t.length;h++){const f=yc(t[h],e,i);l.push(f)}return l}function xc(t,e,i,l){if(t[0]<i[0]||t[0]>i[2]){const h=.5*l;let f=t[0]-i[0]>h?-l:i[0]-t[0]>h?l:0;f===0&&(f=t[0]-i[2]>h?-l:i[2]-t[0]>h?l:0),t[0]+=f}Ya(e,t)}function xu(t,e,i,l){const h=Math.pow(2,l.z)*Cs,f=[l.x*Cs,l.y*Cs],m=[];if(!t)return m;for(const x of t)for(const w of x){const E=[w.x+f[0],w.y+f[1]];xc(E,e,i,h),m.push(E)}return m}function vc(t,e,i,l){const h=Math.pow(2,l.z)*Cs,f=[l.x*Cs,l.y*Cs],m=[];if(!t)return m;for(const w of t){const E=[];for(const A of w){const P=[A.x+f[0],A.y+f[1]];Ya(e,P),E.push(P)}m.push(E)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of m)for(const E of w)xc(E,e,i,h)}var x;return m}class Jr{constructor(e,i){this.type=Rt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Zo(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const f=l.features[h].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Jr(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Jr(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Jr(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const x=yc(l.coordinates,f,m),w=xu(i.geometry(),h,f,m);if(!Yr(h,f))return!1;for(const E of w)if(!Ka(E,x))return!1}if(l.type==="MultiPolygon"){const x=yu(l.coordinates,f,m),w=xu(i.geometry(),h,f,m);if(!Yr(h,f))return!1;for(const E of w)if(!mc(E,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const x=yc(l.coordinates,f,m),w=vc(i.geometry(),h,f,m);if(!Yr(h,f))return!1;for(const E of w)if(!Xt(E,x))return!1}if(l.type==="MultiPolygon"){const x=yu(l.coordinates,f,m),w=vc(i.geometry(),h,f,m);if(!Yr(h,f))return!1;for(const E of w)if(!Pp(E,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ja=Jr;function Qr(t){if(t instanceof As&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Ja)return!1;let e=!0;return t.eachChild(i=>{e&&!Qr(i)&&(e=!1)}),e}function Is(t){if(t instanceof As&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(i=>{e&&!Is(i)&&(e=!1)}),e}function xr(t,e){if(t instanceof As&&e.indexOf(t.name)>=0)return!1;let i=!0;return t.eachChild(l=>{i&&!xr(l,e)&&(i=!1)}),i}class Qa{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new Qa(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var vu=Qa;class Ko{constructor(e,i=[],l,h=new pu,f=[]){this.registry=e,this.path=i,this.key=i.map(m=>`[${m}]`).join(""),this.scope=h,this.errors=f,this.expectedType=l}parse(e,i,l,h,f={}){return i?this.concat(i,l,h)._parse(e,f):this._parse(e,f)}_parse(e,i){function l(h,f,m){return m==="assert"?new Ms(f,[h]):m==="coerce"?new Xr(f,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let m=f.parse(e,this);if(!m)return null;if(this.expectedType){const x=this.expectedType,w=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||w.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(x,w))return null}else m=l(m,x,i.typeAnnotation||"coerce");else m=l(m,x,i.typeAnnotation||"assert")}if(!(m instanceof gr)&&m.type.kind!=="resolvedImage"&&wc(m)){const x=new _c;try{m=new gr(m.type,m.evaluate(x))}catch(w){return this.error(w.message),null}}return m}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l){const h=typeof e=="number"?this.path.concat(e):this.path,f=l?this.scope.concat(l):this.scope;return new Ko(this.registry,h,i||null,f,this.errors)}error(e,...i){const l=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new hs(l,e))}checkSubtype(e,i){const l=Ss(e,i);return l&&this.error(l),l}}var bc=Ko;function wc(t){if(t instanceof vu)return wc(t.boundExpression);if(t instanceof As&&t.name==="error"||t instanceof Xo||t instanceof Ja)return!1;const e=t instanceof Xr||t instanceof Ms;let i=!0;return t.eachChild(l=>{i=e?i&&wc(l):i&&l instanceof gr}),!!i&&Qr(t)&&xr(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function el(t,e){const i=t.length-1;let l,h,f=0,m=i,x=0;for(;f<=m;)if(x=Math.floor((f+m)/2),l=t[x],h=t[x+1],l<=e){if(x===i||e<h)return x;f=x+1}else{if(!(l>e))throw new an("Input is not a number.");m=x-1}return 0}class tl{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,f]of l)this.labels.push(h),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,lt);if(!l)return null;const h=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<e.length;m+=2){const x=m===1?-1/0:e[m],w=e[m+1],E=m,A=m+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const P=i.parse(w,A,f);if(!P)return null;f=f||P.type,h.push([x,P])}return new tl(f,l,h)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return l[0].evaluate(e);const f=i.length;return h>=i[f-1]?l[f-1].evaluate(e):l[el(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Tc=tl;function Ut(t,e,i){return t*(1-i)+e*i}var Jo=Object.freeze({__proto__:null,array:function(t,e,i){return t.map((l,h)=>Ut(l,e[h],i))},color:function(t,e,i){return new Oi(Ut(t.r,e.r,i),Ut(t.g,e.g,i),Ut(t.b,e.b,i),Ut(t.a,e.a,i))},number:Ut});const bu=.95047,Ec=1.08883,wu=4/29,vr=6/29,Sc=3*vr*vr,kp=vr*vr*vr,Dp=Math.PI/180,Lp=180/Math.PI;function Mc(t){return t>kp?Math.pow(t,1/3):t/Sc+wu}function Ac(t){return t>vr?t*t*t:Sc*(t-wu)}function Cc(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function il(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Tu(t){const e=il(t.r),i=il(t.g),l=il(t.b),h=Mc((.4124564*e+.3575761*i+.1804375*l)/bu),f=Mc((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-Mc((.0193339*e+.119192*i+.9503041*l)/Ec)),alpha:t.a}}function Eu(t){let e=(t.l+16)/116,i=isNaN(t.a)?e:e+t.a/500,l=isNaN(t.b)?e:e-t.b/200;return e=1*Ac(e),i=bu*Ac(i),l=Ec*Ac(l),new Oi(Cc(3.2404542*i-1.5371385*e-.4985314*l),Cc(-.969266*i+1.8760108*e+.041556*l),Cc(.0556434*i-.2040259*e+1.0572252*l),t.alpha)}function zp(t,e,i){const l=e-t;return t+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const Qo={forward:Tu,reverse:Eu,interpolate:function(t,e,i){return{l:Ut(t.l,e.l,i),a:Ut(t.a,e.a,i),b:Ut(t.b,e.b,i),alpha:Ut(t.alpha,e.alpha,i)}}},eo={forward:function(t){const{l:e,a:i,b:l}=Tu(t),h=Math.atan2(l,i)*Lp;return{h:h<0?h+360:h,c:Math.sqrt(i*i+l*l),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Dp,i=t.c;return Eu({l:t.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:t.alpha})},interpolate:function(t,e,i){return{h:zp(t.h,e.h,i),c:Ut(t.c,e.c,i),l:Ut(t.l,e.l,i),alpha:Ut(t.alpha,e.alpha,i)}}};var Ic=Object.freeze({__proto__:null,hcl:eo,lab:Qo});class ea{constructor(e,i,l,h,f){this.type=e,this.operator=i,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[m,x]of f)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(e,i,l,h){let f=0;if(e.name==="exponential")f=Pc(i,e.base,l,h);else if(e.name==="linear")f=Pc(i,1,l,h);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new Je(m[0],m[1],m[2],m[3]).solve(Pc(i,1,l,h))}return f}static parse(e,i){let[l,h,f,...m]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,lt),!f)return null;const x=[];let w=null;l==="interpolate-hcl"||l==="interpolate-lab"?w=On:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let E=0;E<m.length;E+=2){const A=m[E],P=m[E+1],D=E+3,O=E+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(x.length&&x[x.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=i.parse(P,O,w);if(!B)return null;w=w||B.type,x.push([A,B])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ea(w,l,h,f,x):i.error(`Type ${vi(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return l[0].evaluate(e);const f=i.length;if(h>=i[f-1])return l[f-1].evaluate(e);const m=el(i,h),x=ea.interpolationFactor(this.interpolation,h,i[m],i[m+1]),w=l[m].evaluate(e),E=l[m+1].evaluate(e);return this.operator==="interpolate"?Jo[this.type.kind.toLowerCase()](w,E,x):this.operator==="interpolate-hcl"?eo.reverse(eo.interpolate(eo.forward(w),eo.forward(E),x)):Qo.reverse(Qo.interpolate(Qo.forward(w),Qo.forward(E),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function Pc(t,e,i,l){const h=l-i,f=t-i;return h===0?0:e===1?f/h:(Math.pow(e,f)-1)/(Math.pow(e,h)-1)}var ds=ea;class nl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const h=i.expectedType;h&&h.kind!=="value"&&(l=h);const f=[];for(const x of e.slice(1)){const w=i.parse(x,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,f.push(w)}const m=h&&f.some(x=>Ss(h,x.type));return new nl(m?Ot:l,f)}evaluate(e){let i,l=null,h=0;for(const f of this.args){if(h++,l=f.evaluate(e),l&&l instanceof Gn&&!l.available&&(i||(i=l),l=null,h===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var kc=nl;class sl{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=i.parse(e[f+1],f+1);if(!x)return null;l.push([m,x])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return h?new sl(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}var Su=sl;class Dc{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,lt),h=i.parse(e[2],2,Un(i.expectedType||Ot));return l&&h?new Dc(h.type.itemType,l,h):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new an(`Array index out of bounds: ${i} < 0.`);if(i>=l.length)throw new an(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i!==Math.floor(i))throw new an(`Array index must be an integer, but found ${i} instead.`);return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Rp=Dc;class Lc{constructor(e,i){this.type=Rt,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ot),h=i.parse(e[2],2,Ot);return l&&h?Go(l.type,[Rt,Ft,lt,Zr,Ot])?new Lc(l,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${vi(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!$o(i,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${vi(Di(i))} instead.`);if(!$o(l,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${vi(Di(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var rl=Lc;class ta{constructor(e,i,l){this.type=lt,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ot),h=i.parse(e[2],2,Ot);if(!l||!h)return null;if(!Go(l.type,[Rt,Ft,lt,Zr,Ot]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${vi(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,lt);return f?new ta(l,h,f):null}return new ta(l,h)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!$o(i,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${vi(Di(i))} instead.`);if(!$o(l,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${vi(Di(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return l.indexOf(i,h)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Mu=ta;class zc{constructor(e,i,l,h,f,m){this.inputType=e,this.type=i,this.input=l,this.cases=h,this.outputs=f,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const f={},m=[];for(let E=2;E<e.length-1;E+=2){let A=e[E];const P=e[E+1];Array.isArray(A)||(A=[A]);const D=i.concat(E);if(A.length===0)return D.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(l){if(D.checkSubtype(l,Di(B)))return null}else l=Di(B);if(f[String(B)]!==void 0)return D.error("Branch labels must be unique.");f[String(B)]=m.length}const O=i.parse(P,E,h);if(!O)return null;h=h||O.type,m.push(O)}const x=i.parse(e[1],1,Ot);if(!x)return null;const w=i.parse(e[e.length-1],e.length-1,h);return w?x.type.kind!=="value"&&i.concat(1).checkSubtype(l,x.type)?null:new zc(l,h,x,f,m,w):null}evaluate(e){const i=this.input.evaluate(e);return(Di(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],h={};for(const m of i){const x=h[this.cases[m]];x===void 0?(h[this.cases[m]]=l.length,l.push([this.cases[m],[m]])):l[x][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of l)e.push(x.length===1?f(x[0]):x.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var Op=zc;class Rc{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h=[];for(let m=1;m<e.length-1;m+=2){const x=i.parse(e[m],m,Rt);if(!x)return null;const w=i.parse(e[m+1],m+1,l);if(!w)return null;h.push([x,w]),l=l||w.type}const f=i.parse(e[e.length-1],e.length-1,l);return f?new Rc(l,h,f):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Au=Rc;class ia{constructor(e,i,l,h){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ot),h=i.parse(e[2],2,lt);if(!l||!h)return null;if(!Go(l.type,[Un(Ot),Ft,Ot]))return i.error(`Expected first argument to be of type array or string, but found ${vi(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,lt);return f?new ia(l.type,l,h,f):null}return new ia(l.type,l,h)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!$o(i,["string","array"]))throw new an(`Expected first argument to be of type array or string, but found ${vi(Di(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(l,h)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Cu=ia;function ol(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Iu(t,e,i,l){return l.compare(e,i)===0}function to(t,e,i){const l=t!=="=="&&t!=="!=";return class Cx{constructor(f,m,x){this.type=Rt,this.lhs=f,this.rhs=m,this.collator=x,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const x=f[0];let w=m.parse(f[1],1,Ot);if(!w)return null;if(!ol(x,w.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${vi(w.type)}'.`);let E=m.parse(f[2],2,Ot);if(!E)return null;if(!ol(x,E.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${vi(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${vi(w.type)}' and '${vi(E.type)}'.`);l&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new Ms(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new Ms(w.type,[E])));let A=null;if(f.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(f[3],3,Bn),!A)return null}return new Cx(w,E,A)}evaluate(f){const m=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const w=Di(m),E=Di(x);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new an(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Di(m),E=Di(x);if(w.kind!=="string"||E.kind!=="string")return e(f,m,x)}return this.collator?i(f,m,x,this.collator.evaluate(f)):e(f,m,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const Bp=to("==",function(t,e,i){return e===i},Iu),Fp=to("!=",function(t,e,i){return e!==i},function(t,e,i,l){return!Iu(0,e,i,l)}),Np=to("<",function(t,e,i){return e<i},function(t,e,i,l){return l.compare(e,i)<0}),jp=to(">",function(t,e,i){return e>i},function(t,e,i,l){return l.compare(e,i)>0}),Vp=to("<=",function(t,e,i){return e<=i},function(t,e,i,l){return l.compare(e,i)<=0}),Pu=to(">=",function(t,e,i){return e>=i},function(t,e,i,l){return l.compare(e,i)>=0});class al{constructor(e,i,l,h,f,m){this.type=Ft,this.number=e,this.locale=i,this.currency=l,this.unit=h,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,lt);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=i.parse(h.locale,1,Ft),!f))return null;let m=null;if(h.currency&&(m=i.parse(h.currency,1,Ft),!m))return null;let x=null;if(h.unit&&(x=i.parse(h.unit,1,Ft),!x))return null;let w=null;if(h["min-fraction-digits"]&&(w=i.parse(h["min-fraction-digits"],1,lt),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=i.parse(h["max-fraction-digits"],1,lt),!E)?null:new al(l,f,m,x,w,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class io{constructor(e){this.type=lt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${vi(l.type)} instead.`):new io(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new an(`Expected value to be of type string or array, but found ${vi(Di(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}const ku={"==":Bp,"!=":Fp,">":jp,"<":Np,">=":Pu,"<=":Vp,array:Ms,at:Rp,boolean:Ms,case:Au,coalesce:kc,collator:Xo,format:Xs,image:Xa,in:rl,"index-of":Mu,interpolate:ds,"interpolate-hcl":ds,"interpolate-lab":ds,length:io,let:Su,literal:gr,match:Op,number:Ms,"number-format":al,object:Ms,slice:Cu,step:Tc,string:Ms,"to-boolean":Xr,"to-color":Xr,"to-number":Xr,"to-string":Xr,var:vu,within:Ja};function Du(t,[e,i,l,h]){e=e.evaluate(t),i=i.evaluate(t),l=l.evaluate(t);const f=h?h.evaluate(t):1,m=mu(e,i,l,f);if(m)throw new an(m);return new Oi(e/255*f,i/255*f,l/255*f,f)}function Ps(t,e){return t in e}function ll(t,e){const i=e[t];return i===void 0?null:i}function $n(t){return{type:t}}As.register(ku,{error:[{kind:"error"},[Ft],(t,[e])=>{throw new an(e.evaluate(t))}],typeof:[Ft,[Ot],(t,[e])=>vi(Di(e.evaluate(t)))],"to-rgba":[Un(lt,4),[On],(t,[e])=>e.evaluate(t).toArray()],rgb:[On,[lt,lt,lt],Du],rgba:[On,[lt,lt,lt,lt],Du],has:{type:Rt,overloads:[[[Ft],(t,[e])=>Ps(e.evaluate(t),t.properties())],[[Ft,es],(t,[e,i])=>Ps(e.evaluate(t),i.evaluate(t))]]},get:{type:Ot,overloads:[[[Ft],(t,[e])=>ll(e.evaluate(t),t.properties())],[[Ft,es],(t,[e,i])=>ll(e.evaluate(t),i.evaluate(t))]]},"feature-state":[Ot,[Ft],(t,[e])=>ll(e.evaluate(t),t.featureState||{})],properties:[es,[],t=>t.properties()],"geometry-type":[Ft,[],t=>t.geometryType()],id:[Ot,[],t=>t.id()],zoom:[lt,[],t=>t.globals.zoom],pitch:[lt,[],t=>t.globals.pitch||0],"distance-from-center":[lt,[],t=>t.distanceFromCenter()],"heatmap-density":[lt,[],t=>t.globals.heatmapDensity||0],"line-progress":[lt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[lt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Ot,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[lt,$n(lt),(t,e)=>{let i=0;for(const l of e)i+=l.evaluate(t);return i}],"*":[lt,$n(lt),(t,e)=>{let i=1;for(const l of e)i*=l.evaluate(t);return i}],"-":{type:lt,overloads:[[[lt,lt],(t,[e,i])=>e.evaluate(t)-i.evaluate(t)],[[lt],(t,[e])=>-e.evaluate(t)]]},"/":[lt,[lt,lt],(t,[e,i])=>e.evaluate(t)/i.evaluate(t)],"%":[lt,[lt,lt],(t,[e,i])=>e.evaluate(t)%i.evaluate(t)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(t,[e,i])=>Math.pow(e.evaluate(t),i.evaluate(t))],sqrt:[lt,[lt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))],log2:[lt,[lt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[lt,[lt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[lt,[lt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[lt,[lt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[lt,[lt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[lt,[lt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[lt,[lt],(t,[e])=>Math.atan(e.evaluate(t))],min:[lt,$n(lt),(t,e)=>Math.min(...e.map(i=>i.evaluate(t)))],max:[lt,$n(lt),(t,e)=>Math.max(...e.map(i=>i.evaluate(t)))],abs:[lt,[lt],(t,[e])=>Math.abs(e.evaluate(t))],round:[lt,[lt],(t,[e])=>{const i=e.evaluate(t);return i<0?-Math.round(-i):Math.round(i)}],floor:[lt,[lt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[lt,[lt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Rt,[Ft,Ot],(t,[e,i])=>t.properties()[e.value]===i.value],"filter-id-==":[Rt,[Ot],(t,[e])=>t.id()===e.value],"filter-type-==":[Rt,[Ft],(t,[e])=>t.geometryType()===e.value],"filter-<":[Rt,[Ft,Ot],(t,[e,i])=>{const l=t.properties()[e.value],h=i.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Rt,[Ot],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[Rt,[Ft,Ot],(t,[e,i])=>{const l=t.properties()[e.value],h=i.value;return typeof l==typeof h&&l>h}],"filter-id->":[Rt,[Ot],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[Rt,[Ft,Ot],(t,[e,i])=>{const l=t.properties()[e.value],h=i.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Rt,[Ot],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[Rt,[Ft,Ot],(t,[e,i])=>{const l=t.properties()[e.value],h=i.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Rt,[Ot],(t,[e])=>{const i=t.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[Rt,[Ot],(t,[e])=>e.value in t.properties()],"filter-has-id":[Rt,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[Rt,[Un(Ft)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Rt,[Un(Ot)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Rt,[Ft,Un(Ot)],(t,[e,i])=>i.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Rt,[Ft,Un(Ot)],(t,[e,i])=>function(l,h,f,m){for(;f<=m;){const x=f+m>>1;if(h[x]===l)return!0;h[x]>l?m=x-1:f=x+1}return!1}(t.properties()[e.value],i.value,0,i.value.length-1)],all:{type:Rt,overloads:[[[Rt,Rt],(t,[e,i])=>e.evaluate(t)&&i.evaluate(t)],[$n(Rt),(t,e)=>{for(const i of e)if(!i.evaluate(t))return!1;return!0}]]},any:{type:Rt,overloads:[[[Rt,Rt],(t,[e,i])=>e.evaluate(t)||i.evaluate(t)],[$n(Rt),(t,e)=>{for(const i of e)if(i.evaluate(t))return!0;return!1}]]},"!":[Rt,[Rt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Rt,[Ft],(t,[e])=>{const i=t.globals&&t.globals.isSupportedScript;return!i||i(e.evaluate(t))}],upcase:[Ft,[Ft],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ft,[Ft],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ft,$n(Ot),(t,e)=>e.map(i=>Ho(i.evaluate(t))).join("")],"resolved-locale":[Ft,[Bn],(t,[e])=>e.evaluate(t).resolvedLocale()]});var na=ku;function Lu(t){return{result:"success",value:t}}function br(t){return{result:"error",value:t}}function no(t){return t["property-type"]==="data-driven"}function cl(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function hl(t){return!!t.expression&&t.expression.interpolated}function $t(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function sa(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function zu(t){return t}function ul(t,e){const i=e.type==="color",l=t.stops&&typeof t.stops[0][0]=="object",h=l||!(l||t.property!==void 0),f=t.type||(hl(e)?"exponential":"interval");if(i&&((t=Es({},t)).stops&&(t.stops=t.stops.map(E=>[E[0],Oi.parse(E[1])])),t.default=Oi.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!Ic[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let m,x,w;if(f==="exponential")m=ks;else if(f==="interval")m=dl;else if(f==="categorical"){m=Ru,x=Object.create(null);for(const E of t.stops)x[E[0]]=E[1];w=typeof t.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=Ou}if(l){const E={},A=[];for(let O=0;O<t.stops.length;O++){const B=t.stops[O],V=B[0].zoom;E[V]===void 0&&(E[V]={zoom:V,type:t.type,property:t.property,default:t.default,stops:[]},A.push(V)),E[V].stops.push([B[0].value,B[1]])}const P=[];for(const O of A)P.push([E[O].zoom,ul(E[O],e)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:ds.interpolationFactor.bind(void 0,D),zoomStops:P.map(O=>O[0]),evaluate:({zoom:O},B)=>ks({stops:P,base:t.base},e,O).evaluate(O,B)}}if(h){const E=f==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ds.interpolationFactor.bind(void 0,E),zoomStops:t.stops.map(A=>A[0]),evaluate:({zoom:A})=>m(t,e,A,x,w)}}return{kind:"source",evaluate(E,A){const P=A&&A.properties?A.properties[t.property]:void 0;return P===void 0?so(t.default,e.default):m(t,e,P,x,w)}}}function so(t,e,i){return t!==void 0?t:e!==void 0?e:i!==void 0?i:void 0}function Ru(t,e,i,l,h){return so(typeof i===h?l[i]:void 0,t.default,e.default)}function dl(t,e,i){if($t(i)!=="number")return so(t.default,e.default);const l=t.stops.length;if(l===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[l-1][0])return t.stops[l-1][1];const h=el(t.stops.map(f=>f[0]),i);return t.stops[h][1]}function ks(t,e,i){const l=t.base!==void 0?t.base:1;if($t(i)!=="number")return so(t.default,e.default);const h=t.stops.length;if(h===1||i<=t.stops[0][0])return t.stops[0][1];if(i>=t.stops[h-1][0])return t.stops[h-1][1];const f=el(t.stops.map(A=>A[0]),i),m=function(A,P,D,O){const B=O-D,V=A-D;return B===0?0:P===1?V/B:(Math.pow(P,V)-1)/(Math.pow(P,B)-1)}(i,l,t.stops[f][0],t.stops[f+1][0]),x=t.stops[f][1],w=t.stops[f+1][1];let E=Jo[e.type]||zu;if(t.colorSpace&&t.colorSpace!=="rgb"){const A=Ic[t.colorSpace];E=(P,D)=>A.reverse(A.interpolate(A.forward(P),A.forward(D),m))}return typeof x.evaluate=="function"?{evaluate(...A){const P=x.evaluate.apply(void 0,A),D=w.evaluate.apply(void 0,A);if(P!==void 0&&D!==void 0)return E(P,D,m)}}:E(x,w,m)}function Ou(t,e,i){return e.type==="color"?i=Oi.parse(i):e.type==="formatted"?i=Tn.fromString(i.toString()):e.type==="resolvedImage"?i=Gn.fromString(i.toString()):$t(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),so(i,t.default,e.default)}class pl{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new _c,this._defaultValue=i?function(l){return l.type==="color"&&(sa(l.default)||Array.isArray(l.default))?new Oi(0,0,0,0):l.type==="color"?Oi.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,l,h,f,m,x,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,h,f,m,x,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new an(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function ro(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in na}function oo(t,e){const i=new bc(na,[],e?function(h){const f={color:On,string:Ft,number:lt,enum:Ft,boolean:Rt,formatted:Uo,resolvedImage:mr};return h.type==="array"?Un(f[h.value]||Ot,h.length):f[h.type]}(e):void 0),l=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Lu(new pl(l,e)):br(i.errors)}class Oc{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Is(i.expression)}evaluateWithoutErrorHandling(e,i,l,h,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,h,f,m)}evaluate(e,i,l,h,f,m){return this._styleExpression.evaluate(e,i,l,h,f,m)}}class ra{constructor(e,i,l,h){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Is(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,l,h,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,h,f,m)}evaluate(e,i,l,h,f,m){return this._styleExpression.evaluate(e,i,l,h,f,m)}interpolationFactor(e,i,l){return this.interpolationType?ds.interpolationFactor(this.interpolationType,e,i,l):0}}function oa(t,e){if((t=oo(t,e)).result==="error")return t;const i=t.value.expression,l=Qr(i);if(!l&&!no(e))return br([new hs("","data expressions not supported")]);const h=xr(i,["zoom","pitch","distance-from-center"]);if(!h&&!cl(e))return br([new hs("","zoom expressions not supported")]);const f=_l(i);return f||h?f instanceof hs?br([f]):f instanceof ds&&!hl(e)?br([new hs("",'"interpolate" expressions cannot be used with this property')]):Lu(f?new ra(l?"camera":"composite",t.value,f.labels,f instanceof ds?f.interpolation:void 0):new Oc(l?"constant":"source",t.value)):br([new hs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fl{constructor(e,i){this._parameters=e,this._specification=i,Es(this,ul(this._parameters,this._specification))}static deserialize(e){return new fl(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function _l(t){let e=null;if(t instanceof Su)e=_l(t.result);else if(t instanceof kc){for(const i of t.args)if(e=_l(i),e)break}else(t instanceof Tc||t instanceof ds)&&t.input instanceof As&&t.input.name==="zoom"&&(e=t);return e instanceof hs||t.eachChild(i=>{const l=_l(i);l instanceof hs?e=l:!e&&l?e=new hs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&l&&e!==l&&(e=new hs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class ct{constructor(e,i,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function ts(t){const e=t.key,i=t.value,l=t.valueSpec||{},h=t.objectElementValidators||{},f=t.style,m=t.styleSpec;let x=[];const w=$t(i);if(w!=="object")return[new ct(e,i,`object expected, ${w} found`)];for(const E in i){const A=E.split(".")[0];let P;h[A]?P=h[A]:l[A]?P=dn:h["*"]?P=h["*"]:l["*"]&&(P=dn),P?x=x.concat(P({key:(e&&`${e}.`)+E,value:i[E],valueSpec:l[A]||l["*"],style:f,styleSpec:m,object:i,objectKey:E},i)):x.push(new ct(e,i[E],`unknown property "${E}"`))}for(const E in l)h[E]||l[E].required&&l[E].default===void 0&&i[E]===void 0&&x.push(new ct(e,i,`missing required property "${E}"`));return x}function Bu(t){const e=t.value,i=t.valueSpec,l=t.style,h=t.styleSpec,f=t.key,m=t.arrayElementValidator||dn;if($t(e)!=="array")return[new ct(f,e,`array expected, ${$t(e)} found`)];if(i.length&&e.length!==i.length)return[new ct(f,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new ct(f,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};h.$version<7&&(x.function=i.function),$t(i.value)==="object"&&(x=i.value);let w=[];for(let E=0;E<e.length;E++)w=w.concat(m({array:e,arrayIndex:E,value:e[E],valueSpec:x,style:l,styleSpec:h,key:`${f}[${E}]`}));return w}function aa(t){const e=t.key,i=t.value,l=t.valueSpec;let h=$t(i);if(h==="number"&&i!=i&&(h="NaN"),h!=="number")return[new ct(e,i,`number expected, ${h} found`)];if("minimum"in l){let f=l.minimum;if($t(l.minimum)==="array"&&(f=l.minimum[t.arrayIndex]),i<f)return[new ct(e,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in l){let f=l.maximum;if($t(l.maximum)==="array"&&(f=l.maximum[t.arrayIndex]),i>f)return[new ct(e,i,`${i} is greater than the maximum value ${f}`)]}return[]}function la(t){const e=t.valueSpec,i=ji(t.value.type);let l,h,f,m={};const x=i!=="categorical"&&t.value.property===void 0,w=!x,E=$t(t.value.stops)==="array"&&$t(t.value.stops[0])==="array"&&$t(t.value.stops[0][0])==="object",A=ts({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(O){if(i==="identity")return[new ct(O.key,O.value,'identity function may not have a "stops" property')];let B=[];const V=O.value;return B=B.concat(Bu({key:O.key,value:V,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:P})),$t(V)==="array"&&V.length===0&&B.push(new ct(O.key,V,"array must have at least one stop")),B},default:function(O){return dn({key:O.key,value:O.value,valueSpec:e,style:O.style,styleSpec:O.styleSpec})}}});return i==="identity"&&x&&A.push(new ct(t.key,t.value,'missing required property "property"')),i==="identity"||t.value.stops||A.push(new ct(t.key,t.value,'missing required property "stops"')),i==="exponential"&&t.valueSpec.expression&&!hl(t.valueSpec)&&A.push(new ct(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(w&&!no(t.valueSpec)?A.push(new ct(t.key,t.value,"property functions not supported")):x&&!cl(t.valueSpec)&&A.push(new ct(t.key,t.value,"zoom functions not supported"))),i!=="categorical"&&!E||t.value.property!==void 0||A.push(new ct(t.key,t.value,'"property" property is required')),A;function P(O){let B=[];const V=O.value,W=O.key;if($t(V)!=="array")return[new ct(W,V,`array expected, ${$t(V)} found`)];if(V.length!==2)return[new ct(W,V,`array length 2 expected, length ${V.length} found`)];if(E){if($t(V[0])!=="object")return[new ct(W,V,`object expected, ${$t(V[0])} found`)];if(V[0].zoom===void 0)return[new ct(W,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new ct(W,V,"object stop key must have value")];const ee=ji(V[0].zoom);if(typeof ee!="number")return[new ct(W,V[0].zoom,"stop zoom values must be numbers")];if(f&&f>ee)return[new ct(W,V[0].zoom,"stop zoom values must appear in ascending order")];ee!==f&&(f=ee,h=void 0,m={}),B=B.concat(ts({key:`${W}[0]`,value:V[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:aa,value:D}}))}else B=B.concat(D({key:`${W}[0]`,value:V[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},V));return ro(en(V[1]))?B.concat([new ct(`${W}[1]`,V[1],"expressions are not allowed in function stops.")]):B.concat(dn({key:`${W}[1]`,value:V[1],valueSpec:e,style:O.style,styleSpec:O.styleSpec}))}function D(O,B){const V=$t(O.value),W=ji(O.value),ee=O.value!==null?O.value:B;if(l){if(V!==l)return[new ct(O.key,ee,`${V} stop domain type must match previous stop domain type ${l}`)]}else l=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof W!="number"&&typeof W!="string"&&typeof W!="boolean")return[new ct(O.key,ee,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&i!=="categorical"){let le=`number expected, ${V} found`;return no(e)&&i===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ct(O.key,ee,le)]}return i!=="categorical"||V!=="number"||typeof W=="number"&&isFinite(W)&&Math.floor(W)===W?i!=="categorical"&&V==="number"&&typeof W=="number"&&typeof h=="number"&&h!==void 0&&W<h?[new ct(O.key,ee,"stop domain values must appear in ascending order")]:(h=W,i==="categorical"&&W in m?[new ct(O.key,ee,"stop domain values must be unique")]:(m[W]=!0,[])):[new ct(O.key,ee,`integer expected, found ${String(W)}`)]}}function tn(t){const e=(t.expressionContext==="property"?oa:oo)(en(t.value),t.valueSpec);if(e.result==="error")return e.value.map(l=>new ct(`${t.key}${l.key}`,t.value,l.message));const i=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!i.outputDefined())return[new ct(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!Is(i))return[new ct(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return ca(i,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!xr(i,["zoom","feature-state"]))return[new ct(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Qr(i))return[new ct(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ca(t,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)i.delete(h);if(i.size===0)return[];const l=[];return t instanceof As&&i.has(t.name)?[new ct(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(h=>{l.push(...ca(h,e))}),l)}function ml(t){const e=t.key,i=t.value,l=t.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(ji(i))===-1&&h.push(new ct(e,i,`expected one of [${l.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(l.values).indexOf(ji(i))===-1&&h.push(new ct(e,i,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function Bc(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Bc(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function gl(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Bc(t)||(t=lo(t));const i=t;let l=!0;try{l=function(E){if(!ao(E))return E;let A=en(E);return yl(A),A=Fu(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const h=Oe[`filter_${e}`],f=oo(l,h);let m=null;if(f.result==="error")throw new Error(f.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,A,P)=>f.value.evaluate(E,A,{},P);let x=null,w=null;if(l!==i){const E=oo(i,h);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,P,D,O,B)=>E.value.evaluate(A,P,{},D,void 0,void 0,O,B),w=!Qr(E.value.expression)}return{filter:m,dynamicFilter:x||void 0,needGeometry:Nu(l),needFeature:!!w}}function Fu(t){if(!Array.isArray(t))return t;const e=function(i){if(Fc.has(i[0])){for(let l=1;l<i.length;l++)if(ao(i[l]))return!0}return i}(t);return e===!0?e:e.map(i=>Fu(i))}function yl(t){let e=!1;const i=[];if(t[0]==="case"){for(let l=1;l<t.length-1;l+=2)e=e||ao(t[l]),i.push(t[l+1]);i.push(t[t.length-1])}else if(t[0]==="match"){e=e||ao(t[1]);for(let l=2;l<t.length-1;l+=2)i.push(t[l+1]);i.push(t[t.length-1])}else if(t[0]==="step"){e=e||ao(t[1]);for(let l=1;l<t.length-1;l+=2)i.push(t[l+1])}e&&(t.length=0,t.push("any",...i));for(let l=1;l<t.length;l++)yl(t[l])}function ao(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<t.length;i++)if(ao(t[i]))return!0;return!1}const Fc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Up(t,e){return t<e?-1:t>e?1:0}function Nu(t){if(!Array.isArray(t))return!1;if(t[0]==="within")return!0;for(let e=1;e<t.length;e++)if(Nu(t[e]))return!0;return!1}function lo(t){if(!t)return!0;const e=t[0];return t.length<=1?e!=="any":e==="=="?Nc(t[1],t[2],"=="):e==="!="?xl(Nc(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Nc(t[1],t[2],e):e==="any"?(i=t.slice(1),["any"].concat(i.map(lo))):e==="all"?["all"].concat(t.slice(1).map(lo)):e==="none"?["all"].concat(t.slice(1).map(lo).map(xl)):e==="in"?jc(t[1],t.slice(2)):e==="!in"?xl(jc(t[1],t.slice(2))):e==="has"?Vc(t[1]):e==="!has"?xl(Vc(t[1])):e!=="within"||t;var i}function Nc(t,e,i){switch(t){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,t,e]}}function jc(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Up)]]:["filter-in-small",t,["literal",e]]}}function Vc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function xl(t){return["!",t]}function ha(t){return Bc(en(t.value))?tn(Es({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):ua(t)}function ua(t){const e=t.value,i=t.key;if($t(e)!=="array")return[new ct(i,e,`array expected, ${$t(e)} found`)];const l=t.styleSpec;let h,f=[];if(e.length<1)return[new ct(i,e,"filter array must have at least 1 element")];switch(f=f.concat(ml({key:`${i}[0]`,value:e[0],valueSpec:l.filter_operator,style:t.style,styleSpec:t.styleSpec})),ji(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&ji(e[1])==="$type"&&f.push(new ct(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&f.push(new ct(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=$t(e[1]),h!=="string"&&f.push(new ct(`${i}[1]`,e[1],`string expected, ${h} found`)));for(let m=2;m<e.length;m++)h=$t(e[m]),ji(e[1])==="$type"?f=f.concat(ml({key:`${i}[${m}]`,value:e[m],valueSpec:l.geometry_type,style:t.style,styleSpec:t.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&f.push(new ct(`${i}[${m}]`,e[m],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)f=f.concat(ua({key:`${i}[${m}]`,value:e[m],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":h=$t(e[1]),e.length!==2?f.push(new ct(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&f.push(new ct(`${i}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=$t(e[1]),e.length!==2?f.push(new ct(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="object"&&f.push(new ct(`${i}[1]`,e[1],`object expected, ${h} found`))}return f}function Uc(t,e){const i=t.key,l=t.style,h=t.styleSpec,f=t.value,m=t.objectKey,x=h[`${e}_${t.layerType}`];if(!x)return[];const w=m.match(/^(.*)-transition$/);if(e==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return dn({key:i,value:f,valueSpec:h.transition,style:l,styleSpec:h});const E=t.valueSpec||x[m];if(!E)return[new ct(i,f,`unknown property "${m}"`)];let A;if($t(f)==="string"&&no(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(f))){const D=`\`{ "type": "identity", "property": ${A?JSON.stringify(A[1]):'"_"'} }\``;return[new ct(i,f,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${D}.`)]}const P=[];return t.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&P.push(new ct(i,f,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&sa(en(f))&&ji(f.type)==="identity"&&P.push(new ct(i,f,'"text-font" does not support identity functions'))),P.concat(dn({key:t.key,value:f,valueSpec:E,style:l,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:m}))}function ju(t){return Uc(t,"paint")}function Gc(t){return Uc(t,"layout")}function Vu(t){let e=[];const i=t.value,l=t.key,h=t.style,f=t.styleSpec;i.type||i.ref||e.push(new ct(l,i,'either "type" or "ref" is required'));let m=ji(i.type);const x=ji(i.ref);if(i.id){const w=ji(i.id);for(let E=0;E<t.arrayIndex;E++){const A=h.layers[E];ji(A.id)===w&&e.push(new ct(l,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&e.push(new ct(l,i[E],`"${E}" is prohibited for ref layers`))}),h.layers.forEach(E=>{ji(E.id)===x&&(w=E)}),w?w.ref?e.push(new ct(l,i.ref,"ref cannot reference another ref layer")):m=ji(w.type):typeof x=="string"&&e.push(new ct(l,i.ref,`ref layer "${x}" not found`))}else if(m!=="background"&&m!=="sky")if(i.source){const w=h.sources&&h.sources[i.source],E=w&&ji(w.type);w?E==="vector"&&m==="raster"?e.push(new ct(l,i.source,`layer "${i.id}" requires a raster source`)):E==="raster"&&m!=="raster"?e.push(new ct(l,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&m!=="hillshade"?e.push(new ct(l,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||E==="geojson"&&w.lineMetrics||e.push(new ct(l,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new ct(l,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new ct(l,i.source,`source "${i.source}" not found`))}else e.push(new ct(l,i,'missing required property "source"'));return e=e.concat(ts({key:l,value:i,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dn({key:`${l}.type`,value:i.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:i,objectKey:"type"}),filter:w=>ha(Es({layerType:m},w)),layout:w=>ts({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Gc(Es({layerType:m},E))}}),paint:w=>ts({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>ju(Es({layerType:m},E))}})}})),e}function Ys(t){const e=t.value,i=t.key,l=$t(e);return l!=="string"?[new ct(i,e,`string expected, ${l} found`)]:[]}const Uu={promoteId:function({key:t,value:e}){if($t(e)==="string")return Ys({key:t,value:e});{const i=[];for(const l in e)i.push(...Ys({key:`${t}.${l}`,value:e[l]}));return i}}};function Gu(t){const e=t.value,i=t.key,l=t.styleSpec,h=t.style;if(!e.type)return[new ct(i,e,'"type" is required')];const f=ji(e.type);let m;switch(f){case"vector":case"raster":case"raster-dem":return m=ts({key:i,value:e,valueSpec:l[`source_${f.replace("-","_")}`],style:t.style,styleSpec:l,objectElementValidators:Uu}),m;case"geojson":if(m=ts({key:i,value:e,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:Uu}),e.cluster)for(const x in e.clusterProperties){const[w,E]=e.clusterProperties[x],A=typeof w=="string"?[w,["accumulated"],["get",x]]:w;m.push(...tn({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),m.push(...tn({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return m;case"video":return ts({key:i,value:e,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return ts({key:i,value:e,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new ct(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ml({key:`${i}.type`,value:e.type,valueSpec:{values:Gp(l)},style:h,styleSpec:l})}}function Gp(t){return t.source.reduce((e,i)=>{const l=t[i];return l.type.type==="enum"&&(e=e.concat(Object.keys(l.type.values))),e},[])}function $u(t){const e=t.value,i=t.styleSpec,l=i.light,h=t.style;let f=[];const m=$t(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new ct("light",e,`object expected, ${m} found`)]),f;for(const x in e){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&l[w[1]]&&l[w[1]].transition?dn({key:x,value:e[x],valueSpec:i.transition,style:h,styleSpec:i}):l[x]?dn({key:x,value:e[x],valueSpec:l[x],style:h,styleSpec:i}):[new ct(x,e[x],`unknown property "${x}"`)])}return f}function $c(t){const e=t.value,i=t.key,l=t.style,h=t.styleSpec,f=h.terrain;let m=[];const x=$t(e);if(e===void 0)return m;if(x!=="object")return m=m.concat([new ct("terrain",e,`object expected, ${x} found`)]),m;for(const w in e){const E=w.match(/^(.*)-transition$/);m=m.concat(E&&f[E[1]]&&f[E[1]].transition?dn({key:w,value:e[w],valueSpec:h.transition,style:l,styleSpec:h}):f[w]?dn({key:w,value:e[w],valueSpec:f[w],style:l,styleSpec:h}):[new ct(w,e[w],`unknown property "${w}"`)])}if(e.source){const w=l.sources&&l.sources[e.source],E=w&&ji(w.type);w?E!=="raster-dem"&&m.push(new ct(i,e.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):m.push(new ct(i,e.source,`source "${e.source}" not found`))}else m.push(new ct(i,e,'terrain is missing required property "source"'));return m}function qu(t){const e=t.value,i=t.style,l=t.styleSpec,h=l.fog;let f=[];const m=$t(e);if(e===void 0)return f;if(m!=="object")return f=f.concat([new ct("fog",e,`object expected, ${m} found`)]),f;for(const x in e){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&h[w[1]]&&h[w[1]].transition?dn({key:x,value:e[x],valueSpec:l.transition,style:i,styleSpec:l}):h[x]?dn({key:x,value:e[x],valueSpec:h[x],style:i,styleSpec:l}):[new ct(x,e[x],`unknown property "${x}"`)])}return f}const Wu={"*":()=>[],array:Bu,boolean:function(t){const e=t.value,i=t.key,l=$t(e);return l!=="boolean"?[new ct(i,e,`boolean expected, ${l} found`)]:[]},number:aa,color:function(t){const e=t.key,i=t.value,l=$t(i);return l!=="string"?[new ct(e,i,`color expected, ${l} found`)]:lc(i)===null?[new ct(e,i,`color expected, "${i}" found`)]:[]},enum:ml,filter:ha,function:la,layer:Vu,object:ts,source:Gu,light:$u,terrain:$c,fog:qu,string:Ys,formatted:function(t){return Ys(t).length===0?[]:tn(t)},resolvedImage:function(t){return Ys(t).length===0?[]:tn(t)},projection:function(t){const e=t.value,i=t.styleSpec,l=i.projection,h=t.style;let f=[];const m=$t(e);if(m==="object")for(const x in e)f=f.concat(dn({key:x,value:e[x],valueSpec:l[x],style:h,styleSpec:i}));else m!=="string"&&(f=f.concat([new ct("projection",e,`object or string expected, ${m} found`)]));return f}};function dn(t){const e=t.value,i=t.valueSpec,l=t.styleSpec;return i.expression&&sa(ji(e))?la(t):i.expression&&ro(en(e))?tn(t):i.type&&Wu[i.type]?Wu[i.type](t):ts(Es({},t,{valueSpec:i.type?l[i.type]:i}))}function $p(t){const e=t.value,i=t.key,l=Ys(t);return l.length||(e.indexOf("{fontstack}")===-1&&l.push(new ct(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&l.push(new ct(i,e,'"glyphs" url must include a "{range}" token'))),l}function Zu(t,e=Oe){return qn(dn({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:$p,"*":()=>[]}}))}const qp=t=>qn(ju(t)),Wp=t=>qn(Gc(t));function qn(t){return t.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function Hu(t,e){let i=!1;if(e&&e.length)for(const l of e)t.fire(new Ts(new Error(l.message))),i=!0;return i}var Zp=ps,is=3;function ps(t,e,i){var l=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var h=new Int32Array(this.arrayBuffer);t=h[0],this.d=(e=h[1])+2*(i=h[2]);for(var f=0;f<this.d*this.d;f++){var m=h[is+f],x=h[is+f+1];l.push(m===x?null:h.subarray(m,x))}var w=h[is+l.length+1];this.keys=h.subarray(h[is+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var A=i/e*t;this.min=-A,this.max=t+A}ps.prototype.insert=function(t,e,i,l,h){this._forEachCell(e,i,l,h,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(h)},ps.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ps.prototype._insertCell=function(t,e,i,l,h,f){this.cells[h].push(f)},ps.prototype.query=function(t,e,i,l,h){var f=this.min,m=this.max;if(t<=f&&e<=f&&m<=i&&m<=l&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(t,e,i,l,this._queryCell,x,{},h),x},ps.prototype._queryCell=function(t,e,i,l,h,f,m,x){var w=this.cells[h];if(w!==null)for(var E=this.keys,A=this.bboxes,P=0;P<w.length;P++){var D=w[P];if(m[D]===void 0){var O=4*D;(x?x(A[O+0],A[O+1],A[O+2],A[O+3]):t<=A[O+2]&&e<=A[O+3]&&i>=A[O+0]&&l>=A[O+1])?(m[D]=!0,f.push(E[D])):m[D]=!1}}},ps.prototype._forEachCell=function(t,e,i,l,h,f,m,x){for(var w=this._convertToCellCoord(t),E=this._convertToCellCoord(e),A=this._convertToCellCoord(i),P=this._convertToCellCoord(l),D=w;D<=A;D++)for(var O=E;O<=P;O++){var B=this.d*O+D;if((!x||x(this._convertFromCellCoord(D),this._convertFromCellCoord(O),this._convertFromCellCoord(D+1),this._convertFromCellCoord(O+1)))&&h.call(this,t,e,i,l,B,f,m,x))return}},ps.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ps.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ps.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=is+this.cells.length+1+1,i=0,l=0;l<this.cells.length;l++)i+=this.cells[l].length;var h=new Int32Array(e+i+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=e,m=0;m<t.length;m++){var x=t[m];h[is+m]=f,h.set(x,f),f+=x.length}return h[is+t.length]=f,h.set(this.keys,f),h[is+t.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};var wr=Fe(Zp);const vl={};function ht(t,e,i={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),vl[e]={klass:t,omit:i.omit||[]}}ht(Object,"Object"),wr.serialize=function(t,e){const i=t.toArrayBuffer();return e&&e.push(i),{buffer:i}},wr.deserialize=function(t){return new wr(t.buffer)},Object.defineProperty(wr,"name",{value:"Grid"}),ht(wr,"Grid"),ht(Oi,"Color"),ht(Error,"Error"),ht(Hs,"AJAXError"),ht(Gn,"ResolvedImage"),ht(fl,"StylePropertyFunction"),ht(pl,"StyleExpression",{omit:["_evaluator"]}),ht(ra,"ZoomDependentExpression"),ht(Oc,"ZoomConstantExpression"),ht(As,"CompoundExpression",{omit:["_evaluate"]});for(const t in na)vl[na[t]._classRegistryKey]||ht(na[t],`Expression${t}`);function qc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Wc(t){return T.ImageBitmap&&t instanceof T.ImageBitmap}function co(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(qc(t)||Wc(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const i=t;return e&&e.push(i.buffer),i}if(t instanceof T.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const i=[];for(const l of t)i.push(co(l,e));return i}if(typeof t=="object"){const i=t.constructor,l=i._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=i.serialize?i.serialize(t,e):{};if(!i.serialize){for(const f in t)t.hasOwnProperty(f)&&(vl[l].omit.indexOf(f)>=0||(h[f]=co(t[f],e)));t instanceof Error&&(h.message=t.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof t)}function Tr(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||qc(t)||Wc(t)||ArrayBuffer.isView(t)||t instanceof T.ImageData)return t;if(Array.isArray(t))return t.map(Tr);if(typeof t=="object"){const e=t.$name||"Object",{klass:i}=vl[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(t);const l=Object.create(i.prototype);for(const h of Object.keys(t))h!=="$name"&&(l[h]=Tr(t[h]));return l}throw new Error("can't deserialize object of type "+typeof t)}const at={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Zc(t){for(const e of t)if(Hc(e.charCodeAt(0)))return!0;return!1}function Hp(t){for(const e of t)if(!Xu(e.charCodeAt(0)))return!1;return!0}function Xu(t){return!(at.Arabic(t)||at["Arabic Supplement"](t)||at["Arabic Extended-A"](t)||at["Arabic Presentation Forms-A"](t)||at["Arabic Presentation Forms-B"](t))}function Hc(t){return!(t!==746&&t!==747&&(t<4352||!(at["Bopomofo Extended"](t)||at.Bopomofo(t)||at["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||at["CJK Compatibility Ideographs"](t)||at["CJK Compatibility"](t)||at["CJK Radicals Supplement"](t)||at["CJK Strokes"](t)||!(!at["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||at["CJK Unified Ideographs Extension A"](t)||at["CJK Unified Ideographs"](t)||at["Enclosed CJK Letters and Months"](t)||at["Hangul Compatibility Jamo"](t)||at["Hangul Jamo Extended-A"](t)||at["Hangul Jamo Extended-B"](t)||at["Hangul Jamo"](t)||at["Hangul Syllables"](t)||at.Hiragana(t)||at["Ideographic Description Characters"](t)||at.Kanbun(t)||at["Kangxi Radicals"](t)||at["Katakana Phonetic Extensions"](t)||at.Katakana(t)&&t!==12540||!(!at["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!at["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||at["Unified Canadian Aboriginal Syllabics"](t)||at["Unified Canadian Aboriginal Syllabics Extended"](t)||at["Vertical Forms"](t)||at["Yijing Hexagram Symbols"](t)||at["Yi Syllables"](t)||at["Yi Radicals"](t))))}function Yu(t){return!(Hc(t)||function(e){return!!(at["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||at["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||at["Letterlike Symbols"](e)||at["Number Forms"](e)||at["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||at["Control Pictures"](e)&&e!==9251||at["Optical Character Recognition"](e)||at["Enclosed Alphanumerics"](e)||at["Geometric Shapes"](e)||at["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||at["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||at["CJK Symbols and Punctuation"](e)||at.Katakana(e)||at["Private Use Area"](e)||at["CJK Compatibility Forms"](e)||at["Small Form Variants"](e)||at["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function Ku(t){return t>=1424&&t<=2303||at["Arabic Presentation Forms-A"](t)||at["Arabic Presentation Forms-B"](t)}function Xp(t,e){return!(!e&&Ku(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||at.Khmer(t))}function Yp(t){for(const e of t)if(Ku(e.charCodeAt(0)))return!0;return!1}const Xc="deferred",Yc="loading",Kc="loaded";let ho=null,p="unavailable",n=null;const c=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(p="error"),ho&&ho(t)};function _(){y.fire(new _r("pluginStateChange",{pluginStatus:p,pluginURL:n}))}const y=new Vo,b=function(){return p},S=function(){if(p!==Xc||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");p=Yc,_(),n&&qr({url:n},t=>{t?c(t):(p=Kc,_())})},M={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>p===Kc||M.applyArabicShaping!=null,isLoading:()=>p===Yc,setState(t){p=t.pluginStatus,n=t.pluginURL},isParsed:()=>M.applyArabicShaping!=null&&M.processBidirectionalText!=null&&M.processStyledBidirectionalText!=null,getPluginURL:()=>n};class C{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(i,l){for(const h of i)if(!Xp(h.charCodeAt(0),l))return!1;return!0}(e,M.isLoaded())}}class z{constructor(e,i){this.property=e,this.value=i,this.expression=function(l,h){if(sa(l))return new fl(l,h);if(ro(l)){const f=oa(l,h);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=l;return typeof l=="string"&&h.type==="color"&&(f=Oi.parse(l)),{kind:"constant",evaluate:()=>f}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l){return this.property.possiblyEvaluate(this,e,i,l)}}class L{constructor(e){this.property=e,this.value=new z(e,void 0)}transitioned(e,i){return new q(this.property,this.value,i,_i({},e.transition,this.transition),e.now)}untransitioned(){return new q(this.property,this.value,null,{},0)}}class N{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return zn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new L(this._values[e].property)),this._values[e].value=new z(this._values[e].property,i===null?void 0:zn(i))}getTransition(e){return zn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new L(this._values[e].property)),this._values[e].transition=zn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const l=new H(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,i._values[h]);return l}untransitioned(){const e=new H(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class q{constructor(e,i,l,h,f){const m=h.delay||0,x=h.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+m,this.end=this.begin+x,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const h=e.now||0,f=this.value.possiblyEvaluate(e,i,l),m=this.prior;if(m){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return m.possiblyEvaluate(e,i,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,l),f,Kt(x))}}return f}}class H{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const h=new Q(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class J{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return zn(this._values[e].value)}setValue(e,i){this._values[e]=new z(this._values[e].property,i===null?void 0:zn(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l){const h=new Q(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,l);return h}}class K{constructor(e,i,l){this.property=e,this.value=i,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,h){return this.property.evaluate(this.value,this.parameters,e,i,l,h)}}class Q{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class j{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const h=Jo[this.specification.type];return h?h(e,i,l):e}}class Z{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,h){return new K(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},l,h)}:e.expression,i)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new K(this,{kind:"constant",value:void 0},e.parameters);const h=Jo[this.specification.type];return h?new K(this,{kind:"constant",value:h(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,h,f,m){return e.kind==="constant"?e.value:e.evaluate(i,l,h,f,m)}}class ne{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,h){return!!e.expression.evaluate(i,null,{},l,h)}interpolate(){return!1}}class se{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new C(0,{});for(const l in e){const h=e[l];h.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new z(h,void 0),m=this.defaultTransitionablePropertyValues[l]=new L(h);this.defaultTransitioningPropertyValues[l]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(i)}}}function fe(t,e){return 256*(t=bt(Math.floor(t),0,255))+bt(Math.floor(e),0,255)}ht(Z,"DataDrivenProperty"),ht(j,"DataConstantProperty"),ht(ne,"ColorRampProperty");const me={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _e{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ve{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xe(t,e=1){let i=0,l=0;return{members:t.map(h=>{const f=me[h.type].BYTES_PER_ELEMENT,m=i=Ae(i,Math.max(e,f)),x=h.components||1;return l=Math.max(l,f),i+=f*x,{name:h.name,type:h.type,components:x,offset:m}}),size:Ae(i,Math.max(l,e)),alignment:e}}function Ae(t,e){return Math.ceil(t/e)*e}class Ze extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=l,e}}Ze.prototype.bytesPerElement=4,ht(Ze,"StructArrayLayout2i4");class Ee extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=h,e}}Ee.prototype.bytesPerElement=6,ht(Ee,"StructArrayLayout3i6");class je extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=l,this.int16[m+2]=h,this.int16[m+3]=f,e}}je.prototype.bytesPerElement=8,ht(je,"StructArrayLayout4i8");class Ie extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,f,m,x)}emplace(e,i,l,h,f,m,x,w){const E=6*e,A=12*e,P=3*e;return this.int16[E+0]=i,this.int16[E+1]=l,this.uint8[A+4]=h,this.uint8[A+5]=f,this.uint8[A+6]=m,this.uint8[A+7]=x,this.float32[P+2]=w,e}}Ie.prototype.bytesPerElement=12,ht(Ie,"StructArrayLayout2i4ub1f12");class qe extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=l,this.float32[m+2]=h,this.float32[m+3]=f,e}}qe.prototype.bytesPerElement=16,ht(qe,"StructArrayLayout4f16");class Me extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,h,f)}emplace(e,i,l,h,f,m){const x=6*e,w=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=l,this.uint16[x+2]=h,this.uint16[x+3]=f,this.float32[w+2]=m,e}}Me.prototype.bytesPerElement=12,ht(Me,"StructArrayLayout4ui1f12");class Ne extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=l,this.uint16[m+2]=h,this.uint16[m+3]=f,e}}Ne.prototype.bytesPerElement=8,ht(Ne,"StructArrayLayout4ui8");class Xe extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,h,f,m)}emplace(e,i,l,h,f,m,x){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+3]=f,this.int16[w+4]=m,this.int16[w+5]=x,e}}Xe.prototype.bytesPerElement=12,ht(Xe,"StructArrayLayout6i12");class Ge extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,m,x,w,E,A,P,D){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,l,h,f,m,x,w,E,A,P,D)}emplace(e,i,l,h,f,m,x,w,E,A,P,D,O){const B=12*e;return this.int16[B+0]=i,this.int16[B+1]=l,this.int16[B+2]=h,this.int16[B+3]=f,this.uint16[B+4]=m,this.uint16[B+5]=x,this.uint16[B+6]=w,this.uint16[B+7]=E,this.int16[B+8]=A,this.int16[B+9]=P,this.int16[B+10]=D,this.int16[B+11]=O,e}}Ge.prototype.bytesPerElement=24,ht(Ge,"StructArrayLayout4i4ui4i24");class Ye extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,h,f,m)}emplace(e,i,l,h,f,m,x){const w=10*e,E=5*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.float32[E+2]=f,this.float32[E+3]=m,this.float32[E+4]=x,e}}Ye.prototype.bytesPerElement=20,ht(Ye,"StructArrayLayout3i3f20");class mt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}mt.prototype.bytesPerElement=4,ht(mt,"StructArrayLayout1ul4");class wt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,m,x,w,E,A,P,D,O){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,l,h,f,m,x,w,E,A,P,D,O)}emplace(e,i,l,h,f,m,x,w,E,A,P,D,O,B){const V=20*e,W=10*e;return this.int16[V+0]=i,this.int16[V+1]=l,this.int16[V+2]=h,this.int16[V+3]=f,this.int16[V+4]=m,this.float32[W+3]=x,this.float32[W+4]=w,this.float32[W+5]=E,this.float32[W+6]=A,this.int16[V+14]=P,this.uint32[W+8]=D,this.uint16[V+18]=O,this.uint16[V+19]=B,e}}wt.prototype.bytesPerElement=40,ht(wt,"StructArrayLayout5i4f1i1ul2ui40");class dt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,f,m,x)}emplace(e,i,l,h,f,m,x,w){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=l,this.int16[E+2]=h,this.int16[E+4]=f,this.int16[E+5]=m,this.int16[E+6]=x,this.int16[E+7]=w,e}}dt.prototype.bytesPerElement=16,ht(dt,"StructArrayLayout3i2i2i16");class xt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,h,f)}emplace(e,i,l,h,f,m){const x=4*e,w=8*e;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[w+6]=f,this.int16[w+7]=m,e}}xt.prototype.bytesPerElement=16,ht(xt,"StructArrayLayout2f1f2i16");class Bt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const m=12*e,x=3*e;return this.uint8[m+0]=i,this.uint8[m+1]=l,this.float32[x+1]=h,this.float32[x+2]=f,e}}Bt.prototype.bytesPerElement=12,ht(Bt,"StructArrayLayout2ub2f12");class Dt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=l,this.float32[f+2]=h,e}}Dt.prototype.bytesPerElement=12,ht(Dt,"StructArrayLayout3f12");class _t extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=l,this.uint16[f+2]=h,e}}_t.prototype.bytesPerElement=6,ht(_t,"StructArrayLayout3ui6");class Jt extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,m,x,w,E,A,P,D,O,B,V,W,ee,le,te,oe,de){const ue=this.length;return this.resize(ue+1),this.emplace(ue,e,i,l,h,f,m,x,w,E,A,P,D,O,B,V,W,ee,le,te,oe,de)}emplace(e,i,l,h,f,m,x,w,E,A,P,D,O,B,V,W,ee,le,te,oe,de,ue){const Ce=30*e,Se=15*e,Be=60*e;return this.int16[Ce+0]=i,this.int16[Ce+1]=l,this.int16[Ce+2]=h,this.float32[Se+2]=f,this.float32[Se+3]=m,this.uint16[Ce+8]=x,this.uint16[Ce+9]=w,this.uint32[Se+5]=E,this.uint32[Se+6]=A,this.uint32[Se+7]=P,this.uint16[Ce+16]=D,this.uint16[Ce+17]=O,this.uint16[Ce+18]=B,this.float32[Se+10]=V,this.float32[Se+11]=W,this.uint8[Be+48]=ee,this.uint8[Be+49]=le,this.uint8[Be+50]=te,this.uint32[Se+13]=oe,this.int16[Ce+28]=de,this.uint8[Be+58]=ue,e}}Jt.prototype.bytesPerElement=60,ht(Jt,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ii extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,m,x,w,E,A,P,D,O,B,V,W,ee,le,te,oe,de,ue,Ce,Se,Be,He,Pe,Ve,Ue,$e){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,e,i,l,h,f,m,x,w,E,A,P,D,O,B,V,W,ee,le,te,oe,de,ue,Ce,Se,Be,He,Pe,Ve,Ue,$e)}emplace(e,i,l,h,f,m,x,w,E,A,P,D,O,B,V,W,ee,le,te,oe,de,ue,Ce,Se,Be,He,Pe,Ve,Ue,$e,Qe){const ze=38*e,rt=19*e;return this.int16[ze+0]=i,this.int16[ze+1]=l,this.int16[ze+2]=h,this.float32[rt+2]=f,this.float32[rt+3]=m,this.int16[ze+8]=x,this.int16[ze+9]=w,this.int16[ze+10]=E,this.int16[ze+11]=A,this.int16[ze+12]=P,this.int16[ze+13]=D,this.uint16[ze+14]=O,this.uint16[ze+15]=B,this.uint16[ze+16]=V,this.uint16[ze+17]=W,this.uint16[ze+18]=ee,this.uint16[ze+19]=le,this.uint16[ze+20]=te,this.uint16[ze+21]=oe,this.uint16[ze+22]=de,this.uint16[ze+23]=ue,this.uint16[ze+24]=Ce,this.uint16[ze+25]=Se,this.uint16[ze+26]=Be,this.uint16[ze+27]=He,this.uint16[ze+28]=Pe,this.uint32[rt+15]=Ve,this.float32[rt+16]=Ue,this.float32[rt+17]=$e,this.float32[rt+18]=Qe,e}}ii.prototype.bytesPerElement=76,ht(ii,"StructArrayLayout3i2f6i15ui1ul3f76");class ni extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ni.prototype.bytesPerElement=4,ht(ni,"StructArrayLayout1f4");class si extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,l,h,f)}emplace(e,i,l,h,f,m){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=h,this.float32[x+3]=f,this.float32[x+4]=m,e}}si.prototype.bytesPerElement=20,ht(si,"StructArrayLayout5f20");class pn extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=l,this.uint16[m+3]=h,this.uint16[m+4]=f,e}}pn.prototype.bytesPerElement=12,ht(pn,"StructArrayLayout1ul3ui12");class nn extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=l,e}}nn.prototype.bytesPerElement=4,ht(nn,"StructArrayLayout2ui4");class Wn extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Wn.prototype.bytesPerElement=2,ht(Wn,"StructArrayLayout1ui2");class fs extends ve{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=l,e}}fs.prototype.bytesPerElement=8,ht(fs,"StructArrayLayout2f8");class bi extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}bi.prototype.size=40;class ri extends wt{get(e){return new bi(this,e)}}ht(ri,"CollisionBoxArray");class Wt extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Wt.prototype.size=60;class Vi extends Jt{get(e){return new Wt(this,e)}}ht(Vi,"PlacedSymbolArray");class xn extends _e{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}xn.prototype.size=76;class mi extends ii{get(e){return new xn(this,e)}}ht(mi,"SymbolInstanceArray");class En extends ni{getoffsetX(e){return this.float32[1*e+0]}}ht(En,"GlyphOffsetArray");class bl extends Ze{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ht(bl,"SymbolLineVertexArray");class Er extends _e{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Er.prototype.size=12;class da extends pn{get(e){return new Er(this,e)}}ht(da,"FeatureIndexArray");class Ds extends nn{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ht(Ds,"FillExtrusionCentroidArray");const Ks=xe([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Sr=xe([{name:"a_dash",components:4,type:"Uint16"}]);var wl={exports:{}},pa={exports:{}};pa.exports=function(t,e){var i,l,h,f,m,x,w,E;for(l=t.length-(i=3&t.length),h=e,m=3432918353,x=461845907,E=0;E<l;)w=255&t.charCodeAt(E)|(255&t.charCodeAt(++E))<<8|(255&t.charCodeAt(++E))<<16|(255&t.charCodeAt(++E))<<24,++E,h=27492+(65535&(f=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&t.charCodeAt(E+2))<<16;case 2:w^=(255&t.charCodeAt(E+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&t.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return h^=t.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var Jc=pa.exports,pm={exports:{}};pm.exports=function(t,e){for(var i,l=t.length,h=e^l,f=0;l>=4;)i=1540483477*(65535&(i=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),l-=4,++f;switch(l){case 3:h^=(255&t.charCodeAt(f+2))<<16;case 2:h^=(255&t.charCodeAt(f+1))<<8;case 1:h=1540483477*(65535&(h^=255&t.charCodeAt(f)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var fm=Jc,av=pm.exports;wl.exports=fm,wl.exports.murmur3=fm,wl.exports.murmur2=av;var Kp=Fe(wl.exports);class Ju{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,l,h){this.ids.push(_m(e)),this.positions.push(i,l,h)}getPositions(e){const i=_m(e);let l=0,h=this.ids.length-1;for(;l<h;){const m=l+h>>1;this.ids[m]>=i?h=m:l=m+1}const f=[];for(;this.ids[l]===i;)f.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return f}static serialize(e,i){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Jp(l,h,0,l.length-1),i&&i.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(e){const i=new Ju;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function _m(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Kp(String(t))}function Jp(t,e,i,l){for(;i<l;){const h=t[i+l>>1];let f=i-1,m=l+1;for(;;){do f++;while(t[f]<h);do m--;while(t[m]>h);if(f>=m)break;Qu(t,f,m),Qu(e,3*f,3*m),Qu(e,3*f+1,3*m+1),Qu(e,3*f+2,3*m+2)}m-i<l-m?(Jp(t,e,i,m),i=m+1):(Jp(t,e,m+1,l),l=m)}}function Qu(t,e,i){const l=t[e];t[e]=t[i],t[i]=l}ht(Ju,"FeaturePositionMap");class Mr{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class ed extends Mr{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class mm extends Mr{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class gm extends Mr{constructor(e){super(e),this.current=Oi.transparent}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const lv=new Float32Array(16),cv=new Float32Array(9),hv=new Float32Array(4);function Qp(t){return[fe(255*t.r,255*t.g),fe(255*t.b,255*t.a)]}class Qc{constructor(e,i,l){this.value=e,this.uniformNames=i.map(h=>`u_${h}`),this.type=l}setUniform(e,i,l,h,f){i.set(e,f,h.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new gm(e):new ed(e)}}class Tl{constructor(e,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,l,h,f){const m=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;m&&i.set(e,f,m)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new mm(e):new ed(e)}}class Ar{constructor(e,i,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,l,h,f,m){const x=this.paintVertexArray.length,w=this.expression.evaluate(new C(0),i,{},f,h,m);this.paintVertexArray.resize(e),this._setPaintValue(x,e,w)}updatePaintArray(e,i,l,h,f){const m=this.expression.evaluate({zoom:0},l,h,void 0,f);this._setPaintValue(e,i,m)}_setPaintValue(e,i,l){if(this.type==="color"){const h=Qp(l);for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ls{constructor(e,i,l,h,f,m){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,i,l,h,f,m){const x=this.expression.evaluate(new C(this.zoom),i,{},f,h,m),w=this.expression.evaluate(new C(this.zoom+1),i,{},f,h,m),E=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(E,e,x,w)}updatePaintArray(e,i,l,h,f){const m=this.expression.evaluate({zoom:this.zoom},l,h,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,f);this._setPaintValue(e,i,m,x)}_setPaintValue(e,i,l,h){if(this.type==="color"){const f=Qp(l),m=Qp(h);for(let x=e;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],m[0],m[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,h,f){const m=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=bt(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);i.set(e,f,x)}getBinding(e,i){return new ed(e)}}class uo{constructor(e,i,l,h,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(l==="array"?Sr:Ks).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new h}populatePaintArray(e,i,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,h,f,m){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(e,i,l,h){if(!h||!l)return;const f=h[l];if(!f)return;const{tl:m,br:x,pixelRatio:w}=f;for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,m[0],m[1],x[0],x[1],w)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class po{constructor(e,i,l=()=>!0){this.binders={},this._buffers=[];const h=[];for(const f in e.paint._values){if(!l(f))continue;const m=e.paint.get(f);if(!(m instanceof K&&no(m.property.specification)))continue;const x=dv(f,e.type),w=m.value,E=m.property.specification.type,A=!!m.property.useIntegerZoom,P=f==="line-dasharray"||f.endsWith("pattern"),D=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||D)if(w.kind==="source"||D||P){const O=ym(f,E,"source");this.binders[f]=P?new uo(w,x,E,O,e.id):new Ar(w,x,E,O),h.push(`/a_${f}`)}else{const O=ym(f,E,"composite");this.binders[f]=new Ls(w,x,E,A,i,O),h.push(`/z_${f}`)}else this.binders[f]=P?new Tl(w.value,x):new Qc(w.value,x,E),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof Ar||i instanceof Ls?i.maxValue:0}populatePaintArrays(e,i,l,h,f,m){for(const x in this.binders){const w=this.binders[x];(w instanceof Ar||w instanceof Ls||w instanceof uo)&&w.populatePaintArray(e,i,l,h,f,m)}}setConstantPatternPositions(e){for(const i in this.binders){const l=this.binders[i];l instanceof Tl&&l.setConstantPatternPositions(e)}}updatePaintArrays(e,i,l,h,f,m){let x=!1;for(const w in e){const E=i.getPositions(w);for(const A of E){const P=l.feature(A.index);for(const D in this.binders){const O=this.binders[D];if((O instanceof Ar||O instanceof Ls||O instanceof uo)&&O.expression.isStateDependent===!0){const B=h.paint.get(D);O.expression=B.value,O.updatePaintArray(A.start,A.end,P,e[w],f,m),x=!0}}}}return x}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof Qc||l instanceof Tl)&&e.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof Ar||l instanceof Ls||l instanceof uo)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof Qc||l instanceof Tl||l instanceof Ls)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Qc||h instanceof Tl||h instanceof Ls)for(const f of h.uniformNames)i.push({name:f,property:l,binding:h.getBinding(e,f)})}return i}setUniforms(e,i,l,h,f){for(const{name:m,property:x,binding:w}of l)this.binders[x].setUniform(e,w,f,h.get(x),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof Ar||i instanceof Ls||i instanceof uo)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof Ar||l instanceof Ls||l instanceof uo)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof Ar||i instanceof Ls||i instanceof uo)&&i.destroy()}}}class fa{constructor(e,i,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new po(h,i,l);this.needsUpload=!1,this._featureMap=new Ju,this._bufferOffset=0}populatePaintArrays(e,i,l,h,f,m,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,h,f,m,x);i.id!==void 0&&this._featureMap.add(i.id,l,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,h,f){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,i,m,h,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const uv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function dv(t,e){return uv[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const pv={"line-pattern":{source:Me,composite:Me},"fill-pattern":{source:Me,composite:Me},"fill-extrusion-pattern":{source:Me,composite:Me},"line-dasharray":{source:Ne,composite:Ne}},fv={color:{source:fs,composite:qe},number:{source:ni,composite:fs}};function ym(t,e,i){const l=pv[t];return l&&l[i]||fv[e][i]}ht(Qc,"ConstantBinder"),ht(Tl,"PatternConstantBinder"),ht(Ar,"SourceExpressionBinder"),ht(uo,"PatternCompositeBinder"),ht(Ls,"CompositeExpressionBinder"),ht(po,"ProgramConfiguration",{omit:["_buffers"]}),ht(fa,"ProgramConfigurationSet");const xm="-transition";class zs extends Vo{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new J(i.layout)),i.paint)){this._transitionablePaint=new N(i.paint);for(const l in e.paint)this.setPaintProperty(l,e.paint[l],{validate:!1});for(const l in e.layout)this.setLayoutProperty(l,e.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Q(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,l={}){i!=null&&this._validate(Wp,`layers.${this.id}.layout.${e}`,e,i,l)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return jr(e,xm)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,l={}){if(i!=null&&this._validate(qp,`layers.${this.id}.paint.${e}`,e,i,l))return!1;if(jr(e,xm))return this._transitionablePaint.setTransition(e.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[e],f=h.value.isDataDriven(),m=h.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const x=this._transitionablePaint._values[e].value,w=x.isDataDriven(),E=jr(e,"pattern")||e==="line-dasharray";return w||f||E||this._handleOverridablePaintPropertyUpdate(e,m,x)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Vr(e,(i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length))}_validate(e,i,l,h,f={}){return(!f||f.validate!==!1)&&Hu(this,e.call(Zu,{key:i,layerType:this.type,objectKey:l,value:h,styleSpec:Oe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof K&&no(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=gl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const _v=xe([{name:"a_pos",components:2,type:"Int16"}],4),mv=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ui{constructor(e=[]){this.segments=e}prepareSegment(e,i,l,h){let f=this.segments[this.segments.length-1];return e>Ui.MAX_VERTEX_ARRAY_LENGTH&&Ti(`Max vertices per segment is ${Ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>Ui.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},h!==void 0&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,h){return new Ui([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}Ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ht(Ui,"SegmentVector");var yt=8192;class fo{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof oi?new oi(e.lng,e.lat):oi.convert(e),this}setSouthWest(e){return this._sw=e instanceof oi?new oi(e.lng,e.lat):oi.convert(e),this}extend(e){const i=this._sw,l=this._ne;let h,f;if(e instanceof oi)h=e,f=e;else{if(!(e instanceof fo))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(fo.convert(e)):this.extend(oi.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(oi.convert(e)):this;if(h=e._sw,f=e._ne,!h||!f)return this}return i||l?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new oi(h.lng,h.lat),this._ne=new oi(f.lng,f.lat)),this}getCenter(){return new oi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new oi(this.getWest(),this.getNorth())}getSouthEast(){return new oi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=oi.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){return!e||e instanceof fo?e:new fo(e)}}var td=1e-6,Zn=typeof Float32Array<"u"?Float32Array:Array;function vm(){var t=new Zn(9);return Zn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function bm(t,e,i){var l=e[0],h=e[1],f=e[2],m=e[3],x=e[4],w=e[5],E=e[6],A=e[7],P=e[8],D=i[0],O=i[1],B=i[2],V=i[3],W=i[4],ee=i[5],le=i[6],te=i[7],oe=i[8];return t[0]=D*l+O*m+B*E,t[1]=D*h+O*x+B*A,t[2]=D*f+O*w+B*P,t[3]=V*l+W*m+ee*E,t[4]=V*h+W*x+ee*A,t[5]=V*f+W*w+ee*P,t[6]=le*l+te*m+oe*E,t[7]=le*h+te*x+oe*A,t[8]=le*f+te*w+oe*P,t}function Rs(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ef(t,e){var i=e[0],l=e[1],h=e[2],f=e[3],m=e[4],x=e[5],w=e[6],E=e[7],A=e[8],P=e[9],D=e[10],O=e[11],B=e[12],V=e[13],W=e[14],ee=e[15],le=i*x-l*m,te=i*w-h*m,oe=i*E-f*m,de=l*w-h*x,ue=l*E-f*x,Ce=h*E-f*w,Se=A*V-P*B,Be=A*W-D*B,He=A*ee-O*B,Pe=P*W-D*V,Ve=P*ee-O*V,Ue=D*ee-O*W,$e=le*Ue-te*Ve+oe*Pe+de*He-ue*Be+Ce*Se;return $e?(t[0]=(x*Ue-w*Ve+E*Pe)*($e=1/$e),t[1]=(h*Ve-l*Ue-f*Pe)*$e,t[2]=(V*Ce-W*ue+ee*de)*$e,t[3]=(D*ue-P*Ce-O*de)*$e,t[4]=(w*He-m*Ue-E*Be)*$e,t[5]=(i*Ue-h*He+f*Be)*$e,t[6]=(W*oe-B*Ce-ee*te)*$e,t[7]=(A*Ce-D*oe+O*te)*$e,t[8]=(m*Ve-x*He+E*Se)*$e,t[9]=(l*He-i*Ve-f*Se)*$e,t[10]=(B*ue-V*oe+ee*le)*$e,t[11]=(P*oe-A*ue-O*le)*$e,t[12]=(x*Be-m*Pe-w*Se)*$e,t[13]=(i*Pe-l*Be+h*Se)*$e,t[14]=(V*te-B*de-W*le)*$e,t[15]=(A*de-P*te+D*le)*$e,t):null}function _a(t,e,i){var l=e[0],h=e[1],f=e[2],m=e[3],x=e[4],w=e[5],E=e[6],A=e[7],P=e[8],D=e[9],O=e[10],B=e[11],V=e[12],W=e[13],ee=e[14],le=e[15],te=i[0],oe=i[1],de=i[2],ue=i[3];return t[0]=te*l+oe*x+de*P+ue*V,t[1]=te*h+oe*w+de*D+ue*W,t[2]=te*f+oe*E+de*O+ue*ee,t[3]=te*m+oe*A+de*B+ue*le,t[4]=(te=i[4])*l+(oe=i[5])*x+(de=i[6])*P+(ue=i[7])*V,t[5]=te*h+oe*w+de*D+ue*W,t[6]=te*f+oe*E+de*O+ue*ee,t[7]=te*m+oe*A+de*B+ue*le,t[8]=(te=i[8])*l+(oe=i[9])*x+(de=i[10])*P+(ue=i[11])*V,t[9]=te*h+oe*w+de*D+ue*W,t[10]=te*f+oe*E+de*O+ue*ee,t[11]=te*m+oe*A+de*B+ue*le,t[12]=(te=i[12])*l+(oe=i[13])*x+(de=i[14])*P+(ue=i[15])*V,t[13]=te*h+oe*w+de*D+ue*W,t[14]=te*f+oe*E+de*O+ue*ee,t[15]=te*m+oe*A+de*B+ue*le,t}function eh(t,e,i){var l,h,f,m,x,w,E,A,P,D,O,B,V=i[0],W=i[1],ee=i[2];return e===t?(t[12]=e[0]*V+e[4]*W+e[8]*ee+e[12],t[13]=e[1]*V+e[5]*W+e[9]*ee+e[13],t[14]=e[2]*V+e[6]*W+e[10]*ee+e[14],t[15]=e[3]*V+e[7]*W+e[11]*ee+e[15]):(h=e[1],f=e[2],m=e[3],x=e[4],w=e[5],E=e[6],A=e[7],P=e[8],D=e[9],O=e[10],B=e[11],t[0]=l=e[0],t[1]=h,t[2]=f,t[3]=m,t[4]=x,t[5]=w,t[6]=E,t[7]=A,t[8]=P,t[9]=D,t[10]=O,t[11]=B,t[12]=l*V+x*W+P*ee+e[12],t[13]=h*V+w*W+D*ee+e[13],t[14]=f*V+E*W+O*ee+e[14],t[15]=m*V+A*W+B*ee+e[15]),t}function ma(t,e,i){var l=i[0],h=i[1],f=i[2];return t[0]=e[0]*l,t[1]=e[1]*l,t[2]=e[2]*l,t[3]=e[3]*l,t[4]=e[4]*h,t[5]=e[5]*h,t[6]=e[6]*h,t[7]=e[7]*h,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function tf(t,e,i){var l=Math.sin(i),h=Math.cos(i),f=e[4],m=e[5],x=e[6],w=e[7],E=e[8],A=e[9],P=e[10],D=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*h+E*l,t[5]=m*h+A*l,t[6]=x*h+P*l,t[7]=w*h+D*l,t[8]=E*h-f*l,t[9]=A*h-m*l,t[10]=P*h-x*l,t[11]=D*h-w*l,t}function id(t,e,i){var l=Math.sin(i),h=Math.cos(i),f=e[0],m=e[1],x=e[2],w=e[3],E=e[8],A=e[9],P=e[10],D=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*h-E*l,t[1]=m*h-A*l,t[2]=x*h-P*l,t[3]=w*h-D*l,t[8]=f*l+E*h,t[9]=m*l+A*h,t[10]=x*l+P*h,t[11]=w*l+D*h,t}function wm(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Tm(t,e,i){var l,h,f,m=i[0],x=i[1],w=i[2],E=Math.hypot(m,x,w);return E<td?null:(m*=E=1/E,x*=E,w*=E,l=Math.sin(e),h=Math.cos(e),t[0]=m*m*(f=1-h)+h,t[1]=x*m*f+w*l,t[2]=w*m*f-x*l,t[3]=0,t[4]=m*x*f-w*l,t[5]=x*x*f+h,t[6]=w*x*f+m*l,t[7]=0,t[8]=m*w*f+x*l,t[9]=x*w*f-m*l,t[10]=w*w*f+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var gv=_a;function nf(){var t=new Zn(3);return Zn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Em(t){var e=new Zn(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function th(t){return Math.hypot(t[0],t[1],t[2])}function El(t,e,i){var l=new Zn(3);return l[0]=t,l[1]=e,l[2]=i,l}function Cr(t,e,i){return t[0]=e[0]+i[0],t[1]=e[1]+i[1],t[2]=e[2]+i[2],t}function sf(t,e,i){return t[0]=e[0]-i[0],t[1]=e[1]-i[1],t[2]=e[2]-i[2],t}function Sm(t,e,i){return t[0]=e[0]*i[0],t[1]=e[1]*i[1],t[2]=e[2]*i[2],t}function ih(t,e,i){return t[0]=Math.min(e[0],i[0]),t[1]=Math.min(e[1],i[1]),t[2]=Math.min(e[2],i[2]),t}function nh(t,e,i){return t[0]=Math.max(e[0],i[0]),t[1]=Math.max(e[1],i[1]),t[2]=Math.max(e[2],i[2]),t}function ns(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t}function sh(t,e,i,l){return t[0]=e[0]+i[0]*l,t[1]=e[1]+i[1]*l,t[2]=e[2]+i[2]*l,t}function Sn(t,e){var i=e[0],l=e[1],h=e[2],f=i*i+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function _s(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function rf(t,e,i){var l=e[0],h=e[1],f=e[2],m=i[0],x=i[1],w=i[2];return t[0]=h*w-f*x,t[1]=f*m-l*w,t[2]=l*x-h*m,t}function Bi(t,e,i){var l=e[0],h=e[1],f=e[2],m=i[3]*l+i[7]*h+i[11]*f+i[15];return t[0]=(i[0]*l+i[4]*h+i[8]*f+i[12])/(m=m||1),t[1]=(i[1]*l+i[5]*h+i[9]*f+i[13])/m,t[2]=(i[2]*l+i[6]*h+i[10]*f+i[14])/m,t}function Mm(t,e,i){var l=i[0],h=i[1],f=i[2],m=e[0],x=e[1],w=e[2],E=h*w-f*x,A=f*m-l*w,P=l*x-h*m,D=h*P-f*A,O=f*E-l*P,B=l*A-h*E,V=2*i[3];return A*=V,P*=V,O*=2,B*=2,t[0]=m+(E*=V)+(D*=2),t[1]=x+A+O,t[2]=w+P+B,t}var rh,Os=sf,yv=Sm,xv=th;function Am(t,e,i){return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t}function Cm(t,e){var i=e[0],l=e[1],h=e[2],f=e[3],m=i*i+l*l+h*h+f*f;return m>0&&(m=1/Math.sqrt(m)),t[0]=i*m,t[1]=l*m,t[2]=h*m,t[3]=f*m,t}function ga(t,e,i){var l=e[0],h=e[1],f=e[2],m=e[3];return t[0]=i[0]*l+i[4]*h+i[8]*f+i[12]*m,t[1]=i[1]*l+i[5]*h+i[9]*f+i[13]*m,t[2]=i[2]*l+i[6]*h+i[10]*f+i[14]*m,t[3]=i[3]*l+i[7]*h+i[11]*f+i[15]*m,t}function Im(){var t=new Zn(4);return Zn!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Pm(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function km(t,e,i){i*=.5;var l=e[0],h=e[1],f=e[2],m=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=l*w+m*x,t[1]=h*w+f*x,t[2]=f*w-h*x,t[3]=m*w-l*x,t}function Dm(t,e,i){i*=.5;var l=e[0],h=e[1],f=e[2],m=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=l*w-f*x,t[1]=h*w+m*x,t[2]=f*w+l*x,t[3]=m*w-h*x,t}nf(),rh=new Zn(4),Zn!=Float32Array&&(rh[0]=0,rh[1]=0,rh[2]=0,rh[3]=0);var vv=Cm;nf(),El(1,0,0),El(0,1,0),Im(),Im(),vm();const bv=xe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Lm}=bv,zm=xe([{name:"a_pos_3",components:3,type:"Int16"}]);var oh=xe([{name:"a_pos",type:"Int16",components:2}]);class of{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const h=_s(i,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,l){if(function(O,B){var V=O[0],W=O[1],ee=O[2],le=B[0],te=B[1],oe=B[2];return Math.abs(V-le)<=td*Math.max(1,Math.abs(V),Math.abs(le))&&Math.abs(W-te)<=td*Math.max(1,Math.abs(W),Math.abs(te))&&Math.abs(ee-oe)<=td*Math.max(1,Math.abs(ee),Math.abs(oe))}(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[h,f,m]=this.dir,x=this.pos[0]-e[0],w=this.pos[1]-e[1],E=this.pos[2]-e[2],A=h*h+f*f+m*m,P=2*(x*h+w*f+E*m),D=P*P-4*A*(x*x+w*w+E*E-i*i);if(D<0){const O=Math.max(-P/2,0),B=x+h*O,V=w+f*O,W=E+m*O,ee=Math.hypot(B,V,W);return l[0]=B*i/ee,l[1]=V*i/ee,l[2]=W*i/ee,!1}{const O=(-P-Math.sqrt(D))/(2*A);if(O<0){const B=Math.hypot(x,w,E);return l[0]=x*i/B,l[1]=w*i/B,l[2]=E*i/B,!1}return l[0]=x+h*O,l[1]=w+f*O,l[2]=E+m*O,!0}}}class af{constructor(e,i,l,h,f){this.TL=e,this.TR=i,this.BR=l,this.BL=h,this.horizon=f}static fromInvProjectionMatrix(e,i,l){const h=[-1,1,1],f=[1,1,1],m=[1,-1,1],x=[-1,-1,1],w=Bi(h,h,e),E=Bi(f,f,e),A=Bi(m,m,e),P=Bi(x,x,e);return new af(w,E,A,P,i/l)}}class lf{constructor(e,i){this.points=e,this.planes=i}static fromInvProjectionMatrix(e,i,l,h){const f=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=ga([],w,e),A=1/E[3]/i*f;return function(P,D,O){return P[0]=D[0]*O[0],P[1]=D[1]*O[1],P[2]=D[2]*O[2],P[3]=D[3]*O[3],P}(E,E,[A,A,h?1/E[3]:A,A])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Sn([],rf([],Os([],m[w[0]],m[w[1]]),Os([],m[w[2]],m[w[1]]))),A=-_s(E,m[w[1]]);return E.concat(A)});return new lf(m,x)}}class Mn{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of e)ih(i,i,h),nh(l,l,h);return new Mn(i,l)}static applyTransform(e,i){const l=e.getCorners();for(let h=0;h<l.length;++h)Bi(l[h],l[h],i);return Mn.fromPoints(l)}constructor(e,i){this.min=e,this.max=i,this.center=ns([],Cr([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=Em(this.min),h=Em(this.max);for(let f=0;f<i.length;f++)l[f]=i[f]?this.min[f]:this.center[f],h[f]=i[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Mn(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){const i=this.getCorners();let l=!0;for(let h=0;h<e.planes.length;h++){const f=e.planes[h];let m=0;for(let x=0;x<i.length;x++)m+=_s(f,i[x])+f[3]>=0;if(m===0)return 0;m!==i.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let x=0;x<e.points.length;x++){const w=e.points[x][h]-this.min[h];f=Math.min(f,w),m=Math.max(m,w)}if(m<0||f>this.max[h]-this.min[h])return 0}return 1}}const cf=5,Rm=6,Js=yt/Math.PI/2,wv=16383,ya=64,ah=[ya,32,16],ms=-Js,gs=Js,Tv=[new Mn([ms,ms,ms],[gs,gs,gs]),new Mn([ms,ms,ms],[0,0,gs]),new Mn([0,ms,ms],[gs,0,gs]),new Mn([ms,0,ms],[0,gs,gs]),new Mn([0,0,ms],[gs,gs,gs])];function nd(t){return t*Js/hh}function Om(t,e,i,l=!0){const h=ns([],t._camera.position,t.worldSize),f=[e,i,1,1];ga(f,f,t.pixelMatrixInverse),Am(f,f,1/f[3]);const m=Sn([],Os([],f,h)),x=t.globeMatrix,w=[x[12],x[13],x[14]],E=Os([],w,h),A=th(E),P=Sn([],E),D=t.worldSize/(2*Math.PI),O=_s(P,m),B=Math.asin(D/A);if(B<Math.acos(O)){if(!l)return null;const He=[],Pe=[];ns(He,m,A/O),Sn(Pe,Os(Pe,He,E)),Sn(m,Cr(m,E,ns(m,Pe,Math.tan(B)*A)))}const V=[];new of(h,m).closestPointOnSphere(w,D,V);const W=Sn([],Ws(x,0)),ee=Sn([],Ws(x,1)),le=Sn([],Ws(x,2)),te=_s(W,V),oe=_s(ee,V),de=_s(le,V),ue=Gt(Math.asin(-oe/D));let Ce=Gt(Math.atan2(te,de));Ce=t.center.lng+function(He,Pe){const Ve=(Pe-He+180)%360-180;return Ve<-180?Ve+360:Ve}(t.center.lng,Ce);const Se=er(Ce),Be=bt(tr(ue),0,1);return new Cl(Se,Be)}class Ev{constructor(e,i,l){this.a=Os([],e,l),this.b=Os([],i,l),this.center=l;const h=Sn([],this.a),f=Sn([],this.b);this.angle=Math.acos(_s(h,f))}}function hf(t,e){if(t.angle===0)return null;let i;return i=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),i<0||i>1?null:function(l,h,f,m){const x=Math.sin(f);return l*(Math.sin((1-m)*f)/x)+h*(Math.sin(m*f)/x)}(t.a[e],t.b[e],t.angle,bt(i,0,1))+t.center[e]}function Qs(t){if(t.z<=1)return Tv[t.z+2*t.y+t.x];const e=uf(sd(t));return Mn.fromPoints(e)}function xa(t,e,i){return ns(t,t,1-i),sh(t,t,e,i)}function Bm(t,e){const i=Al(e.zoom);if(i===0)return Qs(t);const l=sd(t),h=uf(l),f=er(l.getWest())*e.worldSize,m=er(l.getEast())*e.worldSize,x=tr(l.getNorth())*e.worldSize,w=tr(l.getSouth())*e.worldSize,E=[f,x,0],A=[m,x,0],P=[f,w,0],D=[m,w,0],O=ef([],e.globeMatrix);return Bi(E,E,O),Bi(A,A,O),Bi(P,P,O),Bi(D,D,O),h[0]=xa(h[0],P,i),h[1]=xa(h[1],D,i),h[2]=xa(h[2],A,i),h[3]=xa(h[3],E,i),Mn.fromPoints(h)}function Fm(t,e,i){for(const l of t)Bi(l,l,e),ns(l,l,i)}function Sv(t,e,i){const l=e/t.worldSize,h=t.globeMatrix;if(i.z<=1){const Se=Qs(i).getCorners();return Fm(Se,h,l),Mn.fromPoints(Se)}const f=sd(i),m=uf(f);Fm(m,h,l);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(f.contains(t.center)){for(const He of m)ih(E,E,He),nh(w,w,He);w[2]=0;const Se=t.point,Be=[Se.x*l,Se.y*l,0];return ih(E,E,Be),nh(w,w,Be),new Mn(E,w)}const A=[h[12]*l,h[13]*l,h[14]*l],P=f.getCenter(),D=bt(t.center.lat,-_n,_n),O=bt(P.lat,-_n,_n),B=er(t.center.lng),V=tr(D);let W=B-er(P.lng);const ee=V-tr(O);W>.5?W-=1:W<-.5&&(W+=1);let le=0;Math.abs(W)>Math.abs(ee)?le=W>=0?1:3:(le=ee>=0?0:2,sh(A,A,[h[4]*l,h[5]*l,h[6]*l],-Math.sin(ft(ee>=0?f.getSouth():f.getNorth()))*Js));const te=m[le],oe=m[(le+1)%4],de=new Ev(te,oe,A),ue=[hf(de,0)||te[0],hf(de,1)||te[1],hf(de,2)||te[2]],Ce=Al(t.zoom);if(Ce>0){const Se=function({x:He,y:Pe,z:Ve},Ue,$e,Qe,ze){const rt=1/(1<<Ve);let pt=He*rt,ot=pt+rt,Tt=Pe*rt,et=Tt+rt,gt=0;const Et=(pt+ot)/2-Qe;return Et>.5?gt=-1:Et<-.5&&(gt=1),pt=((pt+gt)*Ue-(Qe*=Ue))*$e+Qe,ot=((ot+gt)*Ue-Qe)*$e+Qe,Tt=(Tt*Ue-(ze*=Ue))*$e+ze,et=(et*Ue-ze)*$e+ze,[[pt,et,0],[ot,et,0],[ot,Tt,0],[pt,Tt,0]]}(i,e,t._pixelsPerMercatorPixel,B,V);for(let He=0;He<m.length;He++)xa(m[He],Se[He],Ce);const Be=Cr([],Se[le],Se[(le+1)%4]);ns(Be,Be,.5),xa(ue,Be,Ce)}for(const Se of m)ih(E,E,Se),nh(w,w,Se);return E[2]=Math.min(te[2],oe[2]),ih(E,E,ue),nh(w,w,ue),new Mn(E,w)}function sd({x:t,y:e,z:i}){const l=1/(1<<i),h=new oi(ss(t*l),fn((e+1)*l)),f=new oi(ss((t+1)*l),fn(e*l));return new fo(h,f)}function uf(t){const e=ft(t.getNorth()),i=ft(t.getSouth()),l=Math.cos(e),h=Math.cos(i),f=Math.sin(e),m=Math.sin(i),x=t.getWest(),w=t.getEast();return[Sl(h,m,x),Sl(h,m,w),Sl(l,f,w),Sl(l,f,x)]}function Sl(t,e,i,l=Js){return i=ft(i),[t*Math.sin(i)*l,-e*l,t*Math.cos(i)*l]}function Ml(t,e,i){return Sl(Math.cos(ft(t)),Math.sin(ft(t)),e,i)}function lh(t,e,i,l){const h=1<<i.z,f=(t/yt+i.x)/h;return Ml(fn((e/yt+i.y)/h),ss(f),l)}function rd({min:t,max:e}){return wv/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Nm=new Float64Array(16);function ch(t){const e=rd(t),i=wm(Nm,[e,e,e]);return eh(i,i,((l=[])[0]=-(h=t.min)[0],l[1]=-h[1],l[2]=-h[2],l));var l,h}function df(t){const e=(l=t.min,(i=Nm)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const h=1/rd(t);return ma(e,e,[h,h,h])}function jm(t,e,i,l,h){const f=function(w){const E=yt/(2*Math.PI);return w/(2*Math.PI)/E}(i),m=[t,e,-i/(2*Math.PI)],x=Rs(new Float64Array(16));return eh(x,x,m),ma(x,x,[f,f,f]),tf(x,x,ft(-h)),id(x,x,ft(-l)),x}function Al(t){return Pi(cf,Rm,t)}function Vm(t,e){const i=Ml(e.lat,e.lng),l=function(B){const V=Ml(B._center.lat,B._center.lng);let W=rf([],El(0,1,0),V);const ee=Tm([],-B.angle,V);W=Bi(W,W,ee),Tm(ee,-B._pitch,W);const le=Sn([],V);return ns(le,le,nd(B.cameraToCenterDistance/B.pixelsPerMeter)),Bi(le,le,ee),Cr([],V,le)}(t);return m=(h=sf([],l,i))[0],x=h[1],w=h[2],E=(f=i)[0],A=f[1],P=f[2],O=(D=Math.sqrt(m*m+x*x+w*w)*Math.sqrt(E*E+A*A+P*P))&&_s(h,f)/D,Math.acos(Math.min(Math.max(O,-1),1));var h,f,m,x,w,E,A,P,D,O}function pf(t,e){return Vm(t,e)>Math.PI/2*1.01}const Um=ft(85),Mv=Math.cos(Um),Av=Math.sin(Um),hh=63710088e-1,Gm=2*Math.PI*hh;class _o{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new _o(xi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,h=e.lat*i,f=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return hh*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new fo(new _o(this.lng-l,this.lat-i),new _o(this.lng+l,this.lat+i))}toEcef(e){const i=nd(e);return Ml(this.lat,this.lng,Js+i)}static convert(e){if(e instanceof _o)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new _o(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new _o(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var oi=_o;function ff(t){return Gm*Math.cos(t*Math.PI/180)}function er(t){return(180+t)/360}function tr(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Bs(t,e){return t/ff(e)}function ss(t){return 360*t-180}function fn(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function $m(t,e){return t*ff(fn(e))}const _n=85.051129;function qm(t){return 1/Math.cos(t*Math.PI/180)}class Cl{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=oi.convert(e);return new Cl(er(l.lng),tr(l.lat),Bs(i,l.lat))}toLngLat(){return new oi(ss(this.x),fn(this.y))}toAltitude(){return $m(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Gm*qm(fn(this.y))}}function _f(t,e,i,l,h,f,m,x,w){const E=(e+l)/2,A=(i+h)/2,P=new Le(E,A);x(P),function(D,O,B,V,W,ee){const le=B-W,te=V-ee;return Math.abs((V-O)*le-(B-D)*te)/Math.hypot(le,te)}(P.x,P.y,f.x,f.y,m.x,m.y)>=w?(_f(t,e,i,E,A,f,P,x,w),_f(t,E,A,l,h,P,m,x,w)):t.push(m)}function Wm(t,e,i){let l=t[0],h=l.x,f=l.y;e(l);const m=[l];for(let x=1;x<t.length;x++){const w=t[x],{x:E,y:A}=w;e(w),_f(m,h,f,E,A,l,w,e,i),h=E,f=A,l=w}return m}function mf(t,e,i,l){if(l(e,i)){const h=e.add(i)._mult(.5);mf(t,e,h,l),mf(t,h,i,l)}else t.push(i)}function Cv(t,e){let i=t[0];const l=[i];for(let h=1;h<t.length;h++){const f=t[h];mf(l,i,f,e),i=f}return l}const gf=Math.pow(2,14)-1,Zm=-gf-1;function Iv(t,e){const i=Math.round(t.x*e),l=Math.round(t.y*e);return t.x=bt(i,Zm,gf),t.y=bt(l,Zm,gf),(i<t.x||i>t.x+1||l<t.y||l>t.y+1)&&Ti("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Ir(t,e,i){const l=t.loadGeometry(),h=t.extent,f=yt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:x,x:w,y:E,projection:A}=i,P=D=>{const O=ss((e.x+D.x/h)/m),B=fn((e.y+D.y/h)/m),V=A.project(O,B);D.x=(V.x*x-w)*h,D.y=(V.y*x-E)*h};for(let D=0;D<l.length;D++)if(t.type!==1)l[D]=Wm(l[D],P,1);else{const O=[];for(const B of l[D])B.x<0||B.x>=h||B.y<0||B.y>=h||(P(B),O.push(B));l[D]=O}}for(const m of l)for(const x of m)Iv(x,f);return l}function va(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Ir(t):[]}}function od(t,e,i,l,h){t.emplaceBack(2*e+(l+1)/2,2*i+(h+1)/2)}function ad(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class yf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ze,this.indexArray=new _t,this.segments=new Ui,this.programConfigurations=new fa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,h){const f=this.layers[0],m=[];let x=null;f.type==="circle"&&(x=f.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:P,sourceLayerIndex:D}of e){const O=this.layers[0]._featureFilter.needGeometry,B=va(E,O);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),B,l))continue;const V=x?x.evaluate(B,{},l):void 0,W={id:A,properties:E.properties,type:E.type,sourceLayerIndex:D,index:P,geometry:O?B.geometry:Ir(E,l,h),patterns:{},sortKey:V};m.push(W)}x&&m.sort((E,A)=>E.sortKey-A.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Xe,w=h.projection);for(const E of m){const{geometry:A,index:P,sourceLayerIndex:D}=E,O=e[P].feature;this.addFeature(E,A,P,i.availableImages,l,w),i.featureIndex.insert(O,A,P,D,this.index)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,_v.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,mv.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,l,h,f,m){for(const x of i)for(const w of x){const E=w.x,A=w.y;if(E<0||E>=yt||A<0||A>=yt)continue;if(m){const O=m.projectTilePoint(E,A,f),B=m.upVector(f,E,A),V=this.globeExtVertexArray;ad(V,O,B),ad(V,O,B),ad(V,O,B),ad(V,O,B)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),D=P.vertexLength;od(this.layoutVertexArray,E,A,-1,-1),od(this.layoutVertexArray,E,A,1,-1),od(this.layoutVertexArray,E,A,1,1),od(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},h,f)}}function Hm(t,e){for(let i=0;i<t.length;i++)if(ba(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(ba(t,e[i]))return!0;return!!xf(t,e)}function Pv(t,e,i){return!!ba(t,e)||!!vf(e,t,i)}function Xm(t,e){if(t.length===1)return Km(e,t[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let h=0;h<l.length;h++)if(ba(t,l[h]))return!0}for(let i=0;i<t.length;i++)if(Km(e,t[i]))return!0;for(let i=0;i<e.length;i++)if(xf(t,e[i]))return!0;return!1}function kv(t,e,i){if(t.length>1){if(xf(t,e))return!0;for(let l=0;l<e.length;l++)if(vf(e[l],t,i))return!0}for(let l=0;l<t.length;l++)if(vf(t[l],e,i))return!0;return!1}function xf(t,e){if(t.length===0||e.length===0)return!1;for(let i=0;i<t.length-1;i++){const l=t[i],h=t[i+1];for(let f=0;f<e.length-1;f++)if(Dv(l,h,e[f],e[f+1]))return!0}return!1}function Dv(t,e,i,l){return jn(t,i,l)!==jn(e,i,l)&&jn(t,e,i)!==jn(t,e,l)}function vf(t,e,i){const l=i*i;if(e.length===1)return t.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(Ym(t,e[h-1],e[h])<l)return!0;return!1}function Ym(t,e,i){const l=e.distSqr(i);if(l===0)return t.distSqr(e);const h=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/l;return t.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Km(t,e){let i,l,h,f=!1;for(let m=0;m<t.length;m++){i=t[m];for(let x=0,w=i.length-1;x<i.length;w=x++)l=i[x],h=i[w],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(f=!f)}return f}function ba(t,e){let i=!1;for(let l=0,h=t.length-1;l<t.length;h=l++){const f=t[l],m=t[h];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function Jm(t,e,i,l,h){for(const m of t)if(e<=m.x&&i<=m.y&&l>=m.x&&h>=m.y)return!0;const f=[new Le(e,i),new Le(e,h),new Le(l,h),new Le(l,i)];if(t.length>2){for(const m of f)if(ba(t,m))return!0}for(let m=0;m<t.length-1;m++)if(Lv(t[m],t[m+1],f))return!0;return!1}function Lv(t,e,i){const l=i[0],h=i[2];if(t.x<l.x&&e.x<l.x||t.x>h.x&&e.x>h.x||t.y<l.y&&e.y<l.y||t.y>h.y&&e.y>h.y)return!1;const f=jn(t,e,i[0]);return f!==jn(t,e,i[1])||f!==jn(t,e,i[2])||f!==jn(t,e,i[3])}function Il(t,e,i){const l=e.paint.get(t).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(t)}function ld(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Qm(t,e,i,l,h){if(!e[0]&&!e[1])return t;const f=Le.convert(e)._mult(h);i==="viewport"&&f._rotate(-l);const m=[];for(let x=0;x<t.length;x++)m.push(t[x].sub(f));return m}function eg(t,e,i,l){const h=Le.convert(t)._mult(l);return e==="viewport"&&h._rotate(-i),h}ht(yf,"CircleBucket",{omit:["layers"]});const zv=new se({"circle-sort-key":new Z(Oe.layout_circle["circle-sort-key"])});var Rv={paint:new se({"circle-radius":new Z(Oe.paint_circle["circle-radius"]),"circle-color":new Z(Oe.paint_circle["circle-color"]),"circle-blur":new Z(Oe.paint_circle["circle-blur"]),"circle-opacity":new Z(Oe.paint_circle["circle-opacity"]),"circle-translate":new j(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new j(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new j(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new j(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Z(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Z(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Z(Oe.paint_circle["circle-stroke-opacity"])}),layout:zv};function tg(t,e,i,l,h,f,m,x,w){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(w*=t.pixelToTileUnitsFactor);const E=t.tileID.canonical,A=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const P of e)for(const D of P){const O=D.add(x),B=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,V=i.projection.projectTilePoint(O.x,O.y,E);if(B>0){const te=i.projection.upVector(E,O.x,O.y);V.x+=te[0]*A*B,V.y+=te[1]*A*B,V.z+=te[2]*A*B}const W=f?O:Ov(V.x,V.y,V.z,l),ee=f?t.tilespaceRays.map(te=>Fv(te,B)):t.queryGeometry.screenGeometry,le=ga([],[V.x,V.y,V.z,1],l);if(!m&&f?w*=le[3]/i.cameraToCenterDistance:m&&!f&&(w*=i.cameraToCenterDistance/le[3]),f){const te=fn((D.y/yt+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(te,1)/Bs(1,te)}if(Pv(ee,W,w))return!0}return!1}function Ov(t,e,i,l){const h=ga([],[t,e,i,1],l);return new Le(h[0]/h[3],h[1]/h[3])}const ig=El(0,0,0),Bv=El(0,0,1);function Fv(t,e){const i=nf();return ig[2]=e,t.intersectsPlane(ig,Bv,i),new Le(i[0],i[1])}class ng extends yf{}function sg(t,{width:e,height:i},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*l);return t.width=e,t.height=i,t.data=h,t}function rg(t,e,i){const{width:l,height:h}=e;l===t.width&&h===t.height||(bf(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,l),height:Math.min(t.height,h)},i),t.width=l,t.height=h,t.data=e.data)}function bf(t,e,i,l,h,f){if(h.width===0||h.height===0)return e;if(h.width>t.width||h.height>t.height||i.x>t.width-h.width||i.y>t.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const m=t.data,x=e.data;for(let w=0;w<h.height;w++){const E=((i.y+w)*t.width+i.x)*f,A=((l.y+w)*e.width+l.x)*f;for(let P=0;P<h.width*f;P++)x[A+P]=m[E+P]}return e}ht(ng,"HeatmapBucket",{omit:["layers"]});class Pr{constructor(e,i){sg(this,e,1,i)}resize(e){rg(this,new Pr(e),1)}clone(){return new Pr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,h,f){bf(e,i,l,h,f,1)}}class Hn{constructor(e,i){sg(this,e,4,i)}resize(e){rg(this,new Hn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Hn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,h,f){bf(e,i,l,h,f,4)}}ht(Pr,"AlphaImage"),ht(Hn,"RGBAImage");var Nv={paint:new se({"heatmap-radius":new Z(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Z(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new j(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ne(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new j(Oe.paint_heatmap["heatmap-opacity"])})};function wf(t){const e={},i=t.resolution||256,l=t.clips?t.clips.length:1,h=t.image||new Hn({width:i,height:l}),f=(m,x,w)=>{e[t.evaluationKey]=w;const E=t.expression.evaluate(e);h.data[m+x+0]=Math.floor(255*E.r/E.a),h.data[m+x+1]=Math.floor(255*E.g/E.a),h.data[m+x+2]=Math.floor(255*E.b/E.a),h.data[m+x+3]=Math.floor(255*E.a)};if(t.clips)for(let m=0,x=0;m<l;++m,x+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const A=w/(i-1),{start:P,end:D}=t.clips[m];f(x,E,P*(1-A)+D*A)}else for(let m=0,x=0;m<i;m++,x+=4)f(0,x,m/(i-1));return h}var jv={paint:new se({"hillshade-illumination-direction":new j(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new j(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new j(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new j(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new j(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new j(Oe.paint_hillshade["hillshade-accent-color"])})};const Vv=xe([{name:"a_pos",components:2,type:"Int16"}],4),{members:Uv}=Vv;var Tf={exports:{}};function cd(t,e,i){i=i||2;var l,h,f,m,x,w,E,A=e&&e.length,P=A?e[0]*i:t.length,D=og(t,0,P,i,!0),O=[];if(!D||D.next===D.prev)return O;if(A&&(D=function(V,W,ee,le){var te,oe,de,ue=[];for(te=0,oe=W.length;te<oe;te++)(de=og(V,W[te]*le,te<oe-1?W[te+1]*le:V.length,le,!1))===de.next&&(de.steiner=!0),ue.push(Yv(de));for(ue.sort(Zv),te=0;te<ue.length;te++)ee=Hv(ue[te],ee);return ee}(t,e,D,i)),t.length>80*i){l=f=t[0],h=m=t[1];for(var B=i;B<P;B+=i)(x=t[B])<l&&(l=x),(w=t[B+1])<h&&(h=w),x>f&&(f=x),w>m&&(m=w);E=(E=Math.max(f-l,m-h))!==0?32767/E:0}return uh(D,O,i,l,h,E,0),O}function og(t,e,i,l,h){var f,m;if(h===Mf(t,e,i,l)>0)for(f=e;f<i;f+=l)m=cg(f,t[f],t[f+1],m);else for(f=i-l;f>=e;f-=l)m=cg(f,t[f],t[f+1],m);return m&&hd(m,m.next)&&(ph(m),m=m.next),m}function wa(t,e){if(!t)return t;e||(e=t);var i,l=t;do if(i=!1,l.steiner||!hd(l,l.next)&&Gi(l.prev,l,l.next)!==0)l=l.next;else{if(ph(l),(l=e=l.prev)===l.next)break;i=!0}while(i||l!==e);return e}function uh(t,e,i,l,h,f,m){if(t){!m&&f&&function(A,P,D,O){var B=A;do B.z===0&&(B.z=Ef(B.x,B.y,P,D,O)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(V){var W,ee,le,te,oe,de,ue,Ce,Se=1;do{for(ee=V,V=null,oe=null,de=0;ee;){for(de++,le=ee,ue=0,W=0;W<Se&&(ue++,le=le.nextZ);W++);for(Ce=Se;ue>0||Ce>0&&le;)ue!==0&&(Ce===0||!le||ee.z<=le.z)?(te=ee,ee=ee.nextZ,ue--):(te=le,le=le.nextZ,Ce--),oe?oe.nextZ=te:V=te,te.prevZ=oe,oe=te;ee=le}oe.nextZ=null,Se*=2}while(de>1)}(B)}(t,l,h,f);for(var x,w,E=t;t.prev!==t.next;)if(x=t.prev,w=t.next,f?$v(t,l,h,f):Gv(t))e.push(x.i/i|0),e.push(t.i/i|0),e.push(w.i/i|0),ph(t),t=w.next,E=w.next;else if((t=w)===E){m?m===1?uh(t=qv(wa(t),e,i),e,i,l,h,f,2):m===2&&Wv(t,e,i,l,h,f):uh(wa(t),e,i,l,h,f,1);break}}}function Gv(t){var e=t.prev,i=t,l=t.next;if(Gi(e,i,l)>=0)return!1;for(var h=e.x,f=i.x,m=l.x,x=e.y,w=i.y,E=l.y,A=h<f?h<m?h:m:f<m?f:m,P=x<w?x<E?x:E:w<E?w:E,D=h>f?h>m?h:m:f>m?f:m,O=x>w?x>E?x:E:w>E?w:E,B=l.next;B!==e;){if(B.x>=A&&B.x<=D&&B.y>=P&&B.y<=O&&Pl(h,x,f,w,m,E,B.x,B.y)&&Gi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function $v(t,e,i,l){var h=t.prev,f=t,m=t.next;if(Gi(h,f,m)>=0)return!1;for(var x=h.x,w=f.x,E=m.x,A=h.y,P=f.y,D=m.y,O=x<w?x<E?x:E:w<E?w:E,B=A<P?A<D?A:D:P<D?P:D,V=x>w?x>E?x:E:w>E?w:E,W=A>P?A>D?A:D:P>D?P:D,ee=Ef(O,B,e,i,l),le=Ef(V,W,e,i,l),te=t.prevZ,oe=t.nextZ;te&&te.z>=ee&&oe&&oe.z<=le;){if(te.x>=O&&te.x<=V&&te.y>=B&&te.y<=W&&te!==h&&te!==m&&Pl(x,A,w,P,E,D,te.x,te.y)&&Gi(te.prev,te,te.next)>=0||(te=te.prevZ,oe.x>=O&&oe.x<=V&&oe.y>=B&&oe.y<=W&&oe!==h&&oe!==m&&Pl(x,A,w,P,E,D,oe.x,oe.y)&&Gi(oe.prev,oe,oe.next)>=0))return!1;oe=oe.nextZ}for(;te&&te.z>=ee;){if(te.x>=O&&te.x<=V&&te.y>=B&&te.y<=W&&te!==h&&te!==m&&Pl(x,A,w,P,E,D,te.x,te.y)&&Gi(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;oe&&oe.z<=le;){if(oe.x>=O&&oe.x<=V&&oe.y>=B&&oe.y<=W&&oe!==h&&oe!==m&&Pl(x,A,w,P,E,D,oe.x,oe.y)&&Gi(oe.prev,oe,oe.next)>=0)return!1;oe=oe.nextZ}return!0}function qv(t,e,i){var l=t;do{var h=l.prev,f=l.next.next;!hd(h,f)&&ag(h,l,l.next,f)&&dh(h,f)&&dh(f,h)&&(e.push(h.i/i|0),e.push(l.i/i|0),e.push(f.i/i|0),ph(l),ph(l.next),l=t=f),l=l.next}while(l!==t);return wa(l)}function Wv(t,e,i,l,h,f){var m=t;do{for(var x=m.next.next;x!==m.prev;){if(m.i!==x.i&&Kv(m,x)){var w=lg(m,x);return m=wa(m,m.next),w=wa(w,w.next),uh(m,e,i,l,h,f,0),void uh(w,e,i,l,h,f,0)}x=x.next}m=m.next}while(m!==t)}function Zv(t,e){return t.x-e.x}function Hv(t,e){var i=function(h,f){var m,x=f,w=h.x,E=h.y,A=-1/0;do{if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){var P=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(P<=w&&P>A&&(A=P,m=x.x<x.next.x?x:x.next,P===w))return m}x=x.next}while(x!==f);if(!m)return null;var D,O=m,B=m.x,V=m.y,W=1/0;x=m;do w>=x.x&&x.x>=B&&w!==x.x&&Pl(E<V?w:A,E,B,V,E<V?A:w,E,x.x,x.y)&&(D=Math.abs(E-x.y)/(w-x.x),dh(x,h)&&(D<W||D===W&&(x.x>m.x||x.x===m.x&&Xv(m,x)))&&(m=x,W=D)),x=x.next;while(x!==O);return m}(t,e);if(!i)return e;var l=lg(i,t);return wa(l,l.next),wa(i,i.next)}function Xv(t,e){return Gi(t.prev,t,e.prev)<0&&Gi(e.next,t,t.next)<0}function Ef(t,e,i,l,h){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Yv(t){var e=t,i=t;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==t);return i}function Pl(t,e,i,l,h,f,m,x){return(h-m)*(e-x)>=(t-m)*(f-x)&&(t-m)*(l-x)>=(i-m)*(e-x)&&(i-m)*(f-x)>=(h-m)*(l-x)}function Kv(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(i,l){var h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==l.i&&h.next.i!==l.i&&ag(h,h.next,i,l))return!0;h=h.next}while(h!==i);return!1}(t,e)&&(dh(t,e)&&dh(e,t)&&function(i,l){var h=i,f=!1,m=(i.x+l.x)/2,x=(i.y+l.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&m<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next;while(h!==i);return f}(t,e)&&(Gi(t.prev,t,e.prev)||Gi(t,e.prev,e))||hd(t,e)&&Gi(t.prev,t,t.next)>0&&Gi(e.prev,e,e.next)>0)}function Gi(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function hd(t,e){return t.x===e.x&&t.y===e.y}function ag(t,e,i,l){var h=dd(Gi(t,e,i)),f=dd(Gi(t,e,l)),m=dd(Gi(i,l,t)),x=dd(Gi(i,l,e));return h!==f&&m!==x||!(h!==0||!ud(t,i,e))||!(f!==0||!ud(t,l,e))||!(m!==0||!ud(i,t,l))||!(x!==0||!ud(i,e,l))}function ud(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function dd(t){return t>0?1:t<0?-1:0}function dh(t,e){return Gi(t.prev,t,t.next)<0?Gi(t,e,t.next)>=0&&Gi(t,t.prev,e)>=0:Gi(t,e,t.prev)<0||Gi(t,t.next,e)<0}function lg(t,e){var i=new Sf(t.i,t.x,t.y),l=new Sf(e.i,e.x,e.y),h=t.next,f=e.prev;return t.next=e,e.prev=t,i.next=h,h.prev=i,l.next=i,i.prev=l,f.next=l,l.prev=f,l}function cg(t,e,i,l){var h=new Sf(t,e,i);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function ph(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Sf(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Mf(t,e,i,l){for(var h=0,f=e,m=i-l;f<i;f+=l)h+=(t[m]-t[f])*(t[f+1]+t[m+1]),m=f;return h}Tf.exports=cd,Tf.exports.default=cd,cd.deviation=function(t,e,i,l){var h=e&&e.length,f=Math.abs(Mf(t,0,h?e[0]*i:t.length,i));if(h)for(var m=0,x=e.length;m<x;m++)f-=Math.abs(Mf(t,e[m]*i,m<x-1?e[m+1]*i:t.length,i));var w=0;for(m=0;m<l.length;m+=3){var E=l[m]*i,A=l[m+1]*i,P=l[m+2]*i;w+=Math.abs((t[E]-t[P])*(t[A+1]-t[E+1])-(t[E]-t[A])*(t[P+1]-t[E+1]))}return f===0&&w===0?0:Math.abs((w-f)/f)},cd.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},l=0,h=0;h<t.length;h++){for(var f=0;f<t[h].length;f++)for(var m=0;m<e;m++)i.vertices.push(t[h][f][m]);h>0&&i.holes.push(l+=t[h-1].length)}return i};var Af=Fe(Tf.exports);function Jv(t,e,i,l,h){hg(t,e,i||0,l||t.length-1,h||Qv)}function hg(t,e,i,l,h){for(;l>i;){if(l-i>600){var f=l-i+1,m=e-i+1,x=Math.log(f),w=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*w*(f-w)/f)*(m-f/2<0?-1:1);hg(t,e,Math.max(i,Math.floor(e-m*w/f+E)),Math.min(l,Math.floor(e+(f-m)*w/f+E)),h)}var A=t[e],P=i,D=l;for(fh(t,i,e),h(t[l],A)>0&&fh(t,i,l);P<D;){for(fh(t,P,D),P++,D--;h(t[P],A)<0;)P++;for(;h(t[D],A)>0;)D--}h(t[i],A)===0?fh(t,i,D):fh(t,++D,l),D<=e&&(i=D+1),e<=D&&(l=D-1)}}function fh(t,e,i){var l=t[e];t[e]=t[i],t[i]=l}function Qv(t,e){return t<e?-1:t>e?1:0}function Cf(t,e){const i=t.length;if(i<=1)return[t];const l=[];let h,f;for(let m=0;m<i;m++){const x=Ga(t[m]);x!==0&&(t[m].area=Math.abs(x),f===void 0&&(f=x<0),f===x<0?(h&&l.push(h),h=[t[m]]):h.push(t[m]))}if(h&&l.push(h),e>1)for(let m=0;m<l.length;m++)l[m].length<=e||(Jv(l[m],e,1,l[m].length-1,eb),l[m]=l[m].slice(0,e));return l}function eb(t,e){return e.area-t.area}function If(t,e,i){const l=i.patternDependencies;let h=!1;for(const f of e){const m=f.paint.get(`${t}-pattern`);m.isConstant()||(h=!0);const x=m.constantOr(null);x&&(h=!0,l[x]=!0)}return h}function Pf(t,e,i,l,h){const f=h.patternDependencies;for(const m of e){const x=m.paint.get(`${t}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:l},i,{},h.availableImages);w=w&&w.name?w.name:w,f[w]=!0,i.patterns[m.id]=w}}return i}class pd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ze,this.indexArray=new _t,this.indexArray2=new nn,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new Ui,this.segments2=new Ui,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,l,h){this.hasPattern=If("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:w,index:E,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,D=va(x,P);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),D,l))continue;const O=f?f.evaluate(D,{},l,i.availableImages):void 0,B={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:E,geometry:P?D.geometry:Ir(x,l,h),patterns:{},sortKey:O};m.push(B)}f&&m.sort((x,w)=>x.sortKey-w.sortKey);for(const x of m){const{geometry:w,index:E,sourceLayerIndex:A}=x;if(this.hasPattern){const P=Pf("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(P)}else this.addFeature(x,w,E,l,{},i.availableImages);i.featureIndex.insert(e[E].feature,w,E,A,this.index)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}addFeatures(e,i,l,h,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Uv),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,l,h,f,m=[]){for(const x of Cf(i,500)){let w=0;for(const B of x)w+=B.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=E.vertexLength,P=[],D=[];for(const B of x){if(B.length===0)continue;B!==x[0]&&D.push(P.length/2);const V=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),W=V.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(W+B.length-1,W),P.push(B[0].x),P.push(B[0].y);for(let ee=1;ee<B.length;ee++)this.layoutVertexArray.emplaceBack(B[ee].x,B[ee].y),this.indexArray2.emplaceBack(W+ee-1,W+ee),P.push(B[ee].x),P.push(B[ee].y);V.vertexLength+=B.length,V.primitiveLength+=B.length}const O=Af(P,D);for(let B=0;B<O.length;B+=3)this.indexArray.emplaceBack(A+O[B],A+O[B+1],A+O[B+2]);E.vertexLength+=w,E.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,m,h)}}ht(pd,"FillBucket",{omit:["layers","patternFeatures"]});const tb=new se({"fill-sort-key":new Z(Oe.layout_fill["fill-sort-key"])});var ib={paint:new se({"fill-antialias":new j(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Z(Oe.paint_fill["fill-opacity"]),"fill-color":new Z(Oe.paint_fill["fill-color"]),"fill-outline-color":new Z(Oe.paint_fill["fill-outline-color"]),"fill-translate":new j(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new j(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Z(Oe.paint_fill["fill-pattern"])}),layout:tb};const nb=xe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sb=xe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),rb=xe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ob}=nb;var fd={},ab=nt,ug=kl;function kl(t,e,i,l,h){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=l,this._values=h,t.readFields(lb,this,e)}function lb(t,e,i){t==1?e.id=i.readVarint():t==2?function(l,h){for(var f=l.readVarint()+l.pos;l.pos<f;){var m=h._keys[l.readVarint()],x=h._values[l.readVarint()];h.properties[m]=x}}(i,e):t==3?e.type=i.readVarint():t==4&&(e._geometry=i.pos)}function cb(t){for(var e,i,l=0,h=0,f=t.length,m=f-1;h<f;m=h++)l+=((i=t[m]).x-(e=t[h]).x)*(e.y+i.y);return l}kl.types=["Unknown","Point","LineString","Polygon"],kl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,l=1,h=0,f=0,m=0,x=[];t.pos<i;){if(h<=0){var w=t.readVarint();l=7&w,h=w>>3}if(h--,l===1||l===2)f+=t.readSVarint(),m+=t.readSVarint(),l===1&&(e&&x.push(e),e=[]),e.push(new ab(f,m));else{if(l!==7)throw new Error("unknown command "+l);e&&e.push(e[0].clone())}}return e&&x.push(e),x},kl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,l=0,h=0,f=0,m=1/0,x=-1/0,w=1/0,E=-1/0;t.pos<e;){if(l<=0){var A=t.readVarint();i=7&A,l=A>>3}if(l--,i===1||i===2)(h+=t.readSVarint())<m&&(m=h),h>x&&(x=h),(f+=t.readSVarint())<w&&(w=f),f>E&&(E=f);else if(i!==7)throw new Error("unknown command "+i)}return[m,w,x,E]},kl.prototype.toGeoJSON=function(t,e,i){var l,h,f=this.extent*Math.pow(2,i),m=this.extent*t,x=this.extent*e,w=this.loadGeometry(),E=kl.types[this.type];function A(O){for(var B=0;B<O.length;B++){var V=O[B];O[B]=[360*(V.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(l=0;l<w.length;l++)P[l]=w[l][0];A(w=P);break;case 2:for(l=0;l<w.length;l++)A(w[l]);break;case 3:for(w=function(O){var B=O.length;if(B<=1)return[O];for(var V,W,ee=[],le=0;le<B;le++){var te=cb(O[le]);te!==0&&(W===void 0&&(W=te<0),W===te<0?(V&&ee.push(V),V=[O[le]]):V.push(O[le]))}return V&&ee.push(V),ee}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)A(w[l][h])}w.length===1?w=w[0]:E="Multi"+E;var D={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(D.id=this.id),D};var hb=ug,dg=pg;function pg(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(ub,this,e),this.length=this._features.length}function ub(t,e,i){t===15?e.version=i.readVarint():t===1?e.name=i.readString():t===5?e.extent=i.readVarint():t===2?e._features.push(i.pos):t===3?e._keys.push(i.readString()):t===4&&e._values.push(function(l){for(var h=null,f=l.readVarint()+l.pos;l.pos<f;){var m=l.readVarint()>>3;h=m===1?l.readString():m===2?l.readFloat():m===3?l.readDouble():m===4?l.readVarint64():m===5?l.readVarint():m===6?l.readSVarint():m===7?l.readBoolean():null}return h}(i))}pg.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new hb(this._pbf,e,this.extent,this._keys,this._values)};var db=dg;function pb(t,e,i){if(t===3){var l=new db(i,i.readVarint()+i.pos);l.length&&(e[l.name]=l)}}var kf=fd.VectorTile=function(t,e){this.layers=t.readFields(pb,{},e)},_d=fd.VectorTileFeature=ug;function md(t,e,i,l){const h=[],f=l===0?(m,x,w,E,A,P)=>{m.push(new Le(P,w+(P-x)/(E-x)*(A-w)))}:(m,x,w,E,A,P)=>{m.push(new Le(x+(P-w)/(A-w)*(E-x),P))};for(const m of t){const x=[];for(const w of m){if(w.length<=2)continue;const E=[];for(let D=0;D<w.length-1;D++){const O=w[D].x,B=w[D].y,V=w[D+1].x,W=w[D+1].y,ee=l===0?O:B,le=l===0?V:W;ee<e?le>e&&f(E,O,B,V,W,e):ee>i?le<i&&f(E,O,B,V,W,i):E.push(w[D]),le<e&&ee>=e&&f(E,O,B,V,W,e),le>i&&ee<=i&&f(E,O,B,V,W,i)}let A=w[w.length-1];const P=l===0?A.x:A.y;P>=e&&P<=i&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),x.push(E))}x.length&&h.push(x)}return h}fd.VectorTileLayer=dg;const fb=_d.types,_b=Math.pow(2,13);function _h(t,e,i,l,h,f,m,x){t.emplaceBack((e<<1)+m,(i<<1)+f,(Math.floor(l*_b)<<1)+h,Math.round(x))}function mh(t,e,i){t.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class fg{constructor(){this.acc=new Le(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Le(e.x,e.y),this.max=new Le(e.x,e.y))}append(e,i){this.currentPolyCount.edges++,this.acc._add(e);const l=this.min,h=this.max;e.x<l.x?l.x=e.x:e.x>h.x&&(h.x=e.x),e.y<l.y?l.y=e.y:e.y>h.y&&(h.y=e.y),((e.x===0||e.x===yt)&&e.x===i.x)!=((e.y===0||e.y===yt)&&e.y===i.y)&&this.processBorderOverlap(e,i),i.x<0!=e.x<0&&this.addBorderIntersection(0,Ut(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>yt!=e.x>yt&&this.addBorderIntersection(1,Ut(i.y,e.y,(yt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Ut(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>yt!=e.y>yt&&this.addBorderIntersection(3,Ut(i.x,e.x,(yt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){const e=this.polyCount.reduce((i,l)=>i+l.edges,0);return e!==0?this.acc.div(e)._round():new Le(0,0)}span(){return new Le(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0)}}class gh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new je,this.centroidVertexArray=new Ds,this.indexArray=new _t,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new Ui,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=e.enableTerrain}populate(e,i,l,h){this.features=[],this.hasPattern=If("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/yt/(1<<f.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:m,index:x,sourceLayerIndex:w}of e){const E=this.layers[0]._featureFilter.needGeometry,A=va(f,E);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),A,l))continue;const P={id:m,sourceLayerIndex:w,index:x,geometry:E?A.geometry:Ir(f,l,h),properties:f.properties,type:f.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(Pf("fill-extrusion",this.layers,P,this.zoom,i)):this.addFeature(P,P.geometry,x,l,{},i.availableImages,h),i.featureIndex.insert(f,P.geometry,x,w,this.index,D)}this.sortBorders()}addFeatures(e,i,l,h,f){for(const m of this.features){const{geometry:x}=m;this.addFeature(m,x,m.index,i,l,h,f)}this.sortBorders()}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ob),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,rb.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,sb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,h,f,m,x){const w=[new Le(0,0),new Le(yt,yt)],E=x.projection,A=E.name==="globe",P=this.enableTerrain&&!A?new fg:null,D=fb[e.type]==="Polygon";A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Xe);const O=Cf(i,500);for(let ee=O.length-1;ee>=0;ee--){const le=O[ee];(le.length===0||(B=le[0]).every(te=>te.x<=0)||B.every(te=>te.x>=yt)||B.every(te=>te.y<=0)||B.every(te=>te.y>=yt))&&O.splice(ee,1)}var B;let V;if(A)V=bg(O,w,h);else{V=[];for(const ee of O)V.push({polygon:ee,bounds:w})}const W=D?this.edgeRadius:0;for(const{polygon:ee,bounds:le}of V){let te=0,oe=0;for(const ue of ee)D&&!ue[0].equals(ue[ue.length-1])&&ue.push(ue[0]),oe+=D?ue.length-1:ue.length;const de=this.segments.prepareSegment((D?5:4)*oe,this.layoutVertexArray,this.indexArray);if(D){const ue=[],Ce=[];te=de.vertexLength;for(const Be of ee){let He,Pe;Be.length&&Be!==ee[0]&&Ce.push(ue.length/2),He=Be[1].sub(Be[0])._perp()._unit();for(let Ve=1;Ve<Be.length;Ve++){const Ue=Be[Ve],$e=Be[Ve===Be.length-1?1:Ve+1];let{x:Qe,y:ze}=Ue;if(W){Pe=$e.sub(Ue)._perp()._unit();const rt=He.add(Pe)._unit(),pt=W*Math.min(4,1/(He.x*rt.x+He.y*rt.y));Qe+=pt*rt.x,ze+=pt*rt.y,He=Pe}_h(this.layoutVertexArray,Qe,ze,0,0,1,1,0),de.vertexLength++,ue.push(Ue.x,Ue.y),A&&mh(this.layoutVertexExtArray,E.projectTilePoint(Qe,ze,h),E.upVector(h,Qe,ze))}}const Se=Af(ue,Ce);for(let Be=0;Be<Se.length;Be+=3)this.indexArray.emplaceBack(te+Se[Be],te+Se[Be+2],te+Se[Be+1]),de.primitiveLength++}for(const ue of ee){P&&ue.length&&P.startRing(ue[0]);let Ce,Se,Be,He=ue.length>4&&yg(ue[ue.length-2],ue[0],ue[1]),Pe=W?mb(ue[ue.length-2],ue[0],ue[1],W):0;Se=ue[1].sub(ue[0])._perp()._unit();let Ve=!0;for(let Ue=1,$e=0;Ue<ue.length;Ue++){let Qe=ue[Ue-1],ze=ue[Ue];const rt=ue[Ue===ue.length-1?1:Ue+1];if(P&&D&&P.currentPolyCount.top++,gg(ze,Qe,le)){W&&(Se=rt.sub(ze)._perp()._unit(),Ve=!Ve);continue}P&&P.append(ze,Qe);const pt=ze.sub(Qe)._perp(),ot=pt.x/(Math.abs(pt.x)+Math.abs(pt.y)),Tt=pt.y>0?1:0,et=Qe.dist(ze);if($e+et>32768&&($e=0),W){Be=rt.sub(ze)._perp()._unit();let St=mg(Qe,ze,rt,_g(Se,Be),W);isNaN(St)&&(St=0);const vt=ze.sub(Qe)._unit();Qe=Qe.add(vt.mult(Pe))._round(),ze=ze.add(vt.mult(-St))._round(),Pe=St,Se=Be}const gt=de.vertexLength,Et=ue.length>4&&yg(Qe,ze,rt);let qt=xg($e,He,Ve);if(_h(this.layoutVertexArray,Qe.x,Qe.y,ot,Tt,0,0,qt),_h(this.layoutVertexArray,Qe.x,Qe.y,ot,Tt,0,1,qt),$e+=et,qt=xg($e,Et,!Ve),He=Et,_h(this.layoutVertexArray,ze.x,ze.y,ot,Tt,0,0,qt),_h(this.layoutVertexArray,ze.x,ze.y,ot,Tt,0,1,qt),de.vertexLength+=4,this.indexArray.emplaceBack(gt+0,gt+1,gt+2),this.indexArray.emplaceBack(gt+1,gt+3,gt+2),de.primitiveLength+=2,W){const St=te+(Ue===1?ue.length-2:Ue-2),vt=Ue===1?te:St+1;if(this.indexArray.emplaceBack(gt+1,St,gt+3),this.indexArray.emplaceBack(St,vt,gt+3),de.primitiveLength+=2,Ce===void 0&&(Ce=gt),!gg(rt,ue[Ue],le)){const fi=Ue===ue.length-1?Ce:de.vertexLength;this.indexArray.emplaceBack(gt+2,gt+3,fi),this.indexArray.emplaceBack(gt+3,fi+1,fi),this.indexArray.emplaceBack(gt+3,vt,fi+1),de.primitiveLength+=3}Ve=!Ve}if(A){const St=this.layoutVertexExtArray,vt=E.projectTilePoint(Qe.x,Qe.y,h),fi=E.projectTilePoint(ze.x,ze.y,h),Ct=E.upVector(h,Qe.x,Qe.y),It=E.upVector(h,ze.x,ze.y);mh(St,vt,Ct),mh(St,vt,Ct),mh(St,fi,It),mh(St,fi,It)}}D&&(te+=ue.length-1)}}if(P&&P.polyCount.length>0){if(P.borders){P.vertexArrayOffset=this.centroidVertexArray.length;const ee=P.borders,le=this.featuresOnBorder.push(P)-1;for(let te=0;te<4;te++)ee[te][0]!==Number.MAX_VALUE&&this.borders[te].push(le)}this.encodeCentroid(P.borders?void 0:P.centroid(),P)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,m,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}encodeCentroid(e,i,l=!0){let h,f;if(e)if(e.y!==0){const x=i.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(e.x+450)),f=0;else h=0,f=+l;let m=l?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(m++,h,f);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,h,f)}}}function _g(t,e){const i=t.add(e)._unit();return t.x*i.x+t.y*i.y}function mb(t,e,i,l){const h=e.sub(t)._perp()._unit(),f=i.sub(e)._perp()._unit();return mg(t,e,i,_g(h,f),l)}function mg(t,e,i,l,h){const f=Math.sqrt(1-l*l);return Math.min(t.dist(e)/3,e.dist(i)/3,h*f/l)}function gg(t,e,i){return t.x<i[0].x&&e.x<i[0].x||t.x>i[1].x&&e.x>i[1].x||t.y<i[0].y&&e.y<i[0].y||t.y>i[1].y&&e.y>i[1].y}function yg(t,e,i){if(t.x<0||t.x>=yt||e.x<0||e.x>=yt||i.x<0||i.x>=yt)return!1;const l=i.sub(e),h=l.perp(),f=t.sub(e);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&h.x*f.x+h.y*f.y<0}function xg(t,e,i){const l=e?2|t:-3&t;return i?1|l:-2&l}function vg(){const t=Math.PI/32,e=Math.tan(t),i=hh;return i*Math.sqrt(1+2*e*e)-i}function bg(t,e,i){const l=1<<i.z,h=ss(i.x/l),f=ss((i.x+1)/l),m=fn(i.y/l),x=fn((i.y+1)/l);return function(w,E,A,P,D=0,O){const B=[];if(!w.length||!A||!P)return B;const V=(ue,Ce)=>{for(const Se of ue)B.push({polygon:Se,bounds:Ce})},W=Math.ceil(Math.log2(A)),ee=Math.ceil(Math.log2(P)),le=W-ee,te=[];for(let ue=0;ue<Math.abs(le);ue++)te.push(le>0?0:1);for(let ue=0;ue<Math.min(W,ee);ue++)te.push(0),te.push(1);let oe=w;if(oe=md(oe,E[0].y-D,E[1].y+D,1),oe=md(oe,E[0].x-D,E[1].x+D,0),!oe.length)return B;const de=[];for(te.length?de.push({polygons:oe,bounds:E,depth:0}):V(oe,E);de.length;){const ue=de.pop(),Ce=ue.depth,Se=te[Ce],Be=ue.bounds[0],He=ue.bounds[1],Pe=Se===0?Be.x:Be.y,Ve=Se===0?He.x:He.y,Ue=O?O(Se,Pe,Ve):.5*(Pe+Ve),$e=md(ue.polygons,Pe-D,Ue+D,Se),Qe=md(ue.polygons,Ue-D,Ve+D,Se);if($e.length){const ze=[Be,new Le(Se===0?Ue:He.x,Se===1?Ue:He.y)];te.length>Ce+1?de.push({polygons:$e,bounds:ze,depth:Ce+1}):V($e,ze)}if(Qe.length){const ze=[new Le(Se===0?Ue:Be.x,Se===1?Ue:Be.y),He];te.length>Ce+1?de.push({polygons:Qe,bounds:ze,depth:Ce+1}):V(Qe,ze)}}return B}(t,e,Math.ceil((f-h)/11.25),Math.ceil((m-x)/11.25),1,(w,E,A)=>{if(w===0)return .5*(E+A);{const P=fn((i.y+E/yt)/l);return(tr(.5*(fn((i.y+A/yt)/l)+P))*l-i.y)*yt}})}ht(gh,"FillExtrusionBucket",{omit:["layers","features"]}),ht(fg,"PartMetadata");const gb=new se({"fill-extrusion-edge-radius":new j(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var yb={paint:new se({"fill-extrusion-opacity":new j(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Z(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new j(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new j(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Z(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Z(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Z(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new j(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new j(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new j(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new j(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:gb};function wg(t,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[t*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}class gd{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=yh(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const l=function(f,m,x){var w=wg(256*f,256*(m=Math.pow(2,x)-m-1),x),E=wg(256*(f+1),256*(m+1),x);return w[0]+","+w[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),h=function(f,m,x){let w,E="";for(let A=f;A>0;A--)w=1<<A-1,E+=(m&w?1:0)+(x&w?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Tg{constructor(e,i){this.wrap=e,this.canonical=i,this.key=yh(e,i.z,i.z,i.x,i.y)}}class An{constructor(e,i,l,h,f){this.overscaledZ=e,this.wrap=i,this.canonical=new gd(l,+h,+f),this.key=i===0&&e===l?this.canonical.key:yh(i,e,l,h,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new An(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new An(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return yh(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return yh(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new An(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new An(i,this.wrap,i,l,h),new An(i,this.wrap,i,l+1,h),new An(i,this.wrap,i,l,h+1),new An(i,this.wrap,i,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new An(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new An(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function yh(t,e,i,l,h){const f=1<<Math.min(i,22);let m=f*(h%f)+l%f;return t&&i<22&&(m+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}ht(gd,"CanonicalTileID"),ht(An,"OverscaledTileID",{omit:["projMatrix"]});class Dl extends Le{constructor(e,i,l){super(e,i),this.z=l}}function xh(t,e){return t.x*e.x+t.y*e.y}function Eg(t,e){if(t.length===1){let i=0;const l=e[i++];let h;for(;!h||l.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const f=e[i],m=t[0],x=h.sub(l),w=f.sub(l),E=m.sub(l),A=xh(x,x),P=xh(x,w),D=xh(w,w),O=xh(E,x),B=xh(E,w),V=A*D-P*P,W=(D*O-P*B)/V,ee=(A*B-P*O)/V,le=l.z*(1-W-ee)+h.z*W+f.z*ee;if(isFinite(le))return le}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function Sg(t,e,i,l,h,f,m,x){const w=m*h.getElevationAt(t,e,!0,!0),E=f[0]!==0,A=E?f[1]===0?m*(f[0]/7-450):m*function(P,D,O){const B=Math.floor(D[0]/8),V=Math.floor(D[1]/8),W=10*(D[0]-8*B),ee=10*(D[1]-8*V),le=P.getElevationAt(B,V,!0,!0),te=P.getMeterToDEM(O),oe=Math.floor(.5*(W*te-1)),de=Math.floor(.5*(ee*te-1)),ue=P.tileCoordToPixel(B,V),Ce=2*oe+1,Se=2*de+1,Be=function(Qe,ze,rt,pt,ot){return[Qe.getElevationAtPixel(ze,rt,!0),Qe.getElevationAtPixel(ze+ot,rt,!0),Qe.getElevationAtPixel(ze,rt+ot,!0),Qe.getElevationAtPixel(ze+pt,rt+ot,!0)]}(P,ue.x-oe,ue.y-de,Ce,Se),He=Math.abs(Be[0]-Be[1]),Pe=Math.abs(Be[2]-Be[3]),Ve=Math.abs(Be[0]-Be[2])+Math.abs(Be[1]-Be[3]),Ue=Math.min(.25,.5*te*(He+Pe)/Ce),$e=Math.min(.25,.5*te*Ve/Se);return le+Math.max(Ue*W,$e*ee)}(h,f,x):w;return{base:w+(i===0)?-1:i,top:E?Math.max(A+l,w+i+2):w+l}}const xb=xe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:vb}=xb,bb=xe([{name:"a_packed",components:4,type:"Float32"}]),{members:wb}=bb,Tb=_d.types,Eb=Math.cos(Math.PI/180*37.5);class yd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Ie,this.layoutVertexArray2=new qe,this.indexArray=new _t,this.programConfigurations=new fa(e.layers,e.zoom),this.segments=new Ui,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,l,h){this.hasPattern=If("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:A,id:P,index:D,sourceLayerIndex:O}of e){const B=this.layers[0]._featureFilter.needGeometry,V=va(A,B);if(!this.layers[0]._featureFilter.filter(new C(this.zoom),V,l))continue;const W=f?f.evaluate(V,{},l):void 0,ee={id:P,properties:A.properties,type:A.type,sourceLayerIndex:O,index:D,geometry:B?V.geometry:Ir(A,l,h),patterns:{},sortKey:W};m.push(ee)}f&&m.sort((A,P)=>A.sortKey-P.sortKey);const{lineAtlas:x,featureIndex:w}=i,E=this.addConstantDashes(x);for(const A of m){const{geometry:P,index:D,sourceLayerIndex:O}=A;if(E&&this.addFeatureDashes(A,x),this.hasPattern){const B=Pf("line",this.layers,A,this.zoom,i);this.patternFeatures.push(B)}else this.addFeature(A,P,D,l,x.positions,i.availableImages);w.insert(e[D].feature,P,D,O,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(h.kind!=="constant"||f.kind!=="constant")i=!0;else{const m=f.value,x=h.value;if(!x)continue;e.addDash(x,m)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let x,w;if(f.kind==="constant"){if(x=f.value,!x)continue}else x=f.evaluate({zoom:l},e);w=m.kind==="constant"?m.value:m.evaluate({zoom:l},e),i.addDash(x,w),e.patterns[h.id]=i.getKey(x,w)}}update(e,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,l,h)}addFeatures(e,i,l,h,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,wb)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,vb),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,l,h,f,m){const x=this.layers[0].layout,w=x.get("line-join").evaluate(e,{}),E=x.get("line-cap").evaluate(e,{}),A=x.get("line-miter-limit"),P=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const D of i)this.addLine(D,e,w,E,A,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,m,h)}addLine(e,i,l,h,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<e.length-1;ee++)this.totalDistance+=e[ee].dist(e[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=Tb[i.type]==="Polygon";let w=e.length;for(;w>=2&&e[w-1].equals(e[w-2]);)w--;let E=0;for(;E<w-1&&e[E].equals(e[E+1]);)E++;if(w<(x?3:2))return;l==="bevel"&&(f=1.05);const A=this.overscaling<=16?15*yt/(512*this.overscaling):0,P=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let D,O,B,V,W;this.e1=this.e2=-1,x&&(D=e[w-2],W=e[E].sub(D)._unit()._perp());for(let ee=E;ee<w;ee++){if(B=ee===w-1?x?e[E+1]:void 0:e[ee+1],B&&e[ee].equals(B))continue;W&&(V=W),D&&(O=D),D=e[ee],W=B?B.sub(D)._unit()._perp():V,V=V||W;let le=V.add(W);le.x===0&&le.y===0||le._unit();const te=V.x*W.x+V.y*W.y,oe=le.x*W.x+le.y*W.y,de=oe!==0?1/oe:1/0,ue=2*Math.sqrt(2-2*oe),Ce=oe<Eb&&O&&B,Se=V.x*W.y-V.y*W.x>0;if(Ce&&ee>E){const Pe=D.dist(O);if(Pe>2*A){const Ve=D.sub(D.sub(O)._mult(A/Pe)._round());this.updateDistance(O,Ve),this.addCurrentVertex(Ve,V,0,0,P),O=Ve}}const Be=O&&B;let He=Be?l:x?"butt":h;if(Be&&He==="round"&&(de<m?He="miter":de<=2&&(He="fakeround")),He==="miter"&&de>f&&(He="bevel"),He==="bevel"&&(de>2&&(He="flipbevel"),de<f&&(He="miter")),O&&this.updateDistance(O,D),He==="miter")le._mult(de),this.addCurrentVertex(D,le,0,0,P);else if(He==="flipbevel"){if(de>100)le=W.mult(-1);else{const Pe=de*V.add(W).mag()/V.sub(W).mag();le._perp()._mult(Pe*(Se?-1:1))}this.addCurrentVertex(D,le,0,0,P),this.addCurrentVertex(D,le.mult(-1),0,0,P)}else if(He==="bevel"||He==="fakeround"){const Pe=-Math.sqrt(de*de-1),Ve=Se?Pe:0,Ue=Se?0:Pe;if(O&&this.addCurrentVertex(D,V,Ve,Ue,P),He==="fakeround"){const $e=Math.round(180*ue/Math.PI/20);for(let Qe=1;Qe<$e;Qe++){let ze=Qe/$e;if(ze!==.5){const pt=ze-.5;ze+=ze*pt*(ze-1)*((1.0904+te*(te*(3.55645-1.43519*te)-3.2452))*pt*pt+(.848013+te*(.215638*te-1.06021)))}const rt=W.sub(V)._mult(ze)._add(V)._unit()._mult(Se?-1:1);this.addHalfVertex(D,rt.x,rt.y,!1,Se,0,P)}}B&&this.addCurrentVertex(D,W,-Ve,-Ue,P)}else if(He==="butt")this.addCurrentVertex(D,le,0,0,P);else if(He==="square"){const Pe=O?1:-1;O||this.addCurrentVertex(D,le,Pe,Pe,P),this.addCurrentVertex(D,le,0,0,P),O&&this.addCurrentVertex(D,le,Pe,Pe,P)}else He==="round"&&(O&&(this.addCurrentVertex(D,V,0,0,P),this.addCurrentVertex(D,V,1,1,P,!0)),B&&(this.addCurrentVertex(D,W,-1,-1,P,!0),this.addCurrentVertex(D,W,0,0,P)));if(Ce&&ee<w-1){const Pe=D.dist(B);if(Pe>2*A){const Ve=D.add(B.sub(D)._mult(A/Pe)._round());this.updateDistance(D,Ve),this.addCurrentVertex(Ve,W,0,0,P),D=Ve}}}}addCurrentVertex(e,i,l,h,f,m=!1){const x=i.y*h-i.x,w=-i.y-i.x*h;this.addHalfVertex(e,i.x+i.y*l,i.y-i.x*l,m,!1,l,f),this.addHalfVertex(e,x,w,m,!0,-h,f)}addHalfVertex({x:e,y:i},l,h,f,m,x,w){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),m?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}ht(yd,"LineBucket",{omit:["layers","patternFeatures"]});const Sb=new se({"line-cap":new Z(Oe.layout_line["line-cap"]),"line-join":new Z(Oe.layout_line["line-join"]),"line-miter-limit":new j(Oe.layout_line["line-miter-limit"]),"line-round-limit":new j(Oe.layout_line["line-round-limit"]),"line-sort-key":new Z(Oe.layout_line["line-sort-key"])});var Mg={paint:new se({"line-opacity":new Z(Oe.paint_line["line-opacity"]),"line-color":new Z(Oe.paint_line["line-color"]),"line-translate":new j(Oe.paint_line["line-translate"]),"line-translate-anchor":new j(Oe.paint_line["line-translate-anchor"]),"line-width":new Z(Oe.paint_line["line-width"]),"line-gap-width":new Z(Oe.paint_line["line-gap-width"]),"line-offset":new Z(Oe.paint_line["line-offset"]),"line-blur":new Z(Oe.paint_line["line-blur"]),"line-dasharray":new Z(Oe.paint_line["line-dasharray"]),"line-pattern":new Z(Oe.paint_line["line-pattern"]),"line-gradient":new ne(Oe.paint_line["line-gradient"]),"line-trim-offset":new j(Oe.paint_line["line-trim-offset"])}),layout:Sb};const Ag=new class extends Z{possiblyEvaluate(t,e){return e=new C(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,i,l){return e=_i({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,i,l)}}(Mg.paint.properties["line-width"].specification);function Cg(t,e){return e>0?e+2*t:t}Ag.useIntegerZoom=!0;const Mb=xe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ab=xe([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Cb=xe([{name:"a_projected_pos",components:4,type:"Float32"}],4);xe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Ib=xe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Pb=xe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Ig=xe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),kb=xe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xe([{name:"triangle",components:3,type:"Uint16"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xe([{type:"Float32",name:"offsetX"}]),xe([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ln=24;const Fs=128;function Df(t,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new C(t+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=i;let f=0;for(;f<l.length&&l[f]<=t;)f++;f=Math.max(0,f-1);let m=f;for(;m<l.length&&l[m]<t+1;)m++;m=Math.min(l.length-1,m);const x=l[f],w=l[m];return i.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:i.evaluate(new C(x)),maxSize:i.evaluate(new C(w)),interpolationType:h}}}function xd(t,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:h}){return t.kind==="source"?l/Fs:t.kind==="composite"?Ut(l/Fs,h/Fs,i):e}function Ll(t,e){let i=0,l=0;if(t.kind==="constant")l=t.layoutSize;else if(t.kind!=="source"){const{interpolationType:h,minZoom:f,maxZoom:m}=t,x=h?bt(ds.interpolationFactor(h,e,f,m),0,1):0;t.kind==="camera"?l=Ut(t.minSize,t.maxSize,x):i=x}return{uSizeT:i,uSize:l}}var Db=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Fs,evaluateSizeForFeature:xd,evaluateSizeForZoom:Ll,getSizeData:Df});function Lb(t,e,i){return t.sections.forEach(l=>{l.text=function(h,f,m){const x=f.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),M.applyArabicShaping&&(h=M.applyArabicShaping(h)),h}(l.text,e,i)}),t}const vh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function zb(t){return t==="︶"||t==="﹈"||t==="︸"||t==="﹄"||t==="﹂"||t==="︾"||t==="︼"||t==="︺"||t==="︘"||t==="﹀"||t==="︐"||t==="︓"||t==="︔"||t==="｀"||t==="￣"||t==="︑"||t==="︒"}function Rb(t){return t==="︵"||t==="﹇"||t==="︷"||t==="﹃"||t==="﹁"||t==="︽"||t==="︻"||t==="︹"||t==="︗"||t==="︿"}var Pg=hi,kg=function(t,e,i,l,h){var f,m,x=8*h-l-1,w=(1<<x)-1,E=w>>1,A=-7,P=i?h-1:0,D=i?-1:1,O=t[e+P];for(P+=D,f=O&(1<<-A)-1,O>>=-A,A+=x;A>0;f=256*f+t[e+P],P+=D,A-=8);for(m=f&(1<<-A)-1,f>>=-A,A+=l;A>0;m=256*m+t[e+P],P+=D,A-=8);if(f===0)f=1-E;else{if(f===w)return m?NaN:1/0*(O?-1:1);m+=Math.pow(2,l),f-=E}return(O?-1:1)*m*Math.pow(2,f-l)},Dg=function(t,e,i,l,h,f){var m,x,w,E=8*f-h-1,A=(1<<E)-1,P=A>>1,D=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=l?0:f-1,B=l?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,m=A):(m=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-m))<1&&(m--,w*=2),(e+=m+P>=1?D/w:D*Math.pow(2,1-P))*w>=2&&(m++,w/=2),m+P>=A?(x=0,m=A):m+P>=1?(x=(e*w-1)*Math.pow(2,h),m+=P):(x=e*Math.pow(2,P-1)*Math.pow(2,h),m=0));h>=8;t[i+O]=255&x,O+=B,x/=256,h-=8);for(m=m<<h|x,E+=h;E>0;t[i+O]=255&m,O+=B,m/=256,E-=8);t[i+O-B]|=128*V};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function hi(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}hi.Varint=0,hi.Fixed64=1,hi.Bytes=2,hi.Fixed32=5;var Lf=4294967296,Lg=1/Lf,zg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function kr(t){return t.type===hi.Bytes?t.readVarint()+t.pos:t.pos+1}function zl(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Rg(t,e,i){var l=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(l);for(var h=i.pos-1;h>=t;h--)i.buf[h+l]=i.buf[h]}function Ob(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function Bb(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function Fb(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function Nb(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function jb(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function Vb(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function Ub(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function Gb(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function $b(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function vd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Rl(t,e,i){t[i]=e,t[i+1]=e>>>8,t[i+2]=e>>>16,t[i+3]=e>>>24}function Og(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}hi.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var l=this.readVarint(),h=l>>3,f=this.pos;this.type=7&l,t(h,e,this),this.pos===f&&this.skip(l)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=vd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Og(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=vd(this.buf,this.pos)+vd(this.buf,this.pos+4)*Lf;return this.pos+=8,t},readSFixed64:function(){var t=vd(this.buf,this.pos)+Og(this.buf,this.pos+4)*Lf;return this.pos+=8,t},readFloat:function(){var t=kg(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=kg(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,i,l=this.buf;return e=127&(i=l[this.pos++]),i<128?e:(e|=(127&(i=l[this.pos++]))<<7,i<128?e:(e|=(127&(i=l[this.pos++]))<<14,i<128?e:(e|=(127&(i=l[this.pos++]))<<21,i<128?e:function(h,f,m){var x,w,E=m.buf;if(x=(112&(w=E[m.pos++]))>>4,w<128||(x|=(127&(w=E[m.pos++]))<<3,w<128)||(x|=(127&(w=E[m.pos++]))<<10,w<128)||(x|=(127&(w=E[m.pos++]))<<17,w<128)||(x|=(127&(w=E[m.pos++]))<<24,w<128)||(x|=(1&(w=E[m.pos++]))<<31,w<128))return zl(h,x,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=l[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&zg?function(i,l,h){return zg.decode(i.subarray(l,h))}(this.buf,e,t):function(i,l,h){for(var f="",m=l;m<h;){var x,w,E,A=i[m],P=null,D=A>239?4:A>223?3:A>191?2:1;if(m+D>h)break;D===1?A<128&&(P=A):D===2?(192&(x=i[m+1]))==128&&(P=(31&A)<<6|63&x)<=127&&(P=null):D===3?(w=i[m+2],(192&(x=i[m+1]))==128&&(192&w)==128&&((P=(15&A)<<12|(63&x)<<6|63&w)<=2047||P>=55296&&P<=57343)&&(P=null)):D===4&&(w=i[m+2],E=i[m+3],(192&(x=i[m+1]))==128&&(192&w)==128&&(192&E)==128&&((P=(15&A)<<18|(63&x)<<12|(63&w)<<6|63&E)<=65535||P>=1114112)&&(P=null)),P===null?(P=65533,D=1):P>65535&&(P-=65536,f+=String.fromCharCode(P>>>10&1023|55296),P=56320|1023&P),f+=String.fromCharCode(P),m+=D}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==hi.Bytes)return t.push(this.readVarint(e));var i=kr(this);for(t=t||[];this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==hi.Bytes)return t.push(this.readSVarint());var e=kr(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==hi.Bytes)return t.push(this.readBoolean());var e=kr(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==hi.Bytes)return t.push(this.readFloat());var e=kr(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==hi.Bytes)return t.push(this.readDouble());var e=kr(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==hi.Bytes)return t.push(this.readFixed32());var e=kr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==hi.Bytes)return t.push(this.readSFixed32());var e=kr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==hi.Bytes)return t.push(this.readFixed64());var e=kr(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==hi.Bytes)return t.push(this.readSFixed64());var e=kr(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===hi.Varint)for(;this.buf[this.pos++]>127;);else if(e===hi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===hi.Fixed32)this.pos+=4;else{if(e!==hi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Rl(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Rl(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Rl(this.buf,-1&t,this.pos),Rl(this.buf,Math.floor(t*Lg),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Rl(this.buf,-1&t,this.pos),Rl(this.buf,Math.floor(t*Lg),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,i){var l,h;if(e>=0?(l=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(l=~(-e%4294967296))?l=l+1|0:(l=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(f,m,x){x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7)}(l,0,i),function(f,m){var x=(7&f)<<4;m.buf[m.pos++]|=x|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(h,i)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(l,h,f){for(var m,x,w=0;w<h.length;w++){if((m=h.charCodeAt(w))>55295&&m<57344){if(!x){m>56319||w+1===h.length?(l[f++]=239,l[f++]=191,l[f++]=189):x=m;continue}if(m<56320){l[f++]=239,l[f++]=191,l[f++]=189,x=m;continue}m=x-55296<<10|m-56320|65536,x=null}else x&&(l[f++]=239,l[f++]=191,l[f++]=189,x=null);m<128?l[f++]=m:(m<2048?l[f++]=m>>6|192:(m<65536?l[f++]=m>>12|224:(l[f++]=m>>18|240,l[f++]=m>>12&63|128),l[f++]=m>>6&63|128),l[f++]=63&m|128)}return f}(this.buf,t,this.pos);var i=this.pos-e;i>=128&&Rg(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(t){this.realloc(4),Dg(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Dg(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var l=this.pos-i;l>=128&&Rg(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeMessage:function(t,e,i){this.writeTag(t,hi.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ob,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Bb,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,jb,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Fb,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Nb,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Vb,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Ub,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,Gb,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,$b,e)},writeBytesField:function(t,e){this.writeTag(t,hi.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,hi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,hi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,hi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,hi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,hi.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,hi.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,hi.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,hi.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,hi.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var bd=Fe(Pg);const zf=3;function qb(t,e,i){e.glyphs=[],t===1&&i.readMessage(Wb,e)}function Wb(t,e,i){if(t===3){const{id:l,bitmap:h,width:f,height:m,left:x,top:w,advance:E}=i.readMessage(Zb,{});e.glyphs.push({id:l,bitmap:new Pr({width:f+2*zf,height:m+2*zf},h),metrics:{width:f,height:m,left:x,top:w,advance:E}})}else t===4?e.ascender=i.readSVarint():t===5&&(e.descender=i.readSVarint())}function Zb(t,e,i){t===1?e.id=i.readVarint():t===2?e.bitmap=i.readBytes():t===3?e.width=i.readVarint():t===4?e.height=i.readVarint():t===5?e.left=i.readSVarint():t===6?e.top=i.readSVarint():t===7&&(e.advance=i.readVarint())}const Bg=zf;function Rf(t){let e=0,i=0;for(const m of t)e+=m.w*m.h,i=Math.max(i,m.w);t.sort((m,x)=>x.h-m.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,f=0;for(const m of t)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,f=Math.max(f,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===w.w&&m.h===w.h){const E=l.pop();x<l.length&&(l[x]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(l.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:h,h:f,fill:e/(h*f)||0}}const Fn=1;class Of{constructor(e,{pixelRatio:i,version:l,stretchX:h,stretchY:f,content:m}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=f,this.content=m,this.version=l}get tl(){return[this.paddedRect.x+Fn,this.paddedRect.y+Fn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fn,this.paddedRect.y+this.paddedRect.h-Fn]}get displaySize(){return[(this.paddedRect.w-2*Fn)/this.pixelRatio,(this.paddedRect.h-2*Fn)/this.pixelRatio]}}class Fg{constructor(e,i){const l={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,l,f),this.addImages(i,h,f);const{w:m,h:x}=Rf(f),w=new Hn({width:m||1,height:x||1});for(const E in e){const A=e[E],P=l[E].paddedRect;Hn.copy(A.data,w,{x:0,y:0},{x:P.x+Fn,y:P.y+Fn},A.data)}for(const E in i){const A=i[E],P=h[E].paddedRect,D=P.x+Fn,O=P.y+Fn,B=A.data.width,V=A.data.height;Hn.copy(A.data,w,{x:0,y:0},{x:D,y:O},A.data),Hn.copy(A.data,w,{x:0,y:V-1},{x:D,y:O-1},{width:B,height:1}),Hn.copy(A.data,w,{x:0,y:0},{x:D,y:O+V},{width:B,height:1}),Hn.copy(A.data,w,{x:B-1,y:0},{x:D-1,y:O},{width:1,height:V}),Hn.copy(A.data,w,{x:0,y:0},{x:D+B,y:O},{width:1,height:V})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(e,i,l){for(const h in e){const f=e[h],m={x:0,y:0,w:f.data.width+2*Fn,h:f.data.height+2*Fn};l.push(m),i[h]=new Of(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>e.hasImage(l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in e.updatedImages)this.patchUpdatedImage(this.iconPositions[l],e.getImage(l),i),this.patchUpdatedImage(this.patternPositions[l],e.getImage(l),i)}patchUpdatedImage(e,i,l){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,f]=e.tl;l.update(i.data,void 0,{x:h,y:f})}}ht(Of,"ImagePosition"),ht(Fg,"ImageAtlas");const rs={horizontal:1,vertical:2,horizontalOnly:3},Ng=-17;class bh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const l=new bh;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new bh;return i.imageName=e,i}}class Ol{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const l=new Ol;for(let h=0;h<e.sections.length;h++){const f=e.sections[h];f.image?l.addImageSection(f):l.addTextSection(f,i)}return l}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(i,l){let h="";for(let f=0;f<i.length;f++){const m=i.charCodeAt(f+1)||null,x=i.charCodeAt(f-1)||null;h+=!l&&(m&&Yu(m)&&!vh[i[f+1]]||x&&Yu(x)&&!vh[i[f-1]])||!vh[i[f]]?i[f]:vh[i[f]]}return h}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&wd[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&wd[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new Ol;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(bh.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(l)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Ti("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(bh.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Ti("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Bf(t,e,i,l,h,f,m,x,w,E,A,P,D,O,B){const V=Ol.fromFeature(t,h);P===rs.vertical&&V.verticalizePunctuation(D);let W=[];const ee=function(ue,Ce,Se,Be,He,Pe){if(!ue)return[];const Ve=[],Ue=function(rt,pt,ot,Tt,et,gt){let Et=0;for(let qt=0;qt<rt.length();qt++){const St=rt.getSection(qt);Et+=jg(rt.getCharCode(qt),St,Tt,et,pt,gt)}return Et/Math.max(1,Math.ceil(Et/ot))}(ue,Ce,Se,Be,He,Pe),$e=ue.text.indexOf("​")>=0;let Qe=0;for(let rt=0;rt<ue.length();rt++){const pt=ue.getSection(rt),ot=ue.getCharCode(rt);if(wd[ot]||(Qe+=jg(ot,pt,Be,He,Ce,Pe)),rt<ue.length()-1){const Tt=!((ze=ot)<11904||!(at["Bopomofo Extended"](ze)||at.Bopomofo(ze)||at["CJK Compatibility Forms"](ze)||at["CJK Compatibility Ideographs"](ze)||at["CJK Compatibility"](ze)||at["CJK Radicals Supplement"](ze)||at["CJK Strokes"](ze)||at["CJK Symbols and Punctuation"](ze)||at["CJK Unified Ideographs Extension A"](ze)||at["CJK Unified Ideographs"](ze)||at["Enclosed CJK Letters and Months"](ze)||at["Halfwidth and Fullwidth Forms"](ze)||at.Hiragana(ze)||at["Ideographic Description Characters"](ze)||at["Kangxi Radicals"](ze)||at["Katakana Phonetic Extensions"](ze)||at.Katakana(ze)||at["Vertical Forms"](ze)||at["Yi Radicals"](ze)||at["Yi Syllables"](ze)));(Hb[ot]||Tt||pt.imageName)&&Ve.push(Ug(rt+1,Qe,Ue,Ve,Xb(ot,ue.getCharCode(rt+1),Tt&&$e),!1))}}var ze;return Gg(Ug(ue.length(),Qe,Ue,Ve,0,!0))}(V,E,f,e,l,O),{processBidirectionalText:le,processStyledBidirectionalText:te}=M;if(le&&V.sections.length===1){const ue=le(V.toString(),ee);for(const Ce of ue){const Se=new Ol;Se.text=Ce,Se.sections=V.sections;for(let Be=0;Be<Ce.length;Be++)Se.sectionIndex.push(0);W.push(Se)}}else if(te){const ue=te(V.text,V.sectionIndex,ee);for(const Ce of ue){const Se=new Ol;Se.text=Ce[0],Se.sectionIndex=Ce[1],Se.sections=V.sections,W.push(Se)}}else W=function(ue,Ce){const Se=[],Be=ue.text;let He=0;for(const Pe of Ce)Se.push(ue.substring(He,Pe)),He=Pe;return He<Be.length&&Se.push(ue.substring(He,Be.length)),Se}(V,ee);const oe=[],de={positionedLines:oe,text:V.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:P,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ue,Ce,Se,Be,He,Pe,Ve,Ue,$e,Qe,ze,rt){let pt=0,ot=0,Tt=0;const et=Ue==="right"?1:Ue==="left"?0:.5;let gt=!1;for(const Ct of He){const It=Ct.getSections();for(const ai of It){if(ai.imageName)continue;const ui=Ce[ai.fontStack];if(ui&&(gt=ui.ascender!==void 0&&ui.descender!==void 0,!gt))break}if(!gt)break}let Et=0;for(const Ct of He){Ct.trim();const It=Ct.getMaxScale(),ai=(It-1)*ln,ui={positionedGlyphs:[],lineOffset:0};ue.positionedLines[Et]=ui;const di=ui.positionedGlyphs;let li=0;if(!Ct.length()){ot+=Pe,++Et;continue}let Si=0,Li=0;for(let ci=0;ci<Ct.length();ci++){const Xi=Ct.getSection(ci),qi=Ct.getSectionIndex(ci),Ai=Ct.getCharCode(ci);let Zt=Xi.scale,Wi=null,pi=null,Cn=null,Zi=ln,cn=0;const sn=!($e===rs.horizontal||!ze&&!Hc(Ai)||ze&&(wd[Ai]||(qt=Ai,at.Arabic(qt)||at["Arabic Supplement"](qt)||at["Arabic Extended-A"](qt)||at["Arabic Presentation Forms-A"](qt)||at["Arabic Presentation Forms-B"](qt))));if(Xi.imageName){const In=Be[Xi.imageName];if(!In)continue;Cn=Xi.imageName,ue.iconsInText=ue.iconsInText||!0,pi=In.paddedRect;const rn=In.displaySize;Zt=Zt*ln/rt,Wi={width:rn[0],height:rn[1],left:Fn,top:-Bg,advance:sn?rn[1]:rn[0],localGlyph:!1},cn=gt?-Wi.height*Zt:Ng+It*ln-rn[1]*Zt,Zi=Wi.advance;const Vs=(sn?rn[0]:rn[1])*Zt-ln*It;Vs>0&&Vs>li&&(li=Vs)}else{const In=Se[Xi.fontStack];if(!In)continue;In[Ai]&&(pi=In[Ai]);const rn=Ce[Xi.fontStack];if(!rn)continue;const Vs=rn.glyphs[Ai];if(!Vs)continue;if(Wi=Vs.metrics,Zi=Ai!==8203?ln:0,gt){const Gl=rn.ascender!==void 0?Math.abs(rn.ascender):0,kh=rn.descender!==void 0?Math.abs(rn.descender):0,Dh=(Gl+kh)*Zt;Si<Dh&&(Si=Dh,Li=(Gl-kh)/2*Zt),cn=-Gl*Zt}else cn=Ng+(It-Zt)*ln}sn?(ue.verticalizable=!0,di.push({glyph:Ai,imageName:Cn,x:pt,y:ot+cn,vertical:sn,scale:Zt,localGlyph:Wi.localGlyph,fontStack:Xi.fontStack,sectionIndex:qi,metrics:Wi,rect:pi}),pt+=Zi*Zt+Qe):(di.push({glyph:Ai,imageName:Cn,x:pt,y:ot+cn,vertical:sn,scale:Zt,localGlyph:Wi.localGlyph,fontStack:Xi.fontStack,sectionIndex:qi,metrics:Wi,rect:pi}),pt+=Wi.advance*Zt+Qe)}di.length!==0&&(Tt=Math.max(pt-Qe,Tt),gt?$g(di,et,li,Li,Pe*It/2):$g(di,et,li,0,Pe/2)),pt=0;const $i=Pe*It+li;ui.lineOffset=Math.max(li,ai),ot+=$i,++Et}var qt;const St=ot,{horizontalAlign:vt,verticalAlign:fi}=Ff(Ve);(function(Ct,It,ai,ui,di,li){const Si=(It-ai)*di,Li=-li*ui;for(const $i of Ct)for(const ci of $i.positionedGlyphs)ci.x+=Si,ci.y+=Li})(ue.positionedLines,et,vt,fi,Tt,St),ue.top+=-fi*St,ue.bottom=ue.top+St,ue.left+=-vt*Tt,ue.right=ue.left+Tt,ue.hasBaseline=gt}(de,e,i,l,W,m,x,w,P,E,D,B),!function(ue){for(const Ce of ue)if(Ce.positionedGlyphs.length!==0)return!1;return!0}(oe)&&de}const wd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Hb={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jg(t,e,i,l,h,f){if(e.imageName){const m=l[e.imageName];return m?m.displaySize[0]*e.scale*ln/f+h:0}{const m=i[e.fontStack],x=m&&m.glyphs[t];return x?x.metrics.advance*e.scale+h:0}}function Vg(t,e,i,l){const h=Math.pow(t-e,2);return l?t<e?h/2:2*h:h+Math.abs(i)*i}function Xb(t,e,i){let l=0;return t===10&&(l-=1e4),i&&(l+=150),t!==40&&t!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function Ug(t,e,i,l,h,f){let m=null,x=Vg(e,i,h,f);for(const w of l){const E=Vg(e-w.x,i,h,f)+w.badness;E<=x&&(m=w,x=E)}return{index:t,x:e,priorBreak:m,badness:x}}function Gg(t){return t?Gg(t.priorBreak).concat(t.index):[]}function Ff(t){let e=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function $g(t,e,i,l,h){if(!(e||i||l||h))return;const f=t.length-1,m=t[f],x=(m.x+m.metrics.advance*m.scale)*e;for(let w=0;w<=f;w++)t[w].x-=x,t[w].y+=i+l+h}function Yb(t,e,i){const{horizontalAlign:l,verticalAlign:h}=Ff(i),f=e[0]-t.displaySize[0]*l,m=e[1]-t.displaySize[1]*h;return{image:t,top:m,bottom:m+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function qg(t,e,i,l,h,f){const m=t.image;let x;if(m.content){const W=m.content,ee=m.pixelRatio||1;x=[W[0]/ee,W[1]/ee,m.displaySize[0]-W[2]/ee,m.displaySize[1]-W[3]/ee]}const w=e.left*f,E=e.right*f;let A,P,D,O;i==="width"||i==="both"?(O=h[0]+w-l[3],P=h[0]+E+l[1]):(O=h[0]+(w+E-m.displaySize[0])/2,P=O+m.displaySize[0]);const B=e.top*f,V=e.bottom*f;return i==="height"||i==="both"?(A=h[1]+B-l[0],D=h[1]+V+l[2]):(A=h[1]+(B+V-m.displaySize[1])/2,D=A+m.displaySize[1]),{image:m,top:A,right:P,bottom:D,left:O,collisionPadding:x}}class Dr extends Le{constructor(e,i,l,h,f){super(e,i),this.angle=h,this.z=l,f!==void 0&&(this.segment=f)}clone(){return new Dr(this.x,this.y,this.z,this.angle,this.segment)}}function Wg(t,e,i,l,h){if(e.segment===void 0)return!0;let f=e,m=e.segment+1,x=0;for(;x>-i/2;){if(m--,m<0)return!1;x-=t[m].dist(f),f=t[m]}x+=t[m].dist(t[m+1]),m++;const w=[];let E=0;for(;x<i/2;){const A=t[m],P=t[m+1];if(!P)return!1;let D=t[m-1].angleTo(A)-A.angleTo(P);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:D}),E+=D;x-w[0].distance>l;)E-=w.shift().angleDelta;if(E>h)return!1;m++,x+=A.dist(P)}return!0}function Zg(t){let e=0;for(let i=0;i<t.length-1;i++)e+=t[i].dist(t[i+1]);return e}function Hg(t,e,i){return t?.6*e*i:0}function Xg(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Kb(t,e,i,l,h,f){const m=Hg(i,h,f),x=Xg(i,l)*f;let w=0;const E=Zg(t)/2;for(let A=0;A<t.length-1;A++){const P=t[A],D=t[A+1],O=P.dist(D);if(w+O>E){const B=(E-w)/O,V=Ut(P.x,D.x,B),W=Ut(P.y,D.y,B),ee=new Dr(V,W,0,D.angleTo(P),A);return!m||Wg(t,ee,x,m,e)?ee:void 0}w+=O}}function Jb(t,e,i,l,h,f,m,x,w){const E=Hg(l,f,m),A=Xg(l,h),P=A*m,D=t[0].x===0||t[0].x===w||t[0].y===0||t[0].y===w;return e-P<e/4&&(e=P+e/4),Yg(t,D?e/2*x%e:(A/2+2*f)*m*x%e,e,E,i,P,D,!1,w)}function Yg(t,e,i,l,h,f,m,x,w){const E=f/2,A=Zg(t);let P=0,D=e-i,O=[];for(let B=0;B<t.length-1;B++){const V=t[B],W=t[B+1],ee=V.dist(W),le=W.angleTo(V);for(;D+i<P+ee;){D+=i;const te=(D-P)/ee,oe=Ut(V.x,W.x,te),de=Ut(V.y,W.y,te);if(oe>=0&&oe<w&&de>=0&&de<w&&D-E>=0&&D+E<=A){const ue=new Dr(oe,de,0,le,B);ue._round(),l&&!Wg(t,ue,f,l,h)||O.push(ue)}}P+=ee}return x||O.length||m||(O=Yg(t,P/2,i,l,h,f,m,!0,w)),O}function Kg(t,e,i,l,h){const f=[];for(let m=0;m<t.length;m++){const x=t[m];let w;for(let E=0;E<x.length-1;E++){let A=x[E],P=x[E+1];A.x<e&&P.x<e||(A.x<e?A=new Le(e,A.y+(e-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x<e&&(P=new Le(e,A.y+(e-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y<i&&P.y<i||(A.y<i?A=new Le(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round():P.y<i&&(P=new Le(A.x+(i-A.y)/(P.y-A.y)*(P.x-A.x),i)._round()),A.x>=l&&P.x>=l||(A.x>=l?A=new Le(l,A.y+(l-A.x)/(P.x-A.x)*(P.y-A.y))._round():P.x>=l&&(P=new Le(l,A.y+(l-A.x)/(P.x-A.x)*(P.y-A.y))._round()),A.y>=h&&P.y>=h||(A.y>=h?A=new Le(A.x+(h-A.y)/(P.y-A.y)*(P.x-A.x),h)._round():P.y>=h&&(P=new Le(A.x+(h-A.y)/(P.y-A.y)*(P.x-A.x),h)._round()),w&&A.equals(w[w.length-1])||(w=[A],f.push(w)),w.push(P)))))}}return f}ht(Dr,"Anchor");const wh=1e20;function Jg(t,e,i,l,h,f,m,x,w){for(let E=e;E<e+l;E++)Qg(t,i*f+E,f,h,m,x,w);for(let E=i;E<i+h;E++)Qg(t,E*f+e,1,l,m,x,w)}function Qg(t,e,i,l,h,f,m){f[0]=0,m[0]=-wh,m[1]=wh,h[0]=t[e];for(let x=1,w=0,E=0;x<l;x++){h[x]=t[e+x*i];const A=x*x;do{const P=f[w];E=(h[x]-h[P]+A-P*P)/(x-P)/2}while(E<=m[w]&&--w>-1);w++,f[w]=x,m[w]=E,m[w+1]=wh}for(let x=0,w=0;x<l;x++){for(;m[w+1]<x;)w++;const E=f[w],A=x-E;t[e+x*i]=h[E]+A*A}}const Ns=2,Nf={none:0,ideographs:1,all:2};class Bl{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const l=[];for(const h in e)for(const f of e[h])l.push({stack:h,id:f});ki(l,({stack:h,id:f},m)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[f];if(w!==void 0)return void m(null,{stack:h,id:f,glyph:w});if(w=this._tinySDF(x,h,f),w)return x.glyphs[f]=w,void m(null,{stack:h,id:f,glyph:w});const E=Math.floor(f/256);if(256*E>65535)return void m(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void m(null,{stack:h,id:f,glyph:w});let A=x.requests[E];A||(A=x.requests[E]=[],Bl.loadGlyphRange(h,E,this.url,this.requestManager,(P,D)=>{if(D){x.ascender=D.ascender,x.descender=D.descender;for(const O in D.glyphs)this._doesCharSupportLocalGlyph(+O)||(x.glyphs[+O]=D.glyphs[+O]);x.ranges[E]=!0}for(const O of A)O(P,D);delete x.requests[E]})),A.push((P,D)=>{P?m(P):D&&m(null,{stack:h,id:f,glyph:D.glyphs[f]||null})})},(h,f)=>{if(h)i(h);else if(f){const m={};for(const{stack:x,id:w,glyph:E}of f)m[x]===void 0&&(m[x]={}),m[x].glyphs===void 0&&(m[x].glyphs={}),m[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},m[x].ascender=this.entries[x].ascender,m[x].descender=this.entries[x].descender;i(null,m)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Nf.none&&(this.localGlyphMode===Nf.all?!!this.localFontFamily:!!this.localFontFamily&&(at["CJK Unified Ideographs"](e)||at["Hangul Syllables"](e)||at.Hiragana(e)||at.Katakana(e)||at["CJK Symbols and Punctuation"](e)))}_tinySDF(e,i,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let f=e.tinySDF;if(!f){let V="400";/bold/i.test(i)?V="900":/medium/i.test(i)?V="500":/light/i.test(i)&&(V="200"),f=e.tinySDF=new Bl.TinySDF({fontFamily:h,fontWeight:V,fontSize:24*Ns,buffer:3*Ns,radius:8*Ns}),f.fontWeight=V}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const m=String.fromCharCode(l),{data:x,width:w,height:E,glyphWidth:A,glyphHeight:P,glyphLeft:D,glyphTop:O,glyphAdvance:B}=f.draw(m);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new Pr({width:w,height:E},x),metrics:{width:A/Ns,height:P/Ns,left:D/Ns,top:O/Ns-27,advance:B/Ns,localGlyph:!0}}}}Bl.loadGlyphRange=function(t,e,i,l,h){const f=256*e,m=f+255,x=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",t).replace("{range}",`${f}-${m}`),dr.Glyphs);qr(x,(w,E)=>{if(w)h(w);else if(E){const A={},P=function(D){return new bd(D).readFields(qb,{})}(E);for(const D of P.glyphs)A[D.id]=D;h(null,{glyphs:A,ascender:P.ascender,descender:P.descender})}})},Bl.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=i;const x=this.size=t+4*e,w=this._createCanvas(x),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${f} ${t}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(t),m=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),w=Math.min(this.size-this.buffer,m+Math.ceil(l)),E=x+2*this.buffer,A=w+2*this.buffer,P=Math.max(E*A,0),D=new Uint8ClampedArray(P),O={data:D,width:E,height:A,glyphWidth:x,glyphHeight:w,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(x===0||w===0)return O;const{ctx:B,buffer:V,gridInner:W,gridOuter:ee}=this;B.clearRect(V,V,x,w),B.fillText(t,V,V+m);const le=B.getImageData(V,V,x,w);ee.fill(wh,0,P),W.fill(0,0,P);for(let te=0;te<w;te++)for(let oe=0;oe<x;oe++){const de=le.data[4*(te*x+oe)+3]/255;if(de===0)continue;const ue=(te+V)*E+oe+V;if(de===1)ee[ue]=0,W[ue]=wh;else{const Ce=.5-de;ee[ue]=Ce>0?Ce*Ce:0,W[ue]=Ce<0?Ce*Ce:0}}Jg(ee,0,0,E,A,E,this.f,this.v,this.z),Jg(W,V,V,x,w,E,this.f,this.v,this.z);for(let te=0;te<P;te++){const oe=Math.sqrt(ee[te])-Math.sqrt(W[te]);D[te]=Math.round(255-255*(oe/this.radius+this.cutoff))}return O}};const Fl=Fn;function e0(t,e,i,l){const h=[],f=t.image,m=f.pixelRatio,x=f.paddedRect.w-2*Fl,w=f.paddedRect.h-2*Fl,E=t.right-t.left,A=t.bottom-t.top,P=f.stretchX||[[0,x]],D=f.stretchY||[[0,w]],O=(Pe,Ve)=>Pe+Ve[1]-Ve[0],B=P.reduce(O,0),V=D.reduce(O,0),W=x-B,ee=w-V;let le=0,te=B,oe=0,de=V,ue=0,Ce=W,Se=0,Be=ee;if(f.content&&l){const Pe=f.content;le=Td(P,0,Pe[0]),oe=Td(D,0,Pe[1]),te=Td(P,Pe[0],Pe[2]),de=Td(D,Pe[1],Pe[3]),ue=Pe[0]-le,Se=Pe[1]-oe,Ce=Pe[2]-Pe[0]-te,Be=Pe[3]-Pe[1]-de}const He=(Pe,Ve,Ue,$e)=>{const Qe=Ed(Pe.stretch-le,te,E,t.left),ze=Sd(Pe.fixed-ue,Ce,Pe.stretch,B),rt=Ed(Ve.stretch-oe,de,A,t.top),pt=Sd(Ve.fixed-Se,Be,Ve.stretch,V),ot=Ed(Ue.stretch-le,te,E,t.left),Tt=Sd(Ue.fixed-ue,Ce,Ue.stretch,B),et=Ed($e.stretch-oe,de,A,t.top),gt=Sd($e.fixed-Se,Be,$e.stretch,V),Et=new Le(Qe,rt),qt=new Le(ot,rt),St=new Le(ot,et),vt=new Le(Qe,et),fi=new Le(ze/m,pt/m),Ct=new Le(Tt/m,gt/m),It=e*Math.PI/180;if(It){const di=Math.sin(It),li=Math.cos(It),Si=[li,-di,di,li];Et._matMult(Si),qt._matMult(Si),vt._matMult(Si),St._matMult(Si)}const ai=Pe.stretch+Pe.fixed,ui=Ve.stretch+Ve.fixed;return{tl:Et,tr:qt,bl:vt,br:St,tex:{x:f.paddedRect.x+Fl+ai,y:f.paddedRect.y+Fl+ui,w:Ue.stretch+Ue.fixed-ai,h:$e.stretch+$e.fixed-ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:Ct,minFontScaleX:Ce/m/E,minFontScaleY:Be/m/A,isSDF:i}};if(l&&(f.stretchX||f.stretchY)){const Pe=t0(P,W,B),Ve=t0(D,ee,V);for(let Ue=0;Ue<Pe.length-1;Ue++){const $e=Pe[Ue],Qe=Pe[Ue+1];for(let ze=0;ze<Ve.length-1;ze++)h.push(He($e,Ve[ze],Qe,Ve[ze+1]))}}else h.push(He({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function Td(t,e,i){let l=0;for(const h of t)l+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return l}function t0(t,e,i){const l=[{fixed:-Fl,stretch:0}];for(const[h,f]of t){const m=l[l.length-1];l.push({fixed:h-m.stretch,stretch:m.stretch}),l.push({fixed:h-m.stretch,stretch:m.stretch+(f-h)})}return l.push({fixed:e+Fl,stretch:i}),l}function Ed(t,e,i,l){return t/e*i+l}function Sd(t,e,i,l){return t-e*i/l}function Qb(t,e,i,l){const h=e+t.positionedLines[l].lineOffset;return l===0?i+h/2:i+(h+(e+t.positionedLines[l-1].lineOffset))/2}class e2{constructor(e=[],i=t2){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,h=i[e];for(;e>0;){const f=e-1>>1,m=i[f];if(l(h,m)>=0)break;i[e]=m,e=f}i[e]=h}_down(e){const{data:i,compare:l}=this,h=this.length>>1,f=i[e];for(;e<h;){let m=1+(e<<1),x=i[m];const w=m+1;if(w<this.length&&l(i[w],x)<0&&(m=w,x=i[w]),l(x,f)>=0)break;i[e]=x,e=m}i[e]=f}}function t2(t,e){return t<e?-1:t>e?1:0}function i2(t,e=1,i=!1){let l=1/0,h=1/0,f=-1/0,m=-1/0;const x=t[0];for(let O=0;O<x.length;O++){const B=x[O];(!O||B.x<l)&&(l=B.x),(!O||B.y<h)&&(h=B.y),(!O||B.x>f)&&(f=B.x),(!O||B.y>m)&&(m=B.y)}const w=Math.min(f-l,m-h);let E=w/2;const A=new e2([],n2);if(w===0)return new Le(l,h);for(let O=l;O<f;O+=w)for(let B=h;B<m;B+=w)A.push(new Nl(O+E,B+E,E,t));let P=function(O){let B=0,V=0,W=0;const ee=O[0];for(let le=0,te=ee.length,oe=te-1;le<te;oe=le++){const de=ee[le],ue=ee[oe],Ce=de.x*ue.y-ue.x*de.y;V+=(de.x+ue.x)*Ce,W+=(de.y+ue.y)*Ce,B+=3*Ce}return new Nl(V/B,W/B,0,O)}(t),D=A.length;for(;A.length;){const O=A.pop();(O.d>P.d||!P.d)&&(P=O,i&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),O.max-P.d<=e||(E=O.h/2,A.push(new Nl(O.p.x-E,O.p.y-E,E,t)),A.push(new Nl(O.p.x+E,O.p.y-E,E,t)),A.push(new Nl(O.p.x-E,O.p.y+E,E,t)),A.push(new Nl(O.p.x+E,O.p.y+E,E,t)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${P.d}`)),P.p}function n2(t,e){return e.max-t.max}class Nl{constructor(e,i,l,h){this.p=new Le(e,i),this.h=l,this.d=function(f,m){let x=!1,w=1/0;for(let E=0;E<m.length;E++){const A=m[E];for(let P=0,D=A.length,O=D-1;P<D;O=P++){const B=A[P],V=A[O];B.y>f.y!=V.y>f.y&&f.x<(V.x-B.x)*(f.y-B.y)/(V.y-B.y)+B.x&&(x=!x),w=Math.min(w,Ym(f,B,V))}}return(x?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const jl=7,jf=Number.POSITIVE_INFINITY,s2=Math.sqrt(2);function i0(t,[e,i]){let l=0,h=0;if(i===jf){e<0&&(e=0);const f=e/s2;switch(t){case"top-right":case"top-left":h=f-jl;break;case"bottom-right":case"bottom-left":h=-f+jl;break;case"bottom":h=-e+jl;break;case"top":h=e-jl}switch(t){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),t){case"top-right":case"top-left":case"top":h=i-jl;break;case"bottom-right":case"bottom-left":case"bottom":h=-i+jl}switch(t){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,h]}function r2(t,e,i,l,h,f,m,x,w,E){t.createArrays(),t.tilePixelRatio=yt/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const A=t.layers[0].layout,P=t.layers[0]._unevaluatedLayout._values,D={};if(t.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:W}=t.textSizeData;D.compositeTextSizes=[P["text-size"].possiblyEvaluate(new C(V),x),P["text-size"].possiblyEvaluate(new C(W),x)]}if(t.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:W}=t.iconSizeData;D.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new C(V),x),P["icon-size"].possiblyEvaluate(new C(W),x)]}D.layoutTextSize=P["text-size"].possiblyEvaluate(new C(w+1),x),D.layoutIconSize=P["icon-size"].possiblyEvaluate(new C(w+1),x),D.textMaxSize=P["text-size"].possiblyEvaluate(new C(18),x);const O=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size");for(const V of t.features){const W=A.get("text-font").evaluate(V,{},x).join(","),ee=B.evaluate(V,{},x),le=D.layoutTextSize.evaluate(V,{},x),te=(D.layoutIconSize.evaluate(V,{},x),{horizontal:{},vertical:void 0}),oe=V.text;let de,ue=[0,0];if(oe){const Be=oe.toString(),He=A.get("text-letter-spacing").evaluate(V,{},x)*ln,Pe=A.get("text-line-height").evaluate(V,{},x)*ln,Ve=Hp(Be)?He:0,Ue=A.get("text-anchor").evaluate(V,{},x),$e=A.get("text-variable-anchor");if(!$e){const ot=A.get("text-radial-offset").evaluate(V,{},x);ue=ot?i0(Ue,[ot*ln,jf]):A.get("text-offset").evaluate(V,{},x).map(Tt=>Tt*ln)}let Qe=O?"center":A.get("text-justify").evaluate(V,{},x);const ze=A.get("symbol-placement")==="point",rt=ze?A.get("text-max-width").evaluate(V,{},x)*ln:1/0,pt=ot=>{t.allowVerticalPlacement&&Zc(Be)&&(te.vertical=Bf(oe,e,i,h,W,rt,Pe,Ue,ot,Ve,ue,rs.vertical,!0,le,ee))};if(!O&&$e){const ot=Qe==="auto"?$e.map(et=>Vf(et)):[Qe];let Tt=!1;for(let et=0;et<ot.length;et++){const gt=ot[et];if(!te.horizontal[gt])if(Tt)te.horizontal[gt]=te.horizontal[0];else{const Et=Bf(oe,e,i,h,W,rt,Pe,"center",gt,Ve,ue,rs.horizontal,!1,le,ee);Et&&(te.horizontal[gt]=Et,Tt=Et.positionedLines.length===1)}}pt("left")}else{if(Qe==="auto"&&(Qe=Vf(Ue)),ze||A.get("text-writing-mode").indexOf("horizontal")>=0||!Zc(Be)){const ot=Bf(oe,e,i,h,W,rt,Pe,Ue,Qe,Ve,ue,rs.horizontal,!1,le,ee);ot&&(te.horizontal[Qe]=ot)}pt(ze?"left":Qe)}}let Ce=!1;if(V.icon&&V.icon.name){const Be=l[V.icon.name];Be&&(de=Yb(h[V.icon.name],A.get("icon-offset").evaluate(V,{},x),A.get("icon-anchor").evaluate(V,{},x)),Ce=Be.sdf,t.sdfIcons===void 0?t.sdfIcons=Be.sdf:t.sdfIcons!==Be.sdf&&Ti("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==t.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}const Se=s0(te.horizontal)||te.vertical;t.iconsInText||(t.iconsInText=!!Se&&Se.iconsInText),(Se||de)&&o2(t,V,te,de,l,D,le,0,ue,Ce,m,x,E)}f&&t.generateCollisionDebugBuffers(w,t.collisionBoxArray)}function Vf(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function o2(t,e,i,l,h,f,m,x,w,E,A,P,D){let O=f.textMaxSize.evaluate(e,{},P);O===void 0&&(O=m);const B=t.layers[0].layout,V=B.get("icon-offset").evaluate(e,{},P),W=s0(i.horizontal)||i.vertical,ee=D.name==="globe",le=ln,te=m/le,oe=t.tilePixelRatio*O/le,de=(Ue=t.overscaling,t.zoom>18&&Ue>2&&(Ue>>=1),Math.max(yt/(512*Ue),1)*B.get("symbol-spacing")),ue=B.get("text-padding")*t.tilePixelRatio,Ce=B.get("icon-padding")*t.tilePixelRatio,Se=ft(B.get("text-max-angle")),Be=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",He=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Pe=B.get("symbol-placement"),Ve=de/2;var Ue;const $e=B.get("icon-text-fit");let Qe;l&&$e!=="none"&&(t.allowVerticalPlacement&&i.vertical&&(Qe=qg(l,i.vertical,$e,B.get("icon-text-fit-padding"),V,te)),W&&(l=qg(l,W,$e,B.get("icon-text-fit-padding"),V,te)));const ze=(rt,pt,ot)=>{if(pt.x<0||pt.x>=yt||pt.y<0||pt.y>=yt)return;let Tt=null;if(ee){const{x:et,y:gt,z:Et}=D.projectTilePoint(pt.x,pt.y,ot);Tt={anchor:new Dr(et,gt,Et,0,void 0),up:D.upVector(ot,pt.x,pt.y)}}(function(et,gt,Et,qt,St,vt,fi,Ct,It,ai,ui,di,li,Si,Li,$i,ci,Xi,qi,Ai,Zt,Wi,pi,Cn,Zi){const cn=et.addToLineVertexArray(gt,qt);let sn,In,rn,Vs,Gl,kh,Dh,B0=0,F0=0,N0=0,j0=0,i_=-1,n_=-1;const rr={};let V0=Kp("");const Sa=Et?Et.anchor:gt;let s_=0,r_=0;if(It._unevaluatedLayout.getValue("text-radial-offset")===void 0?[s_,r_]=It.layout.get("text-offset").evaluate(Zt,{},Zi).map(Xn=>Xn*ln):(s_=It.layout.get("text-radial-offset").evaluate(Zt,{},Zi)*ln,r_=jf),et.allowVerticalPlacement&&St.vertical){const Xn=St.vertical;if(Li)kh=Uf(Xn),Ct&&(Dh=Uf(Ct));else{const Yn=It.layout.get("text-rotate").evaluate(Zt,{},Zi)+90;rn=Md(ai,Sa,gt,ui,di,li,Xn,Si,Yn,$i),Ct&&(Vs=Md(ai,Sa,gt,ui,di,li,Ct,Xi,Yn))}}if(vt){const Xn=It.layout.get("icon-rotate").evaluate(Zt,{},Zi),Yn=It.layout.get("icon-text-fit")!=="none",Lh=e0(vt,Xn,pi,Yn),a_=Ct?e0(Ct,Xn,pi,Yn):void 0;In=Md(ai,Sa,gt,ui,di,li,vt,Xi,Xn),B0=4*Lh.length;const U0=et.iconSizeData;let Ma=null;U0.kind==="source"?(Ma=[Fs*It.layout.get("icon-size").evaluate(Zt,{},Zi)],Ma[0]>mo&&Ti(`${et.layerIds[0]}: Value for "icon-size" is >= ${Th}. Reduce your "icon-size".`)):U0.kind==="composite"&&(Ma=[Fs*Wi.compositeIconSizes[0].evaluate(Zt,{},Zi),Fs*Wi.compositeIconSizes[1].evaluate(Zt,{},Zi)],(Ma[0]>mo||Ma[1]>mo)&&Ti(`${et.layerIds[0]}: Value for "icon-size" is >= ${Th}. Reduce your "icon-size".`)),et.addSymbols(et.icon,Lh,Ma,Ai,qi,Zt,!1,Et,gt,cn.lineStartIndex,cn.lineLength,-1,Cn,Zi),i_=et.icon.placedSymbolArray.length-1,a_&&(F0=4*a_.length,et.addSymbols(et.icon,a_,Ma,Ai,qi,Zt,rs.vertical,Et,gt,cn.lineStartIndex,cn.lineLength,-1,Cn,Zi),n_=et.icon.placedSymbolArray.length-1)}for(const Xn in St.horizontal){const Yn=St.horizontal[Xn];sn||(V0=Kp(Yn.text),Li?Gl=Uf(Yn):sn=Md(ai,Sa,gt,ui,di,li,Yn,Si,It.layout.get("text-rotate").evaluate(Zt,{},Zi),$i));const Lh=Yn.positionedLines.length===1;if(N0+=n0(et,Et,gt,Yn,fi,It,Li,Zt,$i,cn,St.vertical?rs.horizontal:rs.horizontalOnly,Lh?Object.keys(St.horizontal):[Xn],rr,i_,Wi,Cn,Zi),Lh)break}St.vertical&&(j0+=n0(et,Et,gt,St.vertical,fi,It,Li,Zt,$i,cn,rs.vertical,["vertical"],rr,n_,Wi,Cn,Zi));let wo=-1;const o_=(Xn,Yn)=>Xn?Math.max(Xn,Yn):Yn;wo=o_(Gl,wo),wo=o_(kh,wo),wo=o_(Dh,wo);const z2=wo>-1?1:0;et.glyphOffsetArray.length>=yo.MAX_GLYPHS&&Ti("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zt.sortKey!==void 0&&et.addToSortKeyRanges(et.symbolInstances.length,Zt.sortKey),et.symbolInstances.emplaceBack(Sa.x,Sa.y,Sa.z,gt.x,gt.y,rr.right>=0?rr.right:-1,rr.center>=0?rr.center:-1,rr.left>=0?rr.left:-1,rr.vertical>=0?rr.vertical:-1,i_,n_,V0,sn!==void 0?sn:et.collisionBoxArray.length,sn!==void 0?sn+1:et.collisionBoxArray.length,rn!==void 0?rn:et.collisionBoxArray.length,rn!==void 0?rn+1:et.collisionBoxArray.length,In!==void 0?In:et.collisionBoxArray.length,In!==void 0?In+1:et.collisionBoxArray.length,Vs||et.collisionBoxArray.length,Vs?Vs+1:et.collisionBoxArray.length,ui,N0,j0,B0,F0,z2,0,s_,r_,wo)})(t,pt,Tt,rt,i,l,h,Qe,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ue,Be,w,0,Ce,He,V,e,f,E,A,P)};if(Pe==="line")for(const rt of Kg(e.geometry,0,0,yt,yt)){const pt=Jb(rt,de,Se,i.vertical||W,l,le,oe,t.overscaling,yt);for(const ot of pt)W&&a2(t,W.text,Ve,ot)||ze(rt,ot,P)}else if(Pe==="line-center"){for(const rt of e.geometry)if(rt.length>1){const pt=Kb(rt,Se,i.vertical||W,l,le,oe);pt&&ze(rt,pt,P)}}else if(e.type==="Polygon")for(const rt of Cf(e.geometry,0)){const pt=i2(rt,16);ze(rt[0],new Dr(pt.x,pt.y,0,0,void 0),P)}else if(e.type==="LineString")for(const rt of e.geometry)ze(rt,new Dr(rt[0].x,rt[0].y,0,0,void 0),P);else if(e.type==="Point")for(const rt of e.geometry)for(const pt of rt)ze([pt],new Dr(pt.x,pt.y,0,0,void 0),P)}const Th=255,mo=Th*Fs;function n0(t,e,i,l,h,f,m,x,w,E,A,P,D,O,B,V,W){const ee=function(oe,de,ue,Ce,Se,Be,He,Pe){const Ve=[];if(de.positionedLines.length===0)return Ve;const Ue=Ce.layout.get("text-rotate").evaluate(Be,{})*Math.PI/180,$e=function(ot){const Tt=ot[0],et=ot[1],gt=Tt*et;return gt>0?[Tt,-et]:gt<0?[-Tt,et]:Tt===0?[et,Tt]:[et,-Tt]}(ue);let Qe=Math.abs(de.top-de.bottom);for(const ot of de.positionedLines)Qe-=ot.lineOffset;const ze=de.positionedLines.length,rt=Qe/ze;let pt=de.top-ue[1];for(let ot=0;ot<ze;++ot){const Tt=de.positionedLines[ot];pt=Qb(de,rt,pt,ot);for(const et of Tt.positionedGlyphs){if(!et.rect)continue;const gt=et.rect||{};let Et=Bg+1,qt=!0,St=1,vt=0;if(et.imageName){const pi=He[et.imageName];if(!pi)continue;if(pi.sdf){Ti("SDF images are not supported in formatted text and will be ignored.");continue}qt=!1,St=pi.pixelRatio,Et=Fn/St}const fi=(Se||Pe)&&et.vertical,Ct=et.metrics.advance*et.scale/2,It=et.metrics,ai=et.rect;if(ai===null)continue;Pe&&de.verticalizable&&(vt=et.imageName?Ct-et.metrics.width*et.scale/2:0);const ui=Se?[et.x+Ct,et.y]:[0,0];let di=[0,0],li=[0,0],Si=!1;Se||(fi?(li=[et.x+Ct+$e[0],et.y+$e[1]-vt],Si=!0):di=[et.x+Ct+ue[0],et.y+ue[1]-vt]);const Li=ai.w*et.scale/(St*(et.localGlyph?Ns:1)),$i=ai.h*et.scale/(St*(et.localGlyph?Ns:1));let ci,Xi,qi,Ai;if(fi){const pi=et.y-pt,Cn=new Le(-Ct,Ct-pi),Zi=-Math.PI/2,cn=new Le(...li);ci=new Le(-Ct+di[0],di[1]),ci._rotateAround(Zi,Cn)._add(cn),ci.x+=-pi+Ct,ci.y-=(It.left-Et)*et.scale;const sn=et.imageName?It.advance*et.scale:ln*et.scale,In=String.fromCharCode(et.glyph);zb(In)?ci.x+=(1-Et)*et.scale:Rb(In)?ci.x+=sn-It.height*et.scale+(-Et-1)*et.scale:ci.x+=et.imageName||It.width+2*Et===ai.w&&It.height+2*Et===ai.h?(sn-$i)/2:(sn-(It.height+2*Et)*et.scale)/2,Xi=new Le(ci.x,ci.y-Li),qi=new Le(ci.x+$i,ci.y),Ai=new Le(ci.x+$i,ci.y-Li)}else{const pi=(It.left-Et)*et.scale-Ct+di[0],Cn=(-It.top-Et)*et.scale+di[1],Zi=pi+Li,cn=Cn+$i;ci=new Le(pi,Cn),Xi=new Le(Zi,Cn),qi=new Le(pi,cn),Ai=new Le(Zi,cn)}if(Ue){let pi;pi=Se?new Le(0,0):Si?new Le($e[0],$e[1]):new Le(ue[0],ue[1]),ci._rotateAround(Ue,pi),Xi._rotateAround(Ue,pi),qi._rotateAround(Ue,pi),Ai._rotateAround(Ue,pi)}const Zt=new Le(0,0),Wi=new Le(0,0);Ve.push({tl:ci,tr:Xi,bl:qi,br:Ai,tex:gt,writingMode:de.writingMode,glyphOffset:ui,sectionIndex:et.sectionIndex,isSDF:qt,pixelOffsetTL:Zt,pixelOffsetBR:Wi,minFontScaleX:0,minFontScaleY:0})}}return Ve}(0,l,w,f,m,x,h,t.allowVerticalPlacement),le=t.textSizeData;let te=null;le.kind==="source"?(te=[Fs*f.layout.get("text-size").evaluate(x,{},W)],te[0]>mo&&Ti(`${t.layerIds[0]}: Value for "text-size" is >= ${Th}. Reduce your "text-size".`)):le.kind==="composite"&&(te=[Fs*B.compositeTextSizes[0].evaluate(x,{},W),Fs*B.compositeTextSizes[1].evaluate(x,{},W)],(te[0]>mo||te[1]>mo)&&Ti(`${t.layerIds[0]}: Value for "text-size" is >= ${Th}. Reduce your "text-size".`)),t.addSymbols(t.text,ee,te,w,m,x,A,e,i,E.lineStartIndex,E.lineLength,O,V,W);for(const oe of P)D[oe]=t.text.placedSymbolArray.length-1;return 4*ee.length}function s0(t){for(const e in t)return t[e];return null}function Md(t,e,i,l,h,f,m,x,w,E){let A=m.top,P=m.bottom,D=m.left,O=m.right;const B=m.collisionPadding;if(B&&(D-=B[0],A-=B[1],O+=B[2],P+=B[3]),w){const V=new Le(D,A),W=new Le(O,A),ee=new Le(D,P),le=new Le(O,P),te=ft(w);let oe=new Le(0,0);E&&(oe=new Le(E[0],E[1])),V._rotateAround(te,oe),W._rotateAround(te,oe),ee._rotateAround(te,oe),le._rotateAround(te,oe),D=Math.min(V.x,W.x,ee.x,le.x),O=Math.max(V.x,W.x,ee.x,le.x),A=Math.min(V.y,W.y,ee.y,le.y),P=Math.max(V.y,W.y,ee.y,le.y)}return t.emplaceBack(e.x,e.y,e.z,i.x,i.y,D,A,O,P,x,l,h,f),t.length-1}function Uf(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function a2(t,e,i,l){const h=t.compareText;if(e in h){const f=h[e];for(let m=f.length-1;m>=0;m--)if(l.dist(f[m])<i)return!0}else h[e]=[];return h[e].push(l),!1}function r0(t,e){const i=t.fovAboveCenter,l=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,h=(t._camera.position[2]*t.worldSize-l)/Math.cos(t._pitch),f=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-t._pitch-i,.01)),m=Math.sin(t._pitch)*f+h;return Math.min(1.01*m,h*(1/t._horizonShift))}function Ta(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const i=Math.pow(2,-t.z),l=t.x*i,h=(t.x+1)*i,f=t.y*i,m=(t.y+1)*i,x=ss(l),w=ss(h),E=fn(f),A=fn(m),P=e.project(x,E),D=e.project(w,E),O=e.project(w,A),B=e.project(x,A);let V=Math.min(P.x,D.x,O.x,B.x),W=Math.min(P.y,D.y,O.y,B.y),ee=Math.max(P.x,D.x,O.x,B.x),le=Math.max(P.y,D.y,O.y,B.y);const te=i/16;function oe(ue,Ce,Se,Be,He,Pe){const Ve=(Se+He)/2,Ue=(Be+Pe)/2,$e=e.project(ss(Ve),fn(Ue)),Qe=Math.max(0,V-$e.x,W-$e.y,$e.x-ee,$e.y-le);V=Math.min(V,$e.x),ee=Math.max(ee,$e.x),W=Math.min(W,$e.y),le=Math.max(le,$e.y),Qe>te&&(oe(ue,$e,Se,Be,Ve,Ue),oe($e,Ce,Ve,Ue,He,Pe))}oe(P,D,l,f,h,f),oe(D,O,h,f,h,m),oe(O,B,h,m,l,m),oe(B,P,l,m,l,f),V-=te,W-=te,ee+=te,le+=te;const de=1/Math.max(ee-V,le-W);return{scale:de,x:V*de,y:W*de,x2:ee*de,y2:le*de,projection:e}}const l2=Rs(new Float32Array(16));class go{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new oi(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l=!0){return e._coordinatePoint(e.locationCoordinate(i),l)}pixelsPerMeter(e,i){return Bs(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return r0(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,h){const f=e.horizonLineFromTop(!1),m=new Le(i,Math.max(f,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,h))}pointCoordinate3D(e,i,l){const h=new Le(i,l);if(e.elevation)return e.elevation.pointCoordinate(h);{const f=this.pointCoordinate(e,h.x,h.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return l2}createTileMatrix(e,i,l){let h,f,m;const x=l.canonical,w=Rs(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Ta(x,this);h=1,f=E.x+l.wrap*E.scale,m=E.y,ma(w,w,[h/E.scale,h/E.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(x.z),f=(x.x+Math.pow(2,x.z)*l.wrap)*h,m=x.y*h;return eh(w,w,[f,m,0]),ma(w,w,[h/yt,h/yt,1]),w}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class c2 extends go{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(ft(i));this.n=(h+Math.sin(ft(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:h,r0:f}=this,m=ft(e-this.center[0]),x=ft(i),w=Math.sqrt(h-2*l*Math.sin(x))/l;return{x:w*Math.sin(m*l),y:w*Math.cos(m*l)-f,z:0}}unproject(e,i){const{n:l,c:h,r0:f}=this,m=f+i;let x=Math.atan2(e,Math.abs(m))*Math.sign(m);m*l<0&&(x-=Math.PI*Math.sign(e)*Math.sign(m));const w=ft(this.center[0])*l;x=xi(x,-Math.PI-w,Math.PI-w);const E=bt(Gt(x/l)+this.center[0],-180,180),A=Math.asin(bt((h-(e*e+m*m)*l*l)/(2*l),-1,1)),P=bt(Gt(A),-_n,_n);return new oi(E,P)}}const Eh=1.340264,Sh=-.081106,Mh=893e-6,Ah=.003796,Ad=Math.sqrt(3)/2;class h2 extends go{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(Ad*Math.sin(i)),h=l*l,f=h*h*h;return{x:.5*(e*Math.cos(l)/(Ad*(Eh+3*Sh*h+f*(7*Mh+9*Ah*h)))/Math.PI+.5),y:1-.5*(l*(Eh+Sh*h+f*(Mh+Ah*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=l*l,f=h*h*h;for(let A,P,D,O=0;O<12&&(P=l*(Eh+Sh*h+f*(Mh+Ah*h))-i,D=Eh+3*Sh*h+f*(7*Mh+9*Ah*h),A=P/D,l=bt(l-A,-Math.PI/3,Math.PI/3),h=l*l,f=h*h*h,!(Math.abs(A)<1e-12));++O);const m=Ad*e*(Eh+3*Sh*h+f*(7*Mh+9*Ah*h))/Math.cos(l),x=Math.asin(Math.sin(l)/Ad),w=bt(180*m/Math.PI,-180,180),E=bt(180*x/Math.PI,-_n,_n);return new oi(w,E)}}class u2 extends go{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),h=bt(360*(.5-i),-_n,_n);return new oi(l,h)}}const Vl=Math.PI/2;function Cd(t){return Math.tan((Vl+t)/2)}class d2 extends go{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let h=ft(i),f=ft(l);this.southernCenter=h+f<0,this.southernCenter&&(h=-h,f=-f);const m=Math.cos(h),x=Cd(h);this.n=h===f?Math.sin(h):Math.log(m/Math.cos(f))/Math.log(Cd(f)/x),this.f=m*Math.pow(Cd(h),this.n)/this.n}project(e,i){i=ft(i),this.southernCenter&&(i=-i),e=ft(e-this.center[0]);const l=1e-6,{n:h,f}=this;f>0?i<-Vl+l&&(i=-Vl+l):i>Vl-l&&(i=Vl-l);const m=f/Math.pow(Cd(i),h);let x=m*Math.sin(h*e),w=f-m*Math.cos(h*e);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:h}=this,f=h-i,m=Math.sign(f),x=Math.sign(l)*Math.sqrt(e*e+f*f);let w=Math.atan2(e,Math.abs(f))*m;f*l<0&&(w-=Math.PI*Math.sign(e)*m);const E=bt(Gt(w/l)+this.center[0],-180,180),A=bt(Gt(2*Math.atan(Math.pow(h/x,1/l))-Vl),-_n,_n);return new oi(E,this.southernCenter?-A:A)}}class o0 extends go{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:er(e),y:tr(i),z:0}}unproject(e,i){const l=ss(e),h=fn(i);return new oi(l,h)}}const a0=ft(_n);class p2 extends go{project(e,i){const l=(i=ft(i))*i,h=l*l;return{x:.5*((e=ft(e))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=25,f=0,m=l*l;do{m=l*l;const E=m*m;f=(l*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-i)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),l=bt(l-f,-a0,a0)}while(Math.abs(f)>1e-6&&--h>0);m=l*l;const x=bt(Gt(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),w=Gt(l);return new oi(x,w)}}const l0=ft(_n);class f2 extends go{project(e,i){i=ft(i),e=ft(e);const l=Math.cos(i),h=2/Math.PI,f=Math.acos(l*Math.cos(e/2)),m=Math.sin(f)/f,x=.5*(e*h+2*l*Math.sin(e/2)/m)||0,w=.5*(i+Math.sin(i)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,f=25;const m=1e-6;let x=0,w=0;do{const E=Math.cos(h),A=Math.sin(h),P=2*A*E,D=A*A,O=E*E,B=Math.cos(l/2),V=Math.sin(l/2),W=2*B*V,ee=V*V,le=1-O*B*B,te=le?1/le:0,oe=le?Math.acos(E*B)*Math.sqrt(1/le):0,de=.5*(2*oe*E*V+2*l/Math.PI)-e,ue=.5*(oe*A+h)-i,Ce=.5*te*(O*ee+oe*E*B*D)+1/Math.PI,Se=te*(W*P/4-oe*A*V),Be=.125*te*(P*V-oe*A*O*W),He=.5*te*(D*B+oe*ee*E)+.5,Pe=Se*Be-He*Ce;x=(ue*Se-de*He)/Pe,w=(de*Be-ue*Ce)/Pe,l=bt(l-x,-Math.PI,Math.PI),h=bt(h-w,-l0,l0)}while((Math.abs(x)>m||Math.abs(w)>m)&&--f>0);return new oi(Gt(l),Gt(h))}}class c0 extends go{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ft(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:h}=this;return{x:ft(e)*h*l+.5,y:-Math.sin(ft(i))/h*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:h}=this,f=-(i-.5)/l,m=bt(Gt((e-.5)/l)/h,-180,180),x=Math.asin(bt(f*h,-1,1)),w=bt(Gt(x),-_n,_n);return new oi(m,w)}}class _2 extends o0{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const h=lh(e,i,l);return Bi(h,h,ch(Qs(l))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i){const l=Ml(i.lat,i.lng),h=Sn([],l),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;sh(l,l,h,Bs(1,0)*yt*f);const m=Rs(new Float64Array(16));return _a(m,e.pixelMatrix,e.globeMatrix),Bi(l,l,m),new Le(l[0],l[1])}pixelsPerMeter(e,i){return Bs(1,0)*i}pixelSpaceConversion(e,i,l){const h=Bs(1,e)*i,f=Ut(Bs(1,45)*i,h,l);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,l){const h=df(Qs(l.canonical));return _a(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:l}=e,h=ch(Qs(i));return id(h,h,ft(l.lng)),tf(h,h,ft(l.lat)),ma(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,l,h){return Om(e,i,l,!0)||new Cl(0,0)}pointCoordinate3D(e,i,l){const h=this.pointCoordinate(e,i,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!Om(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,f){const m=h.cameraToCenterDistance,x=h._centerAltitude*f,w=h._camera,E=h._camera.forward(),A=Cr([],ns([],E,-m),[0,0,x]),P=h.worldSize/(2*Math.PI),D=[0,0,-P],O=h.width/h.height,B=Math.tan(h.fovAboveCenter),V=ns([],w.up(),B),W=ns([],w.right(),B*O),ee=Sn([],Cr([],Cr([],E,V),W)),le=[];let te;if(new of(A,ee).closestPointOnSphere(D,P,le)){const oe=Cr([],le,D),de=Os([],oe,A);te=Math.cos(h.fovAboveCenter)*th(de)}else{const oe=Os([],A,D),de=Os([],D,A);Sn(de,de);const ue=th(oe)-P;te=Math.sqrt(ue*(ue+2*P));const Ce=Math.acos(te/(P+ue))-Math.acos(_s(E,de));te*=Math.cos(Ce)}return 1.01*te}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Al(e.zoom);if(l>0){const h=r0(e,Bs(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Ut(i,h+f*(1-Math.cos(m)),Math.pow(l,10))}return i}upVector(e,i,l){return lh(i,l,e,1)}upVectorScale(e){return{metersToTile:nd(rd(Qs(e)))}}}function h0(t){const e=t.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new o0(t);case"equirectangular":return new u2(t);case"naturalEarth":return new p2(t);case"equalEarth":return new h2(t);case"winkelTripel":return new f2(t);case"albers":return i?new c0(t):new c2(t);case"lambertConformalConic":return i?new c0(t):new d2(t);case"globe":return new _2(t)}throw new Error(`Invalid projection name: ${t.name}`)}const m2=_d.types,g2=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Id(t,e,i,l,h,f,m,x,w,E,A,P,D){const O=x?Math.min(mo,Math.round(x[0])):0,B=x?Math.min(mo,Math.round(x[1])):0;t.emplaceBack(e,i,Math.round(32*l),Math.round(32*h),f,m,(O<<1)+(w?1:0),B,16*E,16*A,256*P,256*D)}function Pd(t,e,i,l,h,f,m){t.emplaceBack(e,i,l,h,f,m)}function kd(t,e,i,l,h){t.emplaceBack(e,i,l,h),t.emplaceBack(e,i,l,h),t.emplaceBack(e,i,l,h),t.emplaceBack(e,i,l,h)}function y2(t){for(const e of t.sections)if(Yp(e.text))return!0;return!1}class Gf{constructor(e){this.layoutVertexArray=new Ge,this.indexArray=new _t,this.programConfigurations=e,this.segments=new Ui,this.dynamicLayoutVertexArray=new qe,this.opacityVertexArray=new mt,this.placedSymbolArray=new Vi,this.globeExtVertexArray=new Ye}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Mb.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Cb.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,g2,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ab.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}ht(Gf,"SymbolBuffers");class $f{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new Ui,this.collisionVertexArray=new Bt,this.collisionVertexArrayExt=new Dt}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Ib.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Pb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ht($f,"CollisionBuffers");class yo{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Rs([]),this.placementViewportMatrix=Rs([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Df(this.zoom,i["text-size"]),this.iconSizeData=Df(this.zoom,i["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(m=>rs[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Gf(new fa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Gf(new fa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new En,this.lineVertexArray=new bl,this.symbolInstances=new mi}calculateGlyphDependencies(e,i,l,h,f){for(let m=0;m<e.length;m++)if(i[e.charCodeAt(m)]=!0,h&&f){const x=vh[e.charAt(m)];x&&(i[x.charCodeAt(0)]=!0)}}populate(e,i,l,h){const f=this.layers[0],m=f.layout,x=this.projection.name==="globe",w=m.get("text-font"),E=m.get("text-field"),A=m.get("icon-image"),P=(E.value.kind!=="constant"||E.value.value instanceof Tn&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),D=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!P&&!D)return;const B=i.iconDependencies,V=i.glyphDependencies,W=i.availableImages,ee=new C(this.zoom);for(const{feature:le,id:te,index:oe,sourceLayerIndex:de}of e){const ue=f._featureFilter.needGeometry,Ce=va(le,ue);if(!f._featureFilter.filter(ee,Ce,l))continue;if(ue||(Ce.geometry=Ir(le,l,h)),x&&le.type!==1&&l.z<=5){const Pe=Ce.geometry,Ve=.98078528056,Ue=($e,Qe)=>_s(lh($e.x,$e.y,l,1),lh(Qe.x,Qe.y,l,1))<Ve;for(let $e=0;$e<Pe.length;$e++)Pe[$e]=Cv(Pe[$e],Ue)}let Se,Be;if(P){const Pe=f.getValueAndResolveTokens("text-field",Ce,l,W),Ve=Tn.factory(Pe);y2(Ve)&&(this.hasRTLText=!0),(!this.hasRTLText||b()==="unavailable"||this.hasRTLText&&M.isParsed())&&(Se=Lb(Ve,f,Ce))}if(D){const Pe=f.getValueAndResolveTokens("icon-image",Ce,l,W);Be=Pe instanceof Gn?Pe:Gn.fromString(Pe)}if(!Se&&!Be)continue;const He=this.sortFeaturesByKey?O.evaluate(Ce,{},l):void 0;if(this.features.push({id:te,text:Se,icon:Be,index:oe,sourceLayerIndex:de,geometry:Ce.geometry,properties:le.properties,type:m2[le.type],sortKey:He}),Be&&(B[Be.name]=!0),Se){const Pe=w.evaluate(Ce,{},l).join(","),Ve=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rs.vertical)>=0;for(const Ue of Se.sections)if(Ue.image)B[Ue.image.name]=!0;else{const $e=Zc(Se.toString()),Qe=Ue.fontStack||Pe,ze=V[Qe]=V[Qe]||{};this.calculateGlyphDependencies(Ue.text,ze,Ve,this.allowVerticalPlacement,$e)}}}m.get("symbol-placement")==="line"&&(this.features=function(le){const te={},oe={},de=[];let ue=0;function Ce(Pe){de.push(le[Pe]),ue++}function Se(Pe,Ve,Ue){const $e=oe[Pe];return delete oe[Pe],oe[Ve]=$e,de[$e].geometry[0].pop(),de[$e].geometry[0]=de[$e].geometry[0].concat(Ue[0]),$e}function Be(Pe,Ve,Ue){const $e=te[Ve];return delete te[Ve],te[Pe]=$e,de[$e].geometry[0].shift(),de[$e].geometry[0]=Ue[0].concat(de[$e].geometry[0]),$e}function He(Pe,Ve,Ue){const $e=Ue?Ve[0][Ve[0].length-1]:Ve[0][0];return`${Pe}:${$e.x}:${$e.y}`}for(let Pe=0;Pe<le.length;Pe++){const Ve=le[Pe],Ue=Ve.geometry,$e=Ve.text?Ve.text.toString():null;if(!$e){Ce(Pe);continue}const Qe=He($e,Ue),ze=He($e,Ue,!0);if(Qe in oe&&ze in te&&oe[Qe]!==te[ze]){const rt=Be(Qe,ze,Ue),pt=Se(Qe,ze,de[rt].geometry);delete te[Qe],delete oe[ze],oe[He($e,de[pt].geometry,!0)]=pt,de[rt].geometry=null}else Qe in oe?Se(Qe,ze,Ue):ze in te?Be(Qe,ze,Ue):(Ce(Pe),te[Qe]=ue-1,oe[ze]=ue-1)}return de.filter(Pe=>Pe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((le,te)=>le.sortKey-te.sortKey)}update(e,i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,l,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=h0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:f}of i)this.lineVertexArray.emplaceBack(h,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,h,f,m,x,w,E,A,P,D,O,B){const V=e.indexArray,W=e.layoutVertexArray,ee=e.globeExtVertexArray,le=e.segments.prepareSegment(4*i.length,W,V,this.canOverlap?m.sortKey:void 0),te=this.glyphOffsetArray.length,oe=le.vertexLength,de=this.allowVerticalPlacement&&x===rs.vertical?Math.PI/2:0,ue=m.text&&m.text.sections;for(let Se=0;Se<i.length;Se++){const{tl:Be,tr:He,bl:Pe,br:Ve,tex:Ue,pixelOffsetTL:$e,pixelOffsetBR:Qe,minFontScaleX:ze,minFontScaleY:rt,glyphOffset:pt,isSDF:ot,sectionIndex:Tt}=i[Se],et=le.vertexLength,gt=pt[1];if(Id(W,E.x,E.y,Be.x,gt+Be.y,Ue.x,Ue.y,l,ot,$e.x,$e.y,ze,rt),Id(W,E.x,E.y,He.x,gt+He.y,Ue.x+Ue.w,Ue.y,l,ot,Qe.x,$e.y,ze,rt),Id(W,E.x,E.y,Pe.x,gt+Pe.y,Ue.x,Ue.y+Ue.h,l,ot,$e.x,Qe.y,ze,rt),Id(W,E.x,E.y,Ve.x,gt+Ve.y,Ue.x+Ue.w,Ue.y+Ue.h,l,ot,Qe.x,Qe.y,ze,rt),w){const{x:Et,y:qt,z:St}=w.anchor,[vt,fi,Ct]=w.up;Pd(ee,Et,qt,St,vt,fi,Ct),Pd(ee,Et,qt,St,vt,fi,Ct),Pd(ee,Et,qt,St,vt,fi,Ct),Pd(ee,Et,qt,St,vt,fi,Ct),kd(e.dynamicLayoutVertexArray,Et,qt,St,de)}else kd(e.dynamicLayoutVertexArray,E.x,E.y,E.z,de);V.emplaceBack(et,et+1,et+2),V.emplaceBack(et+1,et+2,et+3),le.vertexLength+=4,le.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pt[0]),Se!==i.length-1&&Tt===i[Se+1].sectionIndex||e.programConfigurations.populatePaintArrays(W.length,m,m.index,{},O,B,ue&&ue[Tt])}const Ce=w?w.anchor:E;e.placedSymbolArray.emplaceBack(Ce.x,Ce.y,Ce.z,E.x,E.y,te,this.glyphOffsetArray.length-te,oe,A,P,E.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,!1,0,D,0)}_commitLayoutVertex(e,i,l,h,f,m,x){e.emplaceBack(i,l,h,f,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,l,h,f,m,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),E=w.vertexLength,A=x.tileAnchorX,P=x.tileAnchorY;for(let O=0;O<4;O++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(i,-e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,-e.padding),l.collisionVertexArrayExt.emplaceBack(i,e.padding,e.padding),l.collisionVertexArrayExt.emplaceBack(i,-e.padding,e.padding),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,A,P,new Le(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,A,P,new Le(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,A,P,new Le(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,A,P,new Le(e.x1,e.y2)),w.vertexLength+=4;const D=l.indexArray;D.emplaceBack(E,E+1),D.emplaceBack(E+1,E+2),D.emplaceBack(E+2,E+3),D.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,h,f,m){for(let x=h;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(e,m,i,x);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,l,h,f,m){for(let x=h;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $f(dt,Ig.members,nn),this.iconCollisionBox=new $f(dt,Ig.members,nn);const l=Ll(this.iconSizeData,e),h=Ll(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,e,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,e,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,e,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,e,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,i,l,h){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),m=xd(this.textSizeData,e,f)/ln;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,l){const h=this.icon.placedSymbolArray.get(l),f=xd(this.iconSizeData,e,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,l){e.emplaceBack(i,-l,-l),e.emplaceBack(i,l,-l),e.emplaceBack(i,l,l),e.emplaceBack(i,-l,l)}_updateTextDebugCollisionBoxes(e,i,l,h,f,m){for(let x=h;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(e,m,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(e,i,l,h,f,m){for(let x=h;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(e,i,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Ll(this.iconSizeData,e),h=Ll(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,e,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,e,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(l,e,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,e,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,h,f,m,x,w,E){const A={};if(i<l){const{x1:P,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe,featureIndex:de}=e.get(i);A.textBox={x1:P,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe},A.textFeatureIndex=de}if(h<f){const{x1:P,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe,featureIndex:de}=e.get(h);A.verticalTextBox={x1:P,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe},A.verticalTextFeatureIndex=de}if(m<x){const{x1:P,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe,featureIndex:de}=e.get(m);A.iconBox={x1:P,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe},A.iconFeatureIndex=de}if(w<E){const{x1:P,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe,featureIndex:de}=e.get(w);A.verticalIconBox={x1:P,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:W,projectedAnchorY:ee,projectedAnchorZ:le,tileAnchorX:te,tileAnchorY:oe},A.verticalIconFeatureIndex=de}return A}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),h=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<h;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),h=[],f=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(i*w.tileAnchorX+l*w.tileAnchorY)),f.push(w.featureIndex)}return m.sort((x,w)=>h[x]-h[w]||f[w]-f[x]),m}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&f!==h&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}ht(yo,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),yo.MAX_GLYPHS=65535,yo.addDynamicAttributes=kd;const x2=new se({"symbol-placement":new j(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new j(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new j(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Z(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new j(Oe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new j(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new j(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new j(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new j(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Z(Oe.layout_symbol["icon-size"]),"icon-text-fit":new j(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new j(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Z(Oe.layout_symbol["icon-image"]),"icon-rotate":new Z(Oe.layout_symbol["icon-rotate"]),"icon-padding":new j(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new j(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Z(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Z(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new j(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new j(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new j(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Z(Oe.layout_symbol["text-field"]),"text-font":new Z(Oe.layout_symbol["text-font"]),"text-size":new Z(Oe.layout_symbol["text-size"]),"text-max-width":new Z(Oe.layout_symbol["text-max-width"]),"text-line-height":new Z(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Z(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Z(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Z(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new j(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Z(Oe.layout_symbol["text-anchor"]),"text-max-angle":new j(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new j(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Z(Oe.layout_symbol["text-rotate"]),"text-padding":new j(Oe.layout_symbol["text-padding"]),"text-keep-upright":new j(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Z(Oe.layout_symbol["text-transform"]),"text-offset":new Z(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new j(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new j(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new j(Oe.layout_symbol["text-optional"])});var qf={paint:new se({"icon-opacity":new Z(Oe.paint_symbol["icon-opacity"]),"icon-color":new Z(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Z(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Z(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Z(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new j(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new j(Oe.paint_symbol["icon-translate-anchor"]),"text-opacity":new Z(Oe.paint_symbol["text-opacity"]),"text-color":new Z(Oe.paint_symbol["text-color"],{runtimeType:On,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Z(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Z(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Z(Oe.paint_symbol["text-halo-blur"]),"text-translate":new j(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new j(Oe.paint_symbol["text-translate-anchor"])}),layout:x2};class u0{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Zr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ht(u0,"FormatSectionOverride",{omit:["defaultValue"]});class Dd extends zs{constructor(e){super(e,qf)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const f of l)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,l,h){const f=this.layout.get(e).evaluate(i,{},l,h),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||ro(m.value)||!f?f:function(x,w){return w.replace(/{([^{}]+)}/g,(E,A)=>A in x?String(x[A]):"")}(i.properties,f)}createBucket(e){return new yo(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of qf.paint.overridableProperties){if(!Dd.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new u0(i),h=new pl(l,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Oc("source",h):new ra("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new K(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&Dd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),h=qf.paint.properties[i];let f=!1;const m=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Tn)m(l.value.value.sections);else if(l.value.kind==="source"){const x=E=>{f||(E instanceof gr&&Di(E.value)===Uo?m(E.value.sections):E instanceof Xs?m(E.sections):E.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return f}getProgramConfiguration(e){return new po(this,e)}}var v2={paint:new se({"background-color":new j(Oe.paint_background["background-color"]),"background-pattern":new j(Oe.paint_background["background-pattern"]),"background-opacity":new j(Oe.paint_background["background-opacity"])})},b2={paint:new se({"raster-opacity":new j(Oe.paint_raster["raster-opacity"]),"raster-hue-rotate":new j(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new j(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new j(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new j(Oe.paint_raster["raster-saturation"]),"raster-contrast":new j(Oe.paint_raster["raster-contrast"]),"raster-resampling":new j(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new j(Oe.paint_raster["raster-fade-duration"])})};class w2 extends zs{constructor(e){super(e,{}),this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var T2={paint:new se({"sky-type":new j(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new j(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new j(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new j(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new j(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new ne(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new j(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new j(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new j(Oe.paint_sky["sky-opacity"])})};function Wf(t,e,i){const l=[0,0,1],h=Pm([]);return Dm(h,h,i?-ft(t)+Math.PI:ft(t)),km(h,h,-ft(e)),Mm(l,l,h),Sn(l,l)}const E2={circle:class extends zs{constructor(t){super(t,Rv)}createBucket(t){return new yf(t)}queryRadius(t){const e=t;return Il("circle-radius",this,e)+Il("circle-stroke-width",this,e)+ld(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,i,l,h,f,m,x){const w=eg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return tg(t,l,f,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new po(this,t)}},heatmap:class extends zs{createBucket(t){return new ng(t)}constructor(t){super(t,Nv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Il("heatmap-radius",this,t)}queryIntersectsFeature(t,e,i,l,h,f,m,x){const w=this.paint.get("heatmap-radius").evaluate(e,i);return tg(t,l,f,m,x,!0,!0,new Le(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new po(this,t)}},hillshade:class extends zs{constructor(t){super(t,jv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends zs{constructor(t){super(t,ib)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(t){return new po(this,t)}recalculate(t,e){super.recalculate(t,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new pd(t)}queryRadius(){return ld(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,i,l,h,f){return!t.queryGeometry.isAboveHorizon&&Xm(Qm(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends zs{constructor(t){super(t,yb)}createBucket(t){return new gh(t)}queryRadius(){return ld(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new po(this,t)}queryIntersectsFeature(t,e,i,l,h,f,m,x,w){const E=eg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(e,i),P=this.paint.get("fill-extrusion-base").evaluate(e,i),D=[0,0],O=x&&f.elevation,B=f.elevation?f.elevation.exaggeration():1,V=t.tile.getBucket(this);if(O&&V instanceof gh){const oe=V.centroidVertexArray,de=w+1;de<oe.length&&(D[0]=oe.geta_centroid_pos0(de),D[1]=oe.geta_centroid_pos1(de))}if(D[0]===0&&D[1]===1)return!1;f.projection.name==="globe"&&(l=bg([l],[new Le(0,0),new Le(yt,yt)],t.tileID.canonical).map(oe=>oe.polygon).flat());const W=O?x:null,[ee,le]=function(oe,de,ue,Ce,Se,Be,He,Pe,Ve,Ue,$e){return oe.projection.name==="globe"?function(Qe,ze,rt,pt,ot,Tt,et,gt,Et,qt,St){const vt=[],fi=[],Ct=Qe.projection.upVectorScale(St,Qe.center.lat,Qe.worldSize).metersToTile,It=[0,0,0,1],ai=[0,0,0,1],ui=(li,Si,Li,$i)=>{li[0]=Si,li[1]=Li,li[2]=$i,li[3]=1},di=vg();rt>0&&(rt+=di),pt+=di;for(const li of ze){const Si=[],Li=[];for(const $i of li){const ci=$i.x+ot.x,Xi=$i.y+ot.y,qi=Qe.projection.projectTilePoint(ci,Xi,St),Ai=Qe.projection.upVector(St,$i.x,$i.y);let Zt=rt,Wi=pt;if(et){const pi=Sg(ci,Xi,rt,pt,et,gt,Et,qt);Zt+=pi.base,Wi+=pi.top}rt!==0?ui(It,qi.x+Ai[0]*Ct*Zt,qi.y+Ai[1]*Ct*Zt,qi.z+Ai[2]*Ct*Zt):ui(It,qi.x,qi.y,qi.z),ui(ai,qi.x+Ai[0]*Ct*Wi,qi.y+Ai[1]*Ct*Wi,qi.z+Ai[2]*Ct*Wi),Bi(It,It,Tt),Bi(ai,ai,Tt),Si.push(new Dl(It[0],It[1],It[2])),Li.push(new Dl(ai[0],ai[1],ai[2]))}vt.push(Si),fi.push(Li)}return[vt,fi]}(oe,de,ue,Ce,Se,Be,He,Pe,Ve,Ue,$e):He?function(Qe,ze,rt,pt,ot,Tt,et,gt,Et){const qt=[],St=[],vt=[0,0,0,1];for(const fi of Qe){const Ct=[],It=[];for(const ai of fi){const ui=ai.x+pt.x,di=ai.y+pt.y,li=Sg(ui,di,ze,rt,Tt,et,gt,Et);vt[0]=ui,vt[1]=di,vt[2]=li.base,vt[3]=1,ga(vt,vt,ot),vt[3]=Math.max(vt[3],1e-5);const Si=new Dl(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);vt[0]=ui,vt[1]=di,vt[2]=li.top,vt[3]=1,ga(vt,vt,ot),vt[3]=Math.max(vt[3],1e-5);const Li=new Dl(vt[0]/vt[3],vt[1]/vt[3],vt[2]/vt[3]);Ct.push(Si),It.push(Li)}qt.push(Ct),St.push(It)}return[qt,St]}(de,ue,Ce,Se,Be,He,Pe,Ve,Ue):function(Qe,ze,rt,pt,ot){const Tt=[],et=[],gt=ot[8]*ze,Et=ot[9]*ze,qt=ot[10]*ze,St=ot[11]*ze,vt=ot[8]*rt,fi=ot[9]*rt,Ct=ot[10]*rt,It=ot[11]*rt;for(const ai of Qe){const ui=[],di=[];for(const li of ai){const Si=li.x+pt.x,Li=li.y+pt.y,$i=ot[0]*Si+ot[4]*Li+ot[12],ci=ot[1]*Si+ot[5]*Li+ot[13],Xi=ot[2]*Si+ot[6]*Li+ot[14],qi=ot[3]*Si+ot[7]*Li+ot[15],Ai=$i+gt,Zt=ci+Et,Wi=Xi+qt,pi=Math.max(qi+St,1e-5),Cn=$i+vt,Zi=ci+fi,cn=Xi+Ct,sn=Math.max(qi+It,1e-5);ui.push(new Dl(Ai/pi,Zt/pi,Wi/pi)),di.push(new Dl(Cn/sn,Zi/sn,cn/sn))}Tt.push(ui),et.push(di)}return[Tt,et]}(de,ue,Ce,Se,Be)}(f,l,P,A,E,m,W,D,B,f.center.lat,t.tileID.canonical),te=t.queryGeometry;return function(oe,de,ue){let Ce=1/0;Xm(ue,de)&&(Ce=Eg(ue,de[0]));for(let Se=0;Se<de.length;Se++){const Be=de[Se],He=oe[Se];for(let Pe=0;Pe<Be.length-1;Pe++){const Ve=Be[Pe],Ue=[Ve,Be[Pe+1],He[Pe+1],He[Pe],Ve];Hm(ue,Ue)&&(Ce=Math.min(Ce,Eg(ue,Ue)))}}return Ce!==1/0&&Ce}(ee,le,te.isPointQuery()?te.screenBounds:te.screenGeometry)}},line:class extends zs{constructor(t){super(t,Mg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Tc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Ag.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new yd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new po(this,t)}queryRadius(t){const e=t,i=Cg(Il("line-width",this,e),Il("line-gap-width",this,e)),l=Il("line-offset",this,e);return i/2+Math.abs(l)+ld(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,i,l,h,f){if(t.queryGeometry.isAboveHorizon)return!1;const m=Qm(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),x=t.pixelToTileUnitsFactor/2*Cg(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(l=function(E,A){const P=[],D=new Le(0,0);for(let O=0;O<E.length;O++){const B=E[O],V=[];for(let W=0;W<B.length;W++){const ee=B[W],le=B[W+1],te=W===0?D:ee.sub(B[W-1])._unit()._perp(),oe=W===B.length-1?D:le.sub(ee)._unit()._perp(),de=te._add(oe)._unit();de._mult(1/(de.x*oe.x+de.y*oe.y)),V.push(de._mult(A)._add(ee))}P.push(V)}return P}(l,w*t.pixelToTileUnitsFactor)),function(E,A,P){for(let D=0;D<A.length;D++){const O=A[D];if(E.length>=3){for(let B=0;B<O.length;B++)if(ba(E,O[B]))return!0}if(kv(E,O,P))return!0}return!1}(m,l,x)}isTileClipped(){return!0}},symbol:Dd,background:class extends zs{constructor(t){super(t,v2)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends zs{constructor(t){super(t,b2)}getProgramIds(){return["raster"]}},sky:class extends zs{constructor(t){super(t,T2),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,f=t.style.light,m=f.properties.get("position");return h&&f.properties.get("anchor")==="viewport"&&Ti("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Wf(m.azimuthal,90-m.polar,e):Wf(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return Wf(i[0],90-i[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}}};class Ch{constructor(e,i,l,h){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(i,h)}update(e,i,l){const{width:h,height:f}=e,{context:m}=this,{gl:x}=m,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:A,ImageData:P,ImageBitmap:D}=T;if(x.bindTexture(x.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),l||this.size&&this.size[0]===h&&this.size[1]===f){const{x:O,y:B}=l||{x:0,y:0};e instanceof w||e instanceof E||e instanceof A||e instanceof P||D&&e instanceof D?x.texSubImage2D(x.TEXTURE_2D,0,O,B,x.RGBA,x.UNSIGNED_BYTE,e):x.texSubImage2D(x.TEXTURE_2D,0,O,B,h,f,x.RGBA,x.UNSIGNED_BYTE,e.data)}else this.size=[h,f],e instanceof w||e instanceof E||e instanceof A||e instanceof P||D&&e instanceof D?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,e):x.texImage2D(x.TEXTURE_2D,0,this.format,h,f,0,this.format,x.UNSIGNED_BYTE,e.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(e,i){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class S2{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class M2{constructor(){this.tasks={},this.taskQueue=[],hr(["process"],this),this.invoker=new S2(this.process),this.nextId=0}add(e,i){const l=this.nextId++,h=function({type:f,isSymbolTile:m,zoom:x}){return x=x||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-x:f==="maybePrepare"&&m?400-x:500:200-x:100-x}(i);if(h===0){bs();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:e,metadata:i,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){bs();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<i&&(i=f.priority,e=h)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class d0{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const A2=["tile","layer","source","sourceLayer","state"];class p0{constructor(e,i,l,h,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=h,this.properties=e.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of A2)this[i]!==void 0&&(e[i]=this[i]);return e}}const ys=32,ir=33,xo=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,i=0,l=0,h=0,f=0,m=0,x=0;for(1&e?h=f=m=ys:i=l=x=ys;(e>>=1)>1;){const E=i+h>>1,A=l+f>>1;1&e?(h=i,f=l,i=m,l=x):(i=h,l=f,h=m,f=x),m=E,x=A}const w=4*t;xo[w+0]=i,xo[w+1]=l,xo[w+2]=h,xo[w+3]=f}const nr=new Uint16Array(2178),vo=new Uint8Array(1089),Ld=new Uint16Array(1089);function f0(t){return t===0?-.03125:t===32?.03125:0}var _0=xe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const m0={type:2,extent:yt,loadGeometry:()=>[[new Le(0,0),new Le(yt+1,0),new Le(yt+1,yt+1),new Le(0,yt+1),new Le(0,0)]]};class Zf{constructor(e,i,l,h,f){this.tileID=e,this.uid=Nn(),this.uses=0,this.tileSize=i,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<ws.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ta(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,l){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,f){const m={};if(!f)return m;for(const x of h){const w=x.layerIds.map(E=>f.getLayer(E)).filter(Boolean);if(w.length!==0){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>w.filter(A=>A.id===E)[0]));for(const E of w)m[E.id]=x}}return m}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof yo){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof yo&&f.hasRTLText){this.hasRTLText=!0,M.isLoading()||M.isLoaded()||b()!=="deferred"||S();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ri}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(e)}const i=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ch(e,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ch(e,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ch(e,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,i,l,h,f,m,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:m,params:f,tileTransform:this.tileTransform},e,i,l):{}}querySourceFeatures(e,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),f=i?i.sourceLayer:"",m=h._geojsonTileLayer||h[f];if(!m)return;const x=gl(i&&i.filter),{z:w,x:E,y:A}=this.tileID.canonical,P={z:w,x:E,y:A};for(let D=0;D<m.length;D++){const O=m.feature(D);if(x.needGeometry){const W=va(O,!0);if(!x.filter(new C(this.tileID.overscaledZ),W,this.tileID.canonical))continue}else if(!x.filter(new C(this.tileID.overscaledZ),O))continue;const B=l.getId(O,f),V=new p0(O,w,E,A,B);V.tile=P,e.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const l=Rn(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const f=this.expirationTime-i;f?this.expirationTime=l+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0||!i)return;const l=this.latestFeatureIndex.loadVTLayers(),h=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const m=this.buckets[f],x=m.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],E=e[x];if(!w||!E||Object.keys(E).length===0)continue;if(m.update(E,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof yd||m instanceof pd){const P=i.style._getSourceCache(m.layers[0].source);i._terrain&&i._terrain.enabled&&P&&m.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(P.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(f);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ws.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ws.now()+e}setTexture(e,i){const l=i.context,h=l.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Ch(l,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(e,i){const l={};for(const h of i)l[h]=!0;this.dependencies[e]=l}hasDependency(e,i){for(const l of e){const h=this.dependencies[l];if(h){for(const f of i)if(h[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const l=Ir(m0,this.tileID.canonical,this.tileTransform)[0],h=new Ze,f=new Wn;for(let m=0;m<l.length;m++){const{x,y:w}=l[m];h.emplaceBack(x,w),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(h,oh.members),this._tileDebugSegments=Ui.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const l=Ir(m0,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const m=function(x,w){const E=Ta(x,w),A=Math.pow(2,x.z);for(let W=0;W<ir;W++)for(let ee=0;ee<ir;ee++){const le=ss((x.x+(ee+f0(ee))/ys)/A),te=fn((x.y+(W+f0(W))/ys)/A),oe=w.project(le,te),de=W*ir+ee;nr[2*de+0]=Math.round((oe.x*E.scale-E.x)*yt),nr[2*de+1]=Math.round((oe.y*E.scale-E.y)*yt)}vo.fill(0),Ld.fill(0);for(let W=2045;W>=0;W--){const ee=4*W,le=xo[ee+0],te=xo[ee+1],oe=xo[ee+2],de=xo[ee+3],ue=le+oe>>1,Ce=te+de>>1,Se=ue+Ce-te,Be=Ce+le-ue,He=te*ir+le,Pe=de*ir+oe,Ve=Ce*ir+ue,Ue=Math.hypot((nr[2*He+0]+nr[2*Pe+0])/2-nr[2*Ve+0],(nr[2*He+1]+nr[2*Pe+1])/2-nr[2*Ve+1])>=16;vo[Ve]=vo[Ve]||(Ue?1:0),W<1022&&(vo[Ve]=vo[Ve]||vo[(te+Be>>1)*ir+(le+Se>>1)]||vo[(de+Be>>1)*ir+(oe+Se>>1)])}const P=new je,D=new _t;let O=0;function B(W,ee){const le=ee*ir+W;return Ld[le]===0&&(P.emplaceBack(nr[2*le+0],nr[2*le+1],W*yt/ys,ee*yt/ys),Ld[le]=++O),Ld[le]-1}function V(W,ee,le,te,oe,de){const ue=W+le>>1,Ce=ee+te>>1;if(Math.abs(W-oe)+Math.abs(ee-de)>1&&vo[Ce*ir+ue])V(oe,de,W,ee,ue,Ce),V(le,te,oe,de,ue,Ce);else{const Se=B(W,ee),Be=B(le,te),He=B(oe,de);D.emplaceBack(Se,Be,He)}}return V(0,0,ys,ys,ys,0),V(ys,ys,0,0,0,ys),{vertices:P,indices:D}}(this.tileID.canonical,i);h=m.vertices,f=m.indices}else{h=new je,f=new _t;for(const{x,y:w}of l)h.emplaceBack(x,w,0,0);const m=Af(h.int16,void 0,4);for(let x=0;x<m.length;x+=3)f.emplaceBack(m[x],m[x+1],m[x+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,_0.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=Ui.simpleSegment(0,0,h.length,f.length)}_makeGlobeTileDebugBuffers(e,i){const l=i.projection;if(!l||l.name!=="globe"||i.freezeTileCoverage)return;const h=this.tileID.canonical,f=ch(Bm(h,i)),m=Al(i.zoom);let x;m>0&&(x=ef(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,i,f,x,m),this._makeGlobeTileDebugTextBuffer(e,h,i,f,x,m)}_globePoint(e,i,l,h,f,m,x){let w=lh(e,i,l);if(m){const E=1<<l.z,A=er(h.center.lng),P=tr(h.center.lat),D=(l.x+.5)/E-A;let O=0;D>.5?O=-1:D<-.5&&(O=1);let B=(e/yt+l.x)/E+O,V=(i/yt+l.y)/E;B=(B-A)*h._pixelsPerMercatorPixel+A,V=(V-P)*h._pixelsPerMercatorPixel+P;const W=[B*h.worldSize,V*h.worldSize,0];Bi(W,W,m),w=xa(w,W,x)}return Bi(w,w,f)}_makeGlobeTileDebugBorderBuffer(e,i,l,h,f,m){const x=new Ze,w=new Wn,E=new Ee,A=(D,O,B,V,W)=>{const ee=(B-D)/(W-1),le=(V-O)/(W-1),te=x.length;for(let oe=0;oe<W;oe++){const de=D+oe*ee,ue=O+oe*le;x.emplaceBack(de,ue);const Ce=this._globePoint(de,ue,i,l,h,f,m);E.emplaceBack(Ce[0],Ce[1],Ce[2]),w.emplaceBack(te+oe)}},P=yt;A(0,0,P,0,16),A(P,0,P,P,16),A(P,P,0,P,16),A(0,P,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(w),this._tileDebugBuffer=e.createVertexBuffer(x,oh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,zm.members),this._tileDebugSegments=Ui.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(e,i,l,h,f,m){const x=yt/4,w=new Ze,E=new _t,A=new Ee,P=25;E.reserve(32),w.reserve(P),A.reserve(P);const D=(O,B)=>P*O+B;for(let O=0;O<P;O++){const B=O*x;for(let V=0;V<P;V++){const W=V*x;w.emplaceBack(W,B);const ee=this._globePoint(W,B,i,l,h,f,m);A.emplaceBack(ee[0],ee[1],ee[2])}}for(let O=0;O<4;O++)for(let B=0;B<4;B++){const V=D(O,B),W=D(O,B+1),ee=D(O+1,B),le=D(O+1,B+1);E.emplaceBack(V,W,ee),E.emplaceBack(ee,W,le)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(E),this._tileDebugTextBuffer=e.createVertexBuffer(w,oh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(A,zm.members),this._tileDebugTextSegments=Ui.simpleSegment(0,0,P,32)}}class C2{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,l){const h=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},_i(this.stateChanges[e][h],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const f in this.state[e])f!==h&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const f in this.state[e][h])l[f]||(this.deletedStates[e][h][f]=null)}else for(const f in l)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][f]===null&&delete this.deletedStates[e][h][f]}removeFeatureState(e,i,l){if(this.deletedStates[e]===null)return;const h=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&i!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][l]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(l in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][l]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,i){const l=String(i),h=_i({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const f=this.deletedStates[e][i];if(f===null)return{};for(const m in f)delete h[m]}return h}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),_i(this.state[h][m],this.stateChanges[h][m]),f[m]=this.state[h][m];l[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(this.deletedStates[h]===null)for(const m in this.state[h])f[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const x of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][x];f[m]=this.state[h][m]}l[h]=l[h]||{},_i(l[h],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in e)e[h].setFeatureState(l,i)}}class g0{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function y0(t,e,i,l){let h=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(l[m])<1e-15){if(i[m]<t[m]||i[m]>e[m])return null}else{const x=1/l[m];let w=(t[m]-i[m])*x,E=(e[m]-i[m])*x;if(w>E){const A=w;w=E,E=A}if(w>h&&(h=w),E<f&&(f=E),h>f)return null}return h}function x0(t,e,i,l,h,f,m,x,w,E,A){const P=l-t,D=h-e,O=f-i,B=m-t,V=x-e,W=w-i,ee=A[1]*W-A[2]*V,le=A[2]*B-A[0]*W,te=A[0]*V-A[1]*B,oe=P*ee+D*le+O*te;if(Math.abs(oe)<1e-15)return null;const de=1/oe,ue=E[0]-t,Ce=E[1]-e,Se=E[2]-i,Be=(ue*ee+Ce*le+Se*te)*de;if(Be<0||Be>1)return null;const He=Ce*O-Se*D,Pe=Se*P-ue*O,Ve=ue*D-Ce*P,Ue=(A[0]*He+A[1]*Pe+A[2]*Ve)*de;return Ue<0||Be+Ue>1?null:(B*He+V*Pe+W*Ve)*de}function v0(t,e,i){return(t-e)/(i-e)}function b0(t,e,i,l,h,f,m,x,w){const E=1<<i,A=f-l,P=m-h,D=(t+1)/E*A+l,O=(e+0)/E*P+h,B=(e+1)/E*P+h;x[0]=(t+0)/E*A+l,x[1]=O,w[0]=D,w[1]=B}class w0{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const m=Math.ceil(Math.log2(f.dim/8)),x=[];let w=Math.ceil(Math.pow(2,m));const E=1/w,A=(O,B,V,W,ee)=>{const le=W?1:0,te=(O+1)*V-le,oe=B*V,de=(B+1)*V-le;ee[0]=O*V,ee[1]=oe,ee[2]=te,ee[3]=de};let P=new g0(w);const D=[];for(let O=0;O<w*w;O++){A(O%w,Math.floor(O/w),E,!1,D);const B=bo(D[0],D[1],f),V=bo(D[2],D[1],f),W=bo(D[2],D[3],f),ee=bo(D[0],D[3],f);P.minimums.push(Math.min(B,V,W,ee)),P.maximums.push(Math.max(B,V,W,ee)),P.leaves.push(1)}for(x.push(P),w/=2;w>=1;w/=2){const O=x[x.length-1];P=new g0(w);for(let B=0;B<w*w;B++){A(B%w,Math.floor(B/w),2,!0,D);const V=O.getElevation(D[0],D[1]),W=O.getElevation(D[2],D[1]),ee=O.getElevation(D[2],D[3]),le=O.getElevation(D[0],D[3]),te=O.isLeaf(D[0],D[1]),oe=O.isLeaf(D[2],D[1]),de=O.isLeaf(D[2],D[3]),ue=O.isLeaf(D[0],D[3]),Ce=Math.min(V.min,W.min,ee.min,le.min),Se=Math.max(V.max,W.max,ee.max,le.max),Be=te&&oe&&de&&ue;P.maximums.push(Se),P.minimums.push(Ce),P.leaves.push(Se-Ce<=5&&Be?1:0)}x.push(P)}return x}(this.dem),l=i.length-1,h=i[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,h,f,m,x=1){return y0([e,i,-100],[l,h,this.maximums[0]*x],f,m)}raycast(e,i,l,h,f,m,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,l,h,f,m,x);if(w==null)return null;const E=[],A=[],P=[],D=[],O=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:B,t:V,nodex:W,nodey:ee,depth:le}=O.pop();if(this.leaves[B]){b0(W,ee,le,e,i,l,h,P,D);const oe=1<<le,de=(W+0)/oe,ue=(W+1)/oe,Ce=(ee+0)/oe,Se=(ee+1)/oe,Be=bo(de,Ce,this.dem)*x,He=bo(ue,Ce,this.dem)*x,Pe=bo(ue,Se,this.dem)*x,Ve=bo(de,Se,this.dem)*x,Ue=x0(P[0],P[1],Be,D[0],P[1],He,D[0],D[1],Pe,f,m),$e=x0(D[0],D[1],Pe,P[0],D[1],Ve,P[0],P[1],Be,f,m),Qe=Math.min(Ue!==null?Ue:Number.MAX_VALUE,$e!==null?$e:Number.MAX_VALUE);if(Qe!==Number.MAX_VALUE)return Qe;{const ze=sh([],f,m,V);if(T0(Be,He,Ve,Pe,v0(ze[0],P[0],D[0]),v0(ze[1],P[1],D[1]))>=ze[2])return V}continue}let te=0;for(let oe=0;oe<this._siblingOffset.length;oe++){b0((W<<1)+this._siblingOffset[oe][0],(ee<<1)+this._siblingOffset[oe][1],le+1,e,i,l,h,P,D),P[2]=-100,D[2]=this.maximums[this.childOffsets[B]+oe]*x;const de=y0(P,D,f,m);if(de!=null){const ue=de;E[oe]=ue;let Ce=!1;for(let Se=0;Se<te&&!Ce;Se++)ue>=E[A[Se]]&&(A.splice(Se,0,oe),Ce=!0);Ce||(A[te]=oe),te++}}for(let oe=0;oe<te;oe++){const de=A[oe];O.push({idx:this.childOffsets[B]+de,t:E[de],nodex:(W<<1)+this._siblingOffset[de][0],nodey:(ee<<1)+this._siblingOffset[de][1],depth:le+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,h,f){if(e[h].isLeaf(i,l)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=h-1,x=e[m];let w=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const P=2*i+this._siblingOffset[A][0],D=2*l+this._siblingOffset[A][1],O=x.getElevation(P,D),B=x.isLeaf(P,D),V=this._addNode(O.min,O.max,B);B&&(w|=1<<A),E||(E=V)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(e,2*i+this._siblingOffset[A][0],2*l+this._siblingOffset[A][1],m,E+A)}}function T0(t,e,i,l,h,f){return Ut(Ut(t,i,f),Ut(e,l,f),h)}function bo(t,e,i){const l=i.dim,h=bt(t*l-.5,0,l-1),f=bt(e*l-.5,0,l-1),m=Math.floor(h),x=Math.floor(f),w=Math.min(m+1,l-1),E=Math.min(x+1,l-1);return T0(i.get(m,x),i.get(w,x),i.get(m,E),i.get(w,E),h-m,f-x)}const E0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function I2(t,e,i){return(256*t*256+256*e+i)/10-1e4}function P2(t,e,i){return 256*t+e+i/256-32768}class zd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,h=!1,f=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Ti(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,x=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let w=0;w<m;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(m,w)]=x[this._idx(m-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,m)]=x[this._idx(w,m-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(m,-1)]=x[this._idx(m-1,0)],x[this._idx(-1,m)]=x[this._idx(0,m-1)],x[this._idx(m,m)]=x[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new w0(this)}get(e,i,l=!1){l&&(e=bt(e,-1,this.dim),i=bt(i,-1,this.dim));const h=4*this._idx(e,i);return(this.encoding==="terrarium"?P2:I2)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return E0[e]}get unpackVector(){return E0[this.encoding]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],h=zd.getUnpackVector(i);let f=Math.floor((e+h[3])/h[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new Hn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,f=i*this.dim+this.dim,m=l*this.dim,x=l*this.dim+this.dim;switch(i){case-1:h=f-1;break;case 1:f=h+1}switch(l){case-1:m=x-1;break;case 1:x=m+1}const w=-i*this.dim,E=-l*this.dim;for(let A=m;A<x;A++)for(let P=h;P<f;P++){const D=4*this._idx(P,A),O=4*this._idx(P+w,A+E);this.pixels[D+0]=e.pixels[O+0],this.pixels[D+1]=e.pixels[O+1],this.pixels[D+2]=e.pixels[O+2],this.pixels[D+3]=e.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}ht(zd,"DEMData"),ht(w0,"DemMinMaxQuadTree",{omit:["dem"]});class k2{constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,l){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const f={value:i,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(e,f)},l)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const l=e.wrapped().key,h=i===void 0?0:this.data[l].indexOf(i),f=this.data[l][h];return this.data[l].splice(h,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const l in this.data)for(const h of this.data[l])e(h.value)||i.push(h);for(const l of i)this.remove(l.value.tileID,l)}}class Ul{constructor(e,i,l){this.func=e,this.mask=i,this.range=l}}Ul.ReadOnly=!1,Ul.ReadWrite=!0,Ul.disabled=new Ul(519,Ul.ReadOnly,[0,1]);const Hf=7680;class Xf{constructor(e,i,l,h,f,m){this.test=e,this.ref=i,this.mask=l,this.fail=h,this.depthFail=f,this.pass=m}}Xf.disabled=new Xf({func:519,mask:0},0,0,Hf,Hf,Hf);class sr{constructor(e,i,l){this.blendFunction=e,this.blendColor=i,this.mask=l}}sr.Replace=[1,0],sr.disabled=new sr(sr.Replace,Oi.transparent,[!1,!1,!1,!1]),sr.unblended=new sr(sr.Replace,Oi.transparent,[!0,!0,!0,!0]),sr.alphaBlended=new sr([1,771],Oi.transparent,[!0,!0,!0,!0]);const Yf=1029,Kf=2305;class js{constructor(e,i,l){this.enable=e,this.mode=i,this.frontFace=l}}js.disabled=new js(!1,Yf,Kf),js.backCCW=new js(!0,Yf,Kf),js.backCW=new js(!0,Yf,2304),js.frontCW=new js(!0,1028,2304),js.frontCCW=new js(!0,1028,Kf);class Ea extends Vo{constructor(e,i,l){super(),this.id=e,this._onlySymbols=l,i.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new k2(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new C2,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return gn(this._tiles).map(e=>e.tileID).sort(S0).map(e=>e.key)}getRenderableIds(e){const i=[];for(const l in this._tiles)this._isIdRenderable(+l,e)&&i.push(this._tiles[l]);return e?i.sort((l,h)=>{const f=l.tileID,m=h.tileID,x=new Le(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),w=new Le(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||w.y-x.y||w.x-x.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort(S0).map(l=>l.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=i),this._loadTile(l,this._tileLoaded.bind(this,l,e,i)))}_tileLoaded(e,i,l,h){if(h)if(e.state="errored",h.status!==404)this._source.fire(new Ts(h,{tile:e}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ws.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new _r("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const f=i[h];if(e.neighboringTiles&&e.neighboringTiles[f]){const m=this.getTileByID(f);l(e,m),l(m,e)}}function l(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-h.tileID.canonical.x;const x=f.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),E=f.tileID.key;m===0&&x===0||Math.abs(x)>1||(Math.abs(m)>1&&(Math.abs(m+w)===1?m+=w:Math.abs(m-w)===1&&(m-=w)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,m,x),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,l,h){for(const f in this._tiles){let m=this._tiles[f];if(h[f]||!m.hasData()||m.tileID.overscaledZ<=i||m.tileID.overscaledZ>l)continue;let x=m.tileID;for(;m&&m.tileID.overscaledZ>i+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(x=E)}let w=x;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),e[w.key]){h[x.key]=x;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=e.overscaledZ-1;l>=i;l--){const h=e.scaledTo(l),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const l=Math.ceil(e.width/i)+1,h=Math.ceil(e.height/i)+1,f=Math.floor(l*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(x)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const l={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),l[f.tileID.key]=f}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,i,l){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new An(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const f=this._updateRetainedTiles(h);if(M0(this._source.type)&&h.length!==0){const x={},w={},E=Object.keys(f);for(const P of E){const D=f[P],O=this._tiles[P];if(!O||O.fadeEndTime&&O.fadeEndTime<=ws.now())continue;const B=this.findLoadedParent(D,Math.max(D.overscaledZ-Ea.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),x[B.tileID.key]=B.tileID),w[P]=D}const A=h[h.length-1].overscaledZ;for(const P in this._tiles){const D=this._tiles[P];if(f[P]||!D.hasData())continue;let O=D.tileID;for(;O.overscaledZ>A;){O=O.scaledTo(O.overscaledZ-1);const B=this._tiles[O.key];if(B&&B.hasData()&&w[O.key]){f[P]=D.tileID;break}}}for(const P in x)f[P]||(this._coveredTiles[P]=!0,f[P]=x[P])}for(const x in f)this._tiles[x].clearFadeHold();const m=function(x,w){const E=[];for(const A in x)A in w||E.push(A);return E}(this._tiles,f);for(const x of m){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const l={},h=e.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),f=e[0].overscaledZ,m=Math.max(f-Ea.maxOverzooming,this._source.minzoom),x=Math.max(f+Ea.maxUnderzooming,this._source.minzoom),w={};for(const E of e){const A=this._addTile(E);i[E.key]=E,A.hasData()||h<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,h,x,i);for(const E of e){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const D=E.children(this._source.maxzoom)[0],O=this.getTile(D);if(O&&O.hasData()){i[D.key]=D;continue}}else{const D=E.children(this._source.maxzoom);if(i[D[0].key]&&i[D[1].key]&&i[D[2].key]&&i[D[3].key])continue}let P=A.wasRequested();for(let D=E.overscaledZ-1;D>=m;--D){const O=E.scaledTo(D);if(l[O.key]||(l[O.key]=!0,A=this.getTile(O),!A&&P&&(A=this._addTile(O)),A&&(i[O.key]=O,P=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let l,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}i.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;h=f}for(const f of i)this._loadedParentTiles[f]=l}}_addTile(e){let i=this._tiles[e.key];if(i)return i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const l=!!i;if(!l){const h=this.map?this.map.painter:null;i=new Zf(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,l||this._source.fire(new _r("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=i.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,l){const h=[],f=this.transform;if(!f)return h;const m=f.projection.name==="globe",x=er(f.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(l&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(m){const P=E.tileID.canonical;if(P.z===0){const D=[Math.abs(bt(x,...Ih(P,-1))-x),Math.abs(bt(x,...Ih(P,1))-x)];A=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(bt(x,...Ih(P,-1))-x),Math.abs(bt(x,...Ih(P,0))-x),Math.abs(bt(x,...Ih(P,1))-x)];A=[D.indexOf(Math.min(...D))-1]}}else A=[0];for(const P of A){const D=e.containsTile(E,f,i,P);D&&h.push(D)}}return h}getVisibleCoordinates(e){const i=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of i)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(M0(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ws.now())return!0}return!1}setFeatureState(e,i,l){this._state.updateState(e=e||"_geojsonTileLayer",i,l)}removeFeatureState(e,i,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,l)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,l){const h=this._tiles[e];h&&h.setDependencies(i,l)}reloadTilesForDependencies(e,i){for(const l in this._tiles)this._tiles[l].hasDependency(e,i)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(e,i))};return void this._source.on("data",x)}const l=new Map,h=Array.isArray(e)?e:[e],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const x of h){const w=x.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)l.set(E.key,E);this.usedForTerrain&&x.updateElevation(!1)}ki(Array.from(l.values()),(x,w)=>{const E=new Zf(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(A,E)})},i)}}function S0(t,e){const i=Math.abs(2*t.wrap)-+(t.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||l-i||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function M0(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Ih(t,e){const i=1<<t.z;return[t.x/i+e,(t.x+1)/i+e]}Ea.maxOverzooming=10,Ea.maxUnderzooming=3;class Rd{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const h=l||e.findDEMTileFor(i);if(!h||!h.dem)return;const f=h.dem,m=h.tileID,x=1<<i.canonical.z-m.canonical.z;return new Rd(h,h.tileSize/yt/x,[(i.canonical.x/x-m.canonical.x)*f.dim,(i.canonical.y/x-m.canonical.y)*f.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(l);return new Le(h,f)}getElevationAt(e,i,l,h){const f=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],x=Math.floor(f),w=Math.floor(m),E=this._dem;return h=!!h,l?Ut(Ut(E.get(x,w,h),E.get(x,w+1,h),m-w),Ut(E.get(x+1,w,h),E.get(x+1,w+1,h),m-w),f-x):E.get(x,w,h)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Bs(1,e)*this._dem.stride}}class A0{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new wr(yt,16,0),this.featureIndexArray=new da,this.promoteId=i}insert(e,i,l,h,f,m=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,f,m);const w=this.grid;for(let E=0;E<i.length;E++){const A=i[E],P=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const O=A[D];P[0]=Math.min(P[0],O.x),P[1]=Math.min(P[1],O.y),P[2]=Math.max(P[2],O.x),P[3]=Math.max(P[3],O.y)}P[0]<yt&&P[1]<yt&&P[2]>=0&&P[3]>=0&&w.insert(x,P[0],P[1],P[2],P[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new kf(new bd(this.rawTileData)).layers,this.sourceLayerCoder=new d0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,l,h){this.loadVTLayers();const f=e.params||{},m=gl(f.filter),x=e.tileResult,w=e.transform,E=x.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(B,V,W,ee)=>Jm(x.bufferedTilespaceGeometry,B,V,W,ee));A.sort(D2);let P=null;w.elevation&&A.length>0&&(P=Rd.create(w.elevation,this.tileID));const D={};let O;for(let B=0;B<A.length;B++){const V=A[B];if(V===O)continue;O=V;const W=this.featureIndexArray.get(V);let ee=null;this.loadMatchingFeature(D,W,m,f.layers,f.availableImages,i,l,h,(le,te,oe,de=0)=>(ee||(ee=Ir(le,this.tileID.canonical,e.tileTransform)),te.queryIntersectsFeature(x,le,oe,ee,this.z,e.transform,e.pixelPosMatrix,P,de)))}return D}loadMatchingFeature(e,i,l,h,f,m,x,w,E){const{featureIndex:A,bucketIndex:P,sourceLayerIndex:D,layoutVertexArrayOffset:O}=i,B=this.bucketLayerIDs[P];if(h&&!function(le,te){for(let oe=0;oe<le.length;oe++)if(te.indexOf(le[oe])>=0)return!0;return!1}(h,B))return;const V=this.sourceLayerCoder.decode(D),W=this.vtLayers[V].feature(A);if(l.needGeometry){const le=va(W,!0);if(!l.filter(new C(this.tileID.overscaledZ),le,this.tileID.canonical))return}else if(!l.filter(new C(this.tileID.overscaledZ),W))return;const ee=this.getId(W,V);for(let le=0;le<B.length;le++){const te=B[le];if(h&&h.indexOf(te)<0)continue;const oe=m[te];if(!oe)continue;let de={};ee!==void 0&&w&&(de=w.getState(oe.sourceLayer||"_geojsonTileLayer",ee));const ue=_i({},x[te]);ue.paint=C0(ue.paint,oe.paint,W,de,f),ue.layout=C0(ue.layout,oe.layout,W,de,f);const Ce=!E||E(W,oe,de,O);if(!Ce)continue;const Se=new p0(W,this.z,this.x,this.y,ee);Se.layer=ue;let Be=e[te];Be===void 0&&(Be=e[te]=[]),Be.push({featureIndex:A,feature:Se,intersectionZ:Ce})}}lookupSymbolFeatures(e,i,l,h,f,m,x,w){const E={};this.loadVTLayers();const A=gl(f);for(const P of e)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},A,m,x,w,i);return E}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),f=this.vtFeatures[h];if(f[i])return f[i];const m=this.vtLayers[h].feature(i);return f[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];h!=null&&(l=e.properties[h]),typeof l=="boolean"&&(l=Number(l))}return l}}function C0(t,e,i,l,h){return Nt(t,(f,m)=>{const x=e instanceof Q?e.get(m):null;return x&&x.evaluate?x.evaluate(i,l,h):x})}function D2(t,e){return e-t}ht(A0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class I0{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Pr({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=vs(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const h=[];let f=e.length%2==1?-e[e.length-1]*l:0,m=e[0]*l,x=!0;h.push({left:f,right:m,isDash:x,zeroLength:e[0]===0});let w=e[0];for(let E=1;E<e.length;E++){x=!x;const A=e[E];f=w*l,w+=A,m=w*l,h.push({left:f,right:m,isDash:x,zeroLength:A===0})}return h}addRoundDash(e,i,l){const h=i/2;for(let f=-l;f<=l;f++){const m=this.width*(this.nextRow+l+f);let x=0,w=e[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=e[++x]);const A=Math.abs(E-w.left),P=Math.abs(E-w.right),D=Math.min(A,P);let O;const B=f/l*(h+1);if(w.isDash){const V=h-Math.abs(B);O=Math.sqrt(D*D+V*V)}else O=h-Math.sqrt(D*D+B*B);this.image.data[m+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const E=e[w],A=e[w+1];E.zeroLength?e.splice(w,1):A&&A.isDash===E.isDash&&(A.left=E.left,e.splice(w,1))}const l=e[0],h=e[e.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const f=this.width*this.nextRow;let m=0,x=e[m];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++m]);const E=Math.abs(w-x.left),A=Math.abs(w-x.right),P=Math.min(E,A);this.image.data[f+w]=Math.max(0,Math.min(255,(x.isDash?P:-P)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const h=i==="round",f=h?7:0,m=2*f+1;if(this.nextRow+m>this.height)return Ti("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let A=0;A<e.length;A++)e[A]<0&&(Ti("Negative value is found in line dasharray, replacing values with 0"),e[A]=0),x+=e[A];if(x!==0){const A=this.width/x,P=this.getDashRanges(e,this.width,A);h?this.addRoundDash(P,A,f):this.addRegularDash(P,i==="square"?.5*A:0)}const w=this.nextRow+f;this.nextRow+=m;const E={tl:[w,f],br:[x,0]};return this.positions[l]=E,E}}ht(I0,"LineAtlas");const P0=1*Ns;class k0{constructor(e){const i={},l=[];for(const x in e){const w=e[x],E=i[x]={};for(const A in w.glyphs){const P=w.glyphs[+A];if(!P||P.bitmap.width===0||P.bitmap.height===0)continue;const D=P.metrics.localGlyph?P0:1,O={x:0,y:0,w:P.bitmap.width+2*D,h:P.bitmap.height+2*D};l.push(O),E[A]=O}}const{w:h,h:f}=Rf(l),m=new Pr({width:h||1,height:f||1});for(const x in e){const w=e[x];for(const E in w.glyphs){const A=w.glyphs[+E];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const P=i[x][E],D=A.metrics.localGlyph?P0:1;Pr.copy(A.bitmap,m,{x:0,y:0},{x:P.x+D,y:P.y+D},A.bitmap)}}this.image=m,this.positions=i}}ht(k0,"GlyphAtlas");class L2{constructor(e){this.tileID=new An(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Ta(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,i,l,h,f){this.status="parsing",this.data=e,this.collisionBoxArray=new ri;const m=new d0(Object.keys(e.layers).sort()),x=new A0(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},E=new I0(256,256),A={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:l},P=i.familiesBySource[this.source];for(const de in P){const ue=e.layers[de];if(!ue)continue;let Ce=!1,Se=!1;for(const Pe of P[de])Pe[0].type==="symbol"?Ce=!0:Se=!0;if(this.isSymbolTile===!0&&!Ce||this.isSymbolTile===!1&&!Se)continue;ue.version===1&&Ti(`Vector tile source "${this.source}" layer "${de}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Be=m.encode(de),He=[];for(let Pe=0;Pe<ue.length;Pe++){const Ve=ue.feature(Pe),Ue=x.getId(Ve,de);He.push({feature:Ve,id:Ue,index:Pe,sourceLayerIndex:Be})}for(const Pe of P[de]){const Ve=Pe[0];this.isSymbolTile!==void 0&&Ve.type==="symbol"!==this.isSymbolTile||Ve.minzoom&&this.zoom<Math.floor(Ve.minzoom)||Ve.maxzoom&&this.zoom>=Ve.maxzoom||Ve.visibility!=="none"&&(Jf(Pe,this.zoom,l),(w[Ve.id]=Ve.createBucket({index:x.bucketLayerIDs.length,layers:Pe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Be,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(He,A,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Pe.map(Ue=>Ue.id)))}}let D,O,B,V;E.trim();const W={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=()=>{if(D)return f(D);if(O&&B&&V){const de=new k0(O),ue=new Fg(B,V);for(const Ce in w){const Se=w[Ce];Se instanceof yo?(Jf(Se.layers,this.zoom,l),r2(Se,O,de.positions,B,ue.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):Se.hasPattern&&(Se instanceof yd||Se instanceof pd||Se instanceof gh)&&(Jf(Se.layers,this.zoom,l),Se.addFeatures(A,this.tileID.canonical,ue.patternPositions,l,this.tileTransform))}this.status="done",f(null,{buckets:gn(w).filter(Ce=>!Ce.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:de.image,lineAtlas:E,imageAtlas:ue,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?de.positions:null})}},le=Nt(A.glyphDependencies,de=>Object.keys(de).map(Number));Object.keys(le).length?h.send("getGlyphs",{uid:this.uid,stacks:le},(de,ue)=>{D||(D=de,O=ue,ee())},void 0,!1,W):O={};const te=Object.keys(A.iconDependencies);te.length?h.send("getImages",{icons:te,source:this.source,tileID:this.tileID,type:"icons"},(de,ue)=>{D||(D=de,B=ue,ee())},void 0,!1,W):B={};const oe=Object.keys(A.patternDependencies);oe.length?h.send("getImages",{icons:oe,source:this.source,tileID:this.tileID,type:"patterns"},(de,ue)=>{D||(D=de,V=ue,ee())},void 0,!1,W):V={},ee()}}function Jf(t,e,i){const l=new C(e);for(const h of t)h.recalculate(l,i)}class D0{constructor(e){this.entries={},this.scheduler=e}request(e,i,l,h){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[m,x]=f.result;return this.scheduler?this.scheduler.add(()=>{h(m,x)},i):h(m,x),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=l((m,x)=>{f.result=[m,x];for(const w of f.callbacks)this.scheduler?this.scheduler.add(()=>{w(m,x)},i):w(m,x);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==h),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function L0(t,e,i){const l=JSON.stringify(t.request);return t.data&&(this.deduped.entries[l]={result:[null,t.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},h=>{const f=qr(t.request,(m,x,w,E)=>{m?h(m):x&&h(null,{vectorTile:i?void 0:new kf(new bd(x)),rawData:x,cacheControl:w,expires:E})});return()=>{f.cancel(),h()}},e)}const z0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Qf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const f=z0[15&l];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new Qf(x,m,f,e)}constructor(e,i=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=z0.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return e_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:x}=this,w=[0,f.length-1,0],E=[];for(;w.length;){const A=w.pop()||0,P=w.pop()||0,D=w.pop()||0;if(P-D<=x){for(let W=D;W<=P;W++){const ee=m[2*W],le=m[2*W+1];ee>=e&&ee<=l&&le>=i&&le<=h&&E.push(f[W])}continue}const O=D+P>>1,B=m[2*O],V=m[2*O+1];B>=e&&B<=l&&V>=i&&V<=h&&E.push(f[O]),(A===0?e<=B:i<=V)&&(w.push(D),w.push(O-1),w.push(1-A)),(A===0?l>=B:h>=V)&&(w.push(O+1),w.push(P),w.push(1-A))}return E}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:m}=this,x=[0,h.length-1,0],w=[],E=l*l;for(;x.length;){const A=x.pop()||0,P=x.pop()||0,D=x.pop()||0;if(P-D<=m){for(let W=D;W<=P;W++)O0(f[2*W],f[2*W+1],e,i)<=E&&w.push(h[W]);continue}const O=D+P>>1,B=f[2*O],V=f[2*O+1];O0(B,V,e,i)<=E&&w.push(h[O]),(A===0?e-l<=B:i-l<=V)&&(x.push(D),x.push(O-1),x.push(1-A)),(A===0?e+l>=B:i+l>=V)&&(x.push(O+1),x.push(P),x.push(1-A))}return w}}function e_(t,e,i,l,h,f){if(h-l<=i)return;const m=l+h>>1;R0(t,e,m,l,h,f),e_(t,e,i,l,m-1,1-f),e_(t,e,i,m+1,h,1-f)}function R0(t,e,i,l,h,f){for(;h>l;){if(h-l>600){const E=h-l+1,A=i-l+1,P=Math.log(E),D=.5*Math.exp(2*P/3),O=.5*Math.sqrt(P*D*(E-D)/E)*(A-E/2<0?-1:1);R0(t,e,i,Math.max(l,Math.floor(i-A*D/E+O)),Math.min(h,Math.floor(i+(E-A)*D/E+O)),f)}const m=e[2*i+f];let x=l,w=h;for(Ph(t,e,l,i),e[2*h+f]>m&&Ph(t,e,l,h);x<w;){for(Ph(t,e,x,w),x++,w--;e[2*x+f]<m;)x++;for(;e[2*w+f]>m;)w--}e[2*l+f]===m?Ph(t,e,l,w):(w++,Ph(t,e,w,h)),w<=i&&(l=w+1),i<=w&&(h=w-1)}}function Ph(t,e,i,l){t_(t,i,l),t_(e,2*i,2*l),t_(e,2*i+1,2*l+1)}function t_(t,e,i){const l=t[e];t[e]=t[i],t[i]=l}function O0(t,e,i,l){const h=t-i,f=e-l;return h*h+f*f}r.ARRAY_TYPE=Zn,r.AUTH_ERR_MSG=pe,r.Aabb=Mn,r.Actor=class{constructor(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.cancelCallbacks={},hr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=bs()?t:T,this.scheduler=new M2}send(t,e,i,l,h=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[m]=i);const x=Ur(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:t,hasCallback:!!i,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:co(e,x)},x),{cancel:()=>{i&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(t){const e=t.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){const l=this.cancelCallbacks[i];delete this.cancelCallbacks[i],l&&l.cancel()}else if(e.mustQueue||bs()){const l=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,e),l&&l.metadata||{type:"message"})}else this.processTask(i,e)}processTask(t,e){if(e.type==="<response>"){const i=this.callbacks[t];delete this.callbacks[t],i&&(e.error?i(Tr(e.error)):i(null,Tr(e.data)))}else{const i=Ur(this.globalScope)?void 0:[],l=e.hasCallback?(f,m)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?co(f):null,data:co(m,i)},i)}:f=>{},h=Tr(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,l);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],h.source)[f[1]](h,l)}else l(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},r.CanonicalTileID=gd,r.Color=Oi,r.ColorMode=sr,r.CullFaceMode=js,r.DEMData=zd,r.DataConstantProperty=j,r.DedupedRequest=D0,r.DepthMode=Ul,r.EXTENT=yt,r.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,h=Math.floor(t.x),f=Math.floor((t.x-h)*l),m=Math.floor(t.y*l),x=this.findDEMTileFor(new An(i,h,i,f,m));return!(!x||!x.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||t.y<0||t.y>1)return e;const h=l.getSource().maxzoom,f=1<<h,m=Math.floor(t.x),x=t.x-m,w=new An(h,m,h,Math.floor(x*f),Math.floor(t.y*f)),E=this.findDEMTileFor(w);if(!E||!E.dem)return e;const A=E.dem,P=1<<E.tileID.canonical.z,D=(x*P-E.tileID.canonical.x)*A.dim,O=(t.y*P-E.tileID.canonical.y)*A.dim,B=Math.floor(D),V=Math.floor(O);return(i?this.exaggeration():1)*Ut(Ut(A.get(B,V),A.get(B,V+1),O-V),Ut(A.get(B+1,V),A.get(B+1,V+1),O-V),D-B)}getAtTileOffset(t,e,i){const l=1<<t.canonical.z;return this.getAtPointOrZero(new Cl(t.wrap+(t.canonical.x+e/yt)/l,(t.canonical.y+i/yt)/l))}getAtTileOffsetFunc(t,e,i,l){return h=>{const f=this.getAtTileOffset(t,h.x,h.y),m=l.upVector(t.canonical,h.x,h.y);return ns(m,m,f*l.upVectorScale(t.canonical,e,i).metersToTile),m}}getForTilePoints(t,e,i,l){if(this.isUsingMockSource())return!1;const h=Rd.create(this,t,l);return!!h&&(e.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,h=1<<t.canonical.z-l.canonical.z;let f=t.canonical.x/h-l.canonical.x,m=t.canonical.y/h-l.canonical.y,x=0;for(let w=0;w<t.canonical.z-l.canonical.z&&!i.leaves[x];w++){f*=2,m*=2;const E=2*Math.floor(m)+Math.floor(f);x=i.childOffsets[x]+E,f%=1,m%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},r.ErrorEvent=Ts,r.EvaluationParameters=C,r.Event=_r,r.Evented=Vo,r.FillExtrusionBucket=gh,r.Frustum=lf,r.FrustumCorners=af,r.GLOBE_RADIUS=Js,r.GLOBE_SCALE_MATCH_LATITUDE=45,r.GLOBE_ZOOM_THRESHOLD_MAX=Rm,r.GLOBE_ZOOM_THRESHOLD_MIN=cf,r.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const i=new Ze,l=new _t,h=[],f=t+1+2,m=e[0]+1,x=e[0]+1+(1+e.length),w=(E,A,P)=>{let D=E===f-1?E-2:E===0?E:E-1;return D+=P?24575:0,[D,A]};for(let E=0;E<f;++E)i.emplaceBack(...w(E,0,!0));for(let E=0;E<m;++E)for(let A=0;A<f;++A)i.emplaceBack(...w(A,E,(A===0||A===f-1)&&!0));for(let E=0;E<e.length;++E){const A=e[E];for(let P=0;P<f;++P)i.emplaceBack(...w(P,A,!0))}for(let E=0;E<e.length;++E){const A=l.length,P=e[E]+1+2,D=new _t;for(let V=0;V<P-1;V++){const W=V===P-2,ee=W?f*(x-e.length+E-V):f;for(let le=0;le<f-1;le++){const te=V*f+le;V===0||W||le===0||le===f-2?(D.emplaceBack(te+1,te,te+ee),D.emplaceBack(te+ee,te+ee+1,te+1)):(l.emplaceBack(te+1,te,te+ee),l.emplaceBack(te+ee,te+ee+1,te+1))}}const O=Ui.simpleSegment(0,A,i.length,l.length-A);for(let V=0;V<D.uint16.length;V+=3)l.emplaceBack(D.uint16[V],D.uint16[V+1],D.uint16[V+2]);const B=Ui.simpleSegment(0,A,i.length,l.length-A);h.push({withoutSkirts:O,withSkirts:B})}return{vertices:i,indices:l,segments:h}}_createGrid(t){const e=this._fillGridMeshWithLods(ya,ah);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,oh.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new _t;for(let h=0;h<=ya;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const i=new si,l=new si;this._poleSegments=[];for(let h=0,f=0;h<cf;h++){const m=360/(1<<h);i.emplaceBack(0,-Js,0,.5,0),l.emplaceBack(0,-Js,0,.5,1);for(let x=0;x<=ya;x++){const w=x/ya,E=Ut(0,m,w),[A,P,D]=Sl(Mv,Av,E,Js);i.emplaceBack(A,P,D,w,0),l.emplaceBack(A,P,D,w,1)}this._poleSegments.push(Ui.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(i,Lm,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(l,Lm,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const i=new nn,l=ya,h=l+1+2,f=1;this._wireframeSegments=[];for(let m=0,x=0;m<ah.length;m++){const w=ah[m];for(let A=f;A<w+f;A++)for(let P=f;P<l+f;P++){const D=A*h+P;i.emplaceBack(D,D+1),i.emplaceBack(D,D+h),i.emplaceBack(D,D+h+1)}const E=w*l*3;this._wireframeSegments.push(Ui.simpleSegment(0,x,(w+1)*h,E)),x+=E}this._wireframeIndexBuffer=t.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},r.GlyphManager=Bl,r.ImagePosition=Of,r.KDBush=Qf,r.LivePerformanceUtils=Cp,r.LngLat=oi,r.LngLatBounds=fo,r.LocalGlyphMode=Nf,r.MAX_MERCATOR_LATITUDE=_n,r.MercatorCoordinate=Cl,r.ONE_EM=ln,r.OverscaledTileID=An,r.PerformanceMarkers=Wr,r.Point=Le,r.Properties=se,r.RGBAImage=Hn,r.Ray=of,r.RequestManager=class{constructor(t,e,i){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",De,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ye(t))return t;const i=it(t);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ye(t))return t;const i=it(t);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(t,e,i,l){if(!ye(t))return t;const h=it(t);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),i&&h.params.push(`language=${i}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(t,e,i,l){const h=it(t);return ye(t)?(h.path=`/styles/v1${h.path}/sprite${e}${i}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${e}${i}`,Ke(h))}normalizeTileURL(t,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ye(t))return t;const l=it(t);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&l.authority!=="raster"&&i===512?"@2x":""}${U.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${F.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${F.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(f){for(const m of f){const x=m.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(t,e){const i=it(t);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return t;let l="mapbox://";i.path.match(/^\/raster\/v1\//)?l+=`raster/${i.path.replace(`/${F.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${i.path.replace(`/${F.TILE_URL_VERSION}/`,"")}`;let h=i.params;return e&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(t,e){const i=!!e&&ye(e),l=[];for(const h of t.tiles||[])Te(h)?l.push(this.canonicalizeTileURL(h,i)):l.push(h);return l}_makeAPIURL(t,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=it(F.API_URL);if(t.protocol=l.protocol,t.authority=l.authority,t.protocol==="http"){const h=t.params.indexOf("secure");h>=0&&t.params.splice(h,1)}if(l.path!=="/"&&(t.path=`${l.path}${t.path}`),!F.REQUIRE_ACCESS_TOKEN)return Ke(t);if(e=e||F.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return t.params=t.params.filter(h=>h.indexOf("access_token")===-1),t.params.push(`access_token=${e||""}`),Ke(t)}},r.ResourceType=dr,r.SegmentVector=Ui,r.SourceCache=Ea,r.StencilMode=Xf,r.StructArrayLayout1ui2=Wn,r.StructArrayLayout2f1f2i16=xt,r.StructArrayLayout2i4=Ze,r.StructArrayLayout2ui4=nn,r.StructArrayLayout3f12=Dt,r.StructArrayLayout3ui6=_t,r.StructArrayLayout4i8=je,r.StructArrayLayout5f20=si,r.Texture=Ch,r.Tile=Zf,r.Transitionable=N,r.Uniform1f=ed,r.Uniform1i=class extends Mr{constructor(t){super(t),this.current=0}set(t,e,i){this.fetchUniformLocation(t,e)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},r.Uniform2f=class extends Mr{constructor(t){super(t),this.current=[0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},r.Uniform3f=class extends Mr{constructor(t){super(t),this.current=[0,0,0]}set(t,e,i){this.fetchUniformLocation(t,e)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},r.Uniform4f=mm,r.UniformColor=gm,r.UniformMatrix2f=class extends Mr{constructor(t){super(t),this.current=hv}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let l=0;l<4;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},r.UniformMatrix3f=class extends Mr{constructor(t){super(t),this.current=cv}set(t,e,i){if(this.fetchUniformLocation(t,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.UniformMatrix4f=class extends Mr{constructor(t){super(t),this.current=lv}set(t,e,i){if(this.fetchUniformLocation(t,e)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let l=1;l<16;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},r.UnwrappedTileID=Tg,r.ValidationError=ct,r.VectorTileFeature=_d,r.VectorTileWorkerSource=class extends Vo{constructor(t,e,i,l,h){super(),this.actor=t,this.layerIndex=e,this.availableImages=i,this.loadVectorData=h||L0,this.loading={},this.loaded={},this.deduped=new D0(t.scheduler),this.isSpriteLoaded=l,this.scheduler=t.scheduler}loadTile(t,e){const i=t.uid,l=t&&t.request,h=l&&l.collectResourceTiming,f=this.loading[i]=new L2(t);f.abort=this.loadVectorData(t,(m,x)=>{const w=!this.loading[i];if(delete this.loading[i],w||m||!x)return f.status="done",w||(this.loaded[i]=f),e(m);const E=x.rawData,A={};x.expires&&(A.expires=x.expires),x.cacheControl&&(A.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new kf(new bd(E));const P=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(D,O)=>{if(D||!O)return e(D);const B={};if(h){const V=nc(l);V.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify(V)))}e(null,_i({rawTileData:E.slice(0)},O,A,B))})};this.isSpriteLoaded?P():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(P,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):P()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(t,e){const i=this.loaded,l=t.uid,h=this;if(i&&i[l]){const f=i[l];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection,f.tileTransform=Ta(t.tileID.canonical,t.projection);const m=(x,w)=>{const E=f.reloadCallback;E&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,E)),e(x,w)};f.status==="parsing"?f.reloadCallback=m:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(t,e){const i=t.uid,l=this.loading[i];l&&(l.abort&&l.abort(),delete this.loading[i]),e()}removeTile(t,e){const i=this.loaded,l=t.uid;i&&i[l]&&delete i[l],e()}},r.WritingMode=rs,r.ZoomDependentExpression=ra,r.add=Cr,r.addDynamicAttributes=kd,r.adjoint=function(t,e){var i=e[0],l=e[1],h=e[2],f=e[3],m=e[4],x=e[5],w=e[6],E=e[7],A=e[8];return t[0]=m*A-x*E,t[1]=h*E-l*A,t[2]=l*x-h*m,t[3]=x*w-f*A,t[4]=i*A-h*w,t[5]=h*f-i*x,t[6]=f*E-m*w,t[7]=l*w-i*E,t[8]=i*m-l*f,t},r.asyncAll=ki,r.bezier=ti,r.bindAll=hr,r.boundsAttributes=_0,r.bufferConvexPolygon=function(t,e){const i=[];for(let l=0;l<t.length;l++){const h=xi(l-1,-1,t.length-1),f=xi(l+1,-1,t.length-1),m=t[l],x=t[f],w=t[h].sub(m).unit(),E=x.sub(m).unit(),A=E.angleWithSep(w.x,w.y),P=w.add(E).unit().mult(-1*e/Math.sin(A/2));i.push(m.add(P))}return i},r.cacheEntryPossiblyAdded=function(t){No++,No>qa&&(t.getActor().send("enforceCacheSizeLimit",$a),No=0)},r.calculateGlobeLabelMatrix=function(t,e){const{x:i,y:l}=t.point,h=jm(i,l,t.worldSize/t._pixelsPerMercatorPixel,0,0);return _a(h,h,df(Qs(e)))},r.calculateGlobeMatrix=function(t){const{x:e,y:i}=t.point,{lng:l,lat:h}=t._center;return jm(e,i,t.worldSize,l,h)},r.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,i=e/Bs(1,t.center.lat),l=Rs(new Float64Array(16));return eh(l,l,[t.point.x,t.point.y,0]),ma(l,l,[i,i,e]),Float32Array.from(l)},r.circumferenceAtLatitude=ff,r.clamp=bt,r.clearTileCache=function(t){if(!Fo())return;const e=T.caches.delete(Gr);t&&e.catch(t).then(()=>t())},r.clipLine=Kg,r.clone=function(t){var e=new Zn(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},r.clone$1=zn,r.collisionCircleLayout=kb,r.config=F,r.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},r.create=function(){var t=new Zn(16);return Zn!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},r.create$1=vm,r.createExpression=oo,r.createLayout=xe,r.createStyleLayer=function(t){return t.type==="custom"?new w2(t):new E2[t.type](t)},r.cross=rf,r.degToRad=ft,r.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},r.div=function(t,e,i){return t[0]=e[0]/i[0],t[1]=e[1]/i[1],t[2]=e[2]/i[2],t},r.dot=_s,r.earthRadius=hh,r.ease=yi,r.easeCubicInOut=Kt,r.ecefToLatLng=function([t,e,i]){const l=Math.hypot(t,e,i),h=Math.atan2(t,i),f=.5*Math.PI-Math.acos(-e/l);return new oi(Gt(h),Gt(f))},r.emitValidationErrors=Hu,r.endsWith=jr,r.enforceCacheSizeLimit=function(t){ur(),Vn&&Vn.then(e=>{e.keys().then(i=>{for(let l=0;l<i.length-t;l++)e.delete(i[l])})})},r.evaluateSizeForFeature=xd,r.evaluateSizeForZoom=Ll,r.evaluateVariableOffset=i0,r.evented=y,r.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},r.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},r.exported=ws,r.exported$1=U,r.extend=_i,r.extend$1=Es,r.fillExtrusionHeightLift=vg,r.filterObject=Vr,r.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},r.fromQuat=function(t,e){var i=e[0],l=e[1],h=e[2],f=e[3],m=i+i,x=l+l,w=h+h,E=i*m,A=l*m,P=l*x,D=h*m,O=h*x,B=h*w,V=f*m,W=f*x,ee=f*w;return t[0]=1-P-B,t[1]=A+ee,t[2]=D-W,t[3]=0,t[4]=A-ee,t[5]=1-E-B,t[6]=O+V,t[7]=0,t[8]=D+W,t[9]=O-V,t[10]=1-E-P,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},r.fromRotation=function(t,e){var i=Math.sin(e),l=Math.cos(e);return t[0]=l,t[1]=i,t[2]=0,t[3]=-i,t[4]=l,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},r.fromScaling=wm,r.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return on[e]},r.getAABBPointSquareDist=function(t,e,i){let l=0;for(let h=0;h<2;++h){const f=i?i[h]:0;t[h]>f&&(l+=(t[h]-f)*(t[h]-f)),e[h]<f&&(l+=(f-e[h])*(f-e[h]))}return l},r.getAnchorAlignment=Ff,r.getAnchorJustification=Vf,r.getBounds=function(t){let e=1/0,i=1/0,l=-1/0,h=-1/0;for(const f of t)e=Math.min(e,f.x),i=Math.min(i,f.y),l=Math.max(l,f.x),h=Math.max(h,f.y);return{min:new Le(e,i),max:new Le(l,h)}},r.getColumn=Ws,r.getDefaultExportFromCjs=Fe,r.getGridMatrix=function(t,e,i,l){const h=e.getNorth(),f=e.getSouth(),m=e.getWest(),x=e.getEast(),w=1<<t.z,E=x-m,A=h-f,P=E/ya,D=-A/ah[i],O=[0,P,0,D,0,0,h,m,0];if(t.z>0){const B=180/l;bm(O,O,[B/E+1,0,0,0,B/A+1,0,-.5*B/P,.5*B/D,1])}return O[2]=w,O[5]=t.x,O[8]=t.y,O},r.getImage=re,r.getJSON=function(t,e){return fr(_i(t,{type:"json"}),e)},r.getLatitudinalLod=function(t){const e=_n-5;t=bt(t,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(ft(t))),3);return Math.round(i*(ah.length-1))},r.getMapSessionAPI=Qi,r.getPerformanceMeasurement=nc,r.getProjection=h0,r.getRTLTextPluginStatus=b,r.getReferrer=pr,r.getTilePoint=function(t,{x:e,y:i},l=0){return new Le(((e-l)*t.scale-t.x)*yt,(i*t.scale-t.y)*yt)},r.getTileVec3=function(t,e,i=0){return El(((e.x-i)*t.scale-t.x)*yt,(e.y*t.scale-t.y)*yt,$m(e.z,e.y))},r.getVideo=function(t,e){const i=T.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<t.length;l++){const h=T.document.createElement("source");Wa(t[l])||(i.crossOrigin="Anonymous"),h.src=t[l],i.appendChild(h)}return{cancel:()=>{}}},r.globeCenterToScreenPoint=function(t){const e=[0,0,0],i=Rs(new Float64Array(16));return _a(i,t.pixelMatrix,t.globeMatrix),Bi(e,e,i),new Le(e[0],e[1])},r.globeDenormalizeECEF=df,r.globeECEFOrigin=function(t,e){const i=[0,0,0];return Bi(i,i,ch(Qs(e.canonical))),Bi(i,i,t),i},r.globeMetersToEcef=nd,r.globeNormalizeECEF=ch,r.globePixelsToTileUnits=function(t,e){return yt/(512*Math.pow(2,t))*rd(Qs(e))},r.globePoleMatrixForTile=function(t,e,i){const l=Rs(new Float64Array(16)),h=(e/(1<<t)-.5)*Math.PI*2;return id(l,i.globeMatrix,h),Float32Array.from(l)},r.globeTileBounds=Qs,r.globeTiltAtLngLat=Vm,r.globeToMercatorTransition=Al,r.globeUseCustomAntiAliasing=function(t,e,i){const l=Al(i.zoom),h=t.style.map._antialias,f=!!e.extStandardDerivatives,m=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return l===0&&!h&&!m&&f},r.identity=Rs,r.identity$1=Pm,r.invert=ef,r.isFullscreen=function(){return!!T.document.fullscreenElement||!!T.document.webkitFullscreenElement},r.isLngLatBehindGlobe=pf,r.isMapAuthenticated=function(t){return yn.has(t)},r.isMapboxURL=ye,r.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Ur(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.latFromMercatorY=fn,r.latLngToECEF=Ml,r.len=xv,r.length=th,r.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},r.lngFromMercatorX=ss,r.loadVectorTile=L0,r.makeRequest=fr,r.mapValue=function(t,e,i,l,h){return bt((t-e)/(i-e)*(h-l)+l,l,h)},r.mercatorScale=qm,r.mercatorXfromLng=er,r.mercatorYfromLat=tr,r.mercatorZfromAltitude=Bs,r.mul=gv,r.mul$1=yv,r.multiply=_a,r.multiply$1=bm,r.multiply$2=Sm,r.nextPowerOfTwo=vs,r.normalize=Sn,r.normalize$1=vv,r.normalize$2=Cm,r.number=Ut,r.ortho=function(t,e,i,l,h,f,m){var x=1/(e-i),w=1/(l-h),E=1/(f-m);return t[0]=-2*x,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*w,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*E,t[11]=0,t[12]=(e+i)*x,t[13]=(h+l)*w,t[14]=(m+f)*E,t[15]=1,t},r.pbf=Pg,r.perspective=function(t,e,i,l,h){var f,m=1/Math.tan(e/2);return t[0]=m/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=m,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,h!=null&&h!==1/0?(t[10]=(h+l)*(f=1/(l-h)),t[14]=2*h*l*f):(t[10]=-1,t[14]=-2*l),t},r.pick=function(t,e){const i={};for(let l=0;l<e.length;l++){const h=e[l];h in t&&(i[h]=t[h])}return i},r.plugin=M,r.pointGeometry=nt,r.polesInViewport=function(t){const e=Rs(new Float64Array(16));_a(e,t.pixelMatrix,t.globeMatrix);const i=[0,ms,0],l=[0,gs,0];return Bi(i,i,e),Bi(l,l,e),[i[0]>0&&i[0]<=t.width&&i[1]>0&&i[1]<=t.height&&!pf(t,new oi(t.center.lat,90)),l[0]>0&&l[0]<=t.width&&l[1]>0&&l[1]<=t.height&&!pf(t,new oi(t.center.lat,-90))]},r.polygonContainsPoint=ba,r.polygonIntersectsBox=Jm,r.polygonIntersectsPolygon=Hm,r.polygonizeBounds=function(t,e,i=0,l=!0){const h=new Le(i,i),f=t.sub(h),m=e.add(h),x=[f,new Le(m.x,f.y),m,new Le(f.x,m.y)];return l&&x.push(f.clone()),x},r.posAttributes=oh,r.postMapLoadEvent=Ni,r.postPerformanceEvent=Hi,r.postTurnstileEvent=jt,r.potpack=Rf,r.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},r.radToDeg=Gt,r.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.registerForPluginStateChange=function(t){return t({pluginStatus:p,pluginURL:n}),y.on("pluginStateChange",t),t},r.removeAuthState=function(t){yn.delete(t)},r.renderColorRamp=wf,r.resample=Wm,r.rotateX=tf,r.rotateX$1=km,r.rotateY=id,r.rotateY$1=Dm,r.rotateZ=function(t,e,i){var l=Math.sin(i),h=Math.cos(i),f=e[0],m=e[1],x=e[2],w=e[3],E=e[4],A=e[5],P=e[6],D=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*h+E*l,t[1]=m*h+A*l,t[2]=x*h+P*l,t[3]=w*h+D*l,t[4]=E*h-f*l,t[5]=A*h-m*l,t[6]=P*h-x*l,t[7]=D*h-w*l,t},r.rotateZ$1=function(t,e,i){i*=.5;var l=e[0],h=e[1],f=e[2],m=e[3],x=Math.sin(i),w=Math.cos(i);return t[0]=l*w+h*x,t[1]=h*w-l*x,t[2]=f*w+m*x,t[3]=m*w-f*x,t},r.scale=ma,r.scale$1=Am,r.scale$2=ns,r.scaleAndAdd=sh,r.set=function(t,e,i,l){return t[0]=e,t[1]=i,t[2]=l,t},r.setCacheLimits=function(t,e){$a=t,qa=e},r.setColumn=function(t,e,i){t[4*e+0]=i[0],t[4*e+1]=i[1],t[4*e+2]=i[2],t[4*e+3]=i[3]},r.setRTLTextPlugin=function(t,e,i=!1){if(p===Xc||p===Yc||p===Kc)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=ws.resolveURL(t),p=Xc,ho=e,_(),i||S()},r.smoothstep=Pi,r.spec=Oe,r.squaredLength=function(t){var e=t[0],i=t[1],l=t[2];return e*e+i*i+l*l},r.storeAuthState=function(t,e){e?yn.add(t):yn.delete(t)},r.sub=Os,r.subtract=sf,r.symbolSize=Db,r.tileAABB=function(t,e,i,l,h,f,m,x,w){if(w.name==="globe")return Sv(t,e,new gd(i,l,h));const E=Ta({z:i,x:l,y:h},w);return new Mn([(f+E.x/E.scale)*e,e*(E.y/E.scale),m],[(f+E.x2/E.scale)*e,e*(E.y2/E.scale),x])},r.tileCornersToBounds=sd,r.tileTransform=Ta,r.transformMat3=function(t,e,i){var l=e[0],h=e[1],f=e[2];return t[0]=l*i[0]+h*i[3]+f*i[6],t[1]=l*i[1]+h*i[4]+f*i[7],t[2]=l*i[2]+h*i[5]+f*i[8],t},r.transformMat4=Bi,r.transformMat4$1=ga,r.transformQuat=Mm,r.transitionTileAABBinECEF=Bm,r.translate=eh,r.transpose=function(t,e){if(t===e){var i=e[1],l=e[2],h=e[5];t[1]=e[3],t[2]=e[6],t[3]=i,t[5]=e[7],t[6]=l,t[7]=h}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},r.triggerPluginCompletionEvent=c,r.uniqueId=Nn,r.updateGlobeVertexNormal=function(t,e,i,l,h){const f=5*e+2;t.float32[f+0]=i,t.float32[f+1]=l,t.float32[f+2]=h},r.validateCustomStyleLayer=function(t){const e=[],i=t.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),t.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},r.validateFilter=t=>qn(ha(t)),r.validateFog=t=>qn(qu(t)),r.validateLayer=t=>qn(Vu(t)),r.validateLight=t=>qn($u(t)),r.validateSource=t=>qn(Gu(t)),r.validateStyle=Zu,r.validateTerrain=t=>qn($c(t)),r.values=gn,r.vectorTile=fd,r.version=I,r.warnOnce=Ti,r.window=T,r.wrap=xi}),g(["./shared"],function(r){function T(ae){if(typeof ae=="number"||typeof ae=="boolean"||typeof ae=="string"||ae==null)return JSON.stringify(ae);if(Array.isArray(ae)){let $="[";for(const re of ae)$+=`${T(re)},`;return`${$}]`}let G="{";for(const $ of Object.keys(ae).sort())G+=`${$}:${T(ae[$])},`;return`${G}}`}function I(ae){let G="";for(const $ of r.refProperties)G+=`/${T(ae[$])}`;return G}class R{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,$){for(const pe of G)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=r.createStyleLayer(pe)).compileFilter(),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(const pe of $)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const re=function(pe,ye){const Te={};for(let ge=0;ge<pe.length;ge++){const ke=ye&&ye[pe[ge].id]||I(pe[ge]);ye&&(ye[pe[ge].id]=ke);let tt=Te[ke];tt||(tt=Te[ke]=[]),tt.push(pe[ge])}const we=[];for(const ge in Te)we.push(Te[ge]);return we}(r.values(this._layerConfigs),this.keyCache);for(const pe of re){const ye=pe.map(it=>this._layers[it.id]),Te=ye[0];if(Te.visibility==="none")continue;const we=Te.source||"";let ge=this.familiesBySource[we];ge||(ge=this.familiesBySource[we]={});const ke=Te.sourceLayer||"_geojsonTileLayer";let tt=ge[ke];tt||(tt=ge[ke]=[]),tt.push(ye)}}}class F{loadTile(G,$){const{uid:re,encoding:pe,rawImageData:ye,padding:Te,buildQuadTree:we}=G,ge=r.window.ImageBitmap&&ye instanceof r.window.ImageBitmap?this.getImageData(ye,Te):ye;$(null,new r.DEMData(re,ge,pe,Te<1,we))}getImageData(G,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const re=this.offscreenCanvasContext.getImageData(-$,-$,G.width+2*$,G.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),re}}function U(ae,G){if(ae.length!==0){Y(ae[0],G);for(var $=1;$<ae.length;$++)Y(ae[$],!G)}}function Y(ae,G){for(var $=0,re=0,pe=0,ye=ae.length,Te=ye-1;pe<ye;Te=pe++){var we=(ae[pe][0]-ae[Te][0])*(ae[Te][1]+ae[pe][1]),ge=$+we;re+=Math.abs($)>=Math.abs(we)?$-ge+we:we-ge+$,$=ge}$+re>=0!=!!G&&ae.reverse()}var ie=r.getDefaultExportFromCjs(function ae(G,$){var re,pe=G&&G.type;if(pe==="FeatureCollection")for(re=0;re<G.features.length;re++)ae(G.features[re],$);else if(pe==="GeometryCollection")for(re=0;re<G.geometries.length;re++)ae(G.geometries[re],$);else if(pe==="Feature")ae(G.geometry,$);else if(pe==="Polygon")U(G.coordinates,$);else if(pe==="MultiPolygon")for(re=0;re<G.coordinates.length;re++)U(G.coordinates[re],$);return G});const ce=r.VectorTileFeature.prototype.toGeoJSON;var he={exports:{}},be=r.pointGeometry,De=r.vectorTile.VectorTileFeature,Fe=We;function We(ae,G){this.options=G||{},this.features=ae,this.length=ae.length}function Re(ae,G){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=G||4096}We.prototype.feature=function(ae){return new Re(this.features[ae],this.options.extent)},Re.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var G=0;G<ae.length;G++){for(var $=ae[G],re=[],pe=0;pe<$.length;pe++)re.push(new be($[pe][0],$[pe][1]));this.geometry.push(re)}return this.geometry},Re.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,G=1/0,$=-1/0,re=1/0,pe=-1/0,ye=0;ye<ae.length;ye++)for(var Te=ae[ye],we=0;we<Te.length;we++){var ge=Te[we];G=Math.min(G,ge.x),$=Math.max($,ge.x),re=Math.min(re,ge.y),pe=Math.max(pe,ge.y)}return[G,re,$,pe]},Re.prototype.toGeoJSON=De.prototype.toGeoJSON;var Je=r.pbf,nt=Fe;function st(ae){var G=new Je;return function($,re){for(var pe in $.layers)re.writeMessage(3,Le,$.layers[pe])}(ae,G),G.finish()}function Le(ae,G){var $;G.writeVarintField(15,ae.version||1),G.writeStringField(1,ae.name||""),G.writeVarintField(5,ae.extent||4096);var re={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<ae.length;$++)re.feature=ae.feature($),G.writeMessage(2,Lt,re);var pe=re.keys;for($=0;$<pe.length;$++)G.writeStringField(3,pe[$]);var ye=re.values;for($=0;$<ye.length;$++)G.writeMessage(4,Kt,ye[$])}function Lt(ae,G){var $=ae.feature;$.id!==void 0&&G.writeVarintField(1,$.id),G.writeMessage(2,zt,ae),G.writeVarintField(3,$.type),G.writeMessage(4,on,$)}function zt(ae,G){var $=ae.feature,re=ae.keys,pe=ae.values,ye=ae.keycache,Te=ae.valuecache;for(var we in $.properties){var ge=$.properties[we],ke=ye[we];if(ge!==null){ke===void 0&&(re.push(we),ye[we]=ke=re.length-1),G.writeVarint(ke);var tt=typeof ge;tt!=="string"&&tt!=="boolean"&&tt!=="number"&&(ge=JSON.stringify(ge));var it=tt+":"+ge,Ke=Te[it];Ke===void 0&&(pe.push(ge),Te[it]=Ke=pe.length-1),G.writeVarint(Ke)}}}function ft(ae,G){return(G<<3)+(7&ae)}function Gt(ae){return ae<<1^ae>>31}function on(ae,G){for(var $=ae.loadGeometry(),re=ae.type,pe=0,ye=0,Te=$.length,we=0;we<Te;we++){var ge=$[we],ke=1;re===1&&(ke=ge.length),G.writeVarint(ft(1,ke));for(var tt=re===3?ge.length-1:ge.length,it=0;it<tt;it++){it===1&&re!==1&&G.writeVarint(ft(2,tt-1));var Ke=ge[it].x-pe,Mt=ge[it].y-ye;G.writeVarint(Gt(Ke)),G.writeVarint(Gt(Mt)),pe+=Ke,ye+=Mt}re===3&&G.writeVarint(ft(7,1))}}function Kt(ae,G){var $=typeof ae;$==="string"?G.writeStringField(1,ae):$==="boolean"?G.writeBooleanField(7,ae):$==="number"&&(ae%1!=0?G.writeDoubleField(3,ae):ae<0?G.writeSVarintField(6,ae):G.writeVarintField(5,ae))}he.exports=st,he.exports.fromVectorTileJs=st,he.exports.fromGeojsonVt=function(ae,G){G=G||{};var $={};for(var re in ae)$[re]=new nt(ae[re].features,G),$[re].name=re,$[re].version=G.version,$[re].extent=G.extent;return st({layers:$})},he.exports.GeoJSONWrapper=nt;var ti=r.getDefaultExportFromCjs(he.exports);const yi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},bt=Math.fround||(Pi=new Float32Array(1),ae=>(Pi[0]=+ae,Pi[0]));var Pi;const xi=3,ki=5,gn=6;class _i{constructor(G){this.options=Object.assign(Object.create(yi),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:$,minZoom:re,maxZoom:pe}=this.options;$&&console.time("total time");const ye=`prepare ${G.length} points`;$&&console.time(ye),this.points=G;const Te=[];for(let ge=0;ge<G.length;ge++){const ke=G[ge];if(!ke.geometry)continue;const[tt,it]=ke.geometry.coordinates,Ke=bt(bn(tt)),Mt=bt(vs(it));Te.push(Ke,Mt,1/0,ge,-1,1),this.options.reduce&&Te.push(0)}let we=this.trees[pe+1]=this._createTree(Te);$&&console.timeEnd(ye);for(let ge=pe;ge>=re;ge--){const ke=+Date.now();we=this.trees[ge]=this._createTree(this._cluster(we,ge)),$&&console.log("z%d: %d clusters in %dms",ge,we.numItems,+Date.now()-ke)}return $&&console.timeEnd("total time"),this}getClusters(G,$){let re=((G[0]+180)%360+360)%360-180;const pe=Math.max(-90,Math.min(90,G[1]));let ye=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Te=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)re=-180,ye=180;else if(re>ye){const it=this.getClusters([re,pe,180,Te],$),Ke=this.getClusters([-180,pe,ye,Te],$);return it.concat(Ke)}const we=this.trees[this._limitZoom($)],ge=we.range(bn(re),vs(Te),bn(ye),vs(pe)),ke=we.data,tt=[];for(const it of ge){const Ke=this.stride*it;tt.push(ke[Ke+ki]>1?vn(ke,Ke,this.clusterProps):this.points[ke[Ke+xi]])}return tt}getChildren(G){const $=this._getOriginId(G),re=this._getOriginZoom(G),pe="No cluster with the specified id.",ye=this.trees[re];if(!ye)throw new Error(pe);const Te=ye.data;if($*this.stride>=Te.length)throw new Error(pe);const we=this.options.radius/(this.options.extent*Math.pow(2,re-1)),ge=ye.within(Te[$*this.stride],Te[$*this.stride+1],we),ke=[];for(const tt of ge){const it=tt*this.stride;Te[it+4]===G&&ke.push(Te[it+ki]>1?vn(Te,it,this.clusterProps):this.points[Te[it+xi]])}if(ke.length===0)throw new Error(pe);return ke}getLeaves(G,$,re){const pe=[];return this._appendLeaves(pe,G,$=$||10,re=re||0,0),pe}getTile(G,$,re){const pe=this.trees[this._limitZoom(G)],ye=Math.pow(2,G),{extent:Te,radius:we}=this.options,ge=we/Te,ke=(re-ge)/ye,tt=(re+1+ge)/ye,it={features:[]};return this._addTileFeatures(pe.range(($-ge)/ye,ke,($+1+ge)/ye,tt),pe.data,$,re,ye,it),$===0&&this._addTileFeatures(pe.range(1-ge/ye,ke,1,tt),pe.data,ye,re,ye,it),$===ye-1&&this._addTileFeatures(pe.range(0,ke,ge/ye,tt),pe.data,-1,re,ye,it),it.features.length?it:null}getClusterExpansionZoom(G){let $=this._getOriginZoom(G)-1;for(;$<=this.options.maxZoom;){const re=this.getChildren(G);if($++,re.length!==1)break;G=re[0].properties.cluster_id}return $}_appendLeaves(G,$,re,pe,ye){const Te=this.getChildren($);for(const we of Te){const ge=we.properties;if(ge&&ge.cluster?ye+ge.point_count<=pe?ye+=ge.point_count:ye=this._appendLeaves(G,ge.cluster_id,re,pe,ye):ye<pe?ye++:G.push(we),G.length===re)break}return ye}_createTree(G){const $=new r.KDBush(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let re=0;re<G.length;re+=this.stride)$.add(G[re],G[re+1]);return $.finish(),$.data=G,$}_addTileFeatures(G,$,re,pe,ye,Te){for(const we of G){const ge=we*this.stride,ke=$[ge+ki]>1;let tt,it,Ke;if(ke)tt=Nn($,ge,this.clusterProps),it=$[ge],Ke=$[ge+1];else{const At=this.points[$[ge+xi]];tt=At.properties;const[kt,jt]=At.geometry.coordinates;it=bn(kt),Ke=vs(jt)}const Mt={type:1,geometry:[[Math.round(this.options.extent*(it*ye-re)),Math.round(this.options.extent*(Ke*ye-pe))]],tags:tt};let Pt;Pt=ke||this.options.generateId?$[ge+xi]:this.points[$[ge+xi]].id,Pt!==void 0&&(Mt.id=Pt),Te.features.push(Mt)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,$){const{radius:re,extent:pe,reduce:ye,minPoints:Te}=this.options,we=re/(pe*Math.pow(2,$)),ge=G.data,ke=[],tt=this.stride;for(let it=0;it<ge.length;it+=tt){if(ge[it+2]<=$)continue;ge[it+2]=$;const Ke=ge[it],Mt=ge[it+1],Pt=G.within(ge[it],ge[it+1],we),At=ge[it+ki];let kt=At;for(const jt of Pt){const Ei=jt*tt;ge[Ei+2]>$&&(kt+=ge[Ei+ki])}if(kt>At&&kt>=Te){let jt,Ei=Ke*At,Ni=Mt*At,un=-1;const Hi=((it/tt|0)<<5)+($+1)+this.points.length;for(const ls of Pt){const Qi=ls*tt;if(ge[Qi+2]<=$)continue;ge[Qi+2]=$;const yn=ge[Qi+ki];Ei+=ge[Qi]*yn,Ni+=ge[Qi+1]*yn,ge[Qi+4]=Hi,ye&&(jt||(jt=this._map(ge,it,!0),un=this.clusterProps.length,this.clusterProps.push(jt)),ye(jt,this._map(ge,Qi)))}ge[it+4]=Hi,ke.push(Ei/kt,Ni/kt,1/0,Hi,-1,kt),ye&&ke.push(un)}else{for(let jt=0;jt<tt;jt++)ke.push(ge[it+jt]);if(kt>1)for(const jt of Pt){const Ei=jt*tt;if(!(ge[Ei+2]<=$)){ge[Ei+2]=$;for(let Ni=0;Ni<tt;Ni++)ke.push(ge[Ei+Ni])}}}}return ke}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,$,re){if(G[$+ki]>1){const Te=this.clusterProps[G[$+gn]];return re?Object.assign({},Te):Te}const pe=this.points[G[$+xi]].properties,ye=this.options.map(pe);return re&&ye===pe?Object.assign({},ye):ye}}function vn(ae,G,$){return{type:"Feature",id:ae[G+xi],properties:Nn(ae,G,$),geometry:{type:"Point",coordinates:[(re=ae[G],360*(re-.5)),Ua(ae[G+1])]}};var re}function Nn(ae,G,$){const re=ae[G+ki],pe=re>=1e4?`${Math.round(re/1e3)}k`:re>=1e3?Math.round(re/100)/10+"k":re,ye=ae[G+gn],Te=ye===-1?{}:Object.assign({},$[ye]);return Object.assign(Te,{cluster:!0,cluster_id:ae[G+xi],point_count:re,point_count_abbreviated:pe})}function bn(ae){return ae/360+.5}function vs(ae){const G=Math.sin(ae*Math.PI/180),$=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return $<0?0:$>1?1:$}function Ua(ae){const G=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function hr(ae,G,$,re){for(var pe,ye=re,Te=$-G>>1,we=$-G,ge=ae[G],ke=ae[G+1],tt=ae[$],it=ae[$+1],Ke=G+3;Ke<$;Ke+=3){var Mt=jr(ae[Ke],ae[Ke+1],ge,ke,tt,it);if(Mt>ye)pe=Ke,ye=Mt;else if(Mt===ye){var Pt=Math.abs(Ke-Te);Pt<we&&(pe=Ke,we=Pt)}}ye>re&&(pe-G>3&&hr(ae,G,pe,re),ae[pe+2]=ye,$-pe>3&&hr(ae,pe,$,re))}function jr(ae,G,$,re,pe,ye){var Te=pe-$,we=ye-re;if(Te!==0||we!==0){var ge=((ae-$)*Te+(G-re)*we)/(Te*Te+we*we);ge>1?($=pe,re=ye):ge>0&&($+=Te*ge,re+=we*ge)}return(Te=ae-$)*Te+(we=G-re)*we}function Nt(ae,G,$,re){var pe={id:ae===void 0?null:ae,type:G,geometry:$,tags:re,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ye){var Te=ye.geometry,we=ye.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")Vr(ye,Te);else if(we==="Polygon"||we==="MultiLineString")for(var ge=0;ge<Te.length;ge++)Vr(ye,Te[ge]);else if(we==="MultiPolygon")for(ge=0;ge<Te.length;ge++)for(var ke=0;ke<Te[ge].length;ke++)Vr(ye,Te[ge][ke])}(pe),pe}function Vr(ae,G){for(var $=0;$<G.length;$+=3)ae.minX=Math.min(ae.minX,G[$]),ae.minY=Math.min(ae.minY,G[$+1]),ae.maxX=Math.max(ae.maxX,G[$]),ae.maxY=Math.max(ae.maxY,G[$+1])}function zn(ae,G,$,re){if(G.geometry){var pe=G.geometry.coordinates,ye=G.geometry.type,Te=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),we=[],ge=G.id;if($.promoteId?ge=G.properties[$.promoteId]:$.generateId&&(ge=re||0),ye==="Point")Ro(pe,we);else if(ye==="MultiPoint")for(var ke=0;ke<pe.length;ke++)Ro(pe[ke],we);else if(ye==="LineString")Ti(pe,we,Te,!1);else if(ye==="MultiLineString"){if($.lineMetrics){for(ke=0;ke<pe.length;ke++)Ti(pe[ke],we=[],Te,!1),ae.push(Nt(ge,"LineString",we,G.properties));return}jn(pe,we,Te,!1)}else if(ye==="Polygon")jn(pe,we,Te,!0);else{if(ye!=="MultiPolygon"){if(ye==="GeometryCollection"){for(ke=0;ke<G.geometry.geometries.length;ke++)zn(ae,{id:ge,geometry:G.geometry.geometries[ke],properties:G.properties},$,re);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ke=0;ke<pe.length;ke++){var tt=[];jn(pe[ke],tt,Te,!0),we.push(tt)}}ae.push(Nt(ge,ye,we,G.properties))}}function Ro(ae,G){G.push(Ga(ae[0])),G.push(bs(ae[1])),G.push(0)}function Ti(ae,G,$,re){for(var pe,ye,Te=0,we=0;we<ae.length;we++){var ge=Ga(ae[we][0]),ke=bs(ae[we][1]);G.push(ge),G.push(ke),G.push(0),we>0&&(Te+=re?(pe*ke-ge*ye)/2:Math.sqrt(Math.pow(ge-pe,2)+Math.pow(ke-ye,2))),pe=ge,ye=ke}var tt=G.length-3;G[2]=1,hr(G,0,tt,$),G[tt+2]=1,G.size=Math.abs(Te),G.start=0,G.end=G.size}function jn(ae,G,$,re){for(var pe=0;pe<ae.length;pe++){var ye=[];Ti(ae[pe],ye,$,re),G.push(ye)}}function Ga(ae){return ae/360+.5}function bs(ae){var G=Math.sin(ae*Math.PI/180),$=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return $<0?0:$>1?1:$}function Rn(ae,G,$,re,pe,ye,Te,we){if(re/=G,ye>=($/=G)&&Te<re)return ae;if(Te<$||ye>=re)return null;for(var ge=[],ke=0;ke<ae.length;ke++){var tt=ae[ke],it=tt.geometry,Ke=tt.type,Mt=pe===0?tt.minX:tt.minY,Pt=pe===0?tt.maxX:tt.maxY;if(Mt>=$&&Pt<re)ge.push(tt);else if(!(Pt<$||Mt>=re)){var At=[];if(Ke==="Point"||Ke==="MultiPoint")Oo(it,At,$,re,pe);else if(Ke==="LineString")Ur(it,At,$,re,pe,!1,we.lineMetrics);else if(Ke==="MultiLineString")Ws(it,At,$,re,pe,!1);else if(Ke==="Polygon")Ws(it,At,$,re,pe,!0);else if(Ke==="MultiPolygon")for(var kt=0;kt<it.length;kt++){var jt=[];Ws(it[kt],jt,$,re,pe,!0),jt.length&&At.push(jt)}if(At.length){if(we.lineMetrics&&Ke==="LineString"){for(kt=0;kt<At.length;kt++)ge.push(Nt(tt.id,Ke,At[kt],tt.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(At.length===1?(Ke="LineString",At=At[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=At.length===3?"Point":"MultiPoint"),ge.push(Nt(tt.id,Ke,At,tt.tags))}}}return ge.length?ge:null}function Oo(ae,G,$,re,pe){for(var ye=0;ye<ae.length;ye+=3){var Te=ae[ye+pe];Te>=$&&Te<=re&&(G.push(ae[ye]),G.push(ae[ye+1]),G.push(ae[ye+2]))}}function Ur(ae,G,$,re,pe,ye,Te){for(var we,ge,ke=Bo(ae),tt=pe===0?$a:qa,it=ae.start,Ke=0;Ke<ae.length-3;Ke+=3){var Mt=ae[Ke],Pt=ae[Ke+1],At=ae[Ke+2],kt=ae[Ke+3],jt=ae[Ke+4],Ei=pe===0?Mt:Pt,Ni=pe===0?kt:jt,un=!1;Te&&(we=Math.sqrt(Math.pow(Mt-kt,2)+Math.pow(Pt-jt,2))),Ei<$?Ni>$&&(ge=tt(ke,Mt,Pt,kt,jt,$),Te&&(ke.start=it+we*ge)):Ei>re?Ni<re&&(ge=tt(ke,Mt,Pt,kt,jt,re),Te&&(ke.start=it+we*ge)):Gr(ke,Mt,Pt,At),Ni<$&&Ei>=$&&(ge=tt(ke,Mt,Pt,kt,jt,$),un=!0),Ni>re&&Ei<=re&&(ge=tt(ke,Mt,Pt,kt,jt,re),un=!0),!ye&&un&&(Te&&(ke.end=it+we*ge),G.push(ke),ke=Bo(ae)),Te&&(it+=we)}var Hi=ae.length-3;Mt=ae[Hi],Pt=ae[Hi+1],At=ae[Hi+2],(Ei=pe===0?Mt:Pt)>=$&&Ei<=re&&Gr(ke,Mt,Pt,At),Hi=ke.length-3,ye&&Hi>=3&&(ke[Hi]!==ke[0]||ke[Hi+1]!==ke[1])&&Gr(ke,ke[0],ke[1],ke[2]),ke.length&&G.push(ke)}function Bo(ae){var G=[];return G.size=ae.size,G.start=ae.start,G.end=ae.end,G}function Ws(ae,G,$,re,pe,ye){for(var Te=0;Te<ae.length;Te++)Ur(ae[Te],G,$,re,pe,ye,!1)}function Gr(ae,G,$,re){ae.push(G),ae.push($),ae.push(re)}function $a(ae,G,$,re,pe,ye){var Te=(ye-G)/(re-G);return ae.push(ye),ae.push($+(pe-$)*Te),ae.push(1),Te}function qa(ae,G,$,re,pe,ye){var Te=(ye-$)/(pe-$);return ae.push(G+(re-G)*Te),ae.push(ye),ae.push(1),Te}function Vn(ae,G){for(var $=[],re=0;re<ae.length;re++){var pe,ye=ae[re],Te=ye.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")pe=Zs(ye.geometry,G);else if(Te==="MultiLineString"||Te==="Polygon"){pe=[];for(var we=0;we<ye.geometry.length;we++)pe.push(Zs(ye.geometry[we],G))}else if(Te==="MultiPolygon")for(pe=[],we=0;we<ye.geometry.length;we++){for(var ge=[],ke=0;ke<ye.geometry[we].length;ke++)ge.push(Zs(ye.geometry[we][ke],G));pe.push(ge)}$.push(Nt(ye.id,Te,pe,ye.tags))}return $}function Zs(ae,G){var $=[];$.size=ae.size,ae.start!==void 0&&($.start=ae.start,$.end=ae.end);for(var re=0;re<ae.length;re+=3)$.push(ae[re]+G,ae[re+1],ae[re+2]);return $}function Fo(ae,G){if(ae.transformed)return ae;var $,re,pe,ye=1<<ae.z,Te=ae.x,we=ae.y;for($=0;$<ae.features.length;$++){var ge=ae.features[$],ke=ge.geometry,tt=ge.type;if(ge.geometry=[],tt===1)for(re=0;re<ke.length;re+=2)ge.geometry.push(ur(ke[re],ke[re+1],G,ye,Te,we));else for(re=0;re<ke.length;re++){var it=[];for(pe=0;pe<ke[re].length;pe+=2)it.push(ur(ke[re][pe],ke[re][pe+1],G,ye,Te,we));ge.geometry.push(it)}}return ae.transformed=!0,ae}function ur(ae,G,$,re,pe,ye){return[Math.round($*(ae*re-pe)),Math.round($*(G*re-ye))]}function $r(ae,G,$,re,pe){for(var ye=G===pe.maxZoom?0:pe.tolerance/((1<<G)*pe.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:re,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},we=0;we<ae.length;we++){Te.numFeatures++,No(Te,ae[we],ye,pe);var ge=ae[we].minX,ke=ae[we].minY,tt=ae[we].maxX,it=ae[we].maxY;ge<Te.minX&&(Te.minX=ge),ke<Te.minY&&(Te.minY=ke),tt>Te.maxX&&(Te.maxX=tt),it>Te.maxY&&(Te.maxY=it)}return Te}function No(ae,G,$,re){var pe=G.geometry,ye=G.type,Te=[];if(ye==="Point"||ye==="MultiPoint")for(var we=0;we<pe.length;we+=3)Te.push(pe[we]),Te.push(pe[we+1]),ae.numPoints++,ae.numSimplified++;else if(ye==="LineString")dr(Te,pe,ae,$,!1,!1);else if(ye==="MultiLineString"||ye==="Polygon")for(we=0;we<pe.length;we++)dr(Te,pe[we],ae,$,ye==="Polygon",we===0);else if(ye==="MultiPolygon")for(var ge=0;ge<pe.length;ge++){var ke=pe[ge];for(we=0;we<ke.length;we++)dr(Te,ke[we],ae,$,!0,we===0)}if(Te.length){var tt=G.tags||null;if(ye==="LineString"&&re.lineMetrics){for(var it in tt={},G.tags)tt[it]=G.tags[it];tt.mapbox_clip_start=pe.start/pe.size,tt.mapbox_clip_end=pe.end/pe.size}var Ke={geometry:Te,type:ye==="Polygon"||ye==="MultiPolygon"?3:ye==="LineString"||ye==="MultiLineString"?2:1,tags:tt};G.id!==null&&(Ke.id=G.id),ae.features.push(Ke)}}function dr(ae,G,$,re,pe,ye){var Te=re*re;if(re>0&&G.size<(pe?Te:re))$.numPoints+=G.length/3;else{for(var we=[],ge=0;ge<G.length;ge+=3)(re===0||G[ge+2]>Te)&&($.numSimplified++,we.push(G[ge]),we.push(G[ge+1])),$.numPoints++;pe&&function(ke,tt){for(var it=0,Ke=0,Mt=ke.length,Pt=Mt-2;Ke<Mt;Pt=Ke,Ke+=2)it+=(ke[Ke]-ke[Pt])*(ke[Ke+1]+ke[Pt+1]);if(it>0===tt)for(Ke=0,Mt=ke.length;Ke<Mt/2;Ke+=2){var At=ke[Ke],kt=ke[Ke+1];ke[Ke]=ke[Mt-2-Ke],ke[Ke+1]=ke[Mt-1-Ke],ke[Mt-2-Ke]=At,ke[Mt-1-Ke]=kt}}(we,ye),ae.push(we)}}function Hs(ae,G){var $=(G=this.options=function(pe,ye){for(var Te in ye)pe[Te]=ye[Te];return pe}(Object.create(this.options),G)).debug;if($&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var re=function(pe,ye){var Te=[];if(pe.type==="FeatureCollection")for(var we=0;we<pe.features.length;we++)zn(Te,pe.features[we],ye,we);else zn(Te,pe.type==="Feature"?pe:{geometry:pe},ye);return Te}(ae,G);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),re=function(pe,ye){var Te=ye.buffer/ye.extent,we=pe,ge=Rn(pe,1,-1-Te,Te,0,-1,2,ye),ke=Rn(pe,1,1-Te,2+Te,0,-1,2,ye);return(ge||ke)&&(we=Rn(pe,1,-Te,1+Te,0,-1,2,ye)||[],ge&&(we=Vn(ge,1).concat(we)),ke&&(we=we.concat(Vn(ke,-1)))),we}(re,G),re.length&&this.splitTile(re,0,0,0),$&&(re.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function pr(ae,G,$){return 32*((1<<ae)*$+G)+ae}function fr(ae,G){const $=ae.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const re=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!re)return G(null,null);const pe=new class{constructor(Te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.EXTENT,this.length=Te.length,this._features=Te}feature(Te){return new class{constructor(we){this._feature=we,this.extent=r.EXTENT,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const ge of this._feature.geometry)we.push([new r.Point(ge[0],ge[1])]);return we}{const we=[];for(const ge of this._feature.geometry){const ke=[];for(const tt of ge)ke.push(new r.Point(tt[0],tt[1]));we.push(ke)}return we}}toGeoJSON(we,ge,ke){return ce.call(this,we,ge,ke)}}(this._features[Te])}}(re.features);let ye=ti(pe);ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),G(null,{vectorTile:pe,rawData:ye.buffer})}Hs.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Hs.prototype.splitTile=function(ae,G,$,re,pe,ye,Te){for(var we=[ae,G,$,re],ge=this.options,ke=ge.debug;we.length;){re=we.pop(),$=we.pop(),G=we.pop(),ae=we.pop();var tt=1<<G,it=pr(G,$,re),Ke=this.tiles[it];if(!Ke&&(ke>1&&console.time("creation"),Ke=this.tiles[it]=$r(ae,G,$,re,ge),this.tileCoords.push({z:G,x:$,y:re}),ke)){ke>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,$,re,Ke.numFeatures,Ke.numPoints,Ke.numSimplified),console.timeEnd("creation"));var Mt="z"+G;this.stats[Mt]=(this.stats[Mt]||0)+1,this.total++}if(Ke.source=ae,pe){if(G===ge.maxZoom||G===pe)continue;var Pt=1<<pe-G;if($!==Math.floor(ye/Pt)||re!==Math.floor(Te/Pt))continue}else if(G===ge.indexMaxZoom||Ke.numPoints<=ge.indexMaxPoints)continue;if(Ke.source=null,ae.length!==0){ke>1&&console.time("clipping");var At,kt,jt,Ei,Ni,un,Hi=.5*ge.buffer/ge.extent,ls=.5-Hi,Qi=.5+Hi,yn=1+Hi;At=kt=jt=Ei=null,Ni=Rn(ae,tt,$-Hi,$+Qi,0,Ke.minX,Ke.maxX,ge),un=Rn(ae,tt,$+ls,$+yn,0,Ke.minX,Ke.maxX,ge),ae=null,Ni&&(At=Rn(Ni,tt,re-Hi,re+Qi,1,Ke.minY,Ke.maxY,ge),kt=Rn(Ni,tt,re+ls,re+yn,1,Ke.minY,Ke.maxY,ge),Ni=null),un&&(jt=Rn(un,tt,re-Hi,re+Qi,1,Ke.minY,Ke.maxY,ge),Ei=Rn(un,tt,re+ls,re+yn,1,Ke.minY,Ke.maxY,ge),un=null),ke>1&&console.timeEnd("clipping"),we.push(At||[],G+1,2*$,2*re),we.push(kt||[],G+1,2*$,2*re+1),we.push(jt||[],G+1,2*$+1,2*re),we.push(Ei||[],G+1,2*$+1,2*re+1)}}},Hs.prototype.getTile=function(ae,G,$){var re=this.options,pe=re.extent,ye=re.debug;if(ae<0||ae>24)return null;var Te=1<<ae,we=pr(ae,G=(G%Te+Te)%Te,$);if(this.tiles[we])return Fo(this.tiles[we],pe);ye>1&&console.log("drilling down to z%d-%d-%d",ae,G,$);for(var ge,ke=ae,tt=G,it=$;!ge&&ke>0;)ke--,tt=Math.floor(tt/2),it=Math.floor(it/2),ge=this.tiles[pr(ke,tt,it)];return ge&&ge.source?(ye>1&&console.log("found parent tile z%d-%d-%d",ke,tt,it),ye>1&&console.time("drilling down"),this.splitTile(ge.source,ke,tt,it,ae,G,$),ye>1&&console.timeEnd("drilling down"),this.tiles[we]?Fo(this.tiles[we],pe):null):null};class qr extends r.VectorTileWorkerSource{constructor(G,$,re,pe,ye){super(G,$,re,pe,fr),ye&&(this.loadGeoJSON=ye)}loadData(G,$){const re=G&&G.request,pe=re&&re.collectResourceTiming;this.loadGeoJSON(G,(ye,Te)=>{if(ye||!Te)return $(ye);if(typeof Te!="object")return $(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{ie(Te,!0);try{if(G.filter){const ge=r.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ge.result==="error")throw new Error(ge.value.map(tt=>`${tt.key}: ${tt.message}`).join(", "));Te={type:"FeatureCollection",features:Te.features.filter(tt=>ge.value.evaluate({zoom:0},tt))}}this._geoJSONIndex=G.cluster?new _i(function({superclusterOptions:ge,clusterProperties:ke}){if(!ke||!ge)return ge;const tt={},it={},Ke={accumulated:null,zoom:0},Mt={properties:null},Pt=Object.keys(ke);for(const At of Pt){const[kt,jt]=ke[At],Ei=r.createExpression(jt),Ni=r.createExpression(typeof kt=="string"?[kt,["accumulated"],["get",At]]:kt);tt[At]=Ei.value,it[At]=Ni.value}return ge.map=At=>{Mt.properties=At;const kt={};for(const jt of Pt)kt[jt]=tt[jt].evaluate(Ke,Mt);return kt},ge.reduce=(At,kt)=>{Mt.properties=kt;for(const jt of Pt)Ke.accumulated=At[jt],At[jt]=it[jt].evaluate(Ke,Mt)},ge}(G)).load(Te.features):function(ge,ke){return new Hs(ge,ke)}(Te,G.geojsonVtOptions)}catch(ge){return $(ge)}this.loaded={};const we={};if(pe){const ge=r.getPerformanceMeasurement(re);ge&&(we.resourceTiming={},we.resourceTiming[G.source]=JSON.parse(JSON.stringify(ge)))}$(null,we)}})}reloadTile(G,$){const re=this.loaded;return re&&re[G.uid]?super.reloadTile(G,$):this.loadTile(G,$)}loadGeoJSON(G,$){if(G.request)r.getJSON(G.request,$);else{if(typeof G.data!="string")return $(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return $(null,JSON.parse(G.data))}catch{return $(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(re){$(re)}}getClusterChildren(G,$){try{$(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(re){$(re)}}getClusterLeaves(G,$){try{$(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(re){$(re)}}}class Wa{constructor(G){this.self=G,this.actor=new r.Actor(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.getProjection({name:"mercator"}),this.workerSourceTypes={vector:r.VectorTileWorkerSource,geojson:qr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=($,re)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=re},this.self.registerRTLTextPlugin=$=>{if(r.plugin.isParsed())throw new Error("RTL text plugin already registered.");r.plugin.applyArabicShaping=$.applyArabicShaping,r.plugin.processBidirectionalText=$.processBidirectionalText,r.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}}clearCaches(G,$,re){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],re()}checkIfReady(G,$,re){re()}setReferrer(G,$){this.referrer=$}spriteLoaded(G,$){this.isSpriteLoaded[G]=$;for(const re in this.workerSources[G]){const pe=this.workerSources[G][re];for(const ye in pe)pe[ye]instanceof r.VectorTileWorkerSource&&(pe[ye].isSpriteLoaded=$,pe[ye].fire(new r.Event("isSpriteLoaded")))}}setImages(G,$,re){this.availableImages[G]=$;for(const pe in this.workerSources[G]){const ye=this.workerSources[G][pe];for(const Te in ye)ye[Te].availableImages=$}re()}enableTerrain(G,$,re){this.terrain=$,re()}setProjection(G,$){this.projections[G]=r.getProjection($)}setLayers(G,$,re){this.getLayerIndex(G).replace($),re()}updateLayers(G,$,re){this.getLayerIndex(G).update($.layers,$.removedIds),re()}loadTile(G,$,re){const pe=this.enableTerrain?r.extend({enableTerrain:this.terrain},$):$;pe.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,$.type,$.source).loadTile(pe,re)}loadDEMTile(G,$,re){const pe=this.enableTerrain?r.extend({buildQuadTree:this.terrain},$):$;this.getDEMWorkerSource(G,$.source).loadTile(pe,re)}reloadTile(G,$,re){const pe=this.enableTerrain?r.extend({enableTerrain:this.terrain},$):$;pe.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,$.type,$.source).reloadTile(pe,re)}abortTile(G,$,re){this.getWorkerSource(G,$.type,$.source).abortTile($,re)}removeTile(G,$,re){this.getWorkerSource(G,$.type,$.source).removeTile($,re)}removeSource(G,$,re){if(!this.workerSources[G]||!this.workerSources[G][$.type]||!this.workerSources[G][$.type][$.source])return;const pe=this.workerSources[G][$.type][$.source];delete this.workerSources[G][$.type][$.source],pe.removeSource!==void 0?pe.removeSource($,re):re()}loadWorkerSource(G,$,re){try{this.self.importScripts($.url),re()}catch(pe){re(pe.toString())}}syncRTLPluginState(G,$,re){try{r.plugin.setState($);const pe=r.plugin.getPluginURL();if(r.plugin.isLoaded()&&!r.plugin.isParsed()&&pe!=null){this.self.importScripts(pe);const ye=r.plugin.isParsed();re(ye?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pe}`),ye)}}catch(pe){re(pe.toString())}}getAvailableImages(G){let $=this.availableImages[G];return $||($=[]),$}getLayerIndex(G){let $=this.layerIndexes[G];return $||($=this.layerIndexes[G]=new R),$}getWorkerSource(G,$,re){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][$]||(this.workerSources[G][$]={}),!this.workerSources[G][$][re]){const pe={send:(ye,Te,we,ge,ke,tt)=>{this.actor.send(ye,Te,we,G,ke,tt)},scheduler:this.actor.scheduler};this.workerSources[G][$][re]=new this.workerSourceTypes[$](pe,this.getLayerIndex(G),this.getAvailableImages(G),this.isSpriteLoaded[G])}return this.workerSources[G][$][re]}getDEMWorkerSource(G,$){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][$]||(this.demWorkerSources[G][$]=new F),this.demWorkerSources[G][$]}enforceCacheSizeLimit(G,$){r.enforceCacheSizeLimit($)}getWorkerPerformanceMetrics(G,$,re){re(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Wa(self)),Wa}),g(["./shared"],function(r){function T(p,n){if(Array.isArray(p)){if(!Array.isArray(n)||p.length!==n.length)return!1;for(let c=0;c<p.length;c++)if(!T(p[c],n[c]))return!1;return!0}if(typeof p=="object"&&p!==null&&n!==null){if(typeof n!="object"||Object.keys(p).length!==Object.keys(n).length)return!1;for(const c in p)if(!T(p[c],n[c]))return!1;return!0}return p===n}var I=R;function R(p){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,y,b=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(b);try{y=new Worker(S),_=!0}catch{_=!1}return y&&y.terminate(),URL.revokeObjectURL(S),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var y=_.getContext("2d");if(!y)return!1;var b=y.getImageData(0,0,1,1);return b&&b.width===_.width}()?(F[c=n&&n.failIfMajorPerformanceCaveat]===void 0&&(F[c]=function(_){var y,b=function(S){var M=document.createElement("canvas"),C=Object.create(R.webGLContextAttributes);return C.failIfMajorPerformanceCaveat=S,M.getContext("webgl",C)||M.getContext("experimental-webgl",C)}(_);if(!b)return!1;try{y=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!y||b.isContextLost())&&(b.shaderSource(y,"void main() {}"),b.compileShader(y),b.getShaderParameter(y,b.COMPILE_STATUS)===!0)}(c)),F[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(p)}var F={};function U(p,n,c){const _=r.window.document.createElement(p);return n!==void 0&&(_.className=n),c&&c.appendChild(_),_}function Y(p,n,c){const _=r.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const y of Object.keys(n))_.setAttributeNS(null,y,n[y]);return c&&c.appendChild(_),_}R.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ie=r.window.document&&r.window.document.documentElement.style,ce=ie&&ie.userSelect!==void 0?"userSelect":"WebkitUserSelect";let he;function be(){ie&&ce&&(he=ie[ce],ie[ce]="none")}function De(){ie&&ce&&(ie[ce]=he)}function Fe(p){p.preventDefault(),p.stopPropagation(),r.window.removeEventListener("click",Fe,!0)}function We(){r.window.addEventListener("click",Fe,!0),r.window.setTimeout(()=>{r.window.removeEventListener("click",Fe,!0)},0)}function Re(p,n){const c=p.getBoundingClientRect();return st(p,c,n)}function Je(p,n){const c=p.getBoundingClientRect(),_=[];for(let y=0;y<n.length;y++)_.push(st(p,c,n[y]));return _}function nt(p){return r.window.InstallTrigger!==void 0&&p.button===2&&p.ctrlKey&&r.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function st(p,n,c){const _=p.offsetWidth===n.width?1:p.offsetWidth/n.width;return new r.Point((c.clientX-n.left)*_,(c.clientY-n.top)*_)}function Le(p,n){var c=n[0],_=n[1],y=n[2],b=n[3],S=c*b-y*_;return S?(p[0]=b*(S=1/S),p[1]=-_*S,p[2]=-y*S,p[3]=c*S,p):null}function Lt(p){const{userImage:n}=p;return!!(n&&n.render&&n.render())&&(p.data.replace(new Uint8Array(n.data.buffer)),!0)}class zt extends r.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new r.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:_}of this.requestors)this._notify(c,_);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let _=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),_=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),_=!1),this._validateContent(c.content,c)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),_=!1),_}_validateStretch(n,c){if(!n)return!0;let _=0;for(const y of n){if(y[0]<_||y[1]<y[0]||c<y[1])return!1;_=y[1]}return!0}_validateContent(n,c){return!(n&&(n.length!==4||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let _=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(_=!1);this.isLoaded()||_?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const _={};for(const y of n){this.images[y]||this.fire(new r.Event("styleimagemissing",{id:y}));const b=this.images[y];b?_[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:r.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,_)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],_=this.getImage(n);if(!_)return null;if(c&&c.position.version===_.version)return c.position;if(c)c.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new r.ImagePosition(y,_);this.patterns[n]={bin:y,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new r.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:c,h:_}=r.potpack(n),y=this.atlasImage;y.resize({width:c||1,height:_||1});for(const b in this.patterns){const{bin:S}=this.patterns[b],M=S.x+1,C=S.y+1,z=this.images[b].data,L=z.width,N=z.height;r.RGBAImage.copy(z,y,{x:0,y:0},{x:M,y:C},{width:L,height:N}),r.RGBAImage.copy(z,y,{x:0,y:N-1},{x:M,y:C-1},{width:L,height:1}),r.RGBAImage.copy(z,y,{x:0,y:0},{x:M,y:C+N},{width:L,height:1}),r.RGBAImage.copy(z,y,{x:L-1,y:0},{x:M-1,y:C},{width:1,height:N}),r.RGBAImage.copy(z,y,{x:0,y:0},{x:M+L,y:C},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const _=this.images[c];Lt(_)&&this.updateImage(c,_)}}}const ft=new r.Properties({anchor:new r.DataConstantProperty(r.spec.light.anchor),position:new class{constructor(){this.specification=r.spec.light.position}possiblyEvaluate(p,n){return function([c,_,y]){const b=r.degToRad(_+90),S=r.degToRad(y);return{x:c*Math.cos(b)*Math.sin(S),y:c*Math.sin(b)*Math.sin(S),z:c*Math.cos(S),azimuthal:_,polar:y}}(p.expression.evaluate(n))}interpolate(p,n,c){return{x:r.number(p.x,n.x,c),y:r.number(p.y,n.y,c),z:r.number(p.z,n.z,c),azimuthal:r.number(p.azimuthal,n.azimuthal,c),polar:r.number(p.polar,n.polar,c)}}},color:new r.DataConstantProperty(r.spec.light.color),intensity:new r.DataConstantProperty(r.spec.light.intensity)});class Gt extends r.Evented{constructor(n){super(),this._transitionable=new r.Transitionable(ft),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(r.validateLight,n,c))for(const _ in n){const y=n[_];r.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,_){return(!_||_.validate!==!1)&&r.emitValidationErrors(this,n.call(r.validateStyle,r.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}const on=new r.Properties({source:new r.DataConstantProperty(r.spec.terrain.source),exaggeration:new r.DataConstantProperty(r.spec.terrain.exaggeration)});let Kt=class extends r.Evented{constructor(p,n){super(),this._transitionable=new r.Transitionable(on),this.set(p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(p){for(const n in p){const c=p[n];r.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),c):this._transitionable.setValue(n,c)}}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}};function ti(p,n,c,_){const y=r.smoothstep(45,65,c),[b,S]=yi(p,_),M=r.length(n);let C=1-Math.min(1,Math.exp((M-b)/(S-b)*-6));return C*=C*C,C=Math.min(1,1.00747*C),C*y*p.alpha}function yi(p,n){const c=.5/Math.tan(.5*n);return[p.range[0]+c,p.range[1]+c]}const bt=new r.Properties({range:new r.DataConstantProperty(r.spec.fog.range),color:new r.DataConstantProperty(r.spec.fog.color),"high-color":new r.DataConstantProperty(r.spec.fog["high-color"]),"space-color":new r.DataConstantProperty(r.spec.fog["space-color"]),"horizon-blend":new r.DataConstantProperty(r.spec.fog["horizon-blend"]),"star-intensity":new r.DataConstantProperty(r.spec.fog["star-intensity"])});class Pi extends r.Evented{constructor(n,c){super(),this._transitionable=new r.Transitionable(bt),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const n=this._transform,c=n.projection.name==="globe",_=r.globeToMercatorTransition(n.zoom),y=this.properties.get("range"),b=[.5,3];return{range:c?[r.number(b[0],y[0],_),r.number(b[1],y[1],_)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(r.validateFog,n,c)){for(const _ of Object.keys(r.spec.fog))n&&n[_]===void 0&&(n[_]=r.spec.fog[_].default);for(const _ in n){const y=n[_];r.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.smoothstep(45,65,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(_,y,b){const S=r.MercatorCoordinate.fromLngLat(y),M=b.elevation?b.elevation.getAtPointOrZero(S):0,C=[S.x,S.y,M];return r.transformMat4(C,C,b.mercatorFogMatrix),ti(_,C,b.pitch,b._fov)}(this.state,n,c):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?yi(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,_){return(!_||_.validate!==!1)&&r.emitValidationErrors(this,n.call(r.validateStyle,r.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}class xi{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=r.uniqueId();const _=this.workerPool.acquire(this.id);for(let y=0;y<_.length;y++){const b=new xi.Actor(_[y],c,this.id);b.name=`Worker ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,_){r.asyncAll(this.actors,(y,b)=>{y.send(n,c,b)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ki(p,n,c){return n*(r.EXTENT/(p.tileSize*Math.pow(2,c-p.tileID.overscaledZ)))}xi.Actor=r.Actor;class gn{constructor(n,c,_,y){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(n,c){let _,y;if(n instanceof r.Point||typeof n[0]=="number"){const b=r.Point.convert(n);_=[b],y=c.isPointAboveHorizon(b)}else{const b=r.Point.convert(n[0]),S=r.Point.convert(n[1]);_=[b,S],y=r.polygonizeBounds(b,S).every(M=>c.isPointAboveHorizon(M))}return new gn(_,c.getCameraPoint(),y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new r.Point(1,1)):this.screenBounds[1],y=r.polygonizeBounds(c,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<_.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),r.bufferConvexPolygon(y,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new r.Point(1,1)):this.screenBounds[1],y=r.polygonizeBounds(c,_,n),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>_.y))+((b.x>c.x)+(b.x>_.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(n,c,_,y=0){const b=n.queryPadding/c._pixelsPerMercatorPixel+1,S=_?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c);let M=n.tileID.wrap+(S.unwrapped?y:0);const C=S.polygon.map(Q=>r.getTilePoint(n.tileTransform,Q,M));if(!r.polygonIntersectsBox(C,0,0,r.EXTENT,r.EXTENT))return;M=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const z=this.screenGeometryMercator.polygon.map(Q=>r.getTileVec3(n.tileTransform,Q,M)),L=z.map(Q=>new r.Point(Q[0],Q[1])),N=c.getFreeCameraOptions().position||new r.MercatorCoordinate(0,0,0),q=r.getTileVec3(n.tileTransform,N,M),H=z.map(Q=>{const j=r.sub(Q,Q,q);return r.normalize(j,j),new r.Ray(q,j)}),J=ki(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:H,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(K=r.getBounds(C),K.min.x=r.clamp(K.min.x,0,r.EXTENT),K.min.y=r.clamp(K.min.y,0,r.EXTENT),K.max.x=r.clamp(K.max.x,0,r.EXTENT),K.max.y=r.clamp(K.max.y,0,r.EXTENT),K),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:J};var K}_bufferedScreenMercator(n,c){const _=Nn(n);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[_]=y,y}}_bufferedCameraMercator(n,c){const _=Nn(n);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[_]=y,y}}_projectAndResample(n,c){const _=function(b,S){const M=r.multiply([],S.pixelMatrix,S.globeMatrix),C=[0,-r.GLOBE_RADIUS,0,1],z=[0,r.GLOBE_RADIUS,0,1],L=[0,0,0,1];r.transformMat4$1(C,C,M),r.transformMat4$1(z,z,M),r.transformMat4$1(L,L,M);const N=new r.Point(C[0]/C[3],C[1]/C[3]),q=new r.Point(z[0]/z[3],z[1]/z[3]),H=r.polygonContainsPoint(b,N)&&C[3]<L[3],J=r.polygonContainsPoint(b,q)&&z[3]<L[3];if(!H&&!J)return null;const K=function(_e,ve,xe){for(let Ae=1;Ae<_e.length;Ae++){const Ze=vn(ve.pointCoordinate3D(_e[Ae-1]).x),Ee=vn(ve.pointCoordinate3D(_e[Ae]).x);if(xe<0){if(Ze<Ee)return{idx:Ae,t:-Ze/(Ee-1-Ze)}}else if(Ee<Ze)return{idx:Ae,t:(1-Ze)/(Ee+1-Ze)}}return null}(b,S,H?-1:1);if(!K)return null;const{idx:Q,t:j}=K;let Z=Q>1?_i(b.slice(0,Q),S):[],ne=Q<b.length?_i(b.slice(Q),S):[];Z=Z.map(_e=>new r.Point(vn(_e.x),_e.y)),ne=ne.map(_e=>new r.Point(vn(_e.x),_e.y));const se=[...Z];se.length===0&&se.push(ne[ne.length-1]);const fe=r.number(se[se.length-1].y,(ne.length===0?Z[0]:ne[0]).y,j);let me;return me=H?[new r.Point(0,fe),new r.Point(0,0),new r.Point(1,0),new r.Point(1,fe)]:[new r.Point(1,fe),new r.Point(1,1),new r.Point(0,1),new r.Point(0,fe)],se.push(...me),ne.length===0?se.push(Z[0]):se.push(...ne),{polygon:se.map(_e=>new r.MercatorCoordinate(_e.x,_e.y)),unwrapped:!1}}(n,c);if(_)return _;const y=function(b,S){let M=!1,C=-1/0,z=0;for(let N=0;N<b.length-1;N++)b[N].x>C&&(C=b[N].x,z=N);for(let N=0;N<b.length-1;N++){const q=(z+N)%(b.length-1),H=b[q],J=b[q+1];Math.abs(H.x-J.x)>.5&&(H.x<J.x?(H.x+=1,q===0&&(b[b.length-1].x+=1)):(J.x+=1,q+1===b.length-1&&(b[0].x+=1)),M=!0)}const L=r.mercatorXfromLng(S.center.lng);return M&&L<Math.abs(L-1)&&b.forEach(N=>{N.x-=1}),{polygon:b,unwrapped:M}}(_i(n,c).map(b=>new r.Point(vn(b.x),b.y)),c);return{polygon:y.polygon.map(b=>new r.MercatorCoordinate(b.x,b.y)),unwrapped:y.unwrapped}}}function _i(p,n){return r.resample(p,c=>{const _=n.pointCoordinate3D(c);c.x=_.x,c.y=_.y},1/256)}function vn(p){return p<0?1+p%1:p%1}function Nn(p){return 100*p|0}function bn(p,n,c,_,y){const b=function(S,M){if(S)return y(S);if(M){p.url&&M.tiles&&p.tiles&&delete p.tiles;const C=r.pick(r.extend(M,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(C.vectorLayers=M.vector_layers,C.vectorLayerIds=C.vectorLayers.map(z=>z.id)),C.tiles=n.canonicalizeTileset(C,p.url),y(null,C)}};return p.url?r.getJSON(n.transformRequest(n.normalizeSourceURL(p.url,null,c,_),r.ResourceType.Source),b):r.exported.frame(()=>b(null,p))}class vs{constructor(n,c,_){this.bounds=r.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=_||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),_=Math.floor(r.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(r.mercatorYfromLat(this.bounds.getNorth())*c),b=Math.ceil(r.mercatorXfromLng(this.bounds.getEast())*c),S=Math.ceil(r.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=_&&n.x<b&&n.y>=y&&n.y<S}}class Ua{constructor(n,c,_){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const hr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class jr{constructor(n,c,_,y){this.length=c.length,this.attributes=_,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let _=0;_<this.attributes.length;_++){const y=c.attributes[this.attributes[_].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,c,_){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],S=c.attributes[b.name];S!==void 0&&n.vertexAttribPointer(S,b.components,n[hr[b.type]],!1,this.itemSize,b.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nt{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Vr extends Nt{getDefault(){return r.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zn extends Nt{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Ro extends Nt{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Ti extends Nt{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class jn extends Nt{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class Ga extends Nt{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class bs extends Nt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Rn extends Nt{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Oo extends Nt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class Ur extends Nt{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Bo extends Nt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class Ws extends Nt{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class Gr extends Nt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class $a extends Nt{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class qa extends Nt{getDefault(){return r.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Vn extends Nt{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Zs extends Nt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class Fo extends Nt{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class ur extends Nt{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let $r,No=class extends Nt{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class dr extends Nt{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Hs extends Nt{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class pr extends Nt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class fr extends Nt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class qr extends Nt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Wa extends Nt{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class ae extends Nt{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class G extends Nt{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class $ extends Nt{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class re extends Nt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class pe extends Nt{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class ye extends Nt{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Te extends ye{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class we extends ye{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class ge extends we{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class ke{constructor(n,c,_,y){this.context=n,this.width=c,this.height=_;const b=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Te(n,b),y&&(this.depthAttachment=new we(n,b))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const _=this.depthAttachment.get();_&&n.deleteRenderbuffer(_)}n.deleteFramebuffer(this.framebuffer)}}class tt{constructor(n,c=!1){if(this.gl=n,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const _=n;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(n),deleteVertexArrayOES:_.deleteVertexArray.bind(n),bindVertexArrayOES:_.bindVertexArray.bind(n)}}this.clearColor=new Vr(this),this.clearDepth=new zn(this),this.clearStencil=new Ro(this),this.colorMask=new Ti(this),this.depthMask=new jn(this),this.stencilMask=new Ga(this),this.stencilFunc=new bs(this),this.stencilOp=new Rn(this),this.stencilTest=new Oo(this),this.depthRange=new Ur(this),this.depthTest=new Bo(this),this.depthFunc=new Ws(this),this.blend=new Gr(this),this.blendFunc=new $a(this),this.blendColor=new qa(this),this.blendEquation=new Vn(this),this.cullFace=new Zs(this),this.cullFaceSide=new Fo(this),this.frontFace=new ur(this),this.program=new No(this),this.activeTexture=new dr(this),this.viewport=new Hs(this),this.bindFramebuffer=new pr(this),this.bindRenderbuffer=new fr(this),this.bindTexture=new qr(this),this.bindVertexBuffer=new Wa(this),this.bindElementBuffer=new ae(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new G(this),this.pixelStoreUnpack=new $(this),this.pixelStoreUnpackPremultiplyAlpha=new re(this),this.pixelStoreUnpackFlipY=new pe(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new Ua(this,n,c)}createVertexBuffer(n,c,_){return new jr(this,n,c,_)}createRenderbuffer(n,c,_){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,n,c,_),this.bindRenderbuffer.set(null),b}createFramebuffer(n,c,_){return new ke(this,n,c,_)}clear({color:n,depth:c,stencil:_}){const y=this.gl;let b=0;n&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),_!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){T(n.blendFunction,r.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class it extends r.Evented{constructor(n,c,_,y){if(super(),this.id=n,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.extend(this,r.pick(c,["url","scheme","tileSize","promoteId"])),this._options=r.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.DedupedRequest}load(n){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=bn(this._options,this.map._requestManager,c,_,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new r.ErrorEvent(y))):b&&(r.extend(this,b),b.bounds&&(this.tileBounds=new vs(b.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(y)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}loadTile(n,c){const _=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(_,r.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=c:n.request=n.actor.send("reloadTile",y,b.bind(this));else if(n.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",y,b.bind(this),void 0,!0);else{const S=r.loadVectorTile.call({deduped:this._deduped},y,(M,C)=>{M||!C?b.call(this,M):(y.data={cacheControl:C.cacheControl,expires:C.expires,rawData:C.rawData.slice(0)},n.actor&&n.actor.send("loadTile",y,b.bind(this),void 0,!0))},!0);n.request={cancel:S}}function b(S,M){return delete n.request,n.aborted?c(null):S&&S.status!==404?c(S):(M&&M.resourceTiming&&(n.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&n.setExpiryData(M),n.loadVectorData(M,this.map.painter),r.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ke extends r.Evented{constructor(n,c,_,y){super(),this.id=n,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.extend({type:"raster"},c),r.extend(this,r.pick(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bn(this._options,this.map._requestManager,null,null,(c,_)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new r.ErrorEvent(c)):_&&(r.extend(this,_),_.bounds&&(this.tileBounds=new vs(_.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(_.tiles),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(c)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const _=r.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);n.request=r.getImage(this.map._requestManager.transformRequest(y,r.ResourceType.Tile),(b,S,M,C)=>(delete n.request,n.aborted?(n.state="unloaded",c(null)):b?(n.state="errored",c(b)):S?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:M,expires:C}),n.setTexture(S,this.map.painter),n.state="loaded",r.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(n,c,_){n.setTexture(c,_)}static unloadTileData(n,c){n.texture&&c.saveTileTexture(n.texture)}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Mt(p,n,c,_,y,b,S,M){const C=[p,c,y,n,_,b,1,1,1],z=[S,M,1],L=r.adjoint([],C),[N,q,H]=r.transformMat3(z,z,r.transpose(L,L));return r.multiply$1(C,[N,0,0,0,q,0,0,0,H],C)}class Pt extends r.Evented{constructor(n,c,_,y){super(),this.id=n,this.dispatcher=_,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c,this._dirty=!1}load(n,c){this._loaded=c||!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=r.getImage(this.map._requestManager.transformRequest(this.url,r.ResourceType.Image),(_,y)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new r.ErrorEvent(_));else if(y){const{HTMLImageElement:b}=r.window;this.image=y instanceof b?r.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const c=n.map(r.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let y=1/0,b=1/0,S=-1/0,M=-1/0;for(const N of _)y=Math.min(y,N.x),b=Math.min(b,N.y),S=Math.max(S,N.x),M=Math.max(M,N.y);const C=Math.max(S-y,M-b),z=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),L=Math.pow(2,z);return new r.CanonicalTileID(z,Math.floor((y+S)/2*L),Math.floor((b+M)/2*L))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const C in this.tiles){const z=this.tiles[C];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;const c=r.tileTransform(this.tileID,this.map.transform.projection),[_,y,b,S]=this.coordinates.map(C=>{const z=c.projection.project(C[0],C[1]);return r.getTilePoint(c,z)._round()});this.perspectiveTransform=function(C,z,L,N,q,H,J,K,Q,j){const Z=Mt(0,0,C,0,0,z,C,z),ne=Mt(L,N,q,H,J,K,Q,j);return r.multiply$1(ne,r.adjoint(Z,Z),ne),[ne[6]/ne[8]*C/r.EXTENT,ne[7]/ne[8]*z/r.EXTENT]}(this.width,this.height,_.x,_.y,y.x,y.y,S.x,S.y,b.x,b.y);const M=this._boundsArray=new r.StructArrayLayout4i8;M.emplaceBack(_.x,_.y,0,0),M.emplaceBack(y.x,y.y,r.EXTENT,0),M.emplaceBack(S.x,S.y,0,r.EXTENT),M.emplaceBack(b.x,b.y,r.EXTENT,r.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(M,r.boundsAttributes.members),this.boundsSegments=r.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,c=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new r.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const At={vector:it,raster:Ke,"raster-dem":class extends Ke{constructor(p,n,c,_){super(p,n,c,_),this.type="raster-dem",this.maxzoom=22,this._options=r.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(p,n){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(y,b){y&&(p.state="errored",n(y)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",n(null))}p.request=r.getImage(this.map._requestManager.transformRequest(c,r.ResourceType.Tile),(function(y,b,S,M){if(delete p.request,p.aborted)p.state="unloaded",n(null);else if(y)p.state="errored",n(y);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:S,expires:M});const C=r.window.ImageBitmap&&b instanceof r.window.ImageBitmap&&($r==null&&($r=r.window.OffscreenCanvas&&new r.window.OffscreenCanvas(1,1).getContext("2d")&&typeof r.window.createImageBitmap=="function"),$r),z=1-(b.width-r.prevPowerOfTwo(b.width))/2;z<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=C?b:r.exported.getImageData(b,z),N={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:z};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",N,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const n=p.canonical,c=Math.pow(2,n.z),_=(n.x-1+c)%c,y=n.x===0?p.wrap-1:p.wrap,b=(n.x+1+c)%c,S=n.x+1===c?p.wrap+1:p.wrap,M={};return M[new r.OverscaledTileID(p.overscaledZ,y,n.z,_,n.y).key]={backfilled:!1},M[new r.OverscaledTileID(p.overscaledZ,S,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(M[new r.OverscaledTileID(p.overscaledZ,y,n.z,_,n.y-1).key]={backfilled:!1},M[new r.OverscaledTileID(p.overscaledZ,p.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new r.OverscaledTileID(p.overscaledZ,S,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<c&&(M[new r.OverscaledTileID(p.overscaledZ,y,n.z,_,n.y+1).key]={backfilled:!1},M[new r.OverscaledTileID(p.overscaledZ,p.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new r.OverscaledTileID(p.overscaledZ,S,n.z,b,n.y+1).key]={backfilled:!1}),M}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends r.Evented{constructor(p,n,c,_){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(_),this._data=n.data,this._options=r.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=r.EXTENT/this.tileSize;this.workerOptions=r.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:r.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},n),this}getClusterChildren(p,n){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},n),this}getClusterLeaves(p,n,c,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:n,offset:c},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=r.extend({},this.workerOptions),n=this._data;typeof n=="string"?(p.request=this.map._requestManager.transformRequest(r.exported.resolveURL(n),r.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,_)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new r.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),this.fire(new r.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,n){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(c,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,y)=>(delete p.request,p.unloadVectorData(),p.aborted?n(null):_?n(_):(p.loadVectorData(y,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Pt{constructor(p,n,c,_){super(p,n,c,_),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const n of p.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.ResourceType.Source).url);r.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new r.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const n=this.video.seekable;p<n.start(0)||p>n.end(0)?this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,n=p.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.Texture(p,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Pt,canvas:class extends Pt{constructor(p,n,c,_){super(p,n,c,_),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof r.window.HTMLCanvasElement||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof r.window.HTMLCanvasElement?this.options.canvas:r.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends r.Evented{constructor(p,n,c,_){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new vs(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.extend(this,r.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:n,y:c,z:_}=p.canonical;return this._implementation.hasTile({x:n,y:c,z:_})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,n){const{x:c,y:_,z:y}=p.tileID.canonical,b=new r.window.AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:_,z:y},{signal:b.signal})).then((function(S){return delete p.request,p.aborted?(p.state="unloaded",n(null)):S===void 0?(p.state="errored",n(null)):S===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",n(null)):function(M){return M instanceof r.window.ImageData||M instanceof r.window.HTMLCanvasElement||M instanceof r.window.ImageBitmap||M instanceof r.window.HTMLImageElement}(S)?(this.loadTileData(p,S),p.state="loaded",void n(null)):(p.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(p.state="errored",n(S))}),p.request.cancel=()=>b.abort()}loadTileData(p,n){Ke.loadTileData(p,n,this._map.painter)}unloadTileData(p){Ke.unloadTileData(p,this._map.painter)}unloadTile(p,n){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:c,y:_,z:y}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:_,z:y})}n()}abortTile(p,n){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}}},kt=function(p,n,c,_){const y=new At[n.type](p,n,c,_);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return r.bindAll(["load","abort","unload","serialize","prepare"],y),y};function jt(p,n){const c=r.identity([]);return r.scale(c,c,[.5*p.width,.5*-p.height,1]),r.translate(c,c,[1,-1,0]),r.multiply(c,c,p.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(c)}function Ei(p,n,c,_,y,b,S,M=!1){const C=p.tilesIn(_,S,M);C.sort(un);const z=[];for(const N of C)z.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(n,c,p._state,N,y,b,jt(p.transform,N.tile.tileID),M)});const L=function(N){const q={},H={};for(const J of N){const K=J.queryResults,Q=J.wrappedTileID,j=H[Q]=H[Q]||{};for(const Z in K){const ne=K[Z],se=j[Z]=j[Z]||{},fe=q[Z]=q[Z]||[];for(const me of ne)se[me.featureIndex]||(se[me.featureIndex]=!0,fe.push(me))}}return q}(z);for(const N in L)L[N].forEach(q=>{const H=q.feature,J=H.layer;J&&J.type!=="background"&&J.type!=="sky"&&(H.source=J.source,J["source-layer"]&&(H.sourceLayer=J["source-layer"]),H.state=H.id!==void 0?p.getFeatureState(J["source-layer"],H.id):{})});return L}function Ni(p,n){const c=p.getRenderableIds().map(b=>p.getTileByID(b)),_=[],y={};for(let b=0;b<c.length;b++){const S=c[b],M=S.tileID.canonical.key;y[M]||(y[M]=!0,S.querySourceFeatures(_,n))}return _}function un(p,n){const c=p.tileID,_=n.tileID;return c.overscaledZ-_.overscaledZ||c.canonical.y-_.canonical.y||c.wrap-_.wrap||c.canonical.x-_.canonical.x}function Hi(){return ho.workerClass!=null?new ho.workerClass:new r.window.Worker(ho.workerUrl)}const ls="mapboxgl_preloaded_worker_pool";class Qi{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Qi.workerCount;)this.workers.push(new Hi);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ls]}numActive(){return Object.keys(this.active).length}}let yn;function Wr(){return yn||(yn=new Qi),yn}function Cp(p,n){const c={};for(const _ in p)_!=="ref"&&(c[_]=p[_]);return r.refProperties.forEach(_=>{_ in n&&(c[_]=n[_])}),c}function uu(p){p=p.slice();const n=Object.create(null);for(let c=0;c<p.length;c++)n[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=Cp(p[c],n[p[c].ref]));return p}Qi.workerCount=2;const Ht={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function nc(p,n,c){c.push({command:Ht.addSource,args:[p,n[p]]})}function jo(p,n,c){n.push({command:Ht.removeSource,args:[p]}),c[p]=!0}function sc(p,n,c,_){jo(p,c,_),nc(p,n,c)}function Za(p,n,c){let _;for(_ in p[c])if(p[c].hasOwnProperty(_)&&_!=="data"&&!T(p[c][_],n[c][_]))return!1;for(_ in n[c])if(n[c].hasOwnProperty(_)&&_!=="data"&&!T(p[c][_],n[c][_]))return!1;return!0}function cs(p,n,c,_,y,b){let S;for(S in n=n||{},p=p||{})p.hasOwnProperty(S)&&(T(p[S],n[S])||c.push({command:b,args:[_,S,n[S],y]}));for(S in n)n.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(T(p[S],n[S])||c.push({command:b,args:[_,S,n[S],y]}))}function ws(p){return p.id}function rc(p,n){return p[n.id]=n,p}class oc{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.clamp(n,0,1);let c=1,_=this._distances[c];const y=n*this.paddedLength+this.padding;for(;_<y&&c<this._distances.length;)_=this._distances[++c];const b=c-1,S=this._distances[b],M=_-S,C=M>0?(y-S)/M:0;return this.points[b].mult(1-C).add(this.points[c].mult(C))}}class _r{constructor(n,c,_){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/_),this.yCellCount=Math.ceil(c/_);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,_,y,b){this._forEachCell(c,_,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(n,c,_,y){this._forEachCell(c-y,_-y,c+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(_),this.circles.push(y)}_insertBoxCell(n,c,_,y,b,S){this.boxCells[b].push(S)}_insertCircleCell(n,c,_,y,b,S){this.circleCells[b].push(S)}_query(n,c,_,y,b,S){if(_<0||n>this.width||y<0||c>this.height)return!b&&[];const M=[];if(n<=0&&c<=0&&this.width<=_&&this.height<=y){if(b)return!0;for(let C=0;C<this.boxKeys.length;C++)M.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const z=this.circles[3*C],L=this.circles[3*C+1],N=this.circles[3*C+2];M.push({key:this.circleKeys[C],x1:z-N,y1:L-N,x2:z+N,y2:L+N})}return S?M.filter(S):M}return this._forEachCell(n,c,_,y,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?M.length>0:M}_queryCircle(n,c,_,y,b){const S=n-_,M=n+_,C=c-_,z=c+_;if(M<0||S>this.width||z<0||C>this.height)return!y&&[];const L=[];return this._forEachCell(S,C,M,z,this._queryCellCircle,L,{hitTest:y,circle:{x:n,y:c,radius:_},seenUids:{box:{},circle:{}}},b),y?L.length>0:L}query(n,c,_,y,b){return this._query(n,c,_,y,!1,b)}hitTest(n,c,_,y,b){return this._query(n,c,_,y,!0,b)}hitTestCircle(n,c,_,y){return this._queryCircle(n,c,_,!0,y)}_queryCell(n,c,_,y,b,S,M,C){const z=M.seenUids,L=this.boxCells[b];if(L!==null){const q=this.bboxes;for(const H of L)if(!z.box[H]){z.box[H]=!0;const J=4*H;if(n<=q[J+2]&&c<=q[J+3]&&_>=q[J+0]&&y>=q[J+1]&&(!C||C(this.boxKeys[H]))){if(M.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[H],x1:q[J],y1:q[J+1],x2:q[J+2],y2:q[J+3]})}}}const N=this.circleCells[b];if(N!==null){const q=this.circles;for(const H of N)if(!z.circle[H]){z.circle[H]=!0;const J=3*H;if(this._circleAndRectCollide(q[J],q[J+1],q[J+2],n,c,_,y)&&(!C||C(this.circleKeys[H]))){if(M.hitTest)return S.push(!0),!0;{const K=q[J],Q=q[J+1],j=q[J+2];S.push({key:this.circleKeys[H],x1:K-j,y1:Q-j,x2:K+j,y2:Q+j})}}}}}_queryCellCircle(n,c,_,y,b,S,M,C){const z=M.circle,L=M.seenUids,N=this.boxCells[b];if(N!==null){const H=this.bboxes;for(const J of N)if(!L.box[J]){L.box[J]=!0;const K=4*J;if(this._circleAndRectCollide(z.x,z.y,z.radius,H[K+0],H[K+1],H[K+2],H[K+3])&&(!C||C(this.boxKeys[J])))return S.push(!0),!0}}const q=this.circleCells[b];if(q!==null){const H=this.circles;for(const J of q)if(!L.circle[J]){L.circle[J]=!0;const K=3*J;if(this._circlesCollide(H[K],H[K+1],H[K+2],z.x,z.y,z.radius)&&(!C||C(this.circleKeys[J])))return S.push(!0),!0}}}_forEachCell(n,c,_,y,b,S,M,C){const z=this._convertToXCellCoord(n),L=this._convertToYCellCoord(c),N=this._convertToXCellCoord(_),q=this._convertToYCellCoord(y);for(let H=z;H<=N;H++)for(let J=L;J<=q;J++)if(b.call(this,n,c,_,y,this.xCellCount*J+H,S,M,C))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,_,y,b,S){const M=y-n,C=b-c,z=_+S;return z*z>M*M+C*C}_circleAndRectCollide(n,c,_,y,b,S,M){const C=(S-y)/2,z=Math.abs(n-(y+C));if(z>C+_)return!1;const L=(M-b)/2,N=Math.abs(c-(b+L));if(N>L+_)return!1;if(z<=C||N<=L)return!0;const q=z-C,H=N-L;return q*q+H*H<=_*_}}const Ts={unknown:0,flipRequired:1,flipNotRequired:2},Vo=Math.tan(85*Math.PI/180);function Oe(p,n,c,_,y,b,S){const M=r.create();if(c)if(b.name==="globe"){const C=r.calculateGlobeLabelMatrix(y,n);r.multiply(M,M,C)}else{const C=Le([],S);M[0]=C[0],M[1]=C[1],M[4]=C[2],M[5]=C[3],_||r.rotateZ(M,M,y.angle)}else r.multiply(M,y.labelPlaneMatrix,p);return M}function Es(p,n,c,_,y,b,S){const M=Oe(p,n,c,_,y,b,S);return b.name==="globe"&&c||(M[2]=M[6]=M[10]=M[14]=0),M}function ji(p,n,c,_,y,b,S){if(c){if(b.name==="globe"){const M=Oe(p,n,c,_,y,b,S);return r.invert(M,M),r.multiply(M,p,M),M}{const M=r.clone(p),C=r.identity([]);return C[0]=S[0],C[1]=S[1],C[4]=S[2],C[5]=S[3],r.multiply(M,M,C),_||r.rotateZ(M,M,-y.angle),M}}return y.glCoordMatrix}function en(p,n,c,_){const y=[p,n,c,1];c?r.transformMat4$1(y,y,_):Ot(y,y,_);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function du(p,n){return Math.min(.5+p/n*.5,1.5)}function hs(p,n){const c=p[0]/p[3],_=p[1]/p[3];return c>=-n[0]&&c<=n[0]&&_>=-n[1]&&_<=n[1]}function ac(p,n,c,_,y,b,S,M,C,z){const L=c.transform,N=_?p.textSizeData:p.iconSizeData,q=r.evaluateSizeForZoom(N,c.transform.zoom),H=L.projection.name==="globe",J=[256/c.width*2+1,256/c.height*2+1],K=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;K.clear();let Q=null;H&&(Q=_?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const j=p.lineVertexArray,Z=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,ne=c.transform.width/c.transform.height;let se,fe=!1;for(let me=0;me<Z.length;me++){const _e=Z.get(me),{numGlyphs:ve,writingMode:xe}=_e;if(xe!==r.WritingMode.vertical||fe||se===r.WritingMode.horizontal||(fe=!0),se=xe,(_e.hidden||xe===r.WritingMode.vertical)&&!fe){es(ve,K);continue}fe=!1;const Ae=new r.Point(_e.tileAnchorX,_e.tileAnchorY);let{x:Ze,y:Ee,z:je}=L.projection.projectTilePoint(Ae.x,Ae.y,z.canonical);if(C){const[wt,dt,xt]=C(Ae);Ze+=wt,Ee+=dt,je+=xt}const Ie=[Ze,Ee,je,1];if(r.transformMat4$1(Ie,Ie,n),!hs(Ie,J)){es(ve,K);continue}const qe=du(c.transform.cameraToCenterDistance,Ie[3]),Me=r.evaluateSizeForFeature(N,q,_e),Ne=S?Me/qe:Me*qe,Xe=en(Ze,Ee,je,y);if(Xe[3]<=0){es(ve,K);continue}let Ge={};const Ye=S?null:C,mt=lt(_e,Ne,!1,M,n,y,b,p.glyphOffsetArray,j,K,Q,Xe,Ae,Ge,ne,Ye,L.projection,z,S);fe=mt.useVertical,Ye&&mt.needsFlipping&&(Ge={}),(mt.notEnoughRoom||fe||mt.needsFlipping&&lt(_e,Ne,!0,M,n,y,b,p.glyphOffsetArray,j,K,Q,Xe,Ae,Ge,ne,Ye,L.projection,z,S).notEnoughRoom)&&es(ve,K)}_?(p.text.dynamicLayoutVertexBuffer.updateData(K),Q&&p.text.globeExtVertexBuffer.updateData(Q)):(p.icon.dynamicLayoutVertexBuffer.updateData(K),Q&&p.icon.globeExtVertexBuffer.updateData(Q))}function pu(p,n,c,_,y,b,S,M,C,z,L,N,q,H,J,K){const{lineStartIndex:Q,glyphStartIndex:j,segment:Z}=M,ne=j+M.numGlyphs,se=Q+M.lineLength,fe=n.getoffsetX(j),me=n.getoffsetX(ne-1),_e=On(p*fe,c,_,y,b,S,Z,Q,se,C,z,L,N,q,!0,H,J,K);if(!_e)return null;const ve=On(p*me,c,_,y,b,S,Z,Q,se,C,z,L,N,q,!0,H,J,K);return ve?{first:_e,last:ve}:null}function Zr(p,n,c,_){return p===r.WritingMode.horizontal&&Math.abs(_)>Math.abs(c)?{useVertical:!0}:p===r.WritingMode.vertical?_>0?{needsFlipping:!0}:null:n!==Ts.unknown&&function(y,b){return y===0||Math.abs(b/y)>Vo}(c,_)?n===Ts.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function lt(p,n,c,_,y,b,S,M,C,z,L,N,q,H,J,K,Q,j,Z){const ne=n/24,se=p.lineOffsetX*ne,fe=p.lineOffsetY*ne,{lineStartIndex:me,glyphStartIndex:_e,numGlyphs:ve,segment:xe,writingMode:Ae,flipState:Ze}=p,Ee=me+p.lineLength,je=Ie=>{if(L){const[Xe,Ge,Ye]=Ie.up,mt=z.length;r.updateGlobeVertexNormal(L,mt+0,Xe,Ge,Ye),r.updateGlobeVertexNormal(L,mt+1,Xe,Ge,Ye),r.updateGlobeVertexNormal(L,mt+2,Xe,Ge,Ye),r.updateGlobeVertexNormal(L,mt+3,Xe,Ge,Ye)}const[qe,Me,Ne]=Ie.point;r.addDynamicAttributes(z,qe,Me,Ne,Ie.angle)};if(ve>1){const Ie=pu(ne,M,se,fe,c,N,q,p,C,b,H,K,!1,Q,j,Z);if(!Ie)return{notEnoughRoom:!0};if(_&&!c){let[qe,Me,Ne]=Ie.first.point,[Xe,Ge,Ye]=Ie.last.point;[qe,Me]=en(qe,Me,Ne,S),[Xe,Ge]=en(Xe,Ge,Ye,S);const mt=Zr(Ae,Ze,(Xe-qe)*J,Ge-Me);if(p.flipState=mt&&mt.needsFlipping?Ts.flipRequired:Ts.flipNotRequired,mt)return mt}je(Ie.first);for(let qe=_e+1;qe<_e+ve-1;qe++){const Me=On(ne*M.getoffsetX(qe),se,fe,c,N,q,xe,me,Ee,C,b,H,K,!1,!1,Q,j,Z);if(!Me)return z.length-=4*(qe-_e),{notEnoughRoom:!0};je(Me)}je(Ie.last)}else{if(_&&!c){const qe=en(q.x,q.y,0,y),Me=me+xe+1,Ne=new r.Point(C.getx(Me),C.gety(Me)),Xe=en(Ne.x,Ne.y,0,y),Ge=Xe[3]>0?Xe:Rt(q,Ne,qe,1,y,void 0,Q,j.canonical),Ye=Zr(Ae,Ze,(Ge[0]-qe[0])*J,Ge[1]-qe[1]);if(p.flipState=Ye&&Ye.needsFlipping?Ts.flipRequired:Ts.flipNotRequired,Ye)return Ye}const Ie=On(ne*M.getoffsetX(_e),se,fe,c,N,q,xe,me,Ee,C,b,H,K,!1,!1,Q,j,Z);if(!Ie)return{notEnoughRoom:!0};je(Ie)}return{}}function Ft(p,n,c,_,y){const{x:b,y:S,z:M}=_.projectTilePoint(p.x,p.y,n);if(!y)return en(b,S,M,c);const[C,z,L]=y(p);return en(b+C,S+z,M+L,c)}function Rt(p,n,c,_,y,b,S,M){const C=Ft(p.sub(n)._unit()._add(p),M,y,S,b);return r.sub(C,c,C),r.normalize(C,C),r.scaleAndAdd(C,c,C,_)}function On(p,n,c,_,y,b,S,M,C,z,L,N,q,H,J,K,Q,j){const Z=_?p-n:p+n;let ne=Z>0?1:-1,se=0;_&&(ne*=-1,se=Math.PI),ne<0&&(se+=Math.PI);let fe=M+S+(ne>0?0:1)|0,me=y,_e=y,ve=0,xe=0;const Ae=Math.abs(Z),Ze=[],Ee=[];let je=b,Ie=je;const qe=()=>Rt(Ie,je,_e,Ae-ve+1,L,q,K,Q.canonical);for(;ve+xe<=Ae;){if(fe+=ne,fe<M||fe>=C)return null;if(_e=me,Ie=je,Ze.push(_e),H&&Ee.push(Ie),je=new r.Point(z.getx(fe),z.gety(fe)),me=N[fe],!me){const xt=Ft(je,Q.canonical,L,K,q);me=xt[3]>0?N[fe]=xt:qe()}ve+=xe,xe=r.distance(_e,me)}J&&q&&(N[fe]&&(me=qe(),xe=r.distance(_e,me)),N[fe]=me);const Me=(Ae-ve)/xe,Ne=je.sub(Ie)._mult(Me)._add(Ie),Xe=r.sub([],me,_e),Ge=r.scaleAndAdd([],_e,Xe,Me);let Ye=[0,0,1],mt=Xe[0],wt=Xe[1];if(j&&(Ye=K.upVector(Q.canonical,Ne.x,Ne.y),Ye[0]!==0||Ye[1]!==0||Ye[2]!==1)){const xt=[Ye[2],0,-Ye[0]],Bt=r.cross([],Ye,xt);r.normalize(xt,xt),r.normalize(Bt,Bt),mt=r.dot(Xe,xt),wt=r.dot(Xe,Bt)}if(c){const xt=r.cross([],Ye,Xe);r.normalize(xt,xt),r.scaleAndAdd(Ge,Ge,xt,c*ne)}const dt=se+Math.atan2(wt,mt);return Ze.push(Ge),H&&Ee.push(Ne),{point:Ge,angle:dt,path:Ze,tilePath:Ee,up:Ye}}function es(p,n){const c=n.length,_=c+4*p;n.resize(_),n.float32.fill(-1/0,4*c,4*_)}function Ot(p,n,c){const _=n[0],y=n[1];return p[0]=c[0]*_+c[4]*y+c[12],p[1]=c[1]*_+c[5]*y+c[13],p[3]=c[3]*_+c[7]*y+c[15],p}const Bn=100;class Uo{constructor(n,c,_=new _r(n.width+200,n.height+200,25),y=new _r(n.width+200,n.height+200,25)){this.transform=n,this.grid=_,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Bn,this.screenBottomBoundary=n.height+Bn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,_,y,b,S,M,C){let z=_.projectedAnchorX,L=_.projectedAnchorY,N=_.projectedAnchorZ;const q=_.elevation,H=_.tileID,J=n.getProjection();if(q&&H){const[me,_e,ve]=J.upVector(H.canonical,_.tileAnchorX,_.tileAnchorY),xe=J.upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=me*q*xe,L+=_e*q*xe,N+=ve*q*xe}const K=this.projectAndGetPerspectiveRatio(M,z,L,N,_.tileID,J.name==="globe"||!!q||this.transform.pitch>0,J),Q=S*K.perspectiveRatio,j=(_.x1*c+y.x-_.padding)*Q+K.point.x,Z=(_.y1*c+y.y-_.padding)*Q+K.point.y,ne=(_.x2*c+y.x+_.padding)*Q+K.point.x,se=(_.y2*c+y.y+_.padding)*Q+K.point.y,fe=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(j,Z,ne,se)||!b&&this.grid.hitTest(j,Z,ne,se,C)||fe?{box:[],offscreen:!1,occluded:K.occluded}:{box:[j,Z,ne,se],offscreen:this.isOffscreen(j,Z,ne,se),occluded:!1}}placeCollisionCircles(n,c,_,y,b,S,M,C,z,L,N,q,H,J,K){const Q=[],j=this.transform.elevation,Z=n.getProjection(),ne=j?j.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,Z):null,se=new r.Point(_.tileAnchorX,_.tileAnchorY);let{x:fe,y:me,z:_e}=Z.projectTilePoint(se.x,se.y,K.canonical);if(ne){const[Ne,Xe,Ge]=ne(se);fe+=Ne,me+=Xe,_e+=Ge}const ve=Z.name==="globe",xe=this.projectAndGetPerspectiveRatio(M,fe,me,_e,K,ve||!!j||this.transform.pitch>0,Z),{perspectiveRatio:Ae}=xe,Ze=(N?S/Ae:S*Ae)/r.ONE_EM,Ee=en(fe,me,_e,C),je=xe.signedDistanceFromCamera>0?pu(Ze,b,_.lineOffsetX*Ze,_.lineOffsetY*Ze,!1,Ee,se,_,y,C,{},j&&!N?ne:null,N&&!!j,Z,K,N):null;let Ie=!1,qe=!1,Me=!0;if(je&&!xe.occluded){const Ne=.5*H*Ae+J,Xe=new r.Point(-100,-100),Ge=new r.Point(this.screenRightBoundary,this.screenBottomBoundary),Ye=new oc,{first:mt,last:wt}=je,dt=mt.path.length;let xt=[];for(let _t=dt-1;_t>=1;_t--)xt.push(mt.path[_t]);for(let _t=1;_t<wt.path.length;_t++)xt.push(wt.path[_t]);const Bt=2.5*Ne;z&&(xt=xt.map(([_t,Jt,ii],ni)=>(ne&&!ve&&(ii=ne(ni<dt-1?mt.tilePath[dt-1-ni]:wt.tilePath[ni-dt+2])[2]),en(_t,Jt,ii,z))),xt.some(_t=>_t[3]<=0)&&(xt=[]));let Dt=[];if(xt.length>0){let _t=1/0,Jt=-1/0,ii=1/0,ni=-1/0;for(const si of xt)_t=Math.min(_t,si[0]),ii=Math.min(ii,si[1]),Jt=Math.max(Jt,si[0]),ni=Math.max(ni,si[1]);Jt>=Xe.x&&_t<=Ge.x&&ni>=Xe.y&&ii<=Ge.y&&(Dt=[xt.map(si=>new r.Point(si[0],si[1]))],(_t<Xe.x||Jt>Ge.x||ii<Xe.y||ni>Ge.y)&&(Dt=r.clipLine(Dt,Xe.x,Xe.y,Ge.x,Ge.y)))}for(const _t of Dt){Ye.reset(_t,.25*Ne);let Jt=0;Jt=Ye.length<=.5*Ne?1:Math.ceil(Ye.paddedLength/Bt)+1;for(let ii=0;ii<Jt;ii++){const ni=ii/Math.max(Jt-1,1),si=Ye.lerp(ni),pn=si.x+Bn,nn=si.y+Bn;Q.push(pn,nn,Ne,0);const Wn=pn-Ne,fs=nn-Ne,bi=pn+Ne,ri=nn+Ne;if(Me=Me&&this.isOffscreen(Wn,fs,bi,ri),qe=qe||this.isInsideGrid(Wn,fs,bi,ri),!c&&this.grid.hitTestCircle(pn,nn,Ne,q)&&(Ie=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Ie,occluded:!1}}}}return{circles:!L&&Ie||!qe?[]:Q,offscreen:Me,collisionDetected:Ie,occluded:xe.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let _=1/0,y=1/0,b=-1/0,S=-1/0;for(const L of n){const N=new r.Point(L.x+Bn,L.y+Bn);_=Math.min(_,N.x),y=Math.min(y,N.y),b=Math.max(b,N.x),S=Math.max(S,N.y),c.push(N)}const M=this.grid.query(_,y,b,S).concat(this.ignoredGrid.query(_,y,b,S)),C={},z={};for(const L of M){const N=L.key;if(C[N.bucketInstanceId]===void 0&&(C[N.bucketInstanceId]={}),C[N.bucketInstanceId][N.featureIndex])continue;const q=[new r.Point(L.x1,L.y1),new r.Point(L.x2,L.y1),new r.Point(L.x2,L.y2),new r.Point(L.x1,L.y2)];r.polygonIntersectsPolygon(c,q)&&(C[N.bucketInstanceId][N.featureIndex]=!0,z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]=[]),z[N.bucketInstanceId].push(N.featureIndex))}return z}insertCollisionBox(n,c,_,y,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:y,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,_,y,b){const S=c?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:y,collisionGroupID:b};for(let C=0;C<n.length;C+=4)S.insertCircle(M,n[C],n[C+1],n[C+2])}projectAndGetPerspectiveRatio(n,c,_,y,b,S,M){const C=[c,_,y,1];let z=!1;y||this.transform.pitch>0?(r.transformMat4$1(C,C,n),this.fogState&&b&&M.name!=="globe"&&(z=function(q,H,J,K,Q,j){const Z=j.calculateFogTileMatrix(Q),ne=[H,J,K];return r.transformMat4(ne,ne,Z),ti(q,ne,j.pitch,j._fov)}(this.fogState,c,_,y,b.toUnwrapped(),this.transform)>.9)):Ot(C,C,n);const L=C[3];return{point:new r.Point((C[0]/L+1)/2*this.transform.width+Bn,(-C[1]/L+1)/2*this.transform.height+Bn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/L*.5,1.5),signedDistanceFromCamera:L,occluded:S&&C[2]>L||z}}isOffscreen(n,c,_,y){return _<Bn||n>=this.screenRightBoundary||y<Bn||c>this.screenBottomBoundary}isInsideGrid(n,c,_,y){return _>=0&&n<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=r.identity([]);return r.translate(n,n,[-100,-100,0]),n}}function mr(p,n,c){const _=n.createTileMatrix(p,p.worldSize,c.toUnwrapped());return r.multiply(new Float32Array(16),p.projMatrix,_)}function Un(p,n,c){if(n.projection.name===c.projection.name)return p.projMatrix;const _=c.clone();return _.setProjection(n.projection),mr(_,n.getProjection(),p)}function vi(p,n,c){return n.name===c.projection.name?p.projMatrix:mr(c,n,p)}class fu{constructor(n,c,_,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class Ss{constructor(n,c,_,y,b,S=!1){this.text=new fu(n?n.text:null,c,_,b),this.icon=new fu(n?n.icon:null,c,y,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Go{constructor(n,c,_,y=!1){this.text=n,this.icon=c,this.skipFade=_,this.clipped=y}}class $o{constructor(){this.invProjMatrix=r.create(),this.viewportMatrix=r.create(),this.circles=[]}}class lc{constructor(n,c,_,y,b){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=b}}class _u{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:_=>_.collisionGroupID===c}}return this.collisionGroups[n]}}function qo(p,n,c,_,y){const{horizontalAlign:b,verticalAlign:S}=r.getAnchorAlignment(p),M=-(b-.5)*n,C=-(S-.5)*c,z=r.evaluateVariableOffset(p,_);return new r.Point(M+z[0]*y,C+z[1]*y)}function Wo(p,n,c,_,y){const b=new r.Point(p,n);return c&&b._rotate(_?y:-y),b}class Ha{constructor(n,c,_,y,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Uo(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new _u(_),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,_,y){const b=_.getBucket(c),S=_.latestFeatureIndex;if(!b||!S||c.id!==b.layerIds[0])return;const M=b.layers[0].layout,C=_.collisionBoxArray,z=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),L=_.tileSize/r.EXTENT,N=_.tileID.toUnwrapped();this.transform.setProjection(b.projection);const q=(H=_.tileID,J=b.getProjection(),K=this.transform,J.name===this.projection?K.calculateProjMatrix(H.toUnwrapped()):mr(K,J,H));var H,J,K;const Q=M.get("text-pitch-alignment")==="map",j=M.get("text-rotation-alignment")==="map";c.compileFilter();const Z=c.dynamicFilter(),ne=c.dynamicFilterNeedsFeature(),se=this.transform.calculatePixelsToTileUnitsMatrix(_),fe=Es(q,_.tileID.canonical,Q,j,this.transform,b.getProjection(),se);let me=null;if(Q){const xe=ji(q,_.tileID.canonical,Q,j,this.transform,b.getProjection(),se);me=r.multiply([],this.transform.labelPlaneMatrix,xe)}let _e=null;Z&&_.latestFeatureIndex&&(_e={unwrappedTileID:N,dynamicFilter:Z,dynamicFilterNeedsFeature:ne,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new lc(b.bucketInstanceId,S,b.sourceLayerIndex,b.index,_.tileID);const ve={bucket:b,layout:M,posMatrix:q,textLabelPlaneMatrix:fe,labelToScreenMatrix:me,clippingData:_e,scale:z,textPixelRatio:L,holdingForFade:_.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:r.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(y)for(const xe of b.sortKeyRanges){const{sortKey:Ae,symbolInstanceStart:Ze,symbolInstanceEnd:Ee}=xe;n.push({sortKey:Ae,symbolInstanceStart:Ze,symbolInstanceEnd:Ee,parameters:ve})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ve})}attemptAnchorPlacement(n,c,_,y,b,S,M,C,z,L,N,q,H,J,K,Q,j,Z){const{textOffset0:ne,textOffset1:se,crossTileID:fe}=q,me=[ne,se],_e=qo(n,_,y,me,b),ve=this.collisionIndex.placeCollisionBox(J,b,c,Wo(_e.x,_e.y,S,M,this.transform.angle),N,C,z,L.predicate);if(Q){const xe=J.getSymbolInstanceIconSize(Z,this.transform.zoom,q.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,xe,Q,Wo(_e.x,_e.y,S,M,this.transform.angle),N,C,z,L.predicate).box.length===0)return}if(ve.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[fe]&&this.prevPlacement.placements[fe]&&this.prevPlacement.placements[fe].text&&(xe=this.prevPlacement.variableOffsets[fe].anchor),this.variableOffsets[fe]={textOffset:me,width:_,height:y,anchor:n,textScale:b,prevAnchor:xe},this.markUsedJustification(J,n,q,K),J.allowVerticalPlacement&&(this.markUsedOrientation(J,K,q),this.placedOrientations[fe]=K),{shift:_e,placedGlyphBoxes:ve}}}placeLayerBucketPart(n,c,_,y){const{bucket:b,layout:S,posMatrix:M,textLabelPlaneMatrix:C,labelToScreenMatrix:z,clippingData:L,textPixelRatio:N,holdingForFade:q,collisionBoxArray:H,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:K,collisionGroup:Q}=n.parameters,j=S.get("text-optional"),Z=S.get("icon-optional"),ne=S.get("text-allow-overlap"),se=S.get("icon-allow-overlap"),fe=S.get("text-rotation-alignment")==="map",me=S.get("text-pitch-alignment")==="map",_e=S.get("icon-text-fit")!=="none",ve=S.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let xe=ne&&(se||!b.hasIconData()||Z),Ae=se&&(ne||!b.hasTextData()||j);!b.collisionArrays&&H&&b.deserializeCollisionBoxes(H),_&&y&&b.updateCollisionDebugBuffers(this.transform.zoom,H);const Ze=(Ee,je,Ie)=>{const{crossTileID:qe,numVerticalGlyphVertices:Me}=Ee;if(L){const bi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ri=null;if(L.dynamicFilterNeedsFeature){const Wt=this.retainedQueryData[b.bucketInstanceId];ri=L.featureIndex.loadFeature({featureIndex:Ee.featureIndex,bucketIndex:Wt.bucketIndex,sourceLayerIndex:Wt.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(bi,ri,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.Point(Ee.tileAnchorX,Ee.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[qe]=new Go(!1,!1,!1,!0),void c.add(qe)}if(c.has(qe))return;if(q)return void(this.placements[qe]=new Go(!1,!1,!1));let Ne=!1,Xe=!1,Ge=!0,Ye=!1,mt=!1,wt=null,dt={box:null,offscreen:null,occluded:null},xt={box:null,offscreen:null,occluded:null},Bt=null,Dt=null,_t=null,Jt=0,ii=0,ni=0;Ie.textFeatureIndex?Jt=Ie.textFeatureIndex:Ee.useRuntimeCollisionCircles&&(Jt=Ee.featureIndex),Ie.verticalTextFeatureIndex&&(ii=Ie.verticalTextFeatureIndex);const si=bi=>{bi.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const ri=this.transform.elevation;(ri||bi.elevation)&&(bi.elevation=ri?ri.getAtTileOffset(bi.tileID,bi.tileAnchorX,bi.tileAnchorY):0)},pn=Ie.textBox;if(pn){si(pn);const bi=Wt=>{let Vi=r.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Wt&&this.prevPlacement){const xn=this.prevPlacement.placedOrientations[qe];xn&&(this.placedOrientations[qe]=xn,Vi=xn,this.markUsedOrientation(b,Vi,Ee))}return Vi},ri=(Wt,Vi)=>{if(b.allowVerticalPlacement&&Me>0&&Ie.verticalTextBox){for(const xn of b.writingModes)if(xn===r.WritingMode.vertical?(dt=Vi(),xt=dt):dt=Wt(),dt&&dt.box&&dt.box.length)break}else dt=Wt()};if(S.get("text-variable-anchor")){let Wt=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[qe]){const mi=this.prevPlacement.variableOffsets[qe];Wt.indexOf(mi.anchor)>0&&(Wt=Wt.filter(En=>En!==mi.anchor),Wt.unshift(mi.anchor))}const Vi=(mi,En,bl)=>{const Er=b.getSymbolInstanceTextSize(J,Ee,this.transform.zoom,je),da=(mi.x2-mi.x1)*Er+2*mi.padding,Ds=(mi.y2-mi.y1)*Er+2*mi.padding,Ks=_e&&!se?En:null;Ks&&si(Ks);let Sr={box:[],offscreen:!1,occluded:!1};const wl=ne?2*Wt.length:Wt.length;for(let pa=0;pa<wl;++pa){const Jc=this.attemptAnchorPlacement(Wt[pa%Wt.length],mi,da,Ds,Er,fe,me,N,M,Q,pa>=Wt.length,Ee,je,b,bl,Ks,J,K);if(Jc&&(Sr=Jc.placedGlyphBoxes,Sr&&Sr.box&&Sr.box.length)){Ne=!0,wt=Jc.shift;break}}return Sr};ri(()=>Vi(pn,Ie.iconBox,r.WritingMode.horizontal),()=>{const mi=Ie.verticalTextBox;return mi&&si(mi),b.allowVerticalPlacement&&!(dt&&dt.box&&dt.box.length)&&Me>0&&mi?Vi(mi,Ie.verticalIconBox,r.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),dt&&(Ne=dt.box,Ge=dt.offscreen,Ye=dt.occluded);const xn=bi(!(!dt||!dt.box));if(!Ne&&this.prevPlacement){const mi=this.prevPlacement.variableOffsets[qe];mi&&(this.variableOffsets[qe]=mi,this.markUsedJustification(b,mi.anchor,Ee,xn))}}else{const Wt=(Vi,xn)=>{const mi=b.getSymbolInstanceTextSize(J,Ee,this.transform.zoom,je),En=this.collisionIndex.placeCollisionBox(b,mi,Vi,new r.Point(0,0),ne,N,M,Q.predicate);return En&&En.box&&En.box.length&&(this.markUsedOrientation(b,xn,Ee),this.placedOrientations[qe]=xn),En};ri(()=>Wt(pn,r.WritingMode.horizontal),()=>{const Vi=Ie.verticalTextBox;return b.allowVerticalPlacement&&Me>0&&Vi?(si(Vi),Wt(Vi,r.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),bi(!!(dt&&dt.box&&dt.box.length))}}if(Bt=dt,Ne=Bt&&Bt.box&&Bt.box.length>0,Ge=Bt&&Bt.offscreen,Ye=Bt&&Bt.occluded,Ee.useRuntimeCollisionCircles){const bi=b.text.placedSymbolArray.get(Ee.centerJustifiedTextSymbolIndex>=0?Ee.centerJustifiedTextSymbolIndex:Ee.verticalPlacedTextSymbolIndex),ri=r.evaluateSizeForFeature(b.textSizeData,J,bi),Wt=S.get("text-padding");Dt=this.collisionIndex.placeCollisionCircles(b,ne,bi,b.lineVertexArray,b.glyphOffsetArray,ri,M,C,z,_,me,Q.predicate,Ee.collisionCircleDiameter*ri/r.ONE_EM,Wt,this.retainedQueryData[b.bucketInstanceId].tileID),Ne=ne||Dt.circles.length>0&&!Dt.collisionDetected,Ge=Ge&&Dt.offscreen,Ye=Dt.occluded}if(Ie.iconFeatureIndex&&(ni=Ie.iconFeatureIndex),Ie.iconBox){const bi=ri=>{si(ri);const Wt=_e&&wt?Wo(wt.x,wt.y,fe,me,this.transform.angle):new r.Point(0,0),Vi=b.getSymbolInstanceIconSize(K,this.transform.zoom,Ee.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Vi,ri,Wt,se,N,M,Q.predicate)};xt&&xt.box&&xt.box.length&&Ie.verticalIconBox?(_t=bi(Ie.verticalIconBox),Xe=_t.box.length>0):(_t=bi(Ie.iconBox),Xe=_t.box.length>0),Ge=Ge&&_t.offscreen,mt=_t.occluded}const nn=j||Ee.numHorizontalGlyphVertices===0&&Me===0,Wn=Z||Ee.numIconVertices===0;if(nn||Wn?Wn?nn||(Xe=Xe&&Ne):Ne=Xe&&Ne:Xe=Ne=Xe&&Ne,Ne&&Bt&&Bt.box&&this.collisionIndex.insertCollisionBox(Bt.box,S.get("text-ignore-placement"),b.bucketInstanceId,xt&&xt.box&&ii?ii:Jt,Q.ID),Xe&&_t&&this.collisionIndex.insertCollisionBox(_t.box,S.get("icon-ignore-placement"),b.bucketInstanceId,ni,Q.ID),Dt&&(Ne&&this.collisionIndex.insertCollisionCircles(Dt.circles,S.get("text-ignore-placement"),b.bucketInstanceId,Jt,Q.ID),_)){const bi=b.bucketInstanceId;let ri=this.collisionCircleArrays[bi];ri===void 0&&(ri=this.collisionCircleArrays[bi]=new $o);for(let Wt=0;Wt<Dt.circles.length;Wt+=4)ri.circles.push(Dt.circles[Wt+0]),ri.circles.push(Dt.circles[Wt+1]),ri.circles.push(Dt.circles[Wt+2]),ri.circles.push(Dt.collisionDetected?1:0)}const fs=b.projection.name!=="globe";xe=xe&&(fs||!Ye),Ae=Ae&&(fs||!mt),this.placements[qe]=new Go(Ne||xe,Xe||Ae,Ge||b.justReloaded),c.add(qe)};if(ve){const Ee=b.getSortedSymbolIndexes(this.transform.angle);for(let je=Ee.length-1;je>=0;--je){const Ie=Ee[je];Ze(b.symbolInstances.get(Ie),Ie,b.collisionArrays[Ie])}}else for(let Ee=n.symbolInstanceStart;Ee<n.symbolInstanceEnd;Ee++)Ze(b.symbolInstances.get(Ee),Ee,b.collisionArrays[Ee]);if(_&&b.bucketInstanceId in this.collisionCircleArrays){const Ee=this.collisionCircleArrays[b.bucketInstanceId];r.invert(Ee.invProjMatrix,M),Ee.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,c,_,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:C,crossTileID:z}=_,L=r.getAnchorJustification(c),N=y===r.WritingMode.vertical?C:L==="left"?b:L==="center"?S:L==="right"?M:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=N>=0&&b!==N?0:z),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=N>=0&&S!==N?0:z),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:z),C>=0&&(n.text.placedSymbolArray.get(C).crossTileID=N>=0&&C!==N?0:z)}markUsedOrientation(n,c,_){const y=c===r.WritingMode.horizontal||c===r.WritingMode.horizontalOnly?c:0,b=c===r.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:z}=_,L=n.text.placedSymbolArray;S>=0&&(L.get(S).placedOrientation=y),M>=0&&(L.get(M).placedOrientation=y),C>=0&&(L.get(C).placedOrientation=y),z>=0&&(L.get(z).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let _=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(n):1,b=c?c.opacities:{},S=c?c.variableOffsets:{},M=c?c.placedOrientations:{};for(const C in this.placements){const z=this.placements[C],L=b[C];L?(this.opacities[C]=new Ss(L,y,z.text,z.icon,null,z.clipped),_=_||z.text!==L.text.placed||z.icon!==L.icon.placed):(this.opacities[C]=new Ss(null,y,z.text,z.icon,z.skipFade,z.clipped),_=_||z.text||z.icon)}for(const C in b){const z=b[C];if(!this.opacities[C]){const L=new Ss(z,y,!1,!1);L.isHidden()||(this.opacities[C]=L,_=_||z.text.placed||z.icon.placed)}}for(const C in S)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=S[C]);for(const C in M)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=M[C]);_?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const _=new Set;for(const y of c){const b=y.getBucket(n);b&&y.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,_,y.collisionBoxArray)}}updateBucketOpacities(n,c,_){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),S=new Ss(null,0,!1,!1,!0),M=y.get("text-allow-overlap"),C=y.get("icon-allow-overlap"),z=y.get("text-variable-anchor"),L=y.get("text-rotation-alignment")==="map",N=y.get("text-pitch-alignment")==="map",q=y.get("icon-text-fit")!=="none",H=new Ss(null,0,M&&(C||!n.hasIconData()||y.get("icon-optional")),C&&(M||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&_&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(_);const J=(Q,j,Z)=>{for(let ne=0;ne<j/4;ne++)Q.opacityVertexArray.emplaceBack(Z)};let K=0;for(let Q=0;Q<n.symbolInstances.length;Q++){const j=n.symbolInstances.get(Q),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:ne,crossTileID:se,numIconVertices:fe}=j,me=c.has(se);let _e=this.opacities[se];me?_e=S:_e||(_e=H,this.opacities[se]=_e),c.add(se);const ve=Z>0||ne>0,xe=fe>0,Ae=this.placedOrientations[se],Ze=Ae===r.WritingMode.vertical,Ee=Ae===r.WritingMode.horizontal||Ae===r.WritingMode.horizontalOnly;if(!ve&&!xe||_e.isHidden()||K++,ve){const je=Zo(_e.text);J(n.text,Z,Ze?Di:je),J(n.text,ne,Ee?Di:je);const Ie=_e.text.isHidden(),{leftJustifiedTextSymbolIndex:qe,centerJustifiedTextSymbolIndex:Me,rightJustifiedTextSymbolIndex:Ne,verticalPlacedTextSymbolIndex:Xe}=j,Ge=n.text.placedSymbolArray,Ye=Ie||Ze?1:0;qe>=0&&(Ge.get(qe).hidden=Ye),Me>=0&&(Ge.get(Me).hidden=Ye),Ne>=0&&(Ge.get(Ne).hidden=Ye),Xe>=0&&(Ge.get(Xe).hidden=Ie||Ee?1:0);const mt=this.variableOffsets[se];mt&&this.markUsedJustification(n,mt.anchor,j,Ae);const wt=this.placedOrientations[se];wt&&(this.markUsedJustification(n,"left",j,wt),this.markUsedOrientation(n,wt,j))}if(xe){const je=Zo(_e.icon),{placedIconSymbolIndex:Ie,verticalPlacedIconSymbolIndex:qe}=j,Me=n.icon.placedSymbolArray,Ne=_e.icon.isHidden()?1:0;Ie>=0&&(J(n.icon,fe,Ze?Di:je),Me.get(Ie).hidden=Ne),qe>=0&&(J(n.icon,j.numVerticalIconVertices,Ee?Di:je),Me.get(qe).hidden=Ne)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const je=n.collisionArrays[Q];if(je){let Ie=new r.Point(0,0),qe=!0;if(je.textBox||je.verticalTextBox){if(z){const Ne=this.variableOffsets[se];Ne?(Ie=qo(Ne.anchor,Ne.width,Ne.height,Ne.textOffset,Ne.textScale),L&&Ie._rotate(N?this.transform.angle:-this.transform.angle)):qe=!1}b&&(qe=!_e.clipped),je.textBox&&Hr(n.textCollisionBox.collisionVertexArray,_e.text.placed,!qe||Ze,Ie.x,Ie.y),je.verticalTextBox&&Hr(n.textCollisionBox.collisionVertexArray,_e.text.placed,!qe||Ee,Ie.x,Ie.y)}const Me=qe&&!!(!Ee&&je.verticalIconBox);je.iconBox&&Hr(n.iconCollisionBox.collisionVertexArray,_e.icon.placed,Me,q?Ie.x:0,q?Ie.y:0),je.verticalIconBox&&Hr(n.iconCollisionBox.collisionVertexArray,_e.icon.placed,!Me,q?Ie.x:0,q?Ie.y:0)}}}if(n.fullyClipped=K===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Q.invProjMatrix,n.placementViewportMatrix=Q.viewportMatrix,n.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const _=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*_>n}setStale(){this.stale=!0}}function Hr(p,n,c,_,y){p.emplaceBack(n?1:0,c?1:0,_||0,y||0),p.emplaceBack(n?1:0,c?1:0,_||0,y||0),p.emplaceBack(n?1:0,c?1:0,_||0,y||0),p.emplaceBack(n?1:0,c?1:0,_||0,y||0)}const wn=Math.pow(2,25),Oi=Math.pow(2,24),cc=Math.pow(2,17),hc=Math.pow(2,16),Tn=Math.pow(2,9),Gn=Math.pow(2,8),mu=Math.pow(2,1);function Zo(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const n=p.placed?1:0,c=Math.floor(127*p.opacity);return c*wn+n*Oi+c*cc+n*hc+c*Tn+n*Gn+c*mu+n}const Di=0;class Ho{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,c,_,y,b){const S=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(S,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((M,C)=>M.sortKey-C.sortKey));this._currentPartIndex<S.length;){const M=S[this._currentPartIndex];if(c.placeLayerBucketPart(M,this._seenCrossTileIDs,_,M.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class uc{constructor(n,c,_,y,b,S,M,C){this.placement=new Ha(n,b,S,M,C),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,c,_){const y=r.exported.now(),b=()=>{const S=r.exported.now()-y;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=c[n[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Ho(S)),this._inProgressLayer.continuePlacement(_[S.source],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const gr=512/r.EXTENT/2;class an{constructor(n,c,_){this.tileID=n,this.bucketInstanceId=_,this.index=new r.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*r.EXTENT,b=n.canonical.y*r.EXTENT;for(let S=0;S<c.length;S++){const{key:M,crossTileID:C,tileAnchorX:z,tileAnchorY:L}=c.get(S),N=Math.floor((y+z)*gr),q=Math.floor((b+L)*gr);this.index.add(N,q),this.keys.push(M),this.crossTileIDs.push(C)}this.index.finish()}findMatches(n,c,_){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),b=gr/Math.pow(2,c.canonical.z-this.tileID.canonical.z),S=c.canonical.x*r.EXTENT,M=c.canonical.y*r.EXTENT;for(let C=0;C<n.length;C++){const z=n.get(C);if(z.crossTileID)continue;const{key:L,tileAnchorX:N,tileAnchorY:q}=z,H=Math.floor((S+N)*b),J=Math.floor((M+q)*b),K=this.index.range(H-y,J-y,H+y,J+y);for(const Q of K){const j=this.crossTileIDs[Q];if(this.keys[Q]===L&&!_.has(j)){_.add(j),z.crossTileID=j;break}}}}}class dc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class pc{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const _ in this.indexes){const y=this.indexes[_],b={};for(const S in y){const M=y[S];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),b[M.tileID.key]=M}this.indexes[_]=b}this.lng=n}addBucket(n,c,_){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>n.overscaledZ)for(const M in S){const C=S[M];C.tileID.isChildOf(n)&&C.findMatches(c.symbolInstances,n,y)}else{const M=S[n.scaledTo(Number(b)).key];M&&M.findMatches(c.symbolInstances,n,y)}}for(let b=0;b<c.symbolInstances.length;b++){const S=c.symbolInstances.get(b);S.crossTileID||(S.crossTileID=_.generate(),y.add(S.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new an(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const _ of c.crossTileIDs)this.usedCrossTileIDs[n].delete(_)}removeStaleBuckets(n){let c=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const b in y)n[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[b]),delete y[b],c=!0)}return c}}class Ms{constructor(){this.layerIndexes={},this.crossTileIDs=new dc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,_,y){let b=this.layerIndexes[n.id];b===void 0&&(b=this.layerIndexes[n.id]=new pc);let S=!1;const M={};y.name!=="globe"&&b.handleWrapJump(_);for(const C of c){const z=C.getBucket(n);z&&n.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(C.tileID,z,this.crossTileIDs)&&(S=!0),M[z.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(S=!0),S}pruneUnusedLayers(n){const c={};n.forEach(_=>{c[_]=!0});for(const _ in this.layerIndexes)c[_]||delete this.layerIndexes[_]}}const Xs=(p,n)=>r.emitValidationErrors(p,n&&n.filter(c=>c.identifier!=="source.canvas")),Xa=r.pick(Ht,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ip=r.pick(Ht,["setCenter","setZoom","setBearing","setPitch"]),fc={version:8,layers:[],sources:{}},Xr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class us extends r.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new xi(Wr(),this),this.imageManager=new zt,this.imageManager.setEventedParent(this),this.glyphManager=new r.GlyphManager(n._requestManager,c.localFontFamily?r.LocalGlyphMode.all:c.localIdeographFontFamily?r.LocalGlyphMode.ideographs:r.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Ms,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",r.getReferrer());const _=this;this._rtlTextPluginCallback=us.registerForPluginStateChange(y=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,S)=>{if(r.triggerPluginCompletionEvent(b),S&&S.every(M=>M))for(const M in _._sourceCaches){const C=_._sourceCaches[M],z=C.getSource().type;z!=="vector"&&z!=="geojson"||C.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getSource(y.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const M=this._layers[S];M.source===b.id&&this._validateLayer(M)}})}loadURL(n,c={}){this.fire(new r.Event("dataloading",{dataType:"style"}));const _=typeof c.validate=="boolean"?c.validate:!r.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const y=this.map._requestManager.transformRequest(n,r.ResourceType.Style);this._request=r.getJSON(y,(b,S)=>{this._request=null,b?this.fire(new r.ErrorEvent(b)):S&&this._load(S,_)})}loadJSON(n,c={}){this.fire(new r.Event("dataloading",{dataType:"style"})),this._request=r.exported.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new r.Event("dataloading",{dataType:"style"})),this._load(fc,!1)}_updateLayerCount(n,c){const _=c?1:-1;n.is3D()&&(this._num3DLayers+=_),n.type==="circle"&&(this._numCircleLayers+=_),n.type==="symbol"&&(this._numSymbolLayers+=_)}_load(n,c){if(c&&Xs(this,r.validateStyle(n)))return;this._loaded=!0,this.stylesheet=r.clone$1(n),this._updateMapProjection();for(const y in n.sources)this.addSource(y,n.sources[y],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const _=uu(this.stylesheet.layers);this._order=_.map(y=>y.id),this._layers={},this._serializedLayers={};for(const y of _){const b=r.createStyleLayer(y);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Gt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new r.Event("data",{dataType:"style"})),this.fire(new r.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(c,_,y){let b,S,M;const C=r.exported.devicePixelRatio>1?"@2x":"";let z=r.getJSON(_.transformRequest(_.normalizeSpriteURL(c,C,".json"),r.ResourceType.SpriteJSON),(q,H)=>{z=null,M||(M=q,b=H,N())}),L=r.getImage(_.transformRequest(_.normalizeSpriteURL(c,C,".png"),r.ResourceType.SpriteImage),(q,H)=>{L=null,M||(M=q,S=H,N())});function N(){if(M)y(M);else if(b&&S){const q=r.exported.getImageData(S),H={};for(const J in b){const{width:K,height:Q,x:j,y:Z,sdf:ne,pixelRatio:se,stretchX:fe,stretchY:me,content:_e}=b[J],ve=new r.RGBAImage({width:K,height:Q});r.RGBAImage.copy(q,ve,{x:j,y:Z},{x:0,y:0},{width:K,height:Q}),H[J]={data:ve,pixelRatio:se,sdf:ne,stretchX:fe,stretchY:me,content:_e}}y(null,H)}}return{cancel(){z&&(z.cancel(),z=null),L&&(L.cancel(),L=null)}}}(n,this.map._requestManager,(c,_)=>{if(this._spriteRequest=null,c)this.fire(new r.ErrorEvent(c));else if(_)for(const y in _)this.imageManager.addImage(y,_[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new r.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const _=n.sourceLayer;_&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(_)===-1)&&this.fire(new r.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const _ of n){const y=this._layers[_];y.type!=="custom"&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():Xr[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(y.length||b.length)&&this._updateWorkerLayers(y,b);for(const S in this._updatedSources){const M=this._updatedSources[S];M==="reload"?this._reloadSource(S):M==="clear"&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const _={};for(const y in this._sourceCaches){const b=this._sourceCaches[y];_[y]=b.used,b.used=!1}for(const y of this._order){const b=this._layers[y];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const M=this._getLayerSourceCache(b);M&&(M.used=!0)}const S=this.map.painter;if(S){const M=b.getProgramIds();if(!M)continue;const C=b.getProgramConfiguration(n.zoom);for(const z of M)S.useProgram(z,C)}}for(const y in _){const b=this._sourceCaches[y];_[y]!==b.used&&b.getSource().fire(new r.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new r.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Xs(this,r.validateStyle(n)))return!1;(n=r.clone$1(n)).layers=uu(n.layers);const c=function(y,b){if(!y)return[{command:Ht.setStyle,args:[b]}];let S=[];try{if(!T(y.version,b.version))return[{command:Ht.setStyle,args:[b]}];T(y.center,b.center)||S.push({command:Ht.setCenter,args:[b.center]}),T(y.zoom,b.zoom)||S.push({command:Ht.setZoom,args:[b.zoom]}),T(y.bearing,b.bearing)||S.push({command:Ht.setBearing,args:[b.bearing]}),T(y.pitch,b.pitch)||S.push({command:Ht.setPitch,args:[b.pitch]}),T(y.sprite,b.sprite)||S.push({command:Ht.setSprite,args:[b.sprite]}),T(y.glyphs,b.glyphs)||S.push({command:Ht.setGlyphs,args:[b.glyphs]}),T(y.transition,b.transition)||S.push({command:Ht.setTransition,args:[b.transition]}),T(y.light,b.light)||S.push({command:Ht.setLight,args:[b.light]}),T(y.fog,b.fog)||S.push({command:Ht.setFog,args:[b.fog]}),T(y.projection,b.projection)||S.push({command:Ht.setProjection,args:[b.projection]});const M={},C=[];(function(N,q,H,J){let K;for(K in q=q||{},N=N||{})N.hasOwnProperty(K)&&(q.hasOwnProperty(K)||jo(K,H,J));for(K in q){if(!q.hasOwnProperty(K))continue;const Q=q[K];N.hasOwnProperty(K)?T(N[K],Q)||(N[K].type==="geojson"&&Q.type==="geojson"&&Za(N,q,K)?H.push({command:Ht.setGeoJSONSourceData,args:[K,Q.data]}):sc(K,q,H,J)):nc(K,q,H)}})(y.sources,b.sources,C,M);const z=[];y.layers&&y.layers.forEach(N=>{N.source&&M[N.source]?S.push({command:Ht.removeLayer,args:[N.id]}):z.push(N)});let L=y.terrain;L&&M[L.source]&&(S.push({command:Ht.setTerrain,args:[void 0]}),L=void 0),S=S.concat(C),T(L,b.terrain)||S.push({command:Ht.setTerrain,args:[b.terrain]}),function(N,q,H){q=q||[];const J=(N=N||[]).map(ws),K=q.map(ws),Q=N.reduce(rc,{}),j=q.reduce(rc,{}),Z=J.slice(),ne=Object.create(null);let se,fe,me,_e,ve,xe,Ae;for(se=0,fe=0;se<J.length;se++)me=J[se],j.hasOwnProperty(me)?fe++:(H.push({command:Ht.removeLayer,args:[me]}),Z.splice(Z.indexOf(me,fe),1));for(se=0,fe=0;se<K.length;se++)me=K[K.length-1-se],Z[Z.length-1-se]!==me&&(Q.hasOwnProperty(me)?(H.push({command:Ht.removeLayer,args:[me]}),Z.splice(Z.lastIndexOf(me,Z.length-fe),1)):fe++,xe=Z[Z.length-se],H.push({command:Ht.addLayer,args:[j[me],xe]}),Z.splice(Z.length-se,0,me),ne[me]=!0);for(se=0;se<K.length;se++)if(me=K[se],_e=Q[me],ve=j[me],!ne[me]&&!T(_e,ve))if(T(_e.source,ve.source)&&T(_e["source-layer"],ve["source-layer"])&&T(_e.type,ve.type)){for(Ae in cs(_e.layout,ve.layout,H,me,null,Ht.setLayoutProperty),cs(_e.paint,ve.paint,H,me,null,Ht.setPaintProperty),T(_e.filter,ve.filter)||H.push({command:Ht.setFilter,args:[me,ve.filter]}),T(_e.minzoom,ve.minzoom)&&T(_e.maxzoom,ve.maxzoom)||H.push({command:Ht.setLayerZoomRange,args:[me,ve.minzoom,ve.maxzoom]}),_e)_e.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?cs(_e[Ae],ve[Ae],H,me,Ae.slice(6),Ht.setPaintProperty):T(_e[Ae],ve[Ae])||H.push({command:Ht.setLayerProperty,args:[me,Ae,ve[Ae]]}));for(Ae in ve)ve.hasOwnProperty(Ae)&&!_e.hasOwnProperty(Ae)&&Ae!=="layout"&&Ae!=="paint"&&Ae!=="filter"&&Ae!=="metadata"&&Ae!=="minzoom"&&Ae!=="maxzoom"&&(Ae.indexOf("paint.")===0?cs(_e[Ae],ve[Ae],H,me,Ae.slice(6),Ht.setPaintProperty):T(_e[Ae],ve[Ae])||H.push({command:Ht.setLayerProperty,args:[me,Ae,ve[Ae]]}))}else H.push({command:Ht.removeLayer,args:[me]}),xe=Z[Z.lastIndexOf(me)+1],H.push({command:Ht.addLayer,args:[ve,xe]})}(z,b.layers,S)}catch(M){console.warn("Unable to compute style diff:",M),S=[{command:Ht.setStyle,args:[b]}]}return S}(this.serialize(),n).filter(y=>!(y.command in Ip));if(c.length===0)return!1;const _=c.filter(y=>!(y.command in Xa));if(_.length>0)throw new Error(`Unimplemented: ${_.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,c){return this.getImage(n)?this.fire(new r.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,c),this._afterImageUpdated(n),this)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new r.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new r.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,c,_={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(r.validateSource,`sources.${n}`,c,null,_))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=kt(n,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:y.serialize(),sourceId:n}));const b=S=>{const M=(S?"symbol:":"other:")+n,C=this._sourceCaches[M]=new r.SourceCache(M,y,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[n]=C,C.style=this,C.onAdd(this.map)};b(!1),c.type!=="vector"&&c.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new r.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new r.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(n);for(const y of _)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new r.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}_getSources(){const n=[];for(const c in this._otherSourceCaches){const _=this._getSourceCache(c);_&&n.push(_.getSource())}return n}addLayer(n,c,_={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(n.type==="custom"){if(Xs(this,r.validateCustomStyleLayer(n)))return;b=r.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=r.clone$1(n),n=r.extend(n,{source:y})),this._validate(r.validateLayer,`layers.${y}`,n,{arrayIndex:-1},_))return;b=r.createStyleLayer(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const S=c?this._order.indexOf(c):this._order.length;if(c&&S===-1)return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const M=this._getLayerSourceCache(b);if(this._removedLayers[y]&&b.source&&M&&b.type!=="custom"){const C=this._removedLayers[y];delete this._removedLayers[y],C.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const _=this._order.indexOf(n);this._order.splice(_,1);const y=c?this._order.indexOf(c):this._order.length;c&&y===-1?this.fire(new r.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const _=this._order.indexOf(n);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,_){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===c&&y.maxzoom===_||(c!=null&&(y.minzoom=c),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,_={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!T(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(r.validateFilter,`layers.${y.id}.filter`,c,{layerType:y.type},_)||(y.filter=r.clone$1(c),this._updateLayer(y)))}else this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const c=this.getLayer(n);return c&&r.clone$1(c.filter)}setLayoutProperty(n,c,_,y={}){this._checkLoaded();const b=this.getLayer(n);b?T(b.getLayoutProperty(c),_)||(b.setLayoutProperty(c,_,y),this._updateLayer(b)):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const _=this.getLayer(n);if(_)return _.getLayoutProperty(c);this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,_,y={}){this._checkLoaded();const b=this.getLayer(n);b?T(b.getPaintProperty(c),_)||(b.setPaintProperty(c,_,y)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){const _=this.getLayer(n);return _&&_.getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const _=n.source,y=n.sourceLayer,b=this.getSource(_);if(!b)return void this.fire(new r.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const S=b.type;if(S==="geojson"&&y)return void this.fire(new r.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!y)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(_);for(const C of M)C.setFeatureState(y,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const _=n.source,y=this.getSource(_);if(!y)return void this.fire(new r.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const b=y.type,S=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!S)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(_);for(const C of M)C.removeFeatureState(S,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,_=n.sourceLayer,y=this.getSource(c);if(y){if(y.type!=="vector"||_)return n.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(_,n.id);this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new r.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return r.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const _=this._sourceCaches[c].getSource();n[_.id]||(n[_.id]=_.serialize())}return r.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=S=>this._layers[S].type==="fill-extrusion",_={},y=[];for(let S=this._order.length-1;S>=0;S--){const M=this._order[S];if(c(M)){_[M]=S;for(const C of n){const z=C[M];if(z)for(const L of z)y.push(L)}}}y.sort((S,M)=>M.intersectionZ-S.intersectionZ);const b=[];for(let S=this._order.length-1;S>=0;S--){const M=this._order[S];if(c(M))for(let C=y.length-1;C>=0;C--){const z=y[C].feature;if(_[z.layer.id]<S)break;b.push(z),y.pop()}else for(const C of n){const z=C[M];if(z)for(const L of z)b.push(L.feature)}}return b}queryRenderedFeatures(n,c,_){c&&c.filter&&this._validate(r.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const C of c.layers){const z=this._layers[C];if(!z)return this.fire(new r.ErrorEvent(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const b=[];c.availableImages=this._availableImages;const S=c&&c.layers?c.layers.some(C=>{const z=this.getLayer(C);return z&&z.is3D()}):this.has3DLayers(),M=gn.createFromScreenPoints(n,_);for(const C in this._sourceCaches){const z=this._sourceCaches[C].getSource().id;c.layers&&!y[z]||b.push(Ei(this._sourceCaches[C],this._layers,this._serializedLayers,M,c,_,S,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(C,z,L,N,q,H,J){const K={},Q=H.queryRenderedSymbols(N),j=[];for(const Z of Object.keys(Q).map(Number))j.push(J[Z]);j.sort(un);for(const Z of j){const ne=Z.featureIndex.lookupSymbolFeatures(Q[Z.bucketInstanceId],z,Z.bucketIndex,Z.sourceLayerIndex,q.filter,q.layers,q.availableImages,C);for(const se in ne){const fe=K[se]=K[se]||[],me=ne[se];me.sort((_e,ve)=>{const xe=Z.featureSortOrder;if(xe){const Ae=xe.indexOf(_e.featureIndex);return xe.indexOf(ve.featureIndex)-Ae}return ve.featureIndex-_e.featureIndex});for(const _e of me)fe.push(_e)}}for(const Z in K)K[Z].forEach(ne=>{const se=ne.feature,fe=L(C[Z]);if(!fe)return;const me=fe.getFeatureState(se.layer["source-layer"],se.id);se.source=se.layer.source,se.layer["source-layer"]&&(se.sourceLayer=se.layer["source-layer"]),se.state=me});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,c){c&&c.filter&&this._validate(r.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const _=this._getSourceCaches(n);let y=[];for(const b of _)y=y.concat(Ni(b,c));return y}addSourceType(n,c,_){return us.getSourceType(n)?_(new Error(`A source type called "${n}" already exists.`)):(us.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const S in n)if(!T(n[S],_[S])){y=!0;break}if(!y)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,c),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,c=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=n;if(c===1){if(typeof _.source=="object"){const y="terrain-dem-src";this.addSource(y,_.source),_=r.clone$1(_),_=r.extend(_,{source:y})}if(this._validate(r.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,c)}else{const y=this.terrain,b=y.get();for(const S of Object.keys(r.spec.terrain))!_.hasOwnProperty(S)&&r.spec.terrain[S].default&&(_[S]=r.spec.terrain[S].default);for(const S in _)if(!T(_[S],b[S])){y.set(_),this.stylesheet.terrain=_;const M=this._setTransitionParameters({duration:0});y.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new Pi(n,this.map.transform);this.stylesheet.fog=n;const _=this._setTransitionParameters({duration:0});c.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,_=c.get();Object.keys(n).length===0&&c.set(n);for(const y in n)if(!T(n[y],_[y])){c.set(n),this.stylesheet.fog=n;const b=this._setTransitionParameters({duration:0});c.updateTransitions(b);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:r.exported.now(),transition:r.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(_=>this.isLayerDraped(this._layers[_])),c=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const _=this.terrain=new Kt(n,c);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});_.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,_,y,b={}){return(!b||b.validate!==!1)&&Xs(this,n.call(r.validateStyle,r.extend({key:c,style:this.serialize(),value:_,styleSpec:r.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const _ of c)_.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const _ of c)_.resume(),_.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,_,y,b=!1){let S=!1,M=!1;const C={};for(const z of this._order){const L=this._layers[z];if(L.type!=="symbol")continue;if(!C[L.source]){const q=this._getLayerSourceCache(L);if(!q)continue;C[L.source]=q.getRenderableIds(!0).map(H=>q.getTileByID(H)).sort((H,J)=>J.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(J.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(L,C[L.source],n.center.lng,n.projection);S=S||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new r.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.exported.now(),n.zoom))&&(this.pauseablePlacement=new uc(n,this._order,b,c,_,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.exported.now()),M=!0),S&&this.pauseablePlacement.placement.setStale()),M||S)for(const z of this._order){const L=this._layers[z];L.type==="symbol"&&this.placement.updateLayerOpacities(L,C[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,_){this.imageManager.getImages(c.icons,_),this._updateTilesForChangedImages();const y=b=>{b&&b.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(n,c,_){this.glyphManager.getGlyphs(c.stacks,_)}getResource(n,c,_){return r.makeRequest(c,_)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this._getSourceCaches(n);return c.length===0?(this.fire(new r.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):c.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}us.getSourceType=function(p){return At[p]},us.setSourceType=function(p,n){At[p]=n},us.registerForPluginStateChange=r.registerForPluginStateChange;var _c=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,yr="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",As=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Xo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Cs=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Ya={},Yr={};const Yo=[];Kr(_c,Yo),Kr(As,Yo),Kr(Xo,Yo),Kr(Cs,Yo),Ya=Xt("",As),Yr=Xt(Cs,Xo);const gu=Xt(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ka=_c,mc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var gc={background:Xt(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xt(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Xt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Xt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Xt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xt(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xt(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Xt(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Xt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xt(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Xt(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Xt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Xt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Xt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Xt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Xt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Xt(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xt(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,yr),skyboxGradient:Xt(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,yr),skyboxCapture:Xt(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xt(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xt(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Kr(p,n){const c=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of c)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=_.split(" ");for(const b of y)n.includes(b)||n.push(b)}}function Xt(p,n){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},b=[...Yo];return Kr(p,b),Kr(n,b),{fragmentSource:p=p.replace(c,(S,M,C,z,L)=>(y[L]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${C} ${z} ${L};
#else
uniform ${C} ${z} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${C} ${z} ${L} = u_${L};
#endif
`)),vertexSource:n=n.replace(c,(S,M,C,z,L)=>{const N=z==="float"?"vec2":"vec4",q=L.match(/color/)?"color":N;return y[L]?M==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${C} ${N} a_${L};
varying ${C} ${z} ${L};
#else
uniform ${C} ${z} u_${L};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${C} ${z} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${q}(a_${L}, u_${L}_t);
#else
    ${C} ${z} ${L} = u_${L};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${C} ${N} a_${L};
#else
uniform ${C} ${z} u_${L};
#endif
`:q==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${C} ${z} ${L} = a_${L};
#else
    ${C} ${z} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${C} ${z} ${L} = unpack_mix_${q}(a_${L}, u_${L}_t);
#else
    ${C} ${z} ${L} = u_${L};
#endif
`}),staticAttributes:_,usedDefines:b}}class Pp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,_,y,b,S,M){this.context=n;let C=this.boundPaintVertexBuffers.length!==y.length;for(let L=0;!C&&L<y.length;L++)this.boundPaintVertexBuffers[L]!==y[L]&&(C=!0);let z=this.boundDynamicVertexBuffers.length!==M.length;for(let L=0;!z&&L<M.length;L++)this.boundDynamicVertexBuffers[L]!==M[L]&&(z=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==_||C||z||this.boundIndexBuffer!==b||this.boundVertexOffset!==S)this.freshBind(c,_,y,b,S,M);else{n.bindVertexArrayOES.set(this.vao);for(const L of M)L&&L.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(n,c,_,y,b,S){let M;const C=n.numAttributes,z=this.context,L=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=S;else{M=z.currentNumAttributes||0;for(let N=C;N<M;N++)L.disableVertexAttribArray(N)}c.enableAttributes(L,n),c.bind(),c.setVertexAttribPointers(L,n,b);for(const N of _)N.enableAttributes(L,n),N.bind(),N.setVertexAttribPointers(L,n,b);for(const N of S)N&&(N.enableAttributes(L,n),N.bind(),N.setVertexAttribPointers(L,n,b));y&&y.bind(),z.currentNumAttributes=C}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yc(p,n){const c=Math.pow(2,n.canonical.z),_=n.canonical.y;return[new r.MercatorCoordinate(0,_/c).toLngLat().lat,new r.MercatorCoordinate(0,(_+1)/c).toLngLat().lat]}function yu(p,n,c,_,y,b,S){const M=p.context,C=M.gl,z=c.fbo;if(!z)return;p.prepareDrawTile();const L=p.useProgram("hillshade");M.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,z.colorAttachment.get());const N=((K,Q,j,Z)=>{const ne=j.paint.get("hillshade-shadow-color"),se=j.paint.get("hillshade-highlight-color"),fe=j.paint.get("hillshade-accent-color");let me=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(me-=K.transform.angle);const _e=!K.options.moving;return{u_matrix:Z||K.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),_e),u_image:0,u_latrange:yc(0,Q.tileID),u_light:[j.paint.get("hillshade-exaggeration"),me],u_shadow:ne,u_highlight:se,u_accent:fe}})(p,c,_,p.terrain?n.projMatrix:null);p.prepareDrawProgram(M,L,n.toUnwrapped());const{tileBoundsBuffer:q,tileBoundsIndexBuffer:H,tileBoundsSegments:J}=p.getTileBoundsBuffers(c);L.draw(M,C.TRIANGLES,y,b,S,r.CullFaceMode.disabled,N,_.id,q,H,J)}function xc(p,n,c){if(!n.needsDEMTextureUpload)return;const _=p.context,y=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||p.getTileTexture(c.stride);const b=c.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new r.Texture(_,b,y.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function xu(p,n,c,_,y,b){const S=p.context,M=S.gl;if(!n.dem)return;const C=n.dem;if(S.activeTexture.set(M.TEXTURE1),xc(p,n,C),!n.demTexture)return;n.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const z=C.dim;S.activeTexture.set(M.TEXTURE0);let L=n.fbo;if(!L){const J=new r.Texture(S,{width:z,height:z,data:null},M.RGBA);J.bind(M.LINEAR,M.CLAMP_TO_EDGE),L=n.fbo=S.createFramebuffer(z,z,!0),L.colorAttachment.set(J.texture)}S.bindFramebuffer.set(L.framebuffer),S.viewport.set([0,0,z,z]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:q,tileBoundsSegments:H}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(S,M.TRIANGLES,_,y,b,r.CullFaceMode.disabled,((J,K)=>{const Q=K.stride,j=r.create();return r.ortho(j,0,r.EXTENT,-r.EXTENT,0,0,1),r.translate(j,j,[0,-r.EXTENT,0]),{u_matrix:j,u_image:1,u_dimension:[Q,Q],u_zoom:J.overscaledZ,u_unpack:K.unpackVector}})(n.tileID,C),c.id,N,q,H),n.needsHillshadePrepare=!1}const vc=p=>({u_matrix:new r.UniformMatrix4f(p),u_image0:new r.Uniform1i(p),u_skirt_height:new r.Uniform1f(p)}),Jr=(p,n)=>({u_matrix:p,u_image0:0,u_skirt_height:n}),Ja=(p,n,c,_,y,b,S,M,C,z,L,N,q,H,J)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:S,u_frustum_tr:M,u_frustum_br:C,u_frustum_bl:z,u_globe_pos:L,u_globe_radius:N,u_viewport:q,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:H});function Qr(p,n){return p!=null&&n!=null&&!(!p.hasData()||!n.hasData())&&p.demTexture!=null&&n.demTexture!=null&&p.tileID.key!==n.tileID.key}const Is=new class{constructor(){this.operations={}}newMorphing(p,n,c,_,y){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[p]={startTime:_,phase:0,duration:y,from:n,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const n=this.operations[p];return{from:n.from,to:n.to,phase:n.phase}}update(p){for(const n in this.operations){const c=this.operations[n];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[n];break}}}_nextOp(p,n){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=n,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},xr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Qa(p){return 6*Math.pow(1.5,22-p)}function vu(p,n){const c=1<<p.z;return!n&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}const Ko=p=>({u_matrix:p});function bc(p,n,c,_,y){if(y>0){const b=r.exported.now(),S=(b-p.timeAdded)/y,M=n?(b-n.timeAdded)/y:-1,C=c.getSource(),z=_.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),L=!n||Math.abs(n.tileID.overscaledZ-z)>Math.abs(p.tileID.overscaledZ-z),N=L&&p.refreshedUponExpiration?1:r.clamp(L?S:1-M,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),n?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class wc extends r.SourceCache{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},_=new xi(Wr(),null),y=kt("mock-dem",c,_,n.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class el extends r.SourceCache{constructor(n){const c=kt("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new xi(Wr(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,_){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const M=new r.Tile(S,this._source.tileSize*S.overscaleFactor(),n.tileZoom);M.state="loaded",this._tiles[S.key]=M}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const _=Object.values(c);this.renderCachePool.push(..._),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class tl extends r.OverscaledTileID{constructor(n,c,_){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=_}}class Tc extends r.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,y,b]=function(C){const z=new r.StructArrayLayout2i4,L=new r.StructArrayLayout3ui6,N=131;z.reserve(17161),L.reserve(33800);const q=r.EXTENT/128,H=r.EXTENT+q/2,J=H+q;for(let Q=-q;Q<J;Q+=q)for(let j=-q;j<J;j+=q){const Z=j<0||j>H||Q<0||Q>H?24575:0,ne=r.clamp(Math.round(j),0,r.EXTENT),se=r.clamp(Math.round(Q),0,r.EXTENT);z.emplaceBack(ne+Z,se)}const K=(Q,j)=>{const Z=j*N+Q;L.emplaceBack(Z+1,Z,Z+N),L.emplaceBack(Z+N,Z+N+1,Z+1)};for(let Q=1;Q<129;Q++)for(let j=1;j<129;j++)K(j,Q);return[0,129].forEach(Q=>{for(let j=0;j<130;j++)K(j,Q),K(Q,j)}),[z,L,32768]}(),S=n.context;this.gridBuffer=S.createVertexBuffer(_,r.posAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(y),this.gridSegments=r.SegmentVector.simpleSegment(0,0,_.length,y.length),this.gridNoSkirtSegments=r.SegmentVector.simpleSegment(0,0,_.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new el(c.map),this.orthoMatrix=r.create(),r.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.EXTENT,0,r.EXTENT,0,1);const M=S.gl;this._overlapStencilMode=new r.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wc(c.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,c,_){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const y=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const b=()=>{this.sourceCache.used&&r.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(c,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),c.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&r.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(C=>{const z=c.getTileByID(C).tileID;return z.projMatrix=_.calculateProjMatrix(z.toUnwrapped()),z});(function(C,z){const L=z.transform.pointCoordinate(z.transform.getCameraPoint()),N=new r.Point(L.x,L.y);C.sort((q,H)=>{if(H.overscaledZ-q.overscaledZ)return H.overscaledZ-q.overscaledZ;const J=new r.Point(q.canonical.x+(1<<q.canonical.z)*q.wrap,q.canonical.y),K=new r.Point(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),Q=N.mult(1<<q.canonical.z);return Q.x-=.5,Q.y-=.5,Q.distSqr(J)-Q.distSqr(K)})})(y,this.painter),this._previousZoom=_.zoom;const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const C in S){const z=S[C];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,n[C],b),z.usedForTerrain))continue;const L=n[C];z.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=y.map(C=>new tl(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=r.exported.now();const M={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const z=this.terrainTileForTile[C.key];if(!z)continue;const L=z.tileID.key;L in M||(this._visibleDemTiles.push(z),M[L]=L)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const _=this._findTileCoveringTileID(c,this.sourceCache);_&&(this.terrainTileForTile[c.key]=_)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const _ in this.terrainTileForTile){const y=this.terrainTileForTile[_],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),xc(this.painter,y,b))}}_prepareDemTileUniforms(n,c,_,y){if(!c||c.demTexture==null)return!1;const b=n.tileID.canonical,S=Math.pow(2,c.tileID.canonical.z-b.z),M=y||"";return _[`u_dem_tl${M}`]=[b.x*S%1,b.y*S%1],_[`u_dem_scale${M}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,c=n.gl;if(!this._emptyDepthBufferTexture){const _=new r.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.Texture(n,_,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((_,y)=>{if(!y.dem)return _;const b=y.dem.tree.minimums[0];return b>0&&n++,_+b},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const _=this._getLoadedAreaMinimum(),y=new r.RGBAImage({width:1,height:1},new Uint8Array(r.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new r.Texture(n,y,c.RGBA,{premultiply:!1}),b}setupElevationDraw(n,c,_){const y=this.painter.context,b=y.gl,S=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:r.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var M;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();let C=null,z=null,L=1;if(_&&_.morphing&&this._useVertexMorphing){const N=_.morphing.srcDemTile,q=_.morphing.dstDemTile;L=_.morphing.phase,N&&q&&(this._prepareDemTileUniforms(n,N,S,"_prev")&&(z=N),this._prepareDemTileUniforms(n,q,S)&&(C=q))}if(z&&C?(y.activeTexture.set(b.TEXTURE2),C.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),y.activeTexture.set(b.TEXTURE4),z.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),S.u_dem_lerp=L):(C=this.terrainTileForTile[n.tileID.key],y.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(n,C,S)?C.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),y.activeTexture.set(b.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&C){const N=(1<<C.tileID.canonical.z)*r.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=N}if(_&&_.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),c.setTerrainUniformValues(y,S),this.painter.transform.projection.name==="globe"){const N=this.globeUniformValues(this.painter.transform,n.tileID.canonical,_&&_.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,N)}}globeUniformValues(n,c,_){const y=n.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,r.EXTENT,0),u_tile_br_up:y.upVector(c,r.EXTENT,r.EXTENT),u_tile_bl_up:y.upVector(c,0,r.EXTENT),u_tile_up_scale:_?r.globeMetersToEcef(1):y.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,_=this.painter.context;n.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,S,M,C){if(y.transform.projection.name==="globe")(function(z,L,N,q,H){const J=z.context,K=J.gl;let Q,j;const Z=z.options.showTerrainWireframe?2:0,ne=z.transform,se=r.globeUseCustomAntiAliasing(z,J,ne),fe=(qe,Me)=>{if(j===qe)return;const Ne=[xr[qe],"PROJECTION_GLOBE_VIEW"];se&&Ne.push("CUSTOM_ANTIALIASING"),Me&&Ne.push(xr[Z]),Q=z.useProgram("globeRaster",null,Ne),j=qe},me=z.colorModeForRenderPass(),_e=new r.DepthMode(K.LEQUAL,r.DepthMode.ReadWrite,z.depthRangeFor3D);Is.update(H);const ve=r.calculateGlobeMercatorMatrix(ne),xe=[r.mercatorXfromLng(ne.center.lng),r.mercatorYfromLat(ne.center.lat)],Ae=Z?[!1,!0]:[!1],Ze=z.globeSharedBuffers,Ee=[ne.width*r.exported.devicePixelRatio,ne.height*r.exported.devicePixelRatio],je=Float32Array.from(ne.globeMatrix),Ie={useDenormalizedUpVectorScale:!0};if(Ae.forEach(qe=>{const Me=z.transform,Ne=Qa(Me.zoom)*L.exaggeration();j=-1;const Xe=qe?K.LINES:K.TRIANGLES;for(const Ge of q){const Ye=N.getTile(Ge),mt=r.StencilMode.disabled,wt=L.prevTerrainTileForTile[Ge.key],dt=L.terrainTileForTile[Ge.key];Qr(wt,dt)&&Is.newMorphing(Ge.key,wt,dt,H,250),J.activeTexture.set(K.TEXTURE0),Ye.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const xt=Is.getMorphValuesForProxy(Ge.key),Bt=xt?1:0;xt&&r.extend$1(Ie,{morphing:{srcDemTile:xt.from,dstDemTile:xt.to,phase:r.easeCubicInOut(xt.phase)}});const Dt=r.tileCornersToBounds(Ge.canonical),_t=r.getLatitudinalLod(Dt.getCenter().lat),Jt=r.getGridMatrix(Ge.canonical,Dt,_t,Me.worldSize/Me._pixelsPerMercatorPixel),ii=r.globeNormalizeECEF(r.globeTileBounds(Ge.canonical)),ni=Ja(Me.projMatrix,je,ve,ii,r.globeToMercatorTransition(Me.zoom),xe,Me.frustumCorners.TL,Me.frustumCorners.TR,Me.frustumCorners.BR,Me.frustumCorners.BL,Me.globeCenterInViewSpace,Me.globeRadius,Ee,Ne,Jt);if(fe(Bt,qe),L.setupElevationDraw(Ye,Q,Ie),z.prepareDrawProgram(J,Q,Ge.toUnwrapped()),Ze){const[si,pn,nn]=qe?Ze.getWirefameBuffers(z.context,_t):Ze.getGridBuffers(_t,Ne!==0);Q.draw(J,Xe,_e,mt,me,r.CullFaceMode.backCCW,ni,"globe_raster",si,pn,nn)}}}),Ze){const qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];se&&qe.push("CUSTOM_ANTIALIASING"),Q=z.useProgram("globeRaster",null,qe);for(const Me of q){const{x:Ne,y:Xe,z:Ge}=Me.canonical,Ye=Xe===0,mt=Xe===(1<<Ge)-1,[wt,dt,xt,Bt]=Ze.getPoleBuffers(Ge);if(Bt&&(Ye||mt)){const Dt=N.getTile(Me);J.activeTexture.set(K.TEXTURE0),Dt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let _t=r.globePoleMatrixForTile(Ge,Ne,ne);const Jt=r.globeNormalizeECEF(r.globeTileBounds(Me.canonical)),ii=(ni,si)=>ni.draw(J,K.TRIANGLES,_e,r.StencilMode.disabled,me,r.CullFaceMode.disabled,Ja(ne.projMatrix,_t,_t,Jt,0,xe,ne.frustumCorners.TL,ne.frustumCorners.TR,ne.frustumCorners.BR,ne.frustumCorners.BL,ne.globeCenterInViewSpace,ne.globeRadius,Ee,0),"globe_pole_raster",si,xt,Bt);L.setupElevationDraw(Dt,Q,Ie),z.prepareDrawProgram(J,Q,Me.toUnwrapped()),Ye&&ii(Q,wt),mt&&(_t=r.scale(r.create(),_t,[1,-1,1]),ii(Q,dt))}}}})(y,b,S,M,C);else{const z=y.context,L=z.gl;let N,q;const H=y.options.showTerrainWireframe?2:0,J=(ne,se)=>{if(q===ne)return;const fe=[xr[ne]];se&&fe.push(xr[H]),N=y.useProgram("terrainRaster",null,fe),q=ne},K=y.colorModeForRenderPass(),Q=new r.DepthMode(L.LEQUAL,r.DepthMode.ReadWrite,y.depthRangeFor3D);Is.update(C);const j=y.transform,Z=Qa(j.zoom)*b.exaggeration();(H?[!1,!0]:[!1]).forEach(ne=>{q=-1;const se=ne?L.LINES:L.TRIANGLES,[fe,me]=ne?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const _e of M){const ve=S.getTile(_e),xe=r.StencilMode.disabled,Ae=b.prevTerrainTileForTile[_e.key],Ze=b.terrainTileForTile[_e.key];Qr(Ae,Ze)&&Is.newMorphing(_e.key,Ae,Ze,C,250),z.activeTexture.set(L.TEXTURE0),ve.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Ee=Is.getMorphValuesForProxy(_e.key),je=Ee?1:0;let Ie;Ee&&(Ie={morphing:{srcDemTile:Ee.from,dstDemTile:Ee.to,phase:r.easeCubicInOut(Ee.phase)}});const qe=Jr(_e.projMatrix,vu(_e.canonical,j.renderWorldCopies)?Z/10:Z);J(je,ne),b.setupElevationDraw(ve,N,Ie),y.prepareDrawProgram(z,N,_e.toUnwrapped()),N.draw(z,se,Q,xe,K,r.CullFaceMode.backCCW,qe,"terrain_raster",b.gridBuffer,fe,me)}})}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,_=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],S=this._drapedRenderBatches.shift(),M=[],C=c.style.order;let z=0;for(const L of b){const N=y.getTileByID(L.proxyTileKey),q=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][n]:void 0,H=q!==void 0?y.renderCache[q]:this.pool[z++],J=q!==void 0;if(N.texture=H.tex,J&&!H.dirty){M.push(N.tileID);continue}let K;_.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(_.clear({color:r.Color.transparent,stencil:0}),H.dirty=!1);for(let Q=S.start;Q<=S.end;++Q){const j=c.style._layers[C[Q]];if(j.isHidden(c.transform.zoom))continue;const Z=c.style._getLayerSourceCache(j),ne=Z?this.proxyToSource[L.key][Z.id]:[L];if(!ne)continue;const se=ne;_.viewport.set([0,0,H.fb.width,H.fb.height]),K!==(Z?Z.id:null)&&(this._setupStencil(H,ne,j,Z),K=Z?Z.id:null),c.renderLayer(c,Z,j,se)}this.renderedToTile?(H.dirty=!0,M.push(N.tileID)):J||--z,z===5&&(z=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),S.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(c===0)return{efficiency:100};let _,y=0,b=0,S=!1;for(let M=0;M<c;++M){const C=n._layers[n.order[M]];this._style.isLayerDraped(C)?(S&&++y,++b):S||(S=!0,_=C.id)}return b===0?{efficiency:100}:{efficiency:100*(1-y/b),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,_){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const S=b.tileID,M=1<<S.overscaledZ,{x:C,y:z}=S.canonical,L=C/M,N=(C+1)/M,q=z/M,H=(z+1)/M;return{minx:L,miny:q,maxx:N,maxy:H,t:b.dem.tree.raycastRoot(L,q,N,H,n,c,_),tile:b}});y.sort((b,S)=>(b.t!==null?b.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,c,_);if(S!=null)return S}return null}_createFBO(){const n=this.painter.context,c=n.gl,_=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const y=new r.Texture(n,{width:_[0],height:_[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=n.createFramebuffer(_[0],_[1],!1);return b.colorAttachment.set(y.texture),b.depthAttachment=new ge(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],_=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!_&&c.shouldRedrape():!_&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const _ of this._style._getSources())if(_ instanceof it){n=!0;break}if(!n)return;const c={};for(let _=0;_<this._style.order.length;++_){const y=this._style._layers[this._style.order[_]],b=this._style._getLayerSourceCache(y);if(b&&!c[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof r.ZoomDependentExpression){c[b.id]=!0;for(const S of this.proxyCoords){const M=this.proxyToSource[S.key][b.id];if(M)for(const C of M)this._clearRenderCacheForTile(b.id,C)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Ke){n=!0;break}if(!n)return;const c={};for(let _=0;_<this._style.order.length;++_){const y=this._style._layers[this._style.order[_]],b=this._style._getLayerSourceCache(y);if(!b||c[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const S=y.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const C=this.proxyToSource[M.key][b.id];if(C)for(const z of C){const L=bc(b.getTile(z),b.findLoadedParent(z,0),b,this.painter.transform,S);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(b.id,z)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(c===0)return;const _=[];let y,b=0,S=this._style._layers[n[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<c;)S=this._style._layers[n[b]];for(;b<c;++b){const M=this._style._layers[n[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?y===void 0&&(y=b):y!==void 0&&(_.push({start:y,end:b-1}),y=void 0))}y!==void 0&&_.push({start:y,end:b-1}),this._drapedRenderBatches=_}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const S=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let M=0;M<S.length;++M){const C=Object.values(S[M]);c.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,y=this._tilesDirty;for(let S=_.length-1;S>=0;S--){const M=_[S];if(c.getTileByID(M.key),c.proxyCachedFBO[M.key]!==void 0){const C=n[M.key],z=this.proxyToSource[M.key];let L=0;for(const N in z){const q=z[N],H=C[N];if(!H||H.length!==q.length||q.some((J,K)=>J!==H[K]||y[N]&&y[N].hasOwnProperty(J.key))){L=-1;break}++L}for(const N in c.proxyCachedFBO[M.key])c.renderCache[c.proxyCachedFBO[M.key][N]].dirty=L<0||L!==Object.values(C).length}}const b=[...this._drapedRenderBatches];b.sort((S,M)=>M.end-M.start-(S.end-S.start));for(const S of b)for(const M of _){if(c.proxyCachedFBO[M.key])continue;let C=c.renderCachePool.pop();C===void 0&&c.renderCache.length<50&&(C=c.renderCache.length,c.renderCache.push(this._createFBO())),C!==void 0&&(c.proxyCachedFBO[M.key]={},c.proxyCachedFBO[M.key][S.start]=C,c.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,_,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let M;if(_.isTileClipped())M=c.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):r.StencilMode.disabled}_renderTileClippingMasks(n,c){const _=this.painter,y=this.painter.context,b=y.gl;_._tileClippingMaskIDs={},y.setColorMode(r.ColorMode.disabled),y.setDepthMode(r.DepthMode.disabled);const S=_.useProgram("clippingMask");for(const M of n){const C=_._tileClippingMaskIDs[M.key]=--c;S.draw(y,b.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:b.ALWAYS,mask:0},C,255,b.KEEP,b.KEEP,b.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,Ko(M.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const _=[n.x,n.y,1,1];r.transformMat4$1(_,_,c.pixelMatrixInverse),r.scale$1(_,_,1/_[3]),_[0]/=c.worldSize,_[1]/=c.worldSize;const y=c._camera.position,b=r.mercatorZfromAltitude(1,c.center.lat),S=[y[0],y[1],y[2]/b,0],M=r.subtract([],_.slice(0,3),S);r.normalize(M,M);const C=this.raycast(S,M,this._exaggeration);return C!==null&&C?(r.scaleAndAdd(S,S,M,C),S[3]=S[2],S[2]*=b,S):null}drawDepth(){const n=this.painter,c=n.context,_=this.proxySourceCache,y=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=c.gl,M=c.createFramebuffer(y,b,!0);c.activeTexture.set(S.TEXTURE0);const C=new r.Texture(c,{width:y,height:b,data:null},S.RGBA);C.bind(S.NEAREST,S.CLAMP_TO_EDGE),M.colorAttachment.set(C.texture);const z=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,b);M.depthAttachment.set(z),this._depthFBO=M,this._depthTexture=C}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,b]),function(S,M,C,z){if(S.transform.projection.name==="globe")return;const L=S.context,N=L.gl;L.clear({depth:1});const q=S.useProgram("terrainDepth"),H=new r.DepthMode(N.LESS,r.DepthMode.ReadWrite,S.depthRangeFor3D);for(const J of z){const K=C.getTile(J),Q=Jr(J.projMatrix,0);M.setupElevationDraw(K,q),q.draw(L,N.TRIANGLES,H,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.backCCW,Q,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(n,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,_){if(n.getSource()instanceof Pt)return this._setupProxiedCoordsForImageSource(n,c,_);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const C=b[M],z=this._findTileCoveringTileID(C,n);if(z){const L=this._createProxiedId(C,z,_[C.key]&&_[C.key][n.id]);y.push(L),this.proxyToSource[C.key][n.id]=[L]}}let S=!1;for(let M=0;M<c.length;M++){const C=n.getTile(c[M]);if(!C||!C.hasData())continue;const z=this._findTileCoveringTileID(C.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==C.tileID.canonical.z){const L=this.proxyToSource[z.tileID.key][n.id],N=this._createProxiedId(z.tileID,C,_[z.tileID.key]&&_[z.tileID.key][n.id]);L?L.splice(L.length-1,0,N):this.proxyToSource[z.tileID.key][n.id]=[N],y.push(N),S=!0}}this._sourceTilesOverlap[n.id]=S}_setupProxiedCoordsForImageSource(n,c,_){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords,S=n.getSource(),M=new r.Point(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),C=S.coordinates.map(r.MercatorCoordinate.fromLngLat).reduce((L,N)=>(L.min.x=Math.min(L.min.x,N.x-M.x),L.min.y=Math.min(L.min.y,N.y-M.y),L.max.x=Math.max(L.max.x,N.x-M.x),L.max.y=Math.max(L.max.y,N.y-M.y),L),{min:new r.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(L,N)=>{const q=L.wrap+L.canonical.x/(1<<L.canonical.z),H=L.canonical.y/(1<<L.canonical.z),J=r.EXTENT/(1<<L.canonical.z),K=N.wrap+N.canonical.x/(1<<N.canonical.z),Q=N.canonical.y/(1<<N.canonical.z);return q+J<K+C.min.x||q>K+C.max.x||H+J<Q+C.min.y||H>Q+C.max.y};for(let L=0;L<b.length;L++){const N=b[L];for(let q=0;q<c.length;q++){const H=n.getTile(c[q]);if(!H||!H.hasData()||z(N,H.tileID))continue;const J=this._createProxiedId(N,H,_[N.key]&&_[N.key][n.id]),K=this.proxyToSource[N.key][n.id];K?K.push(J):this.proxyToSource[N.key][n.id]=[J],y.push(J)}}}_createProxiedId(n,c,_){let y=this.orthoMatrix;if(_){const b=_.find(S=>S.key===c.tileID.key);if(b)return b}if(c.tileID.key!==n.key){const b=n.canonical.z-c.tileID.canonical.z;let S,M,C;y=r.create();const z=c.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(S=r.EXTENT>>b,M=S*((c.tileID.canonical.x<<b)-n.canonical.x+z),C=S*((c.tileID.canonical.y<<b)-n.canonical.y)):(S=r.EXTENT<<-b,M=r.EXTENT*(c.tileID.canonical.x-(n.canonical.x+z<<-b)),C=r.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-b))),r.ortho(y,0,S,0,S,0,1),r.translate(y,y,[M,C,0])}return new tl(c.tileID,n.key,y)}_findTileCoveringTileID(n,c){let _=c.getTile(n);if(_&&_.hasData())return _;const y=this._findCoveringTileCache[c.id],b=y[n.key];if(_=b?c.getTileByID(b):null,_&&_.hasData()||b===null)return _;let S=_?_.tileID:n,M=S.overscaledZ;const C=c.getSource().minzoom,z=[];if(!b){const N=c.getSource().maxzoom;if(n.canonical.z>=N){const q=n.canonical.z-N;c.getSource().reparseOverscaled?(M=Math.max(n.canonical.z+2,c.transform.tileZoom),S=new r.OverscaledTileID(M,n.wrap,N,n.canonical.x>>q,n.canonical.y>>q)):q!==0&&(M=N,S=new r.OverscaledTileID(M,n.wrap,N,n.canonical.x>>q,n.canonical.y>>q))}S.key!==n.key&&(z.push(S.key),_=c.getTile(S))}const L=N=>{z.forEach(q=>{y[q]=N}),z.length=0};for(M-=1;M>=C&&(!_||!_.hasData());M--){_&&L(_.tileID.key);const N=S.calculateScaledKey(M);if(_=c.getTileByID(N),_&&_.hasData())break;const q=y[N];if(q===null)break;q===void 0?z.push(N):_=c.getTileByID(q)}return L(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let _=this._tilesDirty[n];_||(_=this._tilesDirty[n]={}),_[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let _=0;const y=new r.StructArrayLayout2ui4,b=131;for(let S=1;S<129;S++){for(let M=1;M<129;M++)_=S*b+M,y.emplaceBack(_,_+1),y.emplaceBack(_,_+b),y.emplaceBack(_+1,_+b),S===128&&y.emplaceBack(_+b,_+b+1);y.emplaceBack(_+1,_+1+b)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=r.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ut{static cacheKey(n,c,_,y){let b=`${c}${y?y.cacheKey:""}`;for(const S of _)n.usedDefines.includes(S)&&(b+=`/${S}`);return b}constructor(n,c,_,y,b,S){const M=n.gl;this.program=M.createProgram();const C=function(j){const Z=[];for(let ne=0;ne<j.length;ne++){if(j[ne]===null)continue;const se=j[ne].split(" ");Z.push(se.pop())}return Z}(_.staticAttributes),z=y?y.getBinderAttributes():[],L=C.concat(z);let N=y?y.defines():[];N=N.concat(S.map(j=>`#define ${j}`));const q=n.isWebGL2?`#version 300 es
`:"",H=q+N.concat(n.extStandardDerivatives&&q.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(mc):mc,mc,Ka,gu.fragmentSource,Yr.fragmentSource,_.fragmentSource).join(`
`),J=q+N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ka,gu.vertexSource,Yr.vertexSource,Ya.vertexSource,_.vertexSource).join(`
`),K=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(K,H),M.compileShader(K),M.attachShader(this.program,K);const Q=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Q,J),M.compileShader(Q),M.attachShader(this.program,Q),this.attributes={},this.numAttributes=L.length;for(let j=0;j<this.numAttributes;j++)L[j]&&(M.bindAttribLocation(this.program,j,L[j]),this.attributes[L[j]]=j);M.linkProgram(this.program),M.deleteShader(Q),M.deleteShader(K),this.fixedUniforms=b(n),this.binderUniforms=y?y.getUniforms(n):[],S.includes("TERRAIN")&&(this.terrainUniforms=(j=>({u_dem:new r.Uniform1i(j),u_dem_prev:new r.Uniform1i(j),u_dem_unpack:new r.Uniform4f(j),u_dem_tl:new r.Uniform2f(j),u_dem_scale:new r.Uniform1f(j),u_dem_tl_prev:new r.Uniform2f(j),u_dem_scale_prev:new r.Uniform1f(j),u_dem_size:new r.Uniform1f(j),u_dem_lerp:new r.Uniform1f(j),u_exaggeration:new r.Uniform1f(j),u_depth:new r.Uniform1i(j),u_depth_size_inv:new r.Uniform2f(j),u_meter_to_dem:new r.Uniform1f(j),u_label_plane_matrix_inv:new r.UniformMatrix4f(j)}))(n)),S.includes("GLOBE")&&(this.globeUniforms=(j=>({u_tile_tl_up:new r.Uniform3f(j),u_tile_tr_up:new r.Uniform3f(j),u_tile_br_up:new r.Uniform3f(j),u_tile_bl_up:new r.Uniform3f(j),u_tile_up_scale:new r.Uniform1f(j)}))(n)),S.includes("FOG")&&(this.fogUniforms=(j=>({u_fog_matrix:new r.UniformMatrix4f(j),u_fog_range:new r.Uniform2f(j),u_fog_color:new r.Uniform4f(j),u_fog_horizon_blend:new r.Uniform1f(j),u_fog_temporal_offset:new r.Uniform1f(j),u_frustum_tl:new r.Uniform3f(j),u_frustum_tr:new r.Uniform3f(j),u_frustum_br:new r.Uniform3f(j),u_frustum_bl:new r.Uniform3f(j),u_globe_pos:new r.Uniform3f(j),u_globe_radius:new r.Uniform1f(j),u_globe_transition:new r.Uniform1f(j),u_is_globe:new r.Uniform1i(j),u_viewport:new r.Uniform2f(j)}))(n))}}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)_[y]&&_[y].set(this.program,y,c[y])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)_[y]&&_[y].set(this.program,y,c[y])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)_[y].set(this.program,y,c[y])}}draw(n,c,_,y,b,S,M,C,z,L,N,q,H,J,K){const Q=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(_),n.setStencilMode(y),n.setColorMode(b),n.setCullFace(S);for(const Z of Object.keys(this.fixedUniforms))this.fixedUniforms[Z].set(this.program,Z,M[Z]);J&&J.setUniforms(this.program,n,this.binderUniforms,q,{zoom:H});const j={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[c];for(const Z of N.get()){const ne=Z.vaos||(Z.vaos={});(ne[C]||(ne[C]=new Pp)).bind(n,this,z,J?J.getPaintVertexBuffers():[],L,Z.vertexOffset,K||[]),Q.drawElements(c,Z.primitiveLength*j,Q.UNSIGNED_SHORT,Z.primitiveOffset*j*2)}}}function Jo(p,n){const c=Math.pow(2,n.tileID.overscaledZ),_=n.tileSize*Math.pow(2,p.transform.tileZoom)/c,y=_*(n.tileID.canonical.x+n.tileID.wrap*c),b=_*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/ki(n,1,p.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const bu=r.create(),Ec=(p,n,c,_,y,b,S,M,C,z,L)=>{const N=n.style.light,q=N.properties.get("position"),H=[q.x,q.y,q.z],J=r.create$1();N.properties.get("anchor")==="viewport"&&(r.fromRotation(J,-n.transform.angle),r.transformMat3(H,H,J));const K=N.properties.get("color"),Q=n.transform,j={u_matrix:p,u_lightpos:H,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+c,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:b};return Q.projection.name==="globe"&&(j.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],j.u_zoom_transition=C,j.u_inv_rot_matrix=L,j.u_merc_center=z,j.u_up_dir=Q.projection.upVector(new r.CanonicalTileID(0,0,0),z[0]*r.EXTENT,z[1]*r.EXTENT),j.u_height_lift=M),j},wu=(p,n,c,_,y,b,S,M,C,z,L,N)=>{const q=Ec(p,n,c,_,y,b,S,C,z,L,N),H={u_height_factor:-Math.pow(2,S.overscaledZ)/M.tileSize/8};return r.extend(q,Jo(n,M),H)},vr=p=>({u_matrix:p}),Sc=(p,n,c)=>r.extend(vr(p),Jo(n,c)),kp=(p,n)=>({u_matrix:p,u_world:n}),Dp=(p,n,c,_)=>r.extend(Sc(p,n,c),{u_world:_}),Lp=r.create(),Mc=(p,n,c,_,y,b)=>{const S=p.transform,M=S.projection.name==="globe";let C;if(b.paint.get("circle-pitch-alignment")==="map")if(M){const L=r.globePixelsToTileUnits(S.zoom,n.canonical)*S._pixelsPerMercatorPixel;C=Float32Array.from([L,0,0,L])}else C=S.calculatePixelsToTileUnitsMatrix(c);else C=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:p.translatePosMatrix(n.projMatrix,c,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:r.exported.devicePixelRatio,u_extrude_scale:C,u_inv_rot_matrix:Lp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){z.u_inv_rot_matrix=_,z.u_merc_center=y,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=r.globeToMercatorTransition(S.zoom);const L=y[0]*r.EXTENT,N=y[1]*r.EXTENT;z.u_up_dir=S.projection.upVector(new r.CanonicalTileID(0,0,0),L,N)}return z},Ac=p=>{const n=[];return p.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),p.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},Cc=(p,n,c,_)=>{const y=r.EXTENT/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:n.getCameraToCenterDistance(_),u_extrude_scale:[n.pixelsToGLUnits[0]/y,n.pixelsToGLUnits[1]/y]}},il=(p,n,c=1)=>({u_matrix:p,u_color:n,u_overlay:0,u_overlay_scale:c}),Tu=r.create(),Eu=(p,n,c,_,y,b,S)=>{const M=p.transform,C=M.projection.name==="globe",z=C?r.globePixelsToTileUnits(M.zoom,n.canonical)*M._pixelsPerMercatorPixel:ki(c,1,b),L={u_matrix:n.projMatrix,u_extrude_scale:z,u_intensity:S,u_inv_rot_matrix:Tu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){L.u_inv_rot_matrix=_,L.u_merc_center=y,L.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],L.u_zoom_transition=r.globeToMercatorTransition(M.zoom);const N=y[0]*r.EXTENT,q=y[1]*r.EXTENT;L.u_up_dir=M.projection.upVector(new r.CanonicalTileID(0,0,0),N,q)}return L},zp=(p,n,c,_,y,b,S)=>{const M=p.transform,C=M.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:Ic(p,n,c,_),u_pixels_to_tile_units:C,u_device_pixel_ratio:b,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:ea(c)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:eo(n,p.transform),u_alpha_discard_threshold:0,u_trim_offset:S}},Qo=(p,n,c,_,y)=>{const b=p.transform;return{u_matrix:Ic(p,n,c,_),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:eo(n,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function eo(p,n){return 1/ki(p,1,n.tileZoom)}function Ic(p,n,c,_){return p.translatePosMatrix(_||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function ea(p){const n=p.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const Pc=(p,n,c,_,y,b)=>{return{u_matrix:p,u_tl_parent:n,u_scale_parent:c,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(M=y.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(S=y.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ds(y.paint.get("raster-hue-rotate")),u_perspective_transform:b};var S,M};function ds(p){p*=Math.PI/180;const n=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const nl=r.create(),kc=(p,n,c,_,y,b,S,M,C,z,L,N,q,H,J,K)=>{const Q=y.transform,j={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:Q.width/Q.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:M,u_is_text:+C,u_pitch_with_map:+_,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:nl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:nl,u_up_vector:[0,-1,0]};return K.name==="globe"&&(j.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],j.u_zoom_transition=N,j.u_inv_rot_matrix=H,j.u_merc_center=q,j.u_camera_forward=Q._camera.forward(),j.u_ecef_origin=r.globeECEFOrigin(Q.globeMatrix,L.toUnwrapped()),j.u_tile_matrix=Float32Array.from(Q.globeMatrix),j.u_up_vector=J),j},sl=(p,n,c,_,y,b,S,M,C,z,L,N,q,H,J,K,Q)=>r.extend(kc(p,n,c,_,y,b,S,M,C,z,N,q,H,J,K,Q),{u_gamma_scale:_?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:r.exported.devicePixelRatio,u_is_halo:+L}),Su=(p,n,c,_,y,b,S,M,C,z,L,N,q,H,J,K)=>r.extend(sl(p,n,c,_,y,b,S,M,!0,C,!0,L,N,q,H,J,K),{u_texsize_icon:z,u_texture_icon:1}),Dc=(p,n,c)=>({u_matrix:p,u_opacity:n,u_color:c}),Rp=(p,n,c,_,y)=>r.extend(function(b,S,M){const C=S.imageManager.getPattern(b.toString()),{width:z,height:L}=S.imageManager.getPixelSize(),N=Math.pow(2,M.tileID.overscaledZ),q=M.tileSize*Math.pow(2,S.transform.tileZoom)/N,H=q*(M.tileID.canonical.x+M.tileID.wrap*N),J=q*M.tileID.canonical.y;return{u_image:0,u_pattern_tl:C.tl,u_pattern_br:C.br,u_texsize:[z,L],u_pattern_size:C.displaySize,u_tile_units_to_pixels:1/ki(M,1,S.transform.tileZoom),u_pixel_coord_upper:[H>>16,J>>16],u_pixel_coord_lower:[65535&H,65535&J]}}(_,c,y),{u_matrix:p,u_opacity:n}),Lc={fillExtrusion:p=>({u_matrix:new r.UniformMatrix4f(p),u_lightpos:new r.Uniform3f(p),u_lightintensity:new r.Uniform1f(p),u_lightcolor:new r.Uniform3f(p),u_vertical_gradient:new r.Uniform1f(p),u_opacity:new r.Uniform1f(p),u_edge_radius:new r.Uniform1f(p),u_ao:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_up_dir:new r.Uniform3f(p),u_height_lift:new r.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_lightpos:new r.Uniform3f(p),u_lightintensity:new r.Uniform1f(p),u_lightcolor:new r.Uniform3f(p),u_vertical_gradient:new r.Uniform1f(p),u_height_factor:new r.Uniform1f(p),u_edge_radius:new r.Uniform1f(p),u_ao:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_up_dir:new r.Uniform3f(p),u_height_lift:new r.Uniform1f(p),u_image:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_pixel_coord_upper:new r.Uniform2f(p),u_pixel_coord_lower:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p),u_opacity:new r.Uniform1f(p)}),fill:p=>({u_matrix:new r.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_image:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_pixel_coord_upper:new r.Uniform2f(p),u_pixel_coord_lower:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p)}),fillOutline:p=>({u_matrix:new r.UniformMatrix4f(p),u_world:new r.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_world:new r.Uniform2f(p),u_image:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_pixel_coord_upper:new r.Uniform2f(p),u_pixel_coord_lower:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new r.Uniform1f(p),u_extrude_scale:new r.UniformMatrix2f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_up_dir:new r.Uniform3f(p)}),collisionBox:p=>({u_matrix:new r.UniformMatrix4f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_extrude_scale:new r.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new r.UniformMatrix4f(p),u_inv_matrix:new r.UniformMatrix4f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_viewport_size:new r.Uniform2f(p)}),debug:p=>({u_color:new r.UniformColor(p),u_matrix:new r.UniformMatrix4f(p),u_overlay:new r.Uniform1i(p),u_overlay_scale:new r.Uniform1f(p)}),clippingMask:p=>({u_matrix:new r.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new r.Uniform1f(p),u_intensity:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_up_dir:new r.Uniform3f(p)}),heatmapTexture:p=>({u_image:new r.Uniform1i(p),u_color_ramp:new r.Uniform1i(p),u_opacity:new r.Uniform1f(p)}),hillshade:p=>({u_matrix:new r.UniformMatrix4f(p),u_image:new r.Uniform1i(p),u_latrange:new r.Uniform2f(p),u_light:new r.Uniform2f(p),u_shadow:new r.UniformColor(p),u_highlight:new r.UniformColor(p),u_accent:new r.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new r.UniformMatrix4f(p),u_image:new r.Uniform1i(p),u_dimension:new r.Uniform2f(p),u_zoom:new r.Uniform1f(p),u_unpack:new r.Uniform4f(p)}),line:p=>({u_matrix:new r.UniformMatrix4f(p),u_pixels_to_tile_units:new r.UniformMatrix2f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_units_to_pixels:new r.Uniform2f(p),u_dash_image:new r.Uniform1i(p),u_gradient_image:new r.Uniform1i(p),u_image_height:new r.Uniform1f(p),u_texsize:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p),u_alpha_discard_threshold:new r.Uniform1f(p),u_trim_offset:new r.Uniform2f(p)}),linePattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_texsize:new r.Uniform2f(p),u_pixels_to_tile_units:new r.UniformMatrix2f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_image:new r.Uniform1i(p),u_units_to_pixels:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p),u_alpha_discard_threshold:new r.Uniform1f(p)}),raster:p=>({u_matrix:new r.UniformMatrix4f(p),u_tl_parent:new r.Uniform2f(p),u_scale_parent:new r.Uniform1f(p),u_fade_t:new r.Uniform1f(p),u_opacity:new r.Uniform1f(p),u_image0:new r.Uniform1i(p),u_image1:new r.Uniform1i(p),u_brightness_low:new r.Uniform1f(p),u_brightness_high:new r.Uniform1f(p),u_saturation_factor:new r.Uniform1f(p),u_contrast_factor:new r.Uniform1f(p),u_spin_weights:new r.Uniform3f(p),u_perspective_transform:new r.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new r.Uniform1i(p),u_is_size_feature_constant:new r.Uniform1i(p),u_size_t:new r.Uniform1f(p),u_size:new r.Uniform1f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_rotate_symbol:new r.Uniform1i(p),u_aspect_ratio:new r.Uniform1f(p),u_fade_change:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_label_plane_matrix:new r.UniformMatrix4f(p),u_coord_matrix:new r.UniformMatrix4f(p),u_is_text:new r.Uniform1i(p),u_pitch_with_map:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_camera_forward:new r.Uniform3f(p),u_tile_matrix:new r.UniformMatrix4f(p),u_up_vector:new r.Uniform3f(p),u_ecef_origin:new r.Uniform3f(p),u_texture:new r.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new r.Uniform1i(p),u_is_size_feature_constant:new r.Uniform1i(p),u_size_t:new r.Uniform1f(p),u_size:new r.Uniform1f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_rotate_symbol:new r.Uniform1i(p),u_aspect_ratio:new r.Uniform1f(p),u_fade_change:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_label_plane_matrix:new r.UniformMatrix4f(p),u_coord_matrix:new r.UniformMatrix4f(p),u_is_text:new r.Uniform1i(p),u_pitch_with_map:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_texture:new r.Uniform1i(p),u_gamma_scale:new r.Uniform1f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_tile_id:new r.Uniform3f(p),u_zoom_transition:new r.Uniform1f(p),u_inv_rot_matrix:new r.UniformMatrix4f(p),u_merc_center:new r.Uniform2f(p),u_camera_forward:new r.Uniform3f(p),u_tile_matrix:new r.UniformMatrix4f(p),u_up_vector:new r.Uniform3f(p),u_ecef_origin:new r.Uniform3f(p),u_is_halo:new r.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new r.Uniform1i(p),u_is_size_feature_constant:new r.Uniform1i(p),u_size_t:new r.Uniform1f(p),u_size:new r.Uniform1f(p),u_camera_to_center_distance:new r.Uniform1f(p),u_rotate_symbol:new r.Uniform1i(p),u_aspect_ratio:new r.Uniform1f(p),u_fade_change:new r.Uniform1f(p),u_matrix:new r.UniformMatrix4f(p),u_label_plane_matrix:new r.UniformMatrix4f(p),u_coord_matrix:new r.UniformMatrix4f(p),u_is_text:new r.Uniform1i(p),u_pitch_with_map:new r.Uniform1i(p),u_texsize:new r.Uniform2f(p),u_texsize_icon:new r.Uniform2f(p),u_texture:new r.Uniform1i(p),u_texture_icon:new r.Uniform1i(p),u_gamma_scale:new r.Uniform1f(p),u_device_pixel_ratio:new r.Uniform1f(p),u_is_halo:new r.Uniform1i(p)}),background:p=>({u_matrix:new r.UniformMatrix4f(p),u_opacity:new r.Uniform1f(p),u_color:new r.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new r.UniformMatrix4f(p),u_opacity:new r.Uniform1f(p),u_image:new r.Uniform1i(p),u_pattern_tl:new r.Uniform2f(p),u_pattern_br:new r.Uniform2f(p),u_texsize:new r.Uniform2f(p),u_pattern_size:new r.Uniform2f(p),u_pixel_coord_upper:new r.Uniform2f(p),u_pixel_coord_lower:new r.Uniform2f(p),u_tile_units_to_pixels:new r.Uniform1f(p)}),terrainRaster:vc,terrainDepth:vc,skybox:p=>({u_matrix:new r.UniformMatrix4f(p),u_sun_direction:new r.Uniform3f(p),u_cubemap:new r.Uniform1i(p),u_opacity:new r.Uniform1f(p),u_temporal_offset:new r.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new r.UniformMatrix4f(p),u_color_ramp:new r.Uniform1i(p),u_center_direction:new r.Uniform3f(p),u_radius:new r.Uniform1f(p),u_opacity:new r.Uniform1f(p),u_temporal_offset:new r.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new r.UniformMatrix3f(p),u_sun_direction:new r.Uniform3f(p),u_sun_intensity:new r.Uniform1f(p),u_color_tint_r:new r.Uniform4f(p),u_color_tint_m:new r.Uniform4f(p),u_luminance:new r.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new r.UniformMatrix4f(p),u_globe_matrix:new r.UniformMatrix4f(p),u_normalize_matrix:new r.UniformMatrix4f(p),u_merc_matrix:new r.UniformMatrix4f(p),u_zoom_transition:new r.Uniform1f(p),u_merc_center:new r.Uniform2f(p),u_image0:new r.Uniform1i(p),u_grid_matrix:new r.UniformMatrix3f(p),u_skirt_height:new r.Uniform1f(p),u_frustum_tl:new r.Uniform3f(p),u_frustum_tr:new r.Uniform3f(p),u_frustum_br:new r.Uniform3f(p),u_frustum_bl:new r.Uniform3f(p),u_globe_pos:new r.Uniform3f(p),u_globe_radius:new r.Uniform1f(p),u_viewport:new r.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new r.Uniform3f(p),u_frustum_tr:new r.Uniform3f(p),u_frustum_br:new r.Uniform3f(p),u_frustum_bl:new r.Uniform3f(p),u_horizon:new r.Uniform1f(p),u_transition:new r.Uniform1f(p),u_fadeout_range:new r.Uniform1f(p),u_color:new r.Uniform4f(p),u_high_color:new r.Uniform4f(p),u_space_color:new r.Uniform4f(p),u_star_intensity:new r.Uniform1f(p),u_star_density:new r.Uniform1f(p),u_star_size:new r.Uniform1f(p),u_temporal_offset:new r.Uniform1f(p),u_horizon_angle:new r.Uniform1f(p),u_rotation_matrix:new r.UniformMatrix4f(p)})};let rl;function ta(p,n,c,_,y,b,S){const M=p.context,C=M.gl,z=p.transform,L=p.useProgram("collisionBox"),N=[];let q=0,H=0;for(let se=0;se<_.length;se++){const fe=_[se],me=n.getTile(fe),_e=me.getBucket(c);if(!_e)continue;const ve=Un(fe,_e,z);let xe=ve;y[0]===0&&y[1]===0||(xe=p.translatePosMatrix(ve,me,y,b));const Ae=S?_e.textCollisionBox:_e.iconCollisionBox,Ze=_e.collisionCircleArray;if(Ze.length>0){const Ee=r.create(),je=xe;r.mul(Ee,_e.placementInvProjMatrix,z.glCoordMatrix),r.mul(Ee,Ee,_e.placementViewportMatrix),N.push({circleArray:Ze,circleOffset:H,transform:je,invTransform:Ee,projection:_e.getProjection()}),q+=Ze.length/4,H=q}Ae&&(p.terrain&&p.terrain.setupElevationDraw(me,L),L.draw(M,C.LINES,r.DepthMode.disabled,r.StencilMode.disabled,p.colorModeForRenderPass(),r.CullFaceMode.disabled,Cc(xe,z,me,_e.getProjection()),c.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,null,z.zoom,null,[Ae.collisionVertexBuffer,Ae.collisionVertexBufferExt]))}if(!S||!N.length)return;const J=p.useProgram("collisionCircle"),K=new r.StructArrayLayout2f1f2i16;K.resize(4*q),K._trim();let Q=0;for(const se of N)for(let fe=0;fe<se.circleArray.length/4;fe++){const me=4*fe,_e=se.circleArray[me+0],ve=se.circleArray[me+1],xe=se.circleArray[me+2],Ae=se.circleArray[me+3];K.emplace(Q++,_e,ve,xe,Ae,0),K.emplace(Q++,_e,ve,xe,Ae,1),K.emplace(Q++,_e,ve,xe,Ae,2),K.emplace(Q++,_e,ve,xe,Ae,3)}(!rl||rl.length<2*q)&&(rl=function(se){const fe=2*se,me=new r.StructArrayLayout3ui6;me.resize(fe),me._trim();for(let _e=0;_e<fe;_e++){const ve=6*_e;me.uint16[ve+0]=4*_e+0,me.uint16[ve+1]=4*_e+1,me.uint16[ve+2]=4*_e+2,me.uint16[ve+3]=4*_e+2,me.uint16[ve+4]=4*_e+3,me.uint16[ve+5]=4*_e+0}return me}(q));const j=M.createIndexBuffer(rl,!0),Z=M.createVertexBuffer(K,r.collisionCircleLayout.members,!0);for(const se of N){const fe={u_matrix:se.transform,u_inv_matrix:se.invTransform,u_camera_to_center_distance:(ne=z).getCameraToCenterDistance(se.projection),u_viewport_size:[ne.width,ne.height]};J.draw(M,C.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,p.colorModeForRenderPass(),r.CullFaceMode.disabled,fe,c.id,Z,j,r.SegmentVector.simpleSegment(0,2*se.circleOffset,se.circleArray.length,se.circleArray.length/2),null,z.zoom)}var ne;Z.destroy(),j.destroy()}const Mu=r.create();function zc({width:p,height:n,anchor:c,textOffset:_,textScale:y},b){const{horizontalAlign:S,verticalAlign:M}=r.getAnchorAlignment(c),C=-(S-.5)*p,z=-(M-.5)*n,L=r.evaluateVariableOffset(c,_);return new r.Point((C/y+L[0])*b,(z/y+L[1])*b)}function Op(p,n,c,_,y,b,S,M,C,z,L){const N=p.text.placedSymbolArray,q=p.text.dynamicLayoutVertexArray,H=p.icon.dynamicLayoutVertexArray,J={},K=p.getProjection(),Q=vi(M,K,b),j=b.elevation,Z=K.upVectorScale(M.canonical,b.center.lat,b.worldSize).metersToTile;q.clear();for(let ne=0;ne<N.length;ne++){const se=N.get(ne),{tileAnchorX:fe,tileAnchorY:me,numGlyphs:_e}=se,ve=se.hidden||!se.crossTileID||p.allowVerticalPlacement&&!se.placedOrientation?null:_[se.crossTileID];if(ve){let xe=0,Ae=0,Ze=0;if(j){const Ye=j?j.getAtTileOffset(M,fe,me):0,[mt,wt,dt]=K.upVector(M.canonical,fe,me);xe=Ye*mt*Z,Ae=Ye*wt*Z,Ze=Ye*dt*Z}let[Ee,je,Ie,qe]=en(se.projectedAnchorX+xe,se.projectedAnchorY+Ae,se.projectedAnchorZ+Ze,c?Q:S);const Me=du(b.getCameraToCenterDistance(K),qe);let Ne=y.evaluateSizeForFeature(p.textSizeData,z,se)*Me/r.ONE_EM;c&&(Ne*=p.tilePixelRatio/C);const Xe=zc(ve,Ne);c?({x:Ee,y:je,z:Ie}=K.projectTilePoint(fe+Xe.x,me+Xe.y,M.canonical),[Ee,je,Ie]=en(Ee+xe,je+Ae,Ie+Ze,S)):(n&&Xe._rotate(-b.angle),Ee+=Xe.x,je+=Xe.y,Ie=0);const Ge=p.allowVerticalPlacement&&se.placedOrientation===r.WritingMode.vertical?Math.PI/2:0;for(let Ye=0;Ye<_e;Ye++)r.addDynamicAttributes(q,Ee,je,Ie,Ge);L&&se.associatedIconIndex>=0&&(J[se.associatedIconIndex]={x:Ee,y:je,z:Ie,angle:Ge})}else es(_e,q)}if(L){H.clear();const ne=p.icon.placedSymbolArray;for(let se=0;se<ne.length;se++){const fe=ne.get(se),{numGlyphs:me}=fe,_e=J[se];if(fe.hidden||!_e)es(me,H);else{const{x:ve,y:xe,z:Ae,angle:Ze}=_e;for(let Ee=0;Ee<me;Ee++)r.addDynamicAttributes(H,ve,xe,Ae,Ze)}}p.icon.dynamicLayoutVertexBuffer.updateData(H)}p.text.dynamicLayoutVertexBuffer.updateData(q)}function Rc(p,n,c){return c.iconsInText&&n?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Au(p,n,c,_,y,b,S,M,C,z,L,N){const q=p.context,H=q.gl,J=p.transform,K=M==="map",Q=C==="map",j=K&&c.layout.get("symbol-placement")!=="point",Z=K&&!Q&&!j,ne=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let se=!1;const fe=p.depthModeForSublayer(0,r.DepthMode.ReadOnly),me=[r.mercatorXfromLng(J.center.lng),r.mercatorYfromLat(J.center.lat)],_e=c.layout.get("text-variable-anchor"),ve=J.projection.name==="globe",xe=[],Ae=[0,-1,0];let Ze=Ae;!ve&&!J.mercatorFromTransition||K||(Ze=function(Ee){const je=Ee._camera.getWorldToCamera(Ee.worldSize,1),Ie=r.multiply([],je,Ee.globeMatrix);r.invert(Ie,Ie);const qe=[0,0,0],Me=[0,1,0,0];return r.transformMat4$1(Me,Me,Ie),qe[0]=Me[0],qe[1]=Me[1],qe[2]=Me[2],r.normalize(qe,qe),qe}(J));for(const Ee of _){const je=n.getTile(Ee),Ie=je.getBucket(c);if(!Ie||Ie.projection.name==="mercator"&&ve)continue;const qe=y?Ie.text:Ie.icon;if(!qe||Ie.fullyClipped||!qe.segments.get().length)continue;const Me=qe.programConfigurations.get(c.id),Ne=y||Ie.sdfIcons,Xe=y?Ie.textSizeData:Ie.iconSizeData,Ge=Q||J.pitch!==0,Ye=r.evaluateSizeForZoom(Xe,J.zoom);let mt,wt,dt,xt,Bt=[0,0],Dt=null;if(y)wt=je.glyphAtlasTexture,dt=H.LINEAR,mt=je.glyphAtlasTexture.size,Ie.iconsInText&&(Bt=je.imageAtlasTexture.size,Dt=je.imageAtlasTexture,xt=Ge||p.options.rotating||p.options.zooming||Xe.kind==="composite"||Xe.kind==="camera"?H.LINEAR:H.NEAREST);else{const Ds=c.layout.get("icon-size").constantOr(0)!==1||Ie.iconsNeedLinear;wt=je.imageAtlasTexture,dt=Ne||p.options.rotating||p.options.zooming||Ds||Ge?H.LINEAR:H.NEAREST,mt=je.imageAtlasTexture.size}const _t=Ie.projection.name==="globe",Jt=_t?Ze:Ae,ii=_t?r.globeToMercatorTransition(J.zoom):0,ni=vi(Ee,Ie.getProjection(),J),si=J.calculatePixelsToTileUnitsMatrix(je),pn=Oe(ni,je.tileID.canonical,Q,K,J,Ie.getProjection(),si),nn=p.terrain&&Q&&j?r.invert(r.create(),pn):Mu,Wn=ji(ni,je.tileID.canonical,Q,K,J,Ie.getProjection(),si),fs=_e&&Ie.hasTextData(),bi=c.layout.get("icon-text-fit")!=="none"&&fs&&Ie.hasIconData();if(j){const Ds=J.elevation,Ks=Ds?Ds.getAtTileOffsetFunc(Ee,J.center.lat,J.worldSize,Ie.getProjection()):null,Sr=Es(ni,je.tileID.canonical,Q,K,J,Ie.getProjection(),si);ac(Ie,ni,p,y,Sr,Wn,Q,z,Ks,Ee)}const ri=j||y&&_e||bi,Wt=p.translatePosMatrix(ni,je,b,S),Vi=ri?Mu:pn,xn=p.translatePosMatrix(Wn,je,b,S,!0),mi=Ie.getProjection().createInversionMatrix(J,Ee.canonical),En=[];p.terrainRenderModeElevated()&&Q&&En.push("PITCH_WITH_MAP_TERRAIN"),_t&&En.push("PROJECTION_GLOBE_VIEW"),ri&&En.push("PROJECTED_POS_ON_VIEWPORT");const bl=Ne&&c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Er;Er=Ne?Ie.iconsInText?Su(Xe.kind,Ye,Z,Q,p,Wt,Vi,xn,mt,Bt,Ee,ii,me,mi,Jt,Ie.getProjection()):sl(Xe.kind,Ye,Z,Q,p,Wt,Vi,xn,y,mt,!0,Ee,ii,me,mi,Jt,Ie.getProjection()):kc(Xe.kind,Ye,Z,Q,p,Wt,Vi,xn,y,mt,Ee,ii,me,mi,Jt,Ie.getProjection());const da={program:p.useProgram(Rc(Ne,y,Ie),Me,En),buffers:qe,uniformValues:Er,atlasTexture:wt,atlasTextureIcon:Dt,atlasInterpolation:dt,atlasInterpolationIcon:xt,isSDF:Ne,hasHalo:bl,tile:je,labelPlaneMatrixInv:nn};if(ne&&Ie.canOverlap){se=!0;const Ds=qe.segments.get();for(const Ks of Ds)xe.push({segments:new r.SegmentVector([Ks]),sortKey:Ks.sortKey,state:da})}else xe.push({segments:qe.segments,sortKey:0,state:da})}se&&xe.sort((Ee,je)=>Ee.sortKey-je.sortKey);for(const Ee of xe){const je=Ee.state;if(p.terrain&&p.terrain.setupElevationDraw(je.tile,je.program,{useDepthForOcclusion:!ve,labelPlaneMatrixInv:je.labelPlaneMatrixInv}),q.activeTexture.set(H.TEXTURE0),je.atlasTexture.bind(je.atlasInterpolation,H.CLAMP_TO_EDGE),je.atlasTextureIcon&&(q.activeTexture.set(H.TEXTURE1),je.atlasTextureIcon&&je.atlasTextureIcon.bind(je.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),je.isSDF){const Ie=je.uniformValues;je.hasHalo&&(Ie.u_is_halo=1,ia(je.buffers,Ee.segments,c,p,je.program,fe,L,N,Ie)),Ie.u_is_halo=0}ia(je.buffers,Ee.segments,c,p,je.program,fe,L,N,je.uniformValues)}}function ia(p,n,c,_,y,b,S,M,C){const z=_.context,L=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];y.draw(z,z.gl.TRIANGLES,b,S,M,r.CullFaceMode.disabled,C,c.id,p.layoutVertexBuffer,p.indexBuffer,n,c.paint,_.transform.zoom,p.programConfigurations.get(c.id),L)}function Cu(p,n,c,_,y,b,S){const M=p.context.gl,C=c.paint.get("fill-pattern"),z=C&&C.constantOr(1);let L,N,q,H,J;S?(N=z&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=M.LINES):(N=z?"fillPattern":"fill",L=M.TRIANGLES);for(const K of _){const Q=n.getTile(K);if(z&&!Q.patternsLoaded())continue;const j=Q.getBucket(c);if(!j)continue;p.prepareDrawTile();const Z=j.programConfigurations.get(c.id),ne=p.useProgram(N,Z);z&&(p.context.activeTexture.set(M.TEXTURE0),Q.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),Z.updatePaintBuffers());const se=C.constantOr(null);if(se&&Q.imageAtlas){const me=Q.imageAtlas.patternPositions[se.toString()];me&&Z.setConstantPatternPositions(me)}const fe=p.translatePosMatrix(K.projMatrix,Q,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(S){H=j.indexBuffer2,J=j.segments2;const me=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];q=N==="fillOutlinePattern"&&z?Dp(fe,p,Q,me):kp(fe,me)}else H=j.indexBuffer,J=j.segments,q=z?Sc(fe,p,Q):vr(fe);p.prepareDrawProgram(p.context,ne,K.toUnwrapped()),ne.draw(p.context,L,y,p.stencilModeForClipping(K),b,r.CullFaceMode.disabled,q,c.id,j.layoutVertexBuffer,H,J,c.paint,p.transform.zoom,Z)}}function ol(p,n,c,_,y,b,S){const M=p.context,C=M.gl,z=p.transform,L=c.paint.get("fill-extrusion-pattern"),N=L.constantOr(1),q=c.paint.get("fill-extrusion-opacity"),H=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],J=c.layout.get("fill-extrusion-edge-radius"),K=J>0&&!c.paint.get("fill-extrusion-rounded-roof"),Q=K?0:J,j=z.projection.name==="globe"?r.fillExtrusionHeightLift():0,Z=z.projection.name==="globe",ne=Z?r.globeToMercatorTransition(z.zoom):0,se=[r.mercatorXfromLng(z.center.lng),r.mercatorYfromLat(z.center.lat)],fe=[];Z&&fe.push("PROJECTION_GLOBE_VIEW"),H[0]>0&&fe.push("FAUX_AO"),K&&fe.push("ZERO_ROOF_RADIUS");for(const me of _){const _e=n.getTile(me),ve=_e.getBucket(c);if(!ve||ve.projection.name!==z.projection.name)continue;const xe=ve.programConfigurations.get(c.id),Ae=p.useProgram(N?"fillExtrusionPattern":"fillExtrusion",xe,fe);if(p.terrain){const Ne=p.terrain;if(p.style.terrainSetForDrapingOnly())Ne.setupElevationDraw(_e,Ae,{useMeterToDem:!0});else{if(!ve.enableTerrain)continue;if(Ne.setupElevationDraw(_e,Ae,{useMeterToDem:!0}),Iu(M,n,me,ve,c,Ne),!ve.centroidVertexBuffer){const Xe=Ae.attributes.a_centroid_pos;Xe!==void 0&&C.vertexAttrib2f(Xe,0,0)}}}N&&(p.context.activeTexture.set(C.TEXTURE0),_e.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),xe.updatePaintBuffers());const Ze=L.constantOr(null);if(Ze&&_e.imageAtlas){const Ne=_e.imageAtlas.patternPositions[Ze.toString()];Ne&&xe.setConstantPatternPositions(Ne)}const Ee=p.translatePosMatrix(me.projMatrix,_e,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),je=z.projection.createInversionMatrix(z,me.canonical),Ie=c.paint.get("fill-extrusion-vertical-gradient"),qe=N?wu(Ee,p,Ie,q,H,Q,me,_e,j,ne,se,je):Ec(Ee,p,Ie,q,H,Q,me,j,ne,se,je);p.prepareDrawProgram(M,Ae,me.toUnwrapped());const Me=[];p.terrain&&Me.push(ve.centroidVertexBuffer),Z&&Me.push(ve.layoutVertexExtBuffer),Ae.draw(M,M.gl.TRIANGLES,y,b,S,r.CullFaceMode.backCCW,qe,c.id,ve.layoutVertexBuffer,ve.indexBuffer,ve.segments,c.paint,p.transform.zoom,xe,Me)}}function Iu(p,n,c,_,y,b){const S=[j=>{let Z=j.canonical.x-1,ne=j.wrap;return Z<0&&(Z=(1<<j.canonical.z)-1,ne--),new r.OverscaledTileID(j.overscaledZ,ne,j.canonical.z,Z,j.canonical.y)},j=>{let Z=j.canonical.x+1,ne=j.wrap;return Z===1<<j.canonical.z&&(Z=0,ne++),new r.OverscaledTileID(j.overscaledZ,ne,j.canonical.z,Z,j.canonical.y)},j=>new r.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,(j.canonical.y===0?1<<j.canonical.z:j.canonical.y)-1),j=>new r.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y===(1<<j.canonical.z)-1?0:j.canonical.y+1)],M=j=>{const Z=n.getSource().minzoom,ne=fe=>{const me=n.getTileByID(fe);if(me&&me.hasData())return me.getBucket(y)},se=[0,-1,1];for(const fe of se){if(j.overscaledZ+fe<Z)continue;const me=ne(j.calculateScaledKey(j.overscaledZ+fe));if(me)return me}},C=[0,0,0],z=(j,Z)=>(C[0]=Math.min(j.min.y,Z.min.y),C[1]=Math.max(j.max.y,Z.max.y),C[2]=r.EXTENT-Z.min.x>j.max.x?Z.min.x-r.EXTENT:j.max.x,C),L=(j,Z)=>(C[0]=Math.min(j.min.x,Z.min.x),C[1]=Math.max(j.max.x,Z.max.x),C[2]=r.EXTENT-Z.min.y>j.max.y?Z.min.y-r.EXTENT:j.max.y,C),N=[(j,Z)=>z(j,Z),(j,Z)=>z(Z,j),(j,Z)=>L(j,Z),(j,Z)=>L(Z,j)],q=new r.Point(0,0);let H,J,K;const Q=(j,Z,ne,se,fe)=>{const me=[[se?ne:j,se?j:ne,0],[se?ne:Z,se?Z:ne,0]],_e=fe<0?r.EXTENT+fe:fe,ve=[se?_e:(j+Z)/2,se?(j+Z)/2:_e,0];return ne===0&&fe<0||ne!==0&&fe>0?b.getForTilePoints(K,[ve],!0,J):me.push(ve),b.getForTilePoints(c,me,!0,H),Math.max(me[0][2],me[1][2],ve[2])/b.exaggeration()};for(let j=0;j<4;j++){const Z=(j<2?1:5)-j,ne=_.borders[j];if(ne.length===0)continue;const se=K=S[j](c),fe=M(se);if(!(fe&&fe instanceof r.FillExtrusionBucket&&fe.enableTerrain)||_.borderDoneWithNeighborZ[j]===fe.canonical.z&&fe.borderDoneWithNeighborZ[Z]===_.canonical.z||(J=b.findDEMTileFor(se),!J||!J.dem))continue;if(!H){const xe=b.findDEMTileFor(c);if(!xe||!xe.dem)return;H=xe}const me=fe.borders[Z];let _e=0;const ve=fe.borderDoneWithNeighborZ[Z]!==_.canonical.z;if(_.canonical.z===fe.canonical.z){for(let xe=0;xe<ne.length;xe++){const Ae=_.featuresOnBorder[ne[xe]],Ze=Ae.borders[j];let Ee;for(;_e<me.length&&(Ee=fe.featuresOnBorder[me[_e]],!(Ee.borders[Z][1]>Ze[0]+3));)ve&&fe.encodeCentroid(void 0,Ee,!1),_e++;if(Ee&&_e<me.length){const je=_e;let Ie=0;for(;!(Ee.borders[Z][0]>Ze[1]-3)&&(Ie++,++_e!==me.length);)Ee=fe.featuresOnBorder[me[_e]];if(Ee=fe.featuresOnBorder[me[je]],Ae.intersectsCount()>1||Ee.intersectsCount()>1||Ie!==1){Ie!==1&&(_e=je),_.encodeCentroid(void 0,Ae,!1),ve&&fe.encodeCentroid(void 0,Ee,!1);continue}const qe=N[j](Ae,Ee),Me=j%2?r.EXTENT-1:0;q.x=Q(qe[0],Math.min(r.EXTENT-1,qe[1]),Me,j<2,qe[2]),q.y=0,_.encodeCentroid(q,Ae,!1),ve&&fe.encodeCentroid(q,Ee,!1)}else _.encodeCentroid(void 0,Ae,!1)}_.borderDoneWithNeighborZ[j]=fe.canonical.z,_.needsCentroidUpdate=!0,ve&&(fe.borderDoneWithNeighborZ[Z]=_.canonical.z,fe.needsCentroidUpdate=!0)}else{for(const xe of ne)_.encodeCentroid(void 0,_.featuresOnBorder[xe],!1);if(ve){for(const xe of me)fe.encodeCentroid(void 0,fe.featuresOnBorder[xe],!1);fe.borderDoneWithNeighborZ[Z]=_.canonical.z,fe.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[j]=fe.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(p)}const to=new r.Color(1,0,0,1),Bp=new r.Color(0,1,0,1),Fp=new r.Color(0,0,1,1),Np=new r.Color(1,0,1,1),jp=new r.Color(0,1,1,1);function Vp(p,n,c){const _=p.context,y=p.transform,b=_.gl,S=y.projection.name==="globe",M=S?["PROJECTION_GLOBE_VIEW"]:null;let C=c.projMatrix;if(S&&r.globeToMercatorTransition(y.zoom)>0){const Ae=r.transitionTileAABBinECEF(c.canonical,y),Ze=r.globeDenormalizeECEF(Ae);C=r.multiply(new Float32Array(16),y.globeMatrix,Ze),r.multiply(C,y.projMatrix,C)}const z=p.useProgram("debug",null,M),L=n.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(L,z);const N=r.DepthMode.disabled,q=r.StencilMode.disabled,H=p.colorModeForRenderPass(),J="$debug";_.activeTexture.set(b.TEXTURE0),p.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),S?L._makeGlobeTileDebugBuffers(p.context,y):L._makeDebugTileBoundsBuffers(p.context,y.projection);const K=L._tileDebugBuffer||p.debugBuffer,Q=L._tileDebugIndexBuffer||p.debugIndexBuffer,j=L._tileDebugSegments||p.debugSegments;z.draw(_,b.LINE_STRIP,N,q,H,r.CullFaceMode.disabled,il(C,r.Color.red),J,K,Q,j,null,null,null,[L._globeTileDebugBorderBuffer]);const Z=L.latestRawTileData,ne=Math.floor((Z&&Z.byteLength||0)/1024),se=n.getTile(c).tileSize,fe=512/Math.min(se,512)*(c.overscaledZ/y.zoom)*.5;let me=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(me+=` => ${c.overscaledZ}`),me+=` ${ne}kb`,function(Ae,Ze){Ae.initDebugOverlayCanvas();const Ee=Ae.debugOverlayCanvas,je=Ae.context.gl,Ie=Ae.debugOverlayCanvas.getContext("2d");Ie.clearRect(0,0,Ee.width,Ee.height),Ie.shadowColor="white",Ie.shadowBlur=2,Ie.lineWidth=1.5,Ie.strokeStyle="white",Ie.textBaseline="top",Ie.font="bold 36px Open Sans, sans-serif",Ie.fillText(Ze,5,5),Ie.strokeText(Ze,5,5),Ae.debugOverlayTexture.update(Ee),Ae.debugOverlayTexture.bind(je.LINEAR,je.CLAMP_TO_EDGE)}(p,me);const _e=L._tileDebugTextBuffer||p.debugBuffer,ve=L._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,xe=L._tileDebugTextSegments||p.debugSegments;z.draw(_,b.TRIANGLES,N,q,r.ColorMode.alphaBlended,r.CullFaceMode.disabled,il(C,r.Color.transparent,fe),J,_e,ve,xe,null,null,null,[L._globeTileDebugTextBuffer])}function Pu(p,n,c,_){io(p,0,n+c/2,p.transform.width,c,_)}function al(p,n,c,_){io(p,n-c/2,0,c,p.transform.height,_)}function io(p,n,c,_,y,b){const S=p.context,M=S.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*r.exported.devicePixelRatio,c*r.exported.devicePixelRatio,_*r.exported.devicePixelRatio,y*r.exported.devicePixelRatio),S.clear({color:b}),M.disable(M.SCISSOR_TEST)}const ku=r.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Du}=ku;function Ps(p,n,c,_){p.emplaceBack(n,c,_)}class ll{constructor(n){this.vertexArray=new r.StructArrayLayout3f12,this.indices=new r.StructArrayLayout3ui6,Ps(this.vertexArray,-1,-1,1),Ps(this.vertexArray,1,-1,1),Ps(this.vertexArray,-1,1,1),Ps(this.vertexArray,1,1,1),Ps(this.vertexArray,-1,-1,-1),Ps(this.vertexArray,1,-1,-1),Ps(this.vertexArray,-1,1,-1),Ps(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Du),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.SegmentVector.simpleSegment(0,0,36,12)}}function $n(p,n,c,_,y,b){const S=p.gl,M=n.paint.get("sky-atmosphere-color"),C=n.paint.get("sky-atmosphere-halo-color"),z=n.paint.get("sky-atmosphere-sun-intensity"),L=((N,q,H,J,K)=>({u_matrix_3f:N,u_sun_direction:q,u_sun_intensity:H,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(r.fromMat4(r.create$1(),_),y,z,M,C);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),c.draw(p,S.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.frontCW,L,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const na=r.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Lu{constructor(n){const c=new r.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const _=new r.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,na.members),this.indexBuffer=n.createIndexBuffer(_),this.segments=r.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const br={symbol:function(p,n,c,_,y){if(p.renderPass!=="translucent")return;const b=r.StencilMode.disabled,S=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(M,C,z,L,N,q,H){const J=C.transform,K=N==="map",Q=q==="map";for(const j of M){const Z=L.getTile(j),ne=Z.getBucket(z);if(!ne||!ne.text||!ne.text.segments.get().length)continue;const se=r.evaluateSizeForZoom(ne.textSizeData,J.zoom),fe=vi(j,ne.getProjection(),J),me=J.calculatePixelsToTileUnitsMatrix(Z),_e=Oe(fe,Z.tileID.canonical,Q,K,J,ne.getProjection(),me),ve=z.layout.get("icon-text-fit")!=="none"&&ne.hasIconData();if(se){const xe=Math.pow(2,J.zoom-Z.tileID.overscaledZ);Op(ne,K,Q,H,r.symbolSize,J,_e,j,xe,se,ve)}}}(_,p,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),c.paint.get("icon-opacity").constantOr(1)!==0&&Au(p,n,c,_,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),b,S),c.paint.get("text-opacity").constantOr(1)!==0&&Au(p,n,c,_,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),b,S),n.map.showCollisionBoxes&&(ta(p,n,c,_,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ta(p,n,c,_,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,n,c,_){if(p.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),M=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(b.constantOr(1)===0||S.constantOr(1)===0))return;const C=p.context,z=C.gl,L=p.transform,N=p.depthModeForSublayer(0,r.DepthMode.ReadOnly),q=r.StencilMode.disabled,H=p.colorModeForRenderPass(),J=L.projection.name==="globe",K=[r.mercatorXfromLng(L.center.lng),r.mercatorYfromLat(L.center.lat)],Q=[];for(let Z=0;Z<_.length;Z++){const ne=_[Z],se=n.getTile(ne),fe=se.getBucket(c);if(!fe||fe.projection.name!==L.projection.name)continue;const me=fe.programConfigurations.get(c.id),_e=Ac(c);J&&_e.push("PROJECTION_GLOBE_VIEW");const ve=p.useProgram("circle",me,_e),xe=fe.layoutVertexBuffer,Ae=fe.globeExtVertexBuffer,Ze=fe.indexBuffer,Ee=L.projection.createInversionMatrix(L,ne.canonical),je={programConfiguration:me,program:ve,layoutVertexBuffer:xe,globeExtVertexBuffer:Ae,indexBuffer:Ze,uniformValues:Mc(p,ne,se,Ee,K,c),tile:se};if(M){const Ie=fe.segments.get();for(const qe of Ie)Q.push({segments:new r.SegmentVector([qe]),sortKey:qe.sortKey,state:je})}else Q.push({segments:fe.segments,sortKey:0,state:je})}M&&Q.sort((Z,ne)=>Z.sortKey-ne.sortKey);const j={useDepthForOcclusion:!J};for(const Z of Q){const{programConfiguration:ne,program:se,layoutVertexBuffer:fe,globeExtVertexBuffer:me,indexBuffer:_e,uniformValues:ve,tile:xe}=Z.state,Ae=Z.segments;p.terrain&&p.terrain.setupElevationDraw(xe,se,j),p.prepareDrawProgram(C,se,xe.tileID.toUnwrapped()),se.draw(C,z.TRIANGLES,N,q,H,r.CullFaceMode.disabled,ve,c.id,fe,_e,Ae,c.paint,L.zoom,ne,[me])}},heatmap:function(p,n,c,_){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const y=p.context,b=y.gl,S=r.StencilMode.disabled,M=new r.ColorMode([b.ONE,b.ONE],r.Color.transparent,[!0,!0,!0,!0]);(function(H,J,K,Q){const j=H.gl,Z=J.width*Q,ne=J.height*Q;H.activeTexture.set(j.TEXTURE1),H.viewport.set([0,0,Z,ne]);let se=K.heatmapFbo;if(!se||se&&(se.width!==Z||se.height!==ne)){se&&se.destroy();const fe=j.createTexture();j.bindTexture(j.TEXTURE_2D,fe),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),se=K.heatmapFbo=H.createFramebuffer(Z,ne,!1),function(me,_e,ve,xe,Ae,Ze){const Ee=me.gl;Ee.texImage2D(Ee.TEXTURE_2D,0,me.isWebGL2&&me.extRenderToTextureHalfFloat?Ee.RGBA16F:Ee.RGBA,Ae,Ze,0,Ee.RGBA,me.extRenderToTextureHalfFloat?me.isWebGL2?Ee.HALF_FLOAT:me.extTextureHalfFloat.HALF_FLOAT_OES:Ee.UNSIGNED_BYTE,null),xe.colorAttachment.set(ve)}(H,0,fe,se,Z,ne)}else j.bindTexture(j.TEXTURE_2D,se.colorAttachment.get()),H.bindFramebuffer.set(se.framebuffer)})(y,p,c,p.transform.projection.name==="globe"?.5:.25),y.clear({color:r.Color.transparent});const C=p.transform,z=C.projection.name==="globe",L=z?["PROJECTION_GLOBE_VIEW"]:null,N=z?r.CullFaceMode.frontCCW:r.CullFaceMode.disabled,q=[r.mercatorXfromLng(C.center.lng),r.mercatorYfromLat(C.center.lat)];for(let H=0;H<_.length;H++){const J=_[H];if(n.hasRenderableParent(J))continue;const K=n.getTile(J),Q=K.getBucket(c);if(!Q||Q.projection.name!==C.projection.name)continue;const j=Q.programConfigurations.get(c.id),Z=p.useProgram("heatmap",j,L),{zoom:ne}=p.transform;p.terrain&&p.terrain.setupElevationDraw(K,Z),p.prepareDrawProgram(y,Z,J.toUnwrapped());const se=C.projection.createInversionMatrix(C,J.canonical);Z.draw(y,b.TRIANGLES,r.DepthMode.disabled,S,M,N,Eu(p,J,K,se,q,ne,c.paint.get("heatmap-intensity")),c.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,c.paint,p.transform.zoom,j,z?[Q.globeExtVertexBuffer]:null)}y.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(y,b){const S=y.context,M=S.gl,C=b.heatmapFbo;if(!C)return;S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,C.colorAttachment.get()),S.activeTexture.set(M.TEXTURE1);let z=b.colorRampTexture;z||(z=b.colorRampTexture=new r.Texture(S,b.colorRamp,M.RGBA)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(S,M.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,y.colorModeForRenderPass(),r.CullFaceMode.disabled,((L,N,q,H)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(p,c))},line:function(p,n,c,_){if(p.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const S=p.depthModeForSublayer(0,r.DepthMode.ReadOnly),M=p.colorModeForRenderPass(),C=p.terrain&&p.terrain.renderingToTexture?1:r.exported.devicePixelRatio,z=c.paint.get("line-dasharray"),L=z.constantOr(1),N=c.layout.get("line-cap"),q=c.paint.get("line-pattern"),H=q.constantOr(1),J=c.paint.get("line-gradient"),K=H?"linePattern":"line",Q=p.context,j=Q.gl,Z=(se=>{const fe=[];ea(se)&&fe.push("RENDER_LINE_DASH"),se.paint.get("line-gradient")&&fe.push("RENDER_LINE_GRADIENT");const me=se.paint.get("line-trim-offset");me[0]===0&&me[1]===0||fe.push("RENDER_LINE_TRIM_OFFSET");const _e=se.paint.get("line-pattern").constantOr(1),ve=se.paint.get("line-opacity").constantOr(1)!==1;return!_e&&ve&&fe.push("RENDER_LINE_ALPHA_DISCARD"),fe})(c);let ne=Z.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ne=!1);for(const se of _){const fe=n.getTile(se);if(H&&!fe.patternsLoaded())continue;const me=fe.getBucket(c);if(!me)continue;p.prepareDrawTile();const _e=me.programConfigurations.get(c.id),ve=p.useProgram(K,_e,Z),xe=q.constantOr(null);if(xe&&fe.imageAtlas){const Ne=fe.imageAtlas.patternPositions[xe.toString()];Ne&&_e.setConstantPatternPositions(Ne)}const Ae=z.constantOr(null),Ze=N.constantOr(null);if(!H&&Ae&&Ze&&fe.lineAtlas){const Ne=fe.lineAtlas.getDash(Ae,Ze);Ne&&_e.setConstantPatternPositions(Ne)}let[Ee,je]=c.paint.get("line-trim-offset");(Ze==="round"||Ze==="square")&&Ee!==je&&(Ee===0&&(Ee-=1),je===1&&(je+=1));const Ie=p.terrain?se.projMatrix:null,qe=H?Qo(p,fe,c,Ie,C):zp(p,fe,c,Ie,me.lineClipsArray.length,C,[Ee,je]);if(J){const Ne=me.gradients[c.id];let Xe=Ne.texture;if(c.gradientVersion!==Ne.version){let Ge=256;if(c.stepInterpolant){const Ye=n.getSource().maxzoom,mt=se.canonical.z===Ye?Math.ceil(1<<p.transform.maxZoom-se.canonical.z):1;Ge=r.clamp(r.nextPowerOfTwo(me.maxLineLength/r.EXTENT*1024*mt),256,Q.maxTextureSize)}Ne.gradient=r.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ge,image:Ne.gradient||void 0,clips:me.lineClipsArray}),Ne.texture?Ne.texture.update(Ne.gradient):Ne.texture=new r.Texture(Q,Ne.gradient,j.RGBA),Ne.version=c.gradientVersion,Xe=Ne.texture}Q.activeTexture.set(j.TEXTURE1),Xe.bind(c.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}L&&(Q.activeTexture.set(j.TEXTURE0),fe.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),_e.updatePaintBuffers()),H&&(Q.activeTexture.set(j.TEXTURE0),fe.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),_e.updatePaintBuffers()),p.prepareDrawProgram(Q,ve,se.toUnwrapped());const Me=Ne=>{ve.draw(Q,j.TRIANGLES,S,Ne,M,r.CullFaceMode.disabled,qe,c.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,c.paint,p.transform.zoom,_e,[me.layoutVertexBuffer2])};if(ne){const Ne=p.stencilModeForClipping(se).ref;Ne===0&&p.terrain&&Q.clear({stencil:0});const Xe={func:j.EQUAL,mask:255};qe.u_alpha_discard_threshold=.8,Me(new r.StencilMode(Xe,Ne,255,j.KEEP,j.KEEP,j.INVERT)),qe.u_alpha_discard_threshold=0,Me(new r.StencilMode(Xe,Ne,255,j.KEEP,j.KEEP,j.KEEP))}else Me(p.stencilModeForClipping(se))}ne&&(p.resetStencilClippingMasks(),p.terrain&&Q.clear({stencil:0}))},fill:function(p,n,c,_){const y=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const S=p.colorModeForRenderPass(),M=c.paint.get("fill-pattern"),C=p.opaquePassEnabledForLayer()&&!M.constantOr(1)&&y.constantOr(r.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(p.renderPass===C){const z=p.depthModeForSublayer(1,p.renderPass==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly);Cu(p,n,c,_,z,S,!1)}if(p.renderPass==="translucent"&&c.paint.get("fill-antialias")){const z=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,r.DepthMode.ReadOnly);Cu(p,n,c,_,z,S,!0)}},"fill-extrusion":function(p,n,c,_){const y=c.paint.get("fill-extrusion-opacity");if(y!==0&&p.renderPass==="translucent"){const b=new r.DepthMode(p.context.gl.LEQUAL,r.DepthMode.ReadWrite,p.depthRangeFor3D);if(y!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))ol(p,n,c,_,b,r.StencilMode.disabled,r.ColorMode.disabled),ol(p,n,c,_,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const S=p.colorModeForRenderPass();ol(p,n,c,_,b,r.StencilMode.disabled,S)}}},hillshade:function(p,n,c,_){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent")return;const y=p.context,b=p.depthModeForSublayer(0,r.DepthMode.ReadOnly),S=p.colorModeForRenderPass(),M=p.terrain&&p.terrain.renderingToTexture,[C,z]=p.renderPass!=="translucent"||M?[{},_]:p.stencilConfigForOverlap(_);for(const L of z){const N=n.getTile(L);if(N.needsHillshadePrepare&&p.renderPass==="offscreen")xu(p,N,c,b,r.StencilMode.disabled,S);else if(p.renderPass==="translucent"){const q=M&&p.terrain?p.terrain.stencilModeForRTTOverlap(L):C[L.overscaledZ];yu(p,L,N,c,b,q,S)}}y.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,n,c,_,y,b){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!_.length)return;const S=p.context,M=S.gl,C=n.getSource(),z=p.useProgram("raster"),L=p.colorModeForRenderPass(),N=p.terrain&&p.terrain.renderingToTexture,[q,H]=C instanceof Pt||N?[{},_]:p.stencilConfigForOverlap(_),J=H[H.length-1].overscaledZ,K=!p.options.moving;for(const Q of H){const j=N?r.DepthMode.disabled:p.depthModeForSublayer(Q.overscaledZ-J,c.paint.get("raster-opacity")===1?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly,M.LESS),Z=Q.toUnwrapped(),ne=n.getTile(Q);if(N&&(!ne||!ne.hasData()))continue;const se=N?Q.projMatrix:p.transform.calculateProjMatrix(Z,K),fe=p.terrain&&N?p.terrain.stencilModeForRTTOverlap(Q):q[Q.overscaledZ],me=b?0:c.paint.get("raster-fade-duration");ne.registerFadeDuration(me);const _e=n.findLoadedParent(Q,0),ve=bc(ne,_e,n,p.transform,me);let xe,Ae;p.terrain&&p.terrain.prepareDrawTile();const Ze=c.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;S.activeTexture.set(M.TEXTURE0),ne.texture.bind(Ze,M.CLAMP_TO_EDGE),S.activeTexture.set(M.TEXTURE1),_e?(_e.texture.bind(Ze,M.CLAMP_TO_EDGE),xe=Math.pow(2,_e.tileID.overscaledZ-ne.tileID.overscaledZ),Ae=[ne.tileID.canonical.x*xe%1,ne.tileID.canonical.y*xe%1]):ne.texture.bind(Ze,M.CLAMP_TO_EDGE),ne.texture.useMipmap&&S.extTextureFilterAnisotropic&&p.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax);const Ee=Pc(se,Ae||[0,0],xe||1,ve,c,C instanceof Pt?C.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(S,z,Z),C instanceof Pt)C.boundsBuffer&&C.boundsSegments&&z.draw(S,M.TRIANGLES,j,r.StencilMode.disabled,L,r.CullFaceMode.disabled,Ee,c.id,C.boundsBuffer,p.quadTriangleIndexBuffer,C.boundsSegments);else{const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Ie,tileBoundsSegments:qe}=p.getTileBoundsBuffers(ne);z.draw(S,M.TRIANGLES,j,fe,L,r.CullFaceMode.disabled,Ee,c.id,je,Ie,qe)}}p.resetStencilClippingMasks()},background:function(p,n,c,_){const y=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b===0)return;const S=p.context,M=S.gl,C=p.transform,z=C.tileSize,L=c.paint.get("background-pattern");if(p.isPatternMissing(L))return;const N=!L&&y.a===1&&b===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==N)return;const q=r.StencilMode.disabled,H=p.depthModeForSublayer(0,N==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly),J=p.colorModeForRenderPass(),K=p.useProgram(L?"backgroundPattern":"background");let Q,j=_;j||(Q=p.getBackgroundTiles(),j=Object.values(Q).map(Z=>Z.tileID)),L&&(S.activeTexture.set(M.TEXTURE0),p.imageManager.bind(p.context));for(const Z of j){const ne=Z.toUnwrapped(),se=_?Z.projMatrix:p.transform.calculateProjMatrix(ne);p.prepareDrawTile();const fe=n?n.getTile(Z):Q?Q[Z.key]:new r.Tile(Z,z,C.zoom,p),me=L?Rp(se,b,p,L,{tileID:Z,tileSize:z}):Dc(se,b,y);p.prepareDrawProgram(S,K,ne);const{tileBoundsBuffer:_e,tileBoundsIndexBuffer:ve,tileBoundsSegments:xe}=p.getTileBoundsBuffers(fe);K.draw(S,M.TRIANGLES,H,q,J,r.CullFaceMode.disabled,me,c.id,_e,ve,xe)}},sky:function(p,n,c){const _=p.transform,y=_.projection.name==="mercator"||_.projection.name==="globe"?1:r.smoothstep(7,8,_.zoom),b=c.paint.get("sky-opacity")*y;if(b===0)return;const S=p.context,M=c.paint.get("sky-type"),C=new r.DepthMode(S.gl.LEQUAL,r.DepthMode.ReadOnly,[0,1]),z=p.frameCounter/1e3%1;M==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(L,N,q,H){const J=L.context,K=J.gl;let Q=N.skyboxFbo;if(!Q){Q=N.skyboxFbo=J.createFramebuffer(32,32,!1),N.skyboxGeometry=new ll(J),N.skyboxTexture=J.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,N.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let se=0;se<6;++se)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+se,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(Q.framebuffer),J.viewport.set([0,0,32,32]);const j=N.getCenter(L,!0),Z=L.useProgram("skyboxCapture"),ne=new Float64Array(16);r.identity(ne),r.rotateY(ne,ne,.5*-Math.PI),$n(J,N,Z,ne,j,0),r.identity(ne),r.rotateY(ne,ne,.5*Math.PI),$n(J,N,Z,ne,j,1),r.identity(ne),r.rotateX(ne,ne,.5*-Math.PI),$n(J,N,Z,ne,j,2),r.identity(ne),r.rotateX(ne,ne,.5*Math.PI),$n(J,N,Z,ne,j,3),r.identity(ne),$n(J,N,Z,ne,j,4),r.identity(ne),r.rotateY(ne,ne,Math.PI),$n(J,N,Z,ne,j,5),J.viewport.set([0,0,L.width,L.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(L,N,q,H,J){const K=L.context,Q=K.gl,j=L.transform,Z=L.useProgram("skybox");K.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,N.skyboxTexture);const ne=((se,fe,me,_e,ve)=>({u_matrix:se,u_sun_direction:fe,u_cubemap:0,u_opacity:_e,u_temporal_offset:ve}))(j.skyboxMatrix,N.getCenter(L,!1),0,H,J);L.prepareDrawProgram(K,Z),Z.draw(K,Q.TRIANGLES,q,r.StencilMode.disabled,L.colorModeForRenderPass(),r.CullFaceMode.backCW,ne,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,c,C,b,z):M==="gradient"&&p.renderPass==="sky"&&function(L,N,q,H,J){const K=L.context,Q=K.gl,j=L.transform,Z=L.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new ll(K)),K.activeTexture.set(Q.TEXTURE0);let ne=N.colorRampTexture;ne||(ne=N.colorRampTexture=new r.Texture(K,N.colorRamp,Q.RGBA)),ne.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const se=((fe,me,_e,ve,xe)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:me,u_radius:r.degToRad(_e),u_opacity:ve,u_temporal_offset:xe}))(j.skyboxMatrix,N.getCenter(L,!1),N.paint.get("sky-gradient-radius"),H,J);L.prepareDrawProgram(K,Z),Z.draw(K,Q.TRIANGLES,q,r.StencilMode.disabled,L.colorModeForRenderPass(),r.CullFaceMode.backCW,se,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(p,c,C,b,z)},debug:function(p,n,c){for(let _=0;_<c.length;_++)Vp(p,n,c[_])},custom:function(p,n,c,_){const y=p.context,b=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isLayerDraped()){if(p.renderPass==="offscreen"){const S=b.prerender;if(S){if(p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const M=p.transform.pointMerc;S.call(b,y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(p.transform.zoom),[M.x,M.y],p.transform.pixelsPerMeterRatio)}else S.call(b,y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const M=b.renderToTile;if(M){const C=_[0].canonical,z=new r.MercatorCoordinate(C.x+_[0].wrap*(1<<C.z),C.y,C.z);y.setDepthMode(r.DepthMode.disabled),y.setStencilMode(r.StencilMode.disabled),y.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),M.call(b,y.gl,z),y.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),y.setStencilMode(r.StencilMode.disabled);const S=b.renderingMode==="3d"?new r.DepthMode(p.context.gl.LEQUAL,r.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,r.DepthMode.ReadOnly);if(y.setDepthMode(S),p.transform.projection.name==="globe"){const M=p.transform.pointMerc;b.render(y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(p.transform.zoom),[M.x,M.y],p.transform.pixelsPerMeterRatio)}else b.render(y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState(),y.bindFramebuffer.set(null)}}else r.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class no{constructor(n,c,_=!1){this.context=new tt(n,_),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=r.SourceCache.maxUnderzooming+r.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,c){const _=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Tc(this,n));const y=this._terrain;this.transform.elevation=_?y:null,y.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,y]=c.getFovAdjustedRange(this.transform._fov);if(_>y)return void(this.transform.fogCullDistSq=null);const b=_+.78*(y-_);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*r.exported.devicePixelRatio,this.height=c*r.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const n=this.context,c=new r.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(r.EXTENT,0),c.emplaceBack(0,r.EXTENT),c.emplaceBack(r.EXTENT,r.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,r.posAttributes.members),this.tileExtentSegments=r.SegmentVector.simpleSegment(0,0,4,2);const _=new r.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(r.EXTENT,0),_.emplaceBack(0,r.EXTENT),_.emplaceBack(r.EXTENT,r.EXTENT),this.debugBuffer=n.createVertexBuffer(_,r.posAttributes.members),this.debugSegments=r.SegmentVector.simpleSegment(0,0,4,5);const y=new r.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,r.posAttributes.members),this.viewportSegments=r.SegmentVector.simpleSegment(0,0,4,2);const b=new r.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(r.EXTENT,0,r.EXTENT,0),b.emplaceBack(0,r.EXTENT,0,r.EXTENT),b.emplaceBack(r.EXTENT,r.EXTENT,r.EXTENT,r.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(b,r.boundsAttributes.members),this.mercatorBoundsSegments=r.SegmentVector.simpleSegment(0,0,4,2);const S=new r.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(S);const M=new r.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])M.emplaceBack(z);this.debugIndexBuffer=n.createIndexBuffer(M),this.emptyTexture=new r.Texture(n,new r.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.create();const C=this.context.gl;this.stencilClearMode=new r.StencilMode({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(r.window.performance.now()),this.atmosphereBuffer=new Lu(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,c.TRIANGLES,r.DepthMode.disabled,this.stencilClearMode,r.ColorMode.disabled,r.CullFaceMode.disabled,Ko(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,_){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const C of _)if(this._tileClippingMaskIDs[C.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=c.id;const y=this.context,b=y.gl;this.nextStencilID+_.length>256&&this.clearStencil(),y.setColorMode(r.ColorMode.disabled),y.setDepthMode(r.DepthMode.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of _){const C=c.getTile(M),z=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:N,tileBoundsSegments:q}=this.getTileBoundsBuffers(C);S.draw(y,b.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,Ko(M.projMatrix),"$clipping",L,N,q)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new r.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new r.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,_=n.sort((S,M)=>M.overscaledZ-S.overscaledZ),y=_[_.length-1].overscaledZ,b=_[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let M=0;M<b;M++)S[M+y]=new r.StencilMode({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[S,_]}return[{[y]:r.StencilMode.disabled},_]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new r.ColorMode([n.CONSTANT_COLOR,n.ONE],new r.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.ColorMode.unblended:r.ColorMode.alphaBlended}depthModeForSublayer(n,c,_){if(!this.opaquePassEnabledForLayer())return r.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new r.DepthMode(_||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.exported.now()),this.imageManager.beginFrame();const _=this.style.order,y=this.style._sourceCaches;for(const z in y){const L=y[z];L.used&&L.prepare(this.context)}const b={},S={},M={};for(const z in y){const L=y[z];b[z]=L.getVisibleCoordinates(),S[z]=b[z].slice().reverse(),M[z]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<_.length;z++)if(this.style._layers[_[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.GlobeSharedBuffers(this.context)),!r.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of _){const L=this.style._layers[z],N=n._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const q=N?S[N.id]:void 0;(L.type==="custom"||L.isSky()||q&&q.length)&&this.renderLayer(this,N,L,q)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const C=this.terrain;if(C&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&C.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?r.Color.black:r.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[_[this.currentLayer]],L=n._getLayerSourceCache(z);if(z.isSky())continue;const N=L?S[L.id]:void 0;this._renderTileClippingMasks(z,L,N),this.renderLayer(this,L,z,N)}if(this.style.fog&&this.transform.projection.supportsFog&&function(z,L){const N=z.context,q=N.gl,H=z.transform,J=new r.DepthMode(q.LEQUAL,r.DepthMode.ReadOnly,[0,1]),K=z.useProgram("globeAtmosphere",null,H.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=r.globeToMercatorTransition(H.zoom),j=L.properties.get("color").toArray01(),Z=L.properties.get("high-color").toArray01(),ne=L.properties.get("space-color").toArray01PremultipliedAlpha(),se=r.identity$1([]);r.rotateY$1(se,se,-r.degToRad(H._center.lng)),r.rotateX$1(se,se,r.degToRad(H._center.lat)),r.rotateZ$1(se,se,H.angle),r.rotateX$1(se,se,-H._pitch);const fe=r.fromQuat(new Float32Array(16),se),me=r.mapValue(L.properties.get("star-intensity"),0,1,0,.25),_e=5e-4,ve=r.mapValue(L.properties.get("horizon-blend"),0,1,_e,.25),xe=r.globeUseCustomAntiAliasing(z,N,H)&&ve===_e?H.worldSize/(2*Math.PI*1.025)-1:H.globeRadius,Ae=z.frameCounter/1e3%1,Ze=r.length(H.globeCenterInViewSpace),Ee=Math.sqrt(Math.pow(Ze,2)-Math.pow(xe,2)),je=Math.acos(Ee/Ze),Ie=((Me,Ne,Xe,Ge,Ye,mt,wt,dt,xt,Bt,Dt,_t,Jt,ii)=>({u_frustum_tl:Me,u_frustum_tr:Ne,u_frustum_br:Xe,u_frustum_bl:Ge,u_horizon:Ye,u_transition:mt,u_fadeout_range:wt,u_color:dt,u_high_color:xt,u_space_color:Bt,u_star_intensity:Dt,u_star_size:5*r.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:_t,u_horizon_angle:Jt,u_rotation_matrix:ii}))(H.frustumCorners.TL,H.frustumCorners.TR,H.frustumCorners.BR,H.frustumCorners.BL,H.frustumCorners.horizon,Q,ve,j,Z,ne,me,Ae,je,fe);z.prepareDrawProgram(N,K);const qe=z.atmosphereBuffer;qe&&K.draw(N,q.TRIANGLES,J,r.StencilMode.disabled,r.ColorMode.alphaBlended,r.CullFaceMode.backCW,Ie,"skybox",qe.vertexBuffer,qe.indexBuffer,qe.segments)}(this,this.style.fog),this.renderPass="sky",(r.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const z=this.style._layers[_[this.currentLayer]],L=n._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,L,z,L?S[L.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const z=this.style._layers[_[this.currentLayer]],L=n._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=L?(z.type==="symbol"?M:S)[L.id]:void 0;this._renderTileClippingMasks(z,L,L?b[L.id]:void 0),this.renderLayer(this,L,z,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let z=null;r.values(this.style._layers).forEach(L=>{const N=n._getLayerSourceCache(L);N&&!L.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<N.getSource().maxzoom)&&(z=N)}),z&&this.options.showTileBoundaries&&br.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const L=z.transform.padding;Pu(z,z.transform.height-(L.top||0),3,to),Pu(z,L.bottom||0,3,Bp),al(z,L.left||0,3,Fp),al(z,z.transform.width-(L.right||0),3,Np);const N=z.transform.centerPoint;(function(q,H,J,K){io(q,H-1,J-10,2,20,K),io(q,H-10,J-1,20,2,K)})(z,N.x,z.transform.height-N.y,jp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(r.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,c,_,y){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||y&&y.length)&&(this.id=_.id,this.gpuTimingStart(_),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(_.type)||n.terrain&&_.type==="custom")&&br[_.type](n,c,_,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),_.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),n.beginQueryEXT(n.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const _ in n){const y=n[_],b=this.context.extTimerQuery,S=b.getQueryObjectEXT(y.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(y.query),c[_]=S}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let _=0;for(const y of n)_+=c.getQueryObjectEXT(y,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(y);return _}translatePosMatrix(n,c,_,y,b){if(!_[0]&&!_[1])return n;const S=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(S){const z=Math.sin(S),L=Math.cos(S);_=[_[0]*L-_[1]*z,_[0]*z+_[1]*L]}const M=[b?_[0]:ki(c,_[0],this.transform.zoom),b?_[1]:ki(c,_[1],this.transform.zoom),0],C=new Float32Array(16);return r.translate(C,n,M),C}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&this.terrain.exaggeration()===0,_=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),this.transform.projection.name==="globe"&&y.push("GLOBE"),c&&y.push("ZERO_EXAGGERATION"),_&&!n&&_.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),n&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(n,c,_){this.cache=this.cache||{};const y=_||[],b=this.currentGlobalDefines().concat(y),S=Ut.cacheKey(gc[n],n,b,c);return this.cache[S]||(this.cache[S]=new Ut(this.context,n,gc[n],c,Lc[n],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=r.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,c,_){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const b=y.getOpacity(this.transform.pitch),S=((M,C,z,L,N,q,H,J,K,Q,j)=>{const Z=M.transform,ne=C.properties.get("color").toArray01();ne[3]=L;const se=M.frameCounter/1e3%1;return{u_fog_matrix:z?Z.calculateFogTileMatrix(z):M.identityMat,u_fog_range:C.getFovAdjustedRange(Z._fov),u_fog_color:ne,u_fog_horizon_blend:C.properties.get("horizon-blend"),u_fog_temporal_offset:se,u_frustum_tl:N,u_frustum_tr:q,u_frustum_br:H,u_frustum_bl:J,u_globe_pos:K,u_globe_radius:Q,u_viewport:j,u_globe_transition:r.globeToMercatorTransition(Z.zoom),u_is_globe:+(Z.projection.name==="globe")}})(this,y,_,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.exported.devicePixelRatio,this.transform.height*r.exported.devicePixelRatio]);c.setFogUniformValues(n,S)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const y of _)c[y.key]=n[y.key]||new r.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class cl{constructor(n=0,c=0,_=0,y=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=_,this.right=y}interpolate(n,c,_){return c.top!=null&&n.top!=null&&(this.top=r.number(n.top,c.top,_)),c.bottom!=null&&n.bottom!=null&&(this.bottom=r.number(n.bottom,c.bottom,_)),c.left!=null&&n.left!=null&&(this.left=r.number(n.left,c.left,_)),c.right!=null&&n.right!=null&&(this.right=r.number(n.right,c.right,_)),this}getCenter(n,c){const _=r.clamp((this.left+n-this.right)/2,0,n),y=r.clamp((this.top+c-this.bottom)/2,0,c);return new r.Point(_,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new cl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function hl(p,n){const c=r.getColumn(p,3);r.fromQuat(p,n),r.setColumn(p,3,c)}function $t(p,n){const c=r.identity$1([]);return r.rotateZ$1(c,c,-n),r.rotateX$1(c,c,-p),c}function sa(p,n){const c=[p[0],p[1],0],_=[n[0],n[1],0];if(r.length(c)>=1e-15){const S=r.normalize([],c);r.scale$2(_,S,r.dot(_,S)),n[0]=_[0],n[1]=_[1]}const y=r.cross([],n,p);if(r.len(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return $t(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class zu{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof r.MercatorCoordinate?n:new r.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=r.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const _=this.position,y=this._elevation?this._elevation.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(n)):0,b=r.MercatorCoordinate.fromLngLat(n,y),S=[b.x-_.x,b.y-_.y,b.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=sa(S,c)}setPitchBearing(n,c){this.orientation=$t(r.degToRad(n),r.degToRad(-c))}}class ul{constructor(n,c){this._transform=r.identity([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new r.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=r.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&r.setColumn(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.identity$1([]),n&&hl(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=$t(n,c),hl(this._transform,this._orientation)}forward(){const n=r.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=r.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=r.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const _=new Float64Array(16);return r.invert(_,this.getWorldToCamera(n,c)),_}getWorldToCameraPosition(n,c,_){const y=this.position;r.scale$2(y,y,-n);const b=new Float64Array(16);return r.fromScaling(b,[_,_,_]),r.translate(b,b,y),b[10]*=c,b}getWorldToCamera(n,c){const _=new Float64Array(16),y=new Float64Array(4),b=this.position;return r.conjugate(y,this._orientation),r.scale$2(b,b,-n),r.fromQuat(_,y),r.translate(_,_,b),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=c,_[9]*=c,_[10]*=c,_[11]*=c,_}getCameraToClipPerspective(n,c,_,y){const b=new Float64Array(16);return r.perspective(b,n,c,_,y),b}getDistanceToElevation(n,c=!1){const _=n===0?0:r.mercatorZfromAltitude(n,c?r.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(_-this.position[2])/y[2]}clone(){return new ul([...this.position],[...this.orientation])}}function so(p,n){const c=dl(p.projection,p.zoom,p.width,p.height),_=function(b,S,M,C,z){const L=new r.LngLat(M.lng-180*ks,M.lat),N=new r.LngLat(M.lng+180*ks,M.lat),q=b.project(L.lng,L.lat),H=b.project(N.lng,N.lat),J=-Math.atan2(H.y-q.y,H.x-q.x),K=r.MercatorCoordinate.fromLngLat(M);K.y=r.clamp(K.y,-1+ks,1-ks);const Q=K.toLngLat(),j=b.project(Q.lng,Q.lat),Z=r.MercatorCoordinate.fromLngLat(Q);Z.x+=ks;const ne=Z.toLngLat(),se=b.project(ne.lng,ne.lat),fe=pl(se.x-j.x,se.y-j.y,J),me=r.MercatorCoordinate.fromLngLat(Q);me.y+=ks;const _e=me.toLngLat(),ve=b.project(_e.lng,_e.lat),xe=pl(ve.x-j.x,ve.y-j.y,J),Ae=Math.abs(fe.x)/Math.abs(xe.y),Ze=r.identity([]);r.rotateZ(Ze,Ze,-J*(1-(z?0:C)));const Ee=r.identity([]);return r.scale(Ee,Ee,[1,1-(1-Ae)*C,1]),Ee[4]=-xe.x/xe.y*C,r.rotateZ(Ee,Ee,J),r.multiply(Ee,Ze,Ee),Ee}(p.projection,0,p.center,c,n),y=Ru(p);return r.scale(_,_,[y,y,1]),_}function Ru(p){const n=p.projection,c=dl(p.projection,p.zoom,p.width,p.height),_=Ou(n,p.center),y=Ou(n,r.LngLat.convert(n.center));return Math.pow(2,_*c+(1-c)*y)}function dl(p,n,c,_,y=1/0){const b=p.range;if(!b)return 0;const S=Math.min(y,Math.max(c,_)),M=Math.log(S/1024)/Math.LN2;return r.smoothstep(b[0]+M,b[1]+M,n)}const ks=1/4e4;function Ou(p,n){const c=r.clamp(n.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),_=new r.LngLat(n.lng-180*ks,c),y=new r.LngLat(n.lng+180*ks,c),b=p.project(_.lng,c),S=p.project(y.lng,c),M=r.MercatorCoordinate.fromLngLat(_),C=r.MercatorCoordinate.fromLngLat(y),z=S.x-b.x,L=S.y-b.y,N=C.x-M.x,q=C.y-M.y,H=Math.sqrt((N*N+q*q)/(z*z+L*L));return Math.log(H)/Math.LN2}function pl(p,n,c){const _=Math.cos(c),y=Math.sin(c);return{x:p*_-n*y,y:p*y+n*_}}class ro{constructor(n,c,_,y,b,S,M){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=_??0,this._maxPitch=y??60,this.setProjection(S),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new r.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new cl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ul,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new ro(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,c=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(n||_)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=r.getProjection(this.projectionOptions);const _=!T(c,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.getProjection({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.Point(this.width,this.height)}get bearing(){return r.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;var _;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(_=new r.ARRAY_TYPE(4),r.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(y,b,S){var M=b[0],C=b[1],z=b[2],L=b[3],N=Math.sin(S),q=Math.cos(S);y[0]=M*q+z*N,y[1]=C*q+L*N,y[2]=M*-N+z*q,y[3]=C*-N+L*q}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=r.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let y=0,b=0;for(let S=0;S<c.length;S++){const M=new r.Point(c[S][0]*this.width,_+c[S][1]*(this.height-_)),C=n.pointCoordinate(M);if(!C)continue;const z=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);y+=C[3]*z,b+=z}return b===0?NaN:y/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(y-_,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let _;_=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const y=r.length(r.sub([],this._camera.position,_));return r.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!r.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const _=[n.position.x,n.position.y,n.position.z];r.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new zu;return c.position=new r.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!r.length$1(n))return!1;r.normalize$1(n,n);const c=r.transformQuat([],[0,0,-1],n),_=r.transformQuat([],[0,-1,0],n);if(_[2]<0)return!1;const y=sa(c,_);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=r.clamp(n[2],y/_,y/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,_){this._unmodified=!1,this._edgeInsets.interpolate(n,c,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new r.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const _=this.pointCoordinate(new r.Point(0,0)),y=this.pointCoordinate(new r.Point(this.width,0)),b=this.pointCoordinate(new r.Point(this.width,this.height)),S=this.pointCoordinate(new r.Point(0,this.height)),M=Math.floor(Math.min(_.x,y.x,b.x,S.x)),C=Math.floor(Math.max(_.x,y.x,b.x,S.x)),z=1;for(let L=M-z;L<=C+z;L++)L!==0&&c.push(new r.UnwrappedTileID(L,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const _=c,y=this.elevation&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const S=this.locationCoordinate(this.center),M=this.center.lat,C=1<<c,z=[C*S.x,C*S.y,0],L=this.projection.name==="globe",N=!L,q=r.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,N),H=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=C*r.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/r.mercatorZfromAltitude(1,this.center.lat),Q=[C*H.x,C*H.y,K*(N?1:J)],j=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),Z=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ne=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,se=n.isTerrainDEM?-ne:this._elevation?this._elevation.getMinElevationBelowMSL():0,fe=this.projection.isReprojectedInTileSpace?Ru(this):1,me=Me=>{const Xe=new r.MercatorCoordinate(Me.x+25e-6,Me.y,Me.z),Ge=new r.MercatorCoordinate(Me.x,Me.y+25e-6,Me.z),Ye=Me.toLngLat(),mt=Xe.toLngLat(),wt=Ge.toLngLat(),dt=this.locationCoordinate(Ye),xt=this.locationCoordinate(mt),Bt=this.locationCoordinate(wt),Dt=Math.hypot(xt.x-dt.x,xt.y-dt.y),_t=Math.hypot(Bt.x-dt.x,Bt.y-dt.y);return Math.sqrt(Dt*_t)*fe/25e-6},_e=Me=>{const Ne=ne,Xe=se;return{aabb:r.tileAABB(this,C,0,0,0,Me,Xe,Ne,this.projection),zoom:0,x:0,y:0,minZ:Xe,maxZ:Ne,wrap:Me,fullyVisible:!1}},ve=[];let xe=[];const Ae=c,Ze=n.reparseOverscaled?_:c,Ee=Me=>Me*Me,je=Ee((K-this._centerAltitude)*J),Ie=Me=>{if(!this._elevation||!Me.tileID||!b)return;const Ne=this._elevation.getMinMaxForTile(Me.tileID),Xe=Me.aabb;Ne?(Xe.min[2]=Ne.min,Xe.max[2]=Ne.max,Xe.center[2]=(Xe.min[2]+Xe.max[2])/2):(Me.shouldSplit=qe(Me),Me.shouldSplit||(Xe.min[2]=Xe.max[2]=Xe.center[2]=this._centerAltitude))},qe=Me=>{if(Me.zoom<Z)return!0;if(Me.zoom===Ae)return!1;if(Me.shouldSplit!=null)return Me.shouldSplit;const Ne=Me.aabb.distanceX(Q),Xe=Me.aabb.distanceY(Q);let Ge=je,Ye=1;if(L){Ge=Ee(Me.aabb.distanceZ(Q));const dt=Math.pow(2,Me.zoom),xt=r.latFromMercatorY((Me.y+1)/dt),Bt=r.latFromMercatorY(Me.y/dt),Dt=Math.min(Math.max(M,xt),Bt),_t=r.circumferenceAtLatitude(Dt)/r.circumferenceAtLatitude(M);if(Ye=Dt===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_t/this._mercatorScaleRatio),this.zoom<=r.GLOBE_ZOOM_THRESHOLD_MIN&&Me.zoom===Ae-1&&_t>=.9)return!0}else if(y&&(Ge=Ee(Me.aabb.distanceZ(Q)*J)),this.projection.isReprojectedInTileSpace&&_<=5){const dt=Math.pow(2,Me.zoom),xt=me(new r.MercatorCoordinate((Me.x+.5)/dt,(Me.y+.5)/dt));Ye=xt>.85?1:xt}const mt=Ne*Ne+Xe*Xe+Ge,wt=Ee((1<<Ae-Me.zoom)*j*Ye*((dt,xt)=>{if(xt*Ee(.707)<dt)return 1;const Bt=Math.sqrt(xt/dt);return Bt/(1.4144271570014144+(Math.pow(1.1,Bt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ge,je),mt));return mt<wt};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)ve.push(_e(-Me)),ve.push(_e(Me));for(ve.push(_e(0));ve.length>0;){const Me=ve.pop(),Ne=Me.x,Xe=Me.y;let Ge=Me.fullyVisible;if(!Ge){const Ye=Me.aabb.intersects(q);if(Ye===0)continue;Ge=Ye===2}if(Me.zoom!==Ae&&qe(Me))for(let Ye=0;Ye<4;Ye++){const mt=(Ne<<1)+Ye%2,wt=(Xe<<1)+(Ye>>1),dt={aabb:b?Me.aabb.quadrant(Ye):r.tileAABB(this,C,Me.zoom+1,mt,wt,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:mt,y:wt,wrap:Me.wrap,fullyVisible:Ge,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};y&&!L&&(dt.tileID=new r.OverscaledTileID(Me.zoom+1===Ae?Ze:Me.zoom+1,Me.wrap,Me.zoom+1,mt,wt),Ie(dt)),ve.push(dt)}else{const Ye=Me.zoom===Ae?Ze:Me.zoom;if(n.minzoom&&n.minzoom>Ye)continue;const mt=z[0]-(.5+Ne+(Me.wrap<<Me.zoom))*(1<<c-Me.zoom),wt=z[1]-.5-Xe,dt=Me.tileID?Me.tileID:new r.OverscaledTileID(Ye,Me.wrap,Me.zoom,Ne,Xe);xe.push({tileID:dt,distanceSq:mt*mt+wt*wt})}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,Ne=this.horizonLineFromTop();xe=xe.filter(Xe=>{const Ge=[0,0,0,1],Ye=[r.EXTENT,r.EXTENT,0,1],mt=this.calculateFogTileMatrix(Xe.tileID.toUnwrapped());r.transformMat4$1(Ge,Ge,mt),r.transformMat4$1(Ye,Ye,mt);const wt=r.getAABBPointSquareDist(Ge,Ye);if(wt===0)return!0;let dt=!1;const xt=this._elevation;if(xt&&wt>Me&&Ne!==0){const Bt=this.calculateProjMatrix(Xe.tileID.toUnwrapped());let Dt;n.isTerrainDEM||(Dt=xt.getMinMaxForTile(Xe.tileID)),Dt||(Dt={min:se,max:ne});const _t=r.furthestTileCorner(this.rotation),Jt=[_t[0]*r.EXTENT,_t[1]*r.EXTENT,Dt.max];r.transformMat4(Jt,Jt,Bt),dt=(1-Jt[1])*this.height*.5<Ne}return wt<Me||dt})}return xe.sort((Me,Ne)=>Me.distanceSq-Ne.distanceSq).map(Me=>Me.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=r.clamp(n.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),_=this.projection.project(n.lng,c);return new r.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let _,y;const b=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;_=(c.x-b.x)/M,y=(c.y-b.y)/M}else{const M=this.pointCoordinate(c),C=this.pointCoordinate(b);_=M.x-C.x,y=M.y-C.y}const S=this.locationCoordinate(n);this.setLocation(new r.MercatorCoordinate(S.x-_,S.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,c){const _=c?r.mercatorZfromAltitude(c,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new r.MercatorCoordinate(y.x,y.y,_)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const _=c??this._centerAltitude,y=[n.x,n.y,0,1],b=[n.x,n.y,1,1];r.transformMat4$1(y,y,this.pixelMatrixInverse),r.transformMat4$1(b,b,this.pixelMatrixInverse);const S=b[3];r.scale$1(y,y,1/y[3]),r.scale$1(b,b,1/S);const M=y[2],C=b[2];return{p0:y,p1:b,t:M===C?0:(_-M)/(C-M)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],_=[n.x,n.y,1,1];return r.transformMat4$1(c,c,this.pixelMatrixInverse),r.transformMat4$1(_,_,this.pixelMatrixInverse),r.scale$1(c,c,1/c[3]),r.scale$1(_,_,1/_[3]),c[2]=r.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,_[2]=r.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,r.scale$1(c,c,1/this.worldSize),r.scale$1(_,_,1/this.worldSize),new r.Ray([c[0],c[1],c[2]],r.normalize([],r.sub([],_,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:_,t:y}=n,b=r.mercatorZfromAltitude(c[2],this._center.lat),S=r.mercatorZfromAltitude(_[2],this._center.lat);return new r.MercatorCoordinate(r.number(c[0],_[0],y)/this.worldSize,r.number(c[1],_[1],y)/this.worldSize,r.number(b,S,y))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let c=this.projection.pointCoordinate3D(this,n.x,n.y);if(c)return new r.MercatorCoordinate(c[0],c[1],c[2]);let _=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n);const b=.02*y,S=n.clone();for(let M=0;M<10&&y-_>b;M++){S.y=r.number(_,y,.66);const C=this.projection.pointCoordinate3D(this,S.x,S.y);C?(y=S.y,c=C):_=S.y}return c?new r.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const c=this.pointCoordinate(n);return c.y>=0&&c.y<=1}_coordinatePoint(n,c){const _=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,_+n.toAltitude(),1];return r.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new r.Point(y[0]/y[3],y[1]/y[3]):new r.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.Point(c,n)),S=this.pointLocation3D(new r.Point(y,n)),M=this.pointLocation3D(new r.Point(y,_)),C=this.pointLocation3D(new r.Point(c,_));let z=Math.min(b.lng,S.lng,M.lng,C.lng),L=Math.max(b.lng,S.lng,M.lng,C.lng),N=Math.min(b.lat,S.lat,M.lat,C.lat),q=Math.max(b.lat,S.lat,M.lat,C.lat);const H=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,K=(Q,j,Z,ne,se)=>{const fe=(Q+Z)/2,me=(j+ne)/2,_e=new r.Point(fe,me),{lng:ve,lat:xe}=this.pointLocation3D(_e),Ae=Math.max(0,z-ve,N-xe,ve-L,xe-q);z=Math.min(z,ve),L=Math.max(L,ve),N=Math.min(N,xe),q=Math.max(q,xe),(se<J||Ae>H)&&(K(Q,j,fe,me,se+1),K(fe,me,Z,ne,se+1))};if(K(c,n,y,n,1),K(y,n,y,_,1),K(y,_,c,_,1),K(c,_,c,n,1),this.projection.name==="globe"){const[Q,j]=r.polesInViewport(this);Q?(q=90,L=180,z=-180):j&&(N=-90,L=180,z=-180)}return new r.LngLatBounds(new r.LngLat(z,N),new r.LngLat(L,q))}_getBoundsRectangular(n,c){const{top:_,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,M=new r.Point(y,_),C=new r.Point(S,_),z=new r.Point(S,b),L=new r.Point(y,b);let N=this.pointCoordinate(M,n),q=this.pointCoordinate(C,n);const H=this.pointCoordinate(z,c),J=this.pointCoordinate(L,c),K=(Q,j)=>(j.y-Q.y)/(j.x-Q.x);return N.y>1&&q.y>=0?N=new r.MercatorCoordinate((1-J.y)/K(J,N)+J.x,1):N.y<0&&q.y<=1&&(N=new r.MercatorCoordinate(-J.y/K(J,N)+J.x,0)),q.y>1&&N.y>=0?q=new r.MercatorCoordinate((1-H.y)/K(H,q)+H.x,1):q.y<0&&N.y<=1&&(q=new r.MercatorCoordinate(-H.y/K(H,q)+H.x,0)),new r.LngLatBounds().extend(this.coordinateLocation(N)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(H))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce((_,y)=>{if(y.dem){const b=y.dem.tree;_.min=Math.min(_.min,b.minimums[0]),_.max=Math.max(_.max,b.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.MAX_MERCATOR_LATITUDE,this.maxLat=r.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=r.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=r.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=r.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,_=this._distanceTileDataCache;if(_[c])return _[c];const y=n.canonical,b=1/this.height,S=this.cameraWorldSize,M=S/this.zoomScale(y.z),C=(y.x+Math.pow(2,y.z)*n.wrap)*M,z=y.y*M,L=this.point;L.x*=S/this.worldSize,L.y*=S/this.worldSize;const N=this.angle,q=Math.sin(-N),H=-Math.cos(-N);return _[c]={bearing:[q,H],center:[(L.x-C)*b,(L.y-z)*b],scale:M/r.EXTENT*b},_[c]}calculateFogTileMatrix(n){const c=n.key,_=this._fogTileMatrixCache;if(_[c])return _[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.multiply(y,this.worldToFogMatrix,y),_[c]=new Float32Array(y),_[c]}calculateProjMatrix(n,c=!1){const _=n.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[_])return y[_];const b=this.calculatePosMatrix(n,this.worldSize);return r.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,b),y[_]=new Float32Array(b),y[_]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,_=this._pixelsToTileUnitsCache;if(_[c])return _[c];const y=function(b,S){const{scale:M}=b.tileTransform,C=M*r.EXTENT/(b.tileSize*Math.pow(2,S.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return z=new Float32Array(4),q=(L=S.inverseAdjustmentMatrix)[1],H=L[2],J=L[3],Q=(N=[C,C])[1],z[0]=L[0]*(K=N[0]),z[1]=q*K,z[2]=H*Q,z[3]=J*Q,z;var z,L,N,q,H,J,K,Q}(n,this);return _[c]=y,_[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,c=r.fromScaling([],[n,n,n]);return r.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(c),y=this._camera.forward(),b=r.mercatorZfromAltitude(1,this._center.lat);_[2]/=b,y[2]/=b,r.normalize(y,y);const S=n.raycast(_,y,n.exaggeration());if(S){const M=r.scaleAndAdd([],_,y,S),C=new r.MercatorCoordinate(M[0],M[1],r.mercatorZfromAltitude(M[2],r.latFromMercatorY(M[1]))),z=(C.z+r.length([C.x-_[0],C.y-_[1],C.z-_[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,_=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(_),b=c.getAtPointOrZero(new r.MercatorCoordinate(...y)),S=this.pixelsPerMeter/this.worldSize*b,M=this._minimumHeightOverTerrain(),C=y[2]-S;if(C<=M)if(C<0||n){const z=this.locationCoordinate(this._center,this._centerAltitude),L=[y[0],y[1],z.z-y[2]],N=r.length(L);L[2]-=(M-C)/this._pixelsPerMercatorPixel;const q=r.length(L);if(q===0)return;r.scale$2(L,L,N/q*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],z.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const q=this.center;return q.lat=r.clamp(q.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&(q.lng=r.clamp(q.lng,this.minLng,this.maxLng)),this.center=q,void(this._constraining=!1)}const c=this._unmodified,{x:_,y}=this.point;let b=0,S=_,M=y;const C=this.width/2,z=this.height/2,L=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(y-z<L&&(M=L+z),y+z>N&&(M=N-z),N-L<this.height&&(b=Math.max(b,this.height/(N-L)),M=(N+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const q=this.worldMinX*this.scale,H=this.worldMaxX*this.scale,J=this.worldSize/2-(q+H)/2;S=(_+J+this.worldSize)%this.worldSize-J,S-C<q&&(S=q+C),S+C>H&&(S=H-C),H-q<this.width&&(b=Math.max(b,this.width/(H-q)),S=(H+q)/2)}S===_&&M===y||(this.center=this.unproject(new r.Point(S,M))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.mercatorZfromAltitude(1,this.center.lat)/r.mercatorZfromAltitude(1,r.GLOBE_SCALE_MATCH_LATITUDE));const _=dl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?c:1,b=this._camera.getWorldToCamera(this.worldSize,y),S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);S[8]=2*-n.x/this.width,S[9]=2*n.y/this.height;let M=r.mul([],S,b);if(this.projection.isReprojectedInTileSpace){const me=this.locationCoordinate(this.center),_e=r.identity([]);r.translate(_e,_e,[me.x*this.worldSize,me.y*this.worldSize,0]),r.multiply(_e,_e,so(this)),r.translate(_e,_e,[-me.x*this.worldSize,-me.y*this.worldSize,0]),r.multiply(M,M,_e),this.inverseAdjustmentMatrix=function(ve){const xe=so(ve,!0);return Le([],[xe[0],xe[1],xe[4],xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=r.scale([],M,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=M,this.invProjMatrix=r.invert(new Float64Array(16),this.projMatrix);const C=r.invert([],S);this.frustumCorners=r.FrustumCorners.fromInvProjectionMatrix(C,this.horizonLineFromTop(),this.height);const z=new Float32Array(16);r.identity(z),r.scale(z,z,[1,-1,1]),r.rotateX(z,z,this._pitch),r.rotateZ(z,z,this.angle);const L=r.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),N=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-n.x/this.width,L[9]=2*(n.y+N)/this.height,this.skyboxMatrix=r.multiply(z,L,z);const q=this.point,H=q.x,J=q.y,K=this.width%2/2,Q=this.height%2/2,j=Math.cos(this.angle),Z=Math.sin(this.angle),ne=H-Math.round(H)+j*K+Z*Q,se=J-Math.round(J)+j*Q+Z*K,fe=new Float64Array(M);if(r.translate(fe,fe,[ne>.5?ne-1:ne,se>.5?se-1:se,0]),this.alignedProjMatrix=fe,M=r.create(),r.scale(M,M,[this.width/2,-this.height/2,1]),r.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=r.create(),r.scale(M,M,[1,-1,1]),r.translate(M,M,[-1,-1,0]),r.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=r.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=r.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.calculateGlobeMatrix(this);const me=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.transformMat4(me,me,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,_=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,c];r.scale$2(b,b,y),r.scale$2(_,_,-1),r.multiply$2(_,_,b);const S=r.create();r.translate(S,S,_),r.scale(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,y)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-_[0]*b,y.y/this.worldSize-_[1]*b,n/this.worldSize*this._centerAltitude-_[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],y=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((c-_)/y,1)),this._camera.position=r.scaleAndAdd([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:_,bearing:y}=this._camera.getPitchBearing(),b=r.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.degToRad(this._maxPitch)),M=Math.max((n[2]-b)/Math.cos(_),S),C=this._zoomFromMercatorZ(M);r.scaleAndAdd(n,n,c,M),this._pitch=r.clamp(_,r.degToRad(this.minPitch),r.degToRad(this.maxPitch)),this.angle=r.wrap(y,-Math.PI,Math.PI),this._setZoom(r.clamp(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,_=r.GLOBE_ZOOM_THRESHOLD_MAX,y=0,b=1/0;for(;_-c>1e-6&&_>c;){const S=c+.5*(_-c),M=this.tileSize*Math.pow(2,S),C=this.getCameraToCenterDistance(this.projection,S,M),z=this.scaleZoom(C/(n*this.tileSize)),L=Math.abs(S-z);L<b&&(b=L,y=S),S<z?c=S:_=S}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const _=Math.min(n.x,c.x),y=Math.max(n.x,c.x),b=Math.min(n.y,c.y),S=Math.max(n.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new r.Point(_,b),new r.Point(y,S),new r.Point(_,S),new r.Point(y,b)],C=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const L of M){const N=this.pointRayIntersection(L);if(N.t<0)return!0;const q=this.rayIntersectionCoordinate(N);if(q.x<C||q.y<0||q.x>z||q.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.Point(0,0),new r.Point(this.width,this.height))}zoomDeltaToMovement(n,c){const _=r.length(r.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(_)+c;return _-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([c,_,y],b){const S=[c,_,y,1];r.transformMat4$1(S,S,b);const M=S[3]=Math.max(S[3],1e-6);return S[0]/=M,S[1]/=M,S[2]/=M,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.Point(0,n))}}getCameraToCenterDistance(n,c=this.zoom,_=this.worldSize){const y=dl(n,c,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,_,y);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.multiply(n,n,this.globeMatrix),n}}function oo(p,n){let c=!1,_=null;const y=()=>{_=null,c&&(p(),_=setTimeout(y,n),c=!1)};return()=>(c=!0,_||y(),_)}class Oc{constructor(n){this._hashName=n&&encodeURIComponent(n),r.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=oo(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,r.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),r.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=ra(n);if(this._hashName){const _=this._hashName;let y=!1;const b=r.window.location.hash.slice(1).split("&").map(S=>{const M=S.split("=")[0];return M===_?(y=!0,`${M}=${c}`):S}).filter(S=>S);return y||b.push(`${_}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){const n=r.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(c=_)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(_=>isNaN(_))){const _=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:_,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=r.window.location.href.replace(/(#.+)?$/,this.getHashString());r.window.history.replaceState(r.window.history.state,null,n)}}function ra(p,n){const c=p.getCenter(),_=Math.round(100*p.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),S=Math.round(c.lng*b)/b,M=Math.round(c.lat*b)/b,C=p.getBearing(),z=p.getPitch();let L=n?`/${S}/${M}/${_}`:`${_}/${M}/${S}`;return(C||z)&&(L+="/"+Math.round(10*C)/10),z&&(L+=`/${Math.round(z)}`),L}const oa={linearity:.3,easing:r.bezier(0,0,.3,1)},fl=r.extend({deceleration:2500,maxSpeed:1400},oa),_l=r.extend({deceleration:20,maxSpeed:1400},oa),ct=r.extend({deceleration:1e3,maxSpeed:360},oa),ts=r.extend({deceleration:1e3,maxSpeed:90},oa);class Bu{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=r.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new r.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const b=la(c.pan.mag(),_,r.extend({},fl,n||{}));y.offset=c.pan.mult(b.amount/c.pan.mag()),y.center=this._map.transform.center,aa(y,b)}if(c.zoom){const b=la(c.zoom,_,_l);y.zoom=this._map.transform.zoom+b.amount,aa(y,b)}if(c.bearing){const b=la(c.bearing,_,ct);y.bearing=this._map.transform.bearing+r.clamp(b.amount,-179,179),aa(y,b)}if(c.pitch){const b=la(c.pitch,_,ts);y.pitch=this._map.transform.pitch+b.amount,aa(y,b)}if(y.zoom||y.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function aa(p,n){(!p.duration||p.duration<n.duration)&&(p.duration=n.duration,p.easing=n.easing)}function la(p,n,c){const{maxSpeed:_,linearity:y,deceleration:b}=c,S=r.clamp(p*y/(n/1e3),-_,_),M=Math.abs(S)/(b*y);return{easing:c.easing,duration:1e3*M,amount:S*(M/2)}}class tn extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_,y={}){const b=Re(c.getCanvasContainer(),_),S=c.unproject(b);super(n,r.extend({point:b,lngLat:S,originalEvent:_},y)),this._defaultPrevented=!1,this.target=c}}class ca extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_){const y=n==="touchend"?_.changedTouches:_.touches,b=Je(c.getCanvasContainer(),y),S=b.map(C=>c.unproject(C)),M=b.reduce((C,z,L,N)=>C.add(z.div(N.length)),new r.Point(0,0));super(n,{points:b,point:M,lngLats:S,lngLat:c.unproject(M),originalEvent:_}),this._defaultPrevented=!1}}class ml extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_){super(n,{originalEvent:_}),this._defaultPrevented=!1}}class Bc{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new ml(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new tn(n.type,this._map,n))}mouseup(n){this._map.fire(new tn(n.type,this._map,n))}preclick(n){const c=r.extend({},n);c.type="preclick",this._map.fire(new tn(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new tn(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new tn(n.type,this._map,n))}mouseover(n){this._map.fire(new tn(n.type,this._map,n))}mouseout(n){this._map.fire(new tn(n.type,this._map,n))}touchstart(n){return this._firePreventable(new ca(n.type,this._map,n))}touchmove(n){this._map.fire(new ca(n.type,this._map,n))}touchend(n){this._map.fire(new ca(n.type,this._map,n))}touchcancel(n){this._map.fire(new ca(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gl{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new tn(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new tn(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Fu{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(be(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const _=c,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(_)||!this._box&&_.dist(y)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const S=Math.min(y.x,_.x),M=Math.max(y.x,_.x),C=Math.min(y.y,_.y),z=Math.max(y.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${C}px)`,this._box.style.width=M-S+"px",this._box.style.height=z-C+"px")})}mouseupWindow(n,c){if(!this._active)return;const _=this._startPos,y=c;if(_&&n.button===0){if(this.reset(),We(),_.x!==y.x||_.y!==y.y)return this._map.fire(new r.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(_,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),De(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new r.Event(n,{originalEvent:c}))}}function yl(p,n){const c={};for(let _=0;_<p.length;_++)c[p[_].identifier]=n[_];return c}class ao{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const b=new r.Point(0,0);for(const S of y)b._add(S);return b.div(y.length)}(c),this.touches=yl(_,c)))}touchmove(n,c,_){if(this.aborted||!this.centroid)return;const y=yl(_,c);for(const b in this.touches){const S=y[b];(!S||S.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,c,_){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Fc{constructor(n){this.singleTap=new ao(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,_){this.singleTap.touchstart(n,c,_)}touchmove(n,c,_){this.singleTap.touchmove(n,c,_)}touchend(n,c,_){const y=this.singleTap.touchend(n,c,_);if(y){const b=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(b&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Up{constructor(){this._zoomIn=new Fc({numTouches:1,numTaps:2}),this._zoomOut=new Fc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,_){this._zoomIn.touchstart(n,c,_),this._zoomOut.touchstart(n,c,_)}touchmove(n,c,_){this._zoomIn.touchmove(n,c,_),this._zoomOut.touchmove(n,c,_)}touchend(n,c,_){const y=this._zoomIn.touchend(n,c,_),b=this._zoomOut.touchend(n,c,_);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Nu={0:1,2:2};class lo{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const _=nt(n);this._correctButton(n,_)&&(this._lastPoint=c,this._eventButton=_)}mousemoveWindow(n,c){const _=this._lastPoint;if(_){if(n.preventDefault(),this._eventButton!=null&&function(y,b){const S=Nu[b];return y.buttons===void 0||(y.buttons&S)!==S}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(_,c)}}mouseupWindow(n){this._lastPoint&&nt(n)===this._eventButton&&(this._moved&&We(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nc extends lo{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class jc extends lo{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const _=.8*(c.x-n.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(n){n.preventDefault()}}class Vc extends lo{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const _=-.5*(c.y-n.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(n){n.preventDefault()}}class xl{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.Point(0,0)}touchstart(n,c,_){return this._calculateTransform(n,c,_)}touchmove(n,c,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!r.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,_)}}touchend(n,c,_){this._calculateTransform(n,c,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,_){_.length>0&&(this._active=!0);const y=yl(_,c),b=new r.Point(0,0),S=new r.Point(0,0);let M=0;for(const z in y){const L=y[z],N=this._touches[z];N&&(b._add(L),S._add(L.sub(N)),M++,y[z]=L)}if(this._touches=y,M<this._minTouches||!S.mag())return;const C=S.div(M);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ha{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,_){return{}}touchstart(n,c,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,_){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[b,S]=y,M=ua(_,c,b),C=ua(_,c,S);if(!M||!C)return;const z=this._aroundCenter?null:M.add(C).div(2);return this._move([M,C],z,n)}touchend(n,c,_){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,S=ua(_,c,y),M=ua(_,c,b);S&&M||(this._active&&We(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ua(p,n,c){for(let _=0;_<p.length;_++)if(p[_].identifier===c)return n[_]}function Uc(p,n){return Math.log(p/n)/Math.LN2}class ju extends ha{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const _=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(Uc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uc(this._distance,_),pinchAround:c}}}function Gc(p,n){return 180*p.angleWith(n)/Math.PI}class Vu extends ha{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const _=this._vector;if(this._vector=n[0].sub(n[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Gc(this._vector,_),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const y=Gc(n,_);return Math.abs(y)<c}}function Ys(p){return Math.abs(p.y)>Math.abs(p.x)}class Uu extends ha{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Ys(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,_){const y=this._lastPoints;if(!y)return;const b=n[0].sub(y[0]),S=n[1].sub(y[1]);return this._map._cooperativeGestures&&!r.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,_.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(n,c,_){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,b=c.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const S=n.y>0==c.y>0;return Ys(n)&&Ys(c)&&S}}const Gu={panStep:100,bearingStep:15,pitchStep:10};class Gp{constructor(){const n=Gu;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,_=0,y=0,b=0,S=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?_=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?_=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),S=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:M=>{const C=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:$u,zoom:c?Math.round(C)+c*(n.shiftKey?2:1):C,bearing:M.getBearing()+_*this._bearingStep,pitch:M.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:M.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function $u(p){return p*(2-p)}const $c=4.000244140625;class qu{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,r.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===r.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const _=r.exported.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,c!==0&&c%$c==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Re(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>$c?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&z!==0&&(z=1/z);const L=c(),N=Math.pow(2,L),q=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(q*z))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,b=this._easing;let S,M=!1;if(this._type==="wheel"&&y&&b){const C=Math.min((r.exported.now()-this._lastWheelEventTime)/200,1),z=b(C);S=r.number(y,_,z),C<1?this._frameId||(this._frameId=!0):M=!0}else S=_,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:S-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=r.ease;if(this._prevEase){const _=this._prevEase,y=(r.exported.now()-_.start)/_.duration,b=_.easing(y+.01)-_.easing(y),S=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-S*S);c=r.bezier(S,M,.25,1)}return this._prevEase={start:r.exported.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(r.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Wu{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(n.shiftKey?-1:1),around:_.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $p{constructor(){this._tap=new Fc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,_){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=c[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(n,c,_))}touchmove(n,c,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=c[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,c,_)}touchend(n,c,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(n,c,_)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zu{constructor(n,c,_){this._el=n,this._mousePan=c,this._touchPan=_}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class qp{constructor(n,c,_){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Wp{constructor(n,c,_,y){this._el=n,this._touchZoom=c,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const qn=p=>p.zoom||p.drag||p.pitch||p.rotate;class Hu extends r.Event{}class Zp{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const _=r.sub([],c,n);this.radius=r.length(_[2]<0?r.div([],_,this.constants):[_[0],_[1],0])}projectRay(n){r.div(n,n,this.constants),r.normalize(n,n),r.mul$1(n,n,this.constants);const c=r.scale$2([],n,this.radius);if(c[2]>0){const _=r.scale$2([],[0,0,1],r.dot(c,[0,0,1])),y=r.scale$2([],r.normalize([],[c[0],c[1],0]),this.radius),b=r.add([],c,r.scale$2([],r.sub([],r.add([],y,_),c),2));c[0]=b[0],c[1]=b[1]}return c}}function is(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class ps{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Bu(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Zp,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[r.window.document,"mousemove",{capture:!0}],[r.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[r.window,"blur",void 0]];for(const[y,b,S]of this._listeners)y.addEventListener(b,y===r.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[n,c,_]of this._listeners)n.removeEventListener(c,n===r.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(n){const c=this._map,_=c.getCanvasContainer();this._add("mapEvent",new Bc(c,n));const y=c.boxZoom=new Fu(c,n);this._add("boxZoom",y);const b=new Up,S=new dn;c.doubleClickZoom=new Wu(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const M=new $p;this._add("tapDragZoom",M);const C=c.touchPitch=new Uu(c);this._add("touchPitch",C);const z=new jc(n),L=new Vc(n);c.dragRotate=new qp(n,z,L),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const N=new Nc(n),q=new xl(c,n);c.dragPan=new Zu(_,N,q),this._add("mousePan",N),this._add("touchPan",q,["touchZoom","touchRotate"]);const H=new Vu,J=new ju;c.touchZoomRotate=new Wp(_,J,H,M),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new gl(c));const K=c.scrollZoom=new qu(c,this);this._add("scrollZoom",K,["mousePan"]);const Q=c.keyboard=new Gp;this._add("keyboard",Q);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[j]&&c[j].enable(n[j])}_add(n,c,_){this._handlers.push({handlerName:n,handler:c,allowed:_}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!qn(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,_){for(const y in n)if(y!==_&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const _ of n)this._el.contains(_.target)&&c.push(_);return c}handleEvent(n,c){this._updatingCamera=!0;const _=n.type==="renderFrame",y=_?void 0:n,b={needsRenderFrame:!1},S={},M={},C=n.touches?this._getMapTouches(n.touches):void 0,z=C?Je(this._el,C):_?void 0:Re(this._el,n);for(const{handlerName:q,handler:H,allowed:J}of this._handlers){if(!H.isEnabled())continue;let K;this._blockedByActive(M,J,q)?H.reset():H[c||n.type]&&(K=H[c||n.type](n,z,C),this.mergeHandlerResult(b,S,K,q,y),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||H.isActive())&&(M[q]=H)}const L={};for(const q in this._previousActiveHandlers)M[q]||(L[q]=y);this._previousActiveHandlers=M,(Object.keys(L).length||is(b))&&(this._changes.push([b,S,L]),this._triggerRenderFrame()),(Object.keys(M).length||is(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(n,c,_,y,b){if(!_)return;r.extend(n,_);const S={handlerName:y,originalEvent:_.originalEvent||b};_.zoomDelta!==void 0&&(c.zoom=S),_.panDelta!==void 0&&(c.drag=S),_.pitchDelta!==void 0&&(c.pitch=S),_.bearingDelta!==void 0&&(c.rotate=S)}_applyChanges(){const n={},c={},_={};for(const[y,b,S]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new r.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),r.extend(c,b),r.extend(_,S);this._updateMapTransform(n,c,_),this._changes=[]}_updateMapTransform(n,c,_){const y=this._map,b=y.transform,S=Z=>[Z.x,Z.y,Z.z];if((Z=>{const ne=this._eventsInProgress.drag;return ne&&!this._handlersById[ne.handlerName].isActive()})()&&!is(n)){const Z=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",Z!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!is(n))return void this._fireEvents(c,_,!0);let{panDelta:M,zoomDelta:C,bearingDelta:z,pitchDelta:L,around:N,aroundCoord:q,pinchAround:H}=n;b._isCameraConstrained&&(C>0&&(C=0),b._isCameraConstrained=!1),H!==void 0&&(N=H),(C||(Z=>c[Z]&&!this._eventsInProgress[Z])("drag"))&&N&&(this._dragOrigin=S(b.pointCoordinate3D(N)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),N=N||y.transform.centerPoint,z&&(b.bearing+=z),L&&(b.pitch+=L),b._updateCameraState();const J=[0,0,0];if(M)if(b.projection.name==="mercator"){const Z=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N).dir),ne=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N.sub(M)).dir);J[0]=ne[0]-Z[0],J[1]=ne[1]-Z[1]}else{const Z=b.pointCoordinate(N);if(b.projection.name==="globe"){M=M.rotate(-b.angle);const ne=b._pixelsPerMercatorPixel/b.worldSize;J[0]=-M.x*r.mercatorScale(r.latFromMercatorY(Z.y))*ne,J[1]=-M.y*r.mercatorScale(b.center.lat)*ne}else{const ne=b.pointCoordinate(N.sub(M));Z&&ne&&(J[0]=ne.x-Z.x,J[1]=ne.y-Z.y)}}const K=b.zoom,Q=[0,0,0];if(C){const Z=S(q||b.pointCoordinate3D(N)),ne={dir:r.normalize([],r.sub([],Z,b._camera.position))};if(ne.dir[2]<0){const se=b.zoomDeltaToMovement(Z,C);r.scale$2(Q,ne.dir,se)}}const j=r.add(J,J,Q);b._translateCameraConstrained(j),C&&Math.abs(b.zoom-K)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,_,!0)}_fireEvents(n,c,_){const y=qn(this._eventsInProgress),b=qn(n),S={};for(const L in n){const{originalEvent:N}=n[L];this._eventsInProgress[L]||(S[`${L}start`]=N),this._eventsInProgress[L]=n[L]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in S)this._fireEvent(L,S[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in n){const{originalEvent:N}=n[L];this._fireEvent(L,N)}const M={};let C;for(const L in this._eventsInProgress){const{handlerName:N,originalEvent:q}=this._eventsInProgress[L];this._handlersById[N].isActive()||(delete this._eventsInProgress[L],C=c[N]||q,M[`${L}end`]=C)}for(const L in M)this._fireEvent(L,M[L]);const z=qn(this._eventsInProgress);if(_&&(y||b)&&!z){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=q=>q!==0&&-this._bearingSnap<q&&q<this._bearingSnap;L?(N(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:C})):(this._map.fire(new r.Event("moveend",{originalEvent:C})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new r.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Hu("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const wr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class vl extends r.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,r.bindAll(["_renderFrameCallback"],this)}getCenter(){return new r.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,_){return n=r.Point.convert(n).mult(-1),this.panTo(this.transform.center,r.extend({offset:n},c),_)}panTo(n,c,_){return this.easeTo(r.extend({center:n},c),_)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,_){return this.easeTo(r.extend({zoom:n},c),_)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,_){return this.easeTo(r.extend({bearing:n},c),_)}resetNorth(n,c){return this.rotateTo(0,r.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(r.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=r.LngLatBounds.convert(n);const _=c&&c.bearing||0,y=c&&c.pitch||0,b=n.getNorthWest(),S=n.getSouthEast();return this._cameraForBounds(this.transform,b,S,_,y,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if(typeof(n=r.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const _=n.padding;n.padding={top:_,bottom:_,right:_,left:_}}return n.padding=r.extend(c,n.padding),n}_minimumAABBFrustumDistance(n,c){const _=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return _/y>n.aspect?_/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,_,y,b,S){const M=n.clone(),C=this._extendCameraOptions(S);M.bearing=y,M.pitch=b;const z=r.LngLat.convert(c),L=r.LngLat.convert(_),N=.5*(z.lat+L.lat),q=.5*(z.lng+L.lng),H=r.latLngToECEF(N,q),J=r.normalize([],H),K=r.normalize([],r.cross([],J,[0,1,0])),Q=r.cross([],K,J),j=[K[0],K[1],K[2],0,Q[0],Q[1],Q[2],0,J[0],J[1],J[2],0,0,0,0,1],Z=[H,r.latLngToECEF(z.lat,z.lng),r.latLngToECEF(L.lat,z.lng),r.latLngToECEF(L.lat,L.lng),r.latLngToECEF(z.lat,L.lng),r.latLngToECEF(N,z.lng),r.latLngToECEF(N,L.lng),r.latLngToECEF(z.lat,q),r.latLngToECEF(L.lat,q)];let ne=r.Aabb.fromPoints(Z.map(Ge=>[r.dot(K,Ge),r.dot(Q,Ge),r.dot(J,Ge)]));const se=r.transformMat4([],ne.center,j);r.squaredLength(se)===0&&r.set(se,0,0,1),r.normalize(se,se),r.scale$2(se,se,r.GLOBE_RADIUS),M.center=r.ecefToLatLng(se);const fe=M.getWorldToCameraMatrix(),me=r.invert(new Float64Array(16),fe);ne=r.Aabb.applyTransform(ne,r.multiply([],fe,j)),r.transformMat4(se,se,fe);const _e=.5*(ne.max[2]-ne.min[2]),ve=this._minimumAABBFrustumDistance(M,ne),xe=r.scale$2([],[0,0,1],_e),Ae=r.add(xe,se,xe),Ze=ve+(M.pitch===0?0:r.distance(se,Ae)),Ee=M.globeCenterInViewSpace,je=r.sub([],se,[Ee[0],Ee[1],Ee[2]]);r.normalize(je,je),r.scale$2(je,je,Ze);const Ie=r.add([],se,je);r.transformMat4(Ie,Ie,me);const qe=r.earthRadius/r.GLOBE_RADIUS,Me=r.length(Ie),Ne=r.mercatorZfromAltitude(Math.max(Me*qe-r.earthRadius,Number.EPSILON),0),Xe=Math.min(M.zoomFromMercatorZAdjusted(Ne),C.maxZoom);return Xe>.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"mercator"}),M.zoom=Xe,this._cameraForBounds(M,c,_,y,b,S)):{center:M.center,zoom:Xe,bearing:y,pitch:b}}queryTerrainElevation(n,c){const _=this.transform.elevation;return _?(c=r.extend({},{exaggerated:!0},c),_.getAtPoint(r.MercatorCoordinate.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,_,y,b,S){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,c,_,y,b,S);const M=n.clone(),C=this._extendCameraOptions(S),z=M.padding;M.bearing=y,M.pitch=b;const L=r.LngLat.convert(c),N=r.LngLat.convert(_),q=new r.LngLat(L.lng,N.lat),H=new r.LngLat(N.lng,L.lat),J=M.project(L),K=M.project(N),Q=this.queryTerrainElevation(L),j=this.queryTerrainElevation(N),Z=this.queryTerrainElevation(q),ne=this.queryTerrainElevation(H),se=[[J.x,J.y,Math.min(Q||0,j||0,Z||0,ne||0)],[K.x,K.y,Math.max(Q||0,j||0,Z||0,ne||0)]];let fe=r.Aabb.fromPoints(se);const me=M.getWorldToCameraMatrix(),_e=r.invert(new Float64Array(16),me);fe=r.Aabb.applyTransform(fe,me);const ve=r.sub([],fe.max,fe.min),xe=z.left||0,Ae=z.right||0,Ze=z.bottom||0,Ee=z.top||0,{left:je,right:Ie,top:qe,bottom:Me}=C.padding,Ne=.5*(xe+Ae),Xe=.5*(Ee+Ze),Ge=Math.min(M.scaleZoom(M.scale*Math.min((M.width-(xe+Ae+je+Ie))/ve[0],(M.height-(Ze+Ee+Me+qe))/ve[1])),C.maxZoom),Ye=M.scale/M.zoomScale(Ge);fe=new r.Aabb([fe.min[0]-(je+Ne)*Ye,fe.min[1]-(Me+Xe)*Ye,fe.min[2]],[fe.max[0]+(Ie+Ne)*Ye,fe.max[1]+(qe+Xe)*Ye,fe.max[2]]);const mt=.5*ve[2],wt=this._minimumAABBFrustumDistance(M,fe),dt=[0,0,1,0];r.transformMat4$1(dt,dt,me),r.normalize$2(dt,dt);const xt=r.scale$2([],dt,wt+mt),Bt=r.add([],fe.center,xt),Dt=(typeof C.offset.x=="number"&&typeof C.offset.y=="number"?new r.Point(C.offset.x,C.offset.y):r.Point.convert(C.offset)).rotate(-r.degToRad(y));fe.center[0]-=Dt.x*Ye,fe.center[1]+=Dt.y*Ye,r.transformMat4(fe.center,fe.center,_e),r.transformMat4(Bt,Bt,_e);const _t=[fe.center[0],fe.center[1],Bt[2]*M.pixelsPerMeter];r.scale$2(_t,_t,1/M.worldSize);const Jt=r.lngFromMercatorX(_t[0]),ii=r.latFromMercatorY(_t[1]),ni=Math.min(M._zoomFromMercatorZ(_t[2]),C.maxZoom),si=new r.LngLat(Jt,ii);return M.mercatorFromTransition&&ni<.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"globe"}),M.zoom=ni,this._cameraForBounds(M,c,_,y,b,S)):{center:si,zoom:ni,bearing:y,pitch:b}}fitBounds(n,c,_){const y=this.cameraForBounds(n,c);return this._fitInternal(y,c,_)}fitScreenCoordinates(n,c,_,y,b){const S=r.Point.convert(n),M=r.Point.convert(c),C=new r.Point(Math.min(S.x,M.x),Math.min(S.y,M.y)),z=new r.Point(Math.max(S.x,M.x),Math.max(S.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,M))return this;const L=this.transform.pointLocation3D(C),N=this.transform.pointLocation3D(z),q=this.transform.pointLocation3D(new r.Point(C.x,z.y)),H=this.transform.pointLocation3D(new r.Point(z.x,C.y)),J=[Math.min(L.lng,N.lng,q.lng,H.lng),Math.min(L.lat,N.lat,q.lat,H.lat)],K=[Math.max(L.lng,N.lng,q.lng,H.lng),Math.max(L.lat,N.lat,q.lat,H.lat)],Q=y&&y.pitch?y.pitch:this.getPitch(),j=this._cameraForBounds(this.transform,J,K,_,Q,y);return this._fitInternal(j,y,b)}_fitInternal(n,c,_){return n?(delete(c=r.extend(n,c)).padding,c.linear?this.easeTo(c,_):this.flyTo(c,_)):this}jumpTo(n,c){this.stop();const _=n.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,S=!1;return"zoom"in n&&_.zoom!==+n.zoom&&(y=!0,_.zoom=+n.zoom),n.center!==void 0&&(_.center=r.LngLat.convert(n.center)),"bearing"in n&&_.bearing!==+n.bearing&&(b=!0,_.bearing=+n.bearing),"pitch"in n&&_.pitch!==+n.pitch&&(S=!0,_.pitch=+n.pitch),n.padding==null||_.isPaddingEqual(n.padding)||(_.padding=n.padding),n.preloadOnly?(this._preloadTiles(_),this):(this.fire(new r.Event("movestart",c)).fire(new r.Event("move",c)),y&&this.fire(new r.Event("zoomstart",c)).fire(new r.Event("zoom",c)).fire(new r.Event("zoomend",c)),b&&this.fire(new r.Event("rotatestart",c)).fire(new r.Event("rotate",c)).fire(new r.Event("rotateend",c)),S&&this.fire(new r.Event("pitchstart",c)).fire(new r.Event("pitch",c)).fire(new r.Event("pitchend",c)),this.fire(new r.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.warnOnce(wr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const _=this.transform;if(!_.projection.supportsFreeCamera)return r.warnOnce(wr),this;this.stop();const y=_.zoom,b=_.pitch,S=_.bearing;_.setFreeCameraOptions(n);const M=y!==_.zoom,C=b!==_.pitch,z=S!==_.bearing;return this.fire(new r.Event("movestart",c)).fire(new r.Event("move",c)),M&&this.fire(new r.Event("zoomstart",c)).fire(new r.Event("zoom",c)).fire(new r.Event("zoomend",c)),z&&this.fire(new r.Event("rotatestart",c)).fire(new r.Event("rotate",c)).fire(new r.Event("rotateend",c)),C&&this.fire(new r.Event("pitchstart",c)).fire(new r.Event("pitch",c)).fire(new r.Event("pitchend",c)),this.fire(new r.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=r.extend({offset:[0,0],duration:500,easing:r.ease},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const _=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),M=this.getPadding(),C="zoom"in n?+n.zoom:y,z="bearing"in n?this._normalizeBearing(n.bearing,b):b,L="pitch"in n?+n.pitch:S,N="padding"in n?n.padding:_.padding,q=r.Point.convert(n.offset);let H,J,K;if(_.projection.name==="globe"){const xe=r.MercatorCoordinate.fromLngLat(_.center),Ae=q.rotate(-_.angle);xe.x+=Ae.x/_.worldSize,xe.y+=Ae.y/_.worldSize;const Ze=xe.toLngLat(),Ee=r.LngLat.convert(n.center||Ze);this._normalizeCenter(Ee),H=_.centerPoint.add(Ae),J=new r.Point(xe.x,xe.y).mult(_.worldSize),K=new r.Point(r.mercatorXfromLng(Ee.lng),r.mercatorYfromLat(Ee.lat)).mult(_.worldSize).sub(J)}else{H=_.centerPoint.add(q);const xe=_.pointLocation(H),Ae=r.LngLat.convert(n.center||xe);this._normalizeCenter(Ae),J=_.project(xe),K=_.project(Ae).sub(J)}const Q=_.zoomScale(C-y);let j,Z;n.around&&(j=r.LngLat.convert(n.around),Z=_.locationPoint(j));const ne=this._zooming||C!==y,se=this._rotating||b!==z,fe=this._pitching||L!==S,me=!_.isPaddingEqual(N),_e=xe=>Ae=>{if(ne&&(xe.zoom=r.number(y,C,Ae)),se&&(xe.bearing=r.number(b,z,Ae)),fe&&(xe.pitch=r.number(S,L,Ae)),me&&(xe.interpolatePadding(M,N,Ae),H=xe.centerPoint.add(q)),j)xe.setLocationAtPoint(j,Z);else{const Ze=xe.zoomScale(xe.zoom-y),Ee=C>y?Math.min(2,Q):Math.max(.5,Q),je=Math.pow(Ee,1-Ae),Ie=xe.unproject(J.add(K.mult(Ae*je)).mult(Ze));xe.setLocationAtPoint(xe.renderWorldCopies?Ie.wrap():Ie,H)}return n.preloadOnly||this._fireMoveEvents(c),xe};if(n.preloadOnly){const xe=this._emulate(_e,n.duration,_);return this._preloadTiles(xe),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=se,this._pitching=fe,this._padding=me,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,ve),this._ease(_e(_),xe=>{_.recenterOnTerrain(),this._afterEase(c,xe)},n),this}_prepareEase(n,c,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||_.moving||this.fire(new r.Event("movestart",n)),this._zooming&&!_.zooming&&this.fire(new r.Event("zoomstart",n)),this._rotating&&!_.rotating&&this.fire(new r.Event("rotatestart",n)),this._pitching&&!_.pitching&&this.fire(new r.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.Event("move",n)),this._zooming&&this.fire(new r.Event("zoom",n)),this._rotating&&this.fire(new r.Event("rotate",n)),this._pitching&&this.fire(new r.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new r.Event("zoomend",n)),y&&this.fire(new r.Event("rotateend",n)),b&&this.fire(new r.Event("pitchend",n)),this.fire(new r.Event("moveend",n))}flyTo(n,c){if(this._prefersReducedMotion(n)){const Ge=r.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ge,c)}this.stop(),n=r.extend({offset:[0,0],speed:1.2,curve:1.42,easing:r.ease},n);const _=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),M=this.getPadding(),C="zoom"in n?r.clamp(+n.zoom,_.minZoom,_.maxZoom):y,z="bearing"in n?this._normalizeBearing(n.bearing,b):b,L="pitch"in n?+n.pitch:S,N="padding"in n?n.padding:_.padding,q=_.zoomScale(C-y),H=r.Point.convert(n.offset);let J=_.centerPoint.add(H);const K=_.pointLocation(J),Q=r.LngLat.convert(n.center||K);this._normalizeCenter(Q);const j=_.project(K),Z=_.project(Q).sub(j);let ne=n.curve;const se=Math.max(_.width,_.height),fe=se/q,me=Z.mag();if("minZoom"in n){const Ge=r.clamp(Math.min(n.minZoom,y,C),_.minZoom,_.maxZoom),Ye=se/_.zoomScale(Ge-y);ne=Math.sqrt(Ye/me*2)}const _e=ne*ne;function ve(Ge){const Ye=(fe*fe-se*se+(Ge?-1:1)*_e*_e*me*me)/(2*(Ge?fe:se)*_e*me);return Math.log(Math.sqrt(Ye*Ye+1)-Ye)}function xe(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function Ae(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Ze=ve(0);let Ee=function(Ge){return Ae(Ze)/Ae(Ze+ne*Ge)},je=function(Ge){return se*((Ae(Ze)*(xe(Ye=Ze+ne*Ge)/Ae(Ye))-xe(Ze))/_e)/me;var Ye},Ie=(ve(1)-Ze)/ne;if(Math.abs(me)<1e-6||!isFinite(Ie)){if(Math.abs(se-fe)<1e-6)return this.easeTo(n,c);const Ge=fe<se?-1:1;Ie=Math.abs(Math.log(fe/se))/ne,je=function(){return 0},Ee=function(Ye){return Math.exp(Ge*ne*Ye)}}n.duration="duration"in n?+n.duration:1e3*Ie/("screenSpeed"in n?+n.screenSpeed/ne:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const qe=b!==z,Me=L!==S,Ne=!_.isPaddingEqual(N),Xe=Ge=>Ye=>{const mt=Ye*Ie,wt=1/Ee(mt);Ge.zoom=Ye===1?C:y+Ge.scaleZoom(wt),qe&&(Ge.bearing=r.number(b,z,Ye)),Me&&(Ge.pitch=r.number(S,L,Ye)),Ne&&(Ge.interpolatePadding(M,N,Ye),J=Ge.centerPoint.add(H));const dt=Ye===1?Q:Ge.unproject(j.add(Z.mult(je(mt))).mult(wt));return Ge.setLocationAtPoint(Ge.renderWorldCopies?dt.wrap():dt,J),Ge._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),Ge};if(n.preloadOnly){const Ge=this._emulate(Xe,n.duration,_);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=qe,this._pitching=Me,this._padding=Ne,this._prepareEase(c,!1),this._ease(Xe(_),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,c)}if(!n){const _=this.handlers;_&&_.stop(!1)}return this}_ease(n,c,_){_.animate===!1||_.duration===0?(n(1),c()):(this._easeStart=r.exported.now(),this._easeOptions=_,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((r.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=r.wrap(n,-180,180);const _=Math.abs(n-c);return Math.abs(n-360-c)<_&&(n-=360),Math.abs(n+360-c)<_&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const _=n.lng-c.center.lng;n.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,c,_){const y=Math.ceil(15*c/1e3),b=[],S=n(_.clone());for(let M=0;M<=y;M++){const C=S(M/y);b.push(C.clone())}return b}}class ht{constructor(n={}){this.options=n,r.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),U("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const _=this._map._getUIString(`AttributionControl.${c}`);n.setAttribute("aria-label",_),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.config.ACCESS_TOKEN}];if(n){const _=c.reduce((y,b,S)=>(b.value&&(y+=`${b.key}=${b.value}${S<c.length-1?"&":""}`),y),"?");n.href=`${r.config.FEEDBACK_URL}/${_}#${ra(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const b=c[y];if(b.used){const S=b.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n.sort((y,b)=>y.length-b.length),n=n.filter((y,b)=>{for(let S=b+1;S<n.length;S++)if(n[S].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const _=n.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,n.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class qc{constructor(){r.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=U("div","mapboxgl-ctrl");const c=U("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const _=n[c].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Wc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,_=c?this._queue.concat(c):this._queue;for(const y of _)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const _ of c)if(!_.cancelled&&(_.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function co(p,n,c){if(p=new r.LngLat(p.lng,p.lat),n){const _=new r.LngLat(p.lng-360,p.lat),y=new r.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),S=c.locationPoint(p).distSqr(n),M=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(_).distSqr(n)<S&&(M||Math.abs(_.lng-c.center.lng)<b)?p=_:c.locationPoint(y).distSqr(n)<S&&(M||Math.abs(y.lng-c.center.lng)<b)&&(p=y)}for(;Math.abs(p.lng-c.center.lng)>180;){const _=c.locationPoint(p);if(_.x>=0&&_.y>=0&&_.x<=c.width&&_.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const Tr={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class at extends r.Evented{constructor(n,c){if(super(),(n instanceof r.window.HTMLElement||c)&&(n=r.extend({element:n},c)),r.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=U("div");const y=41,b=27,S=Y("svg",{display:"block",height:y*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${y}`},this._element),M=Y("radialGradient",{id:"shadowGradient"},Y("defs",{},S));Y("stop",{offset:"10%","stop-opacity":.4},M),Y("stop",{offset:"100%","stop-opacity":.05},M),Y("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),Y("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),Y("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),Y("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=r.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const _=this._element.classList;for(const y in Tr)_.remove(`mapboxgl-marker-anchor-${y}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,_=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,_=this._element;this._popup&&(c===_||_.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const _=n.unproject(c),y=n.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(_)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const _=n.unproject(c);let y;n._showingGlobe()&&r.isLngLatBehindGlobe(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(_),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Tr[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,_=this.getPitchAlignment();if(!c||!n||_!=="map")return"";if(!c._showingGlobe()){const C=c.getPitch();return C?`rotateX(${C}deg)`:""}const y=r.radToDeg(r.globeTiltAtLngLat(c.transform,this._lngLat)),b=n.sub(r.globeCenterToScreenPoint(c.transform)),S=Math.abs(b.x)+Math.abs(b.y);if(S===0)return"";const M=y/S;return`rotateX(${-b.y*M}deg) rotateY(${b.x*M}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let _=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const b=c.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),S=c.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);_=r.radToDeg(Math.atan2(S.y,S.x))-90}else _=-c.getBearing();else if(y==="horizon"){const b=r.smoothstep(4,6,c.getZoom()),S=r.globeCenterToScreenPoint(c.transform);S.y+=b*c.transform.height;const M=n.sub(S),C=r.radToDeg(Math.atan2(M.y,M.x));_=(C>90?C-270:C+90)*(1-b)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(n){r.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=co(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),n===!0?this._updateFrameId=r.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.Point.convert(n),this._update(),this}_onMove(n){const c=this._map;if(!c)return;const _=this._pointerdownPos,y=this._positionDelta;if(_&&y){if(!this._isDragging){const b=this._clickTolerance||c._clickTolerance;if(n.point.dist(_)<b)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.Event("dragstart"))),this.fire(new r.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.Event("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,_=this._pos;c&&_&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(_),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Zc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Hp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Xu(p=new r.Point(0,0),n="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(n){case"top":return new r.Point(0,p);case"top-left":return new r.Point(c,c);case"top-right":return new r.Point(-c,c);case"bottom":return new r.Point(0,-p);case"bottom-left":return new r.Point(c,-c);case"bottom-right":return new r.Point(-c,-c);case"left":return new r.Point(p,0);case"right":return new r.Point(-p,0)}return new r.Point(0,0)}return p instanceof r.Point||Array.isArray(p)?r.Point.convert(p):r.Point.convert(p[n]||[0,0])}class Hc{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=r.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,_){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+_}}const Yu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ku={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Xp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Yp{constructor(n,c,_=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new jc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,_&&(this.mousePitch=new Vc({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),be()}move(n,c){const _=this.map,y=this.mouseRotate.mousemoveWindow(n,c),b=y&&y.bearingDelta;if(b&&_.setBearing(_.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(n,c),M=S&&S.pitchDelta;M&&_.setPitch(_.getPitch()+M)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){De(),r.window.removeEventListener("mousemove",this.mousemove),r.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Re(this.element,n)),r.window.addEventListener("mousemove",this.mousemove),r.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Re(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Je(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Je(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Xc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Yc={maxWidth:100,unit:"metric"},Kc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ho={version:r.version,supported:I,setRTLTextPlugin:r.setRTLTextPlugin,getRTLTextPluginStatus:r.getRTLTextPluginStatus,Map:class extends vl{constructor(p){if(r.LivePerformanceUtils.mark(r.PerformanceMarkers.create),(p=r.extend({},Ku,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&r.isSafariWithAntialiasingBug(r.window)&&(p.antialias=!1,r.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ro(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._useWebGL2=p.useWebGL2,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Wc,this._domRenderTaskQueue=new Wc,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.uniqueId(),this._locale=r.extend({},Yu,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Hc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,typeof p.container=="string"){if(this._container=r.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof r.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&r.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),r.window!==void 0&&(r.window.addEventListener("online",this._onWindowOnline,!1),r.window.addEventListener("resize",this._onWindowResize,!1),r.window.addEventListener("orientationchange",this._onWindowResize,!1),r.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ps(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new Oc(typeof p.hash=="string"&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,r.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new ht({customAttribution:p.customAttribution})),this._logoControl=new qc,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new r.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new r.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(p,n){if(n===void 0&&(n=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const _=this._controlPositions[n];return n.indexOf("bottom")!==-1?_.insertBefore(c,_.firstChild):_.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(p);return n>-1&&this._controls.splice(n,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new r.Event("movestart",p)).fire(new r.Event("move",p)),this.fire(new r.Event("resize",p)),n&&this.fire(new r.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(r.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?r.window.navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(n=>n==="auto"?r.window.navigator.language:n):p}setLanguage(p){const n=this._parseLanguage(p);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,n=p.projection.name;let c;n==="globe"&&p.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),c=!0):n==="mercator"&&p.zoom<r.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,n){return this._updateProjection(p||n||{name:"mercator"})}_updateProjection(p){let n;if(n=p.name==="globe"&&this.transform.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(p){return this.transform.locationPoint3D(r.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(r.Point.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,n,c){if(p==="mouseenter"||p==="mouseover"){let _=!1;const y=S=>{const M=n.filter(z=>this.getLayer(z)),C=M.length?this.queryRenderedFeatures(S.point,{layers:M}):[];C.length?_||(_=!0,c.call(this,new tn(p,this,S.originalEvent,{features:C}))):_=!1},b=()=>{_=!1};return{layers:new Set(n),listener:c,delegates:{mousemove:y,mouseout:b}}}if(p==="mouseleave"||p==="mouseout"){let _=!1;const y=S=>{const M=n.filter(C=>this.getLayer(C));(M.length?this.queryRenderedFeatures(S.point,{layers:M}):[]).length?_=!0:_&&(_=!1,c.call(this,new tn(p,this,S.originalEvent)))},b=S=>{_&&(_=!1,c.call(this,new tn(p,this,S.originalEvent)))};return{layers:new Set(n),listener:c,delegates:{mousemove:y,mouseout:b}}}{const _=y=>{const b=n.filter(M=>this.getLayer(M)),S=b.length?this.queryRenderedFeatures(y.point,{layers:b}):[];S.length&&(y.features=S,c.call(this,y),delete y.features)};return{layers:new Set(n),listener:c,delegates:{[p]:_}}}}on(p,n,c){if(c===void 0)return super.on(p,n);Array.isArray(n)||(n=[n]);const _=this._createDelegatedListener(p,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(p,n,c){if(c===void 0)return super.once(p,n);Array.isArray(n)||(n=[n]);const _=this._createDelegatedListener(p,n,c);for(const y in _.delegates)this.once(y,_.delegates[y]);return this}off(p,n,c){if(c===void 0)return super.off(p,n);n=new Set(Array.isArray(n)?n:[n]);const _=(b,S)=>{if(b.size!==S.size)return!1;for(const M of b)if(!S.has(M))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[p]:void 0;return y&&(b=>{for(let S=0;S<b.length;S++){const M=b[S];if(M.listener===c&&_(M.layers,n)){for(const C in M.delegates)this.off(C,M.delegates[C]);return b.splice(S,1),this}}})(y),this}queryRenderedFeatures(p,n){return this.style?(n!==void 0||p===void 0||p instanceof r.Point||Array.isArray(p)||(n=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(p,n){return this.style.querySourceFeatures(p,n)}isPointOnSurface(p){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.Point.convert(p))}setStyle(p,n){return(n=r.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(p,n))}_getUIString(p){const n=this._locale[p];if(n==null)throw new Error(`Missing UI string '${p}'`);return n}_updateStyle(p,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new us(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof p=="string"?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new us(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,n){if(typeof p=="string"){const c=this._requestManager.normalizeStyleURL(p),_=this._requestManager.transformRequest(c,r.ResourceType.Style);r.getJSON(_,(y,b)=>{y?this.fire(new r.ErrorEvent(y)):b&&this._updateDiff(b,n)})}else typeof p=="object"&&this._updateDiff(p,n)}_updateDiff(p,n){try{this.style.setState(p)&&this._update(!0)}catch(c){r.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.warnOnce("There is no style added to the map."),!1)}addSource(p,n){return this._lazyInitEmptyStyle(),this.style.addSource(p,n),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const n in p){const c=p[n]._tiles;for(const _ in c){const y=c[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(p,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,n,c)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,n,{pixelRatio:c=1,sdf:_=!1,stretchX:y,stretchY:b,content:S}={}){if(this._lazyInitEmptyStyle(),n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap){const{width:M,height:C,data:z}=r.exported.getImageData(n);this.style.addImage(p,{data:new r.RGBAImage({width:M,height:C},z),pixelRatio:c,stretchX:y,stretchY:b,content:S,sdf:_,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:C}=n,z=n;this.style.addImage(p,{data:new r.RGBAImage({width:M,height:C},new Uint8Array(z.data)),pixelRatio:c,stretchX:y,stretchY:b,content:S,sdf:_,version:0,userImage:z}),z.onAdd&&z.onAdd(this,p)}}updateImage(p,n){const c=this.style.getImage(p);if(!c)return void this.fire(new r.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap?r.exported.getImageData(n):n,{width:y,height:b}=_;y!==void 0&&b!==void 0?y===c.data.width&&b===c.data.height?(c.data.replace(_.data,!(n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap)),this.style.updateImage(p,c)):this.fire(new r.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new r.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,n){r.getImage(this._requestManager.transformRequest(p,r.ResourceType.Image),(c,_)=>{n(c,_ instanceof r.window.HTMLImageElement?r.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(p,n){return this._lazyInitEmptyStyle(),this.style.addLayer(p,n),this._update(!0)}moveLayer(p,n){return this.style.moveLayer(p,n),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,n,c){return this.style.setLayerZoomRange(p,n,c),this._update(!0)}setFilter(p,n,c={}){return this.style.setFilter(p,n,c),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,n,c,_={}){return this.style.setPaintProperty(p,n,c,_),this._update(!0)}getPaintProperty(p,n){return this.style.getPaintProperty(p,n)}setLayoutProperty(p,n,c,_={}){return this.style.setLayoutProperty(p,n,c,_),this._update(!0)}getLayoutProperty(p,n){return this.style.getLayoutProperty(p,n)}setLight(p,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.LngLat.convert(p),this.transform):0}setFeatureState(p,n){return this.style.setFeatureState(p,n),this._update()}removeFeatureState(p,n){return this.style.removeFeatureState(p,n),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,_,y,b=this._container;for(;b&&(!_||!y);){const S=r.window.getComputedStyle(b).transform;S&&S!=="none"&&(c=S.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(_=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),b=b.parentElement}this._containerWidth=_?Math.abs(p/_):p,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){r.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=U("div","mapboxgl-canvas-container",p);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=U("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=U("div","mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{_[y]=U("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,n){const c=r.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${n}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const n=this._markers.indexOf(p);n!==-1&&this._markers.splice(n,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const n=this._popups.indexOf(p);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const p=r.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",p),c=n||this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);c?(this._useWebGL2&&!n&&r.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),r.storeAuthState(c,!0),this.painter=new no(c,this.transform,!!n),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.exported$1.testSupport(c)):this.fire(new r.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new r.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let n;const c=this.painter.context.extTimerQuery,_=r.exported.now();if(this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],r.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],r.window.performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,C=this.transform.pitch,z=r.exported.now(),L=new r.EvaluationParameters(M,{now:z,fadeDuration:y,pitch:C,transition:this.style.getTransition()});this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const M=r.exported.now()-_;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const C=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new r.Event("gpu-timing-frame",{cpuTime:M,gpuTime:C})),r.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:C}})},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const C=this.painter.queryGpuTimers(M);this.fire(new r.Event("gpu-timing-layer",{layerTimes:C}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const C=this.painter.queryGpuTimeDeferredRender(M);this.fire(new r.Event("gpu-timing-deferred-render",{gpuTime:C}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(S||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(b=this._updateAverageElevation(_,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new r.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const C=this._calculateSpeedIndex();this.fire(new r.Event("speedindexcompleted",{speedIndex:C})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,r.LivePerformanceUtils.mark(r.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&r.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const n of this._markers)p&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!p||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(p,n=!1){const c=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((n||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=p;const S=Math.abs(_-y);if(S>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){r.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===r.AUTH_ERR_MSG||p.status===401)){const n=this.painter.context.gl;r.storeAuthState(n,!1),this._logoControl instanceof qc&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,_=c.createFramebuffer();function y(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const S=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,S),S}return c.bindFramebuffer(c.FRAMEBUFFER,_),this._canvasPixelComparison(y(p),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(p,n,c){let _=c[1]-c[0];const y=p.length/4;for(let b=0;b<n.length;b++){const S=n[b];let M=0;for(let C=0;C<S.length;C+=4)S[C]===p[C]&&S[C+1]===p[C+1]&&S[C+2]===p[C+2]&&S[C+3]===p[C+3]&&(M+=1);_+=(c[b+2]-c[b+1])*(1-M/y)}return _}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),r.window!==void 0&&(r.window.removeEventListener("resize",this._onWindowResize,!1),r.window.removeEventListener("orientationchange",this._onWindowResize,!1),r.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.removeEventListener("online",this._onWindowOnline,!1),r.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new r.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=r.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(p){const n=this.style?Object.values(this.style._sourceCaches):[];return r.asyncAll(n,(c,_)=>c._preloadTiles(p,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){r.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,n){r.setCacheLimits(p,n)}get version(){return r.version}},NavigationControl:class{constructor(p){this.options=r.extend({},Xp,p),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const n=p.getZoom(),c=n===p.getMaxZoom(),_=n===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Yp(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,n){const c=U("button",p,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(p,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.Evented{constructor(p){super(),this.options=r.extend({geolocation:r.window.navigator.geolocation},Xc,p),r.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=oo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):r.window.navigator.permissions!==void 0?r.window.navigator.permissions.query({name:"geolocation"}).then(c=>n(c.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(p){const n=this._map.getMaxBounds(),c=p.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new r.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("geolocate",p)),this._finish()}}_updateCamera(p){const n=new r.LngLat(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,_=this._map.getBearing(),y=r.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),y,{geolocateSource:!0})}_updateMarker(p){if(p){const n=new r.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,n=r.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){r.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new at({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new at({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.Event("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{r.window.addEventListener("ondeviceorientationabsolute"in r.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};r.window.DeviceMotionEvent!==void 0&&typeof r.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),r.window.removeEventListener("deviceorientation",this._onDeviceOrientation),r.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ht,ScaleControl:class{constructor(p){this.options=r.extend({},Yc,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,_=n._containerWidth/2-p/2,y=n.unproject([_,c]),b=n.unproject([_+p,c]),S=y.distanceTo(b);if(this.options.unit==="imperial"){const M=3.2808*S;M>5280?this._setScale(p,M/5280,"mile"):this._setScale(p,M,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,n,c){this._map._requestDomTask(()=>{const _=function(b){const S=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/S;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(C){const z=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*z)/z}(M),S*M}(n),y=_/n;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(_):`${_}&nbsp;${Kc[c]}`,this._container.style.width=p*y+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof r.window.HTMLElement?this._container=p.container:r.warnOnce("Full screen control 'container' must be a DOM element.")),r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in r.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in r.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,r.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!r.window.document.fullscreenEnabled&&!r.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),r.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(r.window.document.fullscreenElement||r.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?r.window.document.exitFullscreen?r.window.document.exitFullscreen():r.window.document.webkitCancelFullScreen&&r.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.Evented{constructor(p){super(),this.options=r.extend(Object.create(Zc),p),r.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new r.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new r.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=r.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(r.window.document.createTextNode(p))}setHTML(p){const n=r.window.document.createDocumentFragment(),c=r.window.document.createElement("body");let _;for(c.innerHTML=p;_=c.firstChild,_;)n.appendChild(_);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(p),this.options.closeButton){const c=this._closeButton=U("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let n;return this._classList.delete(p)?n=!1:(this._classList.add(p),n=!0),this._updateClassList(),n}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,_=this._pos;if(!n||!c||!_)return"bottom";const y=c.offsetWidth,b=c.offsetHeight,S=_.x<y/2,M=_.x>n.transform.width-y/2;if(_.y+p<b)return S?"top-left":M?"top-right":"top";if(_.y>n.transform.height-b){if(S)return"bottom-left";if(M)return"bottom-right"}return S?"left":M?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),p.className=n.join(" ")}_update(p){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let _=this._container;if(_||(_=this._container=U("div","mapboxgl-popup",n.getContainer()),this._tip=U("div","mapboxgl-popup-tip",_),_.appendChild(c)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=co(this._lngLat,this._pos,n.transform)),!this._trackPointer||p){const y=this._pos=this._trackPointer&&p?p:n.project(this._lngLat),b=Xu(this.options.offset),S=this._anchor=this._getAnchor(b.y),M=Xu(this.options.offset,S),C=y.add(M).round();n._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Tr[S]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&n._showingGlobe()){const y=r.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(Hp);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:at,Style:us,LngLat:r.LngLat,LngLatBounds:r.LngLatBounds,Point:r.Point,MercatorCoordinate:r.MercatorCoordinate,FreeCameraOptions:zu,Evented:r.Evented,config:r.config,prewarm:function(){Wr().acquire(ls)},clearPrewarmedResources:function(){const p=yn;p&&(p.isPreloaded()&&p.numActive()===1?(p.release(ls),yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return r.config.ACCESS_TOKEN},set accessToken(p){r.config.ACCESS_TOKEN=p},get baseApiUrl(){return r.config.API_URL},set baseApiUrl(p){r.config.API_URL=p},get workerCount(){return Qi.workerCount},set workerCount(p){Qi.workerCount=p},get maxParallelImageRequests(){return r.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){r.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){r.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:r.exported.setNow,restoreNow:r.exported.restoreNow};return ho});var v=d;return v})})(Ax);var $2=Ax.exports;const Jh=Mx($2);var ic=W2,q2=Object.prototype.hasOwnProperty;function W2(){for(var o={},s=0;s<arguments.length;s++){var a=arguments[s];for(var u in a)q2.call(a,u)&&(o[u]=a[u])}return o}var Ix={exports:{}};(function(o,s){(function(){var a={};o.exports=a,a.simpleFilter=function(u,d){return d.filter(function(g){return a.test(u,g)})},a.test=function(u,d){return a.match(u,d)!==null},a.match=function(u,d,g){g=g||{};var v=0,r=[],T=d.length,I=0,R=0,F=g.pre||"",U=g.post||"",Y=g.caseSensitive&&d||d.toLowerCase(),ie;u=g.caseSensitive&&u||u.toLowerCase();for(var ce=0;ce<T;ce++)ie=d[ce],Y[ce]===u[v]?(ie=F+ie+U,v+=1,R+=1+R):R=0,I+=R,r[r.length]=ie;return v===u.length?(I=Y===u?1/0:I,{rendered:r.join(""),score:I}):null},a.filter=function(u,d,g){return!d||d.length===0?[]:typeof u!="string"?d:(g=g||{},d.reduce(function(v,r,T,I){var R=r;g.extract&&(R=g.extract(r));var F=a.match(u,R,g);return F!=null&&(v[v.length]={string:F.rendered,score:F.score,index:T,original:r}),v},[]).sort(function(v,r){var T=r.score-v.score;return T||v.index-r.index}))}})()})(Ix);var Z2=Ix.exports,Qn=function(o){return this.component=o,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,o.el.parentNode.insertBefore(this.wrapper,o.el.nextSibling),this};Qn.prototype.show=function(){this.element.style.display="block"};Qn.prototype.hide=function(){this.element.style.display="none"};Qn.prototype.add=function(o){this.items.push(o)};Qn.prototype.clear=function(){this.items=[],this.active=0};Qn.prototype.isEmpty=function(){return!this.items.length};Qn.prototype.isVisible=function(){return this.element.style.display==="block"};Qn.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var o=0;o<this.items.length;o++)this.drawItem(this.items[o],this.active===o);this.show()};Qn.prototype.drawItem=function(o,s){var a=document.createElement("li"),u=document.createElement("a");s&&(a.className+=" active"),u.innerHTML=o.string,a.appendChild(u),this.element.appendChild(a),a.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),a.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,o)}).bind(this))};Qn.prototype.handleMouseUp=function(o){this.selectingListItem=!1,this.component.value(o.original),this.clear(),this.draw()};Qn.prototype.move=function(o){this.active=o,this.draw()};Qn.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Qn.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Qn.prototype.drawError=function(o){var s=document.createElement("li");s.innerHTML=o,this.element.appendChild(s),this.show()};var H2=Qn,X2=ic,Y2=Z2,K2=H2,Ln=function(o,s,a){return a=a||{},this.options=X2({minLength:2,limit:5,filter:!0,hideOnBlur:!0},a),this.el=o,this.data=s||[],this.list=new K2(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(u){this.handleKeyUp(u.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(u){this.handleKeyDown(u)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(u){this.handlePaste(u)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Ln.prototype.handleKeyUp=function(o){o===40||o===38||o===27||o===13||o===9||this.handleInputChange(this.el.value)};Ln.prototype.handleKeyDown=function(o){switch(o.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&o.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Ln.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Ln.prototype.handlePaste=function(o){if(o.clipboardData)this.handleInputChange(o.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(o.target.value)},100)}};Ln.prototype.handleInputChange=function(o){if(this.query=this.normalize(o),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(s){for(var a=0;a<s.length&&(this.list.add(s[a]),a!==this.options.limit-1);a++);this.list.draw()}).bind(this))};Ln.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Ln.prototype.update=function(o){this.data=o,this.handleKeyUp()};Ln.prototype.clear=function(){this.data=[],this.list.clear()};Ln.prototype.normalize=function(o){return o=o.toLowerCase(),o};Ln.prototype.match=function(o,s){return o.indexOf(s)>-1};Ln.prototype.value=function(o){if(this.selected=o,this.el.value=this.getItemValue(o),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")};Ln.prototype.getCandidates=function(o){var s={pre:"<strong>",post:"</strong>",extract:(function(u){return this.getItemValue(u)}).bind(this)},a;this.options.filter?(a=Y2.filter(this.query,this.data,s),a=a.map((function(u){return{original:u.original,string:this.render(u.original,u.string)}}).bind(this))):a=this.data.map((function(u){var d=this.render(u);return{original:u,string:d}}).bind(this)),o(a)};Ln.prototype.getItemValue=function(o){return o};Ln.prototype.render=function(o,s){if(s)return s;for(var a=o.original?this.getItemValue(o.original):this.getItemValue(o),u=this.normalize(a),d=u.lastIndexOf(this.query);d>-1;){var g=d+this.query.length;a=a.slice(0,d)+"<strong>"+a.slice(d,g)+"</strong>"+a.slice(g),d=u.slice(0,d).lastIndexOf(this.query)}return a};Ln.prototype.renderError=function(o){this.list.drawError(o)};var J2=Ln,Px=J2,Q2=Px;typeof window<"u"&&(window.Suggestions=Px);var ew="Expected a function",W0=0/0,tw="[object Symbol]",iw=/^\s+|\s+$/g,nw=/^[-+]0x[0-9a-f]+$/i,sw=/^0b[01]+$/i,rw=/^0o[0-7]+$/i,ow=parseInt,aw=typeof Us=="object"&&Us&&Us.Object===Object&&Us,lw=typeof self=="object"&&self&&self.Object===Object&&self,cw=aw||lw||Function("return this")(),hw=Object.prototype,uw=hw.toString,dw=Math.max,pw=Math.min,c_=function(){return cw.Date.now()};function fw(o,s,a){var u,d,g,v,r,T,I=0,R=!1,F=!1,U=!0;if(typeof o!="function")throw new TypeError(ew);s=Z0(s)||0,I_(a)&&(R=!!a.leading,F="maxWait"in a,g=F?dw(Z0(a.maxWait)||0,s):g,U="trailing"in a?!!a.trailing:U);function Y(Je){var nt=u,st=d;return u=d=void 0,I=Je,v=o.apply(st,nt),v}function ie(Je){return I=Je,r=setTimeout(be,s),R?Y(Je):v}function ce(Je){var nt=Je-T,st=Je-I,Le=s-nt;return F?pw(Le,g-st):Le}function he(Je){var nt=Je-T,st=Je-I;return T===void 0||nt>=s||nt<0||F&&st>=g}function be(){var Je=c_();if(he(Je))return De(Je);r=setTimeout(be,ce(Je))}function De(Je){return r=void 0,U&&u?Y(Je):(u=d=void 0,v)}function Fe(){r!==void 0&&clearTimeout(r),I=0,u=T=d=r=void 0}function We(){return r===void 0?v:De(c_())}function Re(){var Je=c_(),nt=he(Je);if(u=arguments,d=this,T=Je,nt){if(r===void 0)return ie(T);if(F)return r=setTimeout(be,s),Y(T)}return r===void 0&&(r=setTimeout(be,s)),v}return Re.cancel=Fe,Re.flush=We,Re}function I_(o){var s=typeof o;return!!o&&(s=="object"||s=="function")}function _w(o){return!!o&&typeof o=="object"}function mw(o){return typeof o=="symbol"||_w(o)&&uw.call(o)==tw}function Z0(o){if(typeof o=="number")return o;if(mw(o))return W0;if(I_(o)){var s=typeof o.valueOf=="function"?o.valueOf():o;o=I_(s)?s+"":s}if(typeof o!="string")return o===0?o:+o;o=o.replace(iw,"");var a=sw.test(o);return a||rw.test(o)?ow(o.slice(2),a?2:8):nw.test(o)?W0:+o}var gw=fw,W_={exports:{}},Wl=typeof Reflect=="object"?Reflect:null,H0=Wl&&typeof Wl.apply=="function"?Wl.apply:function(s,a,u){return Function.prototype.apply.call(s,a,u)},ep;Wl&&typeof Wl.ownKeys=="function"?ep=Wl.ownKeys:Object.getOwnPropertySymbols?ep=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:ep=function(s){return Object.getOwnPropertyNames(s)};function yw(o){console&&console.warn&&console.warn(o)}var kx=Number.isNaN||function(s){return s!==s};function wi(){wi.init.call(this)}W_.exports=wi;W_.exports.once=ww;wi.EventEmitter=wi;wi.prototype._events=void 0;wi.prototype._eventsCount=0;wi.prototype._maxListeners=void 0;var X0=10;function bp(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}Object.defineProperty(wi,"defaultMaxListeners",{enumerable:!0,get:function(){return X0},set:function(o){if(typeof o!="number"||o<0||kx(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");X0=o}});wi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};wi.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||kx(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function Dx(o){return o._maxListeners===void 0?wi.defaultMaxListeners:o._maxListeners}wi.prototype.getMaxListeners=function(){return Dx(this)};wi.prototype.emit=function(s){for(var a=[],u=1;u<arguments.length;u++)a.push(arguments[u]);var d=s==="error",g=this._events;if(g!==void 0)d=d&&g.error===void 0;else if(!d)return!1;if(d){var v;if(a.length>0&&(v=a[0]),v instanceof Error)throw v;var r=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw r.context=v,r}var T=g[s];if(T===void 0)return!1;if(typeof T=="function")H0(T,this,a);else for(var I=T.length,R=Bx(T,I),u=0;u<I;++u)H0(R[u],this,a);return!0};function Lx(o,s,a,u){var d,g,v;if(bp(a),g=o._events,g===void 0?(g=o._events=Object.create(null),o._eventsCount=0):(g.newListener!==void 0&&(o.emit("newListener",s,a.listener?a.listener:a),g=o._events),v=g[s]),v===void 0)v=g[s]=a,++o._eventsCount;else if(typeof v=="function"?v=g[s]=u?[a,v]:[v,a]:u?v.unshift(a):v.push(a),d=Dx(o),d>0&&v.length>d&&!v.warned){v.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=o,r.type=s,r.count=v.length,yw(r)}return o}wi.prototype.addListener=function(s,a){return Lx(this,s,a,!1)};wi.prototype.on=wi.prototype.addListener;wi.prototype.prependListener=function(s,a){return Lx(this,s,a,!0)};function xw(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function zx(o,s,a){var u={fired:!1,wrapFn:void 0,target:o,type:s,listener:a},d=xw.bind(u);return d.listener=a,u.wrapFn=d,d}wi.prototype.once=function(s,a){return bp(a),this.on(s,zx(this,s,a)),this};wi.prototype.prependOnceListener=function(s,a){return bp(a),this.prependListener(s,zx(this,s,a)),this};wi.prototype.removeListener=function(s,a){var u,d,g,v,r;if(bp(a),d=this._events,d===void 0)return this;if(u=d[s],u===void 0)return this;if(u===a||u.listener===a)--this._eventsCount===0?this._events=Object.create(null):(delete d[s],d.removeListener&&this.emit("removeListener",s,u.listener||a));else if(typeof u!="function"){for(g=-1,v=u.length-1;v>=0;v--)if(u[v]===a||u[v].listener===a){r=u[v].listener,g=v;break}if(g<0)return this;g===0?u.shift():vw(u,g),u.length===1&&(d[s]=u[0]),d.removeListener!==void 0&&this.emit("removeListener",s,r||a)}return this};wi.prototype.off=wi.prototype.removeListener;wi.prototype.removeAllListeners=function(s){var a,u,d;if(u=this._events,u===void 0)return this;if(u.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):u[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete u[s]),this;if(arguments.length===0){var g=Object.keys(u),v;for(d=0;d<g.length;++d)v=g[d],v!=="removeListener"&&this.removeAllListeners(v);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(a=u[s],typeof a=="function")this.removeListener(s,a);else if(a!==void 0)for(d=a.length-1;d>=0;d--)this.removeListener(s,a[d]);return this};function Rx(o,s,a){var u=o._events;if(u===void 0)return[];var d=u[s];return d===void 0?[]:typeof d=="function"?a?[d.listener||d]:[d]:a?bw(d):Bx(d,d.length)}wi.prototype.listeners=function(s){return Rx(this,s,!0)};wi.prototype.rawListeners=function(s){return Rx(this,s,!1)};wi.listenerCount=function(o,s){return typeof o.listenerCount=="function"?o.listenerCount(s):Ox.call(o,s)};wi.prototype.listenerCount=Ox;function Ox(o){var s=this._events;if(s!==void 0){var a=s[o];if(typeof a=="function")return 1;if(a!==void 0)return a.length}return 0}wi.prototype.eventNames=function(){return this._eventsCount>0?ep(this._events):[]};function Bx(o,s){for(var a=new Array(s),u=0;u<s;++u)a[u]=o[u];return a}function vw(o,s){for(;s+1<o.length;s++)o[s]=o[s+1];o.pop()}function bw(o){for(var s=new Array(o.length),a=0;a<s.length;++a)s[a]=o[a].listener||o[a];return s}function ww(o,s){return new Promise(function(a,u){function d(v){o.removeListener(s,g),u(v)}function g(){typeof o.removeListener=="function"&&o.removeListener("error",d),a([].slice.call(arguments))}Fx(o,s,g,{once:!0}),s!=="error"&&Tw(o,d,{once:!0})})}function Tw(o,s,a){typeof o.on=="function"&&Fx(o,"error",s,a)}function Fx(o,s,a,u){if(typeof o.on=="function")u.once?o.once(s,a):o.on(s,a);else if(typeof o.addEventListener=="function")o.addEventListener(s,function d(g){u.once&&o.removeEventListener(s,d),a(g)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o)}var Ew=W_.exports,Sw={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function Mw(o){var s=o.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return s?{key:s[1],value:s[2]}:null}function Aw(o){var s=o.match(/<?([^>]*)>(.*)/);if(!s)return null;var a=s[1],u=s[2].split(";"),d=null,g=u.reduce(function(v,r){var T=Mw(r);return T?T.key==="rel"?(d||(d=T.value),v):(v[T.key]=T.value,v):v},{});return d?{url:a,rel:d,params:g}:null}function Cw(o){return o?o.split(/,\s*</).reduce(function(s,a){var u=Aw(a);if(!u)return s;var d=u.rel.split(/\s+/);return d.forEach(function(g){s[g]||(s[g]={url:u.url,params:u.params})}),s},{}):{}}var Iw=Cw,Pw=Iw;function Z_(o,s){this.request=o,this.headers=s.headers,this.rawBody=s.body,this.statusCode=s.statusCode;try{this.body=JSON.parse(s.body||"{}")}catch{this.body=s.body}this.links=Pw(this.headers.link)}Z_.prototype.hasNextPage=function(){return!!this.links.next};Z_.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var kw=Z_,wp={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},Y0=wp;function Dw(o){var s=o.type||Y0.ERROR_HTTP,a;if(o.body)try{a=JSON.parse(o.body)}catch{a=o.body}else a=null;var u=o.message||null;u||(typeof a=="string"?u=a:a&&typeof a.message=="string"?u=a.message:s===Y0.ERROR_REQUEST_ABORTED&&(u="Request aborted")),this.message=u,this.type=s,this.statusCode=o.statusCode||null,this.request=o.request,this.body=a}var Lw=Dw;function zw(o){var s=o.indexOf(":"),a=o.substring(0,s).trim().toLowerCase(),u=o.substring(s+1).trim();return{name:a,value:u}}function Rw(o){var s={};return o&&o.trim().split(/[\r|\n]+/).forEach(function(a){var u=zw(a);s[u.name]=u.value}),s}var Ow=Rw,Bw=kw,K0=Lw,h_=wp,Fw=Ow,hp={};function Nw(o){var s=hp[o.id];s&&(s.abort(),delete hp[o.id])}function jw(o,s){return new Bw(o,{body:s.response,headers:Fw(s.getAllResponseHeaders()),statusCode:s.status})}function J0(o){var s=o.total,a=o.loaded,u=100*a/s;return{total:s,transferred:a,percent:u}}function Nx(o,s){return new Promise(function(a,u){s.onprogress=function(v){o.emitter.emit(h_.EVENT_PROGRESS_DOWNLOAD,J0(v))};var d=o.file;d&&(s.upload.onprogress=function(v){o.emitter.emit(h_.EVENT_PROGRESS_UPLOAD,J0(v))}),s.onerror=function(v){u(v)},s.onabort=function(){var v=new K0({request:o,type:h_.ERROR_REQUEST_ABORTED});u(v)},s.onload=function(){if(delete hp[o.id],s.status<200||s.status>=400){var v=new K0({request:o,body:s.response,statusCode:s.status});u(v);return}a(s)};var g=o.body;typeof g=="string"?s.send(g):g?s.send(JSON.stringify(g)):d?s.send(d):s.send(),hp[o.id]=s}).then(function(a){return jw(o,a)})}function jx(o,s){var a=o.url(s),u=new window.XMLHttpRequest;return u.open(o.method,a),Object.keys(o.headers).forEach(function(d){u.setRequestHeader(d,o.headers[d])}),u}function Vw(o){return Promise.resolve().then(function(){var s=jx(o,o.client.accessToken);return Nx(o,s)})}var Uw={browserAbort:Nw,sendRequestXhr:Nx,browserSend:Vw,createRequestXhr:jx},up={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */up.exports;(function(o,s){(function(a){var u=s,d=o&&o.exports==u&&o,g=typeof Us=="object"&&Us;(g.global===g||g.window===g)&&(a=g);var v=function(ie){this.message=ie};v.prototype=new Error,v.prototype.name="InvalidCharacterError";var r=function(ie){throw new v(ie)},T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",I=/[\t\n\f\r ]/g,R=function(ie){ie=String(ie).replace(I,"");var ce=ie.length;ce%4==0&&(ie=ie.replace(/==?$/,""),ce=ie.length),(ce%4==1||/[^+a-zA-Z0-9/]/.test(ie))&&r("Invalid character: the string to be decoded is not correctly encoded.");for(var he=0,be,De,Fe="",We=-1;++We<ce;)De=T.indexOf(ie.charAt(We)),be=he%4?be*64+De:De,he++%4&&(Fe+=String.fromCharCode(255&be>>(-2*he&6)));return Fe},F=function(ie){ie=String(ie),/[^\0-\xFF]/.test(ie)&&r("The string to be encoded contains characters outside of the Latin1 range.");for(var ce=ie.length%3,he="",be=-1,De,Fe,We,Re,Je=ie.length-ce;++be<Je;)De=ie.charCodeAt(be)<<16,Fe=ie.charCodeAt(++be)<<8,We=ie.charCodeAt(++be),Re=De+Fe+We,he+=T.charAt(Re>>18&63)+T.charAt(Re>>12&63)+T.charAt(Re>>6&63)+T.charAt(Re&63);return ce==2?(De=ie.charCodeAt(be)<<8,Fe=ie.charCodeAt(++be),Re=De+Fe,he+=T.charAt(Re>>10)+T.charAt(Re>>4&63)+T.charAt(Re<<2&63)+"="):ce==1&&(Re=ie.charCodeAt(be),he+=T.charAt(Re>>2)+T.charAt(Re<<4&63)+"=="),he},U={encode:F,decode:R,version:"0.1.0"};if(u&&!u.nodeType)if(d)d.exports=U;else for(var Y in U)U.hasOwnProperty(Y)&&(u[Y]=U[Y]);else a.base64=U})(Us)})(up,up.exports);var Gw=up.exports,$w=Gw,u_={};function qw(o){if(u_[o])return u_[o];var s=o.split("."),a=s[0],u=s[1];if(!u)throw new Error("Invalid token");var d=Ww(u),g={usage:a,user:d.u};return Aa(d,"a")&&(g.authorization=d.a),Aa(d,"exp")&&(g.expires=d.exp*1e3),Aa(d,"iat")&&(g.created=d.iat*1e3),Aa(d,"scopes")&&(g.scopes=d.scopes),Aa(d,"client")&&(g.client=d.client),Aa(d,"ll")&&(g.lastLogin=d.ll),Aa(d,"iu")&&(g.impersonator=d.iu),u_[o]=g,g}function Ww(o){try{return JSON.parse($w.decode(o))}catch{throw new Error("Invalid token")}}function Aa(o,s){return Object.prototype.hasOwnProperty.call(o,s)}var Vx=qw,Ux={exports:{}};(function(o){var s=Object.prototype.hasOwnProperty,a="~";function u(){}Object.create&&(u.prototype=Object.create(null),new u().__proto__||(a=!1));function d(T,I,R){this.fn=T,this.context=I,this.once=R||!1}function g(T,I,R,F,U){if(typeof R!="function")throw new TypeError("The listener must be a function");var Y=new d(R,F||T,U),ie=a?a+I:I;return T._events[ie]?T._events[ie].fn?T._events[ie]=[T._events[ie],Y]:T._events[ie].push(Y):(T._events[ie]=Y,T._eventsCount++),T}function v(T,I){--T._eventsCount===0?T._events=new u:delete T._events[I]}function r(){this._events=new u,this._eventsCount=0}r.prototype.eventNames=function(){var I=[],R,F;if(this._eventsCount===0)return I;for(F in R=this._events)s.call(R,F)&&I.push(a?F.slice(1):F);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(R)):I},r.prototype.listeners=function(I){var R=a?a+I:I,F=this._events[R];if(!F)return[];if(F.fn)return[F.fn];for(var U=0,Y=F.length,ie=new Array(Y);U<Y;U++)ie[U]=F[U].fn;return ie},r.prototype.listenerCount=function(I){var R=a?a+I:I,F=this._events[R];return F?F.fn?1:F.length:0},r.prototype.emit=function(I,R,F,U,Y,ie){var ce=a?a+I:I;if(!this._events[ce])return!1;var he=this._events[ce],be=arguments.length,De,Fe;if(he.fn){switch(he.once&&this.removeListener(I,he.fn,void 0,!0),be){case 1:return he.fn.call(he.context),!0;case 2:return he.fn.call(he.context,R),!0;case 3:return he.fn.call(he.context,R,F),!0;case 4:return he.fn.call(he.context,R,F,U),!0;case 5:return he.fn.call(he.context,R,F,U,Y),!0;case 6:return he.fn.call(he.context,R,F,U,Y,ie),!0}for(Fe=1,De=new Array(be-1);Fe<be;Fe++)De[Fe-1]=arguments[Fe];he.fn.apply(he.context,De)}else{var We=he.length,Re;for(Fe=0;Fe<We;Fe++)switch(he[Fe].once&&this.removeListener(I,he[Fe].fn,void 0,!0),be){case 1:he[Fe].fn.call(he[Fe].context);break;case 2:he[Fe].fn.call(he[Fe].context,R);break;case 3:he[Fe].fn.call(he[Fe].context,R,F);break;case 4:he[Fe].fn.call(he[Fe].context,R,F,U);break;default:if(!De)for(Re=1,De=new Array(be-1);Re<be;Re++)De[Re-1]=arguments[Re];he[Fe].fn.apply(he[Fe].context,De)}}return!0},r.prototype.on=function(I,R,F){return g(this,I,R,F,!1)},r.prototype.once=function(I,R,F){return g(this,I,R,F,!0)},r.prototype.removeListener=function(I,R,F,U){var Y=a?a+I:I;if(!this._events[Y])return this;if(!R)return v(this,Y),this;var ie=this._events[Y];if(ie.fn)ie.fn===R&&(!U||ie.once)&&(!F||ie.context===F)&&v(this,Y);else{for(var ce=0,he=[],be=ie.length;ce<be;ce++)(ie[ce].fn!==R||U&&!ie[ce].once||F&&ie[ce].context!==F)&&he.push(ie[ce]);he.length?this._events[Y]=he.length===1?he[0]:he:v(this,Y)}return this},r.prototype.removeAllListeners=function(I){var R;return I?(R=a?a+I:I,this._events[R]&&v(this,R)):(this._events=new u,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=a,r.EventEmitter=r,o.exports=r})(Ux);var Zw=Ux.exports;function Hw(o){return o.map(encodeURIComponent).join(",")}function Gx(o){return Array.isArray(o)?Hw(o):encodeURIComponent(String(o))}function $x(o,s,a){if(a===!1||a===null)return o;var u=/\?/.test(o)?"&":"?",d=encodeURIComponent(s);return a!==void 0&&a!==""&&a!==!0&&(d+="="+Gx(a)),""+o+u+d}function Xw(o,s){if(!s)return o;var a=o;return Object.keys(s).forEach(function(u){var d=s[u];d!==void 0&&(Array.isArray(d)&&(d=d.filter(function(g){return g!=null}).join(",")),a=$x(a,u,d))}),a}function Yw(o,s){if(!s||o.slice(0,4)==="http")return o;var a=o[0]==="/"?"":"/";return""+s.replace(/\/$/,"")+a+o}function Kw(o,s){return s?o.replace(/\/:([a-zA-Z0-9]+)/g,function(a,u){var d=s[u];if(d===void 0)throw new Error("Unspecified route parameter "+u);var g=Gx(d);return"/"+g}):o}var Jw={appendQueryObject:Xw,appendQueryParam:$x,prependOrigin:Yw,interpolateRouteParams:Kw},Qw=Vx,H_=ic,eT=Zw,Fd=Jw,Q0=wp,tT=1;function Po(o,s){if(!o)throw new Error("MapiRequest requires a client");if(!s||!s.path||!s.method)throw new Error("MapiRequest requires an options object with path and method properties");var a={};s.body&&(a["content-type"]="application/json");var u=H_(a,s.headers),d=Object.keys(u).reduce(function(g,v){return g[v.toLowerCase()]=u[v],g},{});this.id=tT++,this._options=s,this.emitter=new eT,this.client=o,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=s.path,this.method=s.method,this.origin=s.origin||o.origin,this.query=s.query||{},this.params=s.params||{},this.body=s.body||null,this.file=s.file||null,this.encoding=s.encoding||"utf8",this.sendFileAs=s.sendFileAs||null,this.headers=d}Po.prototype.url=function(s){var a=Fd.prependOrigin(this.path,this.origin);a=Fd.appendQueryObject(a,this.query);var u=this.params,d=s??this.client.accessToken;if(d){a=Fd.appendQueryParam(a,"access_token",d);var g=Qw(d).user;u=H_({ownerId:g},u)}return a=Fd.interpolateRouteParams(a,u),a};Po.prototype.send=function(){var s=this;if(s.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return s.sent=!0,s.client.sendRequest(s).then(function(a){return s.response=a,s.emitter.emit(Q0.EVENT_RESPONSE,a),a},function(a){throw s.error=a,s.emitter.emit(Q0.EVENT_ERROR,a),a})};Po.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Po.prototype.eachPage=function(s){var a=this;function u(v){function r(){delete a._nextPageRequest;var T=v.nextPage();T&&(a._nextPageRequest=T,g(T))}s(null,v,r)}function d(v){s(v,null,function(){})}function g(v){v.send().then(u,d)}g(this)};Po.prototype.clone=function(){return this._extend()};Po.prototype._extend=function(s){var a=H_(this._options,s);return new Po(this.client,a)};var iT=Po,nT=Vx,sT=iT,rT=wp;function qx(o){if(!o||!o.accessToken)throw new Error("Cannot create a client without an access token");nT(o.accessToken),this.accessToken=o.accessToken,this.origin=o.origin||rT.API_ORIGIN}qx.prototype.createRequest=function(s){return new sT(this,s)};var Wx=qx,Zx=Uw,Hx=Wx;function Jl(o){Hx.call(this,o)}Jl.prototype=Object.create(Hx.prototype);Jl.prototype.constructor=Jl;Jl.prototype.sendRequest=Zx.browserSend;Jl.prototype.abortRequest=Zx.browserAbort;function oT(o){return new Jl(o)}var Xx=oT,aT=Xx,lT=aT,cT=Object.prototype.toString,hT=function(o){var s;return cT.call(o)==="[object Object]"&&(s=Object.getPrototypeOf(o),s===null||s===Object.getPrototypeOf({}))},uT=hT,dT=ic,Yx="value",d_=`
  `,Ii={};Ii.assert=function(o,s){return s=s||{},function(a){var u=ko(o,a);if(u){var d=X_(u,s);throw s.apiName&&(d=s.apiName+": "+d),new Error(d)}}};Ii.shape=function(s){var a=mT(s);return function(d){var g=ko(Ii.plainObject,d);if(g)return g;for(var v,r,T=[],I=0;I<a.length;I++)v=a[I].key,r=a[I].value,g=ko(r,d[v]),g&&T.push([v].concat(g));return T.length<2?T[0]:function(R){T=T.map(function(Y){var ie=Y[0],ce=X_(Y,R).split(`
`).join(d_);return"- "+ie+": "+ce});var F=R.path.join("."),U=F===Yx?"":" of "+F;return"The following properties"+U+" have invalid values:"+d_+T.join(d_)}}};Ii.strictShape=function(s){var a=Ii.shape(s);return function(d){var g=a(d);if(g)return g;var v=Object.keys(d).reduce(function(r,T){return s[T]===void 0&&r.push(T),r},[]);if(v.length!==0)return function(){return"The following keys are invalid: "+v.join(", ")}}};Ii.arrayOf=function(s){return Kx(s)};Ii.tuple=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return Kx(s)};function Kx(o){var s=Array.isArray(o),a=function(u){return s?o[u]:o};return function(d){var g=ko(Ii.plainArray,d);if(g)return g;if(s&&d.length!==o.length)return"an array with "+o.length+" items";for(var v=0;v<d.length;v++)if(g=ko(a(v),d[v]),g)return[v].concat(g)}}Ii.required=function(s){function a(u){return u==null?function(d){return Jx(d,Qx(d.path)?"cannot be undefined/null.":"is required.")}:s.apply(this,arguments)}return a.__required=!0,a};Ii.oneOfType=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(u){var d=s.map(function(g){return ko(g,u)}).filter(Boolean);if(d.length===s.length)return d.every(function(g){return g.length===1&&typeof g[0]=="string"})?pT(d.map(function(g){return g[0]})):d.reduce(function(g,v){return v.length>g.length?v:g})}};Ii.equal=function(s){return function(u){if(u!==s)return JSON.stringify(s)}};Ii.oneOf=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),a=s.map(function(u){return Ii.equal(u)});return Ii.oneOfType.apply(this,a)};Ii.range=function(s){var a=s[0],u=s[1];return function(g){var v=ko(Ii.number,g);if(v||g<a||g>u)return"number between "+a+" & "+u+" (inclusive)"}};Ii.any=function(){};Ii.boolean=function(s){if(typeof s!="boolean")return"boolean"};Ii.number=function(s){if(typeof s!="number")return"number"};Ii.plainArray=function(s){if(!Array.isArray(s))return"array"};Ii.plainObject=function(s){if(!uT(s))return"object"};Ii.string=function(s){if(typeof s!="string")return"string"};Ii.func=function(s){if(typeof s!="function")return"function"};function ko(o,s){if(!(s==null&&!o.hasOwnProperty("__required"))){var a=o(s);if(a)return Array.isArray(a)?a:[a]}}function X_(o,s){var a=o.length,u=o[a-1],d=o.slice(0,a-1);return d.length===0&&(d=[Yx]),s=dT(s,{path:d}),typeof u=="function"?u(s):Jx(s,fT(u))}function pT(o){return o.length<2?o[0]:o.length===2?o.join(" or "):o.slice(0,-1).join(", ")+", or "+o.slice(-1)}function fT(o){return"must be "+_T(o)+"."}function _T(o){return/^an? /.test(o)?o:/^[aeiou]/i.test(o)?"an "+o:/^[a-z]/i.test(o)?"a "+o:o}function Jx(o,s){var a=Qx(o.path),u=o.path.join(".")+" "+s,d=a?"Item at position ":"";return d+u}function Qx(o){return typeof o[o.length-1]=="number"||typeof o[0]=="number"}function mT(o){return Object.keys(o||{}).map(function(s){return{key:s,value:o[s]}})}Ii.validate=ko;Ii.processMessage=X_;var gT=Ii,yT=ic,Zl=gT;function xT(o){if(typeof window<"u")return o instanceof Us.Blob||o instanceof Us.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof o=="string"||o.pipe!==void 0))return"Filename or Readable stream"}function vT(o,s){return Zl.assert(Zl.strictShape(o),s)}function bT(o){var s="date";if(typeof o=="boolean")return s;try{var a=new Date(o);if(a.getTime&&isNaN(a.getTime()))return s}catch{return s}}function wT(o){return Zl.tuple(Zl.number,Zl.number)(o)}var TT=yT(Zl,{file:xT,date:bT,coordinates:wT,assertShape:vT});function ET(o,s){var a=function(u,d){return s.indexOf(u)!==-1&&d!==void 0};return typeof s=="function"&&(a=s),Object.keys(o).filter(function(u){return a(u,o[u])}).reduce(function(u,d){return u[d]=o[d],u},{})}var ST=ET;function MT(o,s){return Object.keys(o).reduce(function(a,u){return a[u]=s(u,o[u]),a},{})}var AT=MT,CT=AT;function IT(o){return CT(o,function(s,a){return typeof a=="boolean"?JSON.stringify(a):a})}var PT=IT,kT=Wx,DT=Xx;function LT(o){return function(s){var a;kT.prototype.isPrototypeOf(s)?a=s:a=DT(s);var u=Object.create(o);return u.client=a,u}}var zT=LT,e1=ic,Qt=TT,dp=ST,t1=PT,RT=zT,Y_={},i1=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];Y_.forwardGeocode=function(o){Qt.assertShape({query:Qt.required(Qt.string),mode:Qt.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qt.arrayOf(Qt.string),proximity:Qt.oneOf(Qt.coordinates,"ip"),types:Qt.arrayOf(Qt.oneOf(i1)),autocomplete:Qt.boolean,bbox:Qt.arrayOf(Qt.number),limit:Qt.number,language:Qt.arrayOf(Qt.string),routing:Qt.boolean,fuzzyMatch:Qt.boolean,worldview:Qt.string})(o),o.mode=o.mode||"mapbox.places";var s=t1(e1({country:o.countries},dp(o,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:dp(o,["mode","query"]),query:s})};Y_.reverseGeocode=function(o){Qt.assertShape({query:Qt.required(Qt.coordinates),mode:Qt.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qt.arrayOf(Qt.string),types:Qt.arrayOf(Qt.oneOf(i1)),bbox:Qt.arrayOf(Qt.number),limit:Qt.number,language:Qt.arrayOf(Qt.string),reverseMode:Qt.oneOf("distance","score"),routing:Qt.boolean,worldview:Qt.string})(o),o.mode=o.mode||"mapbox.places";var s=t1(e1({country:o.countries},dp(o,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:dp(o,["mode","query"]),query:s})};var OT=RT(Y_);let BT="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",n1=o=>crypto.getRandomValues(new Uint8Array(o)),s1=(o,s,a)=>{let u=(2<<Math.log(o.length-1)/Math.LN2)-1,d=-~(1.6*u*s/o.length);return(g=s)=>{let v="";for(;;){let r=a(d),T=d;for(;T--;)if(v+=o[r[T]&u]||"",v.length===g)return v}}},FT=(o,s=21)=>s1(o,s,n1),NT=(o=21)=>crypto.getRandomValues(new Uint8Array(o)).reduce((s,a)=>(a&=63,a<36?s+=a.toString(36):a<62?s+=(a-26).toString(36).toUpperCase():a>62?s+="-":s+="_",s),"");const jT=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:FT,customRandom:s1,nanoid:NT,random:n1,urlAlphabet:BT},Symbol.toStringTag,{value:"Module"})),VT=G2(jT);var UT=VT.nanoid;function r1(o){this.origin=o.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=o.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=o,this.send=this.send.bind(this),this.countries=o.countries?o.countries.split(","):null,this.types=o.types?o.types.split(","):null,this.bbox=o.bbox?o.bbox:null,this.language=o.language?o.language.split(","):null,this.limit=o.limit?+o.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(o),this.eventQueue=new Array,this.flushInterval=o.flushInterval||1e3,this.maxQueueSize=o.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}r1.prototype={select:function(o,s){var a=this.getSelectedIndex(o,s),u=this.getEventPayload("search.select",s);if(u.resultIndex=a,u.resultPlaceName=o.place_name,u.resultId=o.id,!(a===this.lastSentIndex&&u.queryString===this.lastSentInput||a==-1)&&(this.lastSentIndex=a,this.lastSentInput=u.queryString,!!u.queryString))return this.push(u)},start:function(o){var s=this.getEventPayload("search.start",o);if(s.queryString)return this.push(s)},keyevent:function(o,s){if(o.key&&!(o.metaKey||[9,27,37,39,13,38,40].indexOf(o.keyCode)!==-1)){var a=this.getEventPayload("search.keystroke",s);if(a.lastAction=o.key,!!a.queryString)return this.push(a)}},send:function(o,s){if(!this.enableEventLogging)return s?s():void 0;var a=this.getRequestOptions(o);this.request(a,(function(u){if(u)return this.handleError(u,s);if(s)return s()}).bind(this))},getRequestOptions:function(o){Array.isArray(o)||(o=[o]);var s={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};return s},getEventPayload:function(o,s){var a;s.options.proximity?typeof s.options.proximity=="object"?a=[s.options.proximity.longitude,s.options.proximity.latitude]:s.options.proximity==="ip"?a=[999,999]:a=s.options.proximity:a=null;var u=s._map?s._map.getZoom():void 0,d={event:o,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:s.options.autocomplete,fuzzyMatch:s.options.fuzzyMatch,proximity:a,limit:s.options.limit,routing:s.options.routing,worldview:s.options.worldview,mapZoom:u,keyboardLocale:this.locale};return o==="search.select"?d.queryString=s.inputString:o!="search.select"&&s._inputEl?d.queryString=s._inputEl.value:d.queryString=s.inputString,d},request:function(o,s){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(this.readyState==4)return this.status==204?s(null):s(this.statusText)},a.open(o.method,o.host+"/"+o.path,!0);for(var u in o.headers){var d=o.headers[u];a.setRequestHeader(u,d)}a.send(o.body)},handleError:function(o,s){if(s)return s(o)},generateSessionID:function(){return UT()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(o,s){if(s._typeahead){var a=s._typeahead.data,u=o.id,d=a.map(function(v){return v.id}),g=d.indexOf(u);return g}},shouldEnableLogging:function(o){return!(o.enableEventLogging===!1||o.origin&&o.origin!=="https://api.mapbox.com"||o.localGeocoder||o.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(o,s){this.eventQueue.push(o),(this.eventQueue.length>=this.maxQueueSize||s)&&this.flush()},remove:function(){this.flush()}};var GT=r1,$T={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},qT={placeholder:$T},o1={exports:{}};(function(o){(function(s,a,u){o.exports?o.exports=u():s[a]=u()})(Us,"subtag",function(){var s="",a=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function u(T){return T.match(a)||[]}function d(T){return u(T).filter(function(I,R){return I&&R})}function g(T){return T=u(T),{language:T[1]||s,extlang:T[2]||s,script:T[3]||s,region:T[4]||s}}function v(T,I,R){Object.defineProperty(T,I,{value:R,enumerable:!0})}function r(T,I,R){function F(U){return u(U)[T]||s}v(F,"pattern",I),v(g,R,F)}return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),v(g,"split",d),g})})(o1);var WT=o1.exports;function a1(){}a1.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const o={enableHighAccuracy:!0};return new Promise(function(s,a){window.navigator.geolocation.getCurrentPosition(s,a,o)})}};var ZT=a1;function HT(o,s){const a=l1(o),u=["address","street","place","country"];var d;if(typeof s=="function")return s(a);const g=u.indexOf(s);return g===-1?d=u:d=u.slice(g),d.reduce(function(v,r){return a[r]?(v!==""&&(v=v+", "),v+a[r]):v},"")}function l1(o){const s=o.address||"",a=o.text||"",u=o.place_name||"",g={address:u.split(",")[0],houseNumber:s,street:a,placeName:u};return o.context.forEach(function(v){const r=v.id.split(".")[0];g[r]=v.text}),g}const XT=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var YT={transformFeatureToGeolocationText:HT,getAddressInfo:l1,REVERSE_GEOCODE_COORD_RGX:XT},KT=Q2,JT=gw,La=ic,QT=Ew.EventEmitter,ey=Sw,p_=lT,f_=OT,eE=GT,tE=qT,iE=WT,nE=ZT,ty=YT;const Eo={FORWARD:0,LOCAL:1,REVERSE:2};function sE(){var o=document.createElement("div");return o.className="mapboxgl-ctrl-geocoder--powered-by",o.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',o}function c1(o){this._eventEmitter=new QT,this.options=La({},this.options,o),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new nE}c1.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(o){return o.place_name},render:function(o){var s=o.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+s.splice(1,s.length).join(",")+"</div></div>"}},addTo:function(o){function s(a,u){if(!document.body.contains(u))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const d=a.onAdd();u.appendChild(d)}if(o._controlContainer)o.addControl(this);else if(o instanceof HTMLElement)s(this,o);else if(typeof o=="string"){const a=document.querySelectorAll(o);if(a.length===0)throw new Error("Element ",o,"not found.");if(a.length>1)throw new Error("Geocoder can only be added to a single html element");s(this,a[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(o){if(o&&typeof o!="string"&&(this._map=o),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=f_(p_({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new eE(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var s=this.container=document.createElement("div");s.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var a=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",JT(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(I){this.eventManager.keyevent(I,this)}).bind(this));var u=document.createElement("div");u.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var d=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(d),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),u.appendChild(this._clearEl),u.appendChild(this._loadingEl),s.appendChild(a),s.appendChild(this._inputEl),s.appendChild(u),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var g=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(g),u.appendChild(this._geolocateEl),this._showGeolocateButton()}var v=this._typeahead=new KT(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),v.getItemValue=this.options.getItemValue;var r=v.list.draw,T=this._footerNode=sE();return v.list.draw=function(){r.call(this),T.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),T.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(T)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),s},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(o){this._hideLoadingIcon();const s={geometry:{type:"Point",coordinates:[o.coords.longitude,o.coords.latitude]}};this._handleMarker(s),this._fly(s),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(s),this._showClearButton(),this.fresh=!1;const a={limit:1,language:[this.options.language],query:s.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const u=s.geometry.coordinates[0]+","+s.geometry.coordinates[1];this._setInputValue(u),this._eventEmitter.emit("result",{result:s})}else this.geocoderService.reverseGeocode(a).send().then((function(u){const d=u.body.features[0];if(d){const g=ty.transformFeatureToGeolocationText(d,this.options.addressAccuracy);this._setInputValue(g),d.user_coordinates=s.geometry.coordinates,this._eventEmitter.emit("result",{result:d})}else this._eventEmitter.emit("result",{result:{user_coordinates:s.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(o){o.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(o,s){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+o),a.setAttribute("viewBox","0 0 18 18"),a.setAttribute("xml:space","preserve"),a.setAttribute("width",18),a.setAttribute("height",18),a.innerHTML=s,a},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(o){this._inputEl.value=o,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(o){var s=(o.clipboardData||window.clipboardData).getData("text");s.length>=this.options.minLength&&this._geocode(s)},_onKeyDown:function(o){var s=27,a=9;if(o.keyCode===s&&this.options.clearAndBlurOnEsc)return this._clear(o),this._inputEl.blur();var u=o.target&&o.target.shadowRoot?o.target.shadowRoot.activeElement:o.target,d=u?u.value:"";if(!d)return this.fresh=!0,o.keyCode!==a&&this.clear(o),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(o.metaKey||[a,s,37,39,13,38,40].indexOf(o.keyCode)!==-1)&&u.value.length>=this.options.minLength&&this._geocode(u.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(o){this.options.clearOnBlur&&this._clearOnBlur(o),this.options.collapsed&&this._collapse()},_onChange:function(){var o=this._typeahead.selected;o&&JSON.stringify(o)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(o),this.options.marker&&this._mapboxgl&&this._handleMarker(o),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(o),this._eventEmitter.emit("result",{result:o}),this.eventManager.select(o,this))},_fly:function(o){var s;if(o.properties&&ey[o.properties.short_code])s=La({},this.options.flyTo),this._map&&this._map.fitBounds(ey[o.properties.short_code].bbox,s);else if(o.bbox){var a=o.bbox;s=La({},this.options.flyTo),this._map&&this._map.fitBounds([[a[0],a[1]],[a[2],a[3]]],s)}else{var u={zoom:this.options.zoom};s=La({},u,this.options.flyTo),o.center?s.center=o.center:o.geometry&&o.geometry.type&&o.geometry.type==="Point"&&o.geometry.coordinates&&(s.center=o.geometry.coordinates),this._map&&this._map.flyTo(s)}},_requestType:function(o,s){var a;return o.localGeocoderOnly?a=Eo.LOCAL:o.reverseGeocode&&ty.REVERSE_GEOCODE_COORD_RGX.test(s)?a=Eo.REVERSE:a=Eo.FORWARD,a},_setupConfig:function(o,s){const a=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],u=/[\s,]+/;var d=this,g=a.reduce(function(r,T){if(d.options[T]===void 0||d.options[T]===null)return r;["countries","types","language"].indexOf(T)>-1?r[T]=d.options[T].split(u):r[T]=d.options[T];const I=typeof d.options[T].longitude=="number"&&typeof d.options[T].latitude=="number";if(T==="proximity"&&I){const R=d.options[T].longitude,F=d.options[T].latitude;r[T]=[R,F]}return r},{});switch(o){case Eo.REVERSE:{var v=s.split(u).map(function(r){return parseFloat(r,10)});d.options.flipCoordinates||v.reverse(),g.types&&g.types[0],g=La(g,{query:v,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(r){r in g&&delete g[r]})}break;case Eo.FORWARD:{const r=s.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(r)&&(s=s.replace(/,/g," ")),g=La(g,{query:s})}break}return g},_geocode:function(o){this.inputString=o,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:o});const s=this._requestType(this.options,o),a=this._setupConfig(s,o);var u;switch(s){case Eo.LOCAL:u=Promise.resolve();break;case Eo.FORWARD:u=this.geocoderService.forwardGeocode(a).send();break;case Eo.REVERSE:u=this.geocoderService.reverseGeocode(a).send();break}var d=this.options.localGeocoder?this.options.localGeocoder(o)||[]:[],g=[],v=null;return u.catch((function(r){v=r}).bind(this)).then((function(r){this._hideLoadingIcon();var T={};return r?r.statusCode=="200"&&(T=r.body,T.request=r.request,T.headers=r.headers):T={type:"FeatureCollection",features:[]},T.config=a,this.fresh&&(this.eventManager.start(this),this.fresh=!1),T.features=T.features?d.concat(T.features):d,this.options.externalGeocoder?(g=this.options.externalGeocoder(o,T.features)||Promise.resolve([]),g.then(function(I){return T.features=T.features?I.concat(T.features):I,T},function(){return T})):T}).bind(this)).then((function(r){if(v)throw v;this.options.filter&&r.features.length&&(r.features=r.features.filter(this.options.filter)),r.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",r),this._typeahead.update(r.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",r))}).bind(this)).catch((function(r){this._hideLoadingIcon(),this._hideAttribution(),d.length&&this.options.localGeocoder||g.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(d)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:d}),this._eventEmitter.emit("error",{error:r})}).bind(this)),u},_clear:function(o){o&&o.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(o){this._clear(o),this._inputEl.focus()},_clearOnBlur:function(o){var s=this;o.relatedTarget&&s._clear(o)},_onQueryResult:function(o){var s=o.body;if(s.features.length){var a=s.features[0];this._typeahead.selected=a,this._inputEl.value=a.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var o=this._map.getCenter().wrap();this.setProximity({longitude:o.lng,latitude:o.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(o){return this._geocode(o).then(this._onQueryResult),this},_renderError:function(){var o="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(o)},_renderLocationError:function(){var o="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(o)},_renderNoResults:function(){var o="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(o)},_renderUserDeniedGeolocationError:function(){var o="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(o)},_renderMessage:function(o){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(o)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var o=this.options.language.split(",")[0],s=iE.language(o),a=tE.placeholder[s];if(a)return a}return"Search"},setInput:function(o){return this._inputEl.value=o,this._typeahead.selected=null,this._typeahead.clear(),o.length>=this.options.minLength&&this._geocode(o),this},setProximity:function(o,s=!0){return this.options.proximity=o,s&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(o){return o&&typeof o=="function"&&(this._typeahead.render=o),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(o){var s=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=o||this.options.language||s,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(o){return this.options.zoom=o,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(o){return this.options.flyTo=o,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(o){return this.placeholder=o||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(o){return this.options.bbox=o,this},getCountries:function(){return this.options.countries},setCountries:function(o){return this.options.countries=o,this},getTypes:function(){return this.options.types},setTypes:function(o){return this.options.types=o,this},getMinLength:function(){return this.options.minLength},setMinLength:function(o){return this.options.minLength=o,this._typeahead&&(this._typeahead.options.minLength=o),this},getLimit:function(){return this.options.limit},setLimit:function(o){return this.options.limit=o,this._typeahead&&(this._typeahead.options.limit=o),this},getFilter:function(){return this.options.filter},setFilter:function(o){return this.options.filter=o,this},setOrigin:function(o){return this.options.origin=o,this.geocoderService=f_(p_({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(o){return this.options.accessToken=o,this.geocoderService=f_(p_({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(o){return this.options.autocomplete=o,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(o){return this.options.fuzzyMatch=o,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(o){return this.options.routing=o,this},getRouting:function(){return this.options.routing},setWorldview:function(o){return this.options.worldview=o,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(o){if(this._map){this._removeMarker();var s={color:"#4668F2"},a=La({},s,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(a),o.center?this.mapMarker.setLngLat(o.center).addTo(this._map):o.geometry&&o.geometry.type&&o.geometry.type==="Point"&&o.geometry.coordinates&&this.mapMarker.setLngLat(o.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(o,s){return this._eventEmitter.on(o,s),this},off:function(o,s){return this._eventEmitter.removeListener(o,s),this.eventManager.remove(),this}};var rE=c1;const oE=Mx(rE);/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function lu(o){return o+.5|0}const So=(o,s,a)=>Math.max(Math.min(o,a),s);function Vh(o){return So(lu(o*2.55),0,255)}function Io(o){return So(lu(o*255),0,255)}function Or(o){return So(lu(o/2.55)/100,0,1)}function iy(o){return So(lu(o*100),0,100)}const xs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},P_=[..."0123456789ABCDEF"],aE=o=>P_[o&15],lE=o=>P_[(o&240)>>4]+P_[o&15],Nd=o=>(o&240)>>4===(o&15),cE=o=>Nd(o.r)&&Nd(o.g)&&Nd(o.b)&&Nd(o.a);function hE(o){var s=o.length,a;return o[0]==="#"&&(s===4||s===5?a={r:255&xs[o[1]]*17,g:255&xs[o[2]]*17,b:255&xs[o[3]]*17,a:s===5?xs[o[4]]*17:255}:(s===7||s===9)&&(a={r:xs[o[1]]<<4|xs[o[2]],g:xs[o[3]]<<4|xs[o[4]],b:xs[o[5]]<<4|xs[o[6]],a:s===9?xs[o[7]]<<4|xs[o[8]]:255})),a}const uE=(o,s)=>o<255?s(o):"";function dE(o){var s=cE(o)?aE:lE;return o?"#"+s(o.r)+s(o.g)+s(o.b)+uE(o.a,s):void 0}const pE=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function h1(o,s,a){const u=s*Math.min(a,1-a),d=(g,v=(g+o/30)%12)=>a-u*Math.max(Math.min(v-3,9-v,1),-1);return[d(0),d(8),d(4)]}function fE(o,s,a){const u=(d,g=(d+o/60)%6)=>a-a*s*Math.max(Math.min(g,4-g,1),0);return[u(5),u(3),u(1)]}function _E(o,s,a){const u=h1(o,1,.5);let d;for(s+a>1&&(d=1/(s+a),s*=d,a*=d),d=0;d<3;d++)u[d]*=1-s-a,u[d]+=s;return u}function mE(o,s,a,u,d){return o===d?(s-a)/u+(s<a?6:0):s===d?(a-o)/u+2:(o-s)/u+4}function K_(o){const a=o.r/255,u=o.g/255,d=o.b/255,g=Math.max(a,u,d),v=Math.min(a,u,d),r=(g+v)/2;let T,I,R;return g!==v&&(R=g-v,I=r>.5?R/(2-g-v):R/(g+v),T=mE(a,u,d,R,g),T=T*60+.5),[T|0,I||0,r]}function J_(o,s,a,u){return(Array.isArray(s)?o(s[0],s[1],s[2]):o(s,a,u)).map(Io)}function Q_(o,s,a){return J_(h1,o,s,a)}function gE(o,s,a){return J_(_E,o,s,a)}function yE(o,s,a){return J_(fE,o,s,a)}function u1(o){return(o%360+360)%360}function xE(o){const s=pE.exec(o);let a=255,u;if(!s)return;s[5]!==u&&(a=s[6]?Vh(+s[5]):Io(+s[5]));const d=u1(+s[2]),g=+s[3]/100,v=+s[4]/100;return s[1]==="hwb"?u=gE(d,g,v):s[1]==="hsv"?u=yE(d,g,v):u=Q_(d,g,v),{r:u[0],g:u[1],b:u[2],a}}function vE(o,s){var a=K_(o);a[0]=u1(a[0]+s),a=Q_(a),o.r=a[0],o.g=a[1],o.b=a[2]}function bE(o){if(!o)return;const s=K_(o),a=s[0],u=iy(s[1]),d=iy(s[2]);return o.a<255?`hsla(${a}, ${u}%, ${d}%, ${Or(o.a)})`:`hsl(${a}, ${u}%, ${d}%)`}const ny={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},sy={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function wE(){const o={},s=Object.keys(sy),a=Object.keys(ny);let u,d,g,v,r;for(u=0;u<s.length;u++){for(v=r=s[u],d=0;d<a.length;d++)g=a[d],r=r.replace(g,ny[g]);g=parseInt(sy[v],16),o[r]=[g>>16&255,g>>8&255,g&255]}return o}let jd;function TE(o){jd||(jd=wE(),jd.transparent=[0,0,0,0]);const s=jd[o.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}const EE=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function SE(o){const s=EE.exec(o);let a=255,u,d,g;if(s){if(s[7]!==u){const v=+s[7];a=s[8]?Vh(v):So(v*255,0,255)}return u=+s[1],d=+s[3],g=+s[5],u=255&(s[2]?Vh(u):So(u,0,255)),d=255&(s[4]?Vh(d):So(d,0,255)),g=255&(s[6]?Vh(g):So(g,0,255)),{r:u,g:d,b:g,a}}}function ME(o){return o&&(o.a<255?`rgba(${o.r}, ${o.g}, ${o.b}, ${Or(o.a)})`:`rgb(${o.r}, ${o.g}, ${o.b})`)}const __=o=>o<=.0031308?o*12.92:Math.pow(o,1/2.4)*1.055-.055,$l=o=>o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4);function AE(o,s,a){const u=$l(Or(o.r)),d=$l(Or(o.g)),g=$l(Or(o.b));return{r:Io(__(u+a*($l(Or(s.r))-u))),g:Io(__(d+a*($l(Or(s.g))-d))),b:Io(__(g+a*($l(Or(s.b))-g))),a:o.a+a*(s.a-o.a)}}function Vd(o,s,a){if(o){let u=K_(o);u[s]=Math.max(0,Math.min(u[s]+u[s]*a,s===0?360:1)),u=Q_(u),o.r=u[0],o.g=u[1],o.b=u[2]}}function d1(o,s){return o&&Object.assign(s||{},o)}function ry(o){var s={r:0,g:0,b:0,a:255};return Array.isArray(o)?o.length>=3&&(s={r:o[0],g:o[1],b:o[2],a:255},o.length>3&&(s.a=Io(o[3]))):(s=d1(o,{r:0,g:0,b:0,a:1}),s.a=Io(s.a)),s}function CE(o){return o.charAt(0)==="r"?SE(o):xE(o)}class Qh{constructor(s){if(s instanceof Qh)return s;const a=typeof s;let u;a==="object"?u=ry(s):a==="string"&&(u=hE(s)||TE(s)||CE(s)),this._rgb=u,this._valid=!!u}get valid(){return this._valid}get rgb(){var s=d1(this._rgb);return s&&(s.a=Or(s.a)),s}set rgb(s){this._rgb=ry(s)}rgbString(){return this._valid?ME(this._rgb):void 0}hexString(){return this._valid?dE(this._rgb):void 0}hslString(){return this._valid?bE(this._rgb):void 0}mix(s,a){if(s){const u=this.rgb,d=s.rgb;let g;const v=a===g?.5:a,r=2*v-1,T=u.a-d.a,I=((r*T===-1?r:(r+T)/(1+r*T))+1)/2;g=1-I,u.r=255&I*u.r+g*d.r+.5,u.g=255&I*u.g+g*d.g+.5,u.b=255&I*u.b+g*d.b+.5,u.a=v*u.a+(1-v)*d.a,this.rgb=u}return this}interpolate(s,a){return s&&(this._rgb=AE(this._rgb,s._rgb,a)),this}clone(){return new Qh(this.rgb)}alpha(s){return this._rgb.a=Io(s),this}clearer(s){const a=this._rgb;return a.a*=1-s,this}greyscale(){const s=this._rgb,a=lu(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=a,this}opaquer(s){const a=this._rgb;return a.a*=1+s,this}negate(){const s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return Vd(this._rgb,2,s),this}darken(s){return Vd(this._rgb,2,-s),this}saturate(s){return Vd(this._rgb,1,s),this}desaturate(s){return Vd(this._rgb,1,-s),this}rotate(s){return vE(this._rgb,s),this}}/*!
 * Chart.js v4.3.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function Lr(){}const IE=(()=>{let o=0;return()=>o++})();function ei(o){return o===null||typeof o>"u"}function zi(o){if(Array.isArray&&Array.isArray(o))return!0;const s=Object.prototype.toString.call(o);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function Yt(o){return o!==null&&Object.prototype.toString.call(o)==="[object Object]"}function Yi(o){return(typeof o=="number"||o instanceof Number)&&isFinite(+o)}function os(o,s){return Yi(o)?o:s}function Vt(o,s){return typeof o>"u"?s:o}const PE=(o,s)=>typeof o=="string"&&o.endsWith("%")?parseFloat(o)/100:+o/s,p1=(o,s)=>typeof o=="string"&&o.endsWith("%")?parseFloat(o)/100*s:+o;function Ci(o,s,a){if(o&&typeof o.call=="function")return o.apply(a,s)}function gi(o,s,a,u){let d,g,v;if(zi(o))if(g=o.length,u)for(d=g-1;d>=0;d--)s.call(a,o[d],d);else for(d=0;d<g;d++)s.call(a,o[d],d);else if(Yt(o))for(v=Object.keys(o),g=v.length,d=0;d<g;d++)s.call(a,o[v[d]],v[d])}function pp(o,s){let a,u,d,g;if(!o||!s||o.length!==s.length)return!1;for(a=0,u=o.length;a<u;++a)if(d=o[a],g=s[a],d.datasetIndex!==g.datasetIndex||d.index!==g.index)return!1;return!0}function fp(o){if(zi(o))return o.map(fp);if(Yt(o)){const s=Object.create(null),a=Object.keys(o),u=a.length;let d=0;for(;d<u;++d)s[a[d]]=fp(o[a[d]]);return s}return o}function f1(o){return["__proto__","prototype","constructor"].indexOf(o)===-1}function kE(o,s,a,u){if(!f1(o))return;const d=s[o],g=a[o];Yt(d)&&Yt(g)?eu(d,g,u):s[o]=fp(g)}function eu(o,s,a){const u=zi(s)?s:[s],d=u.length;if(!Yt(o))return o;a=a||{};const g=a.merger||kE;let v;for(let r=0;r<d;++r){if(v=u[r],!Yt(v))continue;const T=Object.keys(v);for(let I=0,R=T.length;I<R;++I)g(T[I],o,v,a)}return o}function Zh(o,s){return eu(o,s,{merger:DE})}function DE(o,s,a){if(!f1(o))return;const u=s[o],d=a[o];Yt(u)&&Yt(d)?Zh(u,d):Object.prototype.hasOwnProperty.call(s,o)||(s[o]=fp(d))}const oy={"":o=>o,x:o=>o.x,y:o=>o.y};function LE(o){const s=o.split("."),a=[];let u="";for(const d of s)u+=d,u.endsWith("\\")?u=u.slice(0,-1)+".":(a.push(u),u="");return a}function zE(o){const s=LE(o);return a=>{for(const u of s){if(u==="")break;a=a&&a[u]}return a}}function Do(o,s){return(oy[s]||(oy[s]=zE(s)))(o)}function em(o){return o.charAt(0).toUpperCase()+o.slice(1)}const tu=o=>typeof o<"u",Lo=o=>typeof o=="function",ay=(o,s)=>{if(o.size!==s.size)return!1;for(const a of o)if(!s.has(a))return!1;return!0};function RE(o){return o.type==="mouseup"||o.type==="click"||o.type==="contextmenu"}const Fi=Math.PI,Ri=2*Fi,OE=Ri+Fi,_p=Number.POSITIVE_INFINITY,BE=Fi/180,Ki=Fi/2,Ca=Fi/4,ly=Fi*2/3,Mo=Math.log10,cr=Math.sign;function Hh(o,s,a){return Math.abs(o-s)<a}function cy(o){const s=Math.round(o);o=Hh(o,s,o/1e3)?s:o;const a=Math.pow(10,Math.floor(Mo(o))),u=o/a;return(u<=1?1:u<=2?2:u<=5?5:10)*a}function FE(o){const s=[],a=Math.sqrt(o);let u;for(u=1;u<a;u++)o%u===0&&(s.push(u),s.push(o/u));return a===(a|0)&&s.push(a),s.sort((d,g)=>d-g).pop(),s}function Ql(o){return!isNaN(parseFloat(o))&&isFinite(o)}function NE(o,s){const a=Math.round(o);return a-s<=o&&a+s>=o}function _1(o,s,a){let u,d,g;for(u=0,d=o.length;u<d;u++)g=o[u][a],isNaN(g)||(s.min=Math.min(s.min,g),s.max=Math.max(s.max,g))}function Gs(o){return o*(Fi/180)}function tm(o){return o*(180/Fi)}function hy(o){if(!Yi(o))return;let s=1,a=0;for(;Math.round(o*s)/s!==o;)s*=10,a++;return a}function m1(o,s){const a=s.x-o.x,u=s.y-o.y,d=Math.sqrt(a*a+u*u);let g=Math.atan2(u,a);return g<-.5*Fi&&(g+=Ri),{angle:g,distance:d}}function k_(o,s){return Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2))}function jE(o,s){return(o-s+OE)%Ri-Fi}function as(o){return(o%Ri+Ri)%Ri}function iu(o,s,a,u){const d=as(o),g=as(s),v=as(a),r=as(g-d),T=as(v-d),I=as(d-g),R=as(d-v);return d===g||d===v||u&&g===v||r>T&&I<R}function mn(o,s,a){return Math.max(s,Math.min(a,o))}function VE(o){return mn(o,-32768,32767)}function Br(o,s,a,u=1e-6){return o>=Math.min(s,a)-u&&o<=Math.max(s,a)+u}function im(o,s,a){a=a||(v=>o[v]<s);let u=o.length-1,d=0,g;for(;u-d>1;)g=d+u>>1,a(g)?d=g:u=g;return{lo:d,hi:u}}const Fr=(o,s,a,u)=>im(o,a,u?d=>{const g=o[d][s];return g<a||g===a&&o[d+1][s]===a}:d=>o[d][s]<a),UE=(o,s,a)=>im(o,a,u=>o[u][s]>=a);function GE(o,s,a){let u=0,d=o.length;for(;u<d&&o[u]<s;)u++;for(;d>u&&o[d-1]>a;)d--;return u>0||d<o.length?o.slice(u,d):o}const g1=["push","pop","shift","splice","unshift"];function $E(o,s){if(o._chartjs){o._chartjs.listeners.push(s);return}Object.defineProperty(o,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),g1.forEach(a=>{const u="_onData"+em(a),d=o[a];Object.defineProperty(o,a,{configurable:!0,enumerable:!1,value(...g){const v=d.apply(this,g);return o._chartjs.listeners.forEach(r=>{typeof r[u]=="function"&&r[u](...g)}),v}})})}function uy(o,s){const a=o._chartjs;if(!a)return;const u=a.listeners,d=u.indexOf(s);d!==-1&&u.splice(d,1),!(u.length>0)&&(g1.forEach(g=>{delete o[g]}),delete o._chartjs)}function y1(o){const s=new Set(o);return s.size===o.length?o:Array.from(s)}const x1=function(){return typeof window>"u"?function(o){return o()}:window.requestAnimationFrame}();function v1(o,s){let a=[],u=!1;return function(...d){a=d,u||(u=!0,x1.call(window,()=>{u=!1,o.apply(s,a)}))}}function qE(o,s){let a;return function(...u){return s?(clearTimeout(a),a=setTimeout(o,s,u)):o.apply(this,u),s}}const nm=o=>o==="start"?"left":o==="end"?"right":"center",Pn=(o,s,a)=>o==="start"?s:o==="end"?a:(s+a)/2,WE=(o,s,a,u)=>o===(u?"left":"right")?a:o==="center"?(s+a)/2:s;function b1(o,s,a){const u=s.length;let d=0,g=u;if(o._sorted){const{iScale:v,_parsed:r}=o,T=v.axis,{min:I,max:R,minDefined:F,maxDefined:U}=v.getUserBounds();F&&(d=mn(Math.min(Fr(r,v.axis,I).lo,a?u:Fr(s,T,v.getPixelForValue(I)).lo),0,u-1)),U?g=mn(Math.max(Fr(r,v.axis,R,!0).hi+1,a?0:Fr(s,T,v.getPixelForValue(R),!0).hi+1),d,u)-d:g=u-d}return{start:d,count:g}}function w1(o){const{xScale:s,yScale:a,_scaleRanges:u}=o,d={xmin:s.min,xmax:s.max,ymin:a.min,ymax:a.max};if(!u)return o._scaleRanges=d,!0;const g=u.xmin!==s.min||u.xmax!==s.max||u.ymin!==a.min||u.ymax!==a.max;return Object.assign(u,d),g}const Ud=o=>o===0||o===1,dy=(o,s,a)=>-(Math.pow(2,10*(o-=1))*Math.sin((o-s)*Ri/a)),py=(o,s,a)=>Math.pow(2,-10*o)*Math.sin((o-s)*Ri/a)+1,Xh={linear:o=>o,easeInQuad:o=>o*o,easeOutQuad:o=>-o*(o-2),easeInOutQuad:o=>(o/=.5)<1?.5*o*o:-.5*(--o*(o-2)-1),easeInCubic:o=>o*o*o,easeOutCubic:o=>(o-=1)*o*o+1,easeInOutCubic:o=>(o/=.5)<1?.5*o*o*o:.5*((o-=2)*o*o+2),easeInQuart:o=>o*o*o*o,easeOutQuart:o=>-((o-=1)*o*o*o-1),easeInOutQuart:o=>(o/=.5)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2),easeInQuint:o=>o*o*o*o*o,easeOutQuint:o=>(o-=1)*o*o*o*o+1,easeInOutQuint:o=>(o/=.5)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2),easeInSine:o=>-Math.cos(o*Ki)+1,easeOutSine:o=>Math.sin(o*Ki),easeInOutSine:o=>-.5*(Math.cos(Fi*o)-1),easeInExpo:o=>o===0?0:Math.pow(2,10*(o-1)),easeOutExpo:o=>o===1?1:-Math.pow(2,-10*o)+1,easeInOutExpo:o=>Ud(o)?o:o<.5?.5*Math.pow(2,10*(o*2-1)):.5*(-Math.pow(2,-10*(o*2-1))+2),easeInCirc:o=>o>=1?o:-(Math.sqrt(1-o*o)-1),easeOutCirc:o=>Math.sqrt(1-(o-=1)*o),easeInOutCirc:o=>(o/=.5)<1?-.5*(Math.sqrt(1-o*o)-1):.5*(Math.sqrt(1-(o-=2)*o)+1),easeInElastic:o=>Ud(o)?o:dy(o,.075,.3),easeOutElastic:o=>Ud(o)?o:py(o,.075,.3),easeInOutElastic(o){return Ud(o)?o:o<.5?.5*dy(o*2,.1125,.45):.5+.5*py(o*2-1,.1125,.45)},easeInBack(o){return o*o*((1.70158+1)*o-1.70158)},easeOutBack(o){return(o-=1)*o*((1.70158+1)*o+1.70158)+1},easeInOutBack(o){let s=1.70158;return(o/=.5)<1?.5*(o*o*(((s*=1.525)+1)*o-s)):.5*((o-=2)*o*(((s*=1.525)+1)*o+s)+2)},easeInBounce:o=>1-Xh.easeOutBounce(1-o),easeOutBounce(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},easeInOutBounce:o=>o<.5?Xh.easeInBounce(o*2)*.5:Xh.easeOutBounce(o*2-1)*.5+.5};function sm(o){if(o&&typeof o=="object"){const s=o.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function fy(o){return sm(o)?o:new Qh(o)}function m_(o){return sm(o)?o:new Qh(o).saturate(.5).darken(.1).hexString()}const ZE=["x","y","borderWidth","radius","tension"],HE=["color","borderColor","backgroundColor"];function XE(o){o.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),o.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:s=>s!=="onProgress"&&s!=="onComplete"&&s!=="fn"}),o.set("animations",{colors:{type:"color",properties:HE},numbers:{type:"number",properties:ZE}}),o.describe("animations",{_fallback:"animation"}),o.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:s=>s|0}}}})}function YE(o){o.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const _y=new Map;function KE(o,s){s=s||{};const a=o+JSON.stringify(s);let u=_y.get(a);return u||(u=new Intl.NumberFormat(o,s),_y.set(a,u)),u}function cu(o,s,a){return KE(s,a).format(o)}const T1={values(o){return zi(o)?o:""+o},numeric(o,s,a){if(o===0)return"0";const u=this.chart.options.locale;let d,g=o;if(a.length>1){const I=Math.max(Math.abs(a[0].value),Math.abs(a[a.length-1].value));(I<1e-4||I>1e15)&&(d="scientific"),g=JE(o,a)}const v=Mo(Math.abs(g)),r=isNaN(v)?1:Math.max(Math.min(-1*Math.floor(v),20),0),T={notation:d,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(T,this.options.ticks.format),cu(o,u,T)},logarithmic(o,s,a){if(o===0)return"0";const u=a[s].significand||o/Math.pow(10,Math.floor(Mo(o)));return[1,2,3,5,10,15].includes(u)||s>.8*a.length?T1.numeric.call(this,o,s,a):""}};function JE(o,s){let a=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(a)>=1&&o!==Math.floor(o)&&(a=o-Math.floor(o)),a}var Tp={formatters:T1};function QE(o){o.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(s,a)=>a.lineWidth,tickColor:(s,a)=>a.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Tp.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),o.route("scale.ticks","color","","color"),o.route("scale.grid","color","","borderColor"),o.route("scale.border","color","","borderColor"),o.route("scale.title","color","","color"),o.describe("scale",{_fallback:!1,_scriptable:s=>!s.startsWith("before")&&!s.startsWith("after")&&s!=="callback"&&s!=="parser",_indexable:s=>s!=="borderDash"&&s!=="tickBorderDash"&&s!=="dash"}),o.describe("scales",{_fallback:"scale"}),o.describe("scale.ticks",{_scriptable:s=>s!=="backdropPadding"&&s!=="callback",_indexable:s=>s!=="backdropPadding"})}const Na=Object.create(null),D_=Object.create(null);function Yh(o,s){if(!s)return o;const a=s.split(".");for(let u=0,d=a.length;u<d;++u){const g=a[u];o=o[g]||(o[g]=Object.create(null))}return o}function g_(o,s,a){return typeof s=="string"?eu(Yh(o,s),a):eu(Yh(o,""),s)}class e3{constructor(s,a){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=u=>u.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(u,d)=>m_(d.backgroundColor),this.hoverBorderColor=(u,d)=>m_(d.borderColor),this.hoverColor=(u,d)=>m_(d.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s),this.apply(a)}set(s,a){return g_(this,s,a)}get(s){return Yh(this,s)}describe(s,a){return g_(D_,s,a)}override(s,a){return g_(Na,s,a)}route(s,a,u,d){const g=Yh(this,s),v=Yh(this,u),r="_"+a;Object.defineProperties(g,{[r]:{value:g[a],writable:!0},[a]:{enumerable:!0,get(){const T=this[r],I=v[d];return Yt(T)?Object.assign({},I,T):Vt(T,I)},set(T){this[r]=T}}})}apply(s){s.forEach(a=>a(this))}}var Ji=new e3({_scriptable:o=>!o.startsWith("on"),_indexable:o=>o!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[XE,YE,QE]);function t3(o){return!o||ei(o.size)||ei(o.family)?null:(o.style?o.style+" ":"")+(o.weight?o.weight+" ":"")+o.size+"px "+o.family}function mp(o,s,a,u,d){let g=s[d];return g||(g=s[d]=o.measureText(d).width,a.push(d)),g>u&&(u=g),u}function i3(o,s,a,u){u=u||{};let d=u.data=u.data||{},g=u.garbageCollect=u.garbageCollect||[];u.font!==s&&(d=u.data={},g=u.garbageCollect=[],u.font=s),o.save(),o.font=s;let v=0;const r=a.length;let T,I,R,F,U;for(T=0;T<r;T++)if(F=a[T],F!=null&&!zi(F))v=mp(o,d,g,v,F);else if(zi(F))for(I=0,R=F.length;I<R;I++)U=F[I],U!=null&&!zi(U)&&(v=mp(o,d,g,v,U));o.restore();const Y=g.length/2;if(Y>a.length){for(T=0;T<Y;T++)delete d[g[T]];g.splice(0,Y)}return v}function Ia(o,s,a){const u=o.currentDevicePixelRatio,d=a!==0?Math.max(a/2,.5):0;return Math.round((s-d)*u)/u+d}function my(o,s){s=s||o.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,o.width,o.height),s.restore()}function L_(o,s,a,u){E1(o,s,a,u,null)}function E1(o,s,a,u,d){let g,v,r,T,I,R,F,U;const Y=s.pointStyle,ie=s.rotation,ce=s.radius;let he=(ie||0)*BE;if(Y&&typeof Y=="object"&&(g=Y.toString(),g==="[object HTMLImageElement]"||g==="[object HTMLCanvasElement]")){o.save(),o.translate(a,u),o.rotate(he),o.drawImage(Y,-Y.width/2,-Y.height/2,Y.width,Y.height),o.restore();return}if(!(isNaN(ce)||ce<=0)){switch(o.beginPath(),Y){default:d?o.ellipse(a,u,d/2,ce,0,0,Ri):o.arc(a,u,ce,0,Ri),o.closePath();break;case"triangle":R=d?d/2:ce,o.moveTo(a+Math.sin(he)*R,u-Math.cos(he)*ce),he+=ly,o.lineTo(a+Math.sin(he)*R,u-Math.cos(he)*ce),he+=ly,o.lineTo(a+Math.sin(he)*R,u-Math.cos(he)*ce),o.closePath();break;case"rectRounded":I=ce*.516,T=ce-I,v=Math.cos(he+Ca)*T,F=Math.cos(he+Ca)*(d?d/2-I:T),r=Math.sin(he+Ca)*T,U=Math.sin(he+Ca)*(d?d/2-I:T),o.arc(a-F,u-r,I,he-Fi,he-Ki),o.arc(a+U,u-v,I,he-Ki,he),o.arc(a+F,u+r,I,he,he+Ki),o.arc(a-U,u+v,I,he+Ki,he+Fi),o.closePath();break;case"rect":if(!ie){T=Math.SQRT1_2*ce,R=d?d/2:T,o.rect(a-R,u-T,2*R,2*T);break}he+=Ca;case"rectRot":F=Math.cos(he)*(d?d/2:ce),v=Math.cos(he)*ce,r=Math.sin(he)*ce,U=Math.sin(he)*(d?d/2:ce),o.moveTo(a-F,u-r),o.lineTo(a+U,u-v),o.lineTo(a+F,u+r),o.lineTo(a-U,u+v),o.closePath();break;case"crossRot":he+=Ca;case"cross":F=Math.cos(he)*(d?d/2:ce),v=Math.cos(he)*ce,r=Math.sin(he)*ce,U=Math.sin(he)*(d?d/2:ce),o.moveTo(a-F,u-r),o.lineTo(a+F,u+r),o.moveTo(a+U,u-v),o.lineTo(a-U,u+v);break;case"star":F=Math.cos(he)*(d?d/2:ce),v=Math.cos(he)*ce,r=Math.sin(he)*ce,U=Math.sin(he)*(d?d/2:ce),o.moveTo(a-F,u-r),o.lineTo(a+F,u+r),o.moveTo(a+U,u-v),o.lineTo(a-U,u+v),he+=Ca,F=Math.cos(he)*(d?d/2:ce),v=Math.cos(he)*ce,r=Math.sin(he)*ce,U=Math.sin(he)*(d?d/2:ce),o.moveTo(a-F,u-r),o.lineTo(a+F,u+r),o.moveTo(a+U,u-v),o.lineTo(a-U,u+v);break;case"line":v=d?d/2:Math.cos(he)*ce,r=Math.sin(he)*ce,o.moveTo(a-v,u-r),o.lineTo(a+v,u+r);break;case"dash":o.moveTo(a,u),o.lineTo(a+Math.cos(he)*(d?d/2:ce),u+Math.sin(he)*ce);break;case!1:o.closePath();break}o.fill(),s.borderWidth>0&&o.stroke()}}function Nr(o,s,a){return a=a||.5,!s||o&&o.x>s.left-a&&o.x<s.right+a&&o.y>s.top-a&&o.y<s.bottom+a}function Ep(o,s){o.save(),o.beginPath(),o.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),o.clip()}function Sp(o){o.restore()}function n3(o,s,a,u,d){if(!s)return o.lineTo(a.x,a.y);if(d==="middle"){const g=(s.x+a.x)/2;o.lineTo(g,s.y),o.lineTo(g,a.y)}else d==="after"!=!!u?o.lineTo(s.x,a.y):o.lineTo(a.x,s.y);o.lineTo(a.x,a.y)}function s3(o,s,a,u){if(!s)return o.lineTo(a.x,a.y);o.bezierCurveTo(u?s.cp1x:s.cp2x,u?s.cp1y:s.cp2y,u?a.cp2x:a.cp1x,u?a.cp2y:a.cp1y,a.x,a.y)}function r3(o,s){s.translation&&o.translate(s.translation[0],s.translation[1]),ei(s.rotation)||o.rotate(s.rotation),s.color&&(o.fillStyle=s.color),s.textAlign&&(o.textAlign=s.textAlign),s.textBaseline&&(o.textBaseline=s.textBaseline)}function o3(o,s,a,u,d){if(d.strikethrough||d.underline){const g=o.measureText(u),v=s-g.actualBoundingBoxLeft,r=s+g.actualBoundingBoxRight,T=a-g.actualBoundingBoxAscent,I=a+g.actualBoundingBoxDescent,R=d.strikethrough?(T+I)/2:I;o.strokeStyle=o.fillStyle,o.beginPath(),o.lineWidth=d.decorationWidth||2,o.moveTo(v,R),o.lineTo(r,R),o.stroke()}}function a3(o,s){const a=o.fillStyle;o.fillStyle=s.color,o.fillRect(s.left,s.top,s.width,s.height),o.fillStyle=a}function ja(o,s,a,u,d,g={}){const v=zi(s)?s:[s],r=g.strokeWidth>0&&g.strokeColor!=="";let T,I;for(o.save(),o.font=d.string,r3(o,g),T=0;T<v.length;++T)I=v[T],g.backdrop&&a3(o,g.backdrop),r&&(g.strokeColor&&(o.strokeStyle=g.strokeColor),ei(g.strokeWidth)||(o.lineWidth=g.strokeWidth),o.strokeText(I,a,u,g.maxWidth)),o.fillText(I,a,u,g.maxWidth),o3(o,a,u,I,g),u+=Number(d.lineHeight);o.restore()}function nu(o,s){const{x:a,y:u,w:d,h:g,radius:v}=s;o.arc(a+v.topLeft,u+v.topLeft,v.topLeft,-Ki,Fi,!0),o.lineTo(a,u+g-v.bottomLeft),o.arc(a+v.bottomLeft,u+g-v.bottomLeft,v.bottomLeft,Fi,Ki,!0),o.lineTo(a+d-v.bottomRight,u+g),o.arc(a+d-v.bottomRight,u+g-v.bottomRight,v.bottomRight,Ki,0,!0),o.lineTo(a+d,u+v.topRight),o.arc(a+d-v.topRight,u+v.topRight,v.topRight,0,-Ki,!0),o.lineTo(a+v.topLeft,u)}const l3=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,c3=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function h3(o,s){const a=(""+o).match(l3);if(!a||a[1]==="normal")return s*1.2;switch(o=+a[2],a[3]){case"px":return o;case"%":o/=100;break}return s*o}const u3=o=>+o||0;function rm(o,s){const a={},u=Yt(s),d=u?Object.keys(s):s,g=Yt(o)?u?v=>Vt(o[v],o[s[v]]):v=>o[v]:()=>o;for(const v of d)a[v]=u3(g(v));return a}function S1(o){return rm(o,{top:"y",right:"x",bottom:"y",left:"x"})}function Ba(o){return rm(o,["topLeft","topRight","bottomLeft","bottomRight"])}function Dn(o){const s=S1(o);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function hn(o,s){o=o||{},s=s||Ji.font;let a=Vt(o.size,s.size);typeof a=="string"&&(a=parseInt(a,10));let u=Vt(o.style,s.style);u&&!(""+u).match(c3)&&(console.warn('Invalid font style specified: "'+u+'"'),u=void 0);const d={family:Vt(o.family,s.family),lineHeight:h3(Vt(o.lineHeight,s.lineHeight),a),size:a,style:u,weight:Vt(o.weight,s.weight),string:""};return d.string=t3(d),d}function Uh(o,s,a,u){let d=!0,g,v,r;for(g=0,v=o.length;g<v;++g)if(r=o[g],r!==void 0&&(s!==void 0&&typeof r=="function"&&(r=r(s),d=!1),a!==void 0&&zi(r)&&(r=r[a%r.length],d=!1),r!==void 0))return u&&!d&&(u.cacheable=!1),r}function d3(o,s,a){const{min:u,max:d}=o,g=p1(s,(d-u)/2),v=(r,T)=>a&&r===0?0:r+T;return{min:v(u,-Math.abs(g)),max:v(d,g)}}function zo(o,s){return Object.assign(Object.create(o),s)}function om(o,s=[""],a,u,d=()=>o[0]){const g=a||o;typeof u>"u"&&(u=I1("_fallback",o));const v={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:o,_rootScopes:g,_fallback:u,_getTarget:d,override:r=>om([r,...o],s,g,u)};return new Proxy(v,{deleteProperty(r,T){return delete r[T],delete r._keys,delete o[0][T],!0},get(r,T){return A1(r,T,()=>v3(T,s,o,r))},getOwnPropertyDescriptor(r,T){return Reflect.getOwnPropertyDescriptor(r._scopes[0],T)},getPrototypeOf(){return Reflect.getPrototypeOf(o[0])},has(r,T){return yy(r).includes(T)},ownKeys(r){return yy(r)},set(r,T,I){const R=r._storage||(r._storage=d());return r[T]=R[T]=I,delete r._keys,!0}})}function ec(o,s,a,u){const d={_cacheable:!1,_proxy:o,_context:s,_subProxy:a,_stack:new Set,_descriptors:M1(o,u),setContext:g=>ec(o,g,a,u),override:g=>ec(o.override(g),s,a,u)};return new Proxy(d,{deleteProperty(g,v){return delete g[v],delete o[v],!0},get(g,v,r){return A1(g,v,()=>f3(g,v,r))},getOwnPropertyDescriptor(g,v){return g._descriptors.allKeys?Reflect.has(o,v)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(o,v)},getPrototypeOf(){return Reflect.getPrototypeOf(o)},has(g,v){return Reflect.has(o,v)},ownKeys(){return Reflect.ownKeys(o)},set(g,v,r){return o[v]=r,delete g[v],!0}})}function M1(o,s={scriptable:!0,indexable:!0}){const{_scriptable:a=s.scriptable,_indexable:u=s.indexable,_allKeys:d=s.allKeys}=o;return{allKeys:d,scriptable:a,indexable:u,isScriptable:Lo(a)?a:()=>a,isIndexable:Lo(u)?u:()=>u}}const p3=(o,s)=>o?o+em(s):s,am=(o,s)=>Yt(s)&&o!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function A1(o,s,a){if(Object.prototype.hasOwnProperty.call(o,s))return o[s];const u=a();return o[s]=u,u}function f3(o,s,a){const{_proxy:u,_context:d,_subProxy:g,_descriptors:v}=o;let r=u[s];return Lo(r)&&v.isScriptable(s)&&(r=_3(s,r,o,a)),zi(r)&&r.length&&(r=m3(s,r,o,v.isIndexable)),am(s,r)&&(r=ec(r,d,g&&g[s],v)),r}function _3(o,s,a,u){const{_proxy:d,_context:g,_subProxy:v,_stack:r}=a;if(r.has(o))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+o);r.add(o);let T=s(g,v||u);return r.delete(o),am(o,T)&&(T=lm(d._scopes,d,o,T)),T}function m3(o,s,a,u){const{_proxy:d,_context:g,_subProxy:v,_descriptors:r}=a;if(typeof g.index<"u"&&u(o))return s[g.index%s.length];if(Yt(s[0])){const T=s,I=d._scopes.filter(R=>R!==T);s=[];for(const R of T){const F=lm(I,d,o,R);s.push(ec(F,g,v&&v[o],r))}}return s}function C1(o,s,a){return Lo(o)?o(s,a):o}const g3=(o,s)=>o===!0?s:typeof o=="string"?Do(s,o):void 0;function y3(o,s,a,u,d){for(const g of s){const v=g3(a,g);if(v){o.add(v);const r=C1(v._fallback,a,d);if(typeof r<"u"&&r!==a&&r!==u)return r}else if(v===!1&&typeof u<"u"&&a!==u)return null}return!1}function lm(o,s,a,u){const d=s._rootScopes,g=C1(s._fallback,a,u),v=[...o,...d],r=new Set;r.add(u);let T=gy(r,v,a,g||a,u);return T===null||typeof g<"u"&&g!==a&&(T=gy(r,v,g,T,u),T===null)?!1:om(Array.from(r),[""],d,g,()=>x3(s,a,u))}function gy(o,s,a,u,d){for(;a;)a=y3(o,s,a,u,d);return a}function x3(o,s,a){const u=o._getTarget();s in u||(u[s]={});const d=u[s];return zi(d)&&Yt(a)?a:d||{}}function v3(o,s,a,u){let d;for(const g of s)if(d=I1(p3(g,o),a),typeof d<"u")return am(o,d)?lm(a,u,o,d):d}function I1(o,s){for(const a of s){if(!a)continue;const u=a[o];if(typeof u<"u")return u}}function yy(o){let s=o._keys;return s||(s=o._keys=b3(o._scopes)),s}function b3(o){const s=new Set;for(const a of o)for(const u of Object.keys(a).filter(d=>!d.startsWith("_")))s.add(u);return Array.from(s)}function P1(o,s,a,u){const{iScale:d}=o,{key:g="r"}=this._parsing,v=new Array(u);let r,T,I,R;for(r=0,T=u;r<T;++r)I=r+a,R=s[I],v[r]={r:d.parse(Do(R,g),I)};return v}const w3=Number.EPSILON||1e-14,tc=(o,s)=>s<o.length&&!o[s].skip&&o[s],k1=o=>o==="x"?"y":"x";function T3(o,s,a,u){const d=o.skip?s:o,g=s,v=a.skip?s:a,r=k_(g,d),T=k_(v,g);let I=r/(r+T),R=T/(r+T);I=isNaN(I)?0:I,R=isNaN(R)?0:R;const F=u*I,U=u*R;return{previous:{x:g.x-F*(v.x-d.x),y:g.y-F*(v.y-d.y)},next:{x:g.x+U*(v.x-d.x),y:g.y+U*(v.y-d.y)}}}function E3(o,s,a){const u=o.length;let d,g,v,r,T,I=tc(o,0);for(let R=0;R<u-1;++R)if(T=I,I=tc(o,R+1),!(!T||!I)){if(Hh(s[R],0,w3)){a[R]=a[R+1]=0;continue}d=a[R]/s[R],g=a[R+1]/s[R],r=Math.pow(d,2)+Math.pow(g,2),!(r<=9)&&(v=3/Math.sqrt(r),a[R]=d*v*s[R],a[R+1]=g*v*s[R])}}function S3(o,s,a="x"){const u=k1(a),d=o.length;let g,v,r,T=tc(o,0);for(let I=0;I<d;++I){if(v=r,r=T,T=tc(o,I+1),!r)continue;const R=r[a],F=r[u];v&&(g=(R-v[a])/3,r[`cp1${a}`]=R-g,r[`cp1${u}`]=F-g*s[I]),T&&(g=(T[a]-R)/3,r[`cp2${a}`]=R+g,r[`cp2${u}`]=F+g*s[I])}}function M3(o,s="x"){const a=k1(s),u=o.length,d=Array(u).fill(0),g=Array(u);let v,r,T,I=tc(o,0);for(v=0;v<u;++v)if(r=T,T=I,I=tc(o,v+1),!!T){if(I){const R=I[s]-T[s];d[v]=R!==0?(I[a]-T[a])/R:0}g[v]=r?I?cr(d[v-1])!==cr(d[v])?0:(d[v-1]+d[v])/2:d[v-1]:d[v]}E3(o,d,g),S3(o,g,s)}function Gd(o,s,a){return Math.max(Math.min(o,a),s)}function A3(o,s){let a,u,d,g,v,r=Nr(o[0],s);for(a=0,u=o.length;a<u;++a)v=g,g=r,r=a<u-1&&Nr(o[a+1],s),g&&(d=o[a],v&&(d.cp1x=Gd(d.cp1x,s.left,s.right),d.cp1y=Gd(d.cp1y,s.top,s.bottom)),r&&(d.cp2x=Gd(d.cp2x,s.left,s.right),d.cp2y=Gd(d.cp2y,s.top,s.bottom)))}function C3(o,s,a,u,d){let g,v,r,T;if(s.spanGaps&&(o=o.filter(I=>!I.skip)),s.cubicInterpolationMode==="monotone")M3(o,d);else{let I=u?o[o.length-1]:o[0];for(g=0,v=o.length;g<v;++g)r=o[g],T=T3(I,r,o[Math.min(g+1,v-(u?0:1))%v],s.tension),r.cp1x=T.previous.x,r.cp1y=T.previous.y,r.cp2x=T.next.x,r.cp2y=T.next.y,I=r}s.capBezierPoints&&A3(o,a)}function D1(){return typeof window<"u"&&typeof document<"u"}function cm(o){let s=o.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function gp(o,s,a){let u;return typeof o=="string"?(u=parseInt(o,10),o.indexOf("%")!==-1&&(u=u/100*s.parentNode[a])):u=o,u}const Mp=o=>o.ownerDocument.defaultView.getComputedStyle(o,null);function I3(o,s){return Mp(o).getPropertyValue(s)}const P3=["top","right","bottom","left"];function Fa(o,s,a){const u={};a=a?"-"+a:"";for(let d=0;d<4;d++){const g=P3[d];u[g]=parseFloat(o[s+"-"+g+a])||0}return u.width=u.left+u.right,u.height=u.top+u.bottom,u}const k3=(o,s,a)=>(o>0||s>0)&&(!a||!a.shadowRoot);function D3(o,s){const a=o.touches,u=a&&a.length?a[0]:o,{offsetX:d,offsetY:g}=u;let v=!1,r,T;if(k3(d,g,o.target))r=d,T=g;else{const I=s.getBoundingClientRect();r=u.clientX-I.left,T=u.clientY-I.top,v=!0}return{x:r,y:T,box:v}}function za(o,s){if("native"in o)return o;const{canvas:a,currentDevicePixelRatio:u}=s,d=Mp(a),g=d.boxSizing==="border-box",v=Fa(d,"padding"),r=Fa(d,"border","width"),{x:T,y:I,box:R}=D3(o,a),F=v.left+(R&&r.left),U=v.top+(R&&r.top);let{width:Y,height:ie}=s;return g&&(Y-=v.width+r.width,ie-=v.height+r.height),{x:Math.round((T-F)/Y*a.width/u),y:Math.round((I-U)/ie*a.height/u)}}function L3(o,s,a){let u,d;if(s===void 0||a===void 0){const g=cm(o);if(!g)s=o.clientWidth,a=o.clientHeight;else{const v=g.getBoundingClientRect(),r=Mp(g),T=Fa(r,"border","width"),I=Fa(r,"padding");s=v.width-I.width-T.width,a=v.height-I.height-T.height,u=gp(r.maxWidth,g,"clientWidth"),d=gp(r.maxHeight,g,"clientHeight")}}return{width:s,height:a,maxWidth:u||_p,maxHeight:d||_p}}const $d=o=>Math.round(o*10)/10;function z3(o,s,a,u){const d=Mp(o),g=Fa(d,"margin"),v=gp(d.maxWidth,o,"clientWidth")||_p,r=gp(d.maxHeight,o,"clientHeight")||_p,T=L3(o,s,a);let{width:I,height:R}=T;if(d.boxSizing==="content-box"){const U=Fa(d,"border","width"),Y=Fa(d,"padding");I-=Y.width+U.width,R-=Y.height+U.height}return I=Math.max(0,I-g.width),R=Math.max(0,u?I/u:R-g.height),I=$d(Math.min(I,v,T.maxWidth)),R=$d(Math.min(R,r,T.maxHeight)),I&&!R&&(R=$d(I/2)),(s!==void 0||a!==void 0)&&u&&T.height&&R>T.height&&(R=T.height,I=$d(Math.floor(R*u))),{width:I,height:R}}function xy(o,s,a){const u=s||1,d=Math.floor(o.height*u),g=Math.floor(o.width*u);o.height=Math.floor(o.height),o.width=Math.floor(o.width);const v=o.canvas;return v.style&&(a||!v.style.height&&!v.style.width)&&(v.style.height=`${o.height}px`,v.style.width=`${o.width}px`),o.currentDevicePixelRatio!==u||v.height!==d||v.width!==g?(o.currentDevicePixelRatio=u,v.height=d,v.width=g,o.ctx.setTransform(u,0,0,u,0,0),!0):!1}const R3=function(){let o=!1;try{const s={get passive(){return o=!0,!1}};window.addEventListener("test",null,s),window.removeEventListener("test",null,s)}catch{}return o}();function vy(o,s){const a=I3(o,s),u=a&&a.match(/^(\d+)(\.\d+)?px$/);return u?+u[1]:void 0}function Ra(o,s,a,u){return{x:o.x+a*(s.x-o.x),y:o.y+a*(s.y-o.y)}}function O3(o,s,a,u){return{x:o.x+a*(s.x-o.x),y:u==="middle"?a<.5?o.y:s.y:u==="after"?a<1?o.y:s.y:a>0?s.y:o.y}}function B3(o,s,a,u){const d={x:o.cp2x,y:o.cp2y},g={x:s.cp1x,y:s.cp1y},v=Ra(o,d,a),r=Ra(d,g,a),T=Ra(g,s,a),I=Ra(v,r,a),R=Ra(r,T,a);return Ra(I,R,a)}const F3=function(o,s){return{x(a){return o+o+s-a},setWidth(a){s=a},textAlign(a){return a==="center"?a:a==="right"?"left":"right"},xPlus(a,u){return a-u},leftForLtr(a,u){return a-u}}},N3=function(){return{x(o){return o},setWidth(o){},textAlign(o){return o},xPlus(o,s){return o+s},leftForLtr(o,s){return o}}};function Hl(o,s,a){return o?F3(s,a):N3()}function L1(o,s){let a,u;(s==="ltr"||s==="rtl")&&(a=o.canvas.style,u=[a.getPropertyValue("direction"),a.getPropertyPriority("direction")],a.setProperty("direction",s,"important"),o.prevTextDirection=u)}function z1(o,s){s!==void 0&&(delete o.prevTextDirection,o.canvas.style.setProperty("direction",s[0],s[1]))}function R1(o){return o==="angle"?{between:iu,compare:jE,normalize:as}:{between:Br,compare:(s,a)=>s-a,normalize:s=>s}}function by({start:o,end:s,count:a,loop:u,style:d}){return{start:o%a,end:s%a,loop:u&&(s-o+1)%a===0,style:d}}function j3(o,s,a){const{property:u,start:d,end:g}=a,{between:v,normalize:r}=R1(u),T=s.length;let{start:I,end:R,loop:F}=o,U,Y;if(F){for(I+=T,R+=T,U=0,Y=T;U<Y&&v(r(s[I%T][u]),d,g);++U)I--,R--;I%=T,R%=T}return R<I&&(R+=T),{start:I,end:R,loop:F,style:o.style}}function O1(o,s,a){if(!a)return[o];const{property:u,start:d,end:g}=a,v=s.length,{compare:r,between:T,normalize:I}=R1(u),{start:R,end:F,loop:U,style:Y}=j3(o,s,a),ie=[];let ce=!1,he=null,be,De,Fe;const We=()=>T(d,Fe,be)&&r(d,Fe)!==0,Re=()=>r(g,be)===0||T(g,Fe,be),Je=()=>ce||We(),nt=()=>!ce||Re();for(let st=R,Le=R;st<=F;++st)De=s[st%v],!De.skip&&(be=I(De[u]),be!==Fe&&(ce=T(be,d,g),he===null&&Je()&&(he=r(be,d)===0?st:Le),he!==null&&nt()&&(ie.push(by({start:he,end:st,loop:U,count:v,style:Y})),he=null),Le=st,Fe=be));return he!==null&&ie.push(by({start:he,end:F,loop:U,count:v,style:Y})),ie}function B1(o,s){const a=[],u=o.segments;for(let d=0;d<u.length;d++){const g=O1(u[d],o.points,s);g.length&&a.push(...g)}return a}function V3(o,s,a,u){let d=0,g=s-1;if(a&&!u)for(;d<s&&!o[d].skip;)d++;for(;d<s&&o[d].skip;)d++;for(d%=s,a&&(g+=d);g>d&&o[g%s].skip;)g--;return g%=s,{start:d,end:g}}function U3(o,s,a,u){const d=o.length,g=[];let v=s,r=o[s],T;for(T=s+1;T<=a;++T){const I=o[T%d];I.skip||I.stop?r.skip||(u=!1,g.push({start:s%d,end:(T-1)%d,loop:u}),s=v=I.stop?T:null):(v=T,r.skip&&(s=T)),r=I}return v!==null&&g.push({start:s%d,end:v%d,loop:u}),g}function G3(o,s){const a=o.points,u=o.options.spanGaps,d=a.length;if(!d)return[];const g=!!o._loop,{start:v,end:r}=V3(a,d,g,u);if(u===!0)return wy(o,[{start:v,end:r,loop:g}],a,s);const T=r<v?r+d:r,I=!!o._fullLoop&&v===0&&r===d-1;return wy(o,U3(a,v,T,I),a,s)}function wy(o,s,a,u){return!u||!u.setContext||!a?s:$3(o,s,a,u)}function $3(o,s,a,u){const d=o._chart.getContext(),g=Ty(o.options),{_datasetIndex:v,options:{spanGaps:r}}=o,T=a.length,I=[];let R=g,F=s[0].start,U=F;function Y(ie,ce,he,be){const De=r?-1:1;if(ie!==ce){for(ie+=T;a[ie%T].skip;)ie-=De;for(;a[ce%T].skip;)ce+=De;ie%T!==ce%T&&(I.push({start:ie%T,end:ce%T,loop:he,style:be}),R=be,F=ce%T)}}for(const ie of s){F=r?F:ie.start;let ce=a[F%T],he;for(U=F+1;U<=ie.end;U++){const be=a[U%T];he=Ty(u.setContext(zo(d,{type:"segment",p0:ce,p1:be,p0DataIndex:(U-1)%T,p1DataIndex:U%T,datasetIndex:v}))),q3(he,R)&&Y(F,U-1,ie.loop,R),ce=be,R=he}F<U-1&&Y(F,U-1,ie.loop,R)}return I}function Ty(o){return{backgroundColor:o.backgroundColor,borderCapStyle:o.borderCapStyle,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderJoinStyle:o.borderJoinStyle,borderWidth:o.borderWidth,borderColor:o.borderColor}}function q3(o,s){if(!s)return!1;const a=[],u=function(d,g){return sm(g)?(a.includes(g)||a.push(g),a.indexOf(g)):g};return JSON.stringify(o,u)!==JSON.stringify(s,u)}/*!
 * Chart.js v4.3.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class W3{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,a,u,d){const g=a.listeners[d],v=a.duration;g.forEach(r=>r({chart:s,initial:a.initial,numSteps:v,currentStep:Math.min(u-a.start,v)}))}_refresh(){this._request||(this._running=!0,this._request=x1.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let a=0;this._charts.forEach((u,d)=>{if(!u.running||!u.items.length)return;const g=u.items;let v=g.length-1,r=!1,T;for(;v>=0;--v)T=g[v],T._active?(T._total>u.duration&&(u.duration=T._total),T.tick(s),r=!0):(g[v]=g[g.length-1],g.pop());r&&(d.draw(),this._notify(d,u,s,"progress")),g.length||(u.running=!1,this._notify(d,u,s,"complete"),u.initial=!1),a+=g.length}),this._lastDate=s,a===0&&(this._running=!1)}_getAnims(s){const a=this._charts;let u=a.get(s);return u||(u={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},a.set(s,u)),u}listen(s,a,u){this._getAnims(s).listeners[a].push(u)}add(s,a){!a||!a.length||this._getAnims(s).items.push(...a)}has(s){return this._getAnims(s).items.length>0}start(s){const a=this._charts.get(s);a&&(a.running=!0,a.start=Date.now(),a.duration=a.items.reduce((u,d)=>Math.max(u,d._duration),0),this._refresh())}running(s){if(!this._running)return!1;const a=this._charts.get(s);return!(!a||!a.running||!a.items.length)}stop(s){const a=this._charts.get(s);if(!a||!a.items.length)return;const u=a.items;let d=u.length-1;for(;d>=0;--d)u[d].cancel();a.items=[],this._notify(s,a,Date.now(),"complete")}remove(s){return this._charts.delete(s)}}var zr=new W3;const Ey="transparent",Z3={boolean(o,s,a){return a>.5?s:o},color(o,s,a){const u=fy(o||Ey),d=u.valid&&fy(s||Ey);return d&&d.valid?d.mix(u,a).hexString():s},number(o,s,a){return o+(s-o)*a}};class H3{constructor(s,a,u,d){const g=a[u];d=Uh([s.to,d,g,s.from]);const v=Uh([s.from,g,d]);this._active=!0,this._fn=s.fn||Z3[s.type||typeof v],this._easing=Xh[s.easing]||Xh.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=a,this._prop=u,this._from=v,this._to=d,this._promises=void 0}active(){return this._active}update(s,a,u){if(this._active){this._notify(!1);const d=this._target[this._prop],g=u-this._start,v=this._duration-g;this._start=u,this._duration=Math.floor(Math.max(v,s.duration)),this._total+=g,this._loop=!!s.loop,this._to=Uh([s.to,a,d,s.from]),this._from=Uh([s.from,d,a])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){const a=s-this._start,u=this._duration,d=this._prop,g=this._from,v=this._loop,r=this._to;let T;if(this._active=g!==r&&(v||a<u),!this._active){this._target[d]=r,this._notify(!0);return}if(a<0){this._target[d]=g;return}T=a/u%2,T=v&&T>1?2-T:T,T=this._easing(Math.min(1,Math.max(0,T))),this._target[d]=this._fn(g,r,T)}wait(){const s=this._promises||(this._promises=[]);return new Promise((a,u)=>{s.push({res:a,rej:u})})}_notify(s){const a=s?"res":"rej",u=this._promises||[];for(let d=0;d<u.length;d++)u[d][a]()}}class F1{constructor(s,a){this._chart=s,this._properties=new Map,this.configure(a)}configure(s){if(!Yt(s))return;const a=Object.keys(Ji.animation),u=this._properties;Object.getOwnPropertyNames(s).forEach(d=>{const g=s[d];if(!Yt(g))return;const v={};for(const r of a)v[r]=g[r];(zi(g.properties)&&g.properties||[d]).forEach(r=>{(r===d||!u.has(r))&&u.set(r,v)})})}_animateOptions(s,a){const u=a.options,d=Y3(s,u);if(!d)return[];const g=this._createAnimations(d,u);return u.$shared&&X3(s.options.$animations,u).then(()=>{s.options=u},()=>{}),g}_createAnimations(s,a){const u=this._properties,d=[],g=s.$animations||(s.$animations={}),v=Object.keys(a),r=Date.now();let T;for(T=v.length-1;T>=0;--T){const I=v[T];if(I.charAt(0)==="$")continue;if(I==="options"){d.push(...this._animateOptions(s,a));continue}const R=a[I];let F=g[I];const U=u.get(I);if(F)if(U&&F.active()){F.update(U,R,r);continue}else F.cancel();if(!U||!U.duration){s[I]=R;continue}g[I]=F=new H3(U,s,I,R),d.push(F)}return d}update(s,a){if(this._properties.size===0){Object.assign(s,a);return}const u=this._createAnimations(s,a);if(u.length)return zr.add(this._chart,u),!0}}function X3(o,s){const a=[],u=Object.keys(s);for(let d=0;d<u.length;d++){const g=o[u[d]];g&&g.active()&&a.push(g.wait())}return Promise.all(a)}function Y3(o,s){if(!s)return;let a=o.options;if(!a){o.options=s;return}return a.$shared&&(o.options=a=Object.assign({},a,{$shared:!1,$animations:{}})),a}function Sy(o,s){const a=o&&o.options||{},u=a.reverse,d=a.min===void 0?s:0,g=a.max===void 0?s:0;return{start:u?g:d,end:u?d:g}}function K3(o,s,a){if(a===!1)return!1;const u=Sy(o,a),d=Sy(s,a);return{top:d.end,right:u.end,bottom:d.start,left:u.start}}function J3(o){let s,a,u,d;return Yt(o)?(s=o.top,a=o.right,u=o.bottom,d=o.left):s=a=u=d=o,{top:s,right:a,bottom:u,left:d,disabled:o===!1}}function N1(o,s){const a=[],u=o._getSortedDatasetMetas(s);let d,g;for(d=0,g=u.length;d<g;++d)a.push(u[d].index);return a}function My(o,s,a,u={}){const d=o.keys,g=u.mode==="single";let v,r,T,I;if(s!==null){for(v=0,r=d.length;v<r;++v){if(T=+d[v],T===a){if(u.all)continue;break}I=o.values[T],Yi(I)&&(g||s===0||cr(s)===cr(I))&&(s+=I)}return s}}function Q3(o){const s=Object.keys(o),a=new Array(s.length);let u,d,g;for(u=0,d=s.length;u<d;++u)g=s[u],a[u]={x:g,y:o[g]};return a}function Ay(o,s){const a=o&&o.options.stacked;return a||a===void 0&&s.stack!==void 0}function eS(o,s,a){return`${o.id}.${s.id}.${a.stack||a.type}`}function tS(o){const{min:s,max:a,minDefined:u,maxDefined:d}=o.getUserBounds();return{min:u?s:Number.NEGATIVE_INFINITY,max:d?a:Number.POSITIVE_INFINITY}}function iS(o,s,a){const u=o[s]||(o[s]={});return u[a]||(u[a]={})}function Cy(o,s,a,u){for(const d of s.getMatchingVisibleMetas(u).reverse()){const g=o[d.index];if(a&&g>0||!a&&g<0)return d.index}return null}function Iy(o,s){const{chart:a,_cachedMeta:u}=o,d=a._stacks||(a._stacks={}),{iScale:g,vScale:v,index:r}=u,T=g.axis,I=v.axis,R=eS(g,v,u),F=s.length;let U;for(let Y=0;Y<F;++Y){const ie=s[Y],{[T]:ce,[I]:he}=ie,be=ie._stacks||(ie._stacks={});U=be[I]=iS(d,R,ce),U[r]=he,U._top=Cy(U,v,!0,u.type),U._bottom=Cy(U,v,!1,u.type);const De=U._visualValues||(U._visualValues={});De[r]=he}}function y_(o,s){const a=o.scales;return Object.keys(a).filter(u=>a[u].axis===s).shift()}function nS(o,s){return zo(o,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function sS(o,s,a){return zo(o,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:a,index:s,mode:"default",type:"data"})}function zh(o,s){const a=o.controller.index,u=o.vScale&&o.vScale.axis;if(u){s=s||o._parsed;for(const d of s){const g=d._stacks;if(!g||g[u]===void 0||g[u][a]===void 0)return;delete g[u][a],g[u]._visualValues!==void 0&&g[u]._visualValues[a]!==void 0&&delete g[u]._visualValues[a]}}}const x_=o=>o==="reset"||o==="none",Py=(o,s)=>s?o:Object.assign({},o),rS=(o,s,a)=>o&&!s.hidden&&s._stacked&&{keys:N1(a,!0),values:null};class $s{constructor(s,a){this.chart=s,this._ctx=s.ctx,this.index=a,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const s=this._cachedMeta;this.configure(),this.linkScales(),s._stacked=Ay(s.vScale,s),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(s){this.index!==s&&zh(this._cachedMeta),this.index=s}linkScales(){const s=this.chart,a=this._cachedMeta,u=this.getDataset(),d=(F,U,Y,ie)=>F==="x"?U:F==="r"?ie:Y,g=a.xAxisID=Vt(u.xAxisID,y_(s,"x")),v=a.yAxisID=Vt(u.yAxisID,y_(s,"y")),r=a.rAxisID=Vt(u.rAxisID,y_(s,"r")),T=a.indexAxis,I=a.iAxisID=d(T,g,v,r),R=a.vAxisID=d(T,v,g,r);a.xScale=this.getScaleForId(g),a.yScale=this.getScaleForId(v),a.rScale=this.getScaleForId(r),a.iScale=this.getScaleForId(I),a.vScale=this.getScaleForId(R)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(s){return this.chart.scales[s]}_getOtherScale(s){const a=this._cachedMeta;return s===a.iScale?a.vScale:a.iScale}reset(){this._update("reset")}_destroy(){const s=this._cachedMeta;this._data&&uy(this._data,this),s._stacked&&zh(s)}_dataCheck(){const s=this.getDataset(),a=s.data||(s.data=[]),u=this._data;if(Yt(a))this._data=Q3(a);else if(u!==a){if(u){uy(u,this);const d=this._cachedMeta;zh(d),d._parsed=[]}a&&Object.isExtensible(a)&&$E(a,this),this._syncList=[],this._data=a}}addElements(){const s=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(s.dataset=new this.datasetElementType)}buildOrUpdateElements(s){const a=this._cachedMeta,u=this.getDataset();let d=!1;this._dataCheck();const g=a._stacked;a._stacked=Ay(a.vScale,a),a.stack!==u.stack&&(d=!0,zh(a),a.stack=u.stack),this._resyncElements(s),(d||g!==a._stacked)&&Iy(this,a._parsed)}configure(){const s=this.chart.config,a=s.datasetScopeKeys(this._type),u=s.getOptionScopes(this.getDataset(),a,!0);this.options=s.createResolver(u,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(s,a){const{_cachedMeta:u,_data:d}=this,{iScale:g,_stacked:v}=u,r=g.axis;let T=s===0&&a===d.length?!0:u._sorted,I=s>0&&u._parsed[s-1],R,F,U;if(this._parsing===!1)u._parsed=d,u._sorted=!0,U=d;else{zi(d[s])?U=this.parseArrayData(u,d,s,a):Yt(d[s])?U=this.parseObjectData(u,d,s,a):U=this.parsePrimitiveData(u,d,s,a);const Y=()=>F[r]===null||I&&F[r]<I[r];for(R=0;R<a;++R)u._parsed[R+s]=F=U[R],T&&(Y()&&(T=!1),I=F);u._sorted=T}v&&Iy(this,U)}parsePrimitiveData(s,a,u,d){const{iScale:g,vScale:v}=s,r=g.axis,T=v.axis,I=g.getLabels(),R=g===v,F=new Array(d);let U,Y,ie;for(U=0,Y=d;U<Y;++U)ie=U+u,F[U]={[r]:R||g.parse(I[ie],ie),[T]:v.parse(a[ie],ie)};return F}parseArrayData(s,a,u,d){const{xScale:g,yScale:v}=s,r=new Array(d);let T,I,R,F;for(T=0,I=d;T<I;++T)R=T+u,F=a[R],r[T]={x:g.parse(F[0],R),y:v.parse(F[1],R)};return r}parseObjectData(s,a,u,d){const{xScale:g,yScale:v}=s,{xAxisKey:r="x",yAxisKey:T="y"}=this._parsing,I=new Array(d);let R,F,U,Y;for(R=0,F=d;R<F;++R)U=R+u,Y=a[U],I[R]={x:g.parse(Do(Y,r),U),y:v.parse(Do(Y,T),U)};return I}getParsed(s){return this._cachedMeta._parsed[s]}getDataElement(s){return this._cachedMeta.data[s]}applyStack(s,a,u){const d=this.chart,g=this._cachedMeta,v=a[s.axis],r={keys:N1(d,!0),values:a._stacks[s.axis]._visualValues};return My(r,v,g.index,{mode:u})}updateRangeFromParsed(s,a,u,d){const g=u[a.axis];let v=g===null?NaN:g;const r=d&&u._stacks[a.axis];d&&r&&(d.values=r,v=My(d,g,this._cachedMeta.index)),s.min=Math.min(s.min,v),s.max=Math.max(s.max,v)}getMinMax(s,a){const u=this._cachedMeta,d=u._parsed,g=u._sorted&&s===u.iScale,v=d.length,r=this._getOtherScale(s),T=rS(a,u,this.chart),I={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:R,max:F}=tS(r);let U,Y;function ie(){Y=d[U];const ce=Y[r.axis];return!Yi(Y[s.axis])||R>ce||F<ce}for(U=0;U<v&&!(!ie()&&(this.updateRangeFromParsed(I,s,Y,T),g));++U);if(g){for(U=v-1;U>=0;--U)if(!ie()){this.updateRangeFromParsed(I,s,Y,T);break}}return I}getAllParsedValues(s){const a=this._cachedMeta._parsed,u=[];let d,g,v;for(d=0,g=a.length;d<g;++d)v=a[d][s.axis],Yi(v)&&u.push(v);return u}getMaxOverflow(){return!1}getLabelAndValue(s){const a=this._cachedMeta,u=a.iScale,d=a.vScale,g=this.getParsed(s);return{label:u?""+u.getLabelForValue(g[u.axis]):"",value:d?""+d.getLabelForValue(g[d.axis]):""}}_update(s){const a=this._cachedMeta;this.update(s||"default"),a._clip=J3(Vt(this.options.clip,K3(a.xScale,a.yScale,this.getMaxOverflow())))}update(s){}draw(){const s=this._ctx,a=this.chart,u=this._cachedMeta,d=u.data||[],g=a.chartArea,v=[],r=this._drawStart||0,T=this._drawCount||d.length-r,I=this.options.drawActiveElementsOnTop;let R;for(u.dataset&&u.dataset.draw(s,g,r,T),R=r;R<r+T;++R){const F=d[R];F.hidden||(F.active&&I?v.push(F):F.draw(s,g))}for(R=0;R<v.length;++R)v[R].draw(s,g)}getStyle(s,a){const u=a?"active":"default";return s===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(u):this.resolveDataElementOptions(s||0,u)}getContext(s,a,u){const d=this.getDataset();let g;if(s>=0&&s<this._cachedMeta.data.length){const v=this._cachedMeta.data[s];g=v.$context||(v.$context=sS(this.getContext(),s,v)),g.parsed=this.getParsed(s),g.raw=d.data[s],g.index=g.dataIndex=s}else g=this.$context||(this.$context=nS(this.chart.getContext(),this.index)),g.dataset=d,g.index=g.datasetIndex=this.index;return g.active=!!a,g.mode=u,g}resolveDatasetElementOptions(s){return this._resolveElementOptions(this.datasetElementType.id,s)}resolveDataElementOptions(s,a){return this._resolveElementOptions(this.dataElementType.id,a,s)}_resolveElementOptions(s,a="default",u){const d=a==="active",g=this._cachedDataOpts,v=s+"-"+a,r=g[v],T=this.enableOptionSharing&&tu(u);if(r)return Py(r,T);const I=this.chart.config,R=I.datasetElementScopeKeys(this._type,s),F=d?[`${s}Hover`,"hover",s,""]:[s,""],U=I.getOptionScopes(this.getDataset(),R),Y=Object.keys(Ji.elements[s]),ie=()=>this.getContext(u,d,a),ce=I.resolveNamedOptions(U,Y,ie,F);return ce.$shared&&(ce.$shared=T,g[v]=Object.freeze(Py(ce,T))),ce}_resolveAnimations(s,a,u){const d=this.chart,g=this._cachedDataOpts,v=`animation-${a}`,r=g[v];if(r)return r;let T;if(d.options.animation!==!1){const R=this.chart.config,F=R.datasetAnimationScopeKeys(this._type,a),U=R.getOptionScopes(this.getDataset(),F);T=R.createResolver(U,this.getContext(s,u,a))}const I=new F1(d,T&&T.animations);return T&&T._cacheable&&(g[v]=Object.freeze(I)),I}getSharedOptions(s){if(s.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},s))}includeOptions(s,a){return!a||x_(s)||this.chart._animationsDisabled}_getSharedOptions(s,a){const u=this.resolveDataElementOptions(s,a),d=this._sharedOptions,g=this.getSharedOptions(u),v=this.includeOptions(a,g)||g!==d;return this.updateSharedOptions(g,a,u),{sharedOptions:g,includeOptions:v}}updateElement(s,a,u,d){x_(d)?Object.assign(s,u):this._resolveAnimations(a,d).update(s,u)}updateSharedOptions(s,a,u){s&&!x_(a)&&this._resolveAnimations(void 0,a).update(s,u)}_setStyle(s,a,u,d){s.active=d;const g=this.getStyle(a,d);this._resolveAnimations(a,u,d).update(s,{options:!d&&this.getSharedOptions(g)||g})}removeHoverStyle(s,a,u){this._setStyle(s,u,"active",!1)}setHoverStyle(s,a,u){this._setStyle(s,u,"active",!0)}_removeDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!1)}_setDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!0)}_resyncElements(s){const a=this._data,u=this._cachedMeta.data;for(const[r,T,I]of this._syncList)this[r](T,I);this._syncList=[];const d=u.length,g=a.length,v=Math.min(g,d);v&&this.parse(0,v),g>d?this._insertElements(d,g-d,s):g<d&&this._removeElements(g,d-g)}_insertElements(s,a,u=!0){const d=this._cachedMeta,g=d.data,v=s+a;let r;const T=I=>{for(I.length+=a,r=I.length-1;r>=v;r--)I[r]=I[r-a]};for(T(g),r=s;r<v;++r)g[r]=new this.dataElementType;this._parsing&&T(d._parsed),this.parse(s,a),u&&this.updateElements(g,s,a,"reset")}updateElements(s,a,u,d){}_removeElements(s,a){const u=this._cachedMeta;if(this._parsing){const d=u._parsed.splice(s,a);u._stacked&&zh(u,d)}u.data.splice(s,a)}_sync(s){if(this._parsing)this._syncList.push(s);else{const[a,u,d]=s;this[a](u,d)}this.chart._dataChanges.push([this.index,...s])}_onDataPush(){const s=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-s,s])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(s,a){a&&this._sync(["_removeElements",s,a]);const u=arguments.length-2;u&&this._sync(["_insertElements",s,u])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ut($s,"defaults",{}),ut($s,"datasetElementType",null),ut($s,"dataElementType",null);function oS(o,s){if(!o._cache.$bar){const a=o.getMatchingVisibleMetas(s);let u=[];for(let d=0,g=a.length;d<g;d++)u=u.concat(a[d].controller.getAllParsedValues(o));o._cache.$bar=y1(u.sort((d,g)=>d-g))}return o._cache.$bar}function aS(o){const s=o.iScale,a=oS(s,o.type);let u=s._length,d,g,v,r;const T=()=>{v===32767||v===-32768||(tu(r)&&(u=Math.min(u,Math.abs(v-r)||u)),r=v)};for(d=0,g=a.length;d<g;++d)v=s.getPixelForValue(a[d]),T();for(r=void 0,d=0,g=s.ticks.length;d<g;++d)v=s.getPixelForTick(d),T();return u}function lS(o,s,a,u){const d=a.barThickness;let g,v;return ei(d)?(g=s.min*a.categoryPercentage,v=a.barPercentage):(g=d*u,v=1),{chunk:g/u,ratio:v,start:s.pixels[o]-g/2}}function cS(o,s,a,u){const d=s.pixels,g=d[o];let v=o>0?d[o-1]:null,r=o<d.length-1?d[o+1]:null;const T=a.categoryPercentage;v===null&&(v=g-(r===null?s.end-s.start:r-g)),r===null&&(r=g+g-v);const I=g-(g-Math.min(v,r))/2*T;return{chunk:Math.abs(r-v)/2*T/u,ratio:a.barPercentage,start:I}}function hS(o,s,a,u){const d=a.parse(o[0],u),g=a.parse(o[1],u),v=Math.min(d,g),r=Math.max(d,g);let T=v,I=r;Math.abs(v)>Math.abs(r)&&(T=r,I=v),s[a.axis]=I,s._custom={barStart:T,barEnd:I,start:d,end:g,min:v,max:r}}function j1(o,s,a,u){return zi(o)?hS(o,s,a,u):s[a.axis]=a.parse(o,u),s}function ky(o,s,a,u){const d=o.iScale,g=o.vScale,v=d.getLabels(),r=d===g,T=[];let I,R,F,U;for(I=a,R=a+u;I<R;++I)U=s[I],F={},F[d.axis]=r||d.parse(v[I],I),T.push(j1(U,F,g,I));return T}function v_(o){return o&&o.barStart!==void 0&&o.barEnd!==void 0}function uS(o,s,a){return o!==0?cr(o):(s.isHorizontal()?1:-1)*(s.min>=a?1:-1)}function dS(o){let s,a,u,d,g;return o.horizontal?(s=o.base>o.x,a="left",u="right"):(s=o.base<o.y,a="bottom",u="top"),s?(d="end",g="start"):(d="start",g="end"),{start:a,end:u,reverse:s,top:d,bottom:g}}function pS(o,s,a,u){let d=s.borderSkipped;const g={};if(!d){o.borderSkipped=g;return}if(d===!0){o.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:v,end:r,reverse:T,top:I,bottom:R}=dS(o);d==="middle"&&a&&(o.enableBorderRadius=!0,(a._top||0)===u?d=I:(a._bottom||0)===u?d=R:(g[Dy(R,v,r,T)]=!0,d=I)),g[Dy(d,v,r,T)]=!0,o.borderSkipped=g}function Dy(o,s,a,u){return u?(o=fS(o,s,a),o=Ly(o,a,s)):o=Ly(o,s,a),o}function fS(o,s,a){return o===s?a:o===a?s:o}function Ly(o,s,a){return o==="start"?s:o==="end"?a:o}function _S(o,{inflateAmount:s},a){o.inflateAmount=s==="auto"?a===1?.33:0:s}class tp extends $s{parsePrimitiveData(s,a,u,d){return ky(s,a,u,d)}parseArrayData(s,a,u,d){return ky(s,a,u,d)}parseObjectData(s,a,u,d){const{iScale:g,vScale:v}=s,{xAxisKey:r="x",yAxisKey:T="y"}=this._parsing,I=g.axis==="x"?r:T,R=v.axis==="x"?r:T,F=[];let U,Y,ie,ce;for(U=u,Y=u+d;U<Y;++U)ce=a[U],ie={},ie[g.axis]=g.parse(Do(ce,I),U),F.push(j1(Do(ce,R),ie,v,U));return F}updateRangeFromParsed(s,a,u,d){super.updateRangeFromParsed(s,a,u,d);const g=u._custom;g&&a===this._cachedMeta.vScale&&(s.min=Math.min(s.min,g.min),s.max=Math.max(s.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(s){const a=this._cachedMeta,{iScale:u,vScale:d}=a,g=this.getParsed(s),v=g._custom,r=v_(v)?"["+v.start+", "+v.end+"]":""+d.getLabelForValue(g[d.axis]);return{label:""+u.getLabelForValue(g[u.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const s=this._cachedMeta;s.stack=this.getDataset().stack}update(s){const a=this._cachedMeta;this.updateElements(a.data,0,a.data.length,s)}updateElements(s,a,u,d){const g=d==="reset",{index:v,_cachedMeta:{vScale:r}}=this,T=r.getBasePixel(),I=r.isHorizontal(),R=this._getRuler(),{sharedOptions:F,includeOptions:U}=this._getSharedOptions(a,d);for(let Y=a;Y<a+u;Y++){const ie=this.getParsed(Y),ce=g||ei(ie[r.axis])?{base:T,head:T}:this._calculateBarValuePixels(Y),he=this._calculateBarIndexPixels(Y,R),be=(ie._stacks||{})[r.axis],De={horizontal:I,base:ce.base,enableBorderRadius:!be||v_(ie._custom)||v===be._top||v===be._bottom,x:I?ce.head:he.center,y:I?he.center:ce.head,height:I?he.size:Math.abs(ce.size),width:I?Math.abs(ce.size):he.size};U&&(De.options=F||this.resolveDataElementOptions(Y,s[Y].active?"active":d));const Fe=De.options||s[Y].options;pS(De,Fe,be,v),_S(De,Fe,R.ratio),this.updateElement(s[Y],Y,De,d)}}_getStacks(s,a){const{iScale:u}=this._cachedMeta,d=u.getMatchingVisibleMetas(this._type).filter(T=>T.controller.options.grouped),g=u.options.stacked,v=[],r=T=>{const I=T.controller.getParsed(a),R=I&&I[T.vScale.axis];if(ei(R)||isNaN(R))return!0};for(const T of d)if(!(a!==void 0&&r(T))&&((g===!1||v.indexOf(T.stack)===-1||g===void 0&&T.stack===void 0)&&v.push(T.stack),T.index===s))break;return v.length||v.push(void 0),v}_getStackCount(s){return this._getStacks(void 0,s).length}_getStackIndex(s,a,u){const d=this._getStacks(s,u),g=a!==void 0?d.indexOf(a):-1;return g===-1?d.length-1:g}_getRuler(){const s=this.options,a=this._cachedMeta,u=a.iScale,d=[];let g,v;for(g=0,v=a.data.length;g<v;++g)d.push(u.getPixelForValue(this.getParsed(g)[u.axis],g));const r=s.barThickness;return{min:r||aS(a),pixels:d,start:u._startPixel,end:u._endPixel,stackCount:this._getStackCount(),scale:u,grouped:s.grouped,ratio:r?1:s.categoryPercentage*s.barPercentage}}_calculateBarValuePixels(s){const{_cachedMeta:{vScale:a,_stacked:u,index:d},options:{base:g,minBarLength:v}}=this,r=g||0,T=this.getParsed(s),I=T._custom,R=v_(I);let F=T[a.axis],U=0,Y=u?this.applyStack(a,T,u):F,ie,ce;Y!==F&&(U=Y-F,Y=F),R&&(F=I.barStart,Y=I.barEnd-I.barStart,F!==0&&cr(F)!==cr(I.barEnd)&&(U=0),U+=F);const he=!ei(g)&&!R?g:U;let be=a.getPixelForValue(he);if(this.chart.getDataVisibility(s)?ie=a.getPixelForValue(U+Y):ie=be,ce=ie-be,Math.abs(ce)<v){ce=uS(ce,a,r)*v,F===r&&(be-=ce/2);const De=a.getPixelForDecimal(0),Fe=a.getPixelForDecimal(1),We=Math.min(De,Fe),Re=Math.max(De,Fe);be=Math.max(Math.min(be,Re),We),ie=be+ce,u&&!R&&(T._stacks[a.axis]._visualValues[d]=a.getValueForPixel(ie)-a.getValueForPixel(be))}if(be===a.getPixelForValue(r)){const De=cr(ce)*a.getLineWidthForValue(r)/2;be+=De,ce-=De}return{size:ce,base:be,head:ie,center:ie+ce/2}}_calculateBarIndexPixels(s,a){const u=a.scale,d=this.options,g=d.skipNull,v=Vt(d.maxBarThickness,1/0);let r,T;if(a.grouped){const I=g?this._getStackCount(s):a.stackCount,R=d.barThickness==="flex"?cS(s,a,d,I):lS(s,a,d,I),F=this._getStackIndex(this.index,this._cachedMeta.stack,g?s:void 0);r=R.start+R.chunk*F+R.chunk/2,T=Math.min(v,R.chunk*R.ratio)}else r=u.getPixelForValue(this.getParsed(s)[u.axis],s),T=Math.min(v,a.min*a.ratio);return{base:r-T/2,head:r+T/2,center:r,size:T}}draw(){const s=this._cachedMeta,a=s.vScale,u=s.data,d=u.length;let g=0;for(;g<d;++g)this.getParsed(g)[a.axis]!==null&&u[g].draw(this._ctx)}}ut(tp,"id","bar"),ut(tp,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),ut(tp,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class ip extends $s{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(s,a,u,d){const g=super.parsePrimitiveData(s,a,u,d);for(let v=0;v<g.length;v++)g[v]._custom=this.resolveDataElementOptions(v+u).radius;return g}parseArrayData(s,a,u,d){const g=super.parseArrayData(s,a,u,d);for(let v=0;v<g.length;v++){const r=a[u+v];g[v]._custom=Vt(r[2],this.resolveDataElementOptions(v+u).radius)}return g}parseObjectData(s,a,u,d){const g=super.parseObjectData(s,a,u,d);for(let v=0;v<g.length;v++){const r=a[u+v];g[v]._custom=Vt(r&&r.r&&+r.r,this.resolveDataElementOptions(v+u).radius)}return g}getMaxOverflow(){const s=this._cachedMeta.data;let a=0;for(let u=s.length-1;u>=0;--u)a=Math.max(a,s[u].size(this.resolveDataElementOptions(u))/2);return a>0&&a}getLabelAndValue(s){const a=this._cachedMeta,u=this.chart.data.labels||[],{xScale:d,yScale:g}=a,v=this.getParsed(s),r=d.getLabelForValue(v.x),T=g.getLabelForValue(v.y),I=v._custom;return{label:u[s]||"",value:"("+r+", "+T+(I?", "+I:"")+")"}}update(s){const a=this._cachedMeta.data;this.updateElements(a,0,a.length,s)}updateElements(s,a,u,d){const g=d==="reset",{iScale:v,vScale:r}=this._cachedMeta,{sharedOptions:T,includeOptions:I}=this._getSharedOptions(a,d),R=v.axis,F=r.axis;for(let U=a;U<a+u;U++){const Y=s[U],ie=!g&&this.getParsed(U),ce={},he=ce[R]=g?v.getPixelForDecimal(.5):v.getPixelForValue(ie[R]),be=ce[F]=g?r.getBasePixel():r.getPixelForValue(ie[F]);ce.skip=isNaN(he)||isNaN(be),I&&(ce.options=T||this.resolveDataElementOptions(U,Y.active?"active":d),g&&(ce.options.radius=0)),this.updateElement(Y,U,ce,d)}}resolveDataElementOptions(s,a){const u=this.getParsed(s);let d=super.resolveDataElementOptions(s,a);d.$shared&&(d=Object.assign({},d,{$shared:!1}));const g=d.radius;return a!=="active"&&(d.radius=0),d.radius+=Vt(u&&u._custom,g),d}}ut(ip,"id","bubble"),ut(ip,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),ut(ip,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function mS(o,s,a){let u=1,d=1,g=0,v=0;if(s<Ri){const r=o,T=r+s,I=Math.cos(r),R=Math.sin(r),F=Math.cos(T),U=Math.sin(T),Y=(Fe,We,Re)=>iu(Fe,r,T,!0)?1:Math.max(We,We*a,Re,Re*a),ie=(Fe,We,Re)=>iu(Fe,r,T,!0)?-1:Math.min(We,We*a,Re,Re*a),ce=Y(0,I,F),he=Y(Ki,R,U),be=ie(Fi,I,F),De=ie(Fi+Ki,R,U);u=(ce-be)/2,d=(he-De)/2,g=-(ce+be)/2,v=-(he+De)/2}return{ratioX:u,ratioY:d,offsetX:g,offsetY:v}}class Oa extends $s{constructor(s,a){super(s,a),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(s,a){const u=this.getDataset().data,d=this._cachedMeta;if(this._parsing===!1)d._parsed=u;else{let g=T=>+u[T];if(Yt(u[s])){const{key:T="value"}=this._parsing;g=I=>+Do(u[I],T)}let v,r;for(v=s,r=s+a;v<r;++v)d._parsed[v]=g(v)}}_getRotation(){return Gs(this.options.rotation-90)}_getCircumference(){return Gs(this.options.circumference)}_getRotationExtents(){let s=Ri,a=-Ri;for(let u=0;u<this.chart.data.datasets.length;++u)if(this.chart.isDatasetVisible(u)&&this.chart.getDatasetMeta(u).type===this._type){const d=this.chart.getDatasetMeta(u).controller,g=d._getRotation(),v=d._getCircumference();s=Math.min(s,g),a=Math.max(a,g+v)}return{rotation:s,circumference:a-s}}update(s){const a=this.chart,{chartArea:u}=a,d=this._cachedMeta,g=d.data,v=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,r=Math.max((Math.min(u.width,u.height)-v)/2,0),T=Math.min(PE(this.options.cutout,r),1),I=this._getRingWeight(this.index),{circumference:R,rotation:F}=this._getRotationExtents(),{ratioX:U,ratioY:Y,offsetX:ie,offsetY:ce}=mS(F,R,T),he=(u.width-v)/U,be=(u.height-v)/Y,De=Math.max(Math.min(he,be)/2,0),Fe=p1(this.options.radius,De),We=Math.max(Fe*T,0),Re=(Fe-We)/this._getVisibleDatasetWeightTotal();this.offsetX=ie*Fe,this.offsetY=ce*Fe,d.total=this.calculateTotal(),this.outerRadius=Fe-Re*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Re*I,0),this.updateElements(g,0,g.length,s)}_circumference(s,a){const u=this.options,d=this._cachedMeta,g=this._getCircumference();return a&&u.animation.animateRotate||!this.chart.getDataVisibility(s)||d._parsed[s]===null||d.data[s].hidden?0:this.calculateCircumference(d._parsed[s]*g/Ri)}updateElements(s,a,u,d){const g=d==="reset",v=this.chart,r=v.chartArea,I=v.options.animation,R=(r.left+r.right)/2,F=(r.top+r.bottom)/2,U=g&&I.animateScale,Y=U?0:this.innerRadius,ie=U?0:this.outerRadius,{sharedOptions:ce,includeOptions:he}=this._getSharedOptions(a,d);let be=this._getRotation(),De;for(De=0;De<a;++De)be+=this._circumference(De,g);for(De=a;De<a+u;++De){const Fe=this._circumference(De,g),We=s[De],Re={x:R+this.offsetX,y:F+this.offsetY,startAngle:be,endAngle:be+Fe,circumference:Fe,outerRadius:ie,innerRadius:Y};he&&(Re.options=ce||this.resolveDataElementOptions(De,We.active?"active":d)),be+=Fe,this.updateElement(We,De,Re,d)}}calculateTotal(){const s=this._cachedMeta,a=s.data;let u=0,d;for(d=0;d<a.length;d++){const g=s._parsed[d];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(d)&&!a[d].hidden&&(u+=Math.abs(g))}return u}calculateCircumference(s){const a=this._cachedMeta.total;return a>0&&!isNaN(s)?Ri*(Math.abs(s)/a):0}getLabelAndValue(s){const a=this._cachedMeta,u=this.chart,d=u.data.labels||[],g=cu(a._parsed[s],u.options.locale);return{label:d[s]||"",value:g}}getMaxBorderWidth(s){let a=0;const u=this.chart;let d,g,v,r,T;if(!s){for(d=0,g=u.data.datasets.length;d<g;++d)if(u.isDatasetVisible(d)){v=u.getDatasetMeta(d),s=v.data,r=v.controller;break}}if(!s)return 0;for(d=0,g=s.length;d<g;++d)T=r.resolveDataElementOptions(d),T.borderAlign!=="inner"&&(a=Math.max(a,T.borderWidth||0,T.hoverBorderWidth||0));return a}getMaxOffset(s){let a=0;for(let u=0,d=s.length;u<d;++u){const g=this.resolveDataElementOptions(u);a=Math.max(a,g.offset||0,g.hoverOffset||0)}return a}_getRingWeightOffset(s){let a=0;for(let u=0;u<s;++u)this.chart.isDatasetVisible(u)&&(a+=this._getRingWeight(u));return a}_getRingWeight(s){return Math.max(Vt(this.chart.data.datasets[s].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}ut(Oa,"id","doughnut"),ut(Oa,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),ut(Oa,"descriptors",{_scriptable:s=>s!=="spacing",_indexable:s=>s!=="spacing"&&!s.startsWith("borderDash")&&!s.startsWith("hoverBorderDash")}),ut(Oa,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(s){const a=s.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:u,color:d}}=s.legend.options;return a.labels.map((g,v)=>{const T=s.getDatasetMeta(0).controller.getStyle(v);return{text:g,fillStyle:T.backgroundColor,strokeStyle:T.borderColor,fontColor:d,lineWidth:T.borderWidth,pointStyle:u,hidden:!s.getDataVisibility(v),index:v}})}return[]}},onClick(s,a,u){u.chart.toggleDataVisibility(a.index),u.chart.update()}}}});class np extends $s{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(s){const a=this._cachedMeta,{dataset:u,data:d=[],_dataset:g}=a,v=this.chart._animationsDisabled;let{start:r,count:T}=b1(a,d,v);this._drawStart=r,this._drawCount=T,w1(a)&&(r=0,T=d.length),u._chart=this.chart,u._datasetIndex=this.index,u._decimated=!!g._decimated,u.points=d;const I=this.resolveDatasetElementOptions(s);this.options.showLine||(I.borderWidth=0),I.segment=this.options.segment,this.updateElement(u,void 0,{animated:!v,options:I},s),this.updateElements(d,r,T,s)}updateElements(s,a,u,d){const g=d==="reset",{iScale:v,vScale:r,_stacked:T,_dataset:I}=this._cachedMeta,{sharedOptions:R,includeOptions:F}=this._getSharedOptions(a,d),U=v.axis,Y=r.axis,{spanGaps:ie,segment:ce}=this.options,he=Ql(ie)?ie:Number.POSITIVE_INFINITY,be=this.chart._animationsDisabled||g||d==="none",De=a+u,Fe=s.length;let We=a>0&&this.getParsed(a-1);for(let Re=0;Re<Fe;++Re){const Je=s[Re],nt=be?Je:{};if(Re<a||Re>=De){nt.skip=!0;continue}const st=this.getParsed(Re),Le=ei(st[Y]),Lt=nt[U]=v.getPixelForValue(st[U],Re),zt=nt[Y]=g||Le?r.getBasePixel():r.getPixelForValue(T?this.applyStack(r,st,T):st[Y],Re);nt.skip=isNaN(Lt)||isNaN(zt)||Le,nt.stop=Re>0&&Math.abs(st[U]-We[U])>he,ce&&(nt.parsed=st,nt.raw=I.data[Re]),F&&(nt.options=R||this.resolveDataElementOptions(Re,Je.active?"active":d)),be||this.updateElement(Je,Re,nt,d),We=st}}getMaxOverflow(){const s=this._cachedMeta,a=s.dataset,u=a.options&&a.options.borderWidth||0,d=s.data||[];if(!d.length)return u;const g=d[0].size(this.resolveDataElementOptions(0)),v=d[d.length-1].size(this.resolveDataElementOptions(d.length-1));return Math.max(u,g,v)/2}draw(){const s=this._cachedMeta;s.dataset.updateControlPoints(this.chart.chartArea,s.iScale.axis),super.draw()}}ut(np,"id","line"),ut(np,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),ut(np,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Kh extends $s{constructor(s,a){super(s,a),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(s){const a=this._cachedMeta,u=this.chart,d=u.data.labels||[],g=cu(a._parsed[s].r,u.options.locale);return{label:d[s]||"",value:g}}parseObjectData(s,a,u,d){return P1.bind(this)(s,a,u,d)}update(s){const a=this._cachedMeta.data;this._updateRadius(),this.updateElements(a,0,a.length,s)}getMinMax(){const s=this._cachedMeta,a={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return s.data.forEach((u,d)=>{const g=this.getParsed(d).r;!isNaN(g)&&this.chart.getDataVisibility(d)&&(g<a.min&&(a.min=g),g>a.max&&(a.max=g))}),a}_updateRadius(){const s=this.chart,a=s.chartArea,u=s.options,d=Math.min(a.right-a.left,a.bottom-a.top),g=Math.max(d/2,0),v=Math.max(u.cutoutPercentage?g/100*u.cutoutPercentage:1,0),r=(g-v)/s.getVisibleDatasetCount();this.outerRadius=g-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(s,a,u,d){const g=d==="reset",v=this.chart,T=v.options.animation,I=this._cachedMeta.rScale,R=I.xCenter,F=I.yCenter,U=I.getIndexAngle(0)-.5*Fi;let Y=U,ie;const ce=360/this.countVisibleElements();for(ie=0;ie<a;++ie)Y+=this._computeAngle(ie,d,ce);for(ie=a;ie<a+u;ie++){const he=s[ie];let be=Y,De=Y+this._computeAngle(ie,d,ce),Fe=v.getDataVisibility(ie)?I.getDistanceFromCenterForValue(this.getParsed(ie).r):0;Y=De,g&&(T.animateScale&&(Fe=0),T.animateRotate&&(be=De=U));const We={x:R,y:F,innerRadius:0,outerRadius:Fe,startAngle:be,endAngle:De,options:this.resolveDataElementOptions(ie,he.active?"active":d)};this.updateElement(he,ie,We,d)}}countVisibleElements(){const s=this._cachedMeta;let a=0;return s.data.forEach((u,d)=>{!isNaN(this.getParsed(d).r)&&this.chart.getDataVisibility(d)&&a++}),a}_computeAngle(s,a,u){return this.chart.getDataVisibility(s)?Gs(this.resolveDataElementOptions(s,a).angle||u):0}}ut(Kh,"id","polarArea"),ut(Kh,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),ut(Kh,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(s){const a=s.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:u,color:d}}=s.legend.options;return a.labels.map((g,v)=>{const T=s.getDatasetMeta(0).controller.getStyle(v);return{text:g,fillStyle:T.backgroundColor,strokeStyle:T.borderColor,fontColor:d,lineWidth:T.borderWidth,pointStyle:u,hidden:!s.getDataVisibility(v),index:v}})}return[]}},onClick(s,a,u){u.chart.toggleDataVisibility(a.index),u.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class z_ extends Oa{}ut(z_,"id","pie"),ut(z_,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class sp extends $s{getLabelAndValue(s){const a=this._cachedMeta.vScale,u=this.getParsed(s);return{label:a.getLabels()[s],value:""+a.getLabelForValue(u[a.axis])}}parseObjectData(s,a,u,d){return P1.bind(this)(s,a,u,d)}update(s){const a=this._cachedMeta,u=a.dataset,d=a.data||[],g=a.iScale.getLabels();if(u.points=d,s!=="resize"){const v=this.resolveDatasetElementOptions(s);this.options.showLine||(v.borderWidth=0);const r={_loop:!0,_fullLoop:g.length===d.length,options:v};this.updateElement(u,void 0,r,s)}this.updateElements(d,0,d.length,s)}updateElements(s,a,u,d){const g=this._cachedMeta.rScale,v=d==="reset";for(let r=a;r<a+u;r++){const T=s[r],I=this.resolveDataElementOptions(r,T.active?"active":d),R=g.getPointPositionForValue(r,this.getParsed(r).r),F=v?g.xCenter:R.x,U=v?g.yCenter:R.y,Y={x:F,y:U,angle:R.angle,skip:isNaN(F)||isNaN(U),options:I};this.updateElement(T,r,Y,d)}}}ut(sp,"id","radar"),ut(sp,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),ut(sp,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class rp extends $s{getLabelAndValue(s){const a=this._cachedMeta,u=this.chart.data.labels||[],{xScale:d,yScale:g}=a,v=this.getParsed(s),r=d.getLabelForValue(v.x),T=g.getLabelForValue(v.y);return{label:u[s]||"",value:"("+r+", "+T+")"}}update(s){const a=this._cachedMeta,{data:u=[]}=a,d=this.chart._animationsDisabled;let{start:g,count:v}=b1(a,u,d);if(this._drawStart=g,this._drawCount=v,w1(a)&&(g=0,v=u.length),this.options.showLine){const{dataset:r,_dataset:T}=a;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!T._decimated,r.points=u;const I=this.resolveDatasetElementOptions(s);I.segment=this.options.segment,this.updateElement(r,void 0,{animated:!d,options:I},s)}this.updateElements(u,g,v,s)}addElements(){const{showLine:s}=this.options;!this.datasetElementType&&s&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(s,a,u,d){const g=d==="reset",{iScale:v,vScale:r,_stacked:T,_dataset:I}=this._cachedMeta,R=this.resolveDataElementOptions(a,d),F=this.getSharedOptions(R),U=this.includeOptions(d,F),Y=v.axis,ie=r.axis,{spanGaps:ce,segment:he}=this.options,be=Ql(ce)?ce:Number.POSITIVE_INFINITY,De=this.chart._animationsDisabled||g||d==="none";let Fe=a>0&&this.getParsed(a-1);for(let We=a;We<a+u;++We){const Re=s[We],Je=this.getParsed(We),nt=De?Re:{},st=ei(Je[ie]),Le=nt[Y]=v.getPixelForValue(Je[Y],We),Lt=nt[ie]=g||st?r.getBasePixel():r.getPixelForValue(T?this.applyStack(r,Je,T):Je[ie],We);nt.skip=isNaN(Le)||isNaN(Lt)||st,nt.stop=We>0&&Math.abs(Je[Y]-Fe[Y])>be,he&&(nt.parsed=Je,nt.raw=I.data[We]),U&&(nt.options=F||this.resolveDataElementOptions(We,Re.active?"active":d)),De||this.updateElement(Re,We,nt,d),Fe=Je}this.updateSharedOptions(F,d,R)}getMaxOverflow(){const s=this._cachedMeta,a=s.data||[];if(!this.options.showLine){let r=0;for(let T=a.length-1;T>=0;--T)r=Math.max(r,a[T].size(this.resolveDataElementOptions(T))/2);return r>0&&r}const u=s.dataset,d=u.options&&u.options.borderWidth||0;if(!a.length)return d;const g=a[0].size(this.resolveDataElementOptions(0)),v=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(d,g,v)/2}}ut(rp,"id","scatter"),ut(rp,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),ut(rp,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var gS=Object.freeze({__proto__:null,BarController:tp,BubbleController:ip,DoughnutController:Oa,LineController:np,PieController:z_,PolarAreaController:Kh,RadarController:sp,ScatterController:rp});function Pa(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class hm{constructor(s){ut(this,"options");this.options=s||{}}static override(s){Object.assign(hm.prototype,s)}init(){}formats(){return Pa()}parse(){return Pa()}format(){return Pa()}add(){return Pa()}diff(){return Pa()}startOf(){return Pa()}endOf(){return Pa()}}var yS={_date:hm};function xS(o,s,a,u){const{controller:d,data:g,_sorted:v}=o,r=d._cachedMeta.iScale;if(r&&s===r.axis&&s!=="r"&&v&&g.length){const T=r._reversePixels?UE:Fr;if(u){if(d._sharedOptions){const I=g[0],R=typeof I.getRange=="function"&&I.getRange(s);if(R){const F=T(g,s,a-R),U=T(g,s,a+R);return{lo:F.lo,hi:U.hi}}}}else return T(g,s,a)}return{lo:0,hi:g.length-1}}function hu(o,s,a,u,d){const g=o.getSortedVisibleDatasetMetas(),v=a[s];for(let r=0,T=g.length;r<T;++r){const{index:I,data:R}=g[r],{lo:F,hi:U}=xS(g[r],s,v,d);for(let Y=F;Y<=U;++Y){const ie=R[Y];ie.skip||u(ie,I,Y)}}}function vS(o){const s=o.indexOf("x")!==-1,a=o.indexOf("y")!==-1;return function(u,d){const g=s?Math.abs(u.x-d.x):0,v=a?Math.abs(u.y-d.y):0;return Math.sqrt(Math.pow(g,2)+Math.pow(v,2))}}function b_(o,s,a,u,d){const g=[];return!d&&!o.isPointInArea(s)||hu(o,a,s,function(r,T,I){!d&&!Nr(r,o.chartArea,0)||r.inRange(s.x,s.y,u)&&g.push({element:r,datasetIndex:T,index:I})},!0),g}function bS(o,s,a,u){let d=[];function g(v,r,T){const{startAngle:I,endAngle:R}=v.getProps(["startAngle","endAngle"],u),{angle:F}=m1(v,{x:s.x,y:s.y});iu(F,I,R)&&d.push({element:v,datasetIndex:r,index:T})}return hu(o,a,s,g),d}function wS(o,s,a,u,d,g){let v=[];const r=vS(a);let T=Number.POSITIVE_INFINITY;function I(R,F,U){const Y=R.inRange(s.x,s.y,d);if(u&&!Y)return;const ie=R.getCenterPoint(d);if(!(!!g||o.isPointInArea(ie))&&!Y)return;const he=r(s,ie);he<T?(v=[{element:R,datasetIndex:F,index:U}],T=he):he===T&&v.push({element:R,datasetIndex:F,index:U})}return hu(o,a,s,I),v}function w_(o,s,a,u,d,g){return!g&&!o.isPointInArea(s)?[]:a==="r"&&!u?bS(o,s,a,d):wS(o,s,a,u,d,g)}function zy(o,s,a,u,d){const g=[],v=a==="x"?"inXRange":"inYRange";let r=!1;return hu(o,a,s,(T,I,R)=>{T[v](s[a],d)&&(g.push({element:T,datasetIndex:I,index:R}),r=r||T.inRange(s.x,s.y,d))}),u&&!r?[]:g}var TS={evaluateInteractionItems:hu,modes:{index(o,s,a,u){const d=za(s,o),g=a.axis||"x",v=a.includeInvisible||!1,r=a.intersect?b_(o,d,g,u,v):w_(o,d,g,!1,u,v),T=[];return r.length?(o.getSortedVisibleDatasetMetas().forEach(I=>{const R=r[0].index,F=I.data[R];F&&!F.skip&&T.push({element:F,datasetIndex:I.index,index:R})}),T):[]},dataset(o,s,a,u){const d=za(s,o),g=a.axis||"xy",v=a.includeInvisible||!1;let r=a.intersect?b_(o,d,g,u,v):w_(o,d,g,!1,u,v);if(r.length>0){const T=r[0].datasetIndex,I=o.getDatasetMeta(T).data;r=[];for(let R=0;R<I.length;++R)r.push({element:I[R],datasetIndex:T,index:R})}return r},point(o,s,a,u){const d=za(s,o),g=a.axis||"xy",v=a.includeInvisible||!1;return b_(o,d,g,u,v)},nearest(o,s,a,u){const d=za(s,o),g=a.axis||"xy",v=a.includeInvisible||!1;return w_(o,d,g,a.intersect,u,v)},x(o,s,a,u){const d=za(s,o);return zy(o,d,"x",a.intersect,u)},y(o,s,a,u){const d=za(s,o);return zy(o,d,"y",a.intersect,u)}}};const V1=["left","top","right","bottom"];function Rh(o,s){return o.filter(a=>a.pos===s)}function Ry(o,s){return o.filter(a=>V1.indexOf(a.pos)===-1&&a.box.axis===s)}function Oh(o,s){return o.sort((a,u)=>{const d=s?u:a,g=s?a:u;return d.weight===g.weight?d.index-g.index:d.weight-g.weight})}function ES(o){const s=[];let a,u,d,g,v,r;for(a=0,u=(o||[]).length;a<u;++a)d=o[a],{position:g,options:{stack:v,stackWeight:r=1}}=d,s.push({index:a,box:d,pos:g,horizontal:d.isHorizontal(),weight:d.weight,stack:v&&g+v,stackWeight:r});return s}function SS(o){const s={};for(const a of o){const{stack:u,pos:d,stackWeight:g}=a;if(!u||!V1.includes(d))continue;const v=s[u]||(s[u]={count:0,placed:0,weight:0,size:0});v.count++,v.weight+=g}return s}function MS(o,s){const a=SS(o),{vBoxMaxWidth:u,hBoxMaxHeight:d}=s;let g,v,r;for(g=0,v=o.length;g<v;++g){r=o[g];const{fullSize:T}=r.box,I=a[r.stack],R=I&&r.stackWeight/I.weight;r.horizontal?(r.width=R?R*u:T&&s.availableWidth,r.height=d):(r.width=u,r.height=R?R*d:T&&s.availableHeight)}return a}function AS(o){const s=ES(o),a=Oh(s.filter(I=>I.box.fullSize),!0),u=Oh(Rh(s,"left"),!0),d=Oh(Rh(s,"right")),g=Oh(Rh(s,"top"),!0),v=Oh(Rh(s,"bottom")),r=Ry(s,"x"),T=Ry(s,"y");return{fullSize:a,leftAndTop:u.concat(g),rightAndBottom:d.concat(T).concat(v).concat(r),chartArea:Rh(s,"chartArea"),vertical:u.concat(d).concat(T),horizontal:g.concat(v).concat(r)}}function Oy(o,s,a,u){return Math.max(o[a],s[a])+Math.max(o[u],s[u])}function U1(o,s){o.top=Math.max(o.top,s.top),o.left=Math.max(o.left,s.left),o.bottom=Math.max(o.bottom,s.bottom),o.right=Math.max(o.right,s.right)}function CS(o,s,a,u){const{pos:d,box:g}=a,v=o.maxPadding;if(!Yt(d)){a.size&&(o[d]-=a.size);const F=u[a.stack]||{size:0,count:1};F.size=Math.max(F.size,a.horizontal?g.height:g.width),a.size=F.size/F.count,o[d]+=a.size}g.getPadding&&U1(v,g.getPadding());const r=Math.max(0,s.outerWidth-Oy(v,o,"left","right")),T=Math.max(0,s.outerHeight-Oy(v,o,"top","bottom")),I=r!==o.w,R=T!==o.h;return o.w=r,o.h=T,a.horizontal?{same:I,other:R}:{same:R,other:I}}function IS(o){const s=o.maxPadding;function a(u){const d=Math.max(s[u]-o[u],0);return o[u]+=d,d}o.y+=a("top"),o.x+=a("left"),a("right"),a("bottom")}function PS(o,s){const a=s.maxPadding;function u(d){const g={left:0,top:0,right:0,bottom:0};return d.forEach(v=>{g[v]=Math.max(s[v],a[v])}),g}return u(o?["left","right"]:["top","bottom"])}function Gh(o,s,a,u){const d=[];let g,v,r,T,I,R;for(g=0,v=o.length,I=0;g<v;++g){r=o[g],T=r.box,T.update(r.width||s.w,r.height||s.h,PS(r.horizontal,s));const{same:F,other:U}=CS(s,a,r,u);I|=F&&d.length,R=R||U,T.fullSize||d.push(r)}return I&&Gh(d,s,a,u)||R}function qd(o,s,a,u,d){o.top=a,o.left=s,o.right=s+u,o.bottom=a+d,o.width=u,o.height=d}function By(o,s,a,u){const d=a.padding;let{x:g,y:v}=s;for(const r of o){const T=r.box,I=u[r.stack]||{count:1,placed:0,weight:1},R=r.stackWeight/I.weight||1;if(r.horizontal){const F=s.w*R,U=I.size||T.height;tu(I.start)&&(v=I.start),T.fullSize?qd(T,d.left,v,a.outerWidth-d.right-d.left,U):qd(T,s.left+I.placed,v,F,U),I.start=v,I.placed+=F,v=T.bottom}else{const F=s.h*R,U=I.size||T.width;tu(I.start)&&(g=I.start),T.fullSize?qd(T,g,d.top,U,a.outerHeight-d.bottom-d.top):qd(T,g,s.top+I.placed,U,F),I.start=g,I.placed+=F,g=T.right}}s.x=g,s.y=v}var kn={addBox(o,s){o.boxes||(o.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(a){s.draw(a)}}]},o.boxes.push(s)},removeBox(o,s){const a=o.boxes?o.boxes.indexOf(s):-1;a!==-1&&o.boxes.splice(a,1)},configure(o,s,a){s.fullSize=a.fullSize,s.position=a.position,s.weight=a.weight},update(o,s,a,u){if(!o)return;const d=Dn(o.options.layout.padding),g=Math.max(s-d.width,0),v=Math.max(a-d.height,0),r=AS(o.boxes),T=r.vertical,I=r.horizontal;gi(o.boxes,ce=>{typeof ce.beforeLayout=="function"&&ce.beforeLayout()});const R=T.reduce((ce,he)=>he.box.options&&he.box.options.display===!1?ce:ce+1,0)||1,F=Object.freeze({outerWidth:s,outerHeight:a,padding:d,availableWidth:g,availableHeight:v,vBoxMaxWidth:g/2/R,hBoxMaxHeight:v/2}),U=Object.assign({},d);U1(U,Dn(u));const Y=Object.assign({maxPadding:U,w:g,h:v,x:d.left,y:d.top},d),ie=MS(T.concat(I),F);Gh(r.fullSize,Y,F,ie),Gh(T,Y,F,ie),Gh(I,Y,F,ie)&&Gh(T,Y,F,ie),IS(Y),By(r.leftAndTop,Y,F,ie),Y.x+=Y.w,Y.y+=Y.h,By(r.rightAndBottom,Y,F,ie),o.chartArea={left:Y.left,top:Y.top,right:Y.left+Y.w,bottom:Y.top+Y.h,height:Y.h,width:Y.w},gi(r.chartArea,ce=>{const he=ce.box;Object.assign(he,o.chartArea),he.update(Y.w,Y.h,{left:0,top:0,right:0,bottom:0})})}};class G1{acquireContext(s,a){}releaseContext(s){return!1}addEventListener(s,a,u){}removeEventListener(s,a,u){}getDevicePixelRatio(){return 1}getMaximumSize(s,a,u,d){return a=Math.max(0,a||s.width),u=u||s.height,{width:a,height:Math.max(0,d?Math.floor(a/d):u)}}isAttached(s){return!0}updateConfig(s){}}class kS extends G1{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}}const op="$chartjs",DS={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Fy=o=>o===null||o==="";function LS(o,s){const a=o.style,u=o.getAttribute("height"),d=o.getAttribute("width");if(o[op]={initial:{height:u,width:d,style:{display:a.display,height:a.height,width:a.width}}},a.display=a.display||"block",a.boxSizing=a.boxSizing||"border-box",Fy(d)){const g=vy(o,"width");g!==void 0&&(o.width=g)}if(Fy(u))if(o.style.height==="")o.height=o.width/(s||2);else{const g=vy(o,"height");g!==void 0&&(o.height=g)}return o}const $1=R3?{passive:!0}:!1;function zS(o,s,a){o.addEventListener(s,a,$1)}function RS(o,s,a){o.canvas.removeEventListener(s,a,$1)}function OS(o,s){const a=DS[o.type]||o.type,{x:u,y:d}=za(o,s);return{type:a,chart:s,native:o,x:u!==void 0?u:null,y:d!==void 0?d:null}}function yp(o,s){for(const a of o)if(a===s||a.contains(s))return!0}function BS(o,s,a){const u=o.canvas,d=new MutationObserver(g=>{let v=!1;for(const r of g)v=v||yp(r.addedNodes,u),v=v&&!yp(r.removedNodes,u);v&&a()});return d.observe(document,{childList:!0,subtree:!0}),d}function FS(o,s,a){const u=o.canvas,d=new MutationObserver(g=>{let v=!1;for(const r of g)v=v||yp(r.removedNodes,u),v=v&&!yp(r.addedNodes,u);v&&a()});return d.observe(document,{childList:!0,subtree:!0}),d}const su=new Map;let Ny=0;function q1(){const o=window.devicePixelRatio;o!==Ny&&(Ny=o,su.forEach((s,a)=>{a.currentDevicePixelRatio!==o&&s()}))}function NS(o,s){su.size||window.addEventListener("resize",q1),su.set(o,s)}function jS(o){su.delete(o),su.size||window.removeEventListener("resize",q1)}function VS(o,s,a){const u=o.canvas,d=u&&cm(u);if(!d)return;const g=v1((r,T)=>{const I=d.clientWidth;a(r,T),I<d.clientWidth&&a()},window),v=new ResizeObserver(r=>{const T=r[0],I=T.contentRect.width,R=T.contentRect.height;I===0&&R===0||g(I,R)});return v.observe(d),NS(o,g),v}function T_(o,s,a){a&&a.disconnect(),s==="resize"&&jS(o)}function US(o,s,a){const u=o.canvas,d=v1(g=>{o.ctx!==null&&a(OS(g,o))},o);return zS(u,s,d),d}class GS extends G1{acquireContext(s,a){const u=s&&s.getContext&&s.getContext("2d");return u&&u.canvas===s?(LS(s,a),u):null}releaseContext(s){const a=s.canvas;if(!a[op])return!1;const u=a[op].initial;["height","width"].forEach(g=>{const v=u[g];ei(v)?a.removeAttribute(g):a.setAttribute(g,v)});const d=u.style||{};return Object.keys(d).forEach(g=>{a.style[g]=d[g]}),a.width=a.width,delete a[op],!0}addEventListener(s,a,u){this.removeEventListener(s,a);const d=s.$proxies||(s.$proxies={}),v={attach:BS,detach:FS,resize:VS}[a]||US;d[a]=v(s,a,u)}removeEventListener(s,a){const u=s.$proxies||(s.$proxies={}),d=u[a];if(!d)return;({attach:T_,detach:T_,resize:T_}[a]||RS)(s,a,d),u[a]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,a,u,d){return z3(s,a,u,d)}isAttached(s){const a=cm(s);return!!(a&&a.isConnected)}}function $S(o){return!D1()||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas?kS:GS}class qs{constructor(){ut(this,"x");ut(this,"y");ut(this,"active",!1);ut(this,"options");ut(this,"$animations")}tooltipPosition(s){const{x:a,y:u}=this.getProps(["x","y"],s);return{x:a,y:u}}hasValue(){return Ql(this.x)&&Ql(this.y)}getProps(s,a){const u=this.$animations;if(!a||!u)return this;const d={};return s.forEach(g=>{d[g]=u[g]&&u[g].active()?u[g]._to:this[g]}),d}}ut(qs,"defaults",{}),ut(qs,"defaultRoutes");function qS(o,s){const a=o.options.ticks,u=WS(o),d=Math.min(a.maxTicksLimit||u,u),g=a.major.enabled?HS(s):[],v=g.length,r=g[0],T=g[v-1],I=[];if(v>d)return XS(s,I,g,v/d),I;const R=ZS(g,s,d);if(v>0){let F,U;const Y=v>1?Math.round((T-r)/(v-1)):null;for(Wd(s,I,R,ei(Y)?0:r-Y,r),F=0,U=v-1;F<U;F++)Wd(s,I,R,g[F],g[F+1]);return Wd(s,I,R,T,ei(Y)?s.length:T+Y),I}return Wd(s,I,R),I}function WS(o){const s=o.options.offset,a=o._tickSize(),u=o._length/a+(s?0:1),d=o._maxLength/a;return Math.floor(Math.min(u,d))}function ZS(o,s,a){const u=YS(o),d=s.length/a;if(!u)return Math.max(d,1);const g=FE(u);for(let v=0,r=g.length-1;v<r;v++){const T=g[v];if(T>d)return T}return Math.max(d,1)}function HS(o){const s=[];let a,u;for(a=0,u=o.length;a<u;a++)o[a].major&&s.push(a);return s}function XS(o,s,a,u){let d=0,g=a[0],v;for(u=Math.ceil(u),v=0;v<o.length;v++)v===g&&(s.push(o[v]),d++,g=a[d*u])}function Wd(o,s,a,u,d){const g=Vt(u,0),v=Math.min(Vt(d,o.length),o.length);let r=0,T,I,R;for(a=Math.ceil(a),d&&(T=d-u,a=T/Math.floor(T/a)),R=g;R<0;)r++,R=Math.round(g+r*a);for(I=Math.max(g,0);I<v;I++)I===R&&(s.push(o[I]),r++,R=Math.round(g+r*a))}function YS(o){const s=o.length;let a,u;if(s<2)return!1;for(u=o[0],a=1;a<s;++a)if(o[a]-o[a-1]!==u)return!1;return u}const KS=o=>o==="left"?"right":o==="right"?"left":o,jy=(o,s,a)=>s==="top"||s==="left"?o[s]+a:o[s]-a,Vy=(o,s)=>Math.min(s||o,o);function Uy(o,s){const a=[],u=o.length/s,d=o.length;let g=0;for(;g<d;g+=u)a.push(o[Math.floor(g)]);return a}function JS(o,s,a){const u=o.ticks.length,d=Math.min(s,u-1),g=o._startPixel,v=o._endPixel,r=1e-6;let T=o.getPixelForTick(d),I;if(!(a&&(u===1?I=Math.max(T-g,v-T):s===0?I=(o.getPixelForTick(1)-T)/2:I=(T-o.getPixelForTick(d-1))/2,T+=d<s?I:-I,T<g-r||T>v+r)))return T}function QS(o,s){gi(o,a=>{const u=a.gc,d=u.length/2;let g;if(d>s){for(g=0;g<d;++g)delete a.data[u[g]];u.splice(0,d)}})}function Bh(o){return o.drawTicks?o.tickLength:0}function Gy(o,s){if(!o.display)return 0;const a=hn(o.font,s),u=Dn(o.padding);return(zi(o.text)?o.text.length:1)*a.lineHeight+u.height}function eM(o,s){return zo(o,{scale:s,type:"scale"})}function tM(o,s,a){return zo(o,{tick:a,index:s,type:"tick"})}function iM(o,s,a){let u=nm(o);return(a&&s!=="right"||!a&&s==="right")&&(u=KS(u)),u}function nM(o,s,a,u){const{top:d,left:g,bottom:v,right:r,chart:T}=o,{chartArea:I,scales:R}=T;let F=0,U,Y,ie;const ce=v-d,he=r-g;if(o.isHorizontal()){if(Y=Pn(u,g,r),Yt(a)){const be=Object.keys(a)[0],De=a[be];ie=R[be].getPixelForValue(De)+ce-s}else a==="center"?ie=(I.bottom+I.top)/2+ce-s:ie=jy(o,a,s);U=r-g}else{if(Yt(a)){const be=Object.keys(a)[0],De=a[be];Y=R[be].getPixelForValue(De)-he+s}else a==="center"?Y=(I.left+I.right)/2-he+s:Y=jy(o,a,s);ie=Pn(u,v,d),F=a==="left"?-Ki:Ki}return{titleX:Y,titleY:ie,maxWidth:U,rotation:F}}class Va extends qs{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,a){return s}getUserBounds(){let{_userMin:s,_userMax:a,_suggestedMin:u,_suggestedMax:d}=this;return s=os(s,Number.POSITIVE_INFINITY),a=os(a,Number.NEGATIVE_INFINITY),u=os(u,Number.POSITIVE_INFINITY),d=os(d,Number.NEGATIVE_INFINITY),{min:os(s,u),max:os(a,d),minDefined:Yi(s),maxDefined:Yi(a)}}getMinMax(s){let{min:a,max:u,minDefined:d,maxDefined:g}=this.getUserBounds(),v;if(d&&g)return{min:a,max:u};const r=this.getMatchingVisibleMetas();for(let T=0,I=r.length;T<I;++T)v=r[T].controller.getMinMax(this,s),d||(a=Math.min(a,v.min)),g||(u=Math.max(u,v.max));return a=g&&a>u?u:a,u=d&&a>u?a:u,{min:os(a,os(u,a)),max:os(u,os(a,u))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}getLabelItems(s=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(s))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ci(this.options.beforeUpdate,[this])}update(s,a,u){const{beginAtZero:d,grace:g,ticks:v}=this.options,r=v.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=a,this._margins=u=Object.assign({left:0,right:0,top:0,bottom:0},u),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+u.left+u.right:this.height+u.top+u.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=d3(this,g,d),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const T=r<this.ticks.length;this._convertTicksToLabels(T?Uy(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),v.display&&(v.autoSkip||v.source==="auto")&&(this.ticks=qS(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),T&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,a,u;this.isHorizontal()?(a=this.left,u=this.right):(a=this.top,u=this.bottom,s=!s),this._startPixel=a,this._endPixel=u,this._reversePixels=s,this._length=u-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ci(this.options.afterUpdate,[this])}beforeSetDimensions(){Ci(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ci(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),Ci(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ci(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){const a=this.options.ticks;let u,d,g;for(u=0,d=s.length;u<d;u++)g=s[u],g.label=Ci(a.callback,[g.value,u,s],this)}afterTickToLabelConversion(){Ci(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ci(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const s=this.options,a=s.ticks,u=Vy(this.ticks.length,s.ticks.maxTicksLimit),d=a.minRotation||0,g=a.maxRotation;let v=d,r,T,I;if(!this._isVisible()||!a.display||d>=g||u<=1||!this.isHorizontal()){this.labelRotation=d;return}const R=this._getLabelSizes(),F=R.widest.width,U=R.highest.height,Y=mn(this.chart.width-F,0,this.maxWidth);r=s.offset?this.maxWidth/u:Y/(u-1),F+6>r&&(r=Y/(u-(s.offset?.5:1)),T=this.maxHeight-Bh(s.grid)-a.padding-Gy(s.title,this.chart.options.font),I=Math.sqrt(F*F+U*U),v=tm(Math.min(Math.asin(mn((R.highest.height+6)/r,-1,1)),Math.asin(mn(T/I,-1,1))-Math.asin(mn(U/I,-1,1)))),v=Math.max(d,Math.min(g,v))),this.labelRotation=v}afterCalculateLabelRotation(){Ci(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ci(this.options.beforeFit,[this])}fit(){const s={width:0,height:0},{chart:a,options:{ticks:u,title:d,grid:g}}=this,v=this._isVisible(),r=this.isHorizontal();if(v){const T=Gy(d,a.options.font);if(r?(s.width=this.maxWidth,s.height=Bh(g)+T):(s.height=this.maxHeight,s.width=Bh(g)+T),u.display&&this.ticks.length){const{first:I,last:R,widest:F,highest:U}=this._getLabelSizes(),Y=u.padding*2,ie=Gs(this.labelRotation),ce=Math.cos(ie),he=Math.sin(ie);if(r){const be=u.mirror?0:he*F.width+ce*U.height;s.height=Math.min(this.maxHeight,s.height+be+Y)}else{const be=u.mirror?0:ce*F.width+he*U.height;s.width=Math.min(this.maxWidth,s.width+be+Y)}this._calculatePadding(I,R,he,ce)}}this._handleMargins(),r?(this.width=this._length=a.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=a.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,a,u,d){const{ticks:{align:g,padding:v},position:r}=this.options,T=this.labelRotation!==0,I=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const R=this.getPixelForTick(0)-this.left,F=this.right-this.getPixelForTick(this.ticks.length-1);let U=0,Y=0;T?I?(U=d*s.width,Y=u*a.height):(U=u*s.height,Y=d*a.width):g==="start"?Y=a.width:g==="end"?U=s.width:g!=="inner"&&(U=s.width/2,Y=a.width/2),this.paddingLeft=Math.max((U-R+v)*this.width/(this.width-R),0),this.paddingRight=Math.max((Y-F+v)*this.width/(this.width-F),0)}else{let R=a.height/2,F=s.height/2;g==="start"?(R=0,F=s.height):g==="end"&&(R=a.height,F=0),this.paddingTop=R+v,this.paddingBottom=F+v}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ci(this.options.afterFit,[this])}isHorizontal(){const{axis:s,position:a}=this.options;return a==="top"||a==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let a,u;for(a=0,u=s.length;a<u;a++)ei(s[a].label)&&(s.splice(a,1),u--,a--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){const a=this.options.ticks.sampleSize;let u=this.ticks;a<u.length&&(u=Uy(u,a)),this._labelSizes=s=this._computeLabelSizes(u,u.length,this.options.ticks.maxTicksLimit)}return s}_computeLabelSizes(s,a,u){const{ctx:d,_longestTextCache:g}=this,v=[],r=[],T=Math.floor(a/Vy(a,u));let I=0,R=0,F,U,Y,ie,ce,he,be,De,Fe,We,Re;for(F=0;F<a;F+=T){if(ie=s[F].label,ce=this._resolveTickFontOptions(F),d.font=he=ce.string,be=g[he]=g[he]||{data:{},gc:[]},De=ce.lineHeight,Fe=We=0,!ei(ie)&&!zi(ie))Fe=mp(d,be.data,be.gc,Fe,ie),We=De;else if(zi(ie))for(U=0,Y=ie.length;U<Y;++U)Re=ie[U],!ei(Re)&&!zi(Re)&&(Fe=mp(d,be.data,be.gc,Fe,Re),We+=De);v.push(Fe),r.push(We),I=Math.max(Fe,I),R=Math.max(We,R)}QS(g,a);const Je=v.indexOf(I),nt=r.indexOf(R),st=Le=>({width:v[Le]||0,height:r[Le]||0});return{first:st(0),last:st(a-1),widest:st(Je),highest:st(nt),widths:v,heights:r}}getLabelForValue(s){return s}getPixelForValue(s,a){return NaN}getValueForPixel(s){}getPixelForTick(s){const a=this.ticks;return s<0||s>a.length-1?null:this.getPixelForValue(a[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);const a=this._startPixel+s*this._length;return VE(this._alignToPixels?Ia(this.chart,a,0):a)}getDecimalForPixel(s){const a=(s-this._startPixel)/this._length;return this._reversePixels?1-a:a}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:s,max:a}=this;return s<0&&a<0?a:s>0&&a>0?s:0}getContext(s){const a=this.ticks||[];if(s>=0&&s<a.length){const u=a[s];return u.$context||(u.$context=tM(this.getContext(),s,u))}return this.$context||(this.$context=eM(this.chart.getContext(),this))}_tickSize(){const s=this.options.ticks,a=Gs(this.labelRotation),u=Math.abs(Math.cos(a)),d=Math.abs(Math.sin(a)),g=this._getLabelSizes(),v=s.autoSkipPadding||0,r=g?g.widest.width+v:0,T=g?g.highest.height+v:0;return this.isHorizontal()?T*u>r*d?r/u:T/d:T*d<r*u?T/u:r/d}_isVisible(){const s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){const a=this.axis,u=this.chart,d=this.options,{grid:g,position:v,border:r}=d,T=g.offset,I=this.isHorizontal(),F=this.ticks.length+(T?1:0),U=Bh(g),Y=[],ie=r.setContext(this.getContext()),ce=ie.display?ie.width:0,he=ce/2,be=function(ti){return Ia(u,ti,ce)};let De,Fe,We,Re,Je,nt,st,Le,Lt,zt,ft,Gt;if(v==="top")De=be(this.bottom),nt=this.bottom-U,Le=De-he,zt=be(s.top)+he,Gt=s.bottom;else if(v==="bottom")De=be(this.top),zt=s.top,Gt=be(s.bottom)-he,nt=De+he,Le=this.top+U;else if(v==="left")De=be(this.right),Je=this.right-U,st=De-he,Lt=be(s.left)+he,ft=s.right;else if(v==="right")De=be(this.left),Lt=s.left,ft=be(s.right)-he,Je=De+he,st=this.left+U;else if(a==="x"){if(v==="center")De=be((s.top+s.bottom)/2+.5);else if(Yt(v)){const ti=Object.keys(v)[0],yi=v[ti];De=be(this.chart.scales[ti].getPixelForValue(yi))}zt=s.top,Gt=s.bottom,nt=De+he,Le=nt+U}else if(a==="y"){if(v==="center")De=be((s.left+s.right)/2);else if(Yt(v)){const ti=Object.keys(v)[0],yi=v[ti];De=be(this.chart.scales[ti].getPixelForValue(yi))}Je=De-he,st=Je-U,Lt=s.left,ft=s.right}const on=Vt(d.ticks.maxTicksLimit,F),Kt=Math.max(1,Math.ceil(F/on));for(Fe=0;Fe<F;Fe+=Kt){const ti=this.getContext(Fe),yi=g.setContext(ti),bt=r.setContext(ti),Pi=yi.lineWidth,xi=yi.color,ki=bt.dash||[],gn=bt.dashOffset,_i=yi.tickWidth,vn=yi.tickColor,Nn=yi.tickBorderDash||[],bn=yi.tickBorderDashOffset;We=JS(this,Fe,T),We!==void 0&&(Re=Ia(u,We,Pi),I?Je=st=Lt=ft=Re:nt=Le=zt=Gt=Re,Y.push({tx1:Je,ty1:nt,tx2:st,ty2:Le,x1:Lt,y1:zt,x2:ft,y2:Gt,width:Pi,color:xi,borderDash:ki,borderDashOffset:gn,tickWidth:_i,tickColor:vn,tickBorderDash:Nn,tickBorderDashOffset:bn}))}return this._ticksLength=F,this._borderValue=De,Y}_computeLabelItems(s){const a=this.axis,u=this.options,{position:d,ticks:g}=u,v=this.isHorizontal(),r=this.ticks,{align:T,crossAlign:I,padding:R,mirror:F}=g,U=Bh(u.grid),Y=U+R,ie=F?-R:Y,ce=-Gs(this.labelRotation),he=[];let be,De,Fe,We,Re,Je,nt,st,Le,Lt,zt,ft,Gt="middle";if(d==="top")Je=this.bottom-ie,nt=this._getXAxisLabelAlignment();else if(d==="bottom")Je=this.top+ie,nt=this._getXAxisLabelAlignment();else if(d==="left"){const Kt=this._getYAxisLabelAlignment(U);nt=Kt.textAlign,Re=Kt.x}else if(d==="right"){const Kt=this._getYAxisLabelAlignment(U);nt=Kt.textAlign,Re=Kt.x}else if(a==="x"){if(d==="center")Je=(s.top+s.bottom)/2+Y;else if(Yt(d)){const Kt=Object.keys(d)[0],ti=d[Kt];Je=this.chart.scales[Kt].getPixelForValue(ti)+Y}nt=this._getXAxisLabelAlignment()}else if(a==="y"){if(d==="center")Re=(s.left+s.right)/2-Y;else if(Yt(d)){const Kt=Object.keys(d)[0],ti=d[Kt];Re=this.chart.scales[Kt].getPixelForValue(ti)}nt=this._getYAxisLabelAlignment(U).textAlign}a==="y"&&(T==="start"?Gt="top":T==="end"&&(Gt="bottom"));const on=this._getLabelSizes();for(be=0,De=r.length;be<De;++be){Fe=r[be],We=Fe.label;const Kt=g.setContext(this.getContext(be));st=this.getPixelForTick(be)+g.labelOffset,Le=this._resolveTickFontOptions(be),Lt=Le.lineHeight,zt=zi(We)?We.length:1;const ti=zt/2,yi=Kt.color,bt=Kt.textStrokeColor,Pi=Kt.textStrokeWidth;let xi=nt;v?(Re=st,nt==="inner"&&(be===De-1?xi=this.options.reverse?"left":"right":be===0?xi=this.options.reverse?"right":"left":xi="center"),d==="top"?I==="near"||ce!==0?ft=-zt*Lt+Lt/2:I==="center"?ft=-on.highest.height/2-ti*Lt+Lt:ft=-on.highest.height+Lt/2:I==="near"||ce!==0?ft=Lt/2:I==="center"?ft=on.highest.height/2-ti*Lt:ft=on.highest.height-zt*Lt,F&&(ft*=-1),ce!==0&&!Kt.showLabelBackdrop&&(Re+=Lt/2*Math.sin(ce))):(Je=st,ft=(1-zt)*Lt/2);let ki;if(Kt.showLabelBackdrop){const gn=Dn(Kt.backdropPadding),_i=on.heights[be],vn=on.widths[be];let Nn=ft-gn.top,bn=0-gn.left;switch(Gt){case"middle":Nn-=_i/2;break;case"bottom":Nn-=_i;break}switch(nt){case"center":bn-=vn/2;break;case"right":bn-=vn;break}ki={left:bn,top:Nn,width:vn+gn.width,height:_i+gn.height,color:Kt.backdropColor}}he.push({label:We,font:Le,textOffset:ft,options:{rotation:ce,color:yi,strokeColor:bt,strokeWidth:Pi,textAlign:xi,textBaseline:Gt,translation:[Re,Je],backdrop:ki}})}return he}_getXAxisLabelAlignment(){const{position:s,ticks:a}=this.options;if(-Gs(this.labelRotation))return s==="top"?"left":"right";let d="center";return a.align==="start"?d="left":a.align==="end"?d="right":a.align==="inner"&&(d="inner"),d}_getYAxisLabelAlignment(s){const{position:a,ticks:{crossAlign:u,mirror:d,padding:g}}=this.options,v=this._getLabelSizes(),r=s+g,T=v.widest.width;let I,R;return a==="left"?d?(R=this.right+g,u==="near"?I="left":u==="center"?(I="center",R+=T/2):(I="right",R+=T)):(R=this.right-r,u==="near"?I="right":u==="center"?(I="center",R-=T/2):(I="left",R=this.left)):a==="right"?d?(R=this.left+g,u==="near"?I="right":u==="center"?(I="center",R-=T/2):(I="left",R-=T)):(R=this.left+r,u==="near"?I="left":u==="center"?(I="center",R+=T/2):(I="right",R=this.right)):I="right",{textAlign:I,x:R}}_computeLabelArea(){if(this.options.ticks.mirror)return;const s=this.chart,a=this.options.position;if(a==="left"||a==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(a==="top"||a==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){const{ctx:s,options:{backgroundColor:a},left:u,top:d,width:g,height:v}=this;a&&(s.save(),s.fillStyle=a,s.fillRect(u,d,g,v),s.restore())}getLineWidthForValue(s){const a=this.options.grid;if(!this._isVisible()||!a.display)return 0;const d=this.ticks.findIndex(g=>g.value===s);return d>=0?a.setContext(this.getContext(d)).lineWidth:0}drawGrid(s){const a=this.options.grid,u=this.ctx,d=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s));let g,v;const r=(T,I,R)=>{!R.width||!R.color||(u.save(),u.lineWidth=R.width,u.strokeStyle=R.color,u.setLineDash(R.borderDash||[]),u.lineDashOffset=R.borderDashOffset,u.beginPath(),u.moveTo(T.x,T.y),u.lineTo(I.x,I.y),u.stroke(),u.restore())};if(a.display)for(g=0,v=d.length;g<v;++g){const T=d[g];a.drawOnChartArea&&r({x:T.x1,y:T.y1},{x:T.x2,y:T.y2},T),a.drawTicks&&r({x:T.tx1,y:T.ty1},{x:T.tx2,y:T.ty2},{color:T.tickColor,width:T.tickWidth,borderDash:T.tickBorderDash,borderDashOffset:T.tickBorderDashOffset})}}drawBorder(){const{chart:s,ctx:a,options:{border:u,grid:d}}=this,g=u.setContext(this.getContext()),v=u.display?g.width:0;if(!v)return;const r=d.setContext(this.getContext(0)).lineWidth,T=this._borderValue;let I,R,F,U;this.isHorizontal()?(I=Ia(s,this.left,v)-v/2,R=Ia(s,this.right,r)+r/2,F=U=T):(F=Ia(s,this.top,v)-v/2,U=Ia(s,this.bottom,r)+r/2,I=R=T),a.save(),a.lineWidth=g.width,a.strokeStyle=g.color,a.beginPath(),a.moveTo(I,F),a.lineTo(R,U),a.stroke(),a.restore()}drawLabels(s){if(!this.options.ticks.display)return;const u=this.ctx,d=this._computeLabelArea();d&&Ep(u,d);const g=this.getLabelItems(s);for(const v of g){const r=v.options,T=v.font,I=v.label,R=v.textOffset;ja(u,I,0,R,T,r)}d&&Sp(u)}drawTitle(){const{ctx:s,options:{position:a,title:u,reverse:d}}=this;if(!u.display)return;const g=hn(u.font),v=Dn(u.padding),r=u.align;let T=g.lineHeight/2;a==="bottom"||a==="center"||Yt(a)?(T+=v.bottom,zi(u.text)&&(T+=g.lineHeight*(u.text.length-1))):T+=v.top;const{titleX:I,titleY:R,maxWidth:F,rotation:U}=nM(this,T,a,r);ja(s,u.text,0,0,g,{color:u.color,maxWidth:F,rotation:U,textAlign:iM(r,a,d),textBaseline:"middle",translation:[I,R]})}draw(s){this._isVisible()&&(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){const s=this.options,a=s.ticks&&s.ticks.z||0,u=Vt(s.grid&&s.grid.z,-1),d=Vt(s.border&&s.border.z,0);return!this._isVisible()||this.draw!==Va.prototype.draw?[{z:a,draw:g=>{this.draw(g)}}]:[{z:u,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:d,draw:()=>{this.drawBorder()}},{z:a,draw:g=>{this.drawLabels(g)}}]}getMatchingVisibleMetas(s){const a=this.chart.getSortedVisibleDatasetMetas(),u=this.axis+"AxisID",d=[];let g,v;for(g=0,v=a.length;g<v;++g){const r=a[g];r[u]===this.id&&(!s||r.type===s)&&d.push(r)}return d}_resolveTickFontOptions(s){const a=this.options.ticks.setContext(this.getContext(s));return hn(a.font)}_maxDigits(){const s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}}class Zd{constructor(s,a,u){this.type=s,this.scope=a,this.override=u,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){const a=Object.getPrototypeOf(s);let u;oM(a)&&(u=this.register(a));const d=this.items,g=s.id,v=this.scope+"."+g;if(!g)throw new Error("class does not have id: "+s);return g in d||(d[g]=s,sM(s,v,u),this.override&&Ji.override(s.id,s.overrides)),v}get(s){return this.items[s]}unregister(s){const a=this.items,u=s.id,d=this.scope;u in a&&delete a[u],d&&u in Ji[d]&&(delete Ji[d][u],this.override&&delete Na[u])}}function sM(o,s,a){const u=eu(Object.create(null),[a?Ji.get(a):{},Ji.get(s),o.defaults]);Ji.set(s,u),o.defaultRoutes&&rM(s,o.defaultRoutes),o.descriptors&&Ji.describe(s,o.descriptors)}function rM(o,s){Object.keys(s).forEach(a=>{const u=a.split("."),d=u.pop(),g=[o].concat(u).join("."),v=s[a].split("."),r=v.pop(),T=v.join(".");Ji.route(g,d,T,r)})}function oM(o){return"id"in o&&"defaults"in o}class aM{constructor(){this.controllers=new Zd($s,"datasets",!0),this.elements=new Zd(qs,"elements"),this.plugins=new Zd(Object,"plugins"),this.scales=new Zd(Va,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,a,u){[...a].forEach(d=>{const g=u||this._getRegistryForType(d);u||g.isForType(d)||g===this.plugins&&d.id?this._exec(s,g,d):gi(d,v=>{const r=u||this._getRegistryForType(v);this._exec(s,r,v)})})}_exec(s,a,u){const d=em(s);Ci(u["before"+d],[],u),a[s](u),Ci(u["after"+d],[],u)}_getRegistryForType(s){for(let a=0;a<this._typedRegistries.length;a++){const u=this._typedRegistries[a];if(u.isForType(s))return u}return this.plugins}_get(s,a,u){const d=a.get(s);if(d===void 0)throw new Error('"'+s+'" is not a registered '+u+".");return d}}var ar=new aM;class lM{constructor(){this._init=[]}notify(s,a,u,d){a==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install"));const g=d?this._descriptors(s).filter(d):this._descriptors(s),v=this._notify(g,s,a,u);return a==="afterDestroy"&&(this._notify(g,s,"stop"),this._notify(this._init,s,"uninstall")),v}_notify(s,a,u,d){d=d||{};for(const g of s){const v=g.plugin,r=v[u],T=[a,d,g.options];if(Ci(r,T,v)===!1&&d.cancelable)return!1}return!0}invalidate(){ei(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;const a=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),a}_createDescriptors(s,a){const u=s&&s.config,d=Vt(u.options&&u.options.plugins,{}),g=cM(u);return d===!1&&!a?[]:uM(s,g,d,a)}_notifyStateChanges(s){const a=this._oldCache||[],u=this._cache,d=(g,v)=>g.filter(r=>!v.some(T=>r.plugin.id===T.plugin.id));this._notify(d(a,u),s,"stop"),this._notify(d(u,a),s,"start")}}function cM(o){const s={},a=[],u=Object.keys(ar.plugins.items);for(let g=0;g<u.length;g++)a.push(ar.getPlugin(u[g]));const d=o.plugins||[];for(let g=0;g<d.length;g++){const v=d[g];a.indexOf(v)===-1&&(a.push(v),s[v.id]=!0)}return{plugins:a,localIds:s}}function hM(o,s){return!s&&o===!1?null:o===!0?{}:o}function uM(o,{plugins:s,localIds:a},u,d){const g=[],v=o.getContext();for(const r of s){const T=r.id,I=hM(u[T],d);I!==null&&g.push({plugin:r,options:dM(o.config,{plugin:r,local:a[T]},I,v)})}return g}function dM(o,{plugin:s,local:a},u,d){const g=o.pluginScopeKeys(s),v=o.getOptionScopes(u,g);return a&&s.defaults&&v.push(s.defaults),o.createResolver(v,d,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function R_(o,s){const a=Ji.datasets[o]||{};return((s.datasets||{})[o]||{}).indexAxis||s.indexAxis||a.indexAxis||"x"}function pM(o,s){let a=o;return o==="_index_"?a=s:o==="_value_"&&(a=s==="x"?"y":"x"),a}function fM(o,s){return o===s?"_index_":"_value_"}function $y(o){if(o==="x"||o==="y"||o==="r")return o}function _M(o){if(o==="top"||o==="bottom")return"x";if(o==="left"||o==="right")return"y"}function O_(o,...s){if($y(o))return o;for(const a of s){const u=a.axis||_M(a.position)||o.length>1&&$y(o[0].toLowerCase());if(u)return u}throw new Error(`Cannot determine type of '${o}' axis. Please provide 'axis' or 'position' option.`)}function qy(o,s,a){if(a[s+"AxisID"]===o)return{axis:s}}function mM(o,s){if(s.data&&s.data.datasets){const a=s.data.datasets.filter(u=>u.xAxisID===o||u.yAxisID===o);if(a.length)return qy(o,"x",a[0])||qy(o,"y",a[0])}return{}}function gM(o,s){const a=Na[o.type]||{scales:{}},u=s.scales||{},d=R_(o.type,s),g=Object.create(null);return Object.keys(u).forEach(v=>{const r=u[v];if(!Yt(r))return console.error(`Invalid scale configuration for scale: ${v}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${v}`);const T=O_(v,r,mM(v,o),Ji.scales[r.type]),I=fM(T,d),R=a.scales||{};g[v]=Zh(Object.create(null),[{axis:T},r,R[T],R[I]])}),o.data.datasets.forEach(v=>{const r=v.type||o.type,T=v.indexAxis||R_(r,s),R=(Na[r]||{}).scales||{};Object.keys(R).forEach(F=>{const U=pM(F,T),Y=v[U+"AxisID"]||U;g[Y]=g[Y]||Object.create(null),Zh(g[Y],[{axis:U},u[Y],R[F]])})}),Object.keys(g).forEach(v=>{const r=g[v];Zh(r,[Ji.scales[r.type],Ji.scale])}),g}function W1(o){const s=o.options||(o.options={});s.plugins=Vt(s.plugins,{}),s.scales=gM(o,s)}function Z1(o){return o=o||{},o.datasets=o.datasets||[],o.labels=o.labels||[],o}function yM(o){return o=o||{},o.data=Z1(o.data),W1(o),o}const Wy=new Map,H1=new Set;function Hd(o,s){let a=Wy.get(o);return a||(a=s(),Wy.set(o,a),H1.add(a)),a}const Fh=(o,s,a)=>{const u=Do(s,a);u!==void 0&&o.add(u)};class xM{constructor(s){this._config=yM(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=Z1(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){const s=this._config;this.clearCache(),W1(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return Hd(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,a){return Hd(`${s}.transition.${a}`,()=>[[`datasets.${s}.transitions.${a}`,`transitions.${a}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,a){return Hd(`${s}-${a}`,()=>[[`datasets.${s}.elements.${a}`,`datasets.${s}`,`elements.${a}`,""]])}pluginScopeKeys(s){const a=s.id,u=this.type;return Hd(`${u}-plugin-${a}`,()=>[[`plugins.${a}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,a){const u=this._scopeCache;let d=u.get(s);return(!d||a)&&(d=new Map,u.set(s,d)),d}getOptionScopes(s,a,u){const{options:d,type:g}=this,v=this._cachedScopes(s,u),r=v.get(a);if(r)return r;const T=new Set;a.forEach(R=>{s&&(T.add(s),R.forEach(F=>Fh(T,s,F))),R.forEach(F=>Fh(T,d,F)),R.forEach(F=>Fh(T,Na[g]||{},F)),R.forEach(F=>Fh(T,Ji,F)),R.forEach(F=>Fh(T,D_,F))});const I=Array.from(T);return I.length===0&&I.push(Object.create(null)),H1.has(a)&&v.set(a,I),I}chartOptionScopes(){const{options:s,type:a}=this;return[s,Na[a]||{},Ji.datasets[a]||{},{type:a},Ji,D_]}resolveNamedOptions(s,a,u,d=[""]){const g={$shared:!0},{resolver:v,subPrefixes:r}=Zy(this._resolverCache,s,d);let T=v;if(bM(v,a)){g.$shared=!1,u=Lo(u)?u():u;const I=this.createResolver(s,u,r);T=ec(v,u,I)}for(const I of a)g[I]=T[I];return g}createResolver(s,a,u=[""],d){const{resolver:g}=Zy(this._resolverCache,s,u);return Yt(a)?ec(g,a,void 0,d):g}}function Zy(o,s,a){let u=o.get(s);u||(u=new Map,o.set(s,u));const d=a.join();let g=u.get(d);return g||(g={resolver:om(s,a),subPrefixes:a.filter(r=>!r.toLowerCase().includes("hover"))},u.set(d,g)),g}const vM=o=>Yt(o)&&Object.getOwnPropertyNames(o).reduce((s,a)=>s||Lo(o[a]),!1);function bM(o,s){const{isScriptable:a,isIndexable:u}=M1(o);for(const d of s){const g=a(d),v=u(d),r=(v||g)&&o[d];if(g&&(Lo(r)||vM(r))||v&&zi(r))return!0}return!1}var wM="4.3.0";const TM=["top","bottom","left","right","chartArea"];function Hy(o,s){return o==="top"||o==="bottom"||TM.indexOf(o)===-1&&s==="x"}function Xy(o,s){return function(a,u){return a[o]===u[o]?a[s]-u[s]:a[o]-u[o]}}function Yy(o){const s=o.chart,a=s.options.animation;s.notifyPlugins("afterRender"),Ci(a&&a.onComplete,[o],s)}function EM(o){const s=o.chart,a=s.options.animation;Ci(a&&a.onProgress,[o],s)}function X1(o){return D1()&&typeof o=="string"?o=document.getElementById(o):o&&o.length&&(o=o[0]),o&&o.canvas&&(o=o.canvas),o}const ap={},Ky=o=>{const s=X1(o);return Object.values(ap).filter(a=>a.canvas===s).pop()};function SM(o,s,a){const u=Object.keys(o);for(const d of u){const g=+d;if(g>=s){const v=o[d];delete o[d],(a>0||g>s)&&(o[g+a]=v)}}}function MM(o,s,a,u){return!a||o.type==="mouseout"?null:u?s:o}function AM(o){const{xScale:s,yScale:a}=o;if(s&&a)return{left:s.left,right:s.right,top:a.top,bottom:a.bottom}}class lr{static register(...s){ar.add(...s),Jy()}static unregister(...s){ar.remove(...s),Jy()}constructor(s,a){const u=this.config=new xM(a),d=X1(s),g=Ky(d);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");const v=u.createResolver(u.chartOptionScopes(),this.getContext());this.platform=new(u.platform||$S(d)),this.platform.updateConfig(u);const r=this.platform.acquireContext(d,v.aspectRatio),T=r&&r.canvas,I=T&&T.height,R=T&&T.width;if(this.id=IE(),this.ctx=r,this.canvas=T,this.width=R,this.height=I,this._options=v,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new lM,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=qE(F=>this.update(F),v.resizeDelay||0),this._dataChanges=[],ap[this.id]=this,!r||!T){console.error("Failed to create chart: can't acquire context from the given item");return}zr.listen(this,"complete",Yy),zr.listen(this,"progress",EM),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:s,maintainAspectRatio:a},width:u,height:d,_aspectRatio:g}=this;return ei(s)?a&&g?g:d?u/d:null:s}get data(){return this.config.data}set data(s){this.config.data=s}get options(){return this._options}set options(s){this.config.options=s}get registry(){return ar}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():xy(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return my(this.canvas,this.ctx),this}stop(){return zr.stop(this),this}resize(s,a){zr.running(this)?this._resizeBeforeDraw={width:s,height:a}:this._resize(s,a)}_resize(s,a){const u=this.options,d=this.canvas,g=u.maintainAspectRatio&&this.aspectRatio,v=this.platform.getMaximumSize(d,s,a,g),r=u.devicePixelRatio||this.platform.getDevicePixelRatio(),T=this.width?"resize":"attach";this.width=v.width,this.height=v.height,this._aspectRatio=this.aspectRatio,xy(this,r,!0)&&(this.notifyPlugins("resize",{size:v}),Ci(u.onResize,[this,v],this),this.attached&&this._doResize(T)&&this.render())}ensureScalesHaveIDs(){const a=this.options.scales||{};gi(a,(u,d)=>{u.id=d})}buildOrUpdateScales(){const s=this.options,a=s.scales,u=this.scales,d=Object.keys(u).reduce((v,r)=>(v[r]=!1,v),{});let g=[];a&&(g=g.concat(Object.keys(a).map(v=>{const r=a[v],T=O_(v,r),I=T==="r",R=T==="x";return{options:r,dposition:I?"chartArea":R?"bottom":"left",dtype:I?"radialLinear":R?"category":"linear"}}))),gi(g,v=>{const r=v.options,T=r.id,I=O_(T,r),R=Vt(r.type,v.dtype);(r.position===void 0||Hy(r.position,I)!==Hy(v.dposition))&&(r.position=v.dposition),d[T]=!0;let F=null;if(T in u&&u[T].type===R)F=u[T];else{const U=ar.getScale(R);F=new U({id:T,type:R,ctx:this.ctx,chart:this}),u[F.id]=F}F.init(r,s)}),gi(d,(v,r)=>{v||delete u[r]}),gi(u,v=>{kn.configure(this,v,v.options),kn.addBox(this,v)})}_updateMetasets(){const s=this._metasets,a=this.data.datasets.length,u=s.length;if(s.sort((d,g)=>d.index-g.index),u>a){for(let d=a;d<u;++d)this._destroyDatasetMeta(d);s.splice(a,u-a)}this._sortedMetasets=s.slice(0).sort(Xy("order","index"))}_removeUnreferencedMetasets(){const{_metasets:s,data:{datasets:a}}=this;s.length>a.length&&delete this._stacks,s.forEach((u,d)=>{a.filter(g=>g===u._dataset).length===0&&this._destroyDatasetMeta(d)})}buildOrUpdateControllers(){const s=[],a=this.data.datasets;let u,d;for(this._removeUnreferencedMetasets(),u=0,d=a.length;u<d;u++){const g=a[u];let v=this.getDatasetMeta(u);const r=g.type||this.config.type;if(v.type&&v.type!==r&&(this._destroyDatasetMeta(u),v=this.getDatasetMeta(u)),v.type=r,v.indexAxis=g.indexAxis||R_(r,this.options),v.order=g.order||0,v.index=u,v.label=""+g.label,v.visible=this.isDatasetVisible(u),v.controller)v.controller.updateIndex(u),v.controller.linkScales();else{const T=ar.getController(r),{datasetElementType:I,dataElementType:R}=Ji.datasets[r];Object.assign(T,{dataElementType:ar.getElement(R),datasetElementType:I&&ar.getElement(I)}),v.controller=new T(this,u),s.push(v.controller)}}return this._updateMetasets(),s}_resetElements(){gi(this.data.datasets,(s,a)=>{this.getDatasetMeta(a).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(s){const a=this.config;a.update();const u=this._options=a.createResolver(a.chartOptionScopes(),this.getContext()),d=this._animationsDisabled=!u.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:s,cancelable:!0})===!1)return;const g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let v=0;for(let I=0,R=this.data.datasets.length;I<R;I++){const{controller:F}=this.getDatasetMeta(I),U=!d&&g.indexOf(F)===-1;F.buildOrUpdateElements(U),v=Math.max(+F.getMaxOverflow(),v)}v=this._minPadding=u.layout.autoPadding?v:0,this._updateLayout(v),d||gi(g,I=>{I.reset()}),this._updateDatasets(s),this.notifyPlugins("afterUpdate",{mode:s}),this._layers.sort(Xy("z","_idx"));const{_active:r,_lastEvent:T}=this;T?this._eventHandler(T,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){gi(this.scales,s=>{kn.removeBox(this,s)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const s=this.options,a=new Set(Object.keys(this._listeners)),u=new Set(s.events);(!ay(a,u)||!!this._responsiveListeners!==s.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:s}=this,a=this._getUniformDataChanges()||[];for(const{method:u,start:d,count:g}of a){const v=u==="_removeElements"?-g:g;SM(s,d,v)}}_getUniformDataChanges(){const s=this._dataChanges;if(!s||!s.length)return;this._dataChanges=[];const a=this.data.datasets.length,u=g=>new Set(s.filter(v=>v[0]===g).map((v,r)=>r+","+v.splice(1).join(","))),d=u(0);for(let g=1;g<a;g++)if(!ay(d,u(g)))return;return Array.from(d).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(s){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;kn.update(this,this.width,this.height,s);const a=this.chartArea,u=a.width<=0||a.height<=0;this._layers=[],gi(this.boxes,d=>{u&&d.position==="chartArea"||(d.configure&&d.configure(),this._layers.push(...d._layers()))},this),this._layers.forEach((d,g)=>{d._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(s){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:s,cancelable:!0})!==!1){for(let a=0,u=this.data.datasets.length;a<u;++a)this.getDatasetMeta(a).controller.configure();for(let a=0,u=this.data.datasets.length;a<u;++a)this._updateDataset(a,Lo(s)?s({datasetIndex:a}):s);this.notifyPlugins("afterDatasetsUpdate",{mode:s})}}_updateDataset(s,a){const u=this.getDatasetMeta(s),d={meta:u,index:s,mode:a,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",d)!==!1&&(u.controller._update(a),d.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",d))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(zr.has(this)?this.attached&&!zr.running(this)&&zr.start(this):(this.draw(),Yy({chart:this})))}draw(){let s;if(this._resizeBeforeDraw){const{width:u,height:d}=this._resizeBeforeDraw;this._resize(u,d),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const a=this._layers;for(s=0;s<a.length&&a[s].z<=0;++s)a[s].draw(this.chartArea);for(this._drawDatasets();s<a.length;++s)a[s].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(s){const a=this._sortedMetasets,u=[];let d,g;for(d=0,g=a.length;d<g;++d){const v=a[d];(!s||v.visible)&&u.push(v)}return u}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const s=this.getSortedVisibleDatasetMetas();for(let a=s.length-1;a>=0;--a)this._drawDataset(s[a]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(s){const a=this.ctx,u=s._clip,d=!u.disabled,g=AM(s)||this.chartArea,v={meta:s,index:s.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",v)!==!1&&(d&&Ep(a,{left:u.left===!1?0:g.left-u.left,right:u.right===!1?this.width:g.right+u.right,top:u.top===!1?0:g.top-u.top,bottom:u.bottom===!1?this.height:g.bottom+u.bottom}),s.controller.draw(),d&&Sp(a),v.cancelable=!1,this.notifyPlugins("afterDatasetDraw",v))}isPointInArea(s){return Nr(s,this.chartArea,this._minPadding)}getElementsAtEventForMode(s,a,u,d){const g=TS.modes[a];return typeof g=="function"?g(this,s,u,d):[]}getDatasetMeta(s){const a=this.data.datasets[s],u=this._metasets;let d=u.filter(g=>g&&g._dataset===a).pop();return d||(d={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:a&&a.order||0,index:s,_dataset:a,_parsed:[],_sorted:!1},u.push(d)),d}getContext(){return this.$context||(this.$context=zo(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(s){const a=this.data.datasets[s];if(!a)return!1;const u=this.getDatasetMeta(s);return typeof u.hidden=="boolean"?!u.hidden:!a.hidden}setDatasetVisibility(s,a){const u=this.getDatasetMeta(s);u.hidden=!a}toggleDataVisibility(s){this._hiddenIndices[s]=!this._hiddenIndices[s]}getDataVisibility(s){return!this._hiddenIndices[s]}_updateVisibility(s,a,u){const d=u?"show":"hide",g=this.getDatasetMeta(s),v=g.controller._resolveAnimations(void 0,d);tu(a)?(g.data[a].hidden=!u,this.update()):(this.setDatasetVisibility(s,u),v.update(g,{visible:u}),this.update(r=>r.datasetIndex===s?d:void 0))}hide(s,a){this._updateVisibility(s,a,!1)}show(s,a){this._updateVisibility(s,a,!0)}_destroyDatasetMeta(s){const a=this._metasets[s];a&&a.controller&&a.controller._destroy(),delete this._metasets[s]}_stop(){let s,a;for(this.stop(),zr.remove(this),s=0,a=this.data.datasets.length;s<a;++s)this._destroyDatasetMeta(s)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:s,ctx:a}=this;this._stop(),this.config.clearCache(),s&&(this.unbindEvents(),my(s,a),this.platform.releaseContext(a),this.canvas=null,this.ctx=null),delete ap[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...s){return this.canvas.toDataURL(...s)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const s=this._listeners,a=this.platform,u=(g,v)=>{a.addEventListener(this,g,v),s[g]=v},d=(g,v,r)=>{g.offsetX=v,g.offsetY=r,this._eventHandler(g)};gi(this.options.events,g=>u(g,d))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const s=this._responsiveListeners,a=this.platform,u=(T,I)=>{a.addEventListener(this,T,I),s[T]=I},d=(T,I)=>{s[T]&&(a.removeEventListener(this,T,I),delete s[T])},g=(T,I)=>{this.canvas&&this.resize(T,I)};let v;const r=()=>{d("attach",r),this.attached=!0,this.resize(),u("resize",g),u("detach",v)};v=()=>{this.attached=!1,d("resize",g),this._stop(),this._resize(0,0),u("attach",r)},a.isAttached(this.canvas)?r():v()}unbindEvents(){gi(this._listeners,(s,a)=>{this.platform.removeEventListener(this,a,s)}),this._listeners={},gi(this._responsiveListeners,(s,a)=>{this.platform.removeEventListener(this,a,s)}),this._responsiveListeners=void 0}updateHoverStyle(s,a,u){const d=u?"set":"remove";let g,v,r,T;for(a==="dataset"&&(g=this.getDatasetMeta(s[0].datasetIndex),g.controller["_"+d+"DatasetHoverStyle"]()),r=0,T=s.length;r<T;++r){v=s[r];const I=v&&this.getDatasetMeta(v.datasetIndex).controller;I&&I[d+"HoverStyle"](v.element,v.datasetIndex,v.index)}}getActiveElements(){return this._active||[]}setActiveElements(s){const a=this._active||[],u=s.map(({datasetIndex:g,index:v})=>{const r=this.getDatasetMeta(g);if(!r)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:r.data[v],index:v}});!pp(u,a)&&(this._active=u,this._lastEvent=null,this._updateHoverStyles(u,a))}notifyPlugins(s,a,u){return this._plugins.notify(this,s,a,u)}isPluginEnabled(s){return this._plugins._cache.filter(a=>a.plugin.id===s).length===1}_updateHoverStyles(s,a,u){const d=this.options.hover,g=(T,I)=>T.filter(R=>!I.some(F=>R.datasetIndex===F.datasetIndex&&R.index===F.index)),v=g(a,s),r=u?s:g(s,a);v.length&&this.updateHoverStyle(v,d.mode,!1),r.length&&d.mode&&this.updateHoverStyle(r,d.mode,!0)}_eventHandler(s,a){const u={event:s,replay:a,cancelable:!0,inChartArea:this.isPointInArea(s)},d=v=>(v.options.events||this.options.events).includes(s.native.type);if(this.notifyPlugins("beforeEvent",u,d)===!1)return;const g=this._handleEvent(s,a,u.inChartArea);return u.cancelable=!1,this.notifyPlugins("afterEvent",u,d),(g||u.changed)&&this.render(),this}_handleEvent(s,a,u){const{_active:d=[],options:g}=this,v=a,r=this._getActiveElements(s,d,u,v),T=RE(s),I=MM(s,this._lastEvent,u,T);u&&(this._lastEvent=null,Ci(g.onHover,[s,r,this],this),T&&Ci(g.onClick,[s,r,this],this));const R=!pp(r,d);return(R||a)&&(this._active=r,this._updateHoverStyles(r,d,a)),this._lastEvent=I,R}_getActiveElements(s,a,u,d){if(s.type==="mouseout")return[];if(!u)return a;const g=this.options.hover;return this.getElementsAtEventForMode(s,g.mode,g,d)}}ut(lr,"defaults",Ji),ut(lr,"instances",ap),ut(lr,"overrides",Na),ut(lr,"registry",ar),ut(lr,"version",wM),ut(lr,"getChart",Ky);function Jy(){return gi(lr.instances,o=>o._plugins.invalidate())}function CM(o,s,a){const{startAngle:u,pixelMargin:d,x:g,y:v,outerRadius:r,innerRadius:T}=s;let I=d/r;o.beginPath(),o.arc(g,v,r,u-I,a+I),T>d?(I=d/T,o.arc(g,v,T,a+I,u-I,!0)):o.arc(g,v,d,a+Ki,u-Ki),o.closePath(),o.clip()}function IM(o){return rm(o,["outerStart","outerEnd","innerStart","innerEnd"])}function PM(o,s,a,u){const d=IM(o.options.borderRadius),g=(a-s)/2,v=Math.min(g,u*s/2),r=T=>{const I=(a-Math.min(g,T))*u/2;return mn(T,0,Math.min(g,I))};return{outerStart:r(d.outerStart),outerEnd:r(d.outerEnd),innerStart:mn(d.innerStart,0,v),innerEnd:mn(d.innerEnd,0,v)}}function ql(o,s,a,u){return{x:a+o*Math.cos(s),y:u+o*Math.sin(s)}}function xp(o,s,a,u,d,g){const{x:v,y:r,startAngle:T,pixelMargin:I,innerRadius:R}=s,F=Math.max(s.outerRadius+u+a-I,0),U=R>0?R+u+a+I:0;let Y=0;const ie=d-T;if(u){const Kt=R>0?R-u:0,ti=F>0?F-u:0,yi=(Kt+ti)/2,bt=yi!==0?ie*yi/(yi+u):ie;Y=(ie-bt)/2}const ce=Math.max(.001,ie*F-a/Fi)/F,he=(ie-ce)/2,be=T+he+Y,De=d-he-Y,{outerStart:Fe,outerEnd:We,innerStart:Re,innerEnd:Je}=PM(s,U,F,De-be),nt=F-Fe,st=F-We,Le=be+Fe/nt,Lt=De-We/st,zt=U+Re,ft=U+Je,Gt=be+Re/zt,on=De-Je/ft;if(o.beginPath(),g){const Kt=(Le+Lt)/2;if(o.arc(v,r,F,Le,Kt),o.arc(v,r,F,Kt,Lt),We>0){const Pi=ql(st,Lt,v,r);o.arc(Pi.x,Pi.y,We,Lt,De+Ki)}const ti=ql(ft,De,v,r);if(o.lineTo(ti.x,ti.y),Je>0){const Pi=ql(ft,on,v,r);o.arc(Pi.x,Pi.y,Je,De+Ki,on+Math.PI)}const yi=(De-Je/U+(be+Re/U))/2;if(o.arc(v,r,U,De-Je/U,yi,!0),o.arc(v,r,U,yi,be+Re/U,!0),Re>0){const Pi=ql(zt,Gt,v,r);o.arc(Pi.x,Pi.y,Re,Gt+Math.PI,be-Ki)}const bt=ql(nt,be,v,r);if(o.lineTo(bt.x,bt.y),Fe>0){const Pi=ql(nt,Le,v,r);o.arc(Pi.x,Pi.y,Fe,be-Ki,Le)}}else{o.moveTo(v,r);const Kt=Math.cos(Le)*F+v,ti=Math.sin(Le)*F+r;o.lineTo(Kt,ti);const yi=Math.cos(Lt)*F+v,bt=Math.sin(Lt)*F+r;o.lineTo(yi,bt)}o.closePath()}function kM(o,s,a,u,d){const{fullCircles:g,startAngle:v,circumference:r}=s;let T=s.endAngle;if(g){xp(o,s,a,u,T,d);for(let I=0;I<g;++I)o.fill();isNaN(r)||(T=v+(r%Ri||Ri))}return xp(o,s,a,u,T,d),o.fill(),T}function DM(o,s,a,u,d){const{fullCircles:g,startAngle:v,circumference:r,options:T}=s,{borderWidth:I,borderJoinStyle:R,borderDash:F,borderDashOffset:U}=T,Y=T.borderAlign==="inner";if(!I)return;o.setLineDash(F||[]),o.lineDashOffset=U,Y?(o.lineWidth=I*2,o.lineJoin=R||"round"):(o.lineWidth=I,o.lineJoin=R||"bevel");let ie=s.endAngle;if(g){xp(o,s,a,u,ie,d);for(let ce=0;ce<g;++ce)o.stroke();isNaN(r)||(ie=v+(r%Ri||Ri))}Y&&CM(o,s,ie),g||(xp(o,s,a,u,ie,d),o.stroke())}class $h extends qs{constructor(a){super();ut(this,"circumference");ut(this,"endAngle");ut(this,"fullCircles");ut(this,"innerRadius");ut(this,"outerRadius");ut(this,"pixelMargin");ut(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,a&&Object.assign(this,a)}inRange(a,u,d){const g=this.getProps(["x","y"],d),{angle:v,distance:r}=m1(g,{x:a,y:u}),{startAngle:T,endAngle:I,innerRadius:R,outerRadius:F,circumference:U}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],d),Y=(this.options.spacing+this.options.borderWidth)/2,ce=Vt(U,I-T)>=Ri||iu(v,T,I),he=Br(r,R+Y,F+Y);return ce&&he}getCenterPoint(a){const{x:u,y:d,startAngle:g,endAngle:v,innerRadius:r,outerRadius:T}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],a),{offset:I,spacing:R}=this.options,F=(g+v)/2,U=(r+T+R+I)/2;return{x:u+Math.cos(F)*U,y:d+Math.sin(F)*U}}tooltipPosition(a){return this.getCenterPoint(a)}draw(a){const{options:u,circumference:d}=this,g=(u.offset||0)/4,v=(u.spacing||0)/2,r=u.circular;if(this.pixelMargin=u.borderAlign==="inner"?.33:0,this.fullCircles=d>Ri?Math.floor(d/Ri):0,d===0||this.innerRadius<0||this.outerRadius<0)return;a.save();const T=(this.startAngle+this.endAngle)/2;a.translate(Math.cos(T)*g,Math.sin(T)*g);const I=1-Math.sin(Math.min(Fi,d||0)),R=g*I;a.fillStyle=u.backgroundColor,a.strokeStyle=u.borderColor,kM(a,this,R,v,r),DM(a,this,R,v,r),a.restore()}}ut($h,"id","arc"),ut($h,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),ut($h,"defaultRoutes",{backgroundColor:"backgroundColor"}),ut($h,"descriptors",{_scriptable:!0,_indexable:a=>a!=="borderDash"});function Y1(o,s,a=s){o.lineCap=Vt(a.borderCapStyle,s.borderCapStyle),o.setLineDash(Vt(a.borderDash,s.borderDash)),o.lineDashOffset=Vt(a.borderDashOffset,s.borderDashOffset),o.lineJoin=Vt(a.borderJoinStyle,s.borderJoinStyle),o.lineWidth=Vt(a.borderWidth,s.borderWidth),o.strokeStyle=Vt(a.borderColor,s.borderColor)}function LM(o,s,a){o.lineTo(a.x,a.y)}function zM(o){return o.stepped?n3:o.tension||o.cubicInterpolationMode==="monotone"?s3:LM}function K1(o,s,a={}){const u=o.length,{start:d=0,end:g=u-1}=a,{start:v,end:r}=s,T=Math.max(d,v),I=Math.min(g,r),R=d<v&&g<v||d>r&&g>r;return{count:u,start:T,loop:s.loop,ilen:I<T&&!R?u+I-T:I-T}}function RM(o,s,a,u){const{points:d,options:g}=s,{count:v,start:r,loop:T,ilen:I}=K1(d,a,u),R=zM(g);let{move:F=!0,reverse:U}=u||{},Y,ie,ce;for(Y=0;Y<=I;++Y)ie=d[(r+(U?I-Y:Y))%v],!ie.skip&&(F?(o.moveTo(ie.x,ie.y),F=!1):R(o,ce,ie,U,g.stepped),ce=ie);return T&&(ie=d[(r+(U?I:0))%v],R(o,ce,ie,U,g.stepped)),!!T}function OM(o,s,a,u){const d=s.points,{count:g,start:v,ilen:r}=K1(d,a,u),{move:T=!0,reverse:I}=u||{};let R=0,F=0,U,Y,ie,ce,he,be;const De=We=>(v+(I?r-We:We))%g,Fe=()=>{ce!==he&&(o.lineTo(R,he),o.lineTo(R,ce),o.lineTo(R,be))};for(T&&(Y=d[De(0)],o.moveTo(Y.x,Y.y)),U=0;U<=r;++U){if(Y=d[De(U)],Y.skip)continue;const We=Y.x,Re=Y.y,Je=We|0;Je===ie?(Re<ce?ce=Re:Re>he&&(he=Re),R=(F*R+We)/++F):(Fe(),o.lineTo(We,Re),ie=Je,F=0,ce=he=Re),be=Re}Fe()}function B_(o){const s=o.options,a=s.borderDash&&s.borderDash.length;return!o._decimated&&!o._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!a?OM:RM}function BM(o){return o.stepped?O3:o.tension||o.cubicInterpolationMode==="monotone"?B3:Ra}function FM(o,s,a,u){let d=s._path;d||(d=s._path=new Path2D,s.path(d,a,u)&&d.closePath()),Y1(o,s.options),o.stroke(d)}function NM(o,s,a,u){const{segments:d,options:g}=s,v=B_(s);for(const r of d)Y1(o,g,r.style),o.beginPath(),v(o,s,r,{start:a,end:a+u-1})&&o.closePath(),o.stroke()}const jM=typeof Path2D=="function";function VM(o,s,a,u){jM&&!s.options.segment?FM(o,s,a,u):NM(o,s,a,u)}class Ao extends qs{constructor(s){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,s&&Object.assign(this,s)}updateControlPoints(s,a){const u=this.options;if((u.tension||u.cubicInterpolationMode==="monotone")&&!u.stepped&&!this._pointsUpdated){const d=u.spanGaps?this._loop:this._fullLoop;C3(this._points,u,s,d,a),this._pointsUpdated=!0}}set points(s){this._points=s,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=G3(this,this.options.segment))}first(){const s=this.segments,a=this.points;return s.length&&a[s[0].start]}last(){const s=this.segments,a=this.points,u=s.length;return u&&a[s[u-1].end]}interpolate(s,a){const u=this.options,d=s[a],g=this.points,v=B1(this,{property:a,start:d,end:d});if(!v.length)return;const r=[],T=BM(u);let I,R;for(I=0,R=v.length;I<R;++I){const{start:F,end:U}=v[I],Y=g[F],ie=g[U];if(Y===ie){r.push(Y);continue}const ce=Math.abs((d-Y[a])/(ie[a]-Y[a])),he=T(Y,ie,ce,u.stepped);he[a]=s[a],r.push(he)}return r.length===1?r[0]:r}pathSegment(s,a,u){return B_(this)(s,this,a,u)}path(s,a,u){const d=this.segments,g=B_(this);let v=this._loop;a=a||0,u=u||this.points.length-a;for(const r of d)v&=g(s,this,r,{start:a,end:a+u-1});return!!v}draw(s,a,u,d){const g=this.options||{};(this.points||[]).length&&g.borderWidth&&(s.save(),VM(s,this,u,d),s.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}ut(Ao,"id","line"),ut(Ao,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),ut(Ao,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),ut(Ao,"descriptors",{_scriptable:!0,_indexable:s=>s!=="borderDash"&&s!=="fill"});function Qy(o,s,a,u){const d=o.options,{[a]:g}=o.getProps([a],u);return Math.abs(s-g)<d.radius+d.hitRadius}class lp extends qs{constructor(a){super();ut(this,"parsed");ut(this,"skip");ut(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,a&&Object.assign(this,a)}inRange(a,u,d){const g=this.options,{x:v,y:r}=this.getProps(["x","y"],d);return Math.pow(a-v,2)+Math.pow(u-r,2)<Math.pow(g.hitRadius+g.radius,2)}inXRange(a,u){return Qy(this,a,"x",u)}inYRange(a,u){return Qy(this,a,"y",u)}getCenterPoint(a){const{x:u,y:d}=this.getProps(["x","y"],a);return{x:u,y:d}}size(a){a=a||this.options||{};let u=a.radius||0;u=Math.max(u,u&&a.hoverRadius||0);const d=u&&a.borderWidth||0;return(u+d)*2}draw(a,u){const d=this.options;this.skip||d.radius<.1||!Nr(this,u,this.size(d)/2)||(a.strokeStyle=d.borderColor,a.lineWidth=d.borderWidth,a.fillStyle=d.backgroundColor,L_(a,d,this.x,this.y))}getRange(){const a=this.options||{};return a.radius+a.hitRadius}}ut(lp,"id","point"),ut(lp,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),ut(lp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function J1(o,s){const{x:a,y:u,base:d,width:g,height:v}=o.getProps(["x","y","base","width","height"],s);let r,T,I,R,F;return o.horizontal?(F=v/2,r=Math.min(a,d),T=Math.max(a,d),I=u-F,R=u+F):(F=g/2,r=a-F,T=a+F,I=Math.min(u,d),R=Math.max(u,d)),{left:r,top:I,right:T,bottom:R}}function Co(o,s,a,u){return o?0:mn(s,a,u)}function UM(o,s,a){const u=o.options.borderWidth,d=o.borderSkipped,g=S1(u);return{t:Co(d.top,g.top,0,a),r:Co(d.right,g.right,0,s),b:Co(d.bottom,g.bottom,0,a),l:Co(d.left,g.left,0,s)}}function GM(o,s,a){const{enableBorderRadius:u}=o.getProps(["enableBorderRadius"]),d=o.options.borderRadius,g=Ba(d),v=Math.min(s,a),r=o.borderSkipped,T=u||Yt(d);return{topLeft:Co(!T||r.top||r.left,g.topLeft,0,v),topRight:Co(!T||r.top||r.right,g.topRight,0,v),bottomLeft:Co(!T||r.bottom||r.left,g.bottomLeft,0,v),bottomRight:Co(!T||r.bottom||r.right,g.bottomRight,0,v)}}function $M(o){const s=J1(o),a=s.right-s.left,u=s.bottom-s.top,d=UM(o,a/2,u/2),g=GM(o,a/2,u/2);return{outer:{x:s.left,y:s.top,w:a,h:u,radius:g},inner:{x:s.left+d.l,y:s.top+d.t,w:a-d.l-d.r,h:u-d.t-d.b,radius:{topLeft:Math.max(0,g.topLeft-Math.max(d.t,d.l)),topRight:Math.max(0,g.topRight-Math.max(d.t,d.r)),bottomLeft:Math.max(0,g.bottomLeft-Math.max(d.b,d.l)),bottomRight:Math.max(0,g.bottomRight-Math.max(d.b,d.r))}}}}function E_(o,s,a,u){const d=s===null,g=a===null,r=o&&!(d&&g)&&J1(o,u);return r&&(d||Br(s,r.left,r.right))&&(g||Br(a,r.top,r.bottom))}function qM(o){return o.topLeft||o.topRight||o.bottomLeft||o.bottomRight}function WM(o,s){o.rect(s.x,s.y,s.w,s.h)}function S_(o,s,a={}){const u=o.x!==a.x?-s:0,d=o.y!==a.y?-s:0,g=(o.x+o.w!==a.x+a.w?s:0)-u,v=(o.y+o.h!==a.y+a.h?s:0)-d;return{x:o.x+u,y:o.y+d,w:o.w+g,h:o.h+v,radius:o.radius}}class cp extends qs{constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){const{inflateAmount:a,options:{borderColor:u,backgroundColor:d}}=this,{inner:g,outer:v}=$M(this),r=qM(v.radius)?nu:WM;s.save(),(v.w!==g.w||v.h!==g.h)&&(s.beginPath(),r(s,S_(v,a,g)),s.clip(),r(s,S_(g,-a,v)),s.fillStyle=u,s.fill("evenodd")),s.beginPath(),r(s,S_(g,a)),s.fillStyle=d,s.fill(),s.restore()}inRange(s,a,u){return E_(this,s,a,u)}inXRange(s,a){return E_(this,s,null,a)}inYRange(s,a){return E_(this,null,s,a)}getCenterPoint(s){const{x:a,y:u,base:d,horizontal:g}=this.getProps(["x","y","base","horizontal"],s);return{x:g?(a+d)/2:a,y:g?u:(u+d)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}}ut(cp,"id","bar"),ut(cp,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),ut(cp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var ZM=Object.freeze({__proto__:null,ArcElement:$h,BarElement:cp,LineElement:Ao,PointElement:lp});const F_=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],ex=F_.map(o=>o.replace("rgb(","rgba(").replace(")",", 0.5)"));function Q1(o){return F_[o%F_.length]}function ev(o){return ex[o%ex.length]}function HM(o,s){return o.borderColor=Q1(s),o.backgroundColor=ev(s),++s}function XM(o,s){return o.backgroundColor=o.data.map(()=>Q1(s++)),s}function YM(o,s){return o.backgroundColor=o.data.map(()=>ev(s++)),s}function KM(o){let s=0;return(a,u)=>{const d=o.getDatasetMeta(u).controller;d instanceof Oa?s=XM(a,s):d instanceof Kh?s=YM(a,s):d&&(s=HM(a,s))}}function tx(o){let s;for(s in o)if(o[s].borderColor||o[s].backgroundColor)return!0;return!1}function JM(o){return o&&(o.borderColor||o.backgroundColor)}var QM={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(o,s,a){if(!a.enabled)return;const{data:{datasets:u},options:d}=o.config,{elements:g}=d;if(!a.forceOverride&&(tx(u)||JM(d)||g&&tx(g)))return;const v=KM(o);u.forEach(v)}};function eA(o,s,a,u,d){const g=d.samples||u;if(g>=a)return o.slice(s,s+a);const v=[],r=(a-2)/(g-2);let T=0;const I=s+a-1;let R=s,F,U,Y,ie,ce;for(v[T++]=o[R],F=0;F<g-2;F++){let he=0,be=0,De;const Fe=Math.floor((F+1)*r)+1+s,We=Math.min(Math.floor((F+2)*r)+1,a)+s,Re=We-Fe;for(De=Fe;De<We;De++)he+=o[De].x,be+=o[De].y;he/=Re,be/=Re;const Je=Math.floor(F*r)+1+s,nt=Math.min(Math.floor((F+1)*r)+1,a)+s,{x:st,y:Le}=o[R];for(Y=ie=-1,De=Je;De<nt;De++)ie=.5*Math.abs((st-he)*(o[De].y-Le)-(st-o[De].x)*(be-Le)),ie>Y&&(Y=ie,U=o[De],ce=De);v[T++]=U,R=ce}return v[T++]=o[I],v}function tA(o,s,a,u){let d=0,g=0,v,r,T,I,R,F,U,Y,ie,ce;const he=[],be=s+a-1,De=o[s].x,We=o[be].x-De;for(v=s;v<s+a;++v){r=o[v],T=(r.x-De)/We*u,I=r.y;const Re=T|0;if(Re===R)I<ie?(ie=I,F=v):I>ce&&(ce=I,U=v),d=(g*d+r.x)/++g;else{const Je=v-1;if(!ei(F)&&!ei(U)){const nt=Math.min(F,U),st=Math.max(F,U);nt!==Y&&nt!==Je&&he.push({...o[nt],x:d}),st!==Y&&st!==Je&&he.push({...o[st],x:d})}v>0&&Je!==Y&&he.push(o[Je]),he.push(r),R=Re,g=0,ie=ce=I,F=U=Y=v}}return he}function tv(o){if(o._decimated){const s=o._data;delete o._decimated,delete o._data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,writable:!0,value:s})}}function ix(o){o.data.datasets.forEach(s=>{tv(s)})}function iA(o,s){const a=s.length;let u=0,d;const{iScale:g}=o,{min:v,max:r,minDefined:T,maxDefined:I}=g.getUserBounds();return T&&(u=mn(Fr(s,g.axis,v).lo,0,a-1)),I?d=mn(Fr(s,g.axis,r).hi+1,u,a)-u:d=a-u,{start:u,count:d}}var nA={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(o,s,a)=>{if(!a.enabled){ix(o);return}const u=o.width;o.data.datasets.forEach((d,g)=>{const{_data:v,indexAxis:r}=d,T=o.getDatasetMeta(g),I=v||d.data;if(Uh([r,o.options.indexAxis])==="y"||!T.controller.supportsDecimation)return;const R=o.scales[T.xAxisID];if(R.type!=="linear"&&R.type!=="time"||o.options.parsing)return;let{start:F,count:U}=iA(T,I);const Y=a.threshold||4*u;if(U<=Y){tv(d);return}ei(v)&&(d._data=I,delete d.data,Object.defineProperty(d,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ce){this._data=ce}}));let ie;switch(a.algorithm){case"lttb":ie=eA(I,F,U,u,a);break;case"min-max":ie=tA(I,F,U,u);break;default:throw new Error(`Unsupported decimation algorithm '${a.algorithm}'`)}d._decimated=ie})},destroy(o){ix(o)}};function sA(o,s,a){const u=o.segments,d=o.points,g=s.points,v=[];for(const r of u){let{start:T,end:I}=r;I=um(T,I,d);const R=N_(a,d[T],d[I],r.loop);if(!s.segments){v.push({source:r,target:R,start:d[T],end:d[I]});continue}const F=B1(s,R);for(const U of F){const Y=N_(a,g[U.start],g[U.end],U.loop),ie=O1(r,d,Y);for(const ce of ie)v.push({source:ce,target:U,start:{[a]:nx(R,Y,"start",Math.max)},end:{[a]:nx(R,Y,"end",Math.min)}})}}return v}function N_(o,s,a,u){if(u)return;let d=s[o],g=a[o];return o==="angle"&&(d=as(d),g=as(g)),{property:o,start:d,end:g}}function rA(o,s){const{x:a=null,y:u=null}=o||{},d=s.points,g=[];return s.segments.forEach(({start:v,end:r})=>{r=um(v,r,d);const T=d[v],I=d[r];u!==null?(g.push({x:T.x,y:u}),g.push({x:I.x,y:u})):a!==null&&(g.push({x:a,y:T.y}),g.push({x:a,y:I.y}))}),g}function um(o,s,a){for(;s>o;s--){const u=a[s];if(!isNaN(u.x)&&!isNaN(u.y))break}return s}function nx(o,s,a,u){return o&&s?u(o[a],s[a]):o?o[a]:s?s[a]:0}function iv(o,s){let a=[],u=!1;return zi(o)?(u=!0,a=o):a=rA(o,s),a.length?new Ao({points:a,options:{tension:0},_loop:u,_fullLoop:u}):null}function sx(o){return o&&o.fill!==!1}function oA(o,s,a){let d=o[s].fill;const g=[s];let v;if(!a)return d;for(;d!==!1&&g.indexOf(d)===-1;){if(!Yi(d))return d;if(v=o[d],!v)return!1;if(v.visible)return d;g.push(d),d=v.fill}return!1}function aA(o,s,a){const u=uA(o);if(Yt(u))return isNaN(u.value)?!1:u;let d=parseFloat(u);return Yi(d)&&Math.floor(d)===d?lA(u[0],s,d,a):["origin","start","end","stack","shape"].indexOf(u)>=0&&u}function lA(o,s,a,u){return(o==="-"||o==="+")&&(a=s+a),a===s||a<0||a>=u?!1:a}function cA(o,s){let a=null;return o==="start"?a=s.bottom:o==="end"?a=s.top:Yt(o)?a=s.getPixelForValue(o.value):s.getBasePixel&&(a=s.getBasePixel()),a}function hA(o,s,a){let u;return o==="start"?u=a:o==="end"?u=s.options.reverse?s.min:s.max:Yt(o)?u=o.value:u=s.getBaseValue(),u}function uA(o){const s=o.options,a=s.fill;let u=Vt(a&&a.target,a);return u===void 0&&(u=!!s.backgroundColor),u===!1||u===null?!1:u===!0?"origin":u}function dA(o){const{scale:s,index:a,line:u}=o,d=[],g=u.segments,v=u.points,r=pA(s,a);r.push(iv({x:null,y:s.bottom},u));for(let T=0;T<g.length;T++){const I=g[T];for(let R=I.start;R<=I.end;R++)fA(d,v[R],r)}return new Ao({points:d,options:{}})}function pA(o,s){const a=[],u=o.getMatchingVisibleMetas("line");for(let d=0;d<u.length;d++){const g=u[d];if(g.index===s)break;g.hidden||a.unshift(g.dataset)}return a}function fA(o,s,a){const u=[];for(let d=0;d<a.length;d++){const g=a[d],{first:v,last:r,point:T}=_A(g,s,"x");if(!(!T||v&&r)){if(v)u.unshift(T);else if(o.push(T),!r)break}}o.push(...u)}function _A(o,s,a){const u=o.interpolate(s,a);if(!u)return{};const d=u[a],g=o.segments,v=o.points;let r=!1,T=!1;for(let I=0;I<g.length;I++){const R=g[I],F=v[R.start][a],U=v[R.end][a];if(Br(d,F,U)){r=d===F,T=d===U;break}}return{first:r,last:T,point:u}}class nv{constructor(s){this.x=s.x,this.y=s.y,this.radius=s.radius}pathSegment(s,a,u){const{x:d,y:g,radius:v}=this;return a=a||{start:0,end:Ri},s.arc(d,g,v,a.end,a.start,!0),!u.bounds}interpolate(s){const{x:a,y:u,radius:d}=this,g=s.angle;return{x:a+Math.cos(g)*d,y:u+Math.sin(g)*d,angle:g}}}function mA(o){const{chart:s,fill:a,line:u}=o;if(Yi(a))return gA(s,a);if(a==="stack")return dA(o);if(a==="shape")return!0;const d=yA(o);return d instanceof nv?d:iv(d,u)}function gA(o,s){const a=o.getDatasetMeta(s);return a&&o.isDatasetVisible(s)?a.dataset:null}function yA(o){return(o.scale||{}).getPointPositionForValue?vA(o):xA(o)}function xA(o){const{scale:s={},fill:a}=o,u=cA(a,s);if(Yi(u)){const d=s.isHorizontal();return{x:d?u:null,y:d?null:u}}return null}function vA(o){const{scale:s,fill:a}=o,u=s.options,d=s.getLabels().length,g=u.reverse?s.max:s.min,v=hA(a,s,g),r=[];if(u.grid.circular){const T=s.getPointPositionForValue(0,g);return new nv({x:T.x,y:T.y,radius:s.getDistanceFromCenterForValue(v)})}for(let T=0;T<d;++T)r.push(s.getPointPositionForValue(T,v));return r}function M_(o,s,a){const u=mA(s),{line:d,scale:g,axis:v}=s,r=d.options,T=r.fill,I=r.backgroundColor,{above:R=I,below:F=I}=T||{};u&&d.points.length&&(Ep(o,a),bA(o,{line:d,target:u,above:R,below:F,area:a,scale:g,axis:v}),Sp(o))}function bA(o,s){const{line:a,target:u,above:d,below:g,area:v,scale:r}=s,T=a._loop?"angle":s.axis;o.save(),T==="x"&&g!==d&&(rx(o,u,v.top),ox(o,{line:a,target:u,color:d,scale:r,property:T}),o.restore(),o.save(),rx(o,u,v.bottom)),ox(o,{line:a,target:u,color:g,scale:r,property:T}),o.restore()}function rx(o,s,a){const{segments:u,points:d}=s;let g=!0,v=!1;o.beginPath();for(const r of u){const{start:T,end:I}=r,R=d[T],F=d[um(T,I,d)];g?(o.moveTo(R.x,R.y),g=!1):(o.lineTo(R.x,a),o.lineTo(R.x,R.y)),v=!!s.pathSegment(o,r,{move:v}),v?o.closePath():o.lineTo(F.x,a)}o.lineTo(s.first().x,a),o.closePath(),o.clip()}function ox(o,s){const{line:a,target:u,property:d,color:g,scale:v}=s,r=sA(a,u,d);for(const{source:T,target:I,start:R,end:F}of r){const{style:{backgroundColor:U=g}={}}=T,Y=u!==!0;o.save(),o.fillStyle=U,wA(o,v,Y&&N_(d,R,F)),o.beginPath();const ie=!!a.pathSegment(o,T);let ce;if(Y){ie?o.closePath():ax(o,u,F,d);const he=!!u.pathSegment(o,I,{move:ie,reverse:!0});ce=ie&&he,ce||ax(o,u,R,d)}o.closePath(),o.fill(ce?"evenodd":"nonzero"),o.restore()}}function wA(o,s,a){const{top:u,bottom:d}=s.chart.chartArea,{property:g,start:v,end:r}=a||{};g==="x"&&(o.beginPath(),o.rect(v,u,r-v,d-u),o.clip())}function ax(o,s,a,u){const d=s.interpolate(a,u);d&&o.lineTo(d.x,d.y)}var TA={id:"filler",afterDatasetsUpdate(o,s,a){const u=(o.data.datasets||[]).length,d=[];let g,v,r,T;for(v=0;v<u;++v)g=o.getDatasetMeta(v),r=g.dataset,T=null,r&&r.options&&r instanceof Ao&&(T={visible:o.isDatasetVisible(v),index:v,fill:aA(r,v,u),chart:o,axis:g.controller.options.indexAxis,scale:g.vScale,line:r}),g.$filler=T,d.push(T);for(v=0;v<u;++v)T=d[v],!(!T||T.fill===!1)&&(T.fill=oA(d,v,a.propagate))},beforeDraw(o,s,a){const u=a.drawTime==="beforeDraw",d=o.getSortedVisibleDatasetMetas(),g=o.chartArea;for(let v=d.length-1;v>=0;--v){const r=d[v].$filler;r&&(r.line.updateControlPoints(g,r.axis),u&&r.fill&&M_(o.ctx,r,g))}},beforeDatasetsDraw(o,s,a){if(a.drawTime!=="beforeDatasetsDraw")return;const u=o.getSortedVisibleDatasetMetas();for(let d=u.length-1;d>=0;--d){const g=u[d].$filler;sx(g)&&M_(o.ctx,g,o.chartArea)}},beforeDatasetDraw(o,s,a){const u=s.meta.$filler;!sx(u)||a.drawTime!=="beforeDatasetDraw"||M_(o.ctx,u,o.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const lx=(o,s)=>{let{boxHeight:a=s,boxWidth:u=s}=o;return o.usePointStyle&&(a=Math.min(a,s),u=o.pointStyleWidth||Math.min(u,s)),{boxWidth:u,boxHeight:a,itemHeight:Math.max(s,a)}},EA=(o,s)=>o!==null&&s!==null&&o.datasetIndex===s.datasetIndex&&o.index===s.index;class cx extends qs{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,a,u){this.maxWidth=s,this.maxHeight=a,this._margins=u,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const s=this.options.labels||{};let a=Ci(s.generateLabels,[this.chart],this)||[];s.filter&&(a=a.filter(u=>s.filter(u,this.chart.data))),s.sort&&(a=a.sort((u,d)=>s.sort(u,d,this.chart.data))),this.options.reverse&&a.reverse(),this.legendItems=a}fit(){const{options:s,ctx:a}=this;if(!s.display){this.width=this.height=0;return}const u=s.labels,d=hn(u.font),g=d.size,v=this._computeTitleHeight(),{boxWidth:r,itemHeight:T}=lx(u,g);let I,R;a.font=d.string,this.isHorizontal()?(I=this.maxWidth,R=this._fitRows(v,g,r,T)+10):(R=this.maxHeight,I=this._fitCols(v,d,r,T)+10),this.width=Math.min(I,s.maxWidth||this.maxWidth),this.height=Math.min(R,s.maxHeight||this.maxHeight)}_fitRows(s,a,u,d){const{ctx:g,maxWidth:v,options:{labels:{padding:r}}}=this,T=this.legendHitBoxes=[],I=this.lineWidths=[0],R=d+r;let F=s;g.textAlign="left",g.textBaseline="middle";let U=-1,Y=-R;return this.legendItems.forEach((ie,ce)=>{const he=u+a/2+g.measureText(ie.text).width;(ce===0||I[I.length-1]+he+2*r>v)&&(F+=R,I[I.length-(ce>0?0:1)]=0,Y+=R,U++),T[ce]={left:0,top:Y,row:U,width:he,height:d},I[I.length-1]+=he+r}),F}_fitCols(s,a,u,d){const{ctx:g,maxHeight:v,options:{labels:{padding:r}}}=this,T=this.legendHitBoxes=[],I=this.columnSizes=[],R=v-s;let F=r,U=0,Y=0,ie=0,ce=0;return this.legendItems.forEach((he,be)=>{const{itemWidth:De,itemHeight:Fe}=SA(u,a,g,he,d);be>0&&Y+Fe+2*r>R&&(F+=U+r,I.push({width:U,height:Y}),ie+=U+r,ce++,U=Y=0),T[be]={left:ie,top:Y,col:ce,width:De,height:Fe},U=Math.max(U,De),Y+=Fe+r}),F+=U,I.push({width:U,height:Y}),F}adjustHitBoxes(){if(!this.options.display)return;const s=this._computeTitleHeight(),{legendHitBoxes:a,options:{align:u,labels:{padding:d},rtl:g}}=this,v=Hl(g,this.left,this.width);if(this.isHorizontal()){let r=0,T=Pn(u,this.left+d,this.right-this.lineWidths[r]);for(const I of a)r!==I.row&&(r=I.row,T=Pn(u,this.left+d,this.right-this.lineWidths[r])),I.top+=this.top+s+d,I.left=v.leftForLtr(v.x(T),I.width),T+=I.width+d}else{let r=0,T=Pn(u,this.top+s+d,this.bottom-this.columnSizes[r].height);for(const I of a)I.col!==r&&(r=I.col,T=Pn(u,this.top+s+d,this.bottom-this.columnSizes[r].height)),I.top=T,I.left+=this.left+d,I.left=v.leftForLtr(v.x(I.left),I.width),T+=I.height+d}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const s=this.ctx;Ep(s,this),this._draw(),Sp(s)}}_draw(){const{options:s,columnSizes:a,lineWidths:u,ctx:d}=this,{align:g,labels:v}=s,r=Ji.color,T=Hl(s.rtl,this.left,this.width),I=hn(v.font),{padding:R}=v,F=I.size,U=F/2;let Y;this.drawTitle(),d.textAlign=T.textAlign("left"),d.textBaseline="middle",d.lineWidth=.5,d.font=I.string;const{boxWidth:ie,boxHeight:ce,itemHeight:he}=lx(v,F),be=function(Je,nt,st){if(isNaN(ie)||ie<=0||isNaN(ce)||ce<0)return;d.save();const Le=Vt(st.lineWidth,1);if(d.fillStyle=Vt(st.fillStyle,r),d.lineCap=Vt(st.lineCap,"butt"),d.lineDashOffset=Vt(st.lineDashOffset,0),d.lineJoin=Vt(st.lineJoin,"miter"),d.lineWidth=Le,d.strokeStyle=Vt(st.strokeStyle,r),d.setLineDash(Vt(st.lineDash,[])),v.usePointStyle){const Lt={radius:ce*Math.SQRT2/2,pointStyle:st.pointStyle,rotation:st.rotation,borderWidth:Le},zt=T.xPlus(Je,ie/2),ft=nt+U;E1(d,Lt,zt,ft,v.pointStyleWidth&&ie)}else{const Lt=nt+Math.max((F-ce)/2,0),zt=T.leftForLtr(Je,ie),ft=Ba(st.borderRadius);d.beginPath(),Object.values(ft).some(Gt=>Gt!==0)?nu(d,{x:zt,y:Lt,w:ie,h:ce,radius:ft}):d.rect(zt,Lt,ie,ce),d.fill(),Le!==0&&d.stroke()}d.restore()},De=function(Je,nt,st){ja(d,st.text,Je,nt+he/2,I,{strikethrough:st.hidden,textAlign:T.textAlign(st.textAlign)})},Fe=this.isHorizontal(),We=this._computeTitleHeight();Fe?Y={x:Pn(g,this.left+R,this.right-u[0]),y:this.top+R+We,line:0}:Y={x:this.left+R,y:Pn(g,this.top+We+R,this.bottom-a[0].height),line:0},L1(this.ctx,s.textDirection);const Re=he+R;this.legendItems.forEach((Je,nt)=>{d.strokeStyle=Je.fontColor,d.fillStyle=Je.fontColor;const st=d.measureText(Je.text).width,Le=T.textAlign(Je.textAlign||(Je.textAlign=v.textAlign)),Lt=ie+U+st;let zt=Y.x,ft=Y.y;T.setWidth(this.width),Fe?nt>0&&zt+Lt+R>this.right&&(ft=Y.y+=Re,Y.line++,zt=Y.x=Pn(g,this.left+R,this.right-u[Y.line])):nt>0&&ft+Re>this.bottom&&(zt=Y.x=zt+a[Y.line].width+R,Y.line++,ft=Y.y=Pn(g,this.top+We+R,this.bottom-a[Y.line].height));const Gt=T.x(zt);if(be(Gt,ft,Je),zt=WE(Le,zt+ie+U,Fe?zt+Lt:this.right,s.rtl),De(T.x(zt),ft,Je),Fe)Y.x+=Lt+R;else if(typeof Je.text!="string"){const on=I.lineHeight;Y.y+=sv(Je,on)}else Y.y+=Re}),z1(this.ctx,s.textDirection)}drawTitle(){const s=this.options,a=s.title,u=hn(a.font),d=Dn(a.padding);if(!a.display)return;const g=Hl(s.rtl,this.left,this.width),v=this.ctx,r=a.position,T=u.size/2,I=d.top+T;let R,F=this.left,U=this.width;if(this.isHorizontal())U=Math.max(...this.lineWidths),R=this.top+I,F=Pn(s.align,F,this.right-U);else{const ie=this.columnSizes.reduce((ce,he)=>Math.max(ce,he.height),0);R=I+Pn(s.align,this.top,this.bottom-ie-s.labels.padding-this._computeTitleHeight())}const Y=Pn(r,F,F+U);v.textAlign=g.textAlign(nm(r)),v.textBaseline="middle",v.strokeStyle=a.color,v.fillStyle=a.color,v.font=u.string,ja(v,a.text,Y,R,u)}_computeTitleHeight(){const s=this.options.title,a=hn(s.font),u=Dn(s.padding);return s.display?a.lineHeight+u.height:0}_getLegendItemAt(s,a){let u,d,g;if(Br(s,this.left,this.right)&&Br(a,this.top,this.bottom)){for(g=this.legendHitBoxes,u=0;u<g.length;++u)if(d=g[u],Br(s,d.left,d.left+d.width)&&Br(a,d.top,d.top+d.height))return this.legendItems[u]}return null}handleEvent(s){const a=this.options;if(!CA(s.type,a))return;const u=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){const d=this._hoveredItem,g=EA(d,u);d&&!g&&Ci(a.onLeave,[s,d,this],this),this._hoveredItem=u,u&&!g&&Ci(a.onHover,[s,u,this],this)}else u&&Ci(a.onClick,[s,u,this],this)}}function SA(o,s,a,u,d){const g=MA(u,o,s,a),v=AA(d,u,s.lineHeight);return{itemWidth:g,itemHeight:v}}function MA(o,s,a,u){let d=o.text;return d&&typeof d!="string"&&(d=d.reduce((g,v)=>g.length>v.length?g:v)),s+a.size/2+u.measureText(d).width}function AA(o,s,a){let u=o;return typeof s.text!="string"&&(u=sv(s,a)),u}function sv(o,s){const a=o.text?o.text.length+.5:0;return s*a}function CA(o,s){return!!((o==="mousemove"||o==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(o==="click"||o==="mouseup"))}var IA={id:"legend",_element:cx,start(o,s,a){const u=o.legend=new cx({ctx:o.ctx,options:a,chart:o});kn.configure(o,u,a),kn.addBox(o,u)},stop(o){kn.removeBox(o,o.legend),delete o.legend},beforeUpdate(o,s,a){const u=o.legend;kn.configure(o,u,a),u.options=a},afterUpdate(o){const s=o.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(o,s){s.replay||o.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(o,s,a){const u=s.datasetIndex,d=a.chart;d.isDatasetVisible(u)?(d.hide(u),s.hidden=!0):(d.show(u),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:o=>o.chart.options.color,boxWidth:40,padding:10,generateLabels(o){const s=o.data.datasets,{labels:{usePointStyle:a,pointStyle:u,textAlign:d,color:g,useBorderRadius:v,borderRadius:r}}=o.legend.options;return o._getSortedDatasetMetas().map(T=>{const I=T.controller.getStyle(a?0:void 0),R=Dn(I.borderWidth);return{text:s[T.index].label,fillStyle:I.backgroundColor,fontColor:g,hidden:!T.visible,lineCap:I.borderCapStyle,lineDash:I.borderDash,lineDashOffset:I.borderDashOffset,lineJoin:I.borderJoinStyle,lineWidth:(R.width+R.height)/4,strokeStyle:I.borderColor,pointStyle:u||I.pointStyle,rotation:I.rotation,textAlign:d||I.textAlign,borderRadius:v&&(r||I.borderRadius),datasetIndex:T.index}},this)}},title:{color:o=>o.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:o=>!o.startsWith("on"),labels:{_scriptable:o=>!["generateLabels","filter","sort"].includes(o)}}};class dm extends qs{constructor(s){super(),this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,a){const u=this.options;if(this.left=0,this.top=0,!u.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=s,this.height=this.bottom=a;const d=zi(u.text)?u.text.length:1;this._padding=Dn(u.padding);const g=d*hn(u.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=g:this.width=g}isHorizontal(){const s=this.options.position;return s==="top"||s==="bottom"}_drawArgs(s){const{top:a,left:u,bottom:d,right:g,options:v}=this,r=v.align;let T=0,I,R,F;return this.isHorizontal()?(R=Pn(r,u,g),F=a+s,I=g-u):(v.position==="left"?(R=u+s,F=Pn(r,d,a),T=Fi*-.5):(R=g-s,F=Pn(r,a,d),T=Fi*.5),I=d-a),{titleX:R,titleY:F,maxWidth:I,rotation:T}}draw(){const s=this.ctx,a=this.options;if(!a.display)return;const u=hn(a.font),g=u.lineHeight/2+this._padding.top,{titleX:v,titleY:r,maxWidth:T,rotation:I}=this._drawArgs(g);ja(s,a.text,0,0,u,{color:a.color,maxWidth:T,rotation:I,textAlign:nm(a.align),textBaseline:"middle",translation:[v,r]})}}function PA(o,s){const a=new dm({ctx:o.ctx,options:s,chart:o});kn.configure(o,a,s),kn.addBox(o,a),o.titleBlock=a}var kA={id:"title",_element:dm,start(o,s,a){PA(o,a)},stop(o){const s=o.titleBlock;kn.removeBox(o,s),delete o.titleBlock},beforeUpdate(o,s,a){const u=o.titleBlock;kn.configure(o,u,a),u.options=a},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Xd=new WeakMap;var DA={id:"subtitle",start(o,s,a){const u=new dm({ctx:o.ctx,options:a,chart:o});kn.configure(o,u,a),kn.addBox(o,u),Xd.set(o,u)},stop(o){kn.removeBox(o,Xd.get(o)),Xd.delete(o)},beforeUpdate(o,s,a){const u=Xd.get(o);kn.configure(o,u,a),u.options=a},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const qh={average(o){if(!o.length)return!1;let s,a,u=0,d=0,g=0;for(s=0,a=o.length;s<a;++s){const v=o[s].element;if(v&&v.hasValue()){const r=v.tooltipPosition();u+=r.x,d+=r.y,++g}}return{x:u/g,y:d/g}},nearest(o,s){if(!o.length)return!1;let a=s.x,u=s.y,d=Number.POSITIVE_INFINITY,g,v,r;for(g=0,v=o.length;g<v;++g){const T=o[g].element;if(T&&T.hasValue()){const I=T.getCenterPoint(),R=k_(s,I);R<d&&(d=R,r=T)}}if(r){const T=r.tooltipPosition();a=T.x,u=T.y}return{x:a,y:u}}};function or(o,s){return s&&(zi(s)?Array.prototype.push.apply(o,s):o.push(s)),o}function Rr(o){return(typeof o=="string"||o instanceof String)&&o.indexOf(`
`)>-1?o.split(`
`):o}function LA(o,s){const{element:a,datasetIndex:u,index:d}=s,g=o.getDatasetMeta(u).controller,{label:v,value:r}=g.getLabelAndValue(d);return{chart:o,label:v,parsed:g.getParsed(d),raw:o.data.datasets[u].data[d],formattedValue:r,dataset:g.getDataset(),dataIndex:d,datasetIndex:u,element:a}}function hx(o,s){const a=o.chart.ctx,{body:u,footer:d,title:g}=o,{boxWidth:v,boxHeight:r}=s,T=hn(s.bodyFont),I=hn(s.titleFont),R=hn(s.footerFont),F=g.length,U=d.length,Y=u.length,ie=Dn(s.padding);let ce=ie.height,he=0,be=u.reduce((We,Re)=>We+Re.before.length+Re.lines.length+Re.after.length,0);if(be+=o.beforeBody.length+o.afterBody.length,F&&(ce+=F*I.lineHeight+(F-1)*s.titleSpacing+s.titleMarginBottom),be){const We=s.displayColors?Math.max(r,T.lineHeight):T.lineHeight;ce+=Y*We+(be-Y)*T.lineHeight+(be-1)*s.bodySpacing}U&&(ce+=s.footerMarginTop+U*R.lineHeight+(U-1)*s.footerSpacing);let De=0;const Fe=function(We){he=Math.max(he,a.measureText(We).width+De)};return a.save(),a.font=I.string,gi(o.title,Fe),a.font=T.string,gi(o.beforeBody.concat(o.afterBody),Fe),De=s.displayColors?v+2+s.boxPadding:0,gi(u,We=>{gi(We.before,Fe),gi(We.lines,Fe),gi(We.after,Fe)}),De=0,a.font=R.string,gi(o.footer,Fe),a.restore(),he+=ie.width,{width:he,height:ce}}function zA(o,s){const{y:a,height:u}=s;return a<u/2?"top":a>o.height-u/2?"bottom":"center"}function RA(o,s,a,u){const{x:d,width:g}=u,v=a.caretSize+a.caretPadding;if(o==="left"&&d+g+v>s.width||o==="right"&&d-g-v<0)return!0}function OA(o,s,a,u){const{x:d,width:g}=a,{width:v,chartArea:{left:r,right:T}}=o;let I="center";return u==="center"?I=d<=(r+T)/2?"left":"right":d<=g/2?I="left":d>=v-g/2&&(I="right"),RA(I,o,s,a)&&(I="center"),I}function ux(o,s,a){const u=a.yAlign||s.yAlign||zA(o,a);return{xAlign:a.xAlign||s.xAlign||OA(o,s,a,u),yAlign:u}}function BA(o,s){let{x:a,width:u}=o;return s==="right"?a-=u:s==="center"&&(a-=u/2),a}function FA(o,s,a){let{y:u,height:d}=o;return s==="top"?u+=a:s==="bottom"?u-=d+a:u-=d/2,u}function dx(o,s,a,u){const{caretSize:d,caretPadding:g,cornerRadius:v}=o,{xAlign:r,yAlign:T}=a,I=d+g,{topLeft:R,topRight:F,bottomLeft:U,bottomRight:Y}=Ba(v);let ie=BA(s,r);const ce=FA(s,T,I);return T==="center"?r==="left"?ie+=I:r==="right"&&(ie-=I):r==="left"?ie-=Math.max(R,U)+d:r==="right"&&(ie+=Math.max(F,Y)+d),{x:mn(ie,0,u.width-s.width),y:mn(ce,0,u.height-s.height)}}function Yd(o,s,a){const u=Dn(a.padding);return s==="center"?o.x+o.width/2:s==="right"?o.x+o.width-u.right:o.x+u.left}function px(o){return or([],Rr(o))}function NA(o,s,a){return zo(o,{tooltip:s,tooltipItems:a,type:"tooltip"})}function fx(o,s){const a=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return a?o.override(a):o}const rv={beforeTitle:Lr,title(o){if(o.length>0){const s=o[0],a=s.chart.data.labels,u=a?a.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(u>0&&s.dataIndex<u)return a[s.dataIndex]}return""},afterTitle:Lr,beforeBody:Lr,beforeLabel:Lr,label(o){if(this&&this.options&&this.options.mode==="dataset")return o.label+": "+o.formattedValue||o.formattedValue;let s=o.dataset.label||"";s&&(s+=": ");const a=o.formattedValue;return ei(a)||(s+=a),s},labelColor(o){const a=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{borderColor:a.borderColor,backgroundColor:a.backgroundColor,borderWidth:a.borderWidth,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(o){const a=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{pointStyle:a.pointStyle,rotation:a.rotation}},afterLabel:Lr,afterBody:Lr,beforeFooter:Lr,footer:Lr,afterFooter:Lr};function Kn(o,s,a,u){const d=o[s].call(a,u);return typeof d>"u"?rv[s].call(a,u):d}class j_ extends qs{constructor(s){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=s.chart,this.options=s.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(s){this.options=s,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const s=this._cachedAnimations;if(s)return s;const a=this.chart,u=this.options.setContext(this.getContext()),d=u.enabled&&a.options.animation&&u.animations,g=new F1(this.chart,d);return d._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=NA(this.chart.getContext(),this,this._tooltipItems))}getTitle(s,a){const{callbacks:u}=a,d=Kn(u,"beforeTitle",this,s),g=Kn(u,"title",this,s),v=Kn(u,"afterTitle",this,s);let r=[];return r=or(r,Rr(d)),r=or(r,Rr(g)),r=or(r,Rr(v)),r}getBeforeBody(s,a){return px(Kn(a.callbacks,"beforeBody",this,s))}getBody(s,a){const{callbacks:u}=a,d=[];return gi(s,g=>{const v={before:[],lines:[],after:[]},r=fx(u,g);or(v.before,Rr(Kn(r,"beforeLabel",this,g))),or(v.lines,Kn(r,"label",this,g)),or(v.after,Rr(Kn(r,"afterLabel",this,g))),d.push(v)}),d}getAfterBody(s,a){return px(Kn(a.callbacks,"afterBody",this,s))}getFooter(s,a){const{callbacks:u}=a,d=Kn(u,"beforeFooter",this,s),g=Kn(u,"footer",this,s),v=Kn(u,"afterFooter",this,s);let r=[];return r=or(r,Rr(d)),r=or(r,Rr(g)),r=or(r,Rr(v)),r}_createItems(s){const a=this._active,u=this.chart.data,d=[],g=[],v=[];let r=[],T,I;for(T=0,I=a.length;T<I;++T)r.push(LA(this.chart,a[T]));return s.filter&&(r=r.filter((R,F,U)=>s.filter(R,F,U,u))),s.itemSort&&(r=r.sort((R,F)=>s.itemSort(R,F,u))),gi(r,R=>{const F=fx(s.callbacks,R);d.push(Kn(F,"labelColor",this,R)),g.push(Kn(F,"labelPointStyle",this,R)),v.push(Kn(F,"labelTextColor",this,R))}),this.labelColors=d,this.labelPointStyles=g,this.labelTextColors=v,this.dataPoints=r,r}update(s,a){const u=this.options.setContext(this.getContext()),d=this._active;let g,v=[];if(!d.length)this.opacity!==0&&(g={opacity:0});else{const r=qh[u.position].call(this,d,this._eventPosition);v=this._createItems(u),this.title=this.getTitle(v,u),this.beforeBody=this.getBeforeBody(v,u),this.body=this.getBody(v,u),this.afterBody=this.getAfterBody(v,u),this.footer=this.getFooter(v,u);const T=this._size=hx(this,u),I=Object.assign({},r,T),R=ux(this.chart,u,I),F=dx(u,I,R,this.chart);this.xAlign=R.xAlign,this.yAlign=R.yAlign,g={opacity:1,x:F.x,y:F.y,width:T.width,height:T.height,caretX:r.x,caretY:r.y}}this._tooltipItems=v,this.$context=void 0,g&&this._resolveAnimations().update(this,g),s&&u.external&&u.external.call(this,{chart:this.chart,tooltip:this,replay:a})}drawCaret(s,a,u,d){const g=this.getCaretPosition(s,u,d);a.lineTo(g.x1,g.y1),a.lineTo(g.x2,g.y2),a.lineTo(g.x3,g.y3)}getCaretPosition(s,a,u){const{xAlign:d,yAlign:g}=this,{caretSize:v,cornerRadius:r}=u,{topLeft:T,topRight:I,bottomLeft:R,bottomRight:F}=Ba(r),{x:U,y:Y}=s,{width:ie,height:ce}=a;let he,be,De,Fe,We,Re;return g==="center"?(We=Y+ce/2,d==="left"?(he=U,be=he-v,Fe=We+v,Re=We-v):(he=U+ie,be=he+v,Fe=We-v,Re=We+v),De=he):(d==="left"?be=U+Math.max(T,R)+v:d==="right"?be=U+ie-Math.max(I,F)-v:be=this.caretX,g==="top"?(Fe=Y,We=Fe-v,he=be-v,De=be+v):(Fe=Y+ce,We=Fe+v,he=be+v,De=be-v),Re=Fe),{x1:he,x2:be,x3:De,y1:Fe,y2:We,y3:Re}}drawTitle(s,a,u){const d=this.title,g=d.length;let v,r,T;if(g){const I=Hl(u.rtl,this.x,this.width);for(s.x=Yd(this,u.titleAlign,u),a.textAlign=I.textAlign(u.titleAlign),a.textBaseline="middle",v=hn(u.titleFont),r=u.titleSpacing,a.fillStyle=u.titleColor,a.font=v.string,T=0;T<g;++T)a.fillText(d[T],I.x(s.x),s.y+v.lineHeight/2),s.y+=v.lineHeight+r,T+1===g&&(s.y+=u.titleMarginBottom-r)}}_drawColorBox(s,a,u,d,g){const v=this.labelColors[u],r=this.labelPointStyles[u],{boxHeight:T,boxWidth:I}=g,R=hn(g.bodyFont),F=Yd(this,"left",g),U=d.x(F),Y=T<R.lineHeight?(R.lineHeight-T)/2:0,ie=a.y+Y;if(g.usePointStyle){const ce={radius:Math.min(I,T)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},he=d.leftForLtr(U,I)+I/2,be=ie+T/2;s.strokeStyle=g.multiKeyBackground,s.fillStyle=g.multiKeyBackground,L_(s,ce,he,be),s.strokeStyle=v.borderColor,s.fillStyle=v.backgroundColor,L_(s,ce,he,be)}else{s.lineWidth=Yt(v.borderWidth)?Math.max(...Object.values(v.borderWidth)):v.borderWidth||1,s.strokeStyle=v.borderColor,s.setLineDash(v.borderDash||[]),s.lineDashOffset=v.borderDashOffset||0;const ce=d.leftForLtr(U,I),he=d.leftForLtr(d.xPlus(U,1),I-2),be=Ba(v.borderRadius);Object.values(be).some(De=>De!==0)?(s.beginPath(),s.fillStyle=g.multiKeyBackground,nu(s,{x:ce,y:ie,w:I,h:T,radius:be}),s.fill(),s.stroke(),s.fillStyle=v.backgroundColor,s.beginPath(),nu(s,{x:he,y:ie+1,w:I-2,h:T-2,radius:be}),s.fill()):(s.fillStyle=g.multiKeyBackground,s.fillRect(ce,ie,I,T),s.strokeRect(ce,ie,I,T),s.fillStyle=v.backgroundColor,s.fillRect(he,ie+1,I-2,T-2))}s.fillStyle=this.labelTextColors[u]}drawBody(s,a,u){const{body:d}=this,{bodySpacing:g,bodyAlign:v,displayColors:r,boxHeight:T,boxWidth:I,boxPadding:R}=u,F=hn(u.bodyFont);let U=F.lineHeight,Y=0;const ie=Hl(u.rtl,this.x,this.width),ce=function(st){a.fillText(st,ie.x(s.x+Y),s.y+U/2),s.y+=U+g},he=ie.textAlign(v);let be,De,Fe,We,Re,Je,nt;for(a.textAlign=v,a.textBaseline="middle",a.font=F.string,s.x=Yd(this,he,u),a.fillStyle=u.bodyColor,gi(this.beforeBody,ce),Y=r&&he!=="right"?v==="center"?I/2+R:I+2+R:0,We=0,Je=d.length;We<Je;++We){for(be=d[We],De=this.labelTextColors[We],a.fillStyle=De,gi(be.before,ce),Fe=be.lines,r&&Fe.length&&(this._drawColorBox(a,s,We,ie,u),U=Math.max(F.lineHeight,T)),Re=0,nt=Fe.length;Re<nt;++Re)ce(Fe[Re]),U=F.lineHeight;gi(be.after,ce)}Y=0,U=F.lineHeight,gi(this.afterBody,ce),s.y-=g}drawFooter(s,a,u){const d=this.footer,g=d.length;let v,r;if(g){const T=Hl(u.rtl,this.x,this.width);for(s.x=Yd(this,u.footerAlign,u),s.y+=u.footerMarginTop,a.textAlign=T.textAlign(u.footerAlign),a.textBaseline="middle",v=hn(u.footerFont),a.fillStyle=u.footerColor,a.font=v.string,r=0;r<g;++r)a.fillText(d[r],T.x(s.x),s.y+v.lineHeight/2),s.y+=v.lineHeight+u.footerSpacing}}drawBackground(s,a,u,d){const{xAlign:g,yAlign:v}=this,{x:r,y:T}=s,{width:I,height:R}=u,{topLeft:F,topRight:U,bottomLeft:Y,bottomRight:ie}=Ba(d.cornerRadius);a.fillStyle=d.backgroundColor,a.strokeStyle=d.borderColor,a.lineWidth=d.borderWidth,a.beginPath(),a.moveTo(r+F,T),v==="top"&&this.drawCaret(s,a,u,d),a.lineTo(r+I-U,T),a.quadraticCurveTo(r+I,T,r+I,T+U),v==="center"&&g==="right"&&this.drawCaret(s,a,u,d),a.lineTo(r+I,T+R-ie),a.quadraticCurveTo(r+I,T+R,r+I-ie,T+R),v==="bottom"&&this.drawCaret(s,a,u,d),a.lineTo(r+Y,T+R),a.quadraticCurveTo(r,T+R,r,T+R-Y),v==="center"&&g==="left"&&this.drawCaret(s,a,u,d),a.lineTo(r,T+F),a.quadraticCurveTo(r,T,r+F,T),a.closePath(),a.fill(),d.borderWidth>0&&a.stroke()}_updateAnimationTarget(s){const a=this.chart,u=this.$animations,d=u&&u.x,g=u&&u.y;if(d||g){const v=qh[s.position].call(this,this._active,this._eventPosition);if(!v)return;const r=this._size=hx(this,s),T=Object.assign({},v,this._size),I=ux(a,s,T),R=dx(s,T,I,a);(d._to!==R.x||g._to!==R.y)&&(this.xAlign=I.xAlign,this.yAlign=I.yAlign,this.width=r.width,this.height=r.height,this.caretX=v.x,this.caretY=v.y,this._resolveAnimations().update(this,R))}}_willRender(){return!!this.opacity}draw(s){const a=this.options.setContext(this.getContext());let u=this.opacity;if(!u)return;this._updateAnimationTarget(a);const d={width:this.width,height:this.height},g={x:this.x,y:this.y};u=Math.abs(u)<.001?0:u;const v=Dn(a.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;a.enabled&&r&&(s.save(),s.globalAlpha=u,this.drawBackground(g,s,d,a),L1(s,a.textDirection),g.y+=v.top,this.drawTitle(g,s,a),this.drawBody(g,s,a),this.drawFooter(g,s,a),z1(s,a.textDirection),s.restore())}getActiveElements(){return this._active||[]}setActiveElements(s,a){const u=this._active,d=s.map(({datasetIndex:r,index:T})=>{const I=this.chart.getDatasetMeta(r);if(!I)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:I.data[T],index:T}}),g=!pp(u,d),v=this._positionChanged(d,a);(g||v)&&(this._active=d,this._eventPosition=a,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(s,a,u=!0){if(a&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const d=this.options,g=this._active||[],v=this._getActiveElements(s,g,a,u),r=this._positionChanged(v,s),T=a||!pp(v,g)||r;return T&&(this._active=v,(d.enabled||d.external)&&(this._eventPosition={x:s.x,y:s.y},this.update(!0,a))),T}_getActiveElements(s,a,u,d){const g=this.options;if(s.type==="mouseout")return[];if(!d)return a;const v=this.chart.getElementsAtEventForMode(s,g.mode,g,u);return g.reverse&&v.reverse(),v}_positionChanged(s,a){const{caretX:u,caretY:d,options:g}=this,v=qh[g.position].call(this,s,a);return v!==!1&&(u!==v.x||d!==v.y)}}ut(j_,"positioners",qh);var jA={id:"tooltip",_element:j_,positioners:qh,afterInit(o,s,a){a&&(o.tooltip=new j_({chart:o,options:a}))},beforeUpdate(o,s,a){o.tooltip&&o.tooltip.initialize(a)},reset(o,s,a){o.tooltip&&o.tooltip.initialize(a)},afterDraw(o){const s=o.tooltip;if(s&&s._willRender()){const a={tooltip:s};if(o.notifyPlugins("beforeTooltipDraw",{...a,cancelable:!0})===!1)return;s.draw(o.ctx),o.notifyPlugins("afterTooltipDraw",a)}},afterEvent(o,s){if(o.tooltip){const a=s.replay;o.tooltip.handleEvent(s.event,a,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(o,s)=>s.bodyFont.size,boxWidth:(o,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:rv},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:o=>o!=="filter"&&o!=="itemSort"&&o!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},VA=Object.freeze({__proto__:null,Colors:QM,Decimation:nA,Filler:TA,Legend:IA,SubTitle:DA,Title:kA,Tooltip:jA});const UA=(o,s,a,u)=>(typeof s=="string"?(a=o.push(s)-1,u.unshift({index:a,label:s})):isNaN(s)&&(a=null),a);function GA(o,s,a,u){const d=o.indexOf(s);if(d===-1)return UA(o,s,a,u);const g=o.lastIndexOf(s);return d!==g?a:d}const $A=(o,s)=>o===null?null:mn(Math.round(o),0,s);function _x(o){const s=this.getLabels();return o>=0&&o<s.length?s[o]:o}class V_ extends Va{constructor(s){super(s),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(s){const a=this._addedLabels;if(a.length){const u=this.getLabels();for(const{index:d,label:g}of a)u[d]===g&&u.splice(d,1);this._addedLabels=[]}super.init(s)}parse(s,a){if(ei(s))return null;const u=this.getLabels();return a=isFinite(a)&&u[a]===s?a:GA(u,s,Vt(a,s),this._addedLabels),$A(a,u.length-1)}determineDataLimits(){const{minDefined:s,maxDefined:a}=this.getUserBounds();let{min:u,max:d}=this.getMinMax(!0);this.options.bounds==="ticks"&&(s||(u=0),a||(d=this.getLabels().length-1)),this.min=u,this.max=d}buildTicks(){const s=this.min,a=this.max,u=this.options.offset,d=[];let g=this.getLabels();g=s===0&&a===g.length-1?g:g.slice(s,a+1),this._valueRange=Math.max(g.length-(u?0:1),1),this._startValue=this.min-(u?.5:0);for(let v=s;v<=a;v++)d.push({value:v});return d}getLabelForValue(s){return _x.call(this,s)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(s){return typeof s!="number"&&(s=this.parse(s)),s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getPixelForTick(s){const a=this.ticks;return s<0||s>a.length-1?null:this.getPixelForValue(a[s].value)}getValueForPixel(s){return Math.round(this._startValue+this.getDecimalForPixel(s)*this._valueRange)}getBasePixel(){return this.bottom}}ut(V_,"id","category"),ut(V_,"defaults",{ticks:{callback:_x}});function qA(o,s){const a=[],{bounds:d,step:g,min:v,max:r,precision:T,count:I,maxTicks:R,maxDigits:F,includeBounds:U}=o,Y=g||1,ie=R-1,{min:ce,max:he}=s,be=!ei(v),De=!ei(r),Fe=!ei(I),We=(he-ce)/(F+1);let Re=cy((he-ce)/ie/Y)*Y,Je,nt,st,Le;if(Re<1e-14&&!be&&!De)return[{value:ce},{value:he}];Le=Math.ceil(he/Re)-Math.floor(ce/Re),Le>ie&&(Re=cy(Le*Re/ie/Y)*Y),ei(T)||(Je=Math.pow(10,T),Re=Math.ceil(Re*Je)/Je),d==="ticks"?(nt=Math.floor(ce/Re)*Re,st=Math.ceil(he/Re)*Re):(nt=ce,st=he),be&&De&&g&&NE((r-v)/g,Re/1e3)?(Le=Math.round(Math.min((r-v)/Re,R)),Re=(r-v)/Le,nt=v,st=r):Fe?(nt=be?v:nt,st=De?r:st,Le=I-1,Re=(st-nt)/Le):(Le=(st-nt)/Re,Hh(Le,Math.round(Le),Re/1e3)?Le=Math.round(Le):Le=Math.ceil(Le));const Lt=Math.max(hy(Re),hy(nt));Je=Math.pow(10,ei(T)?Lt:T),nt=Math.round(nt*Je)/Je,st=Math.round(st*Je)/Je;let zt=0;for(be&&(U&&nt!==v?(a.push({value:v}),nt<v&&zt++,Hh(Math.round((nt+zt*Re)*Je)/Je,v,mx(v,We,o))&&zt++):nt<v&&zt++);zt<Le;++zt){const ft=Math.round((nt+zt*Re)*Je)/Je;if(De&&ft>r)break;a.push({value:ft})}return De&&U&&st!==r?a.length&&Hh(a[a.length-1].value,r,mx(r,We,o))?a[a.length-1].value=r:a.push({value:r}):(!De||st===r)&&a.push({value:st}),a}function mx(o,s,{horizontal:a,minRotation:u}){const d=Gs(u),g=(a?Math.sin(d):Math.cos(d))||.001,v=.75*s*(""+o).length;return Math.min(s/g,v)}class vp extends Va{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,a){return ei(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){const{beginAtZero:s}=this.options,{minDefined:a,maxDefined:u}=this.getUserBounds();let{min:d,max:g}=this;const v=T=>d=a?d:T,r=T=>g=u?g:T;if(s){const T=cr(d),I=cr(g);T<0&&I<0?r(0):T>0&&I>0&&v(0)}if(d===g){let T=g===0?1:Math.abs(g*.05);r(g+T),s||v(d-T)}this.min=d,this.max=g}getTickLimit(){const s=this.options.ticks;let{maxTicksLimit:a,stepSize:u}=s,d;return u?(d=Math.ceil(this.max/u)-Math.floor(this.min/u)+1,d>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${u} would result generating up to ${d} ticks. Limiting to 1000.`),d=1e3)):(d=this.computeTickLimit(),a=a||11),a&&(d=Math.min(a,d)),d}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const s=this.options,a=s.ticks;let u=this.getTickLimit();u=Math.max(2,u);const d={maxTicks:u,bounds:s.bounds,min:s.min,max:s.max,precision:a.precision,step:a.stepSize,count:a.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:a.minRotation||0,includeBounds:a.includeBounds!==!1},g=this._range||this,v=qA(d,g);return s.bounds==="ticks"&&_1(v,this,"value"),s.reverse?(v.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),v}configure(){const s=this.ticks;let a=this.min,u=this.max;if(super.configure(),this.options.offset&&s.length){const d=(u-a)/Math.max(s.length-1,1)/2;a-=d,u+=d}this._startValue=a,this._endValue=u,this._valueRange=u-a}getLabelForValue(s){return cu(s,this.chart.options.locale,this.options.ticks.format)}}class U_ extends vp{determineDataLimits(){const{min:s,max:a}=this.getMinMax(!0);this.min=Yi(s)?s:0,this.max=Yi(a)?a:1,this.handleTickRangeOptions()}computeTickLimit(){const s=this.isHorizontal(),a=s?this.width:this.height,u=Gs(this.options.ticks.minRotation),d=(s?Math.sin(u):Math.cos(u))||.001,g=this._resolveTickFontOptions(0);return Math.ceil(a/Math.min(40,g.lineHeight/d))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}}ut(U_,"id","linear"),ut(U_,"defaults",{ticks:{callback:Tp.formatters.numeric}});const ru=o=>Math.floor(Mo(o)),ka=(o,s)=>Math.pow(10,ru(o)+s);function gx(o){return o/Math.pow(10,ru(o))===1}function yx(o,s,a){const u=Math.pow(10,a),d=Math.floor(o/u);return Math.ceil(s/u)-d}function WA(o,s){const a=s-o;let u=ru(a);for(;yx(o,s,u)>10;)u++;for(;yx(o,s,u)<10;)u--;return Math.min(u,ru(o))}function ZA(o,{min:s,max:a}){s=os(o.min,s);const u=[],d=ru(s);let g=WA(s,a),v=g<0?Math.pow(10,Math.abs(g)):1;const r=Math.pow(10,g),T=d>g?Math.pow(10,d):0,I=Math.round((s-T)*v)/v,R=Math.floor((s-T)/r/10)*r*10;let F=Math.floor((I-R)/Math.pow(10,g)),U=os(o.min,Math.round((T+R+F*Math.pow(10,g))*v)/v);for(;U<a;)u.push({value:U,major:gx(U),significand:F}),F>=10?F=F<15?15:20:F++,F>=20&&(g++,F=2,v=g>=0?1:v),U=Math.round((T+R+F*Math.pow(10,g))*v)/v;const Y=os(o.max,U);return u.push({value:Y,major:gx(Y),significand:F}),u}class G_ extends Va{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(s,a){const u=vp.prototype.parse.apply(this,[s,a]);if(u===0){this._zero=!0;return}return Yi(u)&&u>0?u:null}determineDataLimits(){const{min:s,max:a}=this.getMinMax(!0);this.min=Yi(s)?Math.max(0,s):null,this.max=Yi(a)?Math.max(0,a):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Yi(this._userMin)&&(this.min=s===ka(this.min,0)?ka(this.min,-1):ka(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:s,maxDefined:a}=this.getUserBounds();let u=this.min,d=this.max;const g=r=>u=s?u:r,v=r=>d=a?d:r;u===d&&(u<=0?(g(1),v(10)):(g(ka(u,-1)),v(ka(d,1)))),u<=0&&g(ka(d,-1)),d<=0&&v(ka(u,1)),this.min=u,this.max=d}buildTicks(){const s=this.options,a={min:this._userMin,max:this._userMax},u=ZA(a,this);return s.bounds==="ticks"&&_1(u,this,"value"),s.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}getLabelForValue(s){return s===void 0?"0":cu(s,this.chart.options.locale,this.options.ticks.format)}configure(){const s=this.min;super.configure(),this._startValue=Mo(s),this._valueRange=Mo(this.max)-Mo(s)}getPixelForValue(s){return(s===void 0||s===0)&&(s=this.min),s===null||isNaN(s)?NaN:this.getPixelForDecimal(s===this.min?0:(Mo(s)-this._startValue)/this._valueRange)}getValueForPixel(s){const a=this.getDecimalForPixel(s);return Math.pow(10,this._startValue+a*this._valueRange)}}ut(G_,"id","logarithmic"),ut(G_,"defaults",{ticks:{callback:Tp.formatters.logarithmic,major:{enabled:!0}}});function $_(o){const s=o.ticks;if(s.display&&o.display){const a=Dn(s.backdropPadding);return Vt(s.font&&s.font.size,Ji.font.size)+a.height}return 0}function HA(o,s,a){return a=zi(a)?a:[a],{w:i3(o,s.string,a),h:a.length*s.lineHeight}}function xx(o,s,a,u,d){return o===u||o===d?{start:s-a/2,end:s+a/2}:o<u||o>d?{start:s-a,end:s}:{start:s,end:s+a}}function XA(o){const s={l:o.left+o._padding.left,r:o.right-o._padding.right,t:o.top+o._padding.top,b:o.bottom-o._padding.bottom},a=Object.assign({},s),u=[],d=[],g=o._pointLabels.length,v=o.options.pointLabels,r=v.centerPointLabels?Fi/g:0;for(let T=0;T<g;T++){const I=v.setContext(o.getPointLabelContext(T));d[T]=I.padding;const R=o.getPointPosition(T,o.drawingArea+d[T],r),F=hn(I.font),U=HA(o.ctx,F,o._pointLabels[T]);u[T]=U;const Y=as(o.getIndexAngle(T)+r),ie=Math.round(tm(Y)),ce=xx(ie,R.x,U.w,0,180),he=xx(ie,R.y,U.h,90,270);YA(a,s,Y,ce,he)}o.setCenterPoint(s.l-a.l,a.r-s.r,s.t-a.t,a.b-s.b),o._pointLabelItems=QA(o,u,d)}function YA(o,s,a,u,d){const g=Math.abs(Math.sin(a)),v=Math.abs(Math.cos(a));let r=0,T=0;u.start<s.l?(r=(s.l-u.start)/g,o.l=Math.min(o.l,s.l-r)):u.end>s.r&&(r=(u.end-s.r)/g,o.r=Math.max(o.r,s.r+r)),d.start<s.t?(T=(s.t-d.start)/v,o.t=Math.min(o.t,s.t-T)):d.end>s.b&&(T=(d.end-s.b)/v,o.b=Math.max(o.b,s.b+T))}function KA(o,s,a){const u=o.drawingArea,{extra:d,additionalAngle:g,padding:v,size:r}=a,T=o.getPointPosition(s,u+d+v,g),I=Math.round(tm(as(T.angle+Ki))),R=iC(T.y,r.h,I),F=eC(I),U=tC(T.x,r.w,F);return{visible:!0,x:T.x,y:R,textAlign:F,left:U,top:R,right:U+r.w,bottom:R+r.h}}function JA(o,s){if(!s)return!0;const{left:a,top:u,right:d,bottom:g}=o;return!(Nr({x:a,y:u},s)||Nr({x:a,y:g},s)||Nr({x:d,y:u},s)||Nr({x:d,y:g},s))}function QA(o,s,a){const u=[],d=o._pointLabels.length,g=o.options,{centerPointLabels:v,display:r}=g.pointLabels,T={extra:$_(g)/2,additionalAngle:v?Fi/d:0};let I;for(let R=0;R<d;R++){T.padding=a[R],T.size=s[R];const F=KA(o,R,T);u.push(F),r==="auto"&&(F.visible=JA(F,I),F.visible&&(I=F))}return u}function eC(o){return o===0||o===180?"center":o<180?"left":"right"}function tC(o,s,a){return a==="right"?o-=s:a==="center"&&(o-=s/2),o}function iC(o,s,a){return a===90||a===270?o-=s/2:(a>270||a<90)&&(o-=s),o}function nC(o,s,a){const{left:u,top:d,right:g,bottom:v}=a,{backdropColor:r}=s;if(!ei(r)){const T=Ba(s.borderRadius),I=Dn(s.backdropPadding);o.fillStyle=r;const R=u-I.left,F=d-I.top,U=g-u+I.width,Y=v-d+I.height;Object.values(T).some(ie=>ie!==0)?(o.beginPath(),nu(o,{x:R,y:F,w:U,h:Y,radius:T}),o.fill()):o.fillRect(R,F,U,Y)}}function sC(o,s){const{ctx:a,options:{pointLabels:u}}=o;for(let d=s-1;d>=0;d--){const g=o._pointLabelItems[d];if(!g.visible)continue;const v=u.setContext(o.getPointLabelContext(d));nC(a,v,g);const r=hn(v.font),{x:T,y:I,textAlign:R}=g;ja(a,o._pointLabels[d],T,I+r.lineHeight/2,r,{color:v.color,textAlign:R,textBaseline:"middle"})}}function ov(o,s,a,u){const{ctx:d}=o;if(a)d.arc(o.xCenter,o.yCenter,s,0,Ri);else{let g=o.getPointPosition(0,s);d.moveTo(g.x,g.y);for(let v=1;v<u;v++)g=o.getPointPosition(v,s),d.lineTo(g.x,g.y)}}function rC(o,s,a,u,d){const g=o.ctx,v=s.circular,{color:r,lineWidth:T}=s;!v&&!u||!r||!T||a<0||(g.save(),g.strokeStyle=r,g.lineWidth=T,g.setLineDash(d.dash),g.lineDashOffset=d.dashOffset,g.beginPath(),ov(o,a,v,u),g.closePath(),g.stroke(),g.restore())}function oC(o,s,a){return zo(o,{label:a,index:s,type:"pointLabel"})}class Wh extends vp{constructor(s){super(s),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const s=this._padding=Dn($_(this.options)/2),a=this.width=this.maxWidth-s.width,u=this.height=this.maxHeight-s.height;this.xCenter=Math.floor(this.left+a/2+s.left),this.yCenter=Math.floor(this.top+u/2+s.top),this.drawingArea=Math.floor(Math.min(a,u)/2)}determineDataLimits(){const{min:s,max:a}=this.getMinMax(!1);this.min=Yi(s)&&!isNaN(s)?s:0,this.max=Yi(a)&&!isNaN(a)?a:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/$_(this.options))}generateTickLabels(s){vp.prototype.generateTickLabels.call(this,s),this._pointLabels=this.getLabels().map((a,u)=>{const d=Ci(this.options.pointLabels.callback,[a,u],this);return d||d===0?d:""}).filter((a,u)=>this.chart.getDataVisibility(u))}fit(){const s=this.options;s.display&&s.pointLabels.display?XA(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(s,a,u,d){this.xCenter+=Math.floor((s-a)/2),this.yCenter+=Math.floor((u-d)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(s,a,u,d))}getIndexAngle(s){const a=Ri/(this._pointLabels.length||1),u=this.options.startAngle||0;return as(s*a+Gs(u))}getDistanceFromCenterForValue(s){if(ei(s))return NaN;const a=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-s)*a:(s-this.min)*a}getValueForDistanceFromCenter(s){if(ei(s))return NaN;const a=s/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-a:this.min+a}getPointLabelContext(s){const a=this._pointLabels||[];if(s>=0&&s<a.length){const u=a[s];return oC(this.getContext(),s,u)}}getPointPosition(s,a,u=0){const d=this.getIndexAngle(s)-Ki+u;return{x:Math.cos(d)*a+this.xCenter,y:Math.sin(d)*a+this.yCenter,angle:d}}getPointPositionForValue(s,a){return this.getPointPosition(s,this.getDistanceFromCenterForValue(a))}getBasePosition(s){return this.getPointPositionForValue(s||0,this.getBaseValue())}getPointLabelPosition(s){const{left:a,top:u,right:d,bottom:g}=this._pointLabelItems[s];return{left:a,top:u,right:d,bottom:g}}drawBackground(){const{backgroundColor:s,grid:{circular:a}}=this.options;if(s){const u=this.ctx;u.save(),u.beginPath(),ov(this,this.getDistanceFromCenterForValue(this._endValue),a,this._pointLabels.length),u.closePath(),u.fillStyle=s,u.fill(),u.restore()}}drawGrid(){const s=this.ctx,a=this.options,{angleLines:u,grid:d,border:g}=a,v=this._pointLabels.length;let r,T,I;if(a.pointLabels.display&&sC(this,v),d.display&&this.ticks.forEach((R,F)=>{if(F!==0){T=this.getDistanceFromCenterForValue(R.value);const U=this.getContext(F),Y=d.setContext(U),ie=g.setContext(U);rC(this,Y,T,v,ie)}}),u.display){for(s.save(),r=v-1;r>=0;r--){const R=u.setContext(this.getPointLabelContext(r)),{color:F,lineWidth:U}=R;!U||!F||(s.lineWidth=U,s.strokeStyle=F,s.setLineDash(R.borderDash),s.lineDashOffset=R.borderDashOffset,T=this.getDistanceFromCenterForValue(a.ticks.reverse?this.min:this.max),I=this.getPointPosition(r,T),s.beginPath(),s.moveTo(this.xCenter,this.yCenter),s.lineTo(I.x,I.y),s.stroke())}s.restore()}}drawBorder(){}drawLabels(){const s=this.ctx,a=this.options,u=a.ticks;if(!u.display)return;const d=this.getIndexAngle(0);let g,v;s.save(),s.translate(this.xCenter,this.yCenter),s.rotate(d),s.textAlign="center",s.textBaseline="middle",this.ticks.forEach((r,T)=>{if(T===0&&!a.reverse)return;const I=u.setContext(this.getContext(T)),R=hn(I.font);if(g=this.getDistanceFromCenterForValue(this.ticks[T].value),I.showLabelBackdrop){s.font=R.string,v=s.measureText(r.label).width,s.fillStyle=I.backdropColor;const F=Dn(I.backdropPadding);s.fillRect(-v/2-F.left,-g-R.size/2-F.top,v+F.width,R.size+F.height)}ja(s,r.label,0,-g,R,{color:I.color})}),s.restore()}drawTitle(){}}ut(Wh,"id","radialLinear"),ut(Wh,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Tp.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(s){return s},padding:5,centerPointLabels:!1}}),ut(Wh,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),ut(Wh,"descriptors",{angleLines:{_fallback:"grid"}});const Ap={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Jn=Object.keys(Ap);function aC(o,s){return o-s}function vx(o,s){if(ei(s))return null;const a=o._adapter,{parser:u,round:d,isoWeekday:g}=o._parseOpts;let v=s;return typeof u=="function"&&(v=u(v)),Yi(v)||(v=typeof u=="string"?a.parse(v,u):a.parse(v)),v===null?null:(d&&(v=d==="week"&&(Ql(g)||g===!0)?a.startOf(v,"isoWeek",g):a.startOf(v,d)),+v)}function bx(o,s,a,u){const d=Jn.length;for(let g=Jn.indexOf(o);g<d-1;++g){const v=Ap[Jn[g]],r=v.steps?v.steps:Number.MAX_SAFE_INTEGER;if(v.common&&Math.ceil((a-s)/(r*v.size))<=u)return Jn[g]}return Jn[d-1]}function lC(o,s,a,u,d){for(let g=Jn.length-1;g>=Jn.indexOf(a);g--){const v=Jn[g];if(Ap[v].common&&o._adapter.diff(d,u,v)>=s-1)return v}return Jn[a?Jn.indexOf(a):0]}function cC(o){for(let s=Jn.indexOf(o)+1,a=Jn.length;s<a;++s)if(Ap[Jn[s]].common)return Jn[s]}function wx(o,s,a){if(!a)o[s]=!0;else if(a.length){const{lo:u,hi:d}=im(a,s),g=a[u]>=s?a[u]:a[d];o[g]=!0}}function hC(o,s,a,u){const d=o._adapter,g=+d.startOf(s[0].value,u),v=s[s.length-1].value;let r,T;for(r=g;r<=v;r=+d.add(r,1,u))T=a[r],T>=0&&(s[T].major=!0);return s}function Tx(o,s,a){const u=[],d={},g=s.length;let v,r;for(v=0;v<g;++v)r=s[v],d[r]=v,u.push({value:r,major:!1});return g===0||!a?u:hC(o,u,d,a)}class ou extends Va{constructor(s){super(s),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(s,a={}){const u=s.time||(s.time={}),d=this._adapter=new yS._date(s.adapters.date);d.init(a),Zh(u.displayFormats,d.formats()),this._parseOpts={parser:u.parser,round:u.round,isoWeekday:u.isoWeekday},super.init(s),this._normalized=a.normalized}parse(s,a){return s===void 0?null:vx(this,s)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const s=this.options,a=this._adapter,u=s.time.unit||"day";let{min:d,max:g,minDefined:v,maxDefined:r}=this.getUserBounds();function T(I){!v&&!isNaN(I.min)&&(d=Math.min(d,I.min)),!r&&!isNaN(I.max)&&(g=Math.max(g,I.max))}(!v||!r)&&(T(this._getLabelBounds()),(s.bounds!=="ticks"||s.ticks.source!=="labels")&&T(this.getMinMax(!1))),d=Yi(d)&&!isNaN(d)?d:+a.startOf(Date.now(),u),g=Yi(g)&&!isNaN(g)?g:+a.endOf(Date.now(),u)+1,this.min=Math.min(d,g-1),this.max=Math.max(d+1,g)}_getLabelBounds(){const s=this.getLabelTimestamps();let a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;return s.length&&(a=s[0],u=s[s.length-1]),{min:a,max:u}}buildTicks(){const s=this.options,a=s.time,u=s.ticks,d=u.source==="labels"?this.getLabelTimestamps():this._generate();s.bounds==="ticks"&&d.length&&(this.min=this._userMin||d[0],this.max=this._userMax||d[d.length-1]);const g=this.min,v=this.max,r=GE(d,g,v);return this._unit=a.unit||(u.autoSkip?bx(a.minUnit,this.min,this.max,this._getLabelCapacity(g)):lC(this,r.length,a.minUnit,this.min,this.max)),this._majorUnit=!u.major.enabled||this._unit==="year"?void 0:cC(this._unit),this.initOffsets(d),s.reverse&&r.reverse(),Tx(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(s=>+s.value))}initOffsets(s=[]){let a=0,u=0,d,g;this.options.offset&&s.length&&(d=this.getDecimalForValue(s[0]),s.length===1?a=1-d:a=(this.getDecimalForValue(s[1])-d)/2,g=this.getDecimalForValue(s[s.length-1]),s.length===1?u=g:u=(g-this.getDecimalForValue(s[s.length-2]))/2);const v=s.length<3?.5:.25;a=mn(a,0,v),u=mn(u,0,v),this._offsets={start:a,end:u,factor:1/(a+1+u)}}_generate(){const s=this._adapter,a=this.min,u=this.max,d=this.options,g=d.time,v=g.unit||bx(g.minUnit,a,u,this._getLabelCapacity(a)),r=Vt(d.ticks.stepSize,1),T=v==="week"?g.isoWeekday:!1,I=Ql(T)||T===!0,R={};let F=a,U,Y;if(I&&(F=+s.startOf(F,"isoWeek",T)),F=+s.startOf(F,I?"day":v),s.diff(u,a,v)>1e5*r)throw new Error(a+" and "+u+" are too far apart with stepSize of "+r+" "+v);const ie=d.ticks.source==="data"&&this.getDataTimestamps();for(U=F,Y=0;U<u;U=+s.add(U,r,v),Y++)wx(R,U,ie);return(U===u||d.bounds==="ticks"||Y===1)&&wx(R,U,ie),Object.keys(R).sort((ce,he)=>ce-he).map(ce=>+ce)}getLabelForValue(s){const a=this._adapter,u=this.options.time;return u.tooltipFormat?a.format(s,u.tooltipFormat):a.format(s,u.displayFormats.datetime)}format(s,a){const d=this.options.time.displayFormats,g=this._unit,v=a||d[g];return this._adapter.format(s,v)}_tickFormatFunction(s,a,u,d){const g=this.options,v=g.ticks.callback;if(v)return Ci(v,[s,a,u],this);const r=g.time.displayFormats,T=this._unit,I=this._majorUnit,R=T&&r[T],F=I&&r[I],U=u[a],Y=I&&F&&U&&U.major;return this._adapter.format(s,d||(Y?F:R))}generateTickLabels(s){let a,u,d;for(a=0,u=s.length;a<u;++a)d=s[a],d.label=this._tickFormatFunction(d.value,a,s)}getDecimalForValue(s){return s===null?NaN:(s-this.min)/(this.max-this.min)}getPixelForValue(s){const a=this._offsets,u=this.getDecimalForValue(s);return this.getPixelForDecimal((a.start+u)*a.factor)}getValueForPixel(s){const a=this._offsets,u=this.getDecimalForPixel(s)/a.factor-a.end;return this.min+u*(this.max-this.min)}_getLabelSize(s){const a=this.options.ticks,u=this.ctx.measureText(s).width,d=Gs(this.isHorizontal()?a.maxRotation:a.minRotation),g=Math.cos(d),v=Math.sin(d),r=this._resolveTickFontOptions(0).size;return{w:u*g+r*v,h:u*v+r*g}}_getLabelCapacity(s){const a=this.options.time,u=a.displayFormats,d=u[a.unit]||u.millisecond,g=this._tickFormatFunction(s,0,Tx(this,[s],this._majorUnit),d),v=this._getLabelSize(g),r=Math.floor(this.isHorizontal()?this.width/v.w:this.height/v.h)-1;return r>0?r:1}getDataTimestamps(){let s=this._cache.data||[],a,u;if(s.length)return s;const d=this.getMatchingVisibleMetas();if(this._normalized&&d.length)return this._cache.data=d[0].controller.getAllParsedValues(this);for(a=0,u=d.length;a<u;++a)s=s.concat(d[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(s)}getLabelTimestamps(){const s=this._cache.labels||[];let a,u;if(s.length)return s;const d=this.getLabels();for(a=0,u=d.length;a<u;++a)s.push(vx(this,d[a]));return this._cache.labels=this._normalized?s:this.normalize(s)}normalize(s){return y1(s.sort(aC))}}ut(ou,"id","time"),ut(ou,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Kd(o,s,a){let u=0,d=o.length-1,g,v,r,T;a?(s>=o[u].pos&&s<=o[d].pos&&({lo:u,hi:d}=Fr(o,"pos",s)),{pos:g,time:r}=o[u],{pos:v,time:T}=o[d]):(s>=o[u].time&&s<=o[d].time&&({lo:u,hi:d}=Fr(o,"time",s)),{time:g,pos:r}=o[u],{time:v,pos:T}=o[d]);const I=v-g;return I?r+(T-r)*(s-g)/I:r}class q_ extends ou{constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const s=this._getTimestampsForTable(),a=this._table=this.buildLookupTable(s);this._minPos=Kd(a,this.min),this._tableRange=Kd(a,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){const{min:a,max:u}=this,d=[],g=[];let v,r,T,I,R;for(v=0,r=s.length;v<r;++v)I=s[v],I>=a&&I<=u&&d.push(I);if(d.length<2)return[{time:a,pos:0},{time:u,pos:1}];for(v=0,r=d.length;v<r;++v)R=d[v+1],T=d[v-1],I=d[v],Math.round((R+T)/2)!==I&&g.push({time:I,pos:v/(r-1)});return g}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;const a=this.getDataTimestamps(),u=this.getLabelTimestamps();return a.length&&u.length?s=this.normalize(a.concat(u)):s=a.length?a:u,s=this._cache.all=s,s}getDecimalForValue(s){return(Kd(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){const a=this._offsets,u=this.getDecimalForPixel(s)/a.factor-a.end;return Kd(this._table,u*this._tableRange+this._minPos,!0)}}ut(q_,"id","timeseries"),ut(q_,"defaults",ou.defaults);var uC=Object.freeze({__proto__:null,CategoryScale:V_,LinearScale:U_,LogarithmicScale:G_,RadialLinearScale:Wh,TimeScale:ou,TimeSeriesScale:q_});const dC=[gS,ZM,VA,uC];lr.register(...dC);let Da=["villages-travel-time-simple","villages-travel-time-detailed"],Jd=["villages-travel-time-detailed","villages-travel-time-simple"];Jh.accessToken="pk.eyJ1IjoiaGlnaGVzdHJvYWQiLCJhIjoiY2lzNjlpa3c3MGQ3cDJ6cDFzMXZpZTNmMCJ9.M1X4AOcuj4n3VT01ze0x5Q";const Mi=new Jh.Map({container:"map",style:"mapbox://styles/highestroad/clg35ltys000m01nhht5my9n3",center:[29.519,-1.956],zoom:8.2,hash:!0}),pC=new Jh.NavigationControl;Mi.addControl(pC,"bottom-left");let au=[];for(let o=1;o<=4;o++){let s=document.getElementById("dropdown"+o);au.push(s)}Kl(Yl.dropdown1,dropdown1);dropdown1.value="Demographics";Kl(Yl.dropdown2[dropdown1.value],dropdown2);dropdown2.value="Male Education";Kl(Yl.dropdown3[dropdown1.value],dropdown3);dropdown3.value="N/A";Kl(Yl.dropdown4,dropdown4);dropdown4.disabled=!1;function Ex(o){return o.replace(/\s/g,"")}let Xl={};for(let o=1;o<=4;o++){let s="dropdown"+o;Xl[s]=au[o-1].value}function fC(){for(let o=0;o<4;o++)Xl[au[o].id]=au[o].value}au.forEach(o=>{o.addEventListener("change",function(){o.id=="dropdown1"&&(Kl(Yl.dropdown2[Ex(o.value)],dropdown2),Kl(Yl.dropdown3[Ex(o.value)],dropdown3)),o.id=="dropdown4"&&j2(dropdown4.value),fC(),U2(Xl)})});let _C={labels:["Primary Schools","Secondary Schools","Health Centers","Hospitals","Markets"],datasets:[{label:"Travel Time With Bridges",data:[],fill:"+1",backgroundColor:"rgba(117, 117, 117, 0.3)",borderColor:"rgb(158, 199, 163)",pointBackgroundColor:"rgb(158, 199, 163)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(54, 162, 235)",clip:!1},{label:"Travel Time Without Bridges",data:[],fill:!1,backgroundColor:"rgba(206, 97, 96, 0.5)",borderColor:"rgb(206, 97, 96)",pointBackgroundColor:"rgb(206, 97, 96)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(255, 99, 132)",clip:!1}]},mC={type:"radar",data:_C,options:{scale:{r:{min:0,max:120},ticks:{beginAtZero:!0,min:0,max:120,stepSize:30}},elements:{line:{borderWidth:3}},interaction:{mode:"index"},plugins:{tooltip:{callbacks:{label:function(o){let s=o.dataset.label||"";o.dataset.data[o.dataIndex];let a=0;return console.log("label is"+o.dataset.label),s=="Travel Time With Bridges"?a=Math.round(jh[o.dataIndex]):s=="Travel Time Without Bridges"?a=Math.round(Qd[o.dataIndex]):(console.log("else"),a=o.dataset.data[o.dataIndex]),s+=": "+a+" minutes",s}}}}}},gC={labels:["Children","Teens","Adult Men","Adult Women","Elderly"],datasets:[{label:"Population",data:[],backgroundColor:["#36A2EB","#FF6384","#FFCE56","#B2BEB5"],hoverOffset:4}]},yC={type:"pie",data:gC,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Population"}}}},A_=new lr(document.getElementById("click-panel-canvas"),mC),Sx=new lr(document.getElementById("click-panel-canvas2"),yC);Mi.on("load",function(){V2(Mi);const o=new oE({accessToken:Jh.accessToken,mapboxgl:Jh,bbox:[28.856,-2.84,30.8954,-1.0546]});document.getElementById("geocoder").appendChild(o.onAdd(Mi));let s=null;Jd=["hex-8-layer"],Da=["hex-8-layer","bridge-point","health-point","edu-point"];for(let a=0;a<Da.length;a++)Mi.on("mousemove",Da[a],function(u){u.features[0].id&&(u.features[0].id,Mi.getCanvas().style.cursor="pointer",G0(Da[a],u.features[0]))});for(let a=0;a<Da.length;a++)Mi.on("mouseleave",Da[a],function(u){G0(Da[a]),Mi.getCanvas().style.cursor=""});for(let a=0;a<Jd.length;a++)Mi.on("click",function(u){document.getElementById("click-panel").classList.remove("show"),document.getElementById("control-panel").classList.remove("left"),s!==null&&Mi.setFeatureState({source:"hex-8-source",id:s},{click:!1}),s=null}),Mi.on("click",Jd[a],function(u){N2(Jd[a],u.features[0].properties),document.getElementById("control-panel").classList.add("left"),u.features.length>0&&(s!==null&&Mi.setFeatureState({source:"hex-8-source",id:s},{click:!1}),s=u.features[0].id,Mi.setFeatureState({source:"hex-8-source",id:s},{click:!0}))})});
