var qw=Object.defineProperty;var $w=(o,s,a)=>s in o?qw(o,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):o[s]=a;var ue=(o,s,a)=>($w(o,typeof s!="symbol"?s+"":s,a),a);(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))u(p);new MutationObserver(p=>{for(const g of p)if(g.type==="childList")for(const v of g.addedNodes)v.tagName==="LINK"&&v.rel==="modulepreload"&&u(v)}).observe(document,{childList:!0,subtree:!0});function a(p){const g={};return p.integrity&&(g.integrity=p.integrity),p.referrerPolicy&&(g.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?g.credentials="include":p.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(p){if(p.ep)return;p.ep=!0;const g=a(p);fetch(p.href,g)}})();function Ww(o){return o<2?"Low":o>=2&&o<4?"Medium":o>=4&&o<8?"High":o>=8?"Highest":"N/A"}const C={key:["Menu Options","hover panel text","color scheme"],"h3-index":[["N/A"],["H3 Index",""],"rainbow"],row_col:[["N/A"],["Row/Col",""],"rainbow"],female_educational_attainment_mean:[["Demographics","Female Education","N/A"],["Avg. Female Education","years"],"rdylgn",{max:8.6589,min:3.4551,mean:4.8228326,median:4.7054,"98_percentile":6.68306,"99_percentile":7.185144,"2_percentile":3.999912,"1_percentile":3.921612,quantiles:[3.4551,4.26988,4.4051,4.5131,4.6083,4.7054,4.80628,4.9392,5.11134,5.48352,8.6589],style_stops_99:[3.921612,4.737495005130768,5.553377985954285,6.3692609667778015,7.185144],style_stops_98:[3.999912,4.670699059963226,5.341486096382141,6.012273132801056,6.68306],style_stops_maxmin:[3.4551,4.756050109863281,6.057000160217285,7.357950210571289,8.6589]}],females_0_4:[["Population","Female 0-4","N/A"],["Population","females"],"magma",{max:1174,min:0,mean:39.94789195806871,median:33,"98_percentile":135,"99_percentile":198,"2_percentile":2,"1_percentile":1,quantiles:[0,10,17,23,28,33,38,44,52,68.29999999999927,1174],style_stops_99:[1,50.25,99.5,148.75,198],style_stops_98:[2,35.25,68.5,101.75,135],style_stops_maxmin:[0,293.5,587,880.5,1174]}],females_0_9:[["Population","Female 0-9","N/A"],["Population","females"],"magma",{max:2347,min:0,mean:86.69309051955008,median:72,"98_percentile":287,"99_percentile":414.89000000000306,"2_percentile":5,"1_percentile":2,quantiles:[0,21,38,51,62,72,83,96,114,148,2347],style_stops_99:[2,105.22250000000076,208.44500000000153,311.6675000000023,414.89000000000306],style_stops_98:[5,75.5,146,216.5,287],style_stops_maxmin:[0,586.75,1173.5,1760.25,2347]}],females_10_14:[["Population","Female 10-14","N/A"],["Population","females"],"magma",{max:1087,min:0,mean:43.51254877955467,median:36,"98_percentile":145,"99_percentile":207,"2_percentile":2,"1_percentile":1,quantiles:[0,11,19,26,31,36,42,48,57,75,1087],style_stops_99:[1,52.5,104,155.5,207],style_stops_98:[2,37.75,73.5,109.25,145],style_stops_maxmin:[0,271.75,543.5,815.25,1087]}],females_15_49:[["Population","Female 15-49","N/A"],["Population","females"],"magma",{max:5236,min:0,mean:176.1674573418012,median:147,"98_percentile":583.2599999999984,"99_percentile":847.630000000001,"2_percentile":10,"1_percentile":5,quantiles:[0,43,77,104,126,147,168,193,228,296,5236],style_stops_99:[5,215.65750000000025,426.3150000000005,636.9725000000008,847.630000000001],style_stops_98:[10,153.3149999999996,296.6299999999992,439.9449999999988,583.2599999999984],style_stops_maxmin:[0,1309,2618,3927,5236]}],females_50_64:[["Population","Female 50-64","N/A"],["Population","females"],"magma",{max:487,min:0,mean:25.222740837095415,median:22,"98_percentile":81,"99_percentile":106,"2_percentile":1,"1_percentile":0,quantiles:[0,6,11,15,19,22,25,29,34,44,487],style_stops_99:[0,26.5,53,79.5,106],style_stops_98:[1,21,41,61,81],style_stops_maxmin:[0,121.75,243.5,365.25,487]}],females_5_9:[["Population","Female 5-9","N/A"],["Population","females"],"magma",{max:1173,min:0,mean:46.2448542352131,median:39,"98_percentile":151,"99_percentile":218.63000000000102,"2_percentile":2,"1_percentile":1,quantiles:[0,11,20,27,33,39,45,51,61,80,1173],style_stops_99:[1,55.407500000000255,109.81500000000051,164.22250000000076,218.63000000000102],style_stops_98:[2,39.25,76.5,113.75,151],style_stops_maxmin:[0,293.25,586.5,879.75,1173]}],females_65_plus:[["Population","Female 65+","N/A"],["Population","females"],"magma",{max:181,min:0,mean:10.05325579615885,median:9,"98_percentile":33,"99_percentile":44,"2_percentile":0,"1_percentile":0,quantiles:[0,2,4,6,7,9,10,12,14,18,181],style_stops_99:[0,11,22,33,44],style_stops_98:[0,8.25,16.5,24.75,33],style_stops_maxmin:[0,45.25,90.5,135.75,181]}],male_educational_attainment_mean:[["Demographics","Male Education","N/A"],["Avg. Male Education","years"],"rdylgn",{max:8.9661,min:4.0105,mean:5.114354,median:4.9656,"98_percentile":7.050552,"99_percentile":7.602576,"2_percentile":4.444456,"1_percentile":4.357428,quantiles:[4.0105,4.6616,4.7679,4.8369,4.8977,4.9656,5.0479,5.152,5.3074403,5.70886,8.9661],style_stops_99:[4.357428,5.168715000152588,5.980001926422119,6.79128885269165,7.602576],style_stops_98:[4.444456,5.0959800481796265,5.747503995895386,6.399027943611145,7.050552],style_stops_maxmin:[4.0105,5.249399900436401,6.48829984664917,7.7271997928619385,8.9661]}],males_0_4:[["Population","Male 0-4","N/A"],["Population","males"],"magma",{max:1239,min:0,mean:40.78728288315862,median:34,"98_percentile":138,"99_percentile":200,"2_percentile":2,"1_percentile":1,quantiles:[0,10,18,24,29,34,39,45,53,70,1239],style_stops_99:[1,50.75,100.5,150.25,200],style_stops_98:[2,36,70,104,138],style_stops_maxmin:[0,309.75,619.5,929.25,1239]}],males_0_9:[["Population","Male 0-9","N/A"],["Population","males"],"magma",{max:2413,min:0,mean:88.35660723850333,median:74,"98_percentile":293,"99_percentile":421.630000000001,"2_percentile":5,"1_percentile":2,quantiles:[0,22,39,52,63,74,84,98,116,151,2413],style_stops_99:[2,106.90750000000025,211.8150000000005,316.72250000000076,421.630000000001],style_stops_98:[5,77,149,221,293],style_stops_maxmin:[0,603.25,1206.5,1809.75,2413]}],males_10_14:[["Population","Male 10-14","N/A"],["Population","males"],"magma",{max:987,min:0,mean:44.25835947662407,median:37,"98_percentile":147,"99_percentile":207.63000000000102,"2_percentile":2,"1_percentile":1,quantiles:[0,11,20,26,32,37,43,49,59,77,987],style_stops_99:[1,52.657500000000255,104.31500000000051,155.97250000000076,207.63000000000102],style_stops_98:[2,38.25,74.5,110.75,147],style_stops_maxmin:[0,246.75,493.5,740.25,987]}],males_15_49:[["Population","Male 15-49","N/A"],["Population","males"],"magma",{max:7696,min:0,mean:175.09771214323973,median:137,"98_percentile":614.2599999999984,"99_percentile":973.890000000003,"2_percentile":9,"1_percentile":5,quantiles:[0,41,73,98,118,137,157,181,215,287,7696],style_stops_99:[5,247.22250000000076,489.4450000000015,731.6675000000023,973.890000000003],style_stops_98:[9,160.3149999999996,311.6299999999992,462.9449999999988,614.2599999999984],style_stops_maxmin:[0,1924,3848,5772,7696]}],males_50_64:[["Population","Male 50-64","N/A"],["Population","males"],"magma",{max:626,min:0,mean:24.470005356186395,median:20,"98_percentile":85,"99_percentile":123,"2_percentile":1,"1_percentile":0,quantiles:[0,6,11,14,17,20,23,27,32,42,626],style_stops_99:[0,30.75,61.5,92.25,123],style_stops_98:[1,22,43,64,85],style_stops_maxmin:[0,156.5,313,469.5,626]}],males_5_9:[["Population","Male 5-9","N/A"],["Population","males"],"magma",{max:1173,min:0,mean:47.07093121126329,median:40,"98_percentile":154,"99_percentile":222,"2_percentile":2,"1_percentile":1,quantiles:[0,11,21,28,34,40,45,52,62,81,1173],style_stops_99:[1,56.25,111.5,166.75,222],style_stops_98:[2,40,78,116,154],style_stops_maxmin:[0,293.25,586.5,879.75,1173]}],males_65_plus:[["Population","Male 65+","N/A"],["Population","males"],"magma",{max:116,min:0,mean:7.452827301247226,median:6,"98_percentile":25,"99_percentile":33,"2_percentile":0,"1_percentile":0,quantiles:[0,2,3,4,5,6,7,9,10,13,116],style_stops_99:[0,8.25,16.5,24.75,33],style_stops_98:[0,6.25,12.5,18.75,25],style_stops_maxmin:[0,29,58,87,116]}],pop_0_4:[["Population","Children 0-4","N/A"],["Population","people"],"magma",{max:2414,min:0,mean:81.23295584972071,median:67,"98_percentile":273.2599999999984,"99_percentile":401.630000000001,"2_percentile":4,"1_percentile":2,quantiles:[0,20,36,48,58,67,77,89,106,139,2414],style_stops_99:[2,101.90750000000025,201.8150000000005,301.72250000000076,401.630000000001],style_stops_98:[4,71.3149999999996,138.6299999999992,205.9449999999988,273.2599999999984],style_stops_maxmin:[0,603.5,1207,1810.5,2414]}],pop_0_9:[["Population","Children 0-9","N/A"],["Population","people"],"magma",{max:4761,min:0,mean:175.5523375927768,median:146,"98_percentile":581,"99_percentile":837,"2_percentile":10,"1_percentile":5,quantiles:[0,44,78,104,126,146,168,194,230,300,4761],style_stops_99:[5,213,421,629,837],style_stops_98:[10,152.75,295.5,438.25,581],style_stops_maxmin:[0,1190.25,2380.5,3570.75,4761]}],pop_10_14:[["Population","Youth 10-14","N/A"],["Population","people"],"magma",{max:2074,min:0,mean:88.26807712908409,median:74,"98_percentile":293,"99_percentile":413,"2_percentile":5,"1_percentile":2,quantiles:[0,22,39,53,63,74,85,98,117,153,2074],style_stops_99:[2,104.75,207.5,310.25,413],style_stops_98:[5,77,149,221,293],style_stops_maxmin:[0,518.5,1037,1555.5,2074]}],pop_15_49:[["Population","People 15-49","N/A"],["Population","people"],"magma",{max:12933,min:0,mean:351.7657051036805,median:285,"98_percentile":1182,"99_percentile":1817.260000000002,"2_percentile":19,"1_percentile":10,quantiles:[0,86,152,203,245,285,327,374,444,585,12933],style_stops_99:[10,461.8150000000005,913.630000000001,1365.4450000000015,1817.260000000002],style_stops_98:[19,309.75,600.5,891.25,1182],style_stops_maxmin:[0,3233.25,6466.5,9699.75,12933]}],pop_50_64:[["Population","People 50-64","N/A"],["Population","people"],"magma",{max:1e3,min:0,mean:50.18991506618716,median:43,"98_percentile":164,"99_percentile":228,"2_percentile":3,"1_percentile":1,quantiles:[0,12,23,30,37,43,49,56,66,87,1e3],style_stops_99:[1,57.75,114.5,171.25,228],style_stops_98:[3,43.25,83.5,123.75,164],style_stops_maxmin:[0,250,500,750,1e3]}],pop_5_9:[["Population","Children 5-9","N/A"],["Population","people"],"magma",{max:2347,min:0,mean:93.82137118371719,median:79,"98_percentile":304,"99_percentile":442,"2_percentile":5,"1_percentile":2,quantiles:[0,23,42,56,68,79,90,104,124,161,2347],style_stops_99:[2,112,222,332,442],style_stops_98:[5,79.75,154.5,229.25,304],style_stops_maxmin:[0,586.75,1173.5,1760.25,2347]}],pop_65_plus:[["Population","People 65+","N/A"],["Population","people"],"magma",{max:295,min:0,mean:17.99812533476165,median:16,"98_percentile":57,"99_percentile":78,"2_percentile":1,"1_percentile":0,quantiles:[0,4,8,11,13,16,18,21,24,32,295],style_stops_99:[0,19.5,39,58.5,78],style_stops_98:[1,15,29,43,57],style_stops_maxmin:[0,73.75,147.5,221.25,295]}],population:[["Population","All","N/A"],["Population","people"],"magma",{max:19813,min:0,mean:685.0027928686204,median:568,"98_percentile":2282.0399999999936,"99_percentile":3354.150000000005,"2_percentile":39,"1_percentile":21,quantiles:[0,169,302,405,488,568,649,746,885,1153,19813],style_stops_99:[21,854.2875000000013,1687.5750000000025,2520.862500000004,3354.150000000005],style_stops_98:[39,599.7599999999984,1160.5199999999968,1721.2799999999952,2282.0399999999936],style_stops_maxmin:[0,4953.25,9906.5,14859.75,19813]}],pregnancies:[["Demographics","Pregnancies","N/A"],["Pregnancies"],"magma",{max:1470,min:0,mean:24.80560869232535,median:22,"98_percentile":69,"99_percentile":98,"2_percentile":1,"1_percentile":0,quantiles:[0,6,12,15,19,22,25,28,33,40,1470],style_stops_99:[0,24.5,49,73.5,98],style_stops_98:[1,18,35,52,69],style_stops_maxmin:[0,367.5,735,1102.5,1470]}],births:[["Demographics","Births","N/A"],["Births"],"magma",{max:1038,min:0,mean:17.36693702655138,median:15,"98_percentile":48,"99_percentile":69,"2_percentile":1,"1_percentile":0,quantiles:[0,4,8,11,13,15,17,20,23,28,1038],style_stops_99:[0,17.25,34.5,51.75,69],style_stops_98:[1,12.75,24.5,36.25,48],style_stops_maxmin:[0,259.5,519,778.5,1038]}],rwi:[["Demographics","Relative Wealth Index","N/A"],["Relative Wealth Index"],"rdylgn",{max:1.8281,min:-.6764,mean:.037351005,median:-.0138,"98_percentile":.79605,"99_percentile":1.014425,"2_percentile":-.3014,"1_percentile":-.341575,quantiles:[-.6764,-.1962,-.1374,-.0932,-.0529,-.0138,.0312,.0852,.1652,.3208,1.8281],style_stops_99:[-.341575,-.0025749802589416504,.3364250361919403,.6754250526428223,1.014425],style_stops_98:[-.3014,-.027037501335144043,.24732500314712524,.5216875076293945,.79605],style_stops_maxmin:[-.6764,-.05027502775192261,.5758499503135681,1.2019749283790588,1.8281]}],underweight:[["Demographics","Underweight","N/A"],["Underweight"],"rdylgn",{max:.2202,min:.047,mean:.085901745,median:.0853,"98_percentile":.11585,"99_percentile":.128375,"2_percentile":.0609,"1_percentile":.055725,quantiles:[.047,.0731,.0773,.0803,.0828,.0853,.0876,.0902,.0936,.0986,.2202],style_stops_99:[.055725,.07388749904930592,.09204999729990959,.11021249555051327,.128375],style_stops_98:[.0609,.07463749963790178,.08837500028312206,.10211250092834234,.11585],style_stops_maxmin:[.047,.09030000120401382,.13360000401735306,.1769000068306923,.2202]}],travel_time_all_education_facilities_fixed:[["Travel Time","With All Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:64.64993496059377,median:46,"98_percentile":280.2599999999984,"99_percentile":431,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,39,46,53,63,76,104,1700],style_stops_99:[10,30,46,60,431],style_stops_98:[11,30,46,60,280.2599999999984],style_stops_maxmin:[5,428.75,852.5,1276.25,1700]}],travel_time_all_health_facilities_optimal:[["Travel Time","With All Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:87.18452062131762,median:73,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,29,42,53,63,73,83,96,112,140,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,420,833,1246,1659]}],travel_time_constructed_sites_all_education_facilities_fixed:[["Travel Time","With Constructed Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:66.77672354426505,median:47,"98_percentile":295.2599999999984,"99_percentile":450.630000000001,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,40,47,55,64,78,110,1700],style_stops_99:[10,30,46,60,450.63],style_stops_98:[11,30,46,60,295.2599999999984],style_stops_maxmin:[5,30,46,60,1700]}],travel_time_constructed_sites_all_health_facilities_optimal:[["Travel Time","With Constructed Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:87.94938403856455,median:74,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,30,43,53,64,74,84.19999999999891,97,114,141,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,45,90,135,1659]}],travel_time_constructed_sites_health_centers_optimal:[["Travel Time","With Constructed Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:122.2729359553141,median:104,"98_percentile":376,"99_percentile":499.630000000001,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,76,90,104,119,136,159,199,1775],style_stops_99:[15,45,90,135,499.630000000001],style_stops_98:[19,45,90,135,376],style_stops_maxmin:[7,45,90,135,1775]}],travel_time_constructed_sites_health_posts_optimal:[["Travel Time","With Constructed Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:129.43029305991277,median:112,"98_percentile":342,"99_percentile":446.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,62,79,96,112,130,151,178,221,1659],style_stops_99:[15,45,90,135,446.26000000000204],style_stops_98:[19,45,90,135,342],style_stops_maxmin:[7,45,90,135,1659]}],travel_time_constructed_sites_major_hospitals_optimal:[["Travel Time","With Constructed Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:368.4278827760349,median:340,"98_percentile":967.2599999999984,"99_percentile":1111.630000000001,"2_percentile":60,"1_percentile":41,quantiles:[10,141,203,253,298,340,384,432,498,608,1774],style_stops_99:[41,60,120,180,1111.630000000001],style_stops_98:[60,286.8149999999996,513.6299999999992,740.4449999999988,967.2599999999984],style_stops_maxmin:[10,451,892,1333,1774]}],travel_time_constructed_sites_primary_schools_fixed:[["Travel Time","With Constructed Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:71.40767275974714,median:51.16,"98_percentile":299.1866666666659,"99_percentile":453.08733333333294,"2_percentile":12.863636363636363,"1_percentile":11.499789473684212,quantiles:[5.133333333333334,20.91176470588235,29.540317460317464,36.85981900452488,43.947908232118756,51.16,59.46153846153846,69.9280423280423,85.59285714285718,119.18817567567568,1700.3636363636363],style_stops_99:[11.499789473684212,30,46,60,453.08733333333294],style_stops_98:[12.863636363636363,84.44439393939373,156.02515151515112,227.60590909090848,299.1866666666659],style_stops_maxmin:[5.133333333333334,428.94090909090903,852.7484848484847,1276.5560606060606,1700.3636363636363]}],travel_time_constructed_sites_secondary_schools_fixed:[["Travel Time","With Constructed Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:98.89652336748952,median:75.22361111111111,"98_percentile":400.1361212121209,"99_percentile":529.9095833333323,"2_percentile":14.24649202047576,"1_percentile":12.264347980786338,quantiles:[5.133333333333334,28.119918699186993,41.086656671664166,52.58320895522388,63.80250000000001,75.22361111111111,87.87391304347825,103.48525252525252,125.79307692307694,169.3693633952255,1725.75],style_stops_99:[12.264347980786338,30,46,60,529.9095833333323],style_stops_98:[14.24649202047576,110.71889931838703,207.1913066162983,303.6637139142096,400.1361212121209],style_stops_maxmin:[5.133333333333334,435.28749999999997,865.4416666666666,1295.5958333333333,1725.75]}],travel_time_constructed_sites_semi_dense_urban_optimal:[["Travel Time","With Constructed Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:376.9627362460785,median:330,"98_percentile":1011,"99_percentile":1101,"2_percentile":27,"1_percentile":21,quantiles:[10,91,156,216,272,330,396,474,571,732,1758],style_stops_99:[21,60,120,180,1101],style_stops_98:[27,273,519,765,1011],style_stops_maxmin:[10,447,884,1321,1758]}],travel_time_health_centers_optimal:[["Travel Time","With All Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:120.95638533935266,median:103,"98_percentile":376,"99_percentile":497.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,60,75,89,103,118,135,157,196,1775],style_stops_99:[15,30,46,60,497.26000000000204],style_stops_98:[19,30,46,60,376],style_stops_maxmin:[7,30,46,60,1775]}],travel_time_health_posts_optimal:[["Travel Time","With All Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:127.87585125105211,median:110,"98_percentile":338,"99_percentile":445,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,78,94,110,128,149,176,219,1659],style_stops_99:[15,30,46,60,445],style_stops_98:[19,30,46,60,338],style_stops_maxmin:[7,30,46,60,1659]}],travel_time_major_hospitals_optimal:[["Travel Time","With All Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:364.9125793863341,median:336,"98_percentile":954.2599999999984,"99_percentile":1084,"2_percentile":59,"1_percentile":41,quantiles:[10,139,201,250,294,336,380,429,494,605,1774],style_stops_99:[41,60,120,180,1084],style_stops_98:[59,60,120,180,954.2599999999984],style_stops_maxmin:[10,60,120,180,1774]}],travel_time_no_sites_all_education_facilities_fixed:[["Travel Time","Without Bridges","To School"],["Travel Time","minutes"],"rdylgn",{max:1700,min:5,mean:67.1364297191828,median:47,"98_percentile":299,"99_percentile":450.630000000001,"2_percentile":11,"1_percentile":10,quantiles:[5,18,26,33,40,47,55,65,79,111,1700],style_stops_99:[10,30,45,60,450.630000000001],style_stops_98:[11,30,45,60,299],style_stops_maxmin:[5,30,45,60,1700]}],travel_time_no_sites_all_health_facilities_optimal:[["Travel Time","Without Bridges","To Healthcare"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:88.12170020659576,median:74,"98_percentile":247,"99_percentile":392,"2_percentile":15,"1_percentile":13,quantiles:[7,30,43,53,64,74,85,97,114,141,1659],style_stops_99:[13,45,90,135,392],style_stops_98:[15,45,90,135,247],style_stops_maxmin:[7,45,90,135,1659]}],travel_time_no_sites_health_centers_optimal:[["Travel Time","Without Bridges","To Health Center"],["Travel Time","minutes"],"rdylgn",{max:1775,min:7,mean:122.52620705486265,median:104,"98_percentile":376,"99_percentile":499.630000000001,"2_percentile":19,"1_percentile":15,quantiles:[7,42,61,77,90,104,119,136.89999999999782,159,199,1775],style_stops_99:[15,45,90,135,499.630000000001],style_stops_98:[19,45,90,135,376],style_stops_maxmin:[7,45,90,135,1775]}],travel_time_no_sites_health_posts_optimal:[["Travel Time","Without Bridges","To Health Post"],["Travel Time","minutes"],"rdylgn",{max:1659,min:7,mean:129.89023643737087,median:113,"98_percentile":343,"99_percentile":446.26000000000204,"2_percentile":19,"1_percentile":15,quantiles:[7,42,62,79,96,113,131,152,179,222,1659],style_stops_99:[15,45,90,135,446.26000000000204],style_stops_98:[19,45,90,135,262,343],style_stops_maxmin:[7,45,90,135,1659]}],travel_time_no_sites_major_hospitals_optimal:[["Travel Time","Without Bridges","To Hospital"],["Travel Time","minutes"],"rdylgn",{max:1774,min:10,mean:369.13463157089296,median:341,"98_percentile":967.2599999999984,"99_percentile":1111.630000000001,"2_percentile":60,"1_percentile":41,quantiles:[10,142,204,253,299,341,384,433,498,610,1774],style_stops_99:[41,60,120,180,1111.630000000001],style_stops_98:[60,60,120,180,967.2599999999984],style_stops_maxmin:[10,60,120,180,1774]}],travel_time_no_sites_primary_schools_fixed:[["Travel Time","Without Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:71.75796345160377,median:51.32727272727273,"98_percentile":301.51599999999945,"99_percentile":453.08733333333294,"2_percentile":12.864895104895105,"1_percentile":11.511820931639443,quantiles:[5.133333333333334,20.92804399057345,29.61742654508612,36.931419457735245,44.04545454545455,51.32727272727273,59.71318681318681,70.25,86.03045761440363,119.87186009538954,1700.3636363636363],style_stops_99:[11.511820931639443,30,45,60,453.08733333333294],style_stops_98:[12.864895104895105,30,45,60,301.51599999999945],style_stops_maxmin:[5.133333333333334,30,45,60,1700.3636363636363]}],travel_time_no_sites_secondary_schools_fixed:[["Travel Time","Without Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:99.44496852814716,median:75.47935435435436,"98_percentile":404.03360139860104,"99_percentile":529.9095833333323,"2_percentile":14.24649202047576,"1_percentile":12.264347980786338,quantiles:[5.133333333333334,28.146439024390244,41.16964285714287,52.75548780487805,64.05233821445442,75.47935435435436,88.23946388682054,104.18397534668718,126.51818181818189,170.43190476190478,1725.75],style_stops_99:[12.264347980786338,30,45,60,529.9095833333323],style_stops_98:[14.24649202047576,30,45,60,404.03360139860104],style_stops_maxmin:[5.133333333333334,30,45,60,1725.75]}],travel_time_no_sites_semi_dense_urban_optimal:[["Travel Time","Without Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:377.7297803963578,median:331,"98_percentile":1012,"99_percentile":1101,"2_percentile":27,"1_percentile":21,quantiles:[10,91,157,216,272,331,396,475,573,733,1758],style_stops_99:[21,60,120,180,1101],style_stops_98:[27,60,120,180,1012],style_stops_maxmin:[10,60,120,180,1758]}],travel_time_primary_schools_fixed:[["Travel Time","With All Bridges","To Primary School"],["Travel Time","minutes"],"rdylgn",{max:1700.3636363636363,min:5.133333333333334,mean:69.20764038727852,median:50.241379310344826,"98_percentile":284.9642105263155,"99_percentile":430.96133333333273,"2_percentile":12.767935916542474,"1_percentile":11.439333333333334,quantiles:[5.133333333333334,20.678656126482217,29.225929127052726,36.3762987012987,43.2402962962963,50.241379310344826,58.142857142857146,68,82.70089399744576,113.63214285714288,1700.3636363636363],style_stops_99:[11.439333333333334,30,45,60,430.96133333333273],style_stops_98:[12.767935916542474,30,45,60,284.9642105263155],style_stops_maxmin:[5.133333333333334,30,45,60,1700.3636363636363]}],travel_time_secondary_schools_fixed:[["Travel Time","With All Bridges","To Secondary School"],["Travel Time","minutes"],"rdylgn",{max:1725.75,min:5.133333333333334,mean:95.76174201155379,median:73.67567567567568,"98_percentile":385.59878787878796,"99_percentile":512.0158169934646,"2_percentile":14.202546583850932,"1_percentile":12.222857142857142,quantiles:[5.133333333333334,27.86842105263158,40.67359667359667,51.854602675059006,62.82921832884097,73.67567567567568,86,100.54747474747472,121.08325358851685,160.87112299465244,1725.75],style_stops_99:[12.222857142857142,30,45,60,512.0158169934646],style_stops_98:[14.202546583850932,30,45,60,385.59878787878796],style_stops_maxmin:[5.133333333333334,30,45,60,1725.75]}],travel_time_semi_dense_urban_optimal:[["Travel Time","With All Bridges","To Market"],["Travel Time","minutes"],"rdylgn",{max:1758,min:10,mean:373.7797842222052,median:327,"98_percentile":1007.2599999999984,"99_percentile":1093.630000000001,"2_percentile":27,"1_percentile":21,quantiles:[10,90,155,213,268,327,391,469,567,728,1758],style_stops_99:[21,60,120,180,1093.630000000001],style_stops_98:[27,60,120,180,1007.2599999999984],style_stops_maxmin:[10,60,120,180,1758]}],all_education_potential_impact:[["Impact","Potential Impact","School"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.08149055015685974,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]}],all_education_current_impact:[["Impact","Current Impact","School"],["Current Impact",""],"impactScheme",{max:8,min:0,mean:.013466982936720483,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],all_health_potential_impact:[["Impact","Potential Impact","Healthcare"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.044456347080878415,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]}],all_health_current_impact:[["Impact","Current Impact","Healthcare"],["Potential Impact",""],"impactScheme",{max:4,min:0,mean:.006580457571352055,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],health_centers_potential_impact:[["Impact","Potential Impact","Health Center"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.04690488943300941,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]}],health_centers_current_impact:[["Impact","Current Impact","Health Center"],["Current Impact",""],"impactScheme",{max:4,min:0,mean:.0055092202922947435,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],health_posts_potential_impact:[["Impact","Potential Impact","Health Post"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.05608692325350065,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]}],health_posts_current_impact:[["Impact","Current Impact","Health Post"],["Current Impact",""],"impactScheme",{max:4,min:0,mean:.010635855842069018,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],major_hospitals_potential_impact:[["Impact","Potential Impact","Hospital"],["Potential Impact",""],"impactScheme",{max:4,min:0,mean:.01614507613436376,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],major_hospitals_current_impact:[["Impact","Current Impact","Hospital"],["Current Impact",""],"impactScheme",{max:4,min:0,mean:.004973601652766088,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],primary_schools_potential_impact:[["Impact","Potential Impact","Primary School"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.07888897390772057,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]}],primary_schools_current_impact:[["Impact","Current Impact","Primary School"],["Current Impact",""],"impactScheme",{max:8,min:0,mean:.011630576172622236,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],secondary_schools_potential_impact:[["Impact","Potential Impact","Secondary School"],["Potential Impact",""],"impactScheme",{max:8,min:0,mean:.03994184711913689,median:0,"98_percentile":0,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],secondary_schools_current_impact:[["Impact","Current Impact","Secondary School"],["Current Impact",""],"impactScheme",{max:8,min:0,mean:.00711607621088071,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],semi_dense_urban_potential_impact:[["Impact","Potential Impact","Market"],["Potential Impact",""],"impactScheme",{max:4,min:0,mean:.014002601576249139,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],semi_dense_urban_current_impact:[["Impact","Current Impact","Market"],["Current Impact",""],"impactScheme",{max:4,min:0,mean:.002907644043155559,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,4],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],total_potential_impact:[["Impact","Potential Impact","All"],["Potential Impact",""],"impactScheme",{max:22,min:0,mean:.2519703114239804,median:0,"98_percentile":4,"99_percentile":6,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,22],style_stops_99:[0,1.5,3,4.5,6],style_stops_98:[0,1,2,3,4],style_stops_maxmin:[0,.1,2,4,8]}],total_current_impact:[["Impact","Current Impact","All"],["Current Impact",""],"impactScheme",{max:18,min:0,mean:.04277297421378835,median:0,"98_percentile":0,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,18],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],total_school_current_impact:[["Impact","Current Impact","School"],["Current Impact",""],"impactScheme",{max:12,min:0,mean:.018746652383502947,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,12],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],total_school_potential_impact:[["Impact","Potential Impact","School"],["Potential Impact",""],"impactScheme",{max:16,min:0,mean:.11883082102685745,median:0,"98_percentile":2,"99_percentile":4,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,16],style_stops_99:[0,1,2,3,4],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]}],total_health_current_impact:[["Impact","Current Impact","Healthcare"],["Current Impact",""],"impactScheme",{max:8,min:0,mean:.02111867778712985,median:0,"98_percentile":0,"99_percentile":0,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,8],style_stops_99:[0,0,0,0,0],style_stops_98:[0,0,0,0,0],style_stops_maxmin:[0,.1,2,4,8]}],total_health_potential_impact:[["Impact","Potential Impact","Healthcare"],["Potential Impact",""],"impactScheme",{max:10,min:0,mean:.11913688882087382,median:0,"98_percentile":2,"99_percentile":2,"2_percentile":0,"1_percentile":0,quantiles:[0,0,0,0,0,0,0,0,0,0,10],style_stops_99:[0,.5,1,1.5,2],style_stops_98:[0,.5,1,1.5,2],style_stops_maxmin:[0,.1,2,4,8]}]},W={inferno:["#000004","#57106e","#bc3754","#f98e09","#fcffa4"],magma:["#000004","#51127c","#b73779","#fc8961","#fcfdbf"],impactScheme:["rgba(255, 255, 255, 0)","#f7fcb9","#ffeda0","#7fcdbb","#2ca25f"],plasma:["#0d0887","#7e03a8","#cc4778","#f89540","#f0f921"],viridis:["#440154","#3b528b","#21918c","#5ec962","#fde725"],cividis:["#002051","#3c4d6e","#7f7c75","#bbaf71","#fdea45"],turbo:["#23171b","#26bce1","#95fb51","#ff821d","#900c00"],warm:["#6e40aa","#d23ea7","#ff5e63","#efa72f","#aff05b"],cool:["#6e40aa","#417de0","#1ac7c2","#40f373","#aff05b"],blues:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],greens:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],grays:["#f7f7f7","#cccccc","#969696","#636363","#252525"],oranges:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],purples:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],reds:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],bugn:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],bupu:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],gnbu:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],orrd:["#fee8c8","#fdbb84","#e34a33","#b30000"],pubu:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],pubugn:["#f6eff7","#bdc9e1","#67a9cf","#1c9099","#016c59"],puor:["#f1a340","#f7f7f7","#998ec3","#762a83"],purd:["#e7e1ef","#c994c7","#dd1c77","#980043"],rdpu:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],ylgn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#31a354"],ylgnbu:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],ylorbr:["#ffffe5","#fff7bc","#fec44f","#d95f0e","#993404"],ylorrd:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],brbg:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],prgn:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],piyg:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],puor:["#5e3c99","#b2abd2","#f7f7f7","#fdb863","#e66101"],rdbu:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],rdgy:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],rdylbu:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],rdylgn:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],spectral:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],rainbow:["#6e40aa","#ff5e63","#aff05b","#1ac7c2","#6e40aa"],sinebow:["#ff4040","#7fee11","#00bfbf","#7f11ee","#ff4040"],tableau10:["#4e79a7","#f28e2c","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7","#9c755f","#bab0ab"],category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],pastel:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},O_={female_educational_attainment_mean:{"fill-color":["interpolate",["linear"],["get","female_educational_attainment_mean"],C.female_educational_attainment_mean[3].style_stops_99[0],W[C.female_educational_attainment_mean[2]][0],C.female_educational_attainment_mean[3].style_stops_99[1],W[C.female_educational_attainment_mean[2]][1],C.female_educational_attainment_mean[3].style_stops_99[2],W[C.female_educational_attainment_mean[2]][2],C.female_educational_attainment_mean[3].style_stops_99[3],W[C.female_educational_attainment_mean[2]][3],C.female_educational_attainment_mean[3].style_stops_99[4],W[C.female_educational_attainment_mean[2]][4]]},females_0_4:{"fill-color":["interpolate",["linear"],["get","females_0_4"],C.females_0_4[3].style_stops_99[0],W[C.females_0_4[2]][4],C.females_0_4[3].style_stops_99[1],W[C.females_0_4[2]][3],C.females_0_4[3].style_stops_99[2],W[C.females_0_4[2]][2],C.females_0_4[3].style_stops_99[3],W[C.females_0_4[2]][1],C.females_0_4[3].style_stops_99[4],W[C.females_0_4[2]][0]]},females_0_9:{"fill-color":["interpolate",["linear"],["get","females_0_9"],C.females_0_9[3].style_stops_99[0],W[C.females_0_9[2]][4],C.females_0_9[3].style_stops_99[1],W[C.females_0_9[2]][3],C.females_0_9[3].style_stops_99[2],W[C.females_0_9[2]][2],C.females_0_9[3].style_stops_99[3],W[C.females_0_9[2]][1],C.females_0_9[3].style_stops_99[4],W[C.females_0_9[2]][0]]},females_10_14:{"fill-color":["interpolate",["linear"],["get","females_10_14"],C.females_10_14[3].style_stops_99[0],W[C.females_10_14[2]][4],C.females_10_14[3].style_stops_99[1],W[C.females_10_14[2]][3],C.females_10_14[3].style_stops_99[2],W[C.females_10_14[2]][2],C.females_10_14[3].style_stops_99[3],W[C.females_10_14[2]][1],C.females_10_14[3].style_stops_99[4],W[C.females_10_14[2]][0]]},females_15_49:{"fill-color":["interpolate",["linear"],["get","females_15_49"],C.females_15_49[3].style_stops_99[0],W[C.females_15_49[2]][4],C.females_15_49[3].style_stops_99[1],W[C.females_15_49[2]][3],C.females_15_49[3].style_stops_99[2],W[C.females_15_49[2]][2],C.females_15_49[3].style_stops_99[3],W[C.females_15_49[2]][1],C.females_15_49[3].style_stops_99[4],W[C.females_15_49[2]][0]]},females_50_64:{"fill-color":["interpolate",["linear"],["get","females_50_64"],C.females_50_64[3].style_stops_99[0],W[C.females_50_64[2]][4],C.females_50_64[3].style_stops_99[1],W[C.females_50_64[2]][3],C.females_50_64[3].style_stops_99[2],W[C.females_50_64[2]][2],C.females_50_64[3].style_stops_99[3],W[C.females_50_64[2]][1],C.females_50_64[3].style_stops_99[4],W[C.females_50_64[2]][0]]},females_5_9:{"fill-color":["interpolate",["linear"],["get","females_5_9"],C.females_5_9[3].style_stops_99[0],W[C.females_5_9[2]][4],C.females_5_9[3].style_stops_99[1],W[C.females_5_9[2]][3],C.females_5_9[3].style_stops_99[2],W[C.females_5_9[2]][2],C.females_5_9[3].style_stops_99[3],W[C.females_5_9[2]][1],C.females_5_9[3].style_stops_99[4],W[C.females_5_9[2]][0]]},females_65_plus:{"fill-color":["interpolate",["linear"],["get","females_65_plus"],C.females_65_plus[3].style_stops_99[0],W[C.females_65_plus[2]][4],C.females_65_plus[3].style_stops_99[1],W[C.females_65_plus[2]][3],C.females_65_plus[3].style_stops_99[2],W[C.females_65_plus[2]][2],C.females_65_plus[3].style_stops_99[3],W[C.females_65_plus[2]][1],C.females_65_plus[3].style_stops_99[4],W[C.females_65_plus[2]][0]]},male_educational_attainment_mean:{"fill-color":["interpolate",["linear"],["get","male_educational_attainment_mean"],C.male_educational_attainment_mean[3].style_stops_99[0],W[C.male_educational_attainment_mean[2]][0],C.male_educational_attainment_mean[3].style_stops_99[1],W[C.male_educational_attainment_mean[2]][1],C.male_educational_attainment_mean[3].style_stops_99[2],W[C.male_educational_attainment_mean[2]][2],C.male_educational_attainment_mean[3].style_stops_99[3],W[C.male_educational_attainment_mean[2]][3],C.male_educational_attainment_mean[3].style_stops_99[4],W[C.male_educational_attainment_mean[2]][4]]},males_0_4:{"fill-color":["interpolate",["linear"],["get","males_0_4"],C.males_0_4[3].style_stops_99[0],W[C.males_0_4[2]][4],C.males_0_4[3].style_stops_99[1],W[C.males_0_4[2]][3],C.males_0_4[3].style_stops_99[2],W[C.males_0_4[2]][2],C.males_0_4[3].style_stops_99[3],W[C.males_0_4[2]][1],C.males_0_4[3].style_stops_99[4],W[C.males_0_4[2]][0]]},males_0_9:{"fill-color":["interpolate",["linear"],["get","males_0_9"],C.males_0_9[3].style_stops_99[0],W[C.males_0_9[2]][4],C.males_0_9[3].style_stops_99[1],W[C.males_0_9[2]][3],C.males_0_9[3].style_stops_99[2],W[C.males_0_9[2]][2],C.males_0_9[3].style_stops_99[3],W[C.males_0_9[2]][1],C.males_0_9[3].style_stops_99[4],W[C.males_0_9[2]][0]]},males_10_14:{"fill-color":["interpolate",["linear"],["get","males_10_14"],C.males_10_14[3].style_stops_99[0],W[C.males_10_14[2]][4],C.males_10_14[3].style_stops_99[1],W[C.males_10_14[2]][3],C.males_10_14[3].style_stops_99[2],W[C.males_10_14[2]][2],C.males_10_14[3].style_stops_99[3],W[C.males_10_14[2]][1],C.males_10_14[3].style_stops_99[4],W[C.males_10_14[2]][0]]},males_15_49:{"fill-color":["interpolate",["linear"],["get","males_15_49"],C.males_15_49[3].style_stops_99[0],W[C.males_15_49[2]][4],C.males_15_49[3].style_stops_99[1],W[C.males_15_49[2]][3],C.males_15_49[3].style_stops_99[2],W[C.males_15_49[2]][2],C.males_15_49[3].style_stops_99[3],W[C.males_15_49[2]][1],C.males_15_49[3].style_stops_99[4],W[C.males_15_49[2]][0]]},males_50_64:{"fill-color":["interpolate",["linear"],["get","males_50_64"],C.males_50_64[3].style_stops_99[0],W[C.males_50_64[2]][4],C.males_50_64[3].style_stops_99[1],W[C.males_50_64[2]][3],C.males_50_64[3].style_stops_99[2],W[C.males_50_64[2]][2],C.males_50_64[3].style_stops_99[3],W[C.males_50_64[2]][1],C.males_50_64[3].style_stops_99[4],W[C.males_50_64[2]][0]]},males_5_9:{"fill-color":["interpolate",["linear"],["get","males_5_9"],C.males_5_9[3].style_stops_99[0],W[C.males_5_9[2]][4],C.males_5_9[3].style_stops_99[1],W[C.males_5_9[2]][3],C.males_5_9[3].style_stops_99[2],W[C.males_5_9[2]][2],C.males_5_9[3].style_stops_99[3],W[C.males_5_9[2]][1],C.males_5_9[3].style_stops_99[4],W[C.males_5_9[2]][0]]},males_65_plus:{"fill-color":["interpolate",["linear"],["get","males_65_plus"],C.males_65_plus[3].style_stops_99[0],W[C.males_65_plus[2]][4],C.males_65_plus[3].style_stops_99[1],W[C.males_65_plus[2]][3],C.males_65_plus[3].style_stops_99[2],W[C.males_65_plus[2]][2],C.males_65_plus[3].style_stops_99[3],W[C.males_65_plus[2]][1],C.males_65_plus[3].style_stops_99[4],W[C.males_65_plus[2]][0]]},pop_0_4:{"fill-color":["interpolate",["linear"],["get","pop_0_4"],C.pop_0_4[3].style_stops_99[0],W[C.pop_0_4[2]][4],C.pop_0_4[3].style_stops_99[1],W[C.pop_0_4[2]][3],C.pop_0_4[3].style_stops_99[2],W[C.pop_0_4[2]][2],C.pop_0_4[3].style_stops_99[3],W[C.pop_0_4[2]][1],C.pop_0_4[3].style_stops_99[4],W[C.pop_0_4[2]][0]]},pop_0_9:{"fill-color":["interpolate",["linear"],["get","pop_0_9"],C.pop_0_9[3].style_stops_99[0],W[C.pop_0_9[2]][4],C.pop_0_9[3].style_stops_99[1],W[C.pop_0_9[2]][3],C.pop_0_9[3].style_stops_99[2],W[C.pop_0_9[2]][2],C.pop_0_9[3].style_stops_99[3],W[C.pop_0_9[2]][1],C.pop_0_9[3].style_stops_99[4],W[C.pop_0_9[2]][0]]},pop_10_14:{"fill-color":["interpolate",["linear"],["get","pop_10_14"],C.pop_10_14[3].style_stops_99[0],W[C.pop_10_14[2]][4],C.pop_10_14[3].style_stops_99[1],W[C.pop_10_14[2]][3],C.pop_10_14[3].style_stops_99[2],W[C.pop_10_14[2]][2],C.pop_10_14[3].style_stops_99[3],W[C.pop_10_14[2]][1],C.pop_10_14[3].style_stops_99[4],W[C.pop_10_14[2]][0]]},pop_15_49:{"fill-color":["interpolate",["linear"],["get","pop_15_49"],C.pop_15_49[3].style_stops_99[0],W[C.pop_15_49[2]][4],C.pop_15_49[3].style_stops_99[1],W[C.pop_15_49[2]][3],C.pop_15_49[3].style_stops_99[2],W[C.pop_15_49[2]][2],C.pop_15_49[3].style_stops_99[3],W[C.pop_15_49[2]][1],C.pop_15_49[3].style_stops_99[4],W[C.pop_15_49[2]][0]]},pop_50_64:{"fill-color":["interpolate",["linear"],["get","pop_50_64"],C.pop_50_64[3].style_stops_99[0],W[C.pop_50_64[2]][4],C.pop_50_64[3].style_stops_99[1],W[C.pop_50_64[2]][3],C.pop_50_64[3].style_stops_99[2],W[C.pop_50_64[2]][2],C.pop_50_64[3].style_stops_99[3],W[C.pop_50_64[2]][1],C.pop_50_64[3].style_stops_99[4],W[C.pop_50_64[2]][0]]},pop_5_9:{"fill-color":["interpolate",["linear"],["get","pop_5_9"],C.pop_5_9[3].style_stops_99[0],W[C.pop_5_9[2]][4],C.pop_5_9[3].style_stops_99[1],W[C.pop_5_9[2]][3],C.pop_5_9[3].style_stops_99[2],W[C.pop_5_9[2]][2],C.pop_5_9[3].style_stops_99[3],W[C.pop_5_9[2]][1],C.pop_5_9[3].style_stops_99[4],W[C.pop_5_9[2]][0]]},pop_65_plus:{"fill-color":["interpolate",["linear"],["get","pop_65_plus"],C.pop_65_plus[3].style_stops_99[0],W[C.pop_65_plus[2]][4],C.pop_65_plus[3].style_stops_99[1],W[C.pop_65_plus[2]][3],C.pop_65_plus[3].style_stops_99[2],W[C.pop_65_plus[2]][2],C.pop_65_plus[3].style_stops_99[3],W[C.pop_65_plus[2]][1],C.pop_65_plus[3].style_stops_99[4],W[C.pop_65_plus[2]][0]]},population:{"fill-color":["interpolate",["linear"],["get","population"],C.population[3].style_stops_99[0],W[C.population[2]][4],C.population[3].style_stops_99[1],W[C.population[2]][3],C.population[3].style_stops_99[2],W[C.population[2]][2],C.population[3].style_stops_99[3],W[C.population[2]][1],C.population[3].style_stops_99[4],W[C.population[2]][0]]},pregnancies:{"fill-color":["interpolate",["linear"],["get","pregnancies"],C.pregnancies[3].style_stops_99[0],W[C.pregnancies[2]][4],C.pregnancies[3].style_stops_99[1],W[C.pregnancies[2]][3],C.pregnancies[3].style_stops_99[2],W[C.pregnancies[2]][2],C.pregnancies[3].style_stops_99[3],W[C.pregnancies[2]][1],C.pregnancies[3].style_stops_99[4],W[C.pregnancies[2]][0]]},births:{"fill-color":["interpolate",["linear"],["get","births"],C.births[3].style_stops_99[0],W[C.births[2]][4],C.births[3].style_stops_99[1],W[C.births[2]][3],C.births[3].style_stops_99[2],W[C.births[2]][2],C.births[3].style_stops_99[3],W[C.births[2]][1],C.births[3].style_stops_99[4],W[C.births[2]][0]]},rwi:{"fill-color":["interpolate",["linear"],["get","rwi"],C.rwi[3].style_stops_99[0],W[C.rwi[2]][0],C.rwi[3].style_stops_99[1],W[C.rwi[2]][1],C.rwi[3].style_stops_99[2],W[C.rwi[2]][2],C.rwi[3].style_stops_99[3],W[C.rwi[2]][3],C.rwi[3].style_stops_99[4],W[C.rwi[2]][4]]},underweight:{"fill-color":["interpolate",["linear"],["get","underweight"],C.underweight[3].style_stops_99[0],W[C.underweight[2]][4],C.underweight[3].style_stops_99[1],W[C.underweight[2]][3],C.underweight[3].style_stops_99[2],W[C.underweight[2]][2],C.underweight[3].style_stops_99[3],W[C.underweight[2]][1],C.underweight[3].style_stops_99[4],W[C.underweight[2]][0]]},travel_time_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_all_education_facilities_fixed"],C.travel_time_all_education_facilities_fixed[3].style_stops_99[0],W[C.travel_time_all_education_facilities_fixed[2]][4],C.travel_time_all_education_facilities_fixed[3].style_stops_99[1],W[C.travel_time_all_education_facilities_fixed[2]][3],C.travel_time_all_education_facilities_fixed[3].style_stops_99[2],W[C.travel_time_all_education_facilities_fixed[2]][2],C.travel_time_all_education_facilities_fixed[3].style_stops_99[3],W[C.travel_time_all_education_facilities_fixed[2]][1],C.travel_time_all_education_facilities_fixed[3].style_stops_99[4],W[C.travel_time_all_education_facilities_fixed[2]][0]]},travel_time_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_all_health_facilities_optimal"],C.travel_time_all_health_facilities_optimal[3].style_stops_99[0],W[C.travel_time_all_health_facilities_optimal[2]][4],C.travel_time_all_health_facilities_optimal[3].style_stops_99[1],W[C.travel_time_all_health_facilities_optimal[2]][3],C.travel_time_all_health_facilities_optimal[3].style_stops_99[2],W[C.travel_time_all_health_facilities_optimal[2]][2],C.travel_time_all_health_facilities_optimal[3].style_stops_99[3],W[C.travel_time_all_health_facilities_optimal[2]][1],C.travel_time_all_health_facilities_optimal[3].style_stops_99[4],W[C.travel_time_all_health_facilities_optimal[2]][0]]},travel_time_constructed_sites_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_all_education_facilities_fixed"],C.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[0],W[C.travel_time_constructed_sites_all_education_facilities_fixed[2]][4],C.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[1],W[C.travel_time_constructed_sites_all_education_facilities_fixed[2]][3],C.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[2],W[C.travel_time_constructed_sites_all_education_facilities_fixed[2]][2],C.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[3],W[C.travel_time_constructed_sites_all_education_facilities_fixed[2]][1],C.travel_time_constructed_sites_all_education_facilities_fixed[3].style_stops_99[4],W[C.travel_time_constructed_sites_all_education_facilities_fixed[2]][0]]},travel_time_constructed_sites_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_all_health_facilities_optimal"],C.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[0],W[C.travel_time_constructed_sites_all_health_facilities_optimal[2]][4],C.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[1],W[C.travel_time_constructed_sites_all_health_facilities_optimal[2]][3],C.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[2],W[C.travel_time_constructed_sites_all_health_facilities_optimal[2]][2],C.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[3],W[C.travel_time_constructed_sites_all_health_facilities_optimal[2]][1],C.travel_time_constructed_sites_all_health_facilities_optimal[3].style_stops_99[4],W[C.travel_time_constructed_sites_all_health_facilities_optimal[2]][0]]},travel_time_constructed_sites_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_health_centers_optimal"],C.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[0],W[C.travel_time_constructed_sites_health_centers_optimal[2]][4],C.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[1],W[C.travel_time_constructed_sites_health_centers_optimal[2]][3],C.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[2],W[C.travel_time_constructed_sites_health_centers_optimal[2]][2],C.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[3],W[C.travel_time_constructed_sites_health_centers_optimal[2]][1],C.travel_time_constructed_sites_health_centers_optimal[3].style_stops_99[4],W[C.travel_time_constructed_sites_health_centers_optimal[2]][0]]},travel_time_constructed_sites_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_health_posts_optimal"],C.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[0],W[C.travel_time_constructed_sites_health_posts_optimal[2]][4],C.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[1],W[C.travel_time_constructed_sites_health_posts_optimal[2]][3],C.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[2],W[C.travel_time_constructed_sites_health_posts_optimal[2]][2],C.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[3],W[C.travel_time_constructed_sites_health_posts_optimal[2]][1],C.travel_time_constructed_sites_health_posts_optimal[3].style_stops_99[4],W[C.travel_time_constructed_sites_health_posts_optimal[2]][0]]},travel_time_constructed_sites_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_major_hospitals_optimal"],C.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[0],W[C.travel_time_constructed_sites_major_hospitals_optimal[2]][4],C.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[1],W[C.travel_time_constructed_sites_major_hospitals_optimal[2]][3],C.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[2],W[C.travel_time_constructed_sites_major_hospitals_optimal[2]][2],C.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[3],W[C.travel_time_constructed_sites_major_hospitals_optimal[2]][1],C.travel_time_constructed_sites_major_hospitals_optimal[3].style_stops_99[4],W[C.travel_time_constructed_sites_major_hospitals_optimal[2]][0]]},travel_time_constructed_sites_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_primary_schools_fixed"],C.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[0],W[C.travel_time_constructed_sites_primary_schools_fixed[2]][4],C.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[1],W[C.travel_time_constructed_sites_primary_schools_fixed[2]][3],C.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[2],W[C.travel_time_constructed_sites_primary_schools_fixed[2]][2],C.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[3],W[C.travel_time_constructed_sites_primary_schools_fixed[2]][1],C.travel_time_constructed_sites_primary_schools_fixed[3].style_stops_99[4],W[C.travel_time_constructed_sites_primary_schools_fixed[2]][0]]},travel_time_constructed_sites_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_secondary_schools_fixed"],C.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[0],W[C.travel_time_constructed_sites_secondary_schools_fixed[2]][4],C.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[1],W[C.travel_time_constructed_sites_secondary_schools_fixed[2]][3],C.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[2],W[C.travel_time_constructed_sites_secondary_schools_fixed[2]][2],C.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[3],W[C.travel_time_constructed_sites_secondary_schools_fixed[2]][1],C.travel_time_constructed_sites_secondary_schools_fixed[3].style_stops_99[4],W[C.travel_time_constructed_sites_secondary_schools_fixed[2]][0]]},travel_time_constructed_sites_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_constructed_sites_semi_dense_urban_optimal"],C.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[0],W[C.travel_time_constructed_sites_semi_dense_urban_optimal[2]][4],C.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[1],W[C.travel_time_constructed_sites_semi_dense_urban_optimal[2]][3],C.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[2],W[C.travel_time_constructed_sites_semi_dense_urban_optimal[2]][2],C.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[3],W[C.travel_time_constructed_sites_semi_dense_urban_optimal[2]][1],C.travel_time_constructed_sites_semi_dense_urban_optimal[3].style_stops_99[4],W[C.travel_time_constructed_sites_semi_dense_urban_optimal[2]][0]]},travel_time_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_health_centers_optimal"],C.travel_time_health_centers_optimal[3].style_stops_99[0],W[C.travel_time_health_centers_optimal[2]][4],C.travel_time_health_centers_optimal[3].style_stops_99[1],W[C.travel_time_health_centers_optimal[2]][3],C.travel_time_health_centers_optimal[3].style_stops_99[2],W[C.travel_time_health_centers_optimal[2]][2],C.travel_time_health_centers_optimal[3].style_stops_99[3],W[C.travel_time_health_centers_optimal[2]][1],C.travel_time_health_centers_optimal[3].style_stops_99[4],W[C.travel_time_health_centers_optimal[2]][0]]},travel_time_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_health_posts_optimal"],C.travel_time_health_posts_optimal[3].style_stops_99[0],W[C.travel_time_health_posts_optimal[2]][4],C.travel_time_health_posts_optimal[3].style_stops_99[1],W[C.travel_time_health_posts_optimal[2]][3],C.travel_time_health_posts_optimal[3].style_stops_99[2],W[C.travel_time_health_posts_optimal[2]][2],C.travel_time_health_posts_optimal[3].style_stops_99[3],W[C.travel_time_health_posts_optimal[2]][1],C.travel_time_health_posts_optimal[3].style_stops_99[4],W[C.travel_time_health_posts_optimal[2]][0]]},travel_time_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_major_hospitals_optimal"],C.travel_time_major_hospitals_optimal[3].style_stops_99[0],W[C.travel_time_major_hospitals_optimal[2]][4],C.travel_time_major_hospitals_optimal[3].style_stops_99[1],W[C.travel_time_major_hospitals_optimal[2]][3],C.travel_time_major_hospitals_optimal[3].style_stops_99[2],W[C.travel_time_major_hospitals_optimal[2]][2],C.travel_time_major_hospitals_optimal[3].style_stops_99[3],W[C.travel_time_major_hospitals_optimal[2]][1],C.travel_time_major_hospitals_optimal[3].style_stops_99[4],W[C.travel_time_major_hospitals_optimal[2]][0]]},travel_time_no_sites_all_education_facilities_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_all_education_facilities_fixed"],C.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[0],W[C.travel_time_no_sites_all_education_facilities_fixed[2]][4],C.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[1],W[C.travel_time_no_sites_all_education_facilities_fixed[2]][3],C.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[2],W[C.travel_time_no_sites_all_education_facilities_fixed[2]][2],C.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[3],W[C.travel_time_no_sites_all_education_facilities_fixed[2]][1],C.travel_time_no_sites_all_education_facilities_fixed[3].style_stops_99[4],W[C.travel_time_no_sites_all_education_facilities_fixed[2]][0]]},travel_time_no_sites_all_health_facilities_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_all_health_facilities_optimal"],C.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[0],W[C.travel_time_no_sites_all_health_facilities_optimal[2]][4],C.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[1],W[C.travel_time_no_sites_all_health_facilities_optimal[2]][3],C.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[2],W[C.travel_time_no_sites_all_health_facilities_optimal[2]][2],C.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[3],W[C.travel_time_no_sites_all_health_facilities_optimal[2]][1],C.travel_time_no_sites_all_health_facilities_optimal[3].style_stops_99[4],W[C.travel_time_no_sites_all_health_facilities_optimal[2]][0]]},travel_time_no_sites_health_centers_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_health_centers_optimal"],C.travel_time_no_sites_health_centers_optimal[3].style_stops_99[0],W[C.travel_time_no_sites_health_centers_optimal[2]][4],C.travel_time_no_sites_health_centers_optimal[3].style_stops_99[1],W[C.travel_time_no_sites_health_centers_optimal[2]][3],C.travel_time_no_sites_health_centers_optimal[3].style_stops_99[2],W[C.travel_time_no_sites_health_centers_optimal[2]][2],C.travel_time_no_sites_health_centers_optimal[3].style_stops_99[3],W[C.travel_time_no_sites_health_centers_optimal[2]][1],C.travel_time_no_sites_health_centers_optimal[3].style_stops_99[4],W[C.travel_time_no_sites_health_centers_optimal[2]][0]]},travel_time_no_sites_health_posts_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_health_posts_optimal"],C.travel_time_no_sites_health_posts_optimal[3].style_stops_99[0],W[C.travel_time_no_sites_health_posts_optimal[2]][4],C.travel_time_no_sites_health_posts_optimal[3].style_stops_99[1],W[C.travel_time_no_sites_health_posts_optimal[2]][3],C.travel_time_no_sites_health_posts_optimal[3].style_stops_99[2],W[C.travel_time_no_sites_health_posts_optimal[2]][2],C.travel_time_no_sites_health_posts_optimal[3].style_stops_99[3],W[C.travel_time_no_sites_health_posts_optimal[2]][1],C.travel_time_no_sites_health_posts_optimal[3].style_stops_99[4],W[C.travel_time_no_sites_health_posts_optimal[2]][0]]},travel_time_no_sites_major_hospitals_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_major_hospitals_optimal"],C.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[0],W[C.travel_time_no_sites_major_hospitals_optimal[2]][4],C.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[1],W[C.travel_time_no_sites_major_hospitals_optimal[2]][3],C.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[2],W[C.travel_time_no_sites_major_hospitals_optimal[2]][2],C.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[3],W[C.travel_time_no_sites_major_hospitals_optimal[2]][1],C.travel_time_no_sites_major_hospitals_optimal[3].style_stops_99[4],W[C.travel_time_no_sites_major_hospitals_optimal[2]][0]]},travel_time_no_sites_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_primary_schools_fixed"],C.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[0],W[C.travel_time_no_sites_primary_schools_fixed[2]][4],C.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[1],W[C.travel_time_no_sites_primary_schools_fixed[2]][3],C.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[2],W[C.travel_time_no_sites_primary_schools_fixed[2]][2],C.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[3],W[C.travel_time_no_sites_primary_schools_fixed[2]][1],C.travel_time_no_sites_primary_schools_fixed[3].style_stops_99[4],W[C.travel_time_no_sites_primary_schools_fixed[2]][0]]},travel_time_no_sites_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_secondary_schools_fixed"],C.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[0],W[C.travel_time_no_sites_secondary_schools_fixed[2]][4],C.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[1],W[C.travel_time_no_sites_secondary_schools_fixed[2]][3],C.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[2],W[C.travel_time_no_sites_secondary_schools_fixed[2]][2],C.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[3],W[C.travel_time_no_sites_secondary_schools_fixed[2]][1],C.travel_time_no_sites_secondary_schools_fixed[3].style_stops_99[4],W[C.travel_time_no_sites_secondary_schools_fixed[2]][0]]},travel_time_no_sites_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_no_sites_semi_dense_urban_optimal"],C.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[0],W[C.travel_time_no_sites_semi_dense_urban_optimal[2]][4],C.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[1],W[C.travel_time_no_sites_semi_dense_urban_optimal[2]][3],C.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[2],W[C.travel_time_no_sites_semi_dense_urban_optimal[2]][2],C.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[3],W[C.travel_time_no_sites_semi_dense_urban_optimal[2]][1],C.travel_time_no_sites_semi_dense_urban_optimal[3].style_stops_99[4],W[C.travel_time_no_sites_semi_dense_urban_optimal[2]][0]]},travel_time_primary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_primary_schools_fixed"],C.travel_time_primary_schools_fixed[3].style_stops_99[0],W[C.travel_time_primary_schools_fixed[2]][4],C.travel_time_primary_schools_fixed[3].style_stops_99[1],W[C.travel_time_primary_schools_fixed[2]][3],C.travel_time_primary_schools_fixed[3].style_stops_99[2],W[C.travel_time_primary_schools_fixed[2]][2],C.travel_time_primary_schools_fixed[3].style_stops_99[3],W[C.travel_time_primary_schools_fixed[2]][1],C.travel_time_primary_schools_fixed[3].style_stops_99[4],W[C.travel_time_primary_schools_fixed[2]][0]]},travel_time_secondary_schools_fixed:{"fill-color":["interpolate",["linear"],["get","travel_time_secondary_schools_fixed"],C.travel_time_secondary_schools_fixed[3].style_stops_99[0],W[C.travel_time_secondary_schools_fixed[2]][4],C.travel_time_secondary_schools_fixed[3].style_stops_99[1],W[C.travel_time_secondary_schools_fixed[2]][3],C.travel_time_secondary_schools_fixed[3].style_stops_99[2],W[C.travel_time_secondary_schools_fixed[2]][2],C.travel_time_secondary_schools_fixed[3].style_stops_99[3],W[C.travel_time_secondary_schools_fixed[2]][1],C.travel_time_secondary_schools_fixed[3].style_stops_99[4],W[C.travel_time_secondary_schools_fixed[2]][0]]},travel_time_semi_dense_urban_optimal:{"fill-color":["interpolate",["linear"],["get","travel_time_semi_dense_urban_optimal"],C.travel_time_semi_dense_urban_optimal[3].style_stops_99[0],W[C.travel_time_semi_dense_urban_optimal[2]][4],C.travel_time_semi_dense_urban_optimal[3].style_stops_99[1],W[C.travel_time_semi_dense_urban_optimal[2]][3],C.travel_time_semi_dense_urban_optimal[3].style_stops_99[2],W[C.travel_time_semi_dense_urban_optimal[2]][2],C.travel_time_semi_dense_urban_optimal[3].style_stops_99[3],W[C.travel_time_semi_dense_urban_optimal[2]][1],C.travel_time_semi_dense_urban_optimal[3].style_stops_99[4],W[C.travel_time_semi_dense_urban_optimal[2]][0]]},all_education_potential_impact:{"fill-color":["interpolate",["linear"],["get","all_education_potential_impact"],C.all_education_potential_impact[3].style_stops_maxmin[0],W[C.all_education_potential_impact[2]][0],C.all_education_potential_impact[3].style_stops_maxmin[1],W[C.all_education_potential_impact[2]][1],C.all_education_potential_impact[3].style_stops_maxmin[2],W[C.all_education_potential_impact[2]][2],C.all_education_potential_impact[3].style_stops_maxmin[3],W[C.all_education_potential_impact[2]][3],C.all_education_potential_impact[3].style_stops_maxmin[4],W[C.all_education_potential_impact[2]][4]]},all_education_current_impact:{"fill-color":["interpolate",["linear"],["get","all_education_current_impact"],C.all_education_current_impact[3].style_stops_maxmin[0],W[C.all_education_current_impact[2]][0],C.all_education_current_impact[3].style_stops_maxmin[1],W[C.all_education_current_impact[2]][1],C.all_education_current_impact[3].style_stops_maxmin[2],W[C.all_education_current_impact[2]][2],C.all_education_current_impact[3].style_stops_maxmin[3],W[C.all_education_current_impact[2]][3],C.all_education_current_impact[3].style_stops_maxmin[4],W[C.all_education_current_impact[2]][4]]},all_health_potential_impact:{"fill-color":["interpolate",["linear"],["get","all_health_potential_impact"],C.all_health_potential_impact[3].style_stops_maxmin[0],W[C.all_health_potential_impact[2]][0],C.all_health_potential_impact[3].style_stops_maxmin[1],W[C.all_health_potential_impact[2]][1],C.all_health_potential_impact[3].style_stops_maxmin[2],W[C.all_health_potential_impact[2]][2],C.all_health_potential_impact[3].style_stops_maxmin[3],W[C.all_health_potential_impact[2]][3],C.all_health_potential_impact[3].style_stops_maxmin[4],W[C.all_health_potential_impact[2]][4]]},all_health_current_impact:{"fill-color":["interpolate",["linear"],["get","all_health_current_impact"],C.all_health_current_impact[3].style_stops_maxmin[0],W[C.all_health_current_impact[2]][0],C.all_health_current_impact[3].style_stops_maxmin[1],W[C.all_health_current_impact[2]][1],C.all_health_current_impact[3].style_stops_maxmin[2],W[C.all_health_current_impact[2]][2],C.all_health_current_impact[3].style_stops_maxmin[3],W[C.all_health_current_impact[2]][3],C.all_health_current_impact[3].style_stops_maxmin[4],W[C.all_health_current_impact[2]][4]]},health_centers_potential_impact:{"fill-color":["interpolate",["linear"],["get","health_centers_potential_impact"],C.health_centers_potential_impact[3].style_stops_maxmin[0],W[C.health_centers_potential_impact[2]][0],C.health_centers_potential_impact[3].style_stops_maxmin[1],W[C.health_centers_potential_impact[2]][1],C.health_centers_potential_impact[3].style_stops_maxmin[2],W[C.health_centers_potential_impact[2]][2],C.health_centers_potential_impact[3].style_stops_maxmin[3],W[C.health_centers_potential_impact[2]][3],C.health_centers_potential_impact[3].style_stops_maxmin[4],W[C.health_centers_potential_impact[2]][4]]},health_centers_current_impact:{"fill-color":["interpolate",["linear"],["get","health_centers_current_impact"],C.health_centers_current_impact[3].style_stops_maxmin[0],W[C.health_centers_current_impact[2]][0],C.health_centers_current_impact[3].style_stops_maxmin[1],W[C.health_centers_current_impact[2]][1],C.health_centers_current_impact[3].style_stops_maxmin[2],W[C.health_centers_current_impact[2]][2],C.health_centers_current_impact[3].style_stops_maxmin[3],W[C.health_centers_current_impact[2]][3],C.health_centers_current_impact[3].style_stops_maxmin[4],W[C.health_centers_current_impact[2]][4]]},health_posts_potential_impact:{"fill-color":["interpolate",["linear"],["get","health_posts_potential_impact"],C.health_posts_potential_impact[3].style_stops_maxmin[0],W[C.health_posts_potential_impact[2]][0],C.health_posts_potential_impact[3].style_stops_maxmin[1],W[C.health_posts_potential_impact[2]][1],C.health_posts_potential_impact[3].style_stops_maxmin[2],W[C.health_posts_potential_impact[2]][2],C.health_posts_potential_impact[3].style_stops_maxmin[3],W[C.health_posts_potential_impact[2]][3],C.health_posts_potential_impact[3].style_stops_maxmin[4],W[C.health_posts_potential_impact[2]][4]]},health_posts_current_impact:{"fill-color":["interpolate",["linear"],["get","health_posts_current_impact"],C.health_posts_current_impact[3].style_stops_maxmin[0],W[C.health_posts_current_impact[2]][0],C.health_posts_current_impact[3].style_stops_maxmin[1],W[C.health_posts_current_impact[2]][1],C.health_posts_current_impact[3].style_stops_maxmin[2],W[C.health_posts_current_impact[2]][2],C.health_posts_current_impact[3].style_stops_maxmin[3],W[C.health_posts_current_impact[2]][3],C.health_posts_current_impact[3].style_stops_maxmin[4],W[C.health_posts_current_impact[2]][4]]},major_hospitals_potential_impact:{"fill-color":["interpolate",["linear"],["get","major_hospitals_potential_impact"],C.major_hospitals_potential_impact[3].style_stops_maxmin[0],W[C.major_hospitals_potential_impact[2]][0],C.major_hospitals_potential_impact[3].style_stops_maxmin[1],W[C.major_hospitals_potential_impact[2]][1],C.major_hospitals_potential_impact[3].style_stops_maxmin[2],W[C.major_hospitals_potential_impact[2]][2],C.major_hospitals_potential_impact[3].style_stops_maxmin[3],W[C.major_hospitals_potential_impact[2]][3],C.major_hospitals_potential_impact[3].style_stops_maxmin[4],W[C.major_hospitals_potential_impact[2]][4]]},major_hospitals_current_impact:{"fill-color":["interpolate",["linear"],["get","major_hospitals_current_impact"],C.major_hospitals_current_impact[3].style_stops_maxmin[0],W[C.major_hospitals_current_impact[2]][0],C.major_hospitals_current_impact[3].style_stops_maxmin[1],W[C.major_hospitals_current_impact[2]][1],C.major_hospitals_current_impact[3].style_stops_maxmin[2],W[C.major_hospitals_current_impact[2]][2],C.major_hospitals_current_impact[3].style_stops_maxmin[3],W[C.major_hospitals_current_impact[2]][3],C.major_hospitals_current_impact[3].style_stops_maxmin[4],W[C.major_hospitals_current_impact[2]][4]]},primary_schools_potential_impact:{"fill-color":["interpolate",["linear"],["get","primary_schools_potential_impact"],C.primary_schools_potential_impact[3].style_stops_maxmin[0],W[C.primary_schools_potential_impact[2]][0],C.primary_schools_potential_impact[3].style_stops_maxmin[1],W[C.primary_schools_potential_impact[2]][1],C.primary_schools_potential_impact[3].style_stops_maxmin[2],W[C.primary_schools_potential_impact[2]][2],C.primary_schools_potential_impact[3].style_stops_maxmin[3],W[C.primary_schools_potential_impact[2]][3],C.primary_schools_potential_impact[3].style_stops_maxmin[4],W[C.primary_schools_potential_impact[2]][4]]},primary_schools_current_impact:{"fill-color":["interpolate",["linear"],["get","primary_schools_current_impact"],C.primary_schools_current_impact[3].style_stops_maxmin[0],W[C.primary_schools_current_impact[2]][0],C.primary_schools_current_impact[3].style_stops_maxmin[1],W[C.primary_schools_current_impact[2]][1],C.primary_schools_current_impact[3].style_stops_maxmin[2],W[C.primary_schools_current_impact[2]][2],C.primary_schools_current_impact[3].style_stops_maxmin[3],W[C.primary_schools_current_impact[2]][3],C.primary_schools_current_impact[3].style_stops_maxmin[4],W[C.primary_schools_current_impact[2]][4]]},secondary_schools_potential_impact:{"fill-color":["interpolate",["linear"],["get","secondary_schools_potential_impact"],C.secondary_schools_potential_impact[3].style_stops_maxmin[0],W[C.secondary_schools_potential_impact[2]][0],C.secondary_schools_potential_impact[3].style_stops_maxmin[1],W[C.secondary_schools_potential_impact[2]][1],C.secondary_schools_potential_impact[3].style_stops_maxmin[2],W[C.secondary_schools_potential_impact[2]][2],C.secondary_schools_potential_impact[3].style_stops_maxmin[3],W[C.secondary_schools_potential_impact[2]][3],C.secondary_schools_potential_impact[3].style_stops_maxmin[4],W[C.secondary_schools_potential_impact[2]][4]]},secondary_schools_current_impact:{"fill-color":["interpolate",["linear"],["get","secondary_schools_current_impact"],C.secondary_schools_current_impact[3].style_stops_maxmin[0],W[C.secondary_schools_current_impact[2]][0],C.secondary_schools_current_impact[3].style_stops_maxmin[1],W[C.secondary_schools_current_impact[2]][1],C.secondary_schools_current_impact[3].style_stops_maxmin[2],W[C.secondary_schools_current_impact[2]][2],C.secondary_schools_current_impact[3].style_stops_maxmin[3],W[C.secondary_schools_current_impact[2]][3],C.secondary_schools_current_impact[3].style_stops_maxmin[4],W[C.secondary_schools_current_impact[2]][4]]},semi_dense_urban_potential_impact:{"fill-color":["interpolate",["linear"],["get","semi_dense_urban_potential_impact"],C.semi_dense_urban_potential_impact[3].style_stops_maxmin[0],W[C.semi_dense_urban_potential_impact[2]][0],C.semi_dense_urban_potential_impact[3].style_stops_maxmin[1],W[C.semi_dense_urban_potential_impact[2]][1],C.semi_dense_urban_potential_impact[3].style_stops_maxmin[2],W[C.semi_dense_urban_potential_impact[2]][2],C.semi_dense_urban_potential_impact[3].style_stops_maxmin[3],W[C.semi_dense_urban_potential_impact[2]][3],C.semi_dense_urban_potential_impact[3].style_stops_maxmin[4],W[C.semi_dense_urban_potential_impact[2]][4]]},semi_dense_urban_current_impact:{"fill-color":["interpolate",["linear"],["get","semi_dense_urban_current_impact"],C.semi_dense_urban_current_impact[3].style_stops_maxmin[0],W[C.semi_dense_urban_current_impact[2]][0],C.semi_dense_urban_current_impact[3].style_stops_maxmin[1],W[C.semi_dense_urban_current_impact[2]][1],C.semi_dense_urban_current_impact[3].style_stops_maxmin[2],W[C.semi_dense_urban_current_impact[2]][2],C.semi_dense_urban_current_impact[3].style_stops_maxmin[3],W[C.semi_dense_urban_current_impact[2]][3],C.semi_dense_urban_current_impact[3].style_stops_maxmin[4],W[C.semi_dense_urban_current_impact[2]][4]]},total_potential_impact:{"fill-color":["interpolate",["linear"],["get","total_potential_impact"],C.total_potential_impact[3].style_stops_maxmin[0],W[C.total_potential_impact[2]][0],C.total_potential_impact[3].style_stops_maxmin[1],W[C.total_potential_impact[2]][1],C.total_potential_impact[3].style_stops_maxmin[2],W[C.total_potential_impact[2]][2],C.total_potential_impact[3].style_stops_maxmin[3],W[C.total_potential_impact[2]][3],C.total_potential_impact[3].style_stops_maxmin[4],W[C.total_potential_impact[2]][4]]},total_current_impact:{"fill-color":["interpolate",["linear"],["get","total_current_impact"],C.total_current_impact[3].style_stops_maxmin[0],W[C.total_current_impact[2]][0],C.total_current_impact[3].style_stops_maxmin[1],W[C.total_current_impact[2]][1],C.total_current_impact[3].style_stops_maxmin[2],W[C.total_current_impact[2]][2],C.total_current_impact[3].style_stops_maxmin[3],W[C.total_current_impact[2]][3],C.total_current_impact[3].style_stops_maxmin[4],W[C.total_current_impact[2]][4]]},total_school_current_impact:{"fill-color":["interpolate",["linear"],["get","total_school_current_impact"],C.total_school_current_impact[3].style_stops_maxmin[0],W[C.total_school_current_impact[2]][0],C.total_school_current_impact[3].style_stops_maxmin[1],W[C.total_school_current_impact[2]][1],C.total_school_current_impact[3].style_stops_maxmin[2],W[C.total_school_current_impact[2]][2],C.total_school_current_impact[3].style_stops_maxmin[3],W[C.total_school_current_impact[2]][3],C.total_school_current_impact[3].style_stops_maxmin[4],W[C.total_school_current_impact[2]][4]]},total_school_potential_impact:{"fill-color":["interpolate",["linear"],["get","total_school_potential_impact"],C.total_school_potential_impact[3].style_stops_maxmin[0],W[C.total_school_potential_impact[2]][0],C.total_school_potential_impact[3].style_stops_maxmin[1],W[C.total_school_potential_impact[2]][1],C.total_school_potential_impact[3].style_stops_maxmin[2],W[C.total_school_potential_impact[2]][2],C.total_school_potential_impact[3].style_stops_maxmin[3],W[C.total_school_potential_impact[2]][3],C.total_school_potential_impact[3].style_stops_maxmin[4],W[C.total_school_potential_impact[2]][4]]},total_health_current_impact:{"fill-color":["interpolate",["linear"],["get","total_health_current_impact"],C.total_health_current_impact[3].style_stops_maxmin[0],W[C.total_health_current_impact[2]][0],C.total_health_current_impact[3].style_stops_maxmin[1],W[C.total_health_current_impact[2]][1],C.total_health_current_impact[3].style_stops_maxmin[2],W[C.total_health_current_impact[2]][2],C.total_health_current_impact[3].style_stops_maxmin[3],W[C.total_health_current_impact[2]][3],C.total_health_current_impact[3].style_stops_maxmin[4],W[C.total_health_current_impact[2]][4]]},total_health_potential_impact:{"fill-color":["interpolate",["linear"],["get","total_health_potential_impact"],C.total_health_potential_impact[3].style_stops_maxmin[0],W[C.total_health_potential_impact[2]][0],C.total_health_potential_impact[3].style_stops_maxmin[1],W[C.total_health_potential_impact[2]][1],C.total_health_potential_impact[3].style_stops_maxmin[2],W[C.total_health_potential_impact[2]][2],C.total_health_potential_impact[3].style_stops_maxmin[3],W[C.total_health_potential_impact[2]][3],C.total_health_potential_impact[3].style_stops_maxmin[4],W[C.total_health_potential_impact[2]][4]]}};let Vh=null;function Zw(){gi.setFilter("hover-bridge",["==",["id"],0]),gi.setFilter("hover-health",["==",["id"],0]),gi.setFilter("hover-edu",["==",["id"],0]),gi.setFeatureState({source:"hex-8-source",id:Vh},{hover:!1}),document.getElementById("hover-panel").classList.remove("show")}function Eo(o){return o.toLowerCase().split(" ").map(function(s){return s.charAt(0).toUpperCase()+s.slice(1)}).join(" ")}function J0(o,s){let a=Object.keys(C).find(u=>JSON.stringify(C[u][0])===JSON.stringify([Kl.dropdown1,Kl.dropdown2,Kl.dropdown3]));Zw(),s&&document.getElementById("hover-panel").classList.add("show"),o==="hex-8-layer"&&s?(Vh!==null&&gi.setFeatureState({source:"hex-8-source",id:Vh},{hover:!1}),Vh=s.id,gi.setFeatureState({source:"hex-8-source",id:Vh},{hover:!0}),a=="female_educational_attainment_mean"||a=="male_educational_attainment_mean"||a=="rwi"?document.getElementById("hover-text").innerHTML="<strong>Geographic Area</strong> </br>Population: "+s.properties.population+"</br>Wealth Index: "+s.properties.rwi.toFixed(3)+"</br>"+C[a][1][0]+": "+s.properties[a].toFixed(1)+" "+C[a][1][1]:a.includes("impact")?document.getElementById("hover-text").innerHTML="<strong>Geographic Area</strong> </br>Population: "+s.properties.population+"</br>RWI: "+s.properties.rwi.toFixed(3)+"</br>"+C[a][1][0]+": "+Ww(s.properties[a].toFixed(1))+" "+C[a][1][1]:document.getElementById("hover-text").innerHTML="<strong>Geographic Area</strong> </br>Population: "+s.properties.population+"</br>Wealth Index: "+s.properties.rwi.toFixed(3)+"</br>"+C[a][1][0]+": "+s.properties[a].toFixed(0)+" "+C[a][1][1],document.getElementById("hover-icon").src="/assets/geo-hex.svg"):o==="bridge-point"&&s?(gi.setFilter("hover-bridge",["==",["id"],s.id]),document.getElementById("hover-text").innerHTML="<strong>Bridge Site</strong> </br>Status: "+s.properties.stage_public+" Site </br>Region: "+s.properties.level_2_government+"</br>Population Served: "+s.properties.individuals_directly_served,document.getElementById("hover-icon").src="/assets/bridge-hex.svg"):o==="health-point"&&s?(gi.setFilter("hover-health",["==",["id"],s.id]),document.getElementById("hover-text").innerHTML="<strong>"+Eo(s.properties.category)+"</strong> </br>District: "+Eo(s.properties.district)+"</br> Sector: "+Eo(s.properties.sector)+"</br> Village: "+Eo(s.properties.village),document.getElementById("hover-icon").src="/assets/health-hex.svg"):o==="edu-point"&&s&&(gi.setFilter("hover-edu",["==",["id"],s.id]),document.getElementById("hover-text").innerHTML="<strong>"+Eo(s.properties.category)+"</strong> </br>District: "+Eo(s.properties.district)+"</br> Sector: "+Eo(s.properties.sector)+"</br> Village: "+Eo(s.properties.village),document.getElementById("hover-icon").src="/assets/edu-hex.svg")}/*!
 * @kurkle/color v0.3.2
 * https://github.com/kurkle/color#readme
 * (c) 2023 Jukka Kurkela
 * Released under the MIT License
 */function uu(o){return o+.5|0}const Mo=(o,s,a)=>Math.max(Math.min(o,a),s);function Uh(o){return Mo(uu(o*2.55),0,255)}function Po(o){return Mo(uu(o*255),0,255)}function Br(o){return Mo(uu(o/2.55)/100,0,1)}function Q0(o){return Mo(uu(o*100),0,100)}const vs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},B_=[..."0123456789ABCDEF"],Hw=o=>B_[o&15],Xw=o=>B_[(o&240)>>4]+B_[o&15],Nd=o=>(o&240)>>4===(o&15),Yw=o=>Nd(o.r)&&Nd(o.g)&&Nd(o.b)&&Nd(o.a);function Kw(o){var s=o.length,a;return o[0]==="#"&&(s===4||s===5?a={r:255&vs[o[1]]*17,g:255&vs[o[2]]*17,b:255&vs[o[3]]*17,a:s===5?vs[o[4]]*17:255}:(s===7||s===9)&&(a={r:vs[o[1]]<<4|vs[o[2]],g:vs[o[3]]<<4|vs[o[4]],b:vs[o[5]]<<4|vs[o[6]],a:s===9?vs[o[7]]<<4|vs[o[8]]:255})),a}const Jw=(o,s)=>o<255?s(o):"";function Qw(o){var s=Yw(o)?Hw:Xw;return o?"#"+s(o.r)+s(o.g)+s(o.b)+Jw(o.a,s):void 0}const t2=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Lx(o,s,a){const u=s*Math.min(a,1-a),p=(g,v=(g+o/30)%12)=>a-u*Math.max(Math.min(v-3,9-v,1),-1);return[p(0),p(8),p(4)]}function e2(o,s,a){const u=(p,g=(p+o/60)%6)=>a-a*s*Math.max(Math.min(g,4-g,1),0);return[u(5),u(3),u(1)]}function i2(o,s,a){const u=Lx(o,1,.5);let p;for(s+a>1&&(p=1/(s+a),s*=p,a*=p),p=0;p<3;p++)u[p]*=1-s-a,u[p]+=s;return u}function n2(o,s,a,u,p){return o===p?(s-a)/u+(s<a?6:0):s===p?(a-o)/u+2:(o-s)/u+4}function em(o){const a=o.r/255,u=o.g/255,p=o.b/255,g=Math.max(a,u,p),v=Math.min(a,u,p),r=(g+v)/2;let T,I,R;return g!==v&&(R=g-v,I=r>.5?R/(2-g-v):R/(g+v),T=n2(a,u,p,R,g),T=T*60+.5),[T|0,I||0,r]}function im(o,s,a,u){return(Array.isArray(s)?o(s[0],s[1],s[2]):o(s,a,u)).map(Po)}function nm(o,s,a){return im(Lx,o,s,a)}function s2(o,s,a){return im(i2,o,s,a)}function r2(o,s,a){return im(e2,o,s,a)}function zx(o){return(o%360+360)%360}function o2(o){const s=t2.exec(o);let a=255,u;if(!s)return;s[5]!==u&&(a=s[6]?Uh(+s[5]):Po(+s[5]));const p=zx(+s[2]),g=+s[3]/100,v=+s[4]/100;return s[1]==="hwb"?u=s2(p,g,v):s[1]==="hsv"?u=r2(p,g,v):u=nm(p,g,v),{r:u[0],g:u[1],b:u[2],a}}function a2(o,s){var a=em(o);a[0]=zx(a[0]+s),a=nm(a),o.r=a[0],o.g=a[1],o.b=a[2]}function l2(o){if(!o)return;const s=em(o),a=s[0],u=Q0(s[1]),p=Q0(s[2]);return o.a<255?`hsla(${a}, ${u}%, ${p}%, ${Br(o.a)})`:`hsl(${a}, ${u}%, ${p}%)`}const ty={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},ey={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function c2(){const o={},s=Object.keys(ey),a=Object.keys(ty);let u,p,g,v,r;for(u=0;u<s.length;u++){for(v=r=s[u],p=0;p<a.length;p++)g=a[p],r=r.replace(g,ty[g]);g=parseInt(ey[v],16),o[r]=[g>>16&255,g>>8&255,g&255]}return o}let jd;function h2(o){jd||(jd=c2(),jd.transparent=[0,0,0,0]);const s=jd[o.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}const u2=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function d2(o){const s=u2.exec(o);let a=255,u,p,g;if(s){if(s[7]!==u){const v=+s[7];a=s[8]?Uh(v):Mo(v*255,0,255)}return u=+s[1],p=+s[3],g=+s[5],u=255&(s[2]?Uh(u):Mo(u,0,255)),p=255&(s[4]?Uh(p):Mo(p,0,255)),g=255&(s[6]?Uh(g):Mo(g,0,255)),{r:u,g:p,b:g,a}}}function p2(o){return o&&(o.a<255?`rgba(${o.r}, ${o.g}, ${o.b}, ${Br(o.a)})`:`rgb(${o.r}, ${o.g}, ${o.b})`)}const m_=o=>o<=.0031308?o*12.92:Math.pow(o,1/2.4)*1.055-.055,$l=o=>o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4);function f2(o,s,a){const u=$l(Br(o.r)),p=$l(Br(o.g)),g=$l(Br(o.b));return{r:Po(m_(u+a*($l(Br(s.r))-u))),g:Po(m_(p+a*($l(Br(s.g))-p))),b:Po(m_(g+a*($l(Br(s.b))-g))),a:o.a+a*(s.a-o.a)}}function Vd(o,s,a){if(o){let u=em(o);u[s]=Math.max(0,Math.min(u[s]+u[s]*a,s===0?360:1)),u=nm(u),o.r=u[0],o.g=u[1],o.b=u[2]}}function Rx(o,s){return o&&Object.assign(s||{},o)}function iy(o){var s={r:0,g:0,b:0,a:255};return Array.isArray(o)?o.length>=3&&(s={r:o[0],g:o[1],b:o[2],a:255},o.length>3&&(s.a=Po(o[3]))):(s=Rx(o,{r:0,g:0,b:0,a:1}),s.a=Po(s.a)),s}function _2(o){return o.charAt(0)==="r"?d2(o):o2(o)}class eu{constructor(s){if(s instanceof eu)return s;const a=typeof s;let u;a==="object"?u=iy(s):a==="string"&&(u=Kw(s)||h2(s)||_2(s)),this._rgb=u,this._valid=!!u}get valid(){return this._valid}get rgb(){var s=Rx(this._rgb);return s&&(s.a=Br(s.a)),s}set rgb(s){this._rgb=iy(s)}rgbString(){return this._valid?p2(this._rgb):void 0}hexString(){return this._valid?Qw(this._rgb):void 0}hslString(){return this._valid?l2(this._rgb):void 0}mix(s,a){if(s){const u=this.rgb,p=s.rgb;let g;const v=a===g?.5:a,r=2*v-1,T=u.a-p.a,I=((r*T===-1?r:(r+T)/(1+r*T))+1)/2;g=1-I,u.r=255&I*u.r+g*p.r+.5,u.g=255&I*u.g+g*p.g+.5,u.b=255&I*u.b+g*p.b+.5,u.a=v*u.a+(1-v)*p.a,this.rgb=u}return this}interpolate(s,a){return s&&(this._rgb=f2(this._rgb,s._rgb,a)),this}clone(){return new eu(this.rgb)}alpha(s){return this._rgb.a=Po(s),this}clearer(s){const a=this._rgb;return a.a*=1-s,this}greyscale(){const s=this._rgb,a=uu(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=a,this}opaquer(s){const a=this._rgb;return a.a*=1+s,this}negate(){const s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return Vd(this._rgb,2,s),this}darken(s){return Vd(this._rgb,2,-s),this}saturate(s){return Vd(this._rgb,1,s),this}desaturate(s){return Vd(this._rgb,1,-s),this}rotate(s){return a2(this._rgb,s),this}}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */function zr(){}const m2=(()=>{let o=0;return()=>o++})();function ti(o){return o===null||typeof o>"u"}function zi(o){if(Array.isArray&&Array.isArray(o))return!0;const s=Object.prototype.toString.call(o);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function Ye(o){return o!==null&&Object.prototype.toString.call(o)==="[object Object]"}function Yi(o){return(typeof o=="number"||o instanceof Number)&&isFinite(+o)}function as(o,s){return Yi(o)?o:s}function Ve(o,s){return typeof o>"u"?s:o}const g2=(o,s)=>typeof o=="string"&&o.endsWith("%")?parseFloat(o)/100:+o/s,Ox=(o,s)=>typeof o=="string"&&o.endsWith("%")?parseFloat(o)/100*s:+o;function Ci(o,s,a){if(o&&typeof o.call=="function")return o.apply(a,s)}function yi(o,s,a,u){let p,g,v;if(zi(o))if(g=o.length,u)for(p=g-1;p>=0;p--)s.call(a,o[p],p);else for(p=0;p<g;p++)s.call(a,o[p],p);else if(Ye(o))for(v=Object.keys(o),g=v.length,p=0;p<g;p++)s.call(a,o[v[p]],v[p])}function gp(o,s){let a,u,p,g;if(!o||!s||o.length!==s.length)return!1;for(a=0,u=o.length;a<u;++a)if(p=o[a],g=s[a],p.datasetIndex!==g.datasetIndex||p.index!==g.index)return!1;return!0}function yp(o){if(zi(o))return o.map(yp);if(Ye(o)){const s=Object.create(null),a=Object.keys(o),u=a.length;let p=0;for(;p<u;++p)s[a[p]]=yp(o[a[p]]);return s}return o}function Bx(o){return["__proto__","prototype","constructor"].indexOf(o)===-1}function y2(o,s,a,u){if(!Bx(o))return;const p=s[o],g=a[o];Ye(p)&&Ye(g)?iu(p,g,u):s[o]=yp(g)}function iu(o,s,a){const u=zi(s)?s:[s],p=u.length;if(!Ye(o))return o;a=a||{};const g=a.merger||y2;let v;for(let r=0;r<p;++r){if(v=u[r],!Ye(v))continue;const T=Object.keys(v);for(let I=0,R=T.length;I<R;++I)g(T[I],o,v,a)}return o}function Yh(o,s){return iu(o,s,{merger:x2})}function x2(o,s,a){if(!Bx(o))return;const u=s[o],p=a[o];Ye(u)&&Ye(p)?Yh(u,p):Object.prototype.hasOwnProperty.call(s,o)||(s[o]=yp(p))}const ny={"":o=>o,x:o=>o.x,y:o=>o.y};function v2(o){const s=o.split("."),a=[];let u="";for(const p of s)u+=p,u.endsWith("\\")?u=u.slice(0,-1)+".":(a.push(u),u="");return a}function b2(o){const s=v2(o);return a=>{for(const u of s){if(u==="")break;a=a&&a[u]}return a}}function ko(o,s){return(ny[s]||(ny[s]=b2(s)))(o)}function sm(o){return o.charAt(0).toUpperCase()+o.slice(1)}const nu=o=>typeof o<"u",Do=o=>typeof o=="function",sy=(o,s)=>{if(o.size!==s.size)return!1;for(const a of o)if(!s.has(a))return!1;return!0};function w2(o){return o.type==="mouseup"||o.type==="click"||o.type==="contextmenu"}const Oi=Math.PI,Ri=2*Oi,T2=Ri+Oi,xp=Number.POSITIVE_INFINITY,E2=Oi/180,Ji=Oi/2,Ca=Oi/4,ry=Oi*2/3,Ao=Math.log10,hr=Math.sign;function Kh(o,s,a){return Math.abs(o-s)<a}function oy(o){const s=Math.round(o);o=Kh(o,s,o/1e3)?s:o;const a=Math.pow(10,Math.floor(Ao(o))),u=o/a;return(u<=1?1:u<=2?2:u<=5?5:10)*a}function S2(o){const s=[],a=Math.sqrt(o);let u;for(u=1;u<a;u++)o%u===0&&(s.push(u),s.push(o/u));return a===(a|0)&&s.push(a),s.sort((p,g)=>p-g).pop(),s}function Jl(o){return!isNaN(parseFloat(o))&&isFinite(o)}function M2(o,s){const a=Math.round(o);return a-s<=o&&a+s>=o}function Fx(o,s,a){let u,p,g;for(u=0,p=o.length;u<p;u++)g=o[u][a],isNaN(g)||(s.min=Math.min(s.min,g),s.max=Math.max(s.max,g))}function qs(o){return o*(Oi/180)}function rm(o){return o*(180/Oi)}function ay(o){if(!Yi(o))return;let s=1,a=0;for(;Math.round(o*s)/s!==o;)s*=10,a++;return a}function Nx(o,s){const a=s.x-o.x,u=s.y-o.y,p=Math.sqrt(a*a+u*u);let g=Math.atan2(u,a);return g<-.5*Oi&&(g+=Ri),{angle:g,distance:p}}function F_(o,s){return Math.sqrt(Math.pow(s.x-o.x,2)+Math.pow(s.y-o.y,2))}function A2(o,s){return(o-s+T2)%Ri-Oi}function ls(o){return(o%Ri+Ri)%Ri}function su(o,s,a,u){const p=ls(o),g=ls(s),v=ls(a),r=ls(g-p),T=ls(v-p),I=ls(p-g),R=ls(p-v);return p===g||p===v||u&&g===v||r>T&&I<R}function mn(o,s,a){return Math.max(s,Math.min(a,o))}function C2(o){return mn(o,-32768,32767)}function Fr(o,s,a,u=1e-6){return o>=Math.min(s,a)-u&&o<=Math.max(s,a)+u}function om(o,s,a){a=a||(v=>o[v]<s);let u=o.length-1,p=0,g;for(;u-p>1;)g=p+u>>1,a(g)?p=g:u=g;return{lo:p,hi:u}}const Nr=(o,s,a,u)=>om(o,a,u?p=>{const g=o[p][s];return g<a||g===a&&o[p+1][s]===a}:p=>o[p][s]<a),I2=(o,s,a)=>om(o,a,u=>o[u][s]>=a);function P2(o,s,a){let u=0,p=o.length;for(;u<p&&o[u]<s;)u++;for(;p>u&&o[p-1]>a;)p--;return u>0||p<o.length?o.slice(u,p):o}const jx=["push","pop","shift","splice","unshift"];function k2(o,s){if(o._chartjs){o._chartjs.listeners.push(s);return}Object.defineProperty(o,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),jx.forEach(a=>{const u="_onData"+sm(a),p=o[a];Object.defineProperty(o,a,{configurable:!0,enumerable:!1,value(...g){const v=p.apply(this,g);return o._chartjs.listeners.forEach(r=>{typeof r[u]=="function"&&r[u](...g)}),v}})})}function ly(o,s){const a=o._chartjs;if(!a)return;const u=a.listeners,p=u.indexOf(s);p!==-1&&u.splice(p,1),!(u.length>0)&&(jx.forEach(g=>{delete o[g]}),delete o._chartjs)}function Vx(o){const s=new Set(o);return s.size===o.length?o:Array.from(s)}const Ux=function(){return typeof window>"u"?function(o){return o()}:window.requestAnimationFrame}();function Gx(o,s){let a=[],u=!1;return function(...p){a=p,u||(u=!0,Ux.call(window,()=>{u=!1,o.apply(s,a)}))}}function D2(o,s){let a;return function(...u){return s?(clearTimeout(a),a=setTimeout(o,s,u)):o.apply(this,u),s}}const am=o=>o==="start"?"left":o==="end"?"right":"center",Pn=(o,s,a)=>o==="start"?s:o==="end"?a:(s+a)/2,L2=(o,s,a,u)=>o===(u?"left":"right")?a:o==="center"?(s+a)/2:s;function qx(o,s,a){const u=s.length;let p=0,g=u;if(o._sorted){const{iScale:v,_parsed:r}=o,T=v.axis,{min:I,max:R,minDefined:F,maxDefined:U}=v.getUserBounds();F&&(p=mn(Math.min(Nr(r,T,I).lo,a?u:Nr(s,T,v.getPixelForValue(I)).lo),0,u-1)),U?g=mn(Math.max(Nr(r,v.axis,R,!0).hi+1,a?0:Nr(s,T,v.getPixelForValue(R),!0).hi+1),p,u)-p:g=u-p}return{start:p,count:g}}function $x(o){const{xScale:s,yScale:a,_scaleRanges:u}=o,p={xmin:s.min,xmax:s.max,ymin:a.min,ymax:a.max};if(!u)return o._scaleRanges=p,!0;const g=u.xmin!==s.min||u.xmax!==s.max||u.ymin!==a.min||u.ymax!==a.max;return Object.assign(u,p),g}const Ud=o=>o===0||o===1,cy=(o,s,a)=>-(Math.pow(2,10*(o-=1))*Math.sin((o-s)*Ri/a)),hy=(o,s,a)=>Math.pow(2,-10*o)*Math.sin((o-s)*Ri/a)+1,Jh={linear:o=>o,easeInQuad:o=>o*o,easeOutQuad:o=>-o*(o-2),easeInOutQuad:o=>(o/=.5)<1?.5*o*o:-.5*(--o*(o-2)-1),easeInCubic:o=>o*o*o,easeOutCubic:o=>(o-=1)*o*o+1,easeInOutCubic:o=>(o/=.5)<1?.5*o*o*o:.5*((o-=2)*o*o+2),easeInQuart:o=>o*o*o*o,easeOutQuart:o=>-((o-=1)*o*o*o-1),easeInOutQuart:o=>(o/=.5)<1?.5*o*o*o*o:-.5*((o-=2)*o*o*o-2),easeInQuint:o=>o*o*o*o*o,easeOutQuint:o=>(o-=1)*o*o*o*o+1,easeInOutQuint:o=>(o/=.5)<1?.5*o*o*o*o*o:.5*((o-=2)*o*o*o*o+2),easeInSine:o=>-Math.cos(o*Ji)+1,easeOutSine:o=>Math.sin(o*Ji),easeInOutSine:o=>-.5*(Math.cos(Oi*o)-1),easeInExpo:o=>o===0?0:Math.pow(2,10*(o-1)),easeOutExpo:o=>o===1?1:-Math.pow(2,-10*o)+1,easeInOutExpo:o=>Ud(o)?o:o<.5?.5*Math.pow(2,10*(o*2-1)):.5*(-Math.pow(2,-10*(o*2-1))+2),easeInCirc:o=>o>=1?o:-(Math.sqrt(1-o*o)-1),easeOutCirc:o=>Math.sqrt(1-(o-=1)*o),easeInOutCirc:o=>(o/=.5)<1?-.5*(Math.sqrt(1-o*o)-1):.5*(Math.sqrt(1-(o-=2)*o)+1),easeInElastic:o=>Ud(o)?o:cy(o,.075,.3),easeOutElastic:o=>Ud(o)?o:hy(o,.075,.3),easeInOutElastic(o){return Ud(o)?o:o<.5?.5*cy(o*2,.1125,.45):.5+.5*hy(o*2-1,.1125,.45)},easeInBack(o){return o*o*((1.70158+1)*o-1.70158)},easeOutBack(o){return(o-=1)*o*((1.70158+1)*o+1.70158)+1},easeInOutBack(o){let s=1.70158;return(o/=.5)<1?.5*(o*o*(((s*=1.525)+1)*o-s)):.5*((o-=2)*o*(((s*=1.525)+1)*o+s)+2)},easeInBounce:o=>1-Jh.easeOutBounce(1-o),easeOutBounce(o){return o<1/2.75?7.5625*o*o:o<2/2.75?7.5625*(o-=1.5/2.75)*o+.75:o<2.5/2.75?7.5625*(o-=2.25/2.75)*o+.9375:7.5625*(o-=2.625/2.75)*o+.984375},easeInOutBounce:o=>o<.5?Jh.easeInBounce(o*2)*.5:Jh.easeOutBounce(o*2-1)*.5+.5};function lm(o){if(o&&typeof o=="object"){const s=o.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function uy(o){return lm(o)?o:new eu(o)}function g_(o){return lm(o)?o:new eu(o).saturate(.5).darken(.1).hexString()}const z2=["x","y","borderWidth","radius","tension"],R2=["color","borderColor","backgroundColor"];function O2(o){o.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),o.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:s=>s!=="onProgress"&&s!=="onComplete"&&s!=="fn"}),o.set("animations",{colors:{type:"color",properties:R2},numbers:{type:"number",properties:z2}}),o.describe("animations",{_fallback:"animation"}),o.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:s=>s|0}}}})}function B2(o){o.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const dy=new Map;function F2(o,s){s=s||{};const a=o+JSON.stringify(s);let u=dy.get(a);return u||(u=new Intl.NumberFormat(o,s),dy.set(a,u)),u}function du(o,s,a){return F2(s,a).format(o)}const Wx={values(o){return zi(o)?o:""+o},numeric(o,s,a){if(o===0)return"0";const u=this.chart.options.locale;let p,g=o;if(a.length>1){const I=Math.max(Math.abs(a[0].value),Math.abs(a[a.length-1].value));(I<1e-4||I>1e15)&&(p="scientific"),g=N2(o,a)}const v=Ao(Math.abs(g)),r=isNaN(v)?1:Math.max(Math.min(-1*Math.floor(v),20),0),T={notation:p,minimumFractionDigits:r,maximumFractionDigits:r};return Object.assign(T,this.options.ticks.format),du(o,u,T)},logarithmic(o,s,a){if(o===0)return"0";const u=a[s].significand||o/Math.pow(10,Math.floor(Ao(o)));return[1,2,3,5,10,15].includes(u)||s>.8*a.length?Wx.numeric.call(this,o,s,a):""}};function N2(o,s){let a=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(a)>=1&&o!==Math.floor(o)&&(a=o-Math.floor(o)),a}var Ip={formatters:Wx};function j2(o){o.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(s,a)=>a.lineWidth,tickColor:(s,a)=>a.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ip.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),o.route("scale.ticks","color","","color"),o.route("scale.grid","color","","borderColor"),o.route("scale.border","color","","borderColor"),o.route("scale.title","color","","color"),o.describe("scale",{_fallback:!1,_scriptable:s=>!s.startsWith("before")&&!s.startsWith("after")&&s!=="callback"&&s!=="parser",_indexable:s=>s!=="borderDash"&&s!=="tickBorderDash"&&s!=="dash"}),o.describe("scales",{_fallback:"scale"}),o.describe("scale.ticks",{_scriptable:s=>s!=="backdropPadding"&&s!=="callback",_indexable:s=>s!=="backdropPadding"})}const ja=Object.create(null),N_=Object.create(null);function Qh(o,s){if(!s)return o;const a=s.split(".");for(let u=0,p=a.length;u<p;++u){const g=a[u];o=o[g]||(o[g]=Object.create(null))}return o}function y_(o,s,a){return typeof s=="string"?iu(Qh(o,s),a):iu(Qh(o,""),s)}class V2{constructor(s,a){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=u=>u.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(u,p)=>g_(p.backgroundColor),this.hoverBorderColor=(u,p)=>g_(p.borderColor),this.hoverColor=(u,p)=>g_(p.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s),this.apply(a)}set(s,a){return y_(this,s,a)}get(s){return Qh(this,s)}describe(s,a){return y_(N_,s,a)}override(s,a){return y_(ja,s,a)}route(s,a,u,p){const g=Qh(this,s),v=Qh(this,u),r="_"+a;Object.defineProperties(g,{[r]:{value:g[a],writable:!0},[a]:{enumerable:!0,get(){const T=this[r],I=v[p];return Ye(T)?Object.assign({},I,T):Ve(T,I)},set(T){this[r]=T}}})}apply(s){s.forEach(a=>a(this))}}var Ki=new V2({_scriptable:o=>!o.startsWith("on"),_indexable:o=>o!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[O2,B2,j2]);function U2(o){return!o||ti(o.size)||ti(o.family)?null:(o.style?o.style+" ":"")+(o.weight?o.weight+" ":"")+o.size+"px "+o.family}function vp(o,s,a,u,p){let g=s[p];return g||(g=s[p]=o.measureText(p).width,a.push(p)),g>u&&(u=g),u}function G2(o,s,a,u){u=u||{};let p=u.data=u.data||{},g=u.garbageCollect=u.garbageCollect||[];u.font!==s&&(p=u.data={},g=u.garbageCollect=[],u.font=s),o.save(),o.font=s;let v=0;const r=a.length;let T,I,R,F,U;for(T=0;T<r;T++)if(F=a[T],F!=null&&!zi(F))v=vp(o,p,g,v,F);else if(zi(F))for(I=0,R=F.length;I<R;I++)U=F[I],U!=null&&!zi(U)&&(v=vp(o,p,g,v,U));o.restore();const Y=g.length/2;if(Y>a.length){for(T=0;T<Y;T++)delete p[g[T]];g.splice(0,Y)}return v}function Ia(o,s,a){const u=o.currentDevicePixelRatio,p=a!==0?Math.max(a/2,.5):0;return Math.round((s-p)*u)/u+p}function py(o,s){s=s||o.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,o.width,o.height),s.restore()}function j_(o,s,a,u){Zx(o,s,a,u,null)}function Zx(o,s,a,u,p){let g,v,r,T,I,R,F,U;const Y=s.pointStyle,it=s.rotation,ct=s.radius;let ht=(it||0)*E2;if(Y&&typeof Y=="object"&&(g=Y.toString(),g==="[object HTMLImageElement]"||g==="[object HTMLCanvasElement]")){o.save(),o.translate(a,u),o.rotate(ht),o.drawImage(Y,-Y.width/2,-Y.height/2,Y.width,Y.height),o.restore();return}if(!(isNaN(ct)||ct<=0)){switch(o.beginPath(),Y){default:p?o.ellipse(a,u,p/2,ct,0,0,Ri):o.arc(a,u,ct,0,Ri),o.closePath();break;case"triangle":R=p?p/2:ct,o.moveTo(a+Math.sin(ht)*R,u-Math.cos(ht)*ct),ht+=ry,o.lineTo(a+Math.sin(ht)*R,u-Math.cos(ht)*ct),ht+=ry,o.lineTo(a+Math.sin(ht)*R,u-Math.cos(ht)*ct),o.closePath();break;case"rectRounded":I=ct*.516,T=ct-I,v=Math.cos(ht+Ca)*T,F=Math.cos(ht+Ca)*(p?p/2-I:T),r=Math.sin(ht+Ca)*T,U=Math.sin(ht+Ca)*(p?p/2-I:T),o.arc(a-F,u-r,I,ht-Oi,ht-Ji),o.arc(a+U,u-v,I,ht-Ji,ht),o.arc(a+F,u+r,I,ht,ht+Ji),o.arc(a-U,u+v,I,ht+Ji,ht+Oi),o.closePath();break;case"rect":if(!it){T=Math.SQRT1_2*ct,R=p?p/2:T,o.rect(a-R,u-T,2*R,2*T);break}ht+=Ca;case"rectRot":F=Math.cos(ht)*(p?p/2:ct),v=Math.cos(ht)*ct,r=Math.sin(ht)*ct,U=Math.sin(ht)*(p?p/2:ct),o.moveTo(a-F,u-r),o.lineTo(a+U,u-v),o.lineTo(a+F,u+r),o.lineTo(a-U,u+v),o.closePath();break;case"crossRot":ht+=Ca;case"cross":F=Math.cos(ht)*(p?p/2:ct),v=Math.cos(ht)*ct,r=Math.sin(ht)*ct,U=Math.sin(ht)*(p?p/2:ct),o.moveTo(a-F,u-r),o.lineTo(a+F,u+r),o.moveTo(a+U,u-v),o.lineTo(a-U,u+v);break;case"star":F=Math.cos(ht)*(p?p/2:ct),v=Math.cos(ht)*ct,r=Math.sin(ht)*ct,U=Math.sin(ht)*(p?p/2:ct),o.moveTo(a-F,u-r),o.lineTo(a+F,u+r),o.moveTo(a+U,u-v),o.lineTo(a-U,u+v),ht+=Ca,F=Math.cos(ht)*(p?p/2:ct),v=Math.cos(ht)*ct,r=Math.sin(ht)*ct,U=Math.sin(ht)*(p?p/2:ct),o.moveTo(a-F,u-r),o.lineTo(a+F,u+r),o.moveTo(a+U,u-v),o.lineTo(a-U,u+v);break;case"line":v=p?p/2:Math.cos(ht)*ct,r=Math.sin(ht)*ct,o.moveTo(a-v,u-r),o.lineTo(a+v,u+r);break;case"dash":o.moveTo(a,u),o.lineTo(a+Math.cos(ht)*(p?p/2:ct),u+Math.sin(ht)*ct);break;case!1:o.closePath();break}o.fill(),s.borderWidth>0&&o.stroke()}}function jr(o,s,a){return a=a||.5,!s||o&&o.x>s.left-a&&o.x<s.right+a&&o.y>s.top-a&&o.y<s.bottom+a}function Pp(o,s){o.save(),o.beginPath(),o.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),o.clip()}function kp(o){o.restore()}function q2(o,s,a,u,p){if(!s)return o.lineTo(a.x,a.y);if(p==="middle"){const g=(s.x+a.x)/2;o.lineTo(g,s.y),o.lineTo(g,a.y)}else p==="after"!=!!u?o.lineTo(s.x,a.y):o.lineTo(a.x,s.y);o.lineTo(a.x,a.y)}function $2(o,s,a,u){if(!s)return o.lineTo(a.x,a.y);o.bezierCurveTo(u?s.cp1x:s.cp2x,u?s.cp1y:s.cp2y,u?a.cp2x:a.cp1x,u?a.cp2y:a.cp1y,a.x,a.y)}function W2(o,s){s.translation&&o.translate(s.translation[0],s.translation[1]),ti(s.rotation)||o.rotate(s.rotation),s.color&&(o.fillStyle=s.color),s.textAlign&&(o.textAlign=s.textAlign),s.textBaseline&&(o.textBaseline=s.textBaseline)}function Z2(o,s,a,u,p){if(p.strikethrough||p.underline){const g=o.measureText(u),v=s-g.actualBoundingBoxLeft,r=s+g.actualBoundingBoxRight,T=a-g.actualBoundingBoxAscent,I=a+g.actualBoundingBoxDescent,R=p.strikethrough?(T+I)/2:I;o.strokeStyle=o.fillStyle,o.beginPath(),o.lineWidth=p.decorationWidth||2,o.moveTo(v,R),o.lineTo(r,R),o.stroke()}}function H2(o,s){const a=o.fillStyle;o.fillStyle=s.color,o.fillRect(s.left,s.top,s.width,s.height),o.fillStyle=a}function Va(o,s,a,u,p,g={}){const v=zi(s)?s:[s],r=g.strokeWidth>0&&g.strokeColor!=="";let T,I;for(o.save(),o.font=p.string,W2(o,g),T=0;T<v.length;++T)I=v[T],g.backdrop&&H2(o,g.backdrop),r&&(g.strokeColor&&(o.strokeStyle=g.strokeColor),ti(g.strokeWidth)||(o.lineWidth=g.strokeWidth),o.strokeText(I,a,u,g.maxWidth)),o.fillText(I,a,u,g.maxWidth),Z2(o,a,u,I,g),u+=Number(p.lineHeight);o.restore()}function ru(o,s){const{x:a,y:u,w:p,h:g,radius:v}=s;o.arc(a+v.topLeft,u+v.topLeft,v.topLeft,1.5*Oi,Oi,!0),o.lineTo(a,u+g-v.bottomLeft),o.arc(a+v.bottomLeft,u+g-v.bottomLeft,v.bottomLeft,Oi,Ji,!0),o.lineTo(a+p-v.bottomRight,u+g),o.arc(a+p-v.bottomRight,u+g-v.bottomRight,v.bottomRight,Ji,0,!0),o.lineTo(a+p,u+v.topRight),o.arc(a+p-v.topRight,u+v.topRight,v.topRight,0,-Ji,!0),o.lineTo(a+v.topLeft,u)}const X2=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Y2=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function K2(o,s){const a=(""+o).match(X2);if(!a||a[1]==="normal")return s*1.2;switch(o=+a[2],a[3]){case"px":return o;case"%":o/=100;break}return s*o}const J2=o=>+o||0;function cm(o,s){const a={},u=Ye(s),p=u?Object.keys(s):s,g=Ye(o)?u?v=>Ve(o[v],o[s[v]]):v=>o[v]:()=>o;for(const v of p)a[v]=J2(g(v));return a}function Hx(o){return cm(o,{top:"y",right:"x",bottom:"y",left:"x"})}function Fa(o){return cm(o,["topLeft","topRight","bottomLeft","bottomRight"])}function Dn(o){const s=Hx(o);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function hn(o,s){o=o||{},s=s||Ki.font;let a=Ve(o.size,s.size);typeof a=="string"&&(a=parseInt(a,10));let u=Ve(o.style,s.style);u&&!(""+u).match(Y2)&&(console.warn('Invalid font style specified: "'+u+'"'),u=void 0);const p={family:Ve(o.family,s.family),lineHeight:K2(Ve(o.lineHeight,s.lineHeight),a),size:a,style:u,weight:Ve(o.weight,s.weight),string:""};return p.string=U2(p),p}function Gh(o,s,a,u){let p=!0,g,v,r;for(g=0,v=o.length;g<v;++g)if(r=o[g],r!==void 0&&(s!==void 0&&typeof r=="function"&&(r=r(s),p=!1),a!==void 0&&zi(r)&&(r=r[a%r.length],p=!1),r!==void 0))return u&&!p&&(u.cacheable=!1),r}function Q2(o,s,a){const{min:u,max:p}=o,g=Ox(s,(p-u)/2),v=(r,T)=>a&&r===0?0:r+T;return{min:v(u,-Math.abs(g)),max:v(p,g)}}function Ro(o,s){return Object.assign(Object.create(o),s)}function hm(o,s=[""],a,u,p=()=>o[0]){const g=a||o;typeof u>"u"&&(u=Jx("_fallback",o));const v={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:o,_rootScopes:g,_fallback:u,_getTarget:p,override:r=>hm([r,...o],s,g,u)};return new Proxy(v,{deleteProperty(r,T){return delete r[T],delete r._keys,delete o[0][T],!0},get(r,T){return Yx(r,T,()=>aT(T,s,o,r))},getOwnPropertyDescriptor(r,T){return Reflect.getOwnPropertyDescriptor(r._scopes[0],T)},getPrototypeOf(){return Reflect.getPrototypeOf(o[0])},has(r,T){return _y(r).includes(T)},ownKeys(r){return _y(r)},set(r,T,I){const R=r._storage||(r._storage=p());return r[T]=R[T]=I,delete r._keys,!0}})}function Ql(o,s,a,u){const p={_cacheable:!1,_proxy:o,_context:s,_subProxy:a,_stack:new Set,_descriptors:Xx(o,u),setContext:g=>Ql(o,g,a,u),override:g=>Ql(o.override(g),s,a,u)};return new Proxy(p,{deleteProperty(g,v){return delete g[v],delete o[v],!0},get(g,v,r){return Yx(g,v,()=>eT(g,v,r))},getOwnPropertyDescriptor(g,v){return g._descriptors.allKeys?Reflect.has(o,v)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(o,v)},getPrototypeOf(){return Reflect.getPrototypeOf(o)},has(g,v){return Reflect.has(o,v)},ownKeys(){return Reflect.ownKeys(o)},set(g,v,r){return o[v]=r,delete g[v],!0}})}function Xx(o,s={scriptable:!0,indexable:!0}){const{_scriptable:a=s.scriptable,_indexable:u=s.indexable,_allKeys:p=s.allKeys}=o;return{allKeys:p,scriptable:a,indexable:u,isScriptable:Do(a)?a:()=>a,isIndexable:Do(u)?u:()=>u}}const tT=(o,s)=>o?o+sm(s):s,um=(o,s)=>Ye(s)&&o!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function Yx(o,s,a){if(Object.prototype.hasOwnProperty.call(o,s))return o[s];const u=a();return o[s]=u,u}function eT(o,s,a){const{_proxy:u,_context:p,_subProxy:g,_descriptors:v}=o;let r=u[s];return Do(r)&&v.isScriptable(s)&&(r=iT(s,r,o,a)),zi(r)&&r.length&&(r=nT(s,r,o,v.isIndexable)),um(s,r)&&(r=Ql(r,p,g&&g[s],v)),r}function iT(o,s,a,u){const{_proxy:p,_context:g,_subProxy:v,_stack:r}=a;if(r.has(o))throw new Error("Recursion detected: "+Array.from(r).join("->")+"->"+o);r.add(o);let T=s(g,v||u);return r.delete(o),um(o,T)&&(T=dm(p._scopes,p,o,T)),T}function nT(o,s,a,u){const{_proxy:p,_context:g,_subProxy:v,_descriptors:r}=a;if(typeof g.index<"u"&&u(o))return s[g.index%s.length];if(Ye(s[0])){const T=s,I=p._scopes.filter(R=>R!==T);s=[];for(const R of T){const F=dm(I,p,o,R);s.push(Ql(F,g,v&&v[o],r))}}return s}function Kx(o,s,a){return Do(o)?o(s,a):o}const sT=(o,s)=>o===!0?s:typeof o=="string"?ko(s,o):void 0;function rT(o,s,a,u,p){for(const g of s){const v=sT(a,g);if(v){o.add(v);const r=Kx(v._fallback,a,p);if(typeof r<"u"&&r!==a&&r!==u)return r}else if(v===!1&&typeof u<"u"&&a!==u)return null}return!1}function dm(o,s,a,u){const p=s._rootScopes,g=Kx(s._fallback,a,u),v=[...o,...p],r=new Set;r.add(u);let T=fy(r,v,a,g||a,u);return T===null||typeof g<"u"&&g!==a&&(T=fy(r,v,g,T,u),T===null)?!1:hm(Array.from(r),[""],p,g,()=>oT(s,a,u))}function fy(o,s,a,u,p){for(;a;)a=rT(o,s,a,u,p);return a}function oT(o,s,a){const u=o._getTarget();s in u||(u[s]={});const p=u[s];return zi(p)&&Ye(a)?a:p||{}}function aT(o,s,a,u){let p;for(const g of s)if(p=Jx(tT(g,o),a),typeof p<"u")return um(o,p)?dm(a,u,o,p):p}function Jx(o,s){for(const a of s){if(!a)continue;const u=a[o];if(typeof u<"u")return u}}function _y(o){let s=o._keys;return s||(s=o._keys=lT(o._scopes)),s}function lT(o){const s=new Set;for(const a of o)for(const u of Object.keys(a).filter(p=>!p.startsWith("_")))s.add(u);return Array.from(s)}function Qx(o,s,a,u){const{iScale:p}=o,{key:g="r"}=this._parsing,v=new Array(u);let r,T,I,R;for(r=0,T=u;r<T;++r)I=r+a,R=s[I],v[r]={r:p.parse(ko(R,g),I)};return v}const cT=Number.EPSILON||1e-14,tc=(o,s)=>s<o.length&&!o[s].skip&&o[s],t1=o=>o==="x"?"y":"x";function hT(o,s,a,u){const p=o.skip?s:o,g=s,v=a.skip?s:a,r=F_(g,p),T=F_(v,g);let I=r/(r+T),R=T/(r+T);I=isNaN(I)?0:I,R=isNaN(R)?0:R;const F=u*I,U=u*R;return{previous:{x:g.x-F*(v.x-p.x),y:g.y-F*(v.y-p.y)},next:{x:g.x+U*(v.x-p.x),y:g.y+U*(v.y-p.y)}}}function uT(o,s,a){const u=o.length;let p,g,v,r,T,I=tc(o,0);for(let R=0;R<u-1;++R)if(T=I,I=tc(o,R+1),!(!T||!I)){if(Kh(s[R],0,cT)){a[R]=a[R+1]=0;continue}p=a[R]/s[R],g=a[R+1]/s[R],r=Math.pow(p,2)+Math.pow(g,2),!(r<=9)&&(v=3/Math.sqrt(r),a[R]=p*v*s[R],a[R+1]=g*v*s[R])}}function dT(o,s,a="x"){const u=t1(a),p=o.length;let g,v,r,T=tc(o,0);for(let I=0;I<p;++I){if(v=r,r=T,T=tc(o,I+1),!r)continue;const R=r[a],F=r[u];v&&(g=(R-v[a])/3,r[`cp1${a}`]=R-g,r[`cp1${u}`]=F-g*s[I]),T&&(g=(T[a]-R)/3,r[`cp2${a}`]=R+g,r[`cp2${u}`]=F+g*s[I])}}function pT(o,s="x"){const a=t1(s),u=o.length,p=Array(u).fill(0),g=Array(u);let v,r,T,I=tc(o,0);for(v=0;v<u;++v)if(r=T,T=I,I=tc(o,v+1),!!T){if(I){const R=I[s]-T[s];p[v]=R!==0?(I[a]-T[a])/R:0}g[v]=r?I?hr(p[v-1])!==hr(p[v])?0:(p[v-1]+p[v])/2:p[v-1]:p[v]}uT(o,p,g),dT(o,g,s)}function Gd(o,s,a){return Math.max(Math.min(o,a),s)}function fT(o,s){let a,u,p,g,v,r=jr(o[0],s);for(a=0,u=o.length;a<u;++a)v=g,g=r,r=a<u-1&&jr(o[a+1],s),g&&(p=o[a],v&&(p.cp1x=Gd(p.cp1x,s.left,s.right),p.cp1y=Gd(p.cp1y,s.top,s.bottom)),r&&(p.cp2x=Gd(p.cp2x,s.left,s.right),p.cp2y=Gd(p.cp2y,s.top,s.bottom)))}function _T(o,s,a,u,p){let g,v,r,T;if(s.spanGaps&&(o=o.filter(I=>!I.skip)),s.cubicInterpolationMode==="monotone")pT(o,p);else{let I=u?o[o.length-1]:o[0];for(g=0,v=o.length;g<v;++g)r=o[g],T=hT(I,r,o[Math.min(g+1,v-(u?0:1))%v],s.tension),r.cp1x=T.previous.x,r.cp1y=T.previous.y,r.cp2x=T.next.x,r.cp2y=T.next.y,I=r}s.capBezierPoints&&fT(o,a)}function e1(){return typeof window<"u"&&typeof document<"u"}function pm(o){let s=o.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function bp(o,s,a){let u;return typeof o=="string"?(u=parseInt(o,10),o.indexOf("%")!==-1&&(u=u/100*s.parentNode[a])):u=o,u}const Dp=o=>o.ownerDocument.defaultView.getComputedStyle(o,null);function mT(o,s){return Dp(o).getPropertyValue(s)}const gT=["top","right","bottom","left"];function Na(o,s,a){const u={};a=a?"-"+a:"";for(let p=0;p<4;p++){const g=gT[p];u[g]=parseFloat(o[s+"-"+g+a])||0}return u.width=u.left+u.right,u.height=u.top+u.bottom,u}const yT=(o,s,a)=>(o>0||s>0)&&(!a||!a.shadowRoot);function xT(o,s){const a=o.touches,u=a&&a.length?a[0]:o,{offsetX:p,offsetY:g}=u;let v=!1,r,T;if(yT(p,g,o.target))r=p,T=g;else{const I=s.getBoundingClientRect();r=u.clientX-I.left,T=u.clientY-I.top,v=!0}return{x:r,y:T,box:v}}function za(o,s){if("native"in o)return o;const{canvas:a,currentDevicePixelRatio:u}=s,p=Dp(a),g=p.boxSizing==="border-box",v=Na(p,"padding"),r=Na(p,"border","width"),{x:T,y:I,box:R}=xT(o,a),F=v.left+(R&&r.left),U=v.top+(R&&r.top);let{width:Y,height:it}=s;return g&&(Y-=v.width+r.width,it-=v.height+r.height),{x:Math.round((T-F)/Y*a.width/u),y:Math.round((I-U)/it*a.height/u)}}function vT(o,s,a){let u,p;if(s===void 0||a===void 0){const g=pm(o);if(!g)s=o.clientWidth,a=o.clientHeight;else{const v=g.getBoundingClientRect(),r=Dp(g),T=Na(r,"border","width"),I=Na(r,"padding");s=v.width-I.width-T.width,a=v.height-I.height-T.height,u=bp(r.maxWidth,g,"clientWidth"),p=bp(r.maxHeight,g,"clientHeight")}}return{width:s,height:a,maxWidth:u||xp,maxHeight:p||xp}}const qd=o=>Math.round(o*10)/10;function bT(o,s,a,u){const p=Dp(o),g=Na(p,"margin"),v=bp(p.maxWidth,o,"clientWidth")||xp,r=bp(p.maxHeight,o,"clientHeight")||xp,T=vT(o,s,a);let{width:I,height:R}=T;if(p.boxSizing==="content-box"){const U=Na(p,"border","width"),Y=Na(p,"padding");I-=Y.width+U.width,R-=Y.height+U.height}return I=Math.max(0,I-g.width),R=Math.max(0,u?I/u:R-g.height),I=qd(Math.min(I,v,T.maxWidth)),R=qd(Math.min(R,r,T.maxHeight)),I&&!R&&(R=qd(I/2)),(s!==void 0||a!==void 0)&&u&&T.height&&R>T.height&&(R=T.height,I=qd(Math.floor(R*u))),{width:I,height:R}}function my(o,s,a){const u=s||1,p=Math.floor(o.height*u),g=Math.floor(o.width*u);o.height=Math.floor(o.height),o.width=Math.floor(o.width);const v=o.canvas;return v.style&&(a||!v.style.height&&!v.style.width)&&(v.style.height=`${o.height}px`,v.style.width=`${o.width}px`),o.currentDevicePixelRatio!==u||v.height!==p||v.width!==g?(o.currentDevicePixelRatio=u,v.height=p,v.width=g,o.ctx.setTransform(u,0,0,u,0,0),!0):!1}const wT=function(){let o=!1;try{const s={get passive(){return o=!0,!1}};window.addEventListener("test",null,s),window.removeEventListener("test",null,s)}catch{}return o}();function gy(o,s){const a=mT(o,s),u=a&&a.match(/^(\d+)(\.\d+)?px$/);return u?+u[1]:void 0}function Ra(o,s,a,u){return{x:o.x+a*(s.x-o.x),y:o.y+a*(s.y-o.y)}}function TT(o,s,a,u){return{x:o.x+a*(s.x-o.x),y:u==="middle"?a<.5?o.y:s.y:u==="after"?a<1?o.y:s.y:a>0?s.y:o.y}}function ET(o,s,a,u){const p={x:o.cp2x,y:o.cp2y},g={x:s.cp1x,y:s.cp1y},v=Ra(o,p,a),r=Ra(p,g,a),T=Ra(g,s,a),I=Ra(v,r,a),R=Ra(r,T,a);return Ra(I,R,a)}const ST=function(o,s){return{x(a){return o+o+s-a},setWidth(a){s=a},textAlign(a){return a==="center"?a:a==="right"?"left":"right"},xPlus(a,u){return a-u},leftForLtr(a,u){return a-u}}},MT=function(){return{x(o){return o},setWidth(o){},textAlign(o){return o},xPlus(o,s){return o+s},leftForLtr(o,s){return o}}};function Hl(o,s,a){return o?ST(s,a):MT()}function i1(o,s){let a,u;(s==="ltr"||s==="rtl")&&(a=o.canvas.style,u=[a.getPropertyValue("direction"),a.getPropertyPriority("direction")],a.setProperty("direction",s,"important"),o.prevTextDirection=u)}function n1(o,s){s!==void 0&&(delete o.prevTextDirection,o.canvas.style.setProperty("direction",s[0],s[1]))}function s1(o){return o==="angle"?{between:su,compare:A2,normalize:ls}:{between:Fr,compare:(s,a)=>s-a,normalize:s=>s}}function yy({start:o,end:s,count:a,loop:u,style:p}){return{start:o%a,end:s%a,loop:u&&(s-o+1)%a===0,style:p}}function AT(o,s,a){const{property:u,start:p,end:g}=a,{between:v,normalize:r}=s1(u),T=s.length;let{start:I,end:R,loop:F}=o,U,Y;if(F){for(I+=T,R+=T,U=0,Y=T;U<Y&&v(r(s[I%T][u]),p,g);++U)I--,R--;I%=T,R%=T}return R<I&&(R+=T),{start:I,end:R,loop:F,style:o.style}}function r1(o,s,a){if(!a)return[o];const{property:u,start:p,end:g}=a,v=s.length,{compare:r,between:T,normalize:I}=s1(u),{start:R,end:F,loop:U,style:Y}=AT(o,s,a),it=[];let ct=!1,ht=null,bt,Dt,Ft;const Wt=()=>T(p,Ft,bt)&&r(p,Ft)!==0,Rt=()=>r(g,bt)===0||T(g,Ft,bt),Jt=()=>ct||Wt(),ne=()=>!ct||Rt();for(let se=R,Lt=R;se<=F;++se)Dt=s[se%v],!Dt.skip&&(bt=I(Dt[u]),bt!==Ft&&(ct=T(bt,p,g),ht===null&&Jt()&&(ht=r(bt,p)===0?se:Lt),ht!==null&&ne()&&(it.push(yy({start:ht,end:se,loop:U,count:v,style:Y})),ht=null),Lt=se,Ft=bt));return ht!==null&&it.push(yy({start:ht,end:F,loop:U,count:v,style:Y})),it}function o1(o,s){const a=[],u=o.segments;for(let p=0;p<u.length;p++){const g=r1(u[p],o.points,s);g.length&&a.push(...g)}return a}function CT(o,s,a,u){let p=0,g=s-1;if(a&&!u)for(;p<s&&!o[p].skip;)p++;for(;p<s&&o[p].skip;)p++;for(p%=s,a&&(g+=p);g>p&&o[g%s].skip;)g--;return g%=s,{start:p,end:g}}function IT(o,s,a,u){const p=o.length,g=[];let v=s,r=o[s],T;for(T=s+1;T<=a;++T){const I=o[T%p];I.skip||I.stop?r.skip||(u=!1,g.push({start:s%p,end:(T-1)%p,loop:u}),s=v=I.stop?T:null):(v=T,r.skip&&(s=T)),r=I}return v!==null&&g.push({start:s%p,end:v%p,loop:u}),g}function PT(o,s){const a=o.points,u=o.options.spanGaps,p=a.length;if(!p)return[];const g=!!o._loop,{start:v,end:r}=CT(a,p,g,u);if(u===!0)return xy(o,[{start:v,end:r,loop:g}],a,s);const T=r<v?r+p:r,I=!!o._fullLoop&&v===0&&r===p-1;return xy(o,IT(a,v,T,I),a,s)}function xy(o,s,a,u){return!u||!u.setContext||!a?s:kT(o,s,a,u)}function kT(o,s,a,u){const p=o._chart.getContext(),g=vy(o.options),{_datasetIndex:v,options:{spanGaps:r}}=o,T=a.length,I=[];let R=g,F=s[0].start,U=F;function Y(it,ct,ht,bt){const Dt=r?-1:1;if(it!==ct){for(it+=T;a[it%T].skip;)it-=Dt;for(;a[ct%T].skip;)ct+=Dt;it%T!==ct%T&&(I.push({start:it%T,end:ct%T,loop:ht,style:bt}),R=bt,F=ct%T)}}for(const it of s){F=r?F:it.start;let ct=a[F%T],ht;for(U=F+1;U<=it.end;U++){const bt=a[U%T];ht=vy(u.setContext(Ro(p,{type:"segment",p0:ct,p1:bt,p0DataIndex:(U-1)%T,p1DataIndex:U%T,datasetIndex:v}))),DT(ht,R)&&Y(F,U-1,it.loop,R),ct=bt,R=ht}F<U-1&&Y(F,U-1,it.loop,R)}return I}function vy(o){return{backgroundColor:o.backgroundColor,borderCapStyle:o.borderCapStyle,borderDash:o.borderDash,borderDashOffset:o.borderDashOffset,borderJoinStyle:o.borderJoinStyle,borderWidth:o.borderWidth,borderColor:o.borderColor}}function DT(o,s){if(!s)return!1;const a=[],u=function(p,g){return lm(g)?(a.includes(g)||a.push(g),a.indexOf(g)):g};return JSON.stringify(o,u)!==JSON.stringify(s,u)}/*!
 * Chart.js v4.4.0
 * https://www.chartjs.org
 * (c) 2023 Chart.js Contributors
 * Released under the MIT License
 */class LT{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,a,u,p){const g=a.listeners[p],v=a.duration;g.forEach(r=>r({chart:s,initial:a.initial,numSteps:v,currentStep:Math.min(u-a.start,v)}))}_refresh(){this._request||(this._running=!0,this._request=Ux.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let a=0;this._charts.forEach((u,p)=>{if(!u.running||!u.items.length)return;const g=u.items;let v=g.length-1,r=!1,T;for(;v>=0;--v)T=g[v],T._active?(T._total>u.duration&&(u.duration=T._total),T.tick(s),r=!0):(g[v]=g[g.length-1],g.pop());r&&(p.draw(),this._notify(p,u,s,"progress")),g.length||(u.running=!1,this._notify(p,u,s,"complete"),u.initial=!1),a+=g.length}),this._lastDate=s,a===0&&(this._running=!1)}_getAnims(s){const a=this._charts;let u=a.get(s);return u||(u={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},a.set(s,u)),u}listen(s,a,u){this._getAnims(s).listeners[a].push(u)}add(s,a){!a||!a.length||this._getAnims(s).items.push(...a)}has(s){return this._getAnims(s).items.length>0}start(s){const a=this._charts.get(s);a&&(a.running=!0,a.start=Date.now(),a.duration=a.items.reduce((u,p)=>Math.max(u,p._duration),0),this._refresh())}running(s){if(!this._running)return!1;const a=this._charts.get(s);return!(!a||!a.running||!a.items.length)}stop(s){const a=this._charts.get(s);if(!a||!a.items.length)return;const u=a.items;let p=u.length-1;for(;p>=0;--p)u[p].cancel();a.items=[],this._notify(s,a,Date.now(),"complete")}remove(s){return this._charts.delete(s)}}var Rr=new LT;const by="transparent",zT={boolean(o,s,a){return a>.5?s:o},color(o,s,a){const u=uy(o||by),p=u.valid&&uy(s||by);return p&&p.valid?p.mix(u,a).hexString():s},number(o,s,a){return o+(s-o)*a}};class RT{constructor(s,a,u,p){const g=a[u];p=Gh([s.to,p,g,s.from]);const v=Gh([s.from,g,p]);this._active=!0,this._fn=s.fn||zT[s.type||typeof v],this._easing=Jh[s.easing]||Jh.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=a,this._prop=u,this._from=v,this._to=p,this._promises=void 0}active(){return this._active}update(s,a,u){if(this._active){this._notify(!1);const p=this._target[this._prop],g=u-this._start,v=this._duration-g;this._start=u,this._duration=Math.floor(Math.max(v,s.duration)),this._total+=g,this._loop=!!s.loop,this._to=Gh([s.to,a,p,s.from]),this._from=Gh([s.from,p,a])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){const a=s-this._start,u=this._duration,p=this._prop,g=this._from,v=this._loop,r=this._to;let T;if(this._active=g!==r&&(v||a<u),!this._active){this._target[p]=r,this._notify(!0);return}if(a<0){this._target[p]=g;return}T=a/u%2,T=v&&T>1?2-T:T,T=this._easing(Math.min(1,Math.max(0,T))),this._target[p]=this._fn(g,r,T)}wait(){const s=this._promises||(this._promises=[]);return new Promise((a,u)=>{s.push({res:a,rej:u})})}_notify(s){const a=s?"res":"rej",u=this._promises||[];for(let p=0;p<u.length;p++)u[p][a]()}}class a1{constructor(s,a){this._chart=s,this._properties=new Map,this.configure(a)}configure(s){if(!Ye(s))return;const a=Object.keys(Ki.animation),u=this._properties;Object.getOwnPropertyNames(s).forEach(p=>{const g=s[p];if(!Ye(g))return;const v={};for(const r of a)v[r]=g[r];(zi(g.properties)&&g.properties||[p]).forEach(r=>{(r===p||!u.has(r))&&u.set(r,v)})})}_animateOptions(s,a){const u=a.options,p=BT(s,u);if(!p)return[];const g=this._createAnimations(p,u);return u.$shared&&OT(s.options.$animations,u).then(()=>{s.options=u},()=>{}),g}_createAnimations(s,a){const u=this._properties,p=[],g=s.$animations||(s.$animations={}),v=Object.keys(a),r=Date.now();let T;for(T=v.length-1;T>=0;--T){const I=v[T];if(I.charAt(0)==="$")continue;if(I==="options"){p.push(...this._animateOptions(s,a));continue}const R=a[I];let F=g[I];const U=u.get(I);if(F)if(U&&F.active()){F.update(U,R,r);continue}else F.cancel();if(!U||!U.duration){s[I]=R;continue}g[I]=F=new RT(U,s,I,R),p.push(F)}return p}update(s,a){if(this._properties.size===0){Object.assign(s,a);return}const u=this._createAnimations(s,a);if(u.length)return Rr.add(this._chart,u),!0}}function OT(o,s){const a=[],u=Object.keys(s);for(let p=0;p<u.length;p++){const g=o[u[p]];g&&g.active()&&a.push(g.wait())}return Promise.all(a)}function BT(o,s){if(!s)return;let a=o.options;if(!a){o.options=s;return}return a.$shared&&(o.options=a=Object.assign({},a,{$shared:!1,$animations:{}})),a}function wy(o,s){const a=o&&o.options||{},u=a.reverse,p=a.min===void 0?s:0,g=a.max===void 0?s:0;return{start:u?g:p,end:u?p:g}}function FT(o,s,a){if(a===!1)return!1;const u=wy(o,a),p=wy(s,a);return{top:p.end,right:u.end,bottom:p.start,left:u.start}}function NT(o){let s,a,u,p;return Ye(o)?(s=o.top,a=o.right,u=o.bottom,p=o.left):s=a=u=p=o,{top:s,right:a,bottom:u,left:p,disabled:o===!1}}function l1(o,s){const a=[],u=o._getSortedDatasetMetas(s);let p,g;for(p=0,g=u.length;p<g;++p)a.push(u[p].index);return a}function Ty(o,s,a,u={}){const p=o.keys,g=u.mode==="single";let v,r,T,I;if(s!==null){for(v=0,r=p.length;v<r;++v){if(T=+p[v],T===a){if(u.all)continue;break}I=o.values[T],Yi(I)&&(g||s===0||hr(s)===hr(I))&&(s+=I)}return s}}function jT(o){const s=Object.keys(o),a=new Array(s.length);let u,p,g;for(u=0,p=s.length;u<p;++u)g=s[u],a[u]={x:g,y:o[g]};return a}function Ey(o,s){const a=o&&o.options.stacked;return a||a===void 0&&s.stack!==void 0}function VT(o,s,a){return`${o.id}.${s.id}.${a.stack||a.type}`}function UT(o){const{min:s,max:a,minDefined:u,maxDefined:p}=o.getUserBounds();return{min:u?s:Number.NEGATIVE_INFINITY,max:p?a:Number.POSITIVE_INFINITY}}function GT(o,s,a){const u=o[s]||(o[s]={});return u[a]||(u[a]={})}function Sy(o,s,a,u){for(const p of s.getMatchingVisibleMetas(u).reverse()){const g=o[p.index];if(a&&g>0||!a&&g<0)return p.index}return null}function My(o,s){const{chart:a,_cachedMeta:u}=o,p=a._stacks||(a._stacks={}),{iScale:g,vScale:v,index:r}=u,T=g.axis,I=v.axis,R=VT(g,v,u),F=s.length;let U;for(let Y=0;Y<F;++Y){const it=s[Y],{[T]:ct,[I]:ht}=it,bt=it._stacks||(it._stacks={});U=bt[I]=GT(p,R,ct),U[r]=ht,U._top=Sy(U,v,!0,u.type),U._bottom=Sy(U,v,!1,u.type);const Dt=U._visualValues||(U._visualValues={});Dt[r]=ht}}function x_(o,s){const a=o.scales;return Object.keys(a).filter(u=>a[u].axis===s).shift()}function qT(o,s){return Ro(o,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function $T(o,s,a){return Ro(o,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:a,index:s,mode:"default",type:"data"})}function Oh(o,s){const a=o.controller.index,u=o.vScale&&o.vScale.axis;if(u){s=s||o._parsed;for(const p of s){const g=p._stacks;if(!g||g[u]===void 0||g[u][a]===void 0)return;delete g[u][a],g[u]._visualValues!==void 0&&g[u]._visualValues[a]!==void 0&&delete g[u]._visualValues[a]}}}const v_=o=>o==="reset"||o==="none",Ay=(o,s)=>s?o:Object.assign({},o),WT=(o,s,a)=>o&&!s.hidden&&s._stacked&&{keys:l1(a,!0),values:null};class Ws{constructor(s,a){this.chart=s,this._ctx=s.ctx,this.index=a,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const s=this._cachedMeta;this.configure(),this.linkScales(),s._stacked=Ey(s.vScale,s),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(s){this.index!==s&&Oh(this._cachedMeta),this.index=s}linkScales(){const s=this.chart,a=this._cachedMeta,u=this.getDataset(),p=(F,U,Y,it)=>F==="x"?U:F==="r"?it:Y,g=a.xAxisID=Ve(u.xAxisID,x_(s,"x")),v=a.yAxisID=Ve(u.yAxisID,x_(s,"y")),r=a.rAxisID=Ve(u.rAxisID,x_(s,"r")),T=a.indexAxis,I=a.iAxisID=p(T,g,v,r),R=a.vAxisID=p(T,v,g,r);a.xScale=this.getScaleForId(g),a.yScale=this.getScaleForId(v),a.rScale=this.getScaleForId(r),a.iScale=this.getScaleForId(I),a.vScale=this.getScaleForId(R)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(s){return this.chart.scales[s]}_getOtherScale(s){const a=this._cachedMeta;return s===a.iScale?a.vScale:a.iScale}reset(){this._update("reset")}_destroy(){const s=this._cachedMeta;this._data&&ly(this._data,this),s._stacked&&Oh(s)}_dataCheck(){const s=this.getDataset(),a=s.data||(s.data=[]),u=this._data;if(Ye(a))this._data=jT(a);else if(u!==a){if(u){ly(u,this);const p=this._cachedMeta;Oh(p),p._parsed=[]}a&&Object.isExtensible(a)&&k2(a,this),this._syncList=[],this._data=a}}addElements(){const s=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(s.dataset=new this.datasetElementType)}buildOrUpdateElements(s){const a=this._cachedMeta,u=this.getDataset();let p=!1;this._dataCheck();const g=a._stacked;a._stacked=Ey(a.vScale,a),a.stack!==u.stack&&(p=!0,Oh(a),a.stack=u.stack),this._resyncElements(s),(p||g!==a._stacked)&&My(this,a._parsed)}configure(){const s=this.chart.config,a=s.datasetScopeKeys(this._type),u=s.getOptionScopes(this.getDataset(),a,!0);this.options=s.createResolver(u,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(s,a){const{_cachedMeta:u,_data:p}=this,{iScale:g,_stacked:v}=u,r=g.axis;let T=s===0&&a===p.length?!0:u._sorted,I=s>0&&u._parsed[s-1],R,F,U;if(this._parsing===!1)u._parsed=p,u._sorted=!0,U=p;else{zi(p[s])?U=this.parseArrayData(u,p,s,a):Ye(p[s])?U=this.parseObjectData(u,p,s,a):U=this.parsePrimitiveData(u,p,s,a);const Y=()=>F[r]===null||I&&F[r]<I[r];for(R=0;R<a;++R)u._parsed[R+s]=F=U[R],T&&(Y()&&(T=!1),I=F);u._sorted=T}v&&My(this,U)}parsePrimitiveData(s,a,u,p){const{iScale:g,vScale:v}=s,r=g.axis,T=v.axis,I=g.getLabels(),R=g===v,F=new Array(p);let U,Y,it;for(U=0,Y=p;U<Y;++U)it=U+u,F[U]={[r]:R||g.parse(I[it],it),[T]:v.parse(a[it],it)};return F}parseArrayData(s,a,u,p){const{xScale:g,yScale:v}=s,r=new Array(p);let T,I,R,F;for(T=0,I=p;T<I;++T)R=T+u,F=a[R],r[T]={x:g.parse(F[0],R),y:v.parse(F[1],R)};return r}parseObjectData(s,a,u,p){const{xScale:g,yScale:v}=s,{xAxisKey:r="x",yAxisKey:T="y"}=this._parsing,I=new Array(p);let R,F,U,Y;for(R=0,F=p;R<F;++R)U=R+u,Y=a[U],I[R]={x:g.parse(ko(Y,r),U),y:v.parse(ko(Y,T),U)};return I}getParsed(s){return this._cachedMeta._parsed[s]}getDataElement(s){return this._cachedMeta.data[s]}applyStack(s,a,u){const p=this.chart,g=this._cachedMeta,v=a[s.axis],r={keys:l1(p,!0),values:a._stacks[s.axis]._visualValues};return Ty(r,v,g.index,{mode:u})}updateRangeFromParsed(s,a,u,p){const g=u[a.axis];let v=g===null?NaN:g;const r=p&&u._stacks[a.axis];p&&r&&(p.values=r,v=Ty(p,g,this._cachedMeta.index)),s.min=Math.min(s.min,v),s.max=Math.max(s.max,v)}getMinMax(s,a){const u=this._cachedMeta,p=u._parsed,g=u._sorted&&s===u.iScale,v=p.length,r=this._getOtherScale(s),T=WT(a,u,this.chart),I={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:R,max:F}=UT(r);let U,Y;function it(){Y=p[U];const ct=Y[r.axis];return!Yi(Y[s.axis])||R>ct||F<ct}for(U=0;U<v&&!(!it()&&(this.updateRangeFromParsed(I,s,Y,T),g));++U);if(g){for(U=v-1;U>=0;--U)if(!it()){this.updateRangeFromParsed(I,s,Y,T);break}}return I}getAllParsedValues(s){const a=this._cachedMeta._parsed,u=[];let p,g,v;for(p=0,g=a.length;p<g;++p)v=a[p][s.axis],Yi(v)&&u.push(v);return u}getMaxOverflow(){return!1}getLabelAndValue(s){const a=this._cachedMeta,u=a.iScale,p=a.vScale,g=this.getParsed(s);return{label:u?""+u.getLabelForValue(g[u.axis]):"",value:p?""+p.getLabelForValue(g[p.axis]):""}}_update(s){const a=this._cachedMeta;this.update(s||"default"),a._clip=NT(Ve(this.options.clip,FT(a.xScale,a.yScale,this.getMaxOverflow())))}update(s){}draw(){const s=this._ctx,a=this.chart,u=this._cachedMeta,p=u.data||[],g=a.chartArea,v=[],r=this._drawStart||0,T=this._drawCount||p.length-r,I=this.options.drawActiveElementsOnTop;let R;for(u.dataset&&u.dataset.draw(s,g,r,T),R=r;R<r+T;++R){const F=p[R];F.hidden||(F.active&&I?v.push(F):F.draw(s,g))}for(R=0;R<v.length;++R)v[R].draw(s,g)}getStyle(s,a){const u=a?"active":"default";return s===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(u):this.resolveDataElementOptions(s||0,u)}getContext(s,a,u){const p=this.getDataset();let g;if(s>=0&&s<this._cachedMeta.data.length){const v=this._cachedMeta.data[s];g=v.$context||(v.$context=$T(this.getContext(),s,v)),g.parsed=this.getParsed(s),g.raw=p.data[s],g.index=g.dataIndex=s}else g=this.$context||(this.$context=qT(this.chart.getContext(),this.index)),g.dataset=p,g.index=g.datasetIndex=this.index;return g.active=!!a,g.mode=u,g}resolveDatasetElementOptions(s){return this._resolveElementOptions(this.datasetElementType.id,s)}resolveDataElementOptions(s,a){return this._resolveElementOptions(this.dataElementType.id,a,s)}_resolveElementOptions(s,a="default",u){const p=a==="active",g=this._cachedDataOpts,v=s+"-"+a,r=g[v],T=this.enableOptionSharing&&nu(u);if(r)return Ay(r,T);const I=this.chart.config,R=I.datasetElementScopeKeys(this._type,s),F=p?[`${s}Hover`,"hover",s,""]:[s,""],U=I.getOptionScopes(this.getDataset(),R),Y=Object.keys(Ki.elements[s]),it=()=>this.getContext(u,p,a),ct=I.resolveNamedOptions(U,Y,it,F);return ct.$shared&&(ct.$shared=T,g[v]=Object.freeze(Ay(ct,T))),ct}_resolveAnimations(s,a,u){const p=this.chart,g=this._cachedDataOpts,v=`animation-${a}`,r=g[v];if(r)return r;let T;if(p.options.animation!==!1){const R=this.chart.config,F=R.datasetAnimationScopeKeys(this._type,a),U=R.getOptionScopes(this.getDataset(),F);T=R.createResolver(U,this.getContext(s,u,a))}const I=new a1(p,T&&T.animations);return T&&T._cacheable&&(g[v]=Object.freeze(I)),I}getSharedOptions(s){if(s.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},s))}includeOptions(s,a){return!a||v_(s)||this.chart._animationsDisabled}_getSharedOptions(s,a){const u=this.resolveDataElementOptions(s,a),p=this._sharedOptions,g=this.getSharedOptions(u),v=this.includeOptions(a,g)||g!==p;return this.updateSharedOptions(g,a,u),{sharedOptions:g,includeOptions:v}}updateElement(s,a,u,p){v_(p)?Object.assign(s,u):this._resolveAnimations(a,p).update(s,u)}updateSharedOptions(s,a,u){s&&!v_(a)&&this._resolveAnimations(void 0,a).update(s,u)}_setStyle(s,a,u,p){s.active=p;const g=this.getStyle(a,p);this._resolveAnimations(a,u,p).update(s,{options:!p&&this.getSharedOptions(g)||g})}removeHoverStyle(s,a,u){this._setStyle(s,u,"active",!1)}setHoverStyle(s,a,u){this._setStyle(s,u,"active",!0)}_removeDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!1)}_setDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!0)}_resyncElements(s){const a=this._data,u=this._cachedMeta.data;for(const[r,T,I]of this._syncList)this[r](T,I);this._syncList=[];const p=u.length,g=a.length,v=Math.min(g,p);v&&this.parse(0,v),g>p?this._insertElements(p,g-p,s):g<p&&this._removeElements(g,p-g)}_insertElements(s,a,u=!0){const p=this._cachedMeta,g=p.data,v=s+a;let r;const T=I=>{for(I.length+=a,r=I.length-1;r>=v;r--)I[r]=I[r-a]};for(T(g),r=s;r<v;++r)g[r]=new this.dataElementType;this._parsing&&T(p._parsed),this.parse(s,a),u&&this.updateElements(g,s,a,"reset")}updateElements(s,a,u,p){}_removeElements(s,a){const u=this._cachedMeta;if(this._parsing){const p=u._parsed.splice(s,a);u._stacked&&Oh(u,p)}u.data.splice(s,a)}_sync(s){if(this._parsing)this._syncList.push(s);else{const[a,u,p]=s;this[a](u,p)}this.chart._dataChanges.push([this.index,...s])}_onDataPush(){const s=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-s,s])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(s,a){a&&this._sync(["_removeElements",s,a]);const u=arguments.length-2;u&&this._sync(["_insertElements",s,u])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}ue(Ws,"defaults",{}),ue(Ws,"datasetElementType",null),ue(Ws,"dataElementType",null);function ZT(o,s){if(!o._cache.$bar){const a=o.getMatchingVisibleMetas(s);let u=[];for(let p=0,g=a.length;p<g;p++)u=u.concat(a[p].controller.getAllParsedValues(o));o._cache.$bar=Vx(u.sort((p,g)=>p-g))}return o._cache.$bar}function HT(o){const s=o.iScale,a=ZT(s,o.type);let u=s._length,p,g,v,r;const T=()=>{v===32767||v===-32768||(nu(r)&&(u=Math.min(u,Math.abs(v-r)||u)),r=v)};for(p=0,g=a.length;p<g;++p)v=s.getPixelForValue(a[p]),T();for(r=void 0,p=0,g=s.ticks.length;p<g;++p)v=s.getPixelForTick(p),T();return u}function XT(o,s,a,u){const p=a.barThickness;let g,v;return ti(p)?(g=s.min*a.categoryPercentage,v=a.barPercentage):(g=p*u,v=1),{chunk:g/u,ratio:v,start:s.pixels[o]-g/2}}function YT(o,s,a,u){const p=s.pixels,g=p[o];let v=o>0?p[o-1]:null,r=o<p.length-1?p[o+1]:null;const T=a.categoryPercentage;v===null&&(v=g-(r===null?s.end-s.start:r-g)),r===null&&(r=g+g-v);const I=g-(g-Math.min(v,r))/2*T;return{chunk:Math.abs(r-v)/2*T/u,ratio:a.barPercentage,start:I}}function KT(o,s,a,u){const p=a.parse(o[0],u),g=a.parse(o[1],u),v=Math.min(p,g),r=Math.max(p,g);let T=v,I=r;Math.abs(v)>Math.abs(r)&&(T=r,I=v),s[a.axis]=I,s._custom={barStart:T,barEnd:I,start:p,end:g,min:v,max:r}}function c1(o,s,a,u){return zi(o)?KT(o,s,a,u):s[a.axis]=a.parse(o,u),s}function Cy(o,s,a,u){const p=o.iScale,g=o.vScale,v=p.getLabels(),r=p===g,T=[];let I,R,F,U;for(I=a,R=a+u;I<R;++I)U=s[I],F={},F[p.axis]=r||p.parse(v[I],I),T.push(c1(U,F,g,I));return T}function b_(o){return o&&o.barStart!==void 0&&o.barEnd!==void 0}function JT(o,s,a){return o!==0?hr(o):(s.isHorizontal()?1:-1)*(s.min>=a?1:-1)}function QT(o){let s,a,u,p,g;return o.horizontal?(s=o.base>o.x,a="left",u="right"):(s=o.base<o.y,a="bottom",u="top"),s?(p="end",g="start"):(p="start",g="end"),{start:a,end:u,reverse:s,top:p,bottom:g}}function tE(o,s,a,u){let p=s.borderSkipped;const g={};if(!p){o.borderSkipped=g;return}if(p===!0){o.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:v,end:r,reverse:T,top:I,bottom:R}=QT(o);p==="middle"&&a&&(o.enableBorderRadius=!0,(a._top||0)===u?p=I:(a._bottom||0)===u?p=R:(g[Iy(R,v,r,T)]=!0,p=I)),g[Iy(p,v,r,T)]=!0,o.borderSkipped=g}function Iy(o,s,a,u){return u?(o=eE(o,s,a),o=Py(o,a,s)):o=Py(o,s,a),o}function eE(o,s,a){return o===s?a:o===a?s:o}function Py(o,s,a){return o==="start"?s:o==="end"?a:o}function iE(o,{inflateAmount:s},a){o.inflateAmount=s==="auto"?a===1?.33:0:s}class ip extends Ws{parsePrimitiveData(s,a,u,p){return Cy(s,a,u,p)}parseArrayData(s,a,u,p){return Cy(s,a,u,p)}parseObjectData(s,a,u,p){const{iScale:g,vScale:v}=s,{xAxisKey:r="x",yAxisKey:T="y"}=this._parsing,I=g.axis==="x"?r:T,R=v.axis==="x"?r:T,F=[];let U,Y,it,ct;for(U=u,Y=u+p;U<Y;++U)ct=a[U],it={},it[g.axis]=g.parse(ko(ct,I),U),F.push(c1(ko(ct,R),it,v,U));return F}updateRangeFromParsed(s,a,u,p){super.updateRangeFromParsed(s,a,u,p);const g=u._custom;g&&a===this._cachedMeta.vScale&&(s.min=Math.min(s.min,g.min),s.max=Math.max(s.max,g.max))}getMaxOverflow(){return 0}getLabelAndValue(s){const a=this._cachedMeta,{iScale:u,vScale:p}=a,g=this.getParsed(s),v=g._custom,r=b_(v)?"["+v.start+", "+v.end+"]":""+p.getLabelForValue(g[p.axis]);return{label:""+u.getLabelForValue(g[u.axis]),value:r}}initialize(){this.enableOptionSharing=!0,super.initialize();const s=this._cachedMeta;s.stack=this.getDataset().stack}update(s){const a=this._cachedMeta;this.updateElements(a.data,0,a.data.length,s)}updateElements(s,a,u,p){const g=p==="reset",{index:v,_cachedMeta:{vScale:r}}=this,T=r.getBasePixel(),I=r.isHorizontal(),R=this._getRuler(),{sharedOptions:F,includeOptions:U}=this._getSharedOptions(a,p);for(let Y=a;Y<a+u;Y++){const it=this.getParsed(Y),ct=g||ti(it[r.axis])?{base:T,head:T}:this._calculateBarValuePixels(Y),ht=this._calculateBarIndexPixels(Y,R),bt=(it._stacks||{})[r.axis],Dt={horizontal:I,base:ct.base,enableBorderRadius:!bt||b_(it._custom)||v===bt._top||v===bt._bottom,x:I?ct.head:ht.center,y:I?ht.center:ct.head,height:I?ht.size:Math.abs(ct.size),width:I?Math.abs(ct.size):ht.size};U&&(Dt.options=F||this.resolveDataElementOptions(Y,s[Y].active?"active":p));const Ft=Dt.options||s[Y].options;tE(Dt,Ft,bt,v),iE(Dt,Ft,R.ratio),this.updateElement(s[Y],Y,Dt,p)}}_getStacks(s,a){const{iScale:u}=this._cachedMeta,p=u.getMatchingVisibleMetas(this._type).filter(T=>T.controller.options.grouped),g=u.options.stacked,v=[],r=T=>{const I=T.controller.getParsed(a),R=I&&I[T.vScale.axis];if(ti(R)||isNaN(R))return!0};for(const T of p)if(!(a!==void 0&&r(T))&&((g===!1||v.indexOf(T.stack)===-1||g===void 0&&T.stack===void 0)&&v.push(T.stack),T.index===s))break;return v.length||v.push(void 0),v}_getStackCount(s){return this._getStacks(void 0,s).length}_getStackIndex(s,a,u){const p=this._getStacks(s,u),g=a!==void 0?p.indexOf(a):-1;return g===-1?p.length-1:g}_getRuler(){const s=this.options,a=this._cachedMeta,u=a.iScale,p=[];let g,v;for(g=0,v=a.data.length;g<v;++g)p.push(u.getPixelForValue(this.getParsed(g)[u.axis],g));const r=s.barThickness;return{min:r||HT(a),pixels:p,start:u._startPixel,end:u._endPixel,stackCount:this._getStackCount(),scale:u,grouped:s.grouped,ratio:r?1:s.categoryPercentage*s.barPercentage}}_calculateBarValuePixels(s){const{_cachedMeta:{vScale:a,_stacked:u,index:p},options:{base:g,minBarLength:v}}=this,r=g||0,T=this.getParsed(s),I=T._custom,R=b_(I);let F=T[a.axis],U=0,Y=u?this.applyStack(a,T,u):F,it,ct;Y!==F&&(U=Y-F,Y=F),R&&(F=I.barStart,Y=I.barEnd-I.barStart,F!==0&&hr(F)!==hr(I.barEnd)&&(U=0),U+=F);const ht=!ti(g)&&!R?g:U;let bt=a.getPixelForValue(ht);if(this.chart.getDataVisibility(s)?it=a.getPixelForValue(U+Y):it=bt,ct=it-bt,Math.abs(ct)<v){ct=JT(ct,a,r)*v,F===r&&(bt-=ct/2);const Dt=a.getPixelForDecimal(0),Ft=a.getPixelForDecimal(1),Wt=Math.min(Dt,Ft),Rt=Math.max(Dt,Ft);bt=Math.max(Math.min(bt,Rt),Wt),it=bt+ct,u&&!R&&(T._stacks[a.axis]._visualValues[p]=a.getValueForPixel(it)-a.getValueForPixel(bt))}if(bt===a.getPixelForValue(r)){const Dt=hr(ct)*a.getLineWidthForValue(r)/2;bt+=Dt,ct-=Dt}return{size:ct,base:bt,head:it,center:it+ct/2}}_calculateBarIndexPixels(s,a){const u=a.scale,p=this.options,g=p.skipNull,v=Ve(p.maxBarThickness,1/0);let r,T;if(a.grouped){const I=g?this._getStackCount(s):a.stackCount,R=p.barThickness==="flex"?YT(s,a,p,I):XT(s,a,p,I),F=this._getStackIndex(this.index,this._cachedMeta.stack,g?s:void 0);r=R.start+R.chunk*F+R.chunk/2,T=Math.min(v,R.chunk*R.ratio)}else r=u.getPixelForValue(this.getParsed(s)[u.axis],s),T=Math.min(v,a.min*a.ratio);return{base:r-T/2,head:r+T/2,center:r,size:T}}draw(){const s=this._cachedMeta,a=s.vScale,u=s.data,p=u.length;let g=0;for(;g<p;++g)this.getParsed(g)[a.axis]!==null&&u[g].draw(this._ctx)}}ue(ip,"id","bar"),ue(ip,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),ue(ip,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class np extends Ws{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(s,a,u,p){const g=super.parsePrimitiveData(s,a,u,p);for(let v=0;v<g.length;v++)g[v]._custom=this.resolveDataElementOptions(v+u).radius;return g}parseArrayData(s,a,u,p){const g=super.parseArrayData(s,a,u,p);for(let v=0;v<g.length;v++){const r=a[u+v];g[v]._custom=Ve(r[2],this.resolveDataElementOptions(v+u).radius)}return g}parseObjectData(s,a,u,p){const g=super.parseObjectData(s,a,u,p);for(let v=0;v<g.length;v++){const r=a[u+v];g[v]._custom=Ve(r&&r.r&&+r.r,this.resolveDataElementOptions(v+u).radius)}return g}getMaxOverflow(){const s=this._cachedMeta.data;let a=0;for(let u=s.length-1;u>=0;--u)a=Math.max(a,s[u].size(this.resolveDataElementOptions(u))/2);return a>0&&a}getLabelAndValue(s){const a=this._cachedMeta,u=this.chart.data.labels||[],{xScale:p,yScale:g}=a,v=this.getParsed(s),r=p.getLabelForValue(v.x),T=g.getLabelForValue(v.y),I=v._custom;return{label:u[s]||"",value:"("+r+", "+T+(I?", "+I:"")+")"}}update(s){const a=this._cachedMeta.data;this.updateElements(a,0,a.length,s)}updateElements(s,a,u,p){const g=p==="reset",{iScale:v,vScale:r}=this._cachedMeta,{sharedOptions:T,includeOptions:I}=this._getSharedOptions(a,p),R=v.axis,F=r.axis;for(let U=a;U<a+u;U++){const Y=s[U],it=!g&&this.getParsed(U),ct={},ht=ct[R]=g?v.getPixelForDecimal(.5):v.getPixelForValue(it[R]),bt=ct[F]=g?r.getBasePixel():r.getPixelForValue(it[F]);ct.skip=isNaN(ht)||isNaN(bt),I&&(ct.options=T||this.resolveDataElementOptions(U,Y.active?"active":p),g&&(ct.options.radius=0)),this.updateElement(Y,U,ct,p)}}resolveDataElementOptions(s,a){const u=this.getParsed(s);let p=super.resolveDataElementOptions(s,a);p.$shared&&(p=Object.assign({},p,{$shared:!1}));const g=p.radius;return a!=="active"&&(p.radius=0),p.radius+=Ve(u&&u._custom,g),p}}ue(np,"id","bubble"),ue(np,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),ue(np,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function nE(o,s,a){let u=1,p=1,g=0,v=0;if(s<Ri){const r=o,T=r+s,I=Math.cos(r),R=Math.sin(r),F=Math.cos(T),U=Math.sin(T),Y=(Ft,Wt,Rt)=>su(Ft,r,T,!0)?1:Math.max(Wt,Wt*a,Rt,Rt*a),it=(Ft,Wt,Rt)=>su(Ft,r,T,!0)?-1:Math.min(Wt,Wt*a,Rt,Rt*a),ct=Y(0,I,F),ht=Y(Ji,R,U),bt=it(Oi,I,F),Dt=it(Oi+Ji,R,U);u=(ct-bt)/2,p=(ht-Dt)/2,g=-(ct+bt)/2,v=-(ht+Dt)/2}return{ratioX:u,ratioY:p,offsetX:g,offsetY:v}}class Ba extends Ws{constructor(s,a){super(s,a),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(s,a){const u=this.getDataset().data,p=this._cachedMeta;if(this._parsing===!1)p._parsed=u;else{let g=T=>+u[T];if(Ye(u[s])){const{key:T="value"}=this._parsing;g=I=>+ko(u[I],T)}let v,r;for(v=s,r=s+a;v<r;++v)p._parsed[v]=g(v)}}_getRotation(){return qs(this.options.rotation-90)}_getCircumference(){return qs(this.options.circumference)}_getRotationExtents(){let s=Ri,a=-Ri;for(let u=0;u<this.chart.data.datasets.length;++u)if(this.chart.isDatasetVisible(u)&&this.chart.getDatasetMeta(u).type===this._type){const p=this.chart.getDatasetMeta(u).controller,g=p._getRotation(),v=p._getCircumference();s=Math.min(s,g),a=Math.max(a,g+v)}return{rotation:s,circumference:a-s}}update(s){const a=this.chart,{chartArea:u}=a,p=this._cachedMeta,g=p.data,v=this.getMaxBorderWidth()+this.getMaxOffset(g)+this.options.spacing,r=Math.max((Math.min(u.width,u.height)-v)/2,0),T=Math.min(g2(this.options.cutout,r),1),I=this._getRingWeight(this.index),{circumference:R,rotation:F}=this._getRotationExtents(),{ratioX:U,ratioY:Y,offsetX:it,offsetY:ct}=nE(F,R,T),ht=(u.width-v)/U,bt=(u.height-v)/Y,Dt=Math.max(Math.min(ht,bt)/2,0),Ft=Ox(this.options.radius,Dt),Wt=Math.max(Ft*T,0),Rt=(Ft-Wt)/this._getVisibleDatasetWeightTotal();this.offsetX=it*Ft,this.offsetY=ct*Ft,p.total=this.calculateTotal(),this.outerRadius=Ft-Rt*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-Rt*I,0),this.updateElements(g,0,g.length,s)}_circumference(s,a){const u=this.options,p=this._cachedMeta,g=this._getCircumference();return a&&u.animation.animateRotate||!this.chart.getDataVisibility(s)||p._parsed[s]===null||p.data[s].hidden?0:this.calculateCircumference(p._parsed[s]*g/Ri)}updateElements(s,a,u,p){const g=p==="reset",v=this.chart,r=v.chartArea,I=v.options.animation,R=(r.left+r.right)/2,F=(r.top+r.bottom)/2,U=g&&I.animateScale,Y=U?0:this.innerRadius,it=U?0:this.outerRadius,{sharedOptions:ct,includeOptions:ht}=this._getSharedOptions(a,p);let bt=this._getRotation(),Dt;for(Dt=0;Dt<a;++Dt)bt+=this._circumference(Dt,g);for(Dt=a;Dt<a+u;++Dt){const Ft=this._circumference(Dt,g),Wt=s[Dt],Rt={x:R+this.offsetX,y:F+this.offsetY,startAngle:bt,endAngle:bt+Ft,circumference:Ft,outerRadius:it,innerRadius:Y};ht&&(Rt.options=ct||this.resolveDataElementOptions(Dt,Wt.active?"active":p)),bt+=Ft,this.updateElement(Wt,Dt,Rt,p)}}calculateTotal(){const s=this._cachedMeta,a=s.data;let u=0,p;for(p=0;p<a.length;p++){const g=s._parsed[p];g!==null&&!isNaN(g)&&this.chart.getDataVisibility(p)&&!a[p].hidden&&(u+=Math.abs(g))}return u}calculateCircumference(s){const a=this._cachedMeta.total;return a>0&&!isNaN(s)?Ri*(Math.abs(s)/a):0}getLabelAndValue(s){const a=this._cachedMeta,u=this.chart,p=u.data.labels||[],g=du(a._parsed[s],u.options.locale);return{label:p[s]||"",value:g}}getMaxBorderWidth(s){let a=0;const u=this.chart;let p,g,v,r,T;if(!s){for(p=0,g=u.data.datasets.length;p<g;++p)if(u.isDatasetVisible(p)){v=u.getDatasetMeta(p),s=v.data,r=v.controller;break}}if(!s)return 0;for(p=0,g=s.length;p<g;++p)T=r.resolveDataElementOptions(p),T.borderAlign!=="inner"&&(a=Math.max(a,T.borderWidth||0,T.hoverBorderWidth||0));return a}getMaxOffset(s){let a=0;for(let u=0,p=s.length;u<p;++u){const g=this.resolveDataElementOptions(u);a=Math.max(a,g.offset||0,g.hoverOffset||0)}return a}_getRingWeightOffset(s){let a=0;for(let u=0;u<s;++u)this.chart.isDatasetVisible(u)&&(a+=this._getRingWeight(u));return a}_getRingWeight(s){return Math.max(Ve(this.chart.data.datasets[s].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}ue(Ba,"id","doughnut"),ue(Ba,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),ue(Ba,"descriptors",{_scriptable:s=>s!=="spacing",_indexable:s=>s!=="spacing"&&!s.startsWith("borderDash")&&!s.startsWith("hoverBorderDash")}),ue(Ba,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(s){const a=s.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:u,color:p}}=s.legend.options;return a.labels.map((g,v)=>{const T=s.getDatasetMeta(0).controller.getStyle(v);return{text:g,fillStyle:T.backgroundColor,strokeStyle:T.borderColor,fontColor:p,lineWidth:T.borderWidth,pointStyle:u,hidden:!s.getDataVisibility(v),index:v}})}return[]}},onClick(s,a,u){u.chart.toggleDataVisibility(a.index),u.chart.update()}}}});class sp extends Ws{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(s){const a=this._cachedMeta,{dataset:u,data:p=[],_dataset:g}=a,v=this.chart._animationsDisabled;let{start:r,count:T}=qx(a,p,v);this._drawStart=r,this._drawCount=T,$x(a)&&(r=0,T=p.length),u._chart=this.chart,u._datasetIndex=this.index,u._decimated=!!g._decimated,u.points=p;const I=this.resolveDatasetElementOptions(s);this.options.showLine||(I.borderWidth=0),I.segment=this.options.segment,this.updateElement(u,void 0,{animated:!v,options:I},s),this.updateElements(p,r,T,s)}updateElements(s,a,u,p){const g=p==="reset",{iScale:v,vScale:r,_stacked:T,_dataset:I}=this._cachedMeta,{sharedOptions:R,includeOptions:F}=this._getSharedOptions(a,p),U=v.axis,Y=r.axis,{spanGaps:it,segment:ct}=this.options,ht=Jl(it)?it:Number.POSITIVE_INFINITY,bt=this.chart._animationsDisabled||g||p==="none",Dt=a+u,Ft=s.length;let Wt=a>0&&this.getParsed(a-1);for(let Rt=0;Rt<Ft;++Rt){const Jt=s[Rt],ne=bt?Jt:{};if(Rt<a||Rt>=Dt){ne.skip=!0;continue}const se=this.getParsed(Rt),Lt=ti(se[Y]),Le=ne[U]=v.getPixelForValue(se[U],Rt),ze=ne[Y]=g||Lt?r.getBasePixel():r.getPixelForValue(T?this.applyStack(r,se,T):se[Y],Rt);ne.skip=isNaN(Le)||isNaN(ze)||Lt,ne.stop=Rt>0&&Math.abs(se[U]-Wt[U])>ht,ct&&(ne.parsed=se,ne.raw=I.data[Rt]),F&&(ne.options=R||this.resolveDataElementOptions(Rt,Jt.active?"active":p)),bt||this.updateElement(Jt,Rt,ne,p),Wt=se}}getMaxOverflow(){const s=this._cachedMeta,a=s.dataset,u=a.options&&a.options.borderWidth||0,p=s.data||[];if(!p.length)return u;const g=p[0].size(this.resolveDataElementOptions(0)),v=p[p.length-1].size(this.resolveDataElementOptions(p.length-1));return Math.max(u,g,v)/2}draw(){const s=this._cachedMeta;s.dataset.updateControlPoints(this.chart.chartArea,s.iScale.axis),super.draw()}}ue(sp,"id","line"),ue(sp,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),ue(sp,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class tu extends Ws{constructor(s,a){super(s,a),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(s){const a=this._cachedMeta,u=this.chart,p=u.data.labels||[],g=du(a._parsed[s].r,u.options.locale);return{label:p[s]||"",value:g}}parseObjectData(s,a,u,p){return Qx.bind(this)(s,a,u,p)}update(s){const a=this._cachedMeta.data;this._updateRadius(),this.updateElements(a,0,a.length,s)}getMinMax(){const s=this._cachedMeta,a={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return s.data.forEach((u,p)=>{const g=this.getParsed(p).r;!isNaN(g)&&this.chart.getDataVisibility(p)&&(g<a.min&&(a.min=g),g>a.max&&(a.max=g))}),a}_updateRadius(){const s=this.chart,a=s.chartArea,u=s.options,p=Math.min(a.right-a.left,a.bottom-a.top),g=Math.max(p/2,0),v=Math.max(u.cutoutPercentage?g/100*u.cutoutPercentage:1,0),r=(g-v)/s.getVisibleDatasetCount();this.outerRadius=g-r*this.index,this.innerRadius=this.outerRadius-r}updateElements(s,a,u,p){const g=p==="reset",v=this.chart,T=v.options.animation,I=this._cachedMeta.rScale,R=I.xCenter,F=I.yCenter,U=I.getIndexAngle(0)-.5*Oi;let Y=U,it;const ct=360/this.countVisibleElements();for(it=0;it<a;++it)Y+=this._computeAngle(it,p,ct);for(it=a;it<a+u;it++){const ht=s[it];let bt=Y,Dt=Y+this._computeAngle(it,p,ct),Ft=v.getDataVisibility(it)?I.getDistanceFromCenterForValue(this.getParsed(it).r):0;Y=Dt,g&&(T.animateScale&&(Ft=0),T.animateRotate&&(bt=Dt=U));const Wt={x:R,y:F,innerRadius:0,outerRadius:Ft,startAngle:bt,endAngle:Dt,options:this.resolveDataElementOptions(it,ht.active?"active":p)};this.updateElement(ht,it,Wt,p)}}countVisibleElements(){const s=this._cachedMeta;let a=0;return s.data.forEach((u,p)=>{!isNaN(this.getParsed(p).r)&&this.chart.getDataVisibility(p)&&a++}),a}_computeAngle(s,a,u){return this.chart.getDataVisibility(s)?qs(this.resolveDataElementOptions(s,a).angle||u):0}}ue(tu,"id","polarArea"),ue(tu,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),ue(tu,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(s){const a=s.data;if(a.labels.length&&a.datasets.length){const{labels:{pointStyle:u,color:p}}=s.legend.options;return a.labels.map((g,v)=>{const T=s.getDatasetMeta(0).controller.getStyle(v);return{text:g,fillStyle:T.backgroundColor,strokeStyle:T.borderColor,fontColor:p,lineWidth:T.borderWidth,pointStyle:u,hidden:!s.getDataVisibility(v),index:v}})}return[]}},onClick(s,a,u){u.chart.toggleDataVisibility(a.index),u.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class V_ extends Ba{}ue(V_,"id","pie"),ue(V_,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class rp extends Ws{getLabelAndValue(s){const a=this._cachedMeta.vScale,u=this.getParsed(s);return{label:a.getLabels()[s],value:""+a.getLabelForValue(u[a.axis])}}parseObjectData(s,a,u,p){return Qx.bind(this)(s,a,u,p)}update(s){const a=this._cachedMeta,u=a.dataset,p=a.data||[],g=a.iScale.getLabels();if(u.points=p,s!=="resize"){const v=this.resolveDatasetElementOptions(s);this.options.showLine||(v.borderWidth=0);const r={_loop:!0,_fullLoop:g.length===p.length,options:v};this.updateElement(u,void 0,r,s)}this.updateElements(p,0,p.length,s)}updateElements(s,a,u,p){const g=this._cachedMeta.rScale,v=p==="reset";for(let r=a;r<a+u;r++){const T=s[r],I=this.resolveDataElementOptions(r,T.active?"active":p),R=g.getPointPositionForValue(r,this.getParsed(r).r),F=v?g.xCenter:R.x,U=v?g.yCenter:R.y,Y={x:F,y:U,angle:R.angle,skip:isNaN(F)||isNaN(U),options:I};this.updateElement(T,r,Y,p)}}}ue(rp,"id","radar"),ue(rp,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),ue(rp,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class op extends Ws{getLabelAndValue(s){const a=this._cachedMeta,u=this.chart.data.labels||[],{xScale:p,yScale:g}=a,v=this.getParsed(s),r=p.getLabelForValue(v.x),T=g.getLabelForValue(v.y);return{label:u[s]||"",value:"("+r+", "+T+")"}}update(s){const a=this._cachedMeta,{data:u=[]}=a,p=this.chart._animationsDisabled;let{start:g,count:v}=qx(a,u,p);if(this._drawStart=g,this._drawCount=v,$x(a)&&(g=0,v=u.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:r,_dataset:T}=a;r._chart=this.chart,r._datasetIndex=this.index,r._decimated=!!T._decimated,r.points=u;const I=this.resolveDatasetElementOptions(s);I.segment=this.options.segment,this.updateElement(r,void 0,{animated:!p,options:I},s)}else this.datasetElementType&&(delete a.dataset,this.datasetElementType=!1);this.updateElements(u,g,v,s)}addElements(){const{showLine:s}=this.options;!this.datasetElementType&&s&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(s,a,u,p){const g=p==="reset",{iScale:v,vScale:r,_stacked:T,_dataset:I}=this._cachedMeta,R=this.resolveDataElementOptions(a,p),F=this.getSharedOptions(R),U=this.includeOptions(p,F),Y=v.axis,it=r.axis,{spanGaps:ct,segment:ht}=this.options,bt=Jl(ct)?ct:Number.POSITIVE_INFINITY,Dt=this.chart._animationsDisabled||g||p==="none";let Ft=a>0&&this.getParsed(a-1);for(let Wt=a;Wt<a+u;++Wt){const Rt=s[Wt],Jt=this.getParsed(Wt),ne=Dt?Rt:{},se=ti(Jt[it]),Lt=ne[Y]=v.getPixelForValue(Jt[Y],Wt),Le=ne[it]=g||se?r.getBasePixel():r.getPixelForValue(T?this.applyStack(r,Jt,T):Jt[it],Wt);ne.skip=isNaN(Lt)||isNaN(Le)||se,ne.stop=Wt>0&&Math.abs(Jt[Y]-Ft[Y])>bt,ht&&(ne.parsed=Jt,ne.raw=I.data[Wt]),U&&(ne.options=F||this.resolveDataElementOptions(Wt,Rt.active?"active":p)),Dt||this.updateElement(Rt,Wt,ne,p),Ft=Jt}this.updateSharedOptions(F,p,R)}getMaxOverflow(){const s=this._cachedMeta,a=s.data||[];if(!this.options.showLine){let r=0;for(let T=a.length-1;T>=0;--T)r=Math.max(r,a[T].size(this.resolveDataElementOptions(T))/2);return r>0&&r}const u=s.dataset,p=u.options&&u.options.borderWidth||0;if(!a.length)return p;const g=a[0].size(this.resolveDataElementOptions(0)),v=a[a.length-1].size(this.resolveDataElementOptions(a.length-1));return Math.max(p,g,v)/2}}ue(op,"id","scatter"),ue(op,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),ue(op,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var sE=Object.freeze({__proto__:null,BarController:ip,BubbleController:np,DoughnutController:Ba,LineController:sp,PieController:V_,PolarAreaController:tu,RadarController:rp,ScatterController:op});function Pa(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class fm{constructor(s){ue(this,"options");this.options=s||{}}static override(s){Object.assign(fm.prototype,s)}init(){}formats(){return Pa()}parse(){return Pa()}format(){return Pa()}add(){return Pa()}diff(){return Pa()}startOf(){return Pa()}endOf(){return Pa()}}var rE={_date:fm};function oE(o,s,a,u){const{controller:p,data:g,_sorted:v}=o,r=p._cachedMeta.iScale;if(r&&s===r.axis&&s!=="r"&&v&&g.length){const T=r._reversePixels?I2:Nr;if(u){if(p._sharedOptions){const I=g[0],R=typeof I.getRange=="function"&&I.getRange(s);if(R){const F=T(g,s,a-R),U=T(g,s,a+R);return{lo:F.lo,hi:U.hi}}}}else return T(g,s,a)}return{lo:0,hi:g.length-1}}function pu(o,s,a,u,p){const g=o.getSortedVisibleDatasetMetas(),v=a[s];for(let r=0,T=g.length;r<T;++r){const{index:I,data:R}=g[r],{lo:F,hi:U}=oE(g[r],s,v,p);for(let Y=F;Y<=U;++Y){const it=R[Y];it.skip||u(it,I,Y)}}}function aE(o){const s=o.indexOf("x")!==-1,a=o.indexOf("y")!==-1;return function(u,p){const g=s?Math.abs(u.x-p.x):0,v=a?Math.abs(u.y-p.y):0;return Math.sqrt(Math.pow(g,2)+Math.pow(v,2))}}function w_(o,s,a,u,p){const g=[];return!p&&!o.isPointInArea(s)||pu(o,a,s,function(r,T,I){!p&&!jr(r,o.chartArea,0)||r.inRange(s.x,s.y,u)&&g.push({element:r,datasetIndex:T,index:I})},!0),g}function lE(o,s,a,u){let p=[];function g(v,r,T){const{startAngle:I,endAngle:R}=v.getProps(["startAngle","endAngle"],u),{angle:F}=Nx(v,{x:s.x,y:s.y});su(F,I,R)&&p.push({element:v,datasetIndex:r,index:T})}return pu(o,a,s,g),p}function cE(o,s,a,u,p,g){let v=[];const r=aE(a);let T=Number.POSITIVE_INFINITY;function I(R,F,U){const Y=R.inRange(s.x,s.y,p);if(u&&!Y)return;const it=R.getCenterPoint(p);if(!(!!g||o.isPointInArea(it))&&!Y)return;const ht=r(s,it);ht<T?(v=[{element:R,datasetIndex:F,index:U}],T=ht):ht===T&&v.push({element:R,datasetIndex:F,index:U})}return pu(o,a,s,I),v}function T_(o,s,a,u,p,g){return!g&&!o.isPointInArea(s)?[]:a==="r"&&!u?lE(o,s,a,p):cE(o,s,a,u,p,g)}function ky(o,s,a,u,p){const g=[],v=a==="x"?"inXRange":"inYRange";let r=!1;return pu(o,a,s,(T,I,R)=>{T[v](s[a],p)&&(g.push({element:T,datasetIndex:I,index:R}),r=r||T.inRange(s.x,s.y,p))}),u&&!r?[]:g}var hE={evaluateInteractionItems:pu,modes:{index(o,s,a,u){const p=za(s,o),g=a.axis||"x",v=a.includeInvisible||!1,r=a.intersect?w_(o,p,g,u,v):T_(o,p,g,!1,u,v),T=[];return r.length?(o.getSortedVisibleDatasetMetas().forEach(I=>{const R=r[0].index,F=I.data[R];F&&!F.skip&&T.push({element:F,datasetIndex:I.index,index:R})}),T):[]},dataset(o,s,a,u){const p=za(s,o),g=a.axis||"xy",v=a.includeInvisible||!1;let r=a.intersect?w_(o,p,g,u,v):T_(o,p,g,!1,u,v);if(r.length>0){const T=r[0].datasetIndex,I=o.getDatasetMeta(T).data;r=[];for(let R=0;R<I.length;++R)r.push({element:I[R],datasetIndex:T,index:R})}return r},point(o,s,a,u){const p=za(s,o),g=a.axis||"xy",v=a.includeInvisible||!1;return w_(o,p,g,u,v)},nearest(o,s,a,u){const p=za(s,o),g=a.axis||"xy",v=a.includeInvisible||!1;return T_(o,p,g,a.intersect,u,v)},x(o,s,a,u){const p=za(s,o);return ky(o,p,"x",a.intersect,u)},y(o,s,a,u){const p=za(s,o);return ky(o,p,"y",a.intersect,u)}}};const h1=["left","top","right","bottom"];function Bh(o,s){return o.filter(a=>a.pos===s)}function Dy(o,s){return o.filter(a=>h1.indexOf(a.pos)===-1&&a.box.axis===s)}function Fh(o,s){return o.sort((a,u)=>{const p=s?u:a,g=s?a:u;return p.weight===g.weight?p.index-g.index:p.weight-g.weight})}function uE(o){const s=[];let a,u,p,g,v,r;for(a=0,u=(o||[]).length;a<u;++a)p=o[a],{position:g,options:{stack:v,stackWeight:r=1}}=p,s.push({index:a,box:p,pos:g,horizontal:p.isHorizontal(),weight:p.weight,stack:v&&g+v,stackWeight:r});return s}function dE(o){const s={};for(const a of o){const{stack:u,pos:p,stackWeight:g}=a;if(!u||!h1.includes(p))continue;const v=s[u]||(s[u]={count:0,placed:0,weight:0,size:0});v.count++,v.weight+=g}return s}function pE(o,s){const a=dE(o),{vBoxMaxWidth:u,hBoxMaxHeight:p}=s;let g,v,r;for(g=0,v=o.length;g<v;++g){r=o[g];const{fullSize:T}=r.box,I=a[r.stack],R=I&&r.stackWeight/I.weight;r.horizontal?(r.width=R?R*u:T&&s.availableWidth,r.height=p):(r.width=u,r.height=R?R*p:T&&s.availableHeight)}return a}function fE(o){const s=uE(o),a=Fh(s.filter(I=>I.box.fullSize),!0),u=Fh(Bh(s,"left"),!0),p=Fh(Bh(s,"right")),g=Fh(Bh(s,"top"),!0),v=Fh(Bh(s,"bottom")),r=Dy(s,"x"),T=Dy(s,"y");return{fullSize:a,leftAndTop:u.concat(g),rightAndBottom:p.concat(T).concat(v).concat(r),chartArea:Bh(s,"chartArea"),vertical:u.concat(p).concat(T),horizontal:g.concat(v).concat(r)}}function Ly(o,s,a,u){return Math.max(o[a],s[a])+Math.max(o[u],s[u])}function u1(o,s){o.top=Math.max(o.top,s.top),o.left=Math.max(o.left,s.left),o.bottom=Math.max(o.bottom,s.bottom),o.right=Math.max(o.right,s.right)}function _E(o,s,a,u){const{pos:p,box:g}=a,v=o.maxPadding;if(!Ye(p)){a.size&&(o[p]-=a.size);const F=u[a.stack]||{size:0,count:1};F.size=Math.max(F.size,a.horizontal?g.height:g.width),a.size=F.size/F.count,o[p]+=a.size}g.getPadding&&u1(v,g.getPadding());const r=Math.max(0,s.outerWidth-Ly(v,o,"left","right")),T=Math.max(0,s.outerHeight-Ly(v,o,"top","bottom")),I=r!==o.w,R=T!==o.h;return o.w=r,o.h=T,a.horizontal?{same:I,other:R}:{same:R,other:I}}function mE(o){const s=o.maxPadding;function a(u){const p=Math.max(s[u]-o[u],0);return o[u]+=p,p}o.y+=a("top"),o.x+=a("left"),a("right"),a("bottom")}function gE(o,s){const a=s.maxPadding;function u(p){const g={left:0,top:0,right:0,bottom:0};return p.forEach(v=>{g[v]=Math.max(s[v],a[v])}),g}return u(o?["left","right"]:["top","bottom"])}function qh(o,s,a,u){const p=[];let g,v,r,T,I,R;for(g=0,v=o.length,I=0;g<v;++g){r=o[g],T=r.box,T.update(r.width||s.w,r.height||s.h,gE(r.horizontal,s));const{same:F,other:U}=_E(s,a,r,u);I|=F&&p.length,R=R||U,T.fullSize||p.push(r)}return I&&qh(p,s,a,u)||R}function $d(o,s,a,u,p){o.top=a,o.left=s,o.right=s+u,o.bottom=a+p,o.width=u,o.height=p}function zy(o,s,a,u){const p=a.padding;let{x:g,y:v}=s;for(const r of o){const T=r.box,I=u[r.stack]||{count:1,placed:0,weight:1},R=r.stackWeight/I.weight||1;if(r.horizontal){const F=s.w*R,U=I.size||T.height;nu(I.start)&&(v=I.start),T.fullSize?$d(T,p.left,v,a.outerWidth-p.right-p.left,U):$d(T,s.left+I.placed,v,F,U),I.start=v,I.placed+=F,v=T.bottom}else{const F=s.h*R,U=I.size||T.width;nu(I.start)&&(g=I.start),T.fullSize?$d(T,g,p.top,U,a.outerHeight-p.bottom-p.top):$d(T,g,s.top+I.placed,U,F),I.start=g,I.placed+=F,g=T.right}}s.x=g,s.y=v}var kn={addBox(o,s){o.boxes||(o.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(a){s.draw(a)}}]},o.boxes.push(s)},removeBox(o,s){const a=o.boxes?o.boxes.indexOf(s):-1;a!==-1&&o.boxes.splice(a,1)},configure(o,s,a){s.fullSize=a.fullSize,s.position=a.position,s.weight=a.weight},update(o,s,a,u){if(!o)return;const p=Dn(o.options.layout.padding),g=Math.max(s-p.width,0),v=Math.max(a-p.height,0),r=fE(o.boxes),T=r.vertical,I=r.horizontal;yi(o.boxes,ct=>{typeof ct.beforeLayout=="function"&&ct.beforeLayout()});const R=T.reduce((ct,ht)=>ht.box.options&&ht.box.options.display===!1?ct:ct+1,0)||1,F=Object.freeze({outerWidth:s,outerHeight:a,padding:p,availableWidth:g,availableHeight:v,vBoxMaxWidth:g/2/R,hBoxMaxHeight:v/2}),U=Object.assign({},p);u1(U,Dn(u));const Y=Object.assign({maxPadding:U,w:g,h:v,x:p.left,y:p.top},p),it=pE(T.concat(I),F);qh(r.fullSize,Y,F,it),qh(T,Y,F,it),qh(I,Y,F,it)&&qh(T,Y,F,it),mE(Y),zy(r.leftAndTop,Y,F,it),Y.x+=Y.w,Y.y+=Y.h,zy(r.rightAndBottom,Y,F,it),o.chartArea={left:Y.left,top:Y.top,right:Y.left+Y.w,bottom:Y.top+Y.h,height:Y.h,width:Y.w},yi(r.chartArea,ct=>{const ht=ct.box;Object.assign(ht,o.chartArea),ht.update(Y.w,Y.h,{left:0,top:0,right:0,bottom:0})})}};class d1{acquireContext(s,a){}releaseContext(s){return!1}addEventListener(s,a,u){}removeEventListener(s,a,u){}getDevicePixelRatio(){return 1}getMaximumSize(s,a,u,p){return a=Math.max(0,a||s.width),u=u||s.height,{width:a,height:Math.max(0,p?Math.floor(a/p):u)}}isAttached(s){return!0}updateConfig(s){}}class yE extends d1{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}}const ap="$chartjs",xE={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Ry=o=>o===null||o==="";function vE(o,s){const a=o.style,u=o.getAttribute("height"),p=o.getAttribute("width");if(o[ap]={initial:{height:u,width:p,style:{display:a.display,height:a.height,width:a.width}}},a.display=a.display||"block",a.boxSizing=a.boxSizing||"border-box",Ry(p)){const g=gy(o,"width");g!==void 0&&(o.width=g)}if(Ry(u))if(o.style.height==="")o.height=o.width/(s||2);else{const g=gy(o,"height");g!==void 0&&(o.height=g)}return o}const p1=wT?{passive:!0}:!1;function bE(o,s,a){o.addEventListener(s,a,p1)}function wE(o,s,a){o.canvas.removeEventListener(s,a,p1)}function TE(o,s){const a=xE[o.type]||o.type,{x:u,y:p}=za(o,s);return{type:a,chart:s,native:o,x:u!==void 0?u:null,y:p!==void 0?p:null}}function wp(o,s){for(const a of o)if(a===s||a.contains(s))return!0}function EE(o,s,a){const u=o.canvas,p=new MutationObserver(g=>{let v=!1;for(const r of g)v=v||wp(r.addedNodes,u),v=v&&!wp(r.removedNodes,u);v&&a()});return p.observe(document,{childList:!0,subtree:!0}),p}function SE(o,s,a){const u=o.canvas,p=new MutationObserver(g=>{let v=!1;for(const r of g)v=v||wp(r.removedNodes,u),v=v&&!wp(r.addedNodes,u);v&&a()});return p.observe(document,{childList:!0,subtree:!0}),p}const ou=new Map;let Oy=0;function f1(){const o=window.devicePixelRatio;o!==Oy&&(Oy=o,ou.forEach((s,a)=>{a.currentDevicePixelRatio!==o&&s()}))}function ME(o,s){ou.size||window.addEventListener("resize",f1),ou.set(o,s)}function AE(o){ou.delete(o),ou.size||window.removeEventListener("resize",f1)}function CE(o,s,a){const u=o.canvas,p=u&&pm(u);if(!p)return;const g=Gx((r,T)=>{const I=p.clientWidth;a(r,T),I<p.clientWidth&&a()},window),v=new ResizeObserver(r=>{const T=r[0],I=T.contentRect.width,R=T.contentRect.height;I===0&&R===0||g(I,R)});return v.observe(p),ME(o,g),v}function E_(o,s,a){a&&a.disconnect(),s==="resize"&&AE(o)}function IE(o,s,a){const u=o.canvas,p=Gx(g=>{o.ctx!==null&&a(TE(g,o))},o);return bE(u,s,p),p}class PE extends d1{acquireContext(s,a){const u=s&&s.getContext&&s.getContext("2d");return u&&u.canvas===s?(vE(s,a),u):null}releaseContext(s){const a=s.canvas;if(!a[ap])return!1;const u=a[ap].initial;["height","width"].forEach(g=>{const v=u[g];ti(v)?a.removeAttribute(g):a.setAttribute(g,v)});const p=u.style||{};return Object.keys(p).forEach(g=>{a.style[g]=p[g]}),a.width=a.width,delete a[ap],!0}addEventListener(s,a,u){this.removeEventListener(s,a);const p=s.$proxies||(s.$proxies={}),v={attach:EE,detach:SE,resize:CE}[a]||IE;p[a]=v(s,a,u)}removeEventListener(s,a){const u=s.$proxies||(s.$proxies={}),p=u[a];if(!p)return;({attach:E_,detach:E_,resize:E_}[a]||wE)(s,a,p),u[a]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,a,u,p){return bT(s,a,u,p)}isAttached(s){const a=pm(s);return!!(a&&a.isConnected)}}function kE(o){return!e1()||typeof OffscreenCanvas<"u"&&o instanceof OffscreenCanvas?yE:PE}class Zs{constructor(){ue(this,"x");ue(this,"y");ue(this,"active",!1);ue(this,"options");ue(this,"$animations")}tooltipPosition(s){const{x:a,y:u}=this.getProps(["x","y"],s);return{x:a,y:u}}hasValue(){return Jl(this.x)&&Jl(this.y)}getProps(s,a){const u=this.$animations;if(!a||!u)return this;const p={};return s.forEach(g=>{p[g]=u[g]&&u[g].active()?u[g]._to:this[g]}),p}}ue(Zs,"defaults",{}),ue(Zs,"defaultRoutes");function DE(o,s){const a=o.options.ticks,u=LE(o),p=Math.min(a.maxTicksLimit||u,u),g=a.major.enabled?RE(s):[],v=g.length,r=g[0],T=g[v-1],I=[];if(v>p)return OE(s,I,g,v/p),I;const R=zE(g,s,p);if(v>0){let F,U;const Y=v>1?Math.round((T-r)/(v-1)):null;for(Wd(s,I,R,ti(Y)?0:r-Y,r),F=0,U=v-1;F<U;F++)Wd(s,I,R,g[F],g[F+1]);return Wd(s,I,R,T,ti(Y)?s.length:T+Y),I}return Wd(s,I,R),I}function LE(o){const s=o.options.offset,a=o._tickSize(),u=o._length/a+(s?0:1),p=o._maxLength/a;return Math.floor(Math.min(u,p))}function zE(o,s,a){const u=BE(o),p=s.length/a;if(!u)return Math.max(p,1);const g=S2(u);for(let v=0,r=g.length-1;v<r;v++){const T=g[v];if(T>p)return T}return Math.max(p,1)}function RE(o){const s=[];let a,u;for(a=0,u=o.length;a<u;a++)o[a].major&&s.push(a);return s}function OE(o,s,a,u){let p=0,g=a[0],v;for(u=Math.ceil(u),v=0;v<o.length;v++)v===g&&(s.push(o[v]),p++,g=a[p*u])}function Wd(o,s,a,u,p){const g=Ve(u,0),v=Math.min(Ve(p,o.length),o.length);let r=0,T,I,R;for(a=Math.ceil(a),p&&(T=p-u,a=T/Math.floor(T/a)),R=g;R<0;)r++,R=Math.round(g+r*a);for(I=Math.max(g,0);I<v;I++)I===R&&(s.push(o[I]),r++,R=Math.round(g+r*a))}function BE(o){const s=o.length;let a,u;if(s<2)return!1;for(u=o[0],a=1;a<s;++a)if(o[a]-o[a-1]!==u)return!1;return u}const FE=o=>o==="left"?"right":o==="right"?"left":o,By=(o,s,a)=>s==="top"||s==="left"?o[s]+a:o[s]-a,Fy=(o,s)=>Math.min(s||o,o);function Ny(o,s){const a=[],u=o.length/s,p=o.length;let g=0;for(;g<p;g+=u)a.push(o[Math.floor(g)]);return a}function NE(o,s,a){const u=o.ticks.length,p=Math.min(s,u-1),g=o._startPixel,v=o._endPixel,r=1e-6;let T=o.getPixelForTick(p),I;if(!(a&&(u===1?I=Math.max(T-g,v-T):s===0?I=(o.getPixelForTick(1)-T)/2:I=(T-o.getPixelForTick(p-1))/2,T+=p<s?I:-I,T<g-r||T>v+r)))return T}function jE(o,s){yi(o,a=>{const u=a.gc,p=u.length/2;let g;if(p>s){for(g=0;g<p;++g)delete a.data[u[g]];u.splice(0,p)}})}function Nh(o){return o.drawTicks?o.tickLength:0}function jy(o,s){if(!o.display)return 0;const a=hn(o.font,s),u=Dn(o.padding);return(zi(o.text)?o.text.length:1)*a.lineHeight+u.height}function VE(o,s){return Ro(o,{scale:s,type:"scale"})}function UE(o,s,a){return Ro(o,{tick:a,index:s,type:"tick"})}function GE(o,s,a){let u=am(o);return(a&&s!=="right"||!a&&s==="right")&&(u=FE(u)),u}function qE(o,s,a,u){const{top:p,left:g,bottom:v,right:r,chart:T}=o,{chartArea:I,scales:R}=T;let F=0,U,Y,it;const ct=v-p,ht=r-g;if(o.isHorizontal()){if(Y=Pn(u,g,r),Ye(a)){const bt=Object.keys(a)[0],Dt=a[bt];it=R[bt].getPixelForValue(Dt)+ct-s}else a==="center"?it=(I.bottom+I.top)/2+ct-s:it=By(o,a,s);U=r-g}else{if(Ye(a)){const bt=Object.keys(a)[0],Dt=a[bt];Y=R[bt].getPixelForValue(Dt)-ht+s}else a==="center"?Y=(I.left+I.right)/2-ht+s:Y=By(o,a,s);it=Pn(u,v,p),F=a==="left"?-Ji:Ji}return{titleX:Y,titleY:it,maxWidth:U,rotation:F}}class Ua extends Zs{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,a){return s}getUserBounds(){let{_userMin:s,_userMax:a,_suggestedMin:u,_suggestedMax:p}=this;return s=as(s,Number.POSITIVE_INFINITY),a=as(a,Number.NEGATIVE_INFINITY),u=as(u,Number.POSITIVE_INFINITY),p=as(p,Number.NEGATIVE_INFINITY),{min:as(s,u),max:as(a,p),minDefined:Yi(s),maxDefined:Yi(a)}}getMinMax(s){let{min:a,max:u,minDefined:p,maxDefined:g}=this.getUserBounds(),v;if(p&&g)return{min:a,max:u};const r=this.getMatchingVisibleMetas();for(let T=0,I=r.length;T<I;++T)v=r[T].controller.getMinMax(this,s),p||(a=Math.min(a,v.min)),g||(u=Math.max(u,v.max));return a=g&&a>u?u:a,u=p&&a>u?a:u,{min:as(a,as(u,a)),max:as(u,as(a,u))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}getLabelItems(s=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(s))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ci(this.options.beforeUpdate,[this])}update(s,a,u){const{beginAtZero:p,grace:g,ticks:v}=this.options,r=v.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=a,this._margins=u=Object.assign({left:0,right:0,top:0,bottom:0},u),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+u.left+u.right:this.height+u.top+u.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Q2(this,g,p),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const T=r<this.ticks.length;this._convertTicksToLabels(T?Ny(this.ticks,r):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),v.display&&(v.autoSkip||v.source==="auto")&&(this.ticks=DE(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),T&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,a,u;this.isHorizontal()?(a=this.left,u=this.right):(a=this.top,u=this.bottom,s=!s),this._startPixel=a,this._endPixel=u,this._reversePixels=s,this._length=u-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ci(this.options.afterUpdate,[this])}beforeSetDimensions(){Ci(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ci(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),Ci(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ci(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){const a=this.options.ticks;let u,p,g;for(u=0,p=s.length;u<p;u++)g=s[u],g.label=Ci(a.callback,[g.value,u,s],this)}afterTickToLabelConversion(){Ci(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ci(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const s=this.options,a=s.ticks,u=Fy(this.ticks.length,s.ticks.maxTicksLimit),p=a.minRotation||0,g=a.maxRotation;let v=p,r,T,I;if(!this._isVisible()||!a.display||p>=g||u<=1||!this.isHorizontal()){this.labelRotation=p;return}const R=this._getLabelSizes(),F=R.widest.width,U=R.highest.height,Y=mn(this.chart.width-F,0,this.maxWidth);r=s.offset?this.maxWidth/u:Y/(u-1),F+6>r&&(r=Y/(u-(s.offset?.5:1)),T=this.maxHeight-Nh(s.grid)-a.padding-jy(s.title,this.chart.options.font),I=Math.sqrt(F*F+U*U),v=rm(Math.min(Math.asin(mn((R.highest.height+6)/r,-1,1)),Math.asin(mn(T/I,-1,1))-Math.asin(mn(U/I,-1,1)))),v=Math.max(p,Math.min(g,v))),this.labelRotation=v}afterCalculateLabelRotation(){Ci(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ci(this.options.beforeFit,[this])}fit(){const s={width:0,height:0},{chart:a,options:{ticks:u,title:p,grid:g}}=this,v=this._isVisible(),r=this.isHorizontal();if(v){const T=jy(p,a.options.font);if(r?(s.width=this.maxWidth,s.height=Nh(g)+T):(s.height=this.maxHeight,s.width=Nh(g)+T),u.display&&this.ticks.length){const{first:I,last:R,widest:F,highest:U}=this._getLabelSizes(),Y=u.padding*2,it=qs(this.labelRotation),ct=Math.cos(it),ht=Math.sin(it);if(r){const bt=u.mirror?0:ht*F.width+ct*U.height;s.height=Math.min(this.maxHeight,s.height+bt+Y)}else{const bt=u.mirror?0:ct*F.width+ht*U.height;s.width=Math.min(this.maxWidth,s.width+bt+Y)}this._calculatePadding(I,R,ht,ct)}}this._handleMargins(),r?(this.width=this._length=a.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=a.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,a,u,p){const{ticks:{align:g,padding:v},position:r}=this.options,T=this.labelRotation!==0,I=r!=="top"&&this.axis==="x";if(this.isHorizontal()){const R=this.getPixelForTick(0)-this.left,F=this.right-this.getPixelForTick(this.ticks.length-1);let U=0,Y=0;T?I?(U=p*s.width,Y=u*a.height):(U=u*s.height,Y=p*a.width):g==="start"?Y=a.width:g==="end"?U=s.width:g!=="inner"&&(U=s.width/2,Y=a.width/2),this.paddingLeft=Math.max((U-R+v)*this.width/(this.width-R),0),this.paddingRight=Math.max((Y-F+v)*this.width/(this.width-F),0)}else{let R=a.height/2,F=s.height/2;g==="start"?(R=0,F=s.height):g==="end"&&(R=a.height,F=0),this.paddingTop=R+v,this.paddingBottom=F+v}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ci(this.options.afterFit,[this])}isHorizontal(){const{axis:s,position:a}=this.options;return a==="top"||a==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let a,u;for(a=0,u=s.length;a<u;a++)ti(s[a].label)&&(s.splice(a,1),u--,a--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){const a=this.options.ticks.sampleSize;let u=this.ticks;a<u.length&&(u=Ny(u,a)),this._labelSizes=s=this._computeLabelSizes(u,u.length,this.options.ticks.maxTicksLimit)}return s}_computeLabelSizes(s,a,u){const{ctx:p,_longestTextCache:g}=this,v=[],r=[],T=Math.floor(a/Fy(a,u));let I=0,R=0,F,U,Y,it,ct,ht,bt,Dt,Ft,Wt,Rt;for(F=0;F<a;F+=T){if(it=s[F].label,ct=this._resolveTickFontOptions(F),p.font=ht=ct.string,bt=g[ht]=g[ht]||{data:{},gc:[]},Dt=ct.lineHeight,Ft=Wt=0,!ti(it)&&!zi(it))Ft=vp(p,bt.data,bt.gc,Ft,it),Wt=Dt;else if(zi(it))for(U=0,Y=it.length;U<Y;++U)Rt=it[U],!ti(Rt)&&!zi(Rt)&&(Ft=vp(p,bt.data,bt.gc,Ft,Rt),Wt+=Dt);v.push(Ft),r.push(Wt),I=Math.max(Ft,I),R=Math.max(Wt,R)}jE(g,a);const Jt=v.indexOf(I),ne=r.indexOf(R),se=Lt=>({width:v[Lt]||0,height:r[Lt]||0});return{first:se(0),last:se(a-1),widest:se(Jt),highest:se(ne),widths:v,heights:r}}getLabelForValue(s){return s}getPixelForValue(s,a){return NaN}getValueForPixel(s){}getPixelForTick(s){const a=this.ticks;return s<0||s>a.length-1?null:this.getPixelForValue(a[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);const a=this._startPixel+s*this._length;return C2(this._alignToPixels?Ia(this.chart,a,0):a)}getDecimalForPixel(s){const a=(s-this._startPixel)/this._length;return this._reversePixels?1-a:a}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:s,max:a}=this;return s<0&&a<0?a:s>0&&a>0?s:0}getContext(s){const a=this.ticks||[];if(s>=0&&s<a.length){const u=a[s];return u.$context||(u.$context=UE(this.getContext(),s,u))}return this.$context||(this.$context=VE(this.chart.getContext(),this))}_tickSize(){const s=this.options.ticks,a=qs(this.labelRotation),u=Math.abs(Math.cos(a)),p=Math.abs(Math.sin(a)),g=this._getLabelSizes(),v=s.autoSkipPadding||0,r=g?g.widest.width+v:0,T=g?g.highest.height+v:0;return this.isHorizontal()?T*u>r*p?r/u:T/p:T*p<r*u?T/u:r/p}_isVisible(){const s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){const a=this.axis,u=this.chart,p=this.options,{grid:g,position:v,border:r}=p,T=g.offset,I=this.isHorizontal(),F=this.ticks.length+(T?1:0),U=Nh(g),Y=[],it=r.setContext(this.getContext()),ct=it.display?it.width:0,ht=ct/2,bt=function(ei){return Ia(u,ei,ct)};let Dt,Ft,Wt,Rt,Jt,ne,se,Lt,Le,ze,fe,Ge;if(v==="top")Dt=bt(this.bottom),ne=this.bottom-U,Lt=Dt-ht,ze=bt(s.top)+ht,Ge=s.bottom;else if(v==="bottom")Dt=bt(this.top),ze=s.top,Ge=bt(s.bottom)-ht,ne=Dt+ht,Lt=this.top+U;else if(v==="left")Dt=bt(this.right),Jt=this.right-U,se=Dt-ht,Le=bt(s.left)+ht,fe=s.right;else if(v==="right")Dt=bt(this.left),Le=s.left,fe=bt(s.right)-ht,Jt=Dt+ht,se=this.left+U;else if(a==="x"){if(v==="center")Dt=bt((s.top+s.bottom)/2+.5);else if(Ye(v)){const ei=Object.keys(v)[0],xi=v[ei];Dt=bt(this.chart.scales[ei].getPixelForValue(xi))}ze=s.top,Ge=s.bottom,ne=Dt+ht,Lt=ne+U}else if(a==="y"){if(v==="center")Dt=bt((s.left+s.right)/2);else if(Ye(v)){const ei=Object.keys(v)[0],xi=v[ei];Dt=bt(this.chart.scales[ei].getPixelForValue(xi))}Jt=Dt-ht,se=Jt-U,Le=s.left,fe=s.right}const on=Ve(p.ticks.maxTicksLimit,F),Ke=Math.max(1,Math.ceil(F/on));for(Ft=0;Ft<F;Ft+=Ke){const ei=this.getContext(Ft),xi=g.setContext(ei),be=r.setContext(ei),Pi=xi.lineWidth,vi=xi.color,ki=be.dash||[],gn=be.dashOffset,_i=xi.tickWidth,vn=xi.tickColor,Nn=xi.tickBorderDash||[],bn=xi.tickBorderDashOffset;Wt=NE(this,Ft,T),Wt!==void 0&&(Rt=Ia(u,Wt,Pi),I?Jt=se=Le=fe=Rt:ne=Lt=ze=Ge=Rt,Y.push({tx1:Jt,ty1:ne,tx2:se,ty2:Lt,x1:Le,y1:ze,x2:fe,y2:Ge,width:Pi,color:vi,borderDash:ki,borderDashOffset:gn,tickWidth:_i,tickColor:vn,tickBorderDash:Nn,tickBorderDashOffset:bn}))}return this._ticksLength=F,this._borderValue=Dt,Y}_computeLabelItems(s){const a=this.axis,u=this.options,{position:p,ticks:g}=u,v=this.isHorizontal(),r=this.ticks,{align:T,crossAlign:I,padding:R,mirror:F}=g,U=Nh(u.grid),Y=U+R,it=F?-R:Y,ct=-qs(this.labelRotation),ht=[];let bt,Dt,Ft,Wt,Rt,Jt,ne,se,Lt,Le,ze,fe,Ge="middle";if(p==="top")Jt=this.bottom-it,ne=this._getXAxisLabelAlignment();else if(p==="bottom")Jt=this.top+it,ne=this._getXAxisLabelAlignment();else if(p==="left"){const Ke=this._getYAxisLabelAlignment(U);ne=Ke.textAlign,Rt=Ke.x}else if(p==="right"){const Ke=this._getYAxisLabelAlignment(U);ne=Ke.textAlign,Rt=Ke.x}else if(a==="x"){if(p==="center")Jt=(s.top+s.bottom)/2+Y;else if(Ye(p)){const Ke=Object.keys(p)[0],ei=p[Ke];Jt=this.chart.scales[Ke].getPixelForValue(ei)+Y}ne=this._getXAxisLabelAlignment()}else if(a==="y"){if(p==="center")Rt=(s.left+s.right)/2-Y;else if(Ye(p)){const Ke=Object.keys(p)[0],ei=p[Ke];Rt=this.chart.scales[Ke].getPixelForValue(ei)}ne=this._getYAxisLabelAlignment(U).textAlign}a==="y"&&(T==="start"?Ge="top":T==="end"&&(Ge="bottom"));const on=this._getLabelSizes();for(bt=0,Dt=r.length;bt<Dt;++bt){Ft=r[bt],Wt=Ft.label;const Ke=g.setContext(this.getContext(bt));se=this.getPixelForTick(bt)+g.labelOffset,Lt=this._resolveTickFontOptions(bt),Le=Lt.lineHeight,ze=zi(Wt)?Wt.length:1;const ei=ze/2,xi=Ke.color,be=Ke.textStrokeColor,Pi=Ke.textStrokeWidth;let vi=ne;v?(Rt=se,ne==="inner"&&(bt===Dt-1?vi=this.options.reverse?"left":"right":bt===0?vi=this.options.reverse?"right":"left":vi="center"),p==="top"?I==="near"||ct!==0?fe=-ze*Le+Le/2:I==="center"?fe=-on.highest.height/2-ei*Le+Le:fe=-on.highest.height+Le/2:I==="near"||ct!==0?fe=Le/2:I==="center"?fe=on.highest.height/2-ei*Le:fe=on.highest.height-ze*Le,F&&(fe*=-1),ct!==0&&!Ke.showLabelBackdrop&&(Rt+=Le/2*Math.sin(ct))):(Jt=se,fe=(1-ze)*Le/2);let ki;if(Ke.showLabelBackdrop){const gn=Dn(Ke.backdropPadding),_i=on.heights[bt],vn=on.widths[bt];let Nn=fe-gn.top,bn=0-gn.left;switch(Ge){case"middle":Nn-=_i/2;break;case"bottom":Nn-=_i;break}switch(ne){case"center":bn-=vn/2;break;case"right":bn-=vn;break}ki={left:bn,top:Nn,width:vn+gn.width,height:_i+gn.height,color:Ke.backdropColor}}ht.push({label:Wt,font:Lt,textOffset:fe,options:{rotation:ct,color:xi,strokeColor:be,strokeWidth:Pi,textAlign:vi,textBaseline:Ge,translation:[Rt,Jt],backdrop:ki}})}return ht}_getXAxisLabelAlignment(){const{position:s,ticks:a}=this.options;if(-qs(this.labelRotation))return s==="top"?"left":"right";let p="center";return a.align==="start"?p="left":a.align==="end"?p="right":a.align==="inner"&&(p="inner"),p}_getYAxisLabelAlignment(s){const{position:a,ticks:{crossAlign:u,mirror:p,padding:g}}=this.options,v=this._getLabelSizes(),r=s+g,T=v.widest.width;let I,R;return a==="left"?p?(R=this.right+g,u==="near"?I="left":u==="center"?(I="center",R+=T/2):(I="right",R+=T)):(R=this.right-r,u==="near"?I="right":u==="center"?(I="center",R-=T/2):(I="left",R=this.left)):a==="right"?p?(R=this.left+g,u==="near"?I="right":u==="center"?(I="center",R-=T/2):(I="left",R-=T)):(R=this.left+r,u==="near"?I="left":u==="center"?(I="center",R+=T/2):(I="right",R=this.right)):I="right",{textAlign:I,x:R}}_computeLabelArea(){if(this.options.ticks.mirror)return;const s=this.chart,a=this.options.position;if(a==="left"||a==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(a==="top"||a==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){const{ctx:s,options:{backgroundColor:a},left:u,top:p,width:g,height:v}=this;a&&(s.save(),s.fillStyle=a,s.fillRect(u,p,g,v),s.restore())}getLineWidthForValue(s){const a=this.options.grid;if(!this._isVisible()||!a.display)return 0;const p=this.ticks.findIndex(g=>g.value===s);return p>=0?a.setContext(this.getContext(p)).lineWidth:0}drawGrid(s){const a=this.options.grid,u=this.ctx,p=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s));let g,v;const r=(T,I,R)=>{!R.width||!R.color||(u.save(),u.lineWidth=R.width,u.strokeStyle=R.color,u.setLineDash(R.borderDash||[]),u.lineDashOffset=R.borderDashOffset,u.beginPath(),u.moveTo(T.x,T.y),u.lineTo(I.x,I.y),u.stroke(),u.restore())};if(a.display)for(g=0,v=p.length;g<v;++g){const T=p[g];a.drawOnChartArea&&r({x:T.x1,y:T.y1},{x:T.x2,y:T.y2},T),a.drawTicks&&r({x:T.tx1,y:T.ty1},{x:T.tx2,y:T.ty2},{color:T.tickColor,width:T.tickWidth,borderDash:T.tickBorderDash,borderDashOffset:T.tickBorderDashOffset})}}drawBorder(){const{chart:s,ctx:a,options:{border:u,grid:p}}=this,g=u.setContext(this.getContext()),v=u.display?g.width:0;if(!v)return;const r=p.setContext(this.getContext(0)).lineWidth,T=this._borderValue;let I,R,F,U;this.isHorizontal()?(I=Ia(s,this.left,v)-v/2,R=Ia(s,this.right,r)+r/2,F=U=T):(F=Ia(s,this.top,v)-v/2,U=Ia(s,this.bottom,r)+r/2,I=R=T),a.save(),a.lineWidth=g.width,a.strokeStyle=g.color,a.beginPath(),a.moveTo(I,F),a.lineTo(R,U),a.stroke(),a.restore()}drawLabels(s){if(!this.options.ticks.display)return;const u=this.ctx,p=this._computeLabelArea();p&&Pp(u,p);const g=this.getLabelItems(s);for(const v of g){const r=v.options,T=v.font,I=v.label,R=v.textOffset;Va(u,I,0,R,T,r)}p&&kp(u)}drawTitle(){const{ctx:s,options:{position:a,title:u,reverse:p}}=this;if(!u.display)return;const g=hn(u.font),v=Dn(u.padding),r=u.align;let T=g.lineHeight/2;a==="bottom"||a==="center"||Ye(a)?(T+=v.bottom,zi(u.text)&&(T+=g.lineHeight*(u.text.length-1))):T+=v.top;const{titleX:I,titleY:R,maxWidth:F,rotation:U}=qE(this,T,a,r);Va(s,u.text,0,0,g,{color:u.color,maxWidth:F,rotation:U,textAlign:GE(r,a,p),textBaseline:"middle",translation:[I,R]})}draw(s){this._isVisible()&&(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){const s=this.options,a=s.ticks&&s.ticks.z||0,u=Ve(s.grid&&s.grid.z,-1),p=Ve(s.border&&s.border.z,0);return!this._isVisible()||this.draw!==Ua.prototype.draw?[{z:a,draw:g=>{this.draw(g)}}]:[{z:u,draw:g=>{this.drawBackground(),this.drawGrid(g),this.drawTitle()}},{z:p,draw:()=>{this.drawBorder()}},{z:a,draw:g=>{this.drawLabels(g)}}]}getMatchingVisibleMetas(s){const a=this.chart.getSortedVisibleDatasetMetas(),u=this.axis+"AxisID",p=[];let g,v;for(g=0,v=a.length;g<v;++g){const r=a[g];r[u]===this.id&&(!s||r.type===s)&&p.push(r)}return p}_resolveTickFontOptions(s){const a=this.options.ticks.setContext(this.getContext(s));return hn(a.font)}_maxDigits(){const s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}}class Zd{constructor(s,a,u){this.type=s,this.scope=a,this.override=u,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){const a=Object.getPrototypeOf(s);let u;ZE(a)&&(u=this.register(a));const p=this.items,g=s.id,v=this.scope+"."+g;if(!g)throw new Error("class does not have id: "+s);return g in p||(p[g]=s,$E(s,v,u),this.override&&Ki.override(s.id,s.overrides)),v}get(s){return this.items[s]}unregister(s){const a=this.items,u=s.id,p=this.scope;u in a&&delete a[u],p&&u in Ki[p]&&(delete Ki[p][u],this.override&&delete ja[u])}}function $E(o,s,a){const u=iu(Object.create(null),[a?Ki.get(a):{},Ki.get(s),o.defaults]);Ki.set(s,u),o.defaultRoutes&&WE(s,o.defaultRoutes),o.descriptors&&Ki.describe(s,o.descriptors)}function WE(o,s){Object.keys(s).forEach(a=>{const u=a.split("."),p=u.pop(),g=[o].concat(u).join("."),v=s[a].split("."),r=v.pop(),T=v.join(".");Ki.route(g,p,T,r)})}function ZE(o){return"id"in o&&"defaults"in o}class HE{constructor(){this.controllers=new Zd(Ws,"datasets",!0),this.elements=new Zd(Zs,"elements"),this.plugins=new Zd(Object,"plugins"),this.scales=new Zd(Ua,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,a,u){[...a].forEach(p=>{const g=u||this._getRegistryForType(p);u||g.isForType(p)||g===this.plugins&&p.id?this._exec(s,g,p):yi(p,v=>{const r=u||this._getRegistryForType(v);this._exec(s,r,v)})})}_exec(s,a,u){const p=sm(s);Ci(u["before"+p],[],u),a[s](u),Ci(u["after"+p],[],u)}_getRegistryForType(s){for(let a=0;a<this._typedRegistries.length;a++){const u=this._typedRegistries[a];if(u.isForType(s))return u}return this.plugins}_get(s,a,u){const p=a.get(s);if(p===void 0)throw new Error('"'+s+'" is not a registered '+u+".");return p}}var cr=new HE;class XE{constructor(){this._init=[]}notify(s,a,u,p){a==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install"));const g=p?this._descriptors(s).filter(p):this._descriptors(s),v=this._notify(g,s,a,u);return a==="afterDestroy"&&(this._notify(g,s,"stop"),this._notify(this._init,s,"uninstall")),v}_notify(s,a,u,p){p=p||{};for(const g of s){const v=g.plugin,r=v[u],T=[a,p,g.options];if(Ci(r,T,v)===!1&&p.cancelable)return!1}return!0}invalidate(){ti(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;const a=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),a}_createDescriptors(s,a){const u=s&&s.config,p=Ve(u.options&&u.options.plugins,{}),g=YE(u);return p===!1&&!a?[]:JE(s,g,p,a)}_notifyStateChanges(s){const a=this._oldCache||[],u=this._cache,p=(g,v)=>g.filter(r=>!v.some(T=>r.plugin.id===T.plugin.id));this._notify(p(a,u),s,"stop"),this._notify(p(u,a),s,"start")}}function YE(o){const s={},a=[],u=Object.keys(cr.plugins.items);for(let g=0;g<u.length;g++)a.push(cr.getPlugin(u[g]));const p=o.plugins||[];for(let g=0;g<p.length;g++){const v=p[g];a.indexOf(v)===-1&&(a.push(v),s[v.id]=!0)}return{plugins:a,localIds:s}}function KE(o,s){return!s&&o===!1?null:o===!0?{}:o}function JE(o,{plugins:s,localIds:a},u,p){const g=[],v=o.getContext();for(const r of s){const T=r.id,I=KE(u[T],p);I!==null&&g.push({plugin:r,options:QE(o.config,{plugin:r,local:a[T]},I,v)})}return g}function QE(o,{plugin:s,local:a},u,p){const g=o.pluginScopeKeys(s),v=o.getOptionScopes(u,g);return a&&s.defaults&&v.push(s.defaults),o.createResolver(v,p,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function U_(o,s){const a=Ki.datasets[o]||{};return((s.datasets||{})[o]||{}).indexAxis||s.indexAxis||a.indexAxis||"x"}function t3(o,s){let a=o;return o==="_index_"?a=s:o==="_value_"&&(a=s==="x"?"y":"x"),a}function e3(o,s){return o===s?"_index_":"_value_"}function Vy(o){if(o==="x"||o==="y"||o==="r")return o}function i3(o){if(o==="top"||o==="bottom")return"x";if(o==="left"||o==="right")return"y"}function G_(o,...s){if(Vy(o))return o;for(const a of s){const u=a.axis||i3(a.position)||o.length>1&&Vy(o[0].toLowerCase());if(u)return u}throw new Error(`Cannot determine type of '${o}' axis. Please provide 'axis' or 'position' option.`)}function Uy(o,s,a){if(a[s+"AxisID"]===o)return{axis:s}}function n3(o,s){if(s.data&&s.data.datasets){const a=s.data.datasets.filter(u=>u.xAxisID===o||u.yAxisID===o);if(a.length)return Uy(o,"x",a[0])||Uy(o,"y",a[0])}return{}}function s3(o,s){const a=ja[o.type]||{scales:{}},u=s.scales||{},p=U_(o.type,s),g=Object.create(null);return Object.keys(u).forEach(v=>{const r=u[v];if(!Ye(r))return console.error(`Invalid scale configuration for scale: ${v}`);if(r._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${v}`);const T=G_(v,r,n3(v,o),Ki.scales[r.type]),I=e3(T,p),R=a.scales||{};g[v]=Yh(Object.create(null),[{axis:T},r,R[T],R[I]])}),o.data.datasets.forEach(v=>{const r=v.type||o.type,T=v.indexAxis||U_(r,s),R=(ja[r]||{}).scales||{};Object.keys(R).forEach(F=>{const U=t3(F,T),Y=v[U+"AxisID"]||U;g[Y]=g[Y]||Object.create(null),Yh(g[Y],[{axis:U},u[Y],R[F]])})}),Object.keys(g).forEach(v=>{const r=g[v];Yh(r,[Ki.scales[r.type],Ki.scale])}),g}function _1(o){const s=o.options||(o.options={});s.plugins=Ve(s.plugins,{}),s.scales=s3(o,s)}function m1(o){return o=o||{},o.datasets=o.datasets||[],o.labels=o.labels||[],o}function r3(o){return o=o||{},o.data=m1(o.data),_1(o),o}const Gy=new Map,g1=new Set;function Hd(o,s){let a=Gy.get(o);return a||(a=s(),Gy.set(o,a),g1.add(a)),a}const jh=(o,s,a)=>{const u=ko(s,a);u!==void 0&&o.add(u)};class o3{constructor(s){this._config=r3(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=m1(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){const s=this._config;this.clearCache(),_1(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return Hd(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,a){return Hd(`${s}.transition.${a}`,()=>[[`datasets.${s}.transitions.${a}`,`transitions.${a}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,a){return Hd(`${s}-${a}`,()=>[[`datasets.${s}.elements.${a}`,`datasets.${s}`,`elements.${a}`,""]])}pluginScopeKeys(s){const a=s.id,u=this.type;return Hd(`${u}-plugin-${a}`,()=>[[`plugins.${a}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,a){const u=this._scopeCache;let p=u.get(s);return(!p||a)&&(p=new Map,u.set(s,p)),p}getOptionScopes(s,a,u){const{options:p,type:g}=this,v=this._cachedScopes(s,u),r=v.get(a);if(r)return r;const T=new Set;a.forEach(R=>{s&&(T.add(s),R.forEach(F=>jh(T,s,F))),R.forEach(F=>jh(T,p,F)),R.forEach(F=>jh(T,ja[g]||{},F)),R.forEach(F=>jh(T,Ki,F)),R.forEach(F=>jh(T,N_,F))});const I=Array.from(T);return I.length===0&&I.push(Object.create(null)),g1.has(a)&&v.set(a,I),I}chartOptionScopes(){const{options:s,type:a}=this;return[s,ja[a]||{},Ki.datasets[a]||{},{type:a},Ki,N_]}resolveNamedOptions(s,a,u,p=[""]){const g={$shared:!0},{resolver:v,subPrefixes:r}=qy(this._resolverCache,s,p);let T=v;if(l3(v,a)){g.$shared=!1,u=Do(u)?u():u;const I=this.createResolver(s,u,r);T=Ql(v,u,I)}for(const I of a)g[I]=T[I];return g}createResolver(s,a,u=[""],p){const{resolver:g}=qy(this._resolverCache,s,u);return Ye(a)?Ql(g,a,void 0,p):g}}function qy(o,s,a){let u=o.get(s);u||(u=new Map,o.set(s,u));const p=a.join();let g=u.get(p);return g||(g={resolver:hm(s,a),subPrefixes:a.filter(r=>!r.toLowerCase().includes("hover"))},u.set(p,g)),g}const a3=o=>Ye(o)&&Object.getOwnPropertyNames(o).reduce((s,a)=>s||Do(o[a]),!1);function l3(o,s){const{isScriptable:a,isIndexable:u}=Xx(o);for(const p of s){const g=a(p),v=u(p),r=(v||g)&&o[p];if(g&&(Do(r)||a3(r))||v&&zi(r))return!0}return!1}var c3="4.4.0";const h3=["top","bottom","left","right","chartArea"];function $y(o,s){return o==="top"||o==="bottom"||h3.indexOf(o)===-1&&s==="x"}function Wy(o,s){return function(a,u){return a[o]===u[o]?a[s]-u[s]:a[o]-u[o]}}function Zy(o){const s=o.chart,a=s.options.animation;s.notifyPlugins("afterRender"),Ci(a&&a.onComplete,[o],s)}function u3(o){const s=o.chart,a=s.options.animation;Ci(a&&a.onProgress,[o],s)}function y1(o){return e1()&&typeof o=="string"?o=document.getElementById(o):o&&o.length&&(o=o[0]),o&&o.canvas&&(o=o.canvas),o}const lp={},Hy=o=>{const s=y1(o);return Object.values(lp).filter(a=>a.canvas===s).pop()};function d3(o,s,a){const u=Object.keys(o);for(const p of u){const g=+p;if(g>=s){const v=o[p];delete o[p],(a>0||g>s)&&(o[g+a]=v)}}}function p3(o,s,a,u){return!a||o.type==="mouseout"?null:u?s:o}function Xd(o,s,a){return o.options.clip?o[a]:s[a]}function f3(o,s){const{xScale:a,yScale:u}=o;return a&&u?{left:Xd(a,s,"left"),right:Xd(a,s,"right"),top:Xd(u,s,"top"),bottom:Xd(u,s,"bottom")}:s}class bs{static register(...s){cr.add(...s),Xy()}static unregister(...s){cr.remove(...s),Xy()}constructor(s,a){const u=this.config=new o3(a),p=y1(s),g=Hy(p);if(g)throw new Error("Canvas is already in use. Chart with ID '"+g.id+"' must be destroyed before the canvas with ID '"+g.canvas.id+"' can be reused.");const v=u.createResolver(u.chartOptionScopes(),this.getContext());this.platform=new(u.platform||kE(p)),this.platform.updateConfig(u);const r=this.platform.acquireContext(p,v.aspectRatio),T=r&&r.canvas,I=T&&T.height,R=T&&T.width;if(this.id=m2(),this.ctx=r,this.canvas=T,this.width=R,this.height=I,this._options=v,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new XE,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=D2(F=>this.update(F),v.resizeDelay||0),this._dataChanges=[],lp[this.id]=this,!r||!T){console.error("Failed to create chart: can't acquire context from the given item");return}Rr.listen(this,"complete",Zy),Rr.listen(this,"progress",u3),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:s,maintainAspectRatio:a},width:u,height:p,_aspectRatio:g}=this;return ti(s)?a&&g?g:p?u/p:null:s}get data(){return this.config.data}set data(s){this.config.data=s}get options(){return this._options}set options(s){this.config.options=s}get registry(){return cr}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():my(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return py(this.canvas,this.ctx),this}stop(){return Rr.stop(this),this}resize(s,a){Rr.running(this)?this._resizeBeforeDraw={width:s,height:a}:this._resize(s,a)}_resize(s,a){const u=this.options,p=this.canvas,g=u.maintainAspectRatio&&this.aspectRatio,v=this.platform.getMaximumSize(p,s,a,g),r=u.devicePixelRatio||this.platform.getDevicePixelRatio(),T=this.width?"resize":"attach";this.width=v.width,this.height=v.height,this._aspectRatio=this.aspectRatio,my(this,r,!0)&&(this.notifyPlugins("resize",{size:v}),Ci(u.onResize,[this,v],this),this.attached&&this._doResize(T)&&this.render())}ensureScalesHaveIDs(){const a=this.options.scales||{};yi(a,(u,p)=>{u.id=p})}buildOrUpdateScales(){const s=this.options,a=s.scales,u=this.scales,p=Object.keys(u).reduce((v,r)=>(v[r]=!1,v),{});let g=[];a&&(g=g.concat(Object.keys(a).map(v=>{const r=a[v],T=G_(v,r),I=T==="r",R=T==="x";return{options:r,dposition:I?"chartArea":R?"bottom":"left",dtype:I?"radialLinear":R?"category":"linear"}}))),yi(g,v=>{const r=v.options,T=r.id,I=G_(T,r),R=Ve(r.type,v.dtype);(r.position===void 0||$y(r.position,I)!==$y(v.dposition))&&(r.position=v.dposition),p[T]=!0;let F=null;if(T in u&&u[T].type===R)F=u[T];else{const U=cr.getScale(R);F=new U({id:T,type:R,ctx:this.ctx,chart:this}),u[F.id]=F}F.init(r,s)}),yi(p,(v,r)=>{v||delete u[r]}),yi(u,v=>{kn.configure(this,v,v.options),kn.addBox(this,v)})}_updateMetasets(){const s=this._metasets,a=this.data.datasets.length,u=s.length;if(s.sort((p,g)=>p.index-g.index),u>a){for(let p=a;p<u;++p)this._destroyDatasetMeta(p);s.splice(a,u-a)}this._sortedMetasets=s.slice(0).sort(Wy("order","index"))}_removeUnreferencedMetasets(){const{_metasets:s,data:{datasets:a}}=this;s.length>a.length&&delete this._stacks,s.forEach((u,p)=>{a.filter(g=>g===u._dataset).length===0&&this._destroyDatasetMeta(p)})}buildOrUpdateControllers(){const s=[],a=this.data.datasets;let u,p;for(this._removeUnreferencedMetasets(),u=0,p=a.length;u<p;u++){const g=a[u];let v=this.getDatasetMeta(u);const r=g.type||this.config.type;if(v.type&&v.type!==r&&(this._destroyDatasetMeta(u),v=this.getDatasetMeta(u)),v.type=r,v.indexAxis=g.indexAxis||U_(r,this.options),v.order=g.order||0,v.index=u,v.label=""+g.label,v.visible=this.isDatasetVisible(u),v.controller)v.controller.updateIndex(u),v.controller.linkScales();else{const T=cr.getController(r),{datasetElementType:I,dataElementType:R}=Ki.datasets[r];Object.assign(T,{dataElementType:cr.getElement(R),datasetElementType:I&&cr.getElement(I)}),v.controller=new T(this,u),s.push(v.controller)}}return this._updateMetasets(),s}_resetElements(){yi(this.data.datasets,(s,a)=>{this.getDatasetMeta(a).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(s){const a=this.config;a.update();const u=this._options=a.createResolver(a.chartOptionScopes(),this.getContext()),p=this._animationsDisabled=!u.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:s,cancelable:!0})===!1)return;const g=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let v=0;for(let I=0,R=this.data.datasets.length;I<R;I++){const{controller:F}=this.getDatasetMeta(I),U=!p&&g.indexOf(F)===-1;F.buildOrUpdateElements(U),v=Math.max(+F.getMaxOverflow(),v)}v=this._minPadding=u.layout.autoPadding?v:0,this._updateLayout(v),p||yi(g,I=>{I.reset()}),this._updateDatasets(s),this.notifyPlugins("afterUpdate",{mode:s}),this._layers.sort(Wy("z","_idx"));const{_active:r,_lastEvent:T}=this;T?this._eventHandler(T,!0):r.length&&this._updateHoverStyles(r,r,!0),this.render()}_updateScales(){yi(this.scales,s=>{kn.removeBox(this,s)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const s=this.options,a=new Set(Object.keys(this._listeners)),u=new Set(s.events);(!sy(a,u)||!!this._responsiveListeners!==s.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:s}=this,a=this._getUniformDataChanges()||[];for(const{method:u,start:p,count:g}of a){const v=u==="_removeElements"?-g:g;d3(s,p,v)}}_getUniformDataChanges(){const s=this._dataChanges;if(!s||!s.length)return;this._dataChanges=[];const a=this.data.datasets.length,u=g=>new Set(s.filter(v=>v[0]===g).map((v,r)=>r+","+v.splice(1).join(","))),p=u(0);for(let g=1;g<a;g++)if(!sy(p,u(g)))return;return Array.from(p).map(g=>g.split(",")).map(g=>({method:g[1],start:+g[2],count:+g[3]}))}_updateLayout(s){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;kn.update(this,this.width,this.height,s);const a=this.chartArea,u=a.width<=0||a.height<=0;this._layers=[],yi(this.boxes,p=>{u&&p.position==="chartArea"||(p.configure&&p.configure(),this._layers.push(...p._layers()))},this),this._layers.forEach((p,g)=>{p._idx=g}),this.notifyPlugins("afterLayout")}_updateDatasets(s){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:s,cancelable:!0})!==!1){for(let a=0,u=this.data.datasets.length;a<u;++a)this.getDatasetMeta(a).controller.configure();for(let a=0,u=this.data.datasets.length;a<u;++a)this._updateDataset(a,Do(s)?s({datasetIndex:a}):s);this.notifyPlugins("afterDatasetsUpdate",{mode:s})}}_updateDataset(s,a){const u=this.getDatasetMeta(s),p={meta:u,index:s,mode:a,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",p)!==!1&&(u.controller._update(a),p.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",p))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Rr.has(this)?this.attached&&!Rr.running(this)&&Rr.start(this):(this.draw(),Zy({chart:this})))}draw(){let s;if(this._resizeBeforeDraw){const{width:u,height:p}=this._resizeBeforeDraw;this._resize(u,p),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const a=this._layers;for(s=0;s<a.length&&a[s].z<=0;++s)a[s].draw(this.chartArea);for(this._drawDatasets();s<a.length;++s)a[s].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(s){const a=this._sortedMetasets,u=[];let p,g;for(p=0,g=a.length;p<g;++p){const v=a[p];(!s||v.visible)&&u.push(v)}return u}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const s=this.getSortedVisibleDatasetMetas();for(let a=s.length-1;a>=0;--a)this._drawDataset(s[a]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(s){const a=this.ctx,u=s._clip,p=!u.disabled,g=f3(s,this.chartArea),v={meta:s,index:s.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",v)!==!1&&(p&&Pp(a,{left:u.left===!1?0:g.left-u.left,right:u.right===!1?this.width:g.right+u.right,top:u.top===!1?0:g.top-u.top,bottom:u.bottom===!1?this.height:g.bottom+u.bottom}),s.controller.draw(),p&&kp(a),v.cancelable=!1,this.notifyPlugins("afterDatasetDraw",v))}isPointInArea(s){return jr(s,this.chartArea,this._minPadding)}getElementsAtEventForMode(s,a,u,p){const g=hE.modes[a];return typeof g=="function"?g(this,s,u,p):[]}getDatasetMeta(s){const a=this.data.datasets[s],u=this._metasets;let p=u.filter(g=>g&&g._dataset===a).pop();return p||(p={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:a&&a.order||0,index:s,_dataset:a,_parsed:[],_sorted:!1},u.push(p)),p}getContext(){return this.$context||(this.$context=Ro(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(s){const a=this.data.datasets[s];if(!a)return!1;const u=this.getDatasetMeta(s);return typeof u.hidden=="boolean"?!u.hidden:!a.hidden}setDatasetVisibility(s,a){const u=this.getDatasetMeta(s);u.hidden=!a}toggleDataVisibility(s){this._hiddenIndices[s]=!this._hiddenIndices[s]}getDataVisibility(s){return!this._hiddenIndices[s]}_updateVisibility(s,a,u){const p=u?"show":"hide",g=this.getDatasetMeta(s),v=g.controller._resolveAnimations(void 0,p);nu(a)?(g.data[a].hidden=!u,this.update()):(this.setDatasetVisibility(s,u),v.update(g,{visible:u}),this.update(r=>r.datasetIndex===s?p:void 0))}hide(s,a){this._updateVisibility(s,a,!1)}show(s,a){this._updateVisibility(s,a,!0)}_destroyDatasetMeta(s){const a=this._metasets[s];a&&a.controller&&a.controller._destroy(),delete this._metasets[s]}_stop(){let s,a;for(this.stop(),Rr.remove(this),s=0,a=this.data.datasets.length;s<a;++s)this._destroyDatasetMeta(s)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:s,ctx:a}=this;this._stop(),this.config.clearCache(),s&&(this.unbindEvents(),py(s,a),this.platform.releaseContext(a),this.canvas=null,this.ctx=null),delete lp[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...s){return this.canvas.toDataURL(...s)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const s=this._listeners,a=this.platform,u=(g,v)=>{a.addEventListener(this,g,v),s[g]=v},p=(g,v,r)=>{g.offsetX=v,g.offsetY=r,this._eventHandler(g)};yi(this.options.events,g=>u(g,p))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const s=this._responsiveListeners,a=this.platform,u=(T,I)=>{a.addEventListener(this,T,I),s[T]=I},p=(T,I)=>{s[T]&&(a.removeEventListener(this,T,I),delete s[T])},g=(T,I)=>{this.canvas&&this.resize(T,I)};let v;const r=()=>{p("attach",r),this.attached=!0,this.resize(),u("resize",g),u("detach",v)};v=()=>{this.attached=!1,p("resize",g),this._stop(),this._resize(0,0),u("attach",r)},a.isAttached(this.canvas)?r():v()}unbindEvents(){yi(this._listeners,(s,a)=>{this.platform.removeEventListener(this,a,s)}),this._listeners={},yi(this._responsiveListeners,(s,a)=>{this.platform.removeEventListener(this,a,s)}),this._responsiveListeners=void 0}updateHoverStyle(s,a,u){const p=u?"set":"remove";let g,v,r,T;for(a==="dataset"&&(g=this.getDatasetMeta(s[0].datasetIndex),g.controller["_"+p+"DatasetHoverStyle"]()),r=0,T=s.length;r<T;++r){v=s[r];const I=v&&this.getDatasetMeta(v.datasetIndex).controller;I&&I[p+"HoverStyle"](v.element,v.datasetIndex,v.index)}}getActiveElements(){return this._active||[]}setActiveElements(s){const a=this._active||[],u=s.map(({datasetIndex:g,index:v})=>{const r=this.getDatasetMeta(g);if(!r)throw new Error("No dataset found at index "+g);return{datasetIndex:g,element:r.data[v],index:v}});!gp(u,a)&&(this._active=u,this._lastEvent=null,this._updateHoverStyles(u,a))}notifyPlugins(s,a,u){return this._plugins.notify(this,s,a,u)}isPluginEnabled(s){return this._plugins._cache.filter(a=>a.plugin.id===s).length===1}_updateHoverStyles(s,a,u){const p=this.options.hover,g=(T,I)=>T.filter(R=>!I.some(F=>R.datasetIndex===F.datasetIndex&&R.index===F.index)),v=g(a,s),r=u?s:g(s,a);v.length&&this.updateHoverStyle(v,p.mode,!1),r.length&&p.mode&&this.updateHoverStyle(r,p.mode,!0)}_eventHandler(s,a){const u={event:s,replay:a,cancelable:!0,inChartArea:this.isPointInArea(s)},p=v=>(v.options.events||this.options.events).includes(s.native.type);if(this.notifyPlugins("beforeEvent",u,p)===!1)return;const g=this._handleEvent(s,a,u.inChartArea);return u.cancelable=!1,this.notifyPlugins("afterEvent",u,p),(g||u.changed)&&this.render(),this}_handleEvent(s,a,u){const{_active:p=[],options:g}=this,v=a,r=this._getActiveElements(s,p,u,v),T=w2(s),I=p3(s,this._lastEvent,u,T);u&&(this._lastEvent=null,Ci(g.onHover,[s,r,this],this),T&&Ci(g.onClick,[s,r,this],this));const R=!gp(r,p);return(R||a)&&(this._active=r,this._updateHoverStyles(r,p,a)),this._lastEvent=I,R}_getActiveElements(s,a,u,p){if(s.type==="mouseout")return[];if(!u)return a;const g=this.options.hover;return this.getElementsAtEventForMode(s,g.mode,g,p)}}ue(bs,"defaults",Ki),ue(bs,"instances",lp),ue(bs,"overrides",ja),ue(bs,"registry",cr),ue(bs,"version",c3),ue(bs,"getChart",Hy);function Xy(){return yi(bs.instances,o=>o._plugins.invalidate())}function _3(o,s,a){const{startAngle:u,pixelMargin:p,x:g,y:v,outerRadius:r,innerRadius:T}=s;let I=p/r;o.beginPath(),o.arc(g,v,r,u-I,a+I),T>p?(I=p/T,o.arc(g,v,T,a+I,u-I,!0)):o.arc(g,v,p,a+Ji,u-Ji),o.closePath(),o.clip()}function m3(o){return cm(o,["outerStart","outerEnd","innerStart","innerEnd"])}function g3(o,s,a,u){const p=m3(o.options.borderRadius),g=(a-s)/2,v=Math.min(g,u*s/2),r=T=>{const I=(a-Math.min(g,T))*u/2;return mn(T,0,Math.min(g,I))};return{outerStart:r(p.outerStart),outerEnd:r(p.outerEnd),innerStart:mn(p.innerStart,0,v),innerEnd:mn(p.innerEnd,0,v)}}function Wl(o,s,a,u){return{x:a+o*Math.cos(s),y:u+o*Math.sin(s)}}function Tp(o,s,a,u,p,g){const{x:v,y:r,startAngle:T,pixelMargin:I,innerRadius:R}=s,F=Math.max(s.outerRadius+u+a-I,0),U=R>0?R+u+a+I:0;let Y=0;const it=p-T;if(u){const Ke=R>0?R-u:0,ei=F>0?F-u:0,xi=(Ke+ei)/2,be=xi!==0?it*xi/(xi+u):it;Y=(it-be)/2}const ct=Math.max(.001,it*F-a/Oi)/F,ht=(it-ct)/2,bt=T+ht+Y,Dt=p-ht-Y,{outerStart:Ft,outerEnd:Wt,innerStart:Rt,innerEnd:Jt}=g3(s,U,F,Dt-bt),ne=F-Ft,se=F-Wt,Lt=bt+Ft/ne,Le=Dt-Wt/se,ze=U+Rt,fe=U+Jt,Ge=bt+Rt/ze,on=Dt-Jt/fe;if(o.beginPath(),g){const Ke=(Lt+Le)/2;if(o.arc(v,r,F,Lt,Ke),o.arc(v,r,F,Ke,Le),Wt>0){const Pi=Wl(se,Le,v,r);o.arc(Pi.x,Pi.y,Wt,Le,Dt+Ji)}const ei=Wl(fe,Dt,v,r);if(o.lineTo(ei.x,ei.y),Jt>0){const Pi=Wl(fe,on,v,r);o.arc(Pi.x,Pi.y,Jt,Dt+Ji,on+Math.PI)}const xi=(Dt-Jt/U+(bt+Rt/U))/2;if(o.arc(v,r,U,Dt-Jt/U,xi,!0),o.arc(v,r,U,xi,bt+Rt/U,!0),Rt>0){const Pi=Wl(ze,Ge,v,r);o.arc(Pi.x,Pi.y,Rt,Ge+Math.PI,bt-Ji)}const be=Wl(ne,bt,v,r);if(o.lineTo(be.x,be.y),Ft>0){const Pi=Wl(ne,Lt,v,r);o.arc(Pi.x,Pi.y,Ft,bt-Ji,Lt)}}else{o.moveTo(v,r);const Ke=Math.cos(Lt)*F+v,ei=Math.sin(Lt)*F+r;o.lineTo(Ke,ei);const xi=Math.cos(Le)*F+v,be=Math.sin(Le)*F+r;o.lineTo(xi,be)}o.closePath()}function y3(o,s,a,u,p){const{fullCircles:g,startAngle:v,circumference:r}=s;let T=s.endAngle;if(g){Tp(o,s,a,u,T,p);for(let I=0;I<g;++I)o.fill();isNaN(r)||(T=v+(r%Ri||Ri))}return Tp(o,s,a,u,T,p),o.fill(),T}function x3(o,s,a,u,p){const{fullCircles:g,startAngle:v,circumference:r,options:T}=s,{borderWidth:I,borderJoinStyle:R,borderDash:F,borderDashOffset:U}=T,Y=T.borderAlign==="inner";if(!I)return;o.setLineDash(F||[]),o.lineDashOffset=U,Y?(o.lineWidth=I*2,o.lineJoin=R||"round"):(o.lineWidth=I,o.lineJoin=R||"bevel");let it=s.endAngle;if(g){Tp(o,s,a,u,it,p);for(let ct=0;ct<g;++ct)o.stroke();isNaN(r)||(it=v+(r%Ri||Ri))}Y&&_3(o,s,it),g||(Tp(o,s,a,u,it,p),o.stroke())}class $h extends Zs{constructor(a){super();ue(this,"circumference");ue(this,"endAngle");ue(this,"fullCircles");ue(this,"innerRadius");ue(this,"outerRadius");ue(this,"pixelMargin");ue(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,a&&Object.assign(this,a)}inRange(a,u,p){const g=this.getProps(["x","y"],p),{angle:v,distance:r}=Nx(g,{x:a,y:u}),{startAngle:T,endAngle:I,innerRadius:R,outerRadius:F,circumference:U}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],p),Y=(this.options.spacing+this.options.borderWidth)/2,ct=Ve(U,I-T)>=Ri||su(v,T,I),ht=Fr(r,R+Y,F+Y);return ct&&ht}getCenterPoint(a){const{x:u,y:p,startAngle:g,endAngle:v,innerRadius:r,outerRadius:T}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],a),{offset:I,spacing:R}=this.options,F=(g+v)/2,U=(r+T+R+I)/2;return{x:u+Math.cos(F)*U,y:p+Math.sin(F)*U}}tooltipPosition(a){return this.getCenterPoint(a)}draw(a){const{options:u,circumference:p}=this,g=(u.offset||0)/4,v=(u.spacing||0)/2,r=u.circular;if(this.pixelMargin=u.borderAlign==="inner"?.33:0,this.fullCircles=p>Ri?Math.floor(p/Ri):0,p===0||this.innerRadius<0||this.outerRadius<0)return;a.save();const T=(this.startAngle+this.endAngle)/2;a.translate(Math.cos(T)*g,Math.sin(T)*g);const I=1-Math.sin(Math.min(Oi,p||0)),R=g*I;a.fillStyle=u.backgroundColor,a.strokeStyle=u.borderColor,y3(a,this,R,v,r),x3(a,this,R,v,r),a.restore()}}ue($h,"id","arc"),ue($h,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0}),ue($h,"defaultRoutes",{backgroundColor:"backgroundColor"}),ue($h,"descriptors",{_scriptable:!0,_indexable:a=>a!=="borderDash"});function x1(o,s,a=s){o.lineCap=Ve(a.borderCapStyle,s.borderCapStyle),o.setLineDash(Ve(a.borderDash,s.borderDash)),o.lineDashOffset=Ve(a.borderDashOffset,s.borderDashOffset),o.lineJoin=Ve(a.borderJoinStyle,s.borderJoinStyle),o.lineWidth=Ve(a.borderWidth,s.borderWidth),o.strokeStyle=Ve(a.borderColor,s.borderColor)}function v3(o,s,a){o.lineTo(a.x,a.y)}function b3(o){return o.stepped?q2:o.tension||o.cubicInterpolationMode==="monotone"?$2:v3}function v1(o,s,a={}){const u=o.length,{start:p=0,end:g=u-1}=a,{start:v,end:r}=s,T=Math.max(p,v),I=Math.min(g,r),R=p<v&&g<v||p>r&&g>r;return{count:u,start:T,loop:s.loop,ilen:I<T&&!R?u+I-T:I-T}}function w3(o,s,a,u){const{points:p,options:g}=s,{count:v,start:r,loop:T,ilen:I}=v1(p,a,u),R=b3(g);let{move:F=!0,reverse:U}=u||{},Y,it,ct;for(Y=0;Y<=I;++Y)it=p[(r+(U?I-Y:Y))%v],!it.skip&&(F?(o.moveTo(it.x,it.y),F=!1):R(o,ct,it,U,g.stepped),ct=it);return T&&(it=p[(r+(U?I:0))%v],R(o,ct,it,U,g.stepped)),!!T}function T3(o,s,a,u){const p=s.points,{count:g,start:v,ilen:r}=v1(p,a,u),{move:T=!0,reverse:I}=u||{};let R=0,F=0,U,Y,it,ct,ht,bt;const Dt=Wt=>(v+(I?r-Wt:Wt))%g,Ft=()=>{ct!==ht&&(o.lineTo(R,ht),o.lineTo(R,ct),o.lineTo(R,bt))};for(T&&(Y=p[Dt(0)],o.moveTo(Y.x,Y.y)),U=0;U<=r;++U){if(Y=p[Dt(U)],Y.skip)continue;const Wt=Y.x,Rt=Y.y,Jt=Wt|0;Jt===it?(Rt<ct?ct=Rt:Rt>ht&&(ht=Rt),R=(F*R+Wt)/++F):(Ft(),o.lineTo(Wt,Rt),it=Jt,F=0,ct=ht=Rt),bt=Rt}Ft()}function q_(o){const s=o.options,a=s.borderDash&&s.borderDash.length;return!o._decimated&&!o._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!a?T3:w3}function E3(o){return o.stepped?TT:o.tension||o.cubicInterpolationMode==="monotone"?ET:Ra}function S3(o,s,a,u){let p=s._path;p||(p=s._path=new Path2D,s.path(p,a,u)&&p.closePath()),x1(o,s.options),o.stroke(p)}function M3(o,s,a,u){const{segments:p,options:g}=s,v=q_(s);for(const r of p)x1(o,g,r.style),o.beginPath(),v(o,s,r,{start:a,end:a+u-1})&&o.closePath(),o.stroke()}const A3=typeof Path2D=="function";function C3(o,s,a,u){A3&&!s.options.segment?S3(o,s,a,u):M3(o,s,a,u)}class Co extends Zs{constructor(s){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,s&&Object.assign(this,s)}updateControlPoints(s,a){const u=this.options;if((u.tension||u.cubicInterpolationMode==="monotone")&&!u.stepped&&!this._pointsUpdated){const p=u.spanGaps?this._loop:this._fullLoop;_T(this._points,u,s,p,a),this._pointsUpdated=!0}}set points(s){this._points=s,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=PT(this,this.options.segment))}first(){const s=this.segments,a=this.points;return s.length&&a[s[0].start]}last(){const s=this.segments,a=this.points,u=s.length;return u&&a[s[u-1].end]}interpolate(s,a){const u=this.options,p=s[a],g=this.points,v=o1(this,{property:a,start:p,end:p});if(!v.length)return;const r=[],T=E3(u);let I,R;for(I=0,R=v.length;I<R;++I){const{start:F,end:U}=v[I],Y=g[F],it=g[U];if(Y===it){r.push(Y);continue}const ct=Math.abs((p-Y[a])/(it[a]-Y[a])),ht=T(Y,it,ct,u.stepped);ht[a]=s[a],r.push(ht)}return r.length===1?r[0]:r}pathSegment(s,a,u){return q_(this)(s,this,a,u)}path(s,a,u){const p=this.segments,g=q_(this);let v=this._loop;a=a||0,u=u||this.points.length-a;for(const r of p)v&=g(s,this,r,{start:a,end:a+u-1});return!!v}draw(s,a,u,p){const g=this.options||{};(this.points||[]).length&&g.borderWidth&&(s.save(),C3(s,this,u,p),s.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}ue(Co,"id","line"),ue(Co,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),ue(Co,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),ue(Co,"descriptors",{_scriptable:!0,_indexable:s=>s!=="borderDash"&&s!=="fill"});function Yy(o,s,a,u){const p=o.options,{[a]:g}=o.getProps([a],u);return Math.abs(s-g)<p.radius+p.hitRadius}class cp extends Zs{constructor(a){super();ue(this,"parsed");ue(this,"skip");ue(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,a&&Object.assign(this,a)}inRange(a,u,p){const g=this.options,{x:v,y:r}=this.getProps(["x","y"],p);return Math.pow(a-v,2)+Math.pow(u-r,2)<Math.pow(g.hitRadius+g.radius,2)}inXRange(a,u){return Yy(this,a,"x",u)}inYRange(a,u){return Yy(this,a,"y",u)}getCenterPoint(a){const{x:u,y:p}=this.getProps(["x","y"],a);return{x:u,y:p}}size(a){a=a||this.options||{};let u=a.radius||0;u=Math.max(u,u&&a.hoverRadius||0);const p=u&&a.borderWidth||0;return(u+p)*2}draw(a,u){const p=this.options;this.skip||p.radius<.1||!jr(this,u,this.size(p)/2)||(a.strokeStyle=p.borderColor,a.lineWidth=p.borderWidth,a.fillStyle=p.backgroundColor,j_(a,p,this.x,this.y))}getRange(){const a=this.options||{};return a.radius+a.hitRadius}}ue(cp,"id","point"),ue(cp,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),ue(cp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function b1(o,s){const{x:a,y:u,base:p,width:g,height:v}=o.getProps(["x","y","base","width","height"],s);let r,T,I,R,F;return o.horizontal?(F=v/2,r=Math.min(a,p),T=Math.max(a,p),I=u-F,R=u+F):(F=g/2,r=a-F,T=a+F,I=Math.min(u,p),R=Math.max(u,p)),{left:r,top:I,right:T,bottom:R}}function Io(o,s,a,u){return o?0:mn(s,a,u)}function I3(o,s,a){const u=o.options.borderWidth,p=o.borderSkipped,g=Hx(u);return{t:Io(p.top,g.top,0,a),r:Io(p.right,g.right,0,s),b:Io(p.bottom,g.bottom,0,a),l:Io(p.left,g.left,0,s)}}function P3(o,s,a){const{enableBorderRadius:u}=o.getProps(["enableBorderRadius"]),p=o.options.borderRadius,g=Fa(p),v=Math.min(s,a),r=o.borderSkipped,T=u||Ye(p);return{topLeft:Io(!T||r.top||r.left,g.topLeft,0,v),topRight:Io(!T||r.top||r.right,g.topRight,0,v),bottomLeft:Io(!T||r.bottom||r.left,g.bottomLeft,0,v),bottomRight:Io(!T||r.bottom||r.right,g.bottomRight,0,v)}}function k3(o){const s=b1(o),a=s.right-s.left,u=s.bottom-s.top,p=I3(o,a/2,u/2),g=P3(o,a/2,u/2);return{outer:{x:s.left,y:s.top,w:a,h:u,radius:g},inner:{x:s.left+p.l,y:s.top+p.t,w:a-p.l-p.r,h:u-p.t-p.b,radius:{topLeft:Math.max(0,g.topLeft-Math.max(p.t,p.l)),topRight:Math.max(0,g.topRight-Math.max(p.t,p.r)),bottomLeft:Math.max(0,g.bottomLeft-Math.max(p.b,p.l)),bottomRight:Math.max(0,g.bottomRight-Math.max(p.b,p.r))}}}}function S_(o,s,a,u){const p=s===null,g=a===null,r=o&&!(p&&g)&&b1(o,u);return r&&(p||Fr(s,r.left,r.right))&&(g||Fr(a,r.top,r.bottom))}function D3(o){return o.topLeft||o.topRight||o.bottomLeft||o.bottomRight}function L3(o,s){o.rect(s.x,s.y,s.w,s.h)}function M_(o,s,a={}){const u=o.x!==a.x?-s:0,p=o.y!==a.y?-s:0,g=(o.x+o.w!==a.x+a.w?s:0)-u,v=(o.y+o.h!==a.y+a.h?s:0)-p;return{x:o.x+u,y:o.y+p,w:o.w+g,h:o.h+v,radius:o.radius}}class hp extends Zs{constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){const{inflateAmount:a,options:{borderColor:u,backgroundColor:p}}=this,{inner:g,outer:v}=k3(this),r=D3(v.radius)?ru:L3;s.save(),(v.w!==g.w||v.h!==g.h)&&(s.beginPath(),r(s,M_(v,a,g)),s.clip(),r(s,M_(g,-a,v)),s.fillStyle=u,s.fill("evenodd")),s.beginPath(),r(s,M_(g,a)),s.fillStyle=p,s.fill(),s.restore()}inRange(s,a,u){return S_(this,s,a,u)}inXRange(s,a){return S_(this,s,null,a)}inYRange(s,a){return S_(this,null,s,a)}getCenterPoint(s){const{x:a,y:u,base:p,horizontal:g}=this.getProps(["x","y","base","horizontal"],s);return{x:g?(a+p)/2:a,y:g?u:(u+p)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}}ue(hp,"id","bar"),ue(hp,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),ue(hp,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var z3=Object.freeze({__proto__:null,ArcElement:$h,BarElement:hp,LineElement:Co,PointElement:cp});const $_=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Ky=$_.map(o=>o.replace("rgb(","rgba(").replace(")",", 0.5)"));function w1(o){return $_[o%$_.length]}function T1(o){return Ky[o%Ky.length]}function R3(o,s){return o.borderColor=w1(s),o.backgroundColor=T1(s),++s}function O3(o,s){return o.backgroundColor=o.data.map(()=>w1(s++)),s}function B3(o,s){return o.backgroundColor=o.data.map(()=>T1(s++)),s}function F3(o){let s=0;return(a,u)=>{const p=o.getDatasetMeta(u).controller;p instanceof Ba?s=O3(a,s):p instanceof tu?s=B3(a,s):p&&(s=R3(a,s))}}function Jy(o){let s;for(s in o)if(o[s].borderColor||o[s].backgroundColor)return!0;return!1}function N3(o){return o&&(o.borderColor||o.backgroundColor)}var j3={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(o,s,a){if(!a.enabled)return;const{data:{datasets:u},options:p}=o.config,{elements:g}=p;if(!a.forceOverride&&(Jy(u)||N3(p)||g&&Jy(g)))return;const v=F3(o);u.forEach(v)}};function V3(o,s,a,u,p){const g=p.samples||u;if(g>=a)return o.slice(s,s+a);const v=[],r=(a-2)/(g-2);let T=0;const I=s+a-1;let R=s,F,U,Y,it,ct;for(v[T++]=o[R],F=0;F<g-2;F++){let ht=0,bt=0,Dt;const Ft=Math.floor((F+1)*r)+1+s,Wt=Math.min(Math.floor((F+2)*r)+1,a)+s,Rt=Wt-Ft;for(Dt=Ft;Dt<Wt;Dt++)ht+=o[Dt].x,bt+=o[Dt].y;ht/=Rt,bt/=Rt;const Jt=Math.floor(F*r)+1+s,ne=Math.min(Math.floor((F+1)*r)+1,a)+s,{x:se,y:Lt}=o[R];for(Y=it=-1,Dt=Jt;Dt<ne;Dt++)it=.5*Math.abs((se-ht)*(o[Dt].y-Lt)-(se-o[Dt].x)*(bt-Lt)),it>Y&&(Y=it,U=o[Dt],ct=Dt);v[T++]=U,R=ct}return v[T++]=o[I],v}function U3(o,s,a,u){let p=0,g=0,v,r,T,I,R,F,U,Y,it,ct;const ht=[],bt=s+a-1,Dt=o[s].x,Wt=o[bt].x-Dt;for(v=s;v<s+a;++v){r=o[v],T=(r.x-Dt)/Wt*u,I=r.y;const Rt=T|0;if(Rt===R)I<it?(it=I,F=v):I>ct&&(ct=I,U=v),p=(g*p+r.x)/++g;else{const Jt=v-1;if(!ti(F)&&!ti(U)){const ne=Math.min(F,U),se=Math.max(F,U);ne!==Y&&ne!==Jt&&ht.push({...o[ne],x:p}),se!==Y&&se!==Jt&&ht.push({...o[se],x:p})}v>0&&Jt!==Y&&ht.push(o[Jt]),ht.push(r),R=Rt,g=0,it=ct=I,F=U=Y=v}}return ht}function E1(o){if(o._decimated){const s=o._data;delete o._decimated,delete o._data,Object.defineProperty(o,"data",{configurable:!0,enumerable:!0,writable:!0,value:s})}}function Qy(o){o.data.datasets.forEach(s=>{E1(s)})}function G3(o,s){const a=s.length;let u=0,p;const{iScale:g}=o,{min:v,max:r,minDefined:T,maxDefined:I}=g.getUserBounds();return T&&(u=mn(Nr(s,g.axis,v).lo,0,a-1)),I?p=mn(Nr(s,g.axis,r).hi+1,u,a)-u:p=a-u,{start:u,count:p}}var q3={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(o,s,a)=>{if(!a.enabled){Qy(o);return}const u=o.width;o.data.datasets.forEach((p,g)=>{const{_data:v,indexAxis:r}=p,T=o.getDatasetMeta(g),I=v||p.data;if(Gh([r,o.options.indexAxis])==="y"||!T.controller.supportsDecimation)return;const R=o.scales[T.xAxisID];if(R.type!=="linear"&&R.type!=="time"||o.options.parsing)return;let{start:F,count:U}=G3(T,I);const Y=a.threshold||4*u;if(U<=Y){E1(p);return}ti(v)&&(p._data=I,delete p.data,Object.defineProperty(p,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(ct){this._data=ct}}));let it;switch(a.algorithm){case"lttb":it=V3(I,F,U,u,a);break;case"min-max":it=U3(I,F,U,u);break;default:throw new Error(`Unsupported decimation algorithm '${a.algorithm}'`)}p._decimated=it})},destroy(o){Qy(o)}};function $3(o,s,a){const u=o.segments,p=o.points,g=s.points,v=[];for(const r of u){let{start:T,end:I}=r;I=_m(T,I,p);const R=W_(a,p[T],p[I],r.loop);if(!s.segments){v.push({source:r,target:R,start:p[T],end:p[I]});continue}const F=o1(s,R);for(const U of F){const Y=W_(a,g[U.start],g[U.end],U.loop),it=r1(r,p,Y);for(const ct of it)v.push({source:ct,target:U,start:{[a]:tx(R,Y,"start",Math.max)},end:{[a]:tx(R,Y,"end",Math.min)}})}}return v}function W_(o,s,a,u){if(u)return;let p=s[o],g=a[o];return o==="angle"&&(p=ls(p),g=ls(g)),{property:o,start:p,end:g}}function W3(o,s){const{x:a=null,y:u=null}=o||{},p=s.points,g=[];return s.segments.forEach(({start:v,end:r})=>{r=_m(v,r,p);const T=p[v],I=p[r];u!==null?(g.push({x:T.x,y:u}),g.push({x:I.x,y:u})):a!==null&&(g.push({x:a,y:T.y}),g.push({x:a,y:I.y}))}),g}function _m(o,s,a){for(;s>o;s--){const u=a[s];if(!isNaN(u.x)&&!isNaN(u.y))break}return s}function tx(o,s,a,u){return o&&s?u(o[a],s[a]):o?o[a]:s?s[a]:0}function S1(o,s){let a=[],u=!1;return zi(o)?(u=!0,a=o):a=W3(o,s),a.length?new Co({points:a,options:{tension:0},_loop:u,_fullLoop:u}):null}function ex(o){return o&&o.fill!==!1}function Z3(o,s,a){let p=o[s].fill;const g=[s];let v;if(!a)return p;for(;p!==!1&&g.indexOf(p)===-1;){if(!Yi(p))return p;if(v=o[p],!v)return!1;if(v.visible)return p;g.push(p),p=v.fill}return!1}function H3(o,s,a){const u=J3(o);if(Ye(u))return isNaN(u.value)?!1:u;let p=parseFloat(u);return Yi(p)&&Math.floor(p)===p?X3(u[0],s,p,a):["origin","start","end","stack","shape"].indexOf(u)>=0&&u}function X3(o,s,a,u){return(o==="-"||o==="+")&&(a=s+a),a===s||a<0||a>=u?!1:a}function Y3(o,s){let a=null;return o==="start"?a=s.bottom:o==="end"?a=s.top:Ye(o)?a=s.getPixelForValue(o.value):s.getBasePixel&&(a=s.getBasePixel()),a}function K3(o,s,a){let u;return o==="start"?u=a:o==="end"?u=s.options.reverse?s.min:s.max:Ye(o)?u=o.value:u=s.getBaseValue(),u}function J3(o){const s=o.options,a=s.fill;let u=Ve(a&&a.target,a);return u===void 0&&(u=!!s.backgroundColor),u===!1||u===null?!1:u===!0?"origin":u}function Q3(o){const{scale:s,index:a,line:u}=o,p=[],g=u.segments,v=u.points,r=tS(s,a);r.push(S1({x:null,y:s.bottom},u));for(let T=0;T<g.length;T++){const I=g[T];for(let R=I.start;R<=I.end;R++)eS(p,v[R],r)}return new Co({points:p,options:{}})}function tS(o,s){const a=[],u=o.getMatchingVisibleMetas("line");for(let p=0;p<u.length;p++){const g=u[p];if(g.index===s)break;g.hidden||a.unshift(g.dataset)}return a}function eS(o,s,a){const u=[];for(let p=0;p<a.length;p++){const g=a[p],{first:v,last:r,point:T}=iS(g,s,"x");if(!(!T||v&&r)){if(v)u.unshift(T);else if(o.push(T),!r)break}}o.push(...u)}function iS(o,s,a){const u=o.interpolate(s,a);if(!u)return{};const p=u[a],g=o.segments,v=o.points;let r=!1,T=!1;for(let I=0;I<g.length;I++){const R=g[I],F=v[R.start][a],U=v[R.end][a];if(Fr(p,F,U)){r=p===F,T=p===U;break}}return{first:r,last:T,point:u}}class M1{constructor(s){this.x=s.x,this.y=s.y,this.radius=s.radius}pathSegment(s,a,u){const{x:p,y:g,radius:v}=this;return a=a||{start:0,end:Ri},s.arc(p,g,v,a.end,a.start,!0),!u.bounds}interpolate(s){const{x:a,y:u,radius:p}=this,g=s.angle;return{x:a+Math.cos(g)*p,y:u+Math.sin(g)*p,angle:g}}}function nS(o){const{chart:s,fill:a,line:u}=o;if(Yi(a))return sS(s,a);if(a==="stack")return Q3(o);if(a==="shape")return!0;const p=rS(o);return p instanceof M1?p:S1(p,u)}function sS(o,s){const a=o.getDatasetMeta(s);return a&&o.isDatasetVisible(s)?a.dataset:null}function rS(o){return(o.scale||{}).getPointPositionForValue?aS(o):oS(o)}function oS(o){const{scale:s={},fill:a}=o,u=Y3(a,s);if(Yi(u)){const p=s.isHorizontal();return{x:p?u:null,y:p?null:u}}return null}function aS(o){const{scale:s,fill:a}=o,u=s.options,p=s.getLabels().length,g=u.reverse?s.max:s.min,v=K3(a,s,g),r=[];if(u.grid.circular){const T=s.getPointPositionForValue(0,g);return new M1({x:T.x,y:T.y,radius:s.getDistanceFromCenterForValue(v)})}for(let T=0;T<p;++T)r.push(s.getPointPositionForValue(T,v));return r}function A_(o,s,a){const u=nS(s),{line:p,scale:g,axis:v}=s,r=p.options,T=r.fill,I=r.backgroundColor,{above:R=I,below:F=I}=T||{};u&&p.points.length&&(Pp(o,a),lS(o,{line:p,target:u,above:R,below:F,area:a,scale:g,axis:v}),kp(o))}function lS(o,s){const{line:a,target:u,above:p,below:g,area:v,scale:r}=s,T=a._loop?"angle":s.axis;o.save(),T==="x"&&g!==p&&(ix(o,u,v.top),nx(o,{line:a,target:u,color:p,scale:r,property:T}),o.restore(),o.save(),ix(o,u,v.bottom)),nx(o,{line:a,target:u,color:g,scale:r,property:T}),o.restore()}function ix(o,s,a){const{segments:u,points:p}=s;let g=!0,v=!1;o.beginPath();for(const r of u){const{start:T,end:I}=r,R=p[T],F=p[_m(T,I,p)];g?(o.moveTo(R.x,R.y),g=!1):(o.lineTo(R.x,a),o.lineTo(R.x,R.y)),v=!!s.pathSegment(o,r,{move:v}),v?o.closePath():o.lineTo(F.x,a)}o.lineTo(s.first().x,a),o.closePath(),o.clip()}function nx(o,s){const{line:a,target:u,property:p,color:g,scale:v}=s,r=$3(a,u,p);for(const{source:T,target:I,start:R,end:F}of r){const{style:{backgroundColor:U=g}={}}=T,Y=u!==!0;o.save(),o.fillStyle=U,cS(o,v,Y&&W_(p,R,F)),o.beginPath();const it=!!a.pathSegment(o,T);let ct;if(Y){it?o.closePath():sx(o,u,F,p);const ht=!!u.pathSegment(o,I,{move:it,reverse:!0});ct=it&&ht,ct||sx(o,u,R,p)}o.closePath(),o.fill(ct?"evenodd":"nonzero"),o.restore()}}function cS(o,s,a){const{top:u,bottom:p}=s.chart.chartArea,{property:g,start:v,end:r}=a||{};g==="x"&&(o.beginPath(),o.rect(v,u,r-v,p-u),o.clip())}function sx(o,s,a,u){const p=s.interpolate(a,u);p&&o.lineTo(p.x,p.y)}var hS={id:"filler",afterDatasetsUpdate(o,s,a){const u=(o.data.datasets||[]).length,p=[];let g,v,r,T;for(v=0;v<u;++v)g=o.getDatasetMeta(v),r=g.dataset,T=null,r&&r.options&&r instanceof Co&&(T={visible:o.isDatasetVisible(v),index:v,fill:H3(r,v,u),chart:o,axis:g.controller.options.indexAxis,scale:g.vScale,line:r}),g.$filler=T,p.push(T);for(v=0;v<u;++v)T=p[v],!(!T||T.fill===!1)&&(T.fill=Z3(p,v,a.propagate))},beforeDraw(o,s,a){const u=a.drawTime==="beforeDraw",p=o.getSortedVisibleDatasetMetas(),g=o.chartArea;for(let v=p.length-1;v>=0;--v){const r=p[v].$filler;r&&(r.line.updateControlPoints(g,r.axis),u&&r.fill&&A_(o.ctx,r,g))}},beforeDatasetsDraw(o,s,a){if(a.drawTime!=="beforeDatasetsDraw")return;const u=o.getSortedVisibleDatasetMetas();for(let p=u.length-1;p>=0;--p){const g=u[p].$filler;ex(g)&&A_(o.ctx,g,o.chartArea)}},beforeDatasetDraw(o,s,a){const u=s.meta.$filler;!ex(u)||a.drawTime!=="beforeDatasetDraw"||A_(o.ctx,u,o.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const rx=(o,s)=>{let{boxHeight:a=s,boxWidth:u=s}=o;return o.usePointStyle&&(a=Math.min(a,s),u=o.pointStyleWidth||Math.min(u,s)),{boxWidth:u,boxHeight:a,itemHeight:Math.max(s,a)}},uS=(o,s)=>o!==null&&s!==null&&o.datasetIndex===s.datasetIndex&&o.index===s.index;class ox extends Zs{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,a,u){this.maxWidth=s,this.maxHeight=a,this._margins=u,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const s=this.options.labels||{};let a=Ci(s.generateLabels,[this.chart],this)||[];s.filter&&(a=a.filter(u=>s.filter(u,this.chart.data))),s.sort&&(a=a.sort((u,p)=>s.sort(u,p,this.chart.data))),this.options.reverse&&a.reverse(),this.legendItems=a}fit(){const{options:s,ctx:a}=this;if(!s.display){this.width=this.height=0;return}const u=s.labels,p=hn(u.font),g=p.size,v=this._computeTitleHeight(),{boxWidth:r,itemHeight:T}=rx(u,g);let I,R;a.font=p.string,this.isHorizontal()?(I=this.maxWidth,R=this._fitRows(v,g,r,T)+10):(R=this.maxHeight,I=this._fitCols(v,p,r,T)+10),this.width=Math.min(I,s.maxWidth||this.maxWidth),this.height=Math.min(R,s.maxHeight||this.maxHeight)}_fitRows(s,a,u,p){const{ctx:g,maxWidth:v,options:{labels:{padding:r}}}=this,T=this.legendHitBoxes=[],I=this.lineWidths=[0],R=p+r;let F=s;g.textAlign="left",g.textBaseline="middle";let U=-1,Y=-R;return this.legendItems.forEach((it,ct)=>{const ht=u+a/2+g.measureText(it.text).width;(ct===0||I[I.length-1]+ht+2*r>v)&&(F+=R,I[I.length-(ct>0?0:1)]=0,Y+=R,U++),T[ct]={left:0,top:Y,row:U,width:ht,height:p},I[I.length-1]+=ht+r}),F}_fitCols(s,a,u,p){const{ctx:g,maxHeight:v,options:{labels:{padding:r}}}=this,T=this.legendHitBoxes=[],I=this.columnSizes=[],R=v-s;let F=r,U=0,Y=0,it=0,ct=0;return this.legendItems.forEach((ht,bt)=>{const{itemWidth:Dt,itemHeight:Ft}=dS(u,a,g,ht,p);bt>0&&Y+Ft+2*r>R&&(F+=U+r,I.push({width:U,height:Y}),it+=U+r,ct++,U=Y=0),T[bt]={left:it,top:Y,col:ct,width:Dt,height:Ft},U=Math.max(U,Dt),Y+=Ft+r}),F+=U,I.push({width:U,height:Y}),F}adjustHitBoxes(){if(!this.options.display)return;const s=this._computeTitleHeight(),{legendHitBoxes:a,options:{align:u,labels:{padding:p},rtl:g}}=this,v=Hl(g,this.left,this.width);if(this.isHorizontal()){let r=0,T=Pn(u,this.left+p,this.right-this.lineWidths[r]);for(const I of a)r!==I.row&&(r=I.row,T=Pn(u,this.left+p,this.right-this.lineWidths[r])),I.top+=this.top+s+p,I.left=v.leftForLtr(v.x(T),I.width),T+=I.width+p}else{let r=0,T=Pn(u,this.top+s+p,this.bottom-this.columnSizes[r].height);for(const I of a)I.col!==r&&(r=I.col,T=Pn(u,this.top+s+p,this.bottom-this.columnSizes[r].height)),I.top=T,I.left+=this.left+p,I.left=v.leftForLtr(v.x(I.left),I.width),T+=I.height+p}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const s=this.ctx;Pp(s,this),this._draw(),kp(s)}}_draw(){const{options:s,columnSizes:a,lineWidths:u,ctx:p}=this,{align:g,labels:v}=s,r=Ki.color,T=Hl(s.rtl,this.left,this.width),I=hn(v.font),{padding:R}=v,F=I.size,U=F/2;let Y;this.drawTitle(),p.textAlign=T.textAlign("left"),p.textBaseline="middle",p.lineWidth=.5,p.font=I.string;const{boxWidth:it,boxHeight:ct,itemHeight:ht}=rx(v,F),bt=function(Jt,ne,se){if(isNaN(it)||it<=0||isNaN(ct)||ct<0)return;p.save();const Lt=Ve(se.lineWidth,1);if(p.fillStyle=Ve(se.fillStyle,r),p.lineCap=Ve(se.lineCap,"butt"),p.lineDashOffset=Ve(se.lineDashOffset,0),p.lineJoin=Ve(se.lineJoin,"miter"),p.lineWidth=Lt,p.strokeStyle=Ve(se.strokeStyle,r),p.setLineDash(Ve(se.lineDash,[])),v.usePointStyle){const Le={radius:ct*Math.SQRT2/2,pointStyle:se.pointStyle,rotation:se.rotation,borderWidth:Lt},ze=T.xPlus(Jt,it/2),fe=ne+U;Zx(p,Le,ze,fe,v.pointStyleWidth&&it)}else{const Le=ne+Math.max((F-ct)/2,0),ze=T.leftForLtr(Jt,it),fe=Fa(se.borderRadius);p.beginPath(),Object.values(fe).some(Ge=>Ge!==0)?ru(p,{x:ze,y:Le,w:it,h:ct,radius:fe}):p.rect(ze,Le,it,ct),p.fill(),Lt!==0&&p.stroke()}p.restore()},Dt=function(Jt,ne,se){Va(p,se.text,Jt,ne+ht/2,I,{strikethrough:se.hidden,textAlign:T.textAlign(se.textAlign)})},Ft=this.isHorizontal(),Wt=this._computeTitleHeight();Ft?Y={x:Pn(g,this.left+R,this.right-u[0]),y:this.top+R+Wt,line:0}:Y={x:this.left+R,y:Pn(g,this.top+Wt+R,this.bottom-a[0].height),line:0},i1(this.ctx,s.textDirection);const Rt=ht+R;this.legendItems.forEach((Jt,ne)=>{p.strokeStyle=Jt.fontColor,p.fillStyle=Jt.fontColor;const se=p.measureText(Jt.text).width,Lt=T.textAlign(Jt.textAlign||(Jt.textAlign=v.textAlign)),Le=it+U+se;let ze=Y.x,fe=Y.y;T.setWidth(this.width),Ft?ne>0&&ze+Le+R>this.right&&(fe=Y.y+=Rt,Y.line++,ze=Y.x=Pn(g,this.left+R,this.right-u[Y.line])):ne>0&&fe+Rt>this.bottom&&(ze=Y.x=ze+a[Y.line].width+R,Y.line++,fe=Y.y=Pn(g,this.top+Wt+R,this.bottom-a[Y.line].height));const Ge=T.x(ze);if(bt(Ge,fe,Jt),ze=L2(Lt,ze+it+U,Ft?ze+Le:this.right,s.rtl),Dt(T.x(ze),fe,Jt),Ft)Y.x+=Le+R;else if(typeof Jt.text!="string"){const on=I.lineHeight;Y.y+=A1(Jt,on)+R}else Y.y+=Rt}),n1(this.ctx,s.textDirection)}drawTitle(){const s=this.options,a=s.title,u=hn(a.font),p=Dn(a.padding);if(!a.display)return;const g=Hl(s.rtl,this.left,this.width),v=this.ctx,r=a.position,T=u.size/2,I=p.top+T;let R,F=this.left,U=this.width;if(this.isHorizontal())U=Math.max(...this.lineWidths),R=this.top+I,F=Pn(s.align,F,this.right-U);else{const it=this.columnSizes.reduce((ct,ht)=>Math.max(ct,ht.height),0);R=I+Pn(s.align,this.top,this.bottom-it-s.labels.padding-this._computeTitleHeight())}const Y=Pn(r,F,F+U);v.textAlign=g.textAlign(am(r)),v.textBaseline="middle",v.strokeStyle=a.color,v.fillStyle=a.color,v.font=u.string,Va(v,a.text,Y,R,u)}_computeTitleHeight(){const s=this.options.title,a=hn(s.font),u=Dn(s.padding);return s.display?a.lineHeight+u.height:0}_getLegendItemAt(s,a){let u,p,g;if(Fr(s,this.left,this.right)&&Fr(a,this.top,this.bottom)){for(g=this.legendHitBoxes,u=0;u<g.length;++u)if(p=g[u],Fr(s,p.left,p.left+p.width)&&Fr(a,p.top,p.top+p.height))return this.legendItems[u]}return null}handleEvent(s){const a=this.options;if(!_S(s.type,a))return;const u=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){const p=this._hoveredItem,g=uS(p,u);p&&!g&&Ci(a.onLeave,[s,p,this],this),this._hoveredItem=u,u&&!g&&Ci(a.onHover,[s,u,this],this)}else u&&Ci(a.onClick,[s,u,this],this)}}function dS(o,s,a,u,p){const g=pS(u,o,s,a),v=fS(p,u,s.lineHeight);return{itemWidth:g,itemHeight:v}}function pS(o,s,a,u){let p=o.text;return p&&typeof p!="string"&&(p=p.reduce((g,v)=>g.length>v.length?g:v)),s+a.size/2+u.measureText(p).width}function fS(o,s,a){let u=o;return typeof s.text!="string"&&(u=A1(s,a)),u}function A1(o,s){const a=o.text?o.text.length:0;return s*a}function _S(o,s){return!!((o==="mousemove"||o==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(o==="click"||o==="mouseup"))}var mS={id:"legend",_element:ox,start(o,s,a){const u=o.legend=new ox({ctx:o.ctx,options:a,chart:o});kn.configure(o,u,a),kn.addBox(o,u)},stop(o){kn.removeBox(o,o.legend),delete o.legend},beforeUpdate(o,s,a){const u=o.legend;kn.configure(o,u,a),u.options=a},afterUpdate(o){const s=o.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(o,s){s.replay||o.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(o,s,a){const u=s.datasetIndex,p=a.chart;p.isDatasetVisible(u)?(p.hide(u),s.hidden=!0):(p.show(u),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:o=>o.chart.options.color,boxWidth:40,padding:10,generateLabels(o){const s=o.data.datasets,{labels:{usePointStyle:a,pointStyle:u,textAlign:p,color:g,useBorderRadius:v,borderRadius:r}}=o.legend.options;return o._getSortedDatasetMetas().map(T=>{const I=T.controller.getStyle(a?0:void 0),R=Dn(I.borderWidth);return{text:s[T.index].label,fillStyle:I.backgroundColor,fontColor:g,hidden:!T.visible,lineCap:I.borderCapStyle,lineDash:I.borderDash,lineDashOffset:I.borderDashOffset,lineJoin:I.borderJoinStyle,lineWidth:(R.width+R.height)/4,strokeStyle:I.borderColor,pointStyle:u||I.pointStyle,rotation:I.rotation,textAlign:p||I.textAlign,borderRadius:v&&(r||I.borderRadius),datasetIndex:T.index}},this)}},title:{color:o=>o.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:o=>!o.startsWith("on"),labels:{_scriptable:o=>!["generateLabels","filter","sort"].includes(o)}}};class mm extends Zs{constructor(s){super(),this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,a){const u=this.options;if(this.left=0,this.top=0,!u.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=s,this.height=this.bottom=a;const p=zi(u.text)?u.text.length:1;this._padding=Dn(u.padding);const g=p*hn(u.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=g:this.width=g}isHorizontal(){const s=this.options.position;return s==="top"||s==="bottom"}_drawArgs(s){const{top:a,left:u,bottom:p,right:g,options:v}=this,r=v.align;let T=0,I,R,F;return this.isHorizontal()?(R=Pn(r,u,g),F=a+s,I=g-u):(v.position==="left"?(R=u+s,F=Pn(r,p,a),T=Oi*-.5):(R=g-s,F=Pn(r,a,p),T=Oi*.5),I=p-a),{titleX:R,titleY:F,maxWidth:I,rotation:T}}draw(){const s=this.ctx,a=this.options;if(!a.display)return;const u=hn(a.font),g=u.lineHeight/2+this._padding.top,{titleX:v,titleY:r,maxWidth:T,rotation:I}=this._drawArgs(g);Va(s,a.text,0,0,u,{color:a.color,maxWidth:T,rotation:I,textAlign:am(a.align),textBaseline:"middle",translation:[v,r]})}}function gS(o,s){const a=new mm({ctx:o.ctx,options:s,chart:o});kn.configure(o,a,s),kn.addBox(o,a),o.titleBlock=a}var yS={id:"title",_element:mm,start(o,s,a){gS(o,a)},stop(o){const s=o.titleBlock;kn.removeBox(o,s),delete o.titleBlock},beforeUpdate(o,s,a){const u=o.titleBlock;kn.configure(o,u,a),u.options=a},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Yd=new WeakMap;var xS={id:"subtitle",start(o,s,a){const u=new mm({ctx:o.ctx,options:a,chart:o});kn.configure(o,u,a),kn.addBox(o,u),Yd.set(o,u)},stop(o){kn.removeBox(o,Yd.get(o)),Yd.delete(o)},beforeUpdate(o,s,a){const u=Yd.get(o);kn.configure(o,u,a),u.options=a},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Wh={average(o){if(!o.length)return!1;let s,a,u=0,p=0,g=0;for(s=0,a=o.length;s<a;++s){const v=o[s].element;if(v&&v.hasValue()){const r=v.tooltipPosition();u+=r.x,p+=r.y,++g}}return{x:u/g,y:p/g}},nearest(o,s){if(!o.length)return!1;let a=s.x,u=s.y,p=Number.POSITIVE_INFINITY,g,v,r;for(g=0,v=o.length;g<v;++g){const T=o[g].element;if(T&&T.hasValue()){const I=T.getCenterPoint(),R=F_(s,I);R<p&&(p=R,r=T)}}if(r){const T=r.tooltipPosition();a=T.x,u=T.y}return{x:a,y:u}}};function lr(o,s){return s&&(zi(s)?Array.prototype.push.apply(o,s):o.push(s)),o}function Or(o){return(typeof o=="string"||o instanceof String)&&o.indexOf(`
`)>-1?o.split(`
`):o}function vS(o,s){const{element:a,datasetIndex:u,index:p}=s,g=o.getDatasetMeta(u).controller,{label:v,value:r}=g.getLabelAndValue(p);return{chart:o,label:v,parsed:g.getParsed(p),raw:o.data.datasets[u].data[p],formattedValue:r,dataset:g.getDataset(),dataIndex:p,datasetIndex:u,element:a}}function ax(o,s){const a=o.chart.ctx,{body:u,footer:p,title:g}=o,{boxWidth:v,boxHeight:r}=s,T=hn(s.bodyFont),I=hn(s.titleFont),R=hn(s.footerFont),F=g.length,U=p.length,Y=u.length,it=Dn(s.padding);let ct=it.height,ht=0,bt=u.reduce((Wt,Rt)=>Wt+Rt.before.length+Rt.lines.length+Rt.after.length,0);if(bt+=o.beforeBody.length+o.afterBody.length,F&&(ct+=F*I.lineHeight+(F-1)*s.titleSpacing+s.titleMarginBottom),bt){const Wt=s.displayColors?Math.max(r,T.lineHeight):T.lineHeight;ct+=Y*Wt+(bt-Y)*T.lineHeight+(bt-1)*s.bodySpacing}U&&(ct+=s.footerMarginTop+U*R.lineHeight+(U-1)*s.footerSpacing);let Dt=0;const Ft=function(Wt){ht=Math.max(ht,a.measureText(Wt).width+Dt)};return a.save(),a.font=I.string,yi(o.title,Ft),a.font=T.string,yi(o.beforeBody.concat(o.afterBody),Ft),Dt=s.displayColors?v+2+s.boxPadding:0,yi(u,Wt=>{yi(Wt.before,Ft),yi(Wt.lines,Ft),yi(Wt.after,Ft)}),Dt=0,a.font=R.string,yi(o.footer,Ft),a.restore(),ht+=it.width,{width:ht,height:ct}}function bS(o,s){const{y:a,height:u}=s;return a<u/2?"top":a>o.height-u/2?"bottom":"center"}function wS(o,s,a,u){const{x:p,width:g}=u,v=a.caretSize+a.caretPadding;if(o==="left"&&p+g+v>s.width||o==="right"&&p-g-v<0)return!0}function TS(o,s,a,u){const{x:p,width:g}=a,{width:v,chartArea:{left:r,right:T}}=o;let I="center";return u==="center"?I=p<=(r+T)/2?"left":"right":p<=g/2?I="left":p>=v-g/2&&(I="right"),wS(I,o,s,a)&&(I="center"),I}function lx(o,s,a){const u=a.yAlign||s.yAlign||bS(o,a);return{xAlign:a.xAlign||s.xAlign||TS(o,s,a,u),yAlign:u}}function ES(o,s){let{x:a,width:u}=o;return s==="right"?a-=u:s==="center"&&(a-=u/2),a}function SS(o,s,a){let{y:u,height:p}=o;return s==="top"?u+=a:s==="bottom"?u-=p+a:u-=p/2,u}function cx(o,s,a,u){const{caretSize:p,caretPadding:g,cornerRadius:v}=o,{xAlign:r,yAlign:T}=a,I=p+g,{topLeft:R,topRight:F,bottomLeft:U,bottomRight:Y}=Fa(v);let it=ES(s,r);const ct=SS(s,T,I);return T==="center"?r==="left"?it+=I:r==="right"&&(it-=I):r==="left"?it-=Math.max(R,U)+p:r==="right"&&(it+=Math.max(F,Y)+p),{x:mn(it,0,u.width-s.width),y:mn(ct,0,u.height-s.height)}}function Kd(o,s,a){const u=Dn(a.padding);return s==="center"?o.x+o.width/2:s==="right"?o.x+o.width-u.right:o.x+u.left}function hx(o){return lr([],Or(o))}function MS(o,s,a){return Ro(o,{tooltip:s,tooltipItems:a,type:"tooltip"})}function ux(o,s){const a=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return a?o.override(a):o}const C1={beforeTitle:zr,title(o){if(o.length>0){const s=o[0],a=s.chart.data.labels,u=a?a.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(u>0&&s.dataIndex<u)return a[s.dataIndex]}return""},afterTitle:zr,beforeBody:zr,beforeLabel:zr,label(o){if(this&&this.options&&this.options.mode==="dataset")return o.label+": "+o.formattedValue||o.formattedValue;let s=o.dataset.label||"";s&&(s+=": ");const a=o.formattedValue;return ti(a)||(s+=a),s},labelColor(o){const a=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{borderColor:a.borderColor,backgroundColor:a.backgroundColor,borderWidth:a.borderWidth,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(o){const a=o.chart.getDatasetMeta(o.datasetIndex).controller.getStyle(o.dataIndex);return{pointStyle:a.pointStyle,rotation:a.rotation}},afterLabel:zr,afterBody:zr,beforeFooter:zr,footer:zr,afterFooter:zr};function Kn(o,s,a,u){const p=o[s].call(a,u);return typeof p>"u"?C1[s].call(a,u):p}class Z_ extends Zs{constructor(s){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=s.chart,this.options=s.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(s){this.options=s,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const s=this._cachedAnimations;if(s)return s;const a=this.chart,u=this.options.setContext(this.getContext()),p=u.enabled&&a.options.animation&&u.animations,g=new a1(this.chart,p);return p._cacheable&&(this._cachedAnimations=Object.freeze(g)),g}getContext(){return this.$context||(this.$context=MS(this.chart.getContext(),this,this._tooltipItems))}getTitle(s,a){const{callbacks:u}=a,p=Kn(u,"beforeTitle",this,s),g=Kn(u,"title",this,s),v=Kn(u,"afterTitle",this,s);let r=[];return r=lr(r,Or(p)),r=lr(r,Or(g)),r=lr(r,Or(v)),r}getBeforeBody(s,a){return hx(Kn(a.callbacks,"beforeBody",this,s))}getBody(s,a){const{callbacks:u}=a,p=[];return yi(s,g=>{const v={before:[],lines:[],after:[]},r=ux(u,g);lr(v.before,Or(Kn(r,"beforeLabel",this,g))),lr(v.lines,Kn(r,"label",this,g)),lr(v.after,Or(Kn(r,"afterLabel",this,g))),p.push(v)}),p}getAfterBody(s,a){return hx(Kn(a.callbacks,"afterBody",this,s))}getFooter(s,a){const{callbacks:u}=a,p=Kn(u,"beforeFooter",this,s),g=Kn(u,"footer",this,s),v=Kn(u,"afterFooter",this,s);let r=[];return r=lr(r,Or(p)),r=lr(r,Or(g)),r=lr(r,Or(v)),r}_createItems(s){const a=this._active,u=this.chart.data,p=[],g=[],v=[];let r=[],T,I;for(T=0,I=a.length;T<I;++T)r.push(vS(this.chart,a[T]));return s.filter&&(r=r.filter((R,F,U)=>s.filter(R,F,U,u))),s.itemSort&&(r=r.sort((R,F)=>s.itemSort(R,F,u))),yi(r,R=>{const F=ux(s.callbacks,R);p.push(Kn(F,"labelColor",this,R)),g.push(Kn(F,"labelPointStyle",this,R)),v.push(Kn(F,"labelTextColor",this,R))}),this.labelColors=p,this.labelPointStyles=g,this.labelTextColors=v,this.dataPoints=r,r}update(s,a){const u=this.options.setContext(this.getContext()),p=this._active;let g,v=[];if(!p.length)this.opacity!==0&&(g={opacity:0});else{const r=Wh[u.position].call(this,p,this._eventPosition);v=this._createItems(u),this.title=this.getTitle(v,u),this.beforeBody=this.getBeforeBody(v,u),this.body=this.getBody(v,u),this.afterBody=this.getAfterBody(v,u),this.footer=this.getFooter(v,u);const T=this._size=ax(this,u),I=Object.assign({},r,T),R=lx(this.chart,u,I),F=cx(u,I,R,this.chart);this.xAlign=R.xAlign,this.yAlign=R.yAlign,g={opacity:1,x:F.x,y:F.y,width:T.width,height:T.height,caretX:r.x,caretY:r.y}}this._tooltipItems=v,this.$context=void 0,g&&this._resolveAnimations().update(this,g),s&&u.external&&u.external.call(this,{chart:this.chart,tooltip:this,replay:a})}drawCaret(s,a,u,p){const g=this.getCaretPosition(s,u,p);a.lineTo(g.x1,g.y1),a.lineTo(g.x2,g.y2),a.lineTo(g.x3,g.y3)}getCaretPosition(s,a,u){const{xAlign:p,yAlign:g}=this,{caretSize:v,cornerRadius:r}=u,{topLeft:T,topRight:I,bottomLeft:R,bottomRight:F}=Fa(r),{x:U,y:Y}=s,{width:it,height:ct}=a;let ht,bt,Dt,Ft,Wt,Rt;return g==="center"?(Wt=Y+ct/2,p==="left"?(ht=U,bt=ht-v,Ft=Wt+v,Rt=Wt-v):(ht=U+it,bt=ht+v,Ft=Wt-v,Rt=Wt+v),Dt=ht):(p==="left"?bt=U+Math.max(T,R)+v:p==="right"?bt=U+it-Math.max(I,F)-v:bt=this.caretX,g==="top"?(Ft=Y,Wt=Ft-v,ht=bt-v,Dt=bt+v):(Ft=Y+ct,Wt=Ft+v,ht=bt+v,Dt=bt-v),Rt=Ft),{x1:ht,x2:bt,x3:Dt,y1:Ft,y2:Wt,y3:Rt}}drawTitle(s,a,u){const p=this.title,g=p.length;let v,r,T;if(g){const I=Hl(u.rtl,this.x,this.width);for(s.x=Kd(this,u.titleAlign,u),a.textAlign=I.textAlign(u.titleAlign),a.textBaseline="middle",v=hn(u.titleFont),r=u.titleSpacing,a.fillStyle=u.titleColor,a.font=v.string,T=0;T<g;++T)a.fillText(p[T],I.x(s.x),s.y+v.lineHeight/2),s.y+=v.lineHeight+r,T+1===g&&(s.y+=u.titleMarginBottom-r)}}_drawColorBox(s,a,u,p,g){const v=this.labelColors[u],r=this.labelPointStyles[u],{boxHeight:T,boxWidth:I}=g,R=hn(g.bodyFont),F=Kd(this,"left",g),U=p.x(F),Y=T<R.lineHeight?(R.lineHeight-T)/2:0,it=a.y+Y;if(g.usePointStyle){const ct={radius:Math.min(I,T)/2,pointStyle:r.pointStyle,rotation:r.rotation,borderWidth:1},ht=p.leftForLtr(U,I)+I/2,bt=it+T/2;s.strokeStyle=g.multiKeyBackground,s.fillStyle=g.multiKeyBackground,j_(s,ct,ht,bt),s.strokeStyle=v.borderColor,s.fillStyle=v.backgroundColor,j_(s,ct,ht,bt)}else{s.lineWidth=Ye(v.borderWidth)?Math.max(...Object.values(v.borderWidth)):v.borderWidth||1,s.strokeStyle=v.borderColor,s.setLineDash(v.borderDash||[]),s.lineDashOffset=v.borderDashOffset||0;const ct=p.leftForLtr(U,I),ht=p.leftForLtr(p.xPlus(U,1),I-2),bt=Fa(v.borderRadius);Object.values(bt).some(Dt=>Dt!==0)?(s.beginPath(),s.fillStyle=g.multiKeyBackground,ru(s,{x:ct,y:it,w:I,h:T,radius:bt}),s.fill(),s.stroke(),s.fillStyle=v.backgroundColor,s.beginPath(),ru(s,{x:ht,y:it+1,w:I-2,h:T-2,radius:bt}),s.fill()):(s.fillStyle=g.multiKeyBackground,s.fillRect(ct,it,I,T),s.strokeRect(ct,it,I,T),s.fillStyle=v.backgroundColor,s.fillRect(ht,it+1,I-2,T-2))}s.fillStyle=this.labelTextColors[u]}drawBody(s,a,u){const{body:p}=this,{bodySpacing:g,bodyAlign:v,displayColors:r,boxHeight:T,boxWidth:I,boxPadding:R}=u,F=hn(u.bodyFont);let U=F.lineHeight,Y=0;const it=Hl(u.rtl,this.x,this.width),ct=function(se){a.fillText(se,it.x(s.x+Y),s.y+U/2),s.y+=U+g},ht=it.textAlign(v);let bt,Dt,Ft,Wt,Rt,Jt,ne;for(a.textAlign=v,a.textBaseline="middle",a.font=F.string,s.x=Kd(this,ht,u),a.fillStyle=u.bodyColor,yi(this.beforeBody,ct),Y=r&&ht!=="right"?v==="center"?I/2+R:I+2+R:0,Wt=0,Jt=p.length;Wt<Jt;++Wt){for(bt=p[Wt],Dt=this.labelTextColors[Wt],a.fillStyle=Dt,yi(bt.before,ct),Ft=bt.lines,r&&Ft.length&&(this._drawColorBox(a,s,Wt,it,u),U=Math.max(F.lineHeight,T)),Rt=0,ne=Ft.length;Rt<ne;++Rt)ct(Ft[Rt]),U=F.lineHeight;yi(bt.after,ct)}Y=0,U=F.lineHeight,yi(this.afterBody,ct),s.y-=g}drawFooter(s,a,u){const p=this.footer,g=p.length;let v,r;if(g){const T=Hl(u.rtl,this.x,this.width);for(s.x=Kd(this,u.footerAlign,u),s.y+=u.footerMarginTop,a.textAlign=T.textAlign(u.footerAlign),a.textBaseline="middle",v=hn(u.footerFont),a.fillStyle=u.footerColor,a.font=v.string,r=0;r<g;++r)a.fillText(p[r],T.x(s.x),s.y+v.lineHeight/2),s.y+=v.lineHeight+u.footerSpacing}}drawBackground(s,a,u,p){const{xAlign:g,yAlign:v}=this,{x:r,y:T}=s,{width:I,height:R}=u,{topLeft:F,topRight:U,bottomLeft:Y,bottomRight:it}=Fa(p.cornerRadius);a.fillStyle=p.backgroundColor,a.strokeStyle=p.borderColor,a.lineWidth=p.borderWidth,a.beginPath(),a.moveTo(r+F,T),v==="top"&&this.drawCaret(s,a,u,p),a.lineTo(r+I-U,T),a.quadraticCurveTo(r+I,T,r+I,T+U),v==="center"&&g==="right"&&this.drawCaret(s,a,u,p),a.lineTo(r+I,T+R-it),a.quadraticCurveTo(r+I,T+R,r+I-it,T+R),v==="bottom"&&this.drawCaret(s,a,u,p),a.lineTo(r+Y,T+R),a.quadraticCurveTo(r,T+R,r,T+R-Y),v==="center"&&g==="left"&&this.drawCaret(s,a,u,p),a.lineTo(r,T+F),a.quadraticCurveTo(r,T,r+F,T),a.closePath(),a.fill(),p.borderWidth>0&&a.stroke()}_updateAnimationTarget(s){const a=this.chart,u=this.$animations,p=u&&u.x,g=u&&u.y;if(p||g){const v=Wh[s.position].call(this,this._active,this._eventPosition);if(!v)return;const r=this._size=ax(this,s),T=Object.assign({},v,this._size),I=lx(a,s,T),R=cx(s,T,I,a);(p._to!==R.x||g._to!==R.y)&&(this.xAlign=I.xAlign,this.yAlign=I.yAlign,this.width=r.width,this.height=r.height,this.caretX=v.x,this.caretY=v.y,this._resolveAnimations().update(this,R))}}_willRender(){return!!this.opacity}draw(s){const a=this.options.setContext(this.getContext());let u=this.opacity;if(!u)return;this._updateAnimationTarget(a);const p={width:this.width,height:this.height},g={x:this.x,y:this.y};u=Math.abs(u)<.001?0:u;const v=Dn(a.padding),r=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;a.enabled&&r&&(s.save(),s.globalAlpha=u,this.drawBackground(g,s,p,a),i1(s,a.textDirection),g.y+=v.top,this.drawTitle(g,s,a),this.drawBody(g,s,a),this.drawFooter(g,s,a),n1(s,a.textDirection),s.restore())}getActiveElements(){return this._active||[]}setActiveElements(s,a){const u=this._active,p=s.map(({datasetIndex:r,index:T})=>{const I=this.chart.getDatasetMeta(r);if(!I)throw new Error("Cannot find a dataset at index "+r);return{datasetIndex:r,element:I.data[T],index:T}}),g=!gp(u,p),v=this._positionChanged(p,a);(g||v)&&(this._active=p,this._eventPosition=a,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(s,a,u=!0){if(a&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const p=this.options,g=this._active||[],v=this._getActiveElements(s,g,a,u),r=this._positionChanged(v,s),T=a||!gp(v,g)||r;return T&&(this._active=v,(p.enabled||p.external)&&(this._eventPosition={x:s.x,y:s.y},this.update(!0,a))),T}_getActiveElements(s,a,u,p){const g=this.options;if(s.type==="mouseout")return[];if(!p)return a;const v=this.chart.getElementsAtEventForMode(s,g.mode,g,u);return g.reverse&&v.reverse(),v}_positionChanged(s,a){const{caretX:u,caretY:p,options:g}=this,v=Wh[g.position].call(this,s,a);return v!==!1&&(u!==v.x||p!==v.y)}}ue(Z_,"positioners",Wh);var AS={id:"tooltip",_element:Z_,positioners:Wh,afterInit(o,s,a){a&&(o.tooltip=new Z_({chart:o,options:a}))},beforeUpdate(o,s,a){o.tooltip&&o.tooltip.initialize(a)},reset(o,s,a){o.tooltip&&o.tooltip.initialize(a)},afterDraw(o){const s=o.tooltip;if(s&&s._willRender()){const a={tooltip:s};if(o.notifyPlugins("beforeTooltipDraw",{...a,cancelable:!0})===!1)return;s.draw(o.ctx),o.notifyPlugins("afterTooltipDraw",a)}},afterEvent(o,s){if(o.tooltip){const a=s.replay;o.tooltip.handleEvent(s.event,a,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(o,s)=>s.bodyFont.size,boxWidth:(o,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:C1},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:o=>o!=="filter"&&o!=="itemSort"&&o!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},CS=Object.freeze({__proto__:null,Colors:j3,Decimation:q3,Filler:hS,Legend:mS,SubTitle:xS,Title:yS,Tooltip:AS});const IS=(o,s,a,u)=>(typeof s=="string"?(a=o.push(s)-1,u.unshift({index:a,label:s})):isNaN(s)&&(a=null),a);function PS(o,s,a,u){const p=o.indexOf(s);if(p===-1)return IS(o,s,a,u);const g=o.lastIndexOf(s);return p!==g?a:p}const kS=(o,s)=>o===null?null:mn(Math.round(o),0,s);function dx(o){const s=this.getLabels();return o>=0&&o<s.length?s[o]:o}class H_ extends Ua{constructor(s){super(s),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(s){const a=this._addedLabels;if(a.length){const u=this.getLabels();for(const{index:p,label:g}of a)u[p]===g&&u.splice(p,1);this._addedLabels=[]}super.init(s)}parse(s,a){if(ti(s))return null;const u=this.getLabels();return a=isFinite(a)&&u[a]===s?a:PS(u,s,Ve(a,s),this._addedLabels),kS(a,u.length-1)}determineDataLimits(){const{minDefined:s,maxDefined:a}=this.getUserBounds();let{min:u,max:p}=this.getMinMax(!0);this.options.bounds==="ticks"&&(s||(u=0),a||(p=this.getLabels().length-1)),this.min=u,this.max=p}buildTicks(){const s=this.min,a=this.max,u=this.options.offset,p=[];let g=this.getLabels();g=s===0&&a===g.length-1?g:g.slice(s,a+1),this._valueRange=Math.max(g.length-(u?0:1),1),this._startValue=this.min-(u?.5:0);for(let v=s;v<=a;v++)p.push({value:v});return p}getLabelForValue(s){return dx.call(this,s)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(s){return typeof s!="number"&&(s=this.parse(s)),s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getPixelForTick(s){const a=this.ticks;return s<0||s>a.length-1?null:this.getPixelForValue(a[s].value)}getValueForPixel(s){return Math.round(this._startValue+this.getDecimalForPixel(s)*this._valueRange)}getBasePixel(){return this.bottom}}ue(H_,"id","category"),ue(H_,"defaults",{ticks:{callback:dx}});function DS(o,s){const a=[],{bounds:p,step:g,min:v,max:r,precision:T,count:I,maxTicks:R,maxDigits:F,includeBounds:U}=o,Y=g||1,it=R-1,{min:ct,max:ht}=s,bt=!ti(v),Dt=!ti(r),Ft=!ti(I),Wt=(ht-ct)/(F+1);let Rt=oy((ht-ct)/it/Y)*Y,Jt,ne,se,Lt;if(Rt<1e-14&&!bt&&!Dt)return[{value:ct},{value:ht}];Lt=Math.ceil(ht/Rt)-Math.floor(ct/Rt),Lt>it&&(Rt=oy(Lt*Rt/it/Y)*Y),ti(T)||(Jt=Math.pow(10,T),Rt=Math.ceil(Rt*Jt)/Jt),p==="ticks"?(ne=Math.floor(ct/Rt)*Rt,se=Math.ceil(ht/Rt)*Rt):(ne=ct,se=ht),bt&&Dt&&g&&M2((r-v)/g,Rt/1e3)?(Lt=Math.round(Math.min((r-v)/Rt,R)),Rt=(r-v)/Lt,ne=v,se=r):Ft?(ne=bt?v:ne,se=Dt?r:se,Lt=I-1,Rt=(se-ne)/Lt):(Lt=(se-ne)/Rt,Kh(Lt,Math.round(Lt),Rt/1e3)?Lt=Math.round(Lt):Lt=Math.ceil(Lt));const Le=Math.max(ay(Rt),ay(ne));Jt=Math.pow(10,ti(T)?Le:T),ne=Math.round(ne*Jt)/Jt,se=Math.round(se*Jt)/Jt;let ze=0;for(bt&&(U&&ne!==v?(a.push({value:v}),ne<v&&ze++,Kh(Math.round((ne+ze*Rt)*Jt)/Jt,v,px(v,Wt,o))&&ze++):ne<v&&ze++);ze<Lt;++ze){const fe=Math.round((ne+ze*Rt)*Jt)/Jt;if(Dt&&fe>r)break;a.push({value:fe})}return Dt&&U&&se!==r?a.length&&Kh(a[a.length-1].value,r,px(r,Wt,o))?a[a.length-1].value=r:a.push({value:r}):(!Dt||se===r)&&a.push({value:se}),a}function px(o,s,{horizontal:a,minRotation:u}){const p=qs(u),g=(a?Math.sin(p):Math.cos(p))||.001,v=.75*s*(""+o).length;return Math.min(s/g,v)}class Ep extends Ua{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,a){return ti(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){const{beginAtZero:s}=this.options,{minDefined:a,maxDefined:u}=this.getUserBounds();let{min:p,max:g}=this;const v=T=>p=a?p:T,r=T=>g=u?g:T;if(s){const T=hr(p),I=hr(g);T<0&&I<0?r(0):T>0&&I>0&&v(0)}if(p===g){let T=g===0?1:Math.abs(g*.05);r(g+T),s||v(p-T)}this.min=p,this.max=g}getTickLimit(){const s=this.options.ticks;let{maxTicksLimit:a,stepSize:u}=s,p;return u?(p=Math.ceil(this.max/u)-Math.floor(this.min/u)+1,p>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${u} would result generating up to ${p} ticks. Limiting to 1000.`),p=1e3)):(p=this.computeTickLimit(),a=a||11),a&&(p=Math.min(a,p)),p}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const s=this.options,a=s.ticks;let u=this.getTickLimit();u=Math.max(2,u);const p={maxTicks:u,bounds:s.bounds,min:s.min,max:s.max,precision:a.precision,step:a.stepSize,count:a.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:a.minRotation||0,includeBounds:a.includeBounds!==!1},g=this._range||this,v=DS(p,g);return s.bounds==="ticks"&&Fx(v,this,"value"),s.reverse?(v.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),v}configure(){const s=this.ticks;let a=this.min,u=this.max;if(super.configure(),this.options.offset&&s.length){const p=(u-a)/Math.max(s.length-1,1)/2;a-=p,u+=p}this._startValue=a,this._endValue=u,this._valueRange=u-a}getLabelForValue(s){return du(s,this.chart.options.locale,this.options.ticks.format)}}class X_ extends Ep{determineDataLimits(){const{min:s,max:a}=this.getMinMax(!0);this.min=Yi(s)?s:0,this.max=Yi(a)?a:1,this.handleTickRangeOptions()}computeTickLimit(){const s=this.isHorizontal(),a=s?this.width:this.height,u=qs(this.options.ticks.minRotation),p=(s?Math.sin(u):Math.cos(u))||.001,g=this._resolveTickFontOptions(0);return Math.ceil(a/Math.min(40,g.lineHeight/p))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}}ue(X_,"id","linear"),ue(X_,"defaults",{ticks:{callback:Ip.formatters.numeric}});const au=o=>Math.floor(Ao(o)),ka=(o,s)=>Math.pow(10,au(o)+s);function fx(o){return o/Math.pow(10,au(o))===1}function _x(o,s,a){const u=Math.pow(10,a),p=Math.floor(o/u);return Math.ceil(s/u)-p}function LS(o,s){const a=s-o;let u=au(a);for(;_x(o,s,u)>10;)u++;for(;_x(o,s,u)<10;)u--;return Math.min(u,au(o))}function zS(o,{min:s,max:a}){s=as(o.min,s);const u=[],p=au(s);let g=LS(s,a),v=g<0?Math.pow(10,Math.abs(g)):1;const r=Math.pow(10,g),T=p>g?Math.pow(10,p):0,I=Math.round((s-T)*v)/v,R=Math.floor((s-T)/r/10)*r*10;let F=Math.floor((I-R)/Math.pow(10,g)),U=as(o.min,Math.round((T+R+F*Math.pow(10,g))*v)/v);for(;U<a;)u.push({value:U,major:fx(U),significand:F}),F>=10?F=F<15?15:20:F++,F>=20&&(g++,F=2,v=g>=0?1:v),U=Math.round((T+R+F*Math.pow(10,g))*v)/v;const Y=as(o.max,U);return u.push({value:Y,major:fx(Y),significand:F}),u}class Y_ extends Ua{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(s,a){const u=Ep.prototype.parse.apply(this,[s,a]);if(u===0){this._zero=!0;return}return Yi(u)&&u>0?u:null}determineDataLimits(){const{min:s,max:a}=this.getMinMax(!0);this.min=Yi(s)?Math.max(0,s):null,this.max=Yi(a)?Math.max(0,a):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Yi(this._userMin)&&(this.min=s===ka(this.min,0)?ka(this.min,-1):ka(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:s,maxDefined:a}=this.getUserBounds();let u=this.min,p=this.max;const g=r=>u=s?u:r,v=r=>p=a?p:r;u===p&&(u<=0?(g(1),v(10)):(g(ka(u,-1)),v(ka(p,1)))),u<=0&&g(ka(p,-1)),p<=0&&v(ka(u,1)),this.min=u,this.max=p}buildTicks(){const s=this.options,a={min:this._userMin,max:this._userMax},u=zS(a,this);return s.bounds==="ticks"&&Fx(u,this,"value"),s.reverse?(u.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),u}getLabelForValue(s){return s===void 0?"0":du(s,this.chart.options.locale,this.options.ticks.format)}configure(){const s=this.min;super.configure(),this._startValue=Ao(s),this._valueRange=Ao(this.max)-Ao(s)}getPixelForValue(s){return(s===void 0||s===0)&&(s=this.min),s===null||isNaN(s)?NaN:this.getPixelForDecimal(s===this.min?0:(Ao(s)-this._startValue)/this._valueRange)}getValueForPixel(s){const a=this.getDecimalForPixel(s);return Math.pow(10,this._startValue+a*this._valueRange)}}ue(Y_,"id","logarithmic"),ue(Y_,"defaults",{ticks:{callback:Ip.formatters.logarithmic,major:{enabled:!0}}});function K_(o){const s=o.ticks;if(s.display&&o.display){const a=Dn(s.backdropPadding);return Ve(s.font&&s.font.size,Ki.font.size)+a.height}return 0}function RS(o,s,a){return a=zi(a)?a:[a],{w:G2(o,s.string,a),h:a.length*s.lineHeight}}function mx(o,s,a,u,p){return o===u||o===p?{start:s-a/2,end:s+a/2}:o<u||o>p?{start:s-a,end:s}:{start:s,end:s+a}}function OS(o){const s={l:o.left+o._padding.left,r:o.right-o._padding.right,t:o.top+o._padding.top,b:o.bottom-o._padding.bottom},a=Object.assign({},s),u=[],p=[],g=o._pointLabels.length,v=o.options.pointLabels,r=v.centerPointLabels?Oi/g:0;for(let T=0;T<g;T++){const I=v.setContext(o.getPointLabelContext(T));p[T]=I.padding;const R=o.getPointPosition(T,o.drawingArea+p[T],r),F=hn(I.font),U=RS(o.ctx,F,o._pointLabels[T]);u[T]=U;const Y=ls(o.getIndexAngle(T)+r),it=Math.round(rm(Y)),ct=mx(it,R.x,U.w,0,180),ht=mx(it,R.y,U.h,90,270);BS(a,s,Y,ct,ht)}o.setCenterPoint(s.l-a.l,a.r-s.r,s.t-a.t,a.b-s.b),o._pointLabelItems=jS(o,u,p)}function BS(o,s,a,u,p){const g=Math.abs(Math.sin(a)),v=Math.abs(Math.cos(a));let r=0,T=0;u.start<s.l?(r=(s.l-u.start)/g,o.l=Math.min(o.l,s.l-r)):u.end>s.r&&(r=(u.end-s.r)/g,o.r=Math.max(o.r,s.r+r)),p.start<s.t?(T=(s.t-p.start)/v,o.t=Math.min(o.t,s.t-T)):p.end>s.b&&(T=(p.end-s.b)/v,o.b=Math.max(o.b,s.b+T))}function FS(o,s,a){const u=o.drawingArea,{extra:p,additionalAngle:g,padding:v,size:r}=a,T=o.getPointPosition(s,u+p+v,g),I=Math.round(rm(ls(T.angle+Ji))),R=GS(T.y,r.h,I),F=VS(I),U=US(T.x,r.w,F);return{visible:!0,x:T.x,y:R,textAlign:F,left:U,top:R,right:U+r.w,bottom:R+r.h}}function NS(o,s){if(!s)return!0;const{left:a,top:u,right:p,bottom:g}=o;return!(jr({x:a,y:u},s)||jr({x:a,y:g},s)||jr({x:p,y:u},s)||jr({x:p,y:g},s))}function jS(o,s,a){const u=[],p=o._pointLabels.length,g=o.options,{centerPointLabels:v,display:r}=g.pointLabels,T={extra:K_(g)/2,additionalAngle:v?Oi/p:0};let I;for(let R=0;R<p;R++){T.padding=a[R],T.size=s[R];const F=FS(o,R,T);u.push(F),r==="auto"&&(F.visible=NS(F,I),F.visible&&(I=F))}return u}function VS(o){return o===0||o===180?"center":o<180?"left":"right"}function US(o,s,a){return a==="right"?o-=s:a==="center"&&(o-=s/2),o}function GS(o,s,a){return a===90||a===270?o-=s/2:(a>270||a<90)&&(o-=s),o}function qS(o,s,a){const{left:u,top:p,right:g,bottom:v}=a,{backdropColor:r}=s;if(!ti(r)){const T=Fa(s.borderRadius),I=Dn(s.backdropPadding);o.fillStyle=r;const R=u-I.left,F=p-I.top,U=g-u+I.width,Y=v-p+I.height;Object.values(T).some(it=>it!==0)?(o.beginPath(),ru(o,{x:R,y:F,w:U,h:Y,radius:T}),o.fill()):o.fillRect(R,F,U,Y)}}function $S(o,s){const{ctx:a,options:{pointLabels:u}}=o;for(let p=s-1;p>=0;p--){const g=o._pointLabelItems[p];if(!g.visible)continue;const v=u.setContext(o.getPointLabelContext(p));qS(a,v,g);const r=hn(v.font),{x:T,y:I,textAlign:R}=g;Va(a,o._pointLabels[p],T,I+r.lineHeight/2,r,{color:v.color,textAlign:R,textBaseline:"middle"})}}function I1(o,s,a,u){const{ctx:p}=o;if(a)p.arc(o.xCenter,o.yCenter,s,0,Ri);else{let g=o.getPointPosition(0,s);p.moveTo(g.x,g.y);for(let v=1;v<u;v++)g=o.getPointPosition(v,s),p.lineTo(g.x,g.y)}}function WS(o,s,a,u,p){const g=o.ctx,v=s.circular,{color:r,lineWidth:T}=s;!v&&!u||!r||!T||a<0||(g.save(),g.strokeStyle=r,g.lineWidth=T,g.setLineDash(p.dash),g.lineDashOffset=p.dashOffset,g.beginPath(),I1(o,a,v,u),g.closePath(),g.stroke(),g.restore())}function ZS(o,s,a){return Ro(o,{label:a,index:s,type:"pointLabel"})}class Zh extends Ep{constructor(s){super(s),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const s=this._padding=Dn(K_(this.options)/2),a=this.width=this.maxWidth-s.width,u=this.height=this.maxHeight-s.height;this.xCenter=Math.floor(this.left+a/2+s.left),this.yCenter=Math.floor(this.top+u/2+s.top),this.drawingArea=Math.floor(Math.min(a,u)/2)}determineDataLimits(){const{min:s,max:a}=this.getMinMax(!1);this.min=Yi(s)&&!isNaN(s)?s:0,this.max=Yi(a)&&!isNaN(a)?a:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/K_(this.options))}generateTickLabels(s){Ep.prototype.generateTickLabels.call(this,s),this._pointLabels=this.getLabels().map((a,u)=>{const p=Ci(this.options.pointLabels.callback,[a,u],this);return p||p===0?p:""}).filter((a,u)=>this.chart.getDataVisibility(u))}fit(){const s=this.options;s.display&&s.pointLabels.display?OS(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(s,a,u,p){this.xCenter+=Math.floor((s-a)/2),this.yCenter+=Math.floor((u-p)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(s,a,u,p))}getIndexAngle(s){const a=Ri/(this._pointLabels.length||1),u=this.options.startAngle||0;return ls(s*a+qs(u))}getDistanceFromCenterForValue(s){if(ti(s))return NaN;const a=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-s)*a:(s-this.min)*a}getValueForDistanceFromCenter(s){if(ti(s))return NaN;const a=s/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-a:this.min+a}getPointLabelContext(s){const a=this._pointLabels||[];if(s>=0&&s<a.length){const u=a[s];return ZS(this.getContext(),s,u)}}getPointPosition(s,a,u=0){const p=this.getIndexAngle(s)-Ji+u;return{x:Math.cos(p)*a+this.xCenter,y:Math.sin(p)*a+this.yCenter,angle:p}}getPointPositionForValue(s,a){return this.getPointPosition(s,this.getDistanceFromCenterForValue(a))}getBasePosition(s){return this.getPointPositionForValue(s||0,this.getBaseValue())}getPointLabelPosition(s){const{left:a,top:u,right:p,bottom:g}=this._pointLabelItems[s];return{left:a,top:u,right:p,bottom:g}}drawBackground(){const{backgroundColor:s,grid:{circular:a}}=this.options;if(s){const u=this.ctx;u.save(),u.beginPath(),I1(this,this.getDistanceFromCenterForValue(this._endValue),a,this._pointLabels.length),u.closePath(),u.fillStyle=s,u.fill(),u.restore()}}drawGrid(){const s=this.ctx,a=this.options,{angleLines:u,grid:p,border:g}=a,v=this._pointLabels.length;let r,T,I;if(a.pointLabels.display&&$S(this,v),p.display&&this.ticks.forEach((R,F)=>{if(F!==0){T=this.getDistanceFromCenterForValue(R.value);const U=this.getContext(F),Y=p.setContext(U),it=g.setContext(U);WS(this,Y,T,v,it)}}),u.display){for(s.save(),r=v-1;r>=0;r--){const R=u.setContext(this.getPointLabelContext(r)),{color:F,lineWidth:U}=R;!U||!F||(s.lineWidth=U,s.strokeStyle=F,s.setLineDash(R.borderDash),s.lineDashOffset=R.borderDashOffset,T=this.getDistanceFromCenterForValue(a.ticks.reverse?this.min:this.max),I=this.getPointPosition(r,T),s.beginPath(),s.moveTo(this.xCenter,this.yCenter),s.lineTo(I.x,I.y),s.stroke())}s.restore()}}drawBorder(){}drawLabels(){const s=this.ctx,a=this.options,u=a.ticks;if(!u.display)return;const p=this.getIndexAngle(0);let g,v;s.save(),s.translate(this.xCenter,this.yCenter),s.rotate(p),s.textAlign="center",s.textBaseline="middle",this.ticks.forEach((r,T)=>{if(T===0&&!a.reverse)return;const I=u.setContext(this.getContext(T)),R=hn(I.font);if(g=this.getDistanceFromCenterForValue(this.ticks[T].value),I.showLabelBackdrop){s.font=R.string,v=s.measureText(r.label).width,s.fillStyle=I.backdropColor;const F=Dn(I.backdropPadding);s.fillRect(-v/2-F.left,-g-R.size/2-F.top,v+F.width,R.size+F.height)}Va(s,r.label,0,-g,R,{color:I.color,strokeColor:I.textStrokeColor,strokeWidth:I.textStrokeWidth})}),s.restore()}drawTitle(){}}ue(Zh,"id","radialLinear"),ue(Zh,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Ip.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(s){return s},padding:5,centerPointLabels:!1}}),ue(Zh,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),ue(Zh,"descriptors",{angleLines:{_fallback:"grid"}});const Lp={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Jn=Object.keys(Lp);function gx(o,s){return o-s}function yx(o,s){if(ti(s))return null;const a=o._adapter,{parser:u,round:p,isoWeekday:g}=o._parseOpts;let v=s;return typeof u=="function"&&(v=u(v)),Yi(v)||(v=typeof u=="string"?a.parse(v,u):a.parse(v)),v===null?null:(p&&(v=p==="week"&&(Jl(g)||g===!0)?a.startOf(v,"isoWeek",g):a.startOf(v,p)),+v)}function xx(o,s,a,u){const p=Jn.length;for(let g=Jn.indexOf(o);g<p-1;++g){const v=Lp[Jn[g]],r=v.steps?v.steps:Number.MAX_SAFE_INTEGER;if(v.common&&Math.ceil((a-s)/(r*v.size))<=u)return Jn[g]}return Jn[p-1]}function HS(o,s,a,u,p){for(let g=Jn.length-1;g>=Jn.indexOf(a);g--){const v=Jn[g];if(Lp[v].common&&o._adapter.diff(p,u,v)>=s-1)return v}return Jn[a?Jn.indexOf(a):0]}function XS(o){for(let s=Jn.indexOf(o)+1,a=Jn.length;s<a;++s)if(Lp[Jn[s]].common)return Jn[s]}function vx(o,s,a){if(!a)o[s]=!0;else if(a.length){const{lo:u,hi:p}=om(a,s),g=a[u]>=s?a[u]:a[p];o[g]=!0}}function YS(o,s,a,u){const p=o._adapter,g=+p.startOf(s[0].value,u),v=s[s.length-1].value;let r,T;for(r=g;r<=v;r=+p.add(r,1,u))T=a[r],T>=0&&(s[T].major=!0);return s}function bx(o,s,a){const u=[],p={},g=s.length;let v,r;for(v=0;v<g;++v)r=s[v],p[r]=v,u.push({value:r,major:!1});return g===0||!a?u:YS(o,u,p,a)}class lu extends Ua{constructor(s){super(s),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(s,a={}){const u=s.time||(s.time={}),p=this._adapter=new rE._date(s.adapters.date);p.init(a),Yh(u.displayFormats,p.formats()),this._parseOpts={parser:u.parser,round:u.round,isoWeekday:u.isoWeekday},super.init(s),this._normalized=a.normalized}parse(s,a){return s===void 0?null:yx(this,s)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const s=this.options,a=this._adapter,u=s.time.unit||"day";let{min:p,max:g,minDefined:v,maxDefined:r}=this.getUserBounds();function T(I){!v&&!isNaN(I.min)&&(p=Math.min(p,I.min)),!r&&!isNaN(I.max)&&(g=Math.max(g,I.max))}(!v||!r)&&(T(this._getLabelBounds()),(s.bounds!=="ticks"||s.ticks.source!=="labels")&&T(this.getMinMax(!1))),p=Yi(p)&&!isNaN(p)?p:+a.startOf(Date.now(),u),g=Yi(g)&&!isNaN(g)?g:+a.endOf(Date.now(),u)+1,this.min=Math.min(p,g-1),this.max=Math.max(p+1,g)}_getLabelBounds(){const s=this.getLabelTimestamps();let a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;return s.length&&(a=s[0],u=s[s.length-1]),{min:a,max:u}}buildTicks(){const s=this.options,a=s.time,u=s.ticks,p=u.source==="labels"?this.getLabelTimestamps():this._generate();s.bounds==="ticks"&&p.length&&(this.min=this._userMin||p[0],this.max=this._userMax||p[p.length-1]);const g=this.min,v=this.max,r=P2(p,g,v);return this._unit=a.unit||(u.autoSkip?xx(a.minUnit,this.min,this.max,this._getLabelCapacity(g)):HS(this,r.length,a.minUnit,this.min,this.max)),this._majorUnit=!u.major.enabled||this._unit==="year"?void 0:XS(this._unit),this.initOffsets(p),s.reverse&&r.reverse(),bx(this,r,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(s=>+s.value))}initOffsets(s=[]){let a=0,u=0,p,g;this.options.offset&&s.length&&(p=this.getDecimalForValue(s[0]),s.length===1?a=1-p:a=(this.getDecimalForValue(s[1])-p)/2,g=this.getDecimalForValue(s[s.length-1]),s.length===1?u=g:u=(g-this.getDecimalForValue(s[s.length-2]))/2);const v=s.length<3?.5:.25;a=mn(a,0,v),u=mn(u,0,v),this._offsets={start:a,end:u,factor:1/(a+1+u)}}_generate(){const s=this._adapter,a=this.min,u=this.max,p=this.options,g=p.time,v=g.unit||xx(g.minUnit,a,u,this._getLabelCapacity(a)),r=Ve(p.ticks.stepSize,1),T=v==="week"?g.isoWeekday:!1,I=Jl(T)||T===!0,R={};let F=a,U,Y;if(I&&(F=+s.startOf(F,"isoWeek",T)),F=+s.startOf(F,I?"day":v),s.diff(u,a,v)>1e5*r)throw new Error(a+" and "+u+" are too far apart with stepSize of "+r+" "+v);const it=p.ticks.source==="data"&&this.getDataTimestamps();for(U=F,Y=0;U<u;U=+s.add(U,r,v),Y++)vx(R,U,it);return(U===u||p.bounds==="ticks"||Y===1)&&vx(R,U,it),Object.keys(R).sort(gx).map(ct=>+ct)}getLabelForValue(s){const a=this._adapter,u=this.options.time;return u.tooltipFormat?a.format(s,u.tooltipFormat):a.format(s,u.displayFormats.datetime)}format(s,a){const p=this.options.time.displayFormats,g=this._unit,v=a||p[g];return this._adapter.format(s,v)}_tickFormatFunction(s,a,u,p){const g=this.options,v=g.ticks.callback;if(v)return Ci(v,[s,a,u],this);const r=g.time.displayFormats,T=this._unit,I=this._majorUnit,R=T&&r[T],F=I&&r[I],U=u[a],Y=I&&F&&U&&U.major;return this._adapter.format(s,p||(Y?F:R))}generateTickLabels(s){let a,u,p;for(a=0,u=s.length;a<u;++a)p=s[a],p.label=this._tickFormatFunction(p.value,a,s)}getDecimalForValue(s){return s===null?NaN:(s-this.min)/(this.max-this.min)}getPixelForValue(s){const a=this._offsets,u=this.getDecimalForValue(s);return this.getPixelForDecimal((a.start+u)*a.factor)}getValueForPixel(s){const a=this._offsets,u=this.getDecimalForPixel(s)/a.factor-a.end;return this.min+u*(this.max-this.min)}_getLabelSize(s){const a=this.options.ticks,u=this.ctx.measureText(s).width,p=qs(this.isHorizontal()?a.maxRotation:a.minRotation),g=Math.cos(p),v=Math.sin(p),r=this._resolveTickFontOptions(0).size;return{w:u*g+r*v,h:u*v+r*g}}_getLabelCapacity(s){const a=this.options.time,u=a.displayFormats,p=u[a.unit]||u.millisecond,g=this._tickFormatFunction(s,0,bx(this,[s],this._majorUnit),p),v=this._getLabelSize(g),r=Math.floor(this.isHorizontal()?this.width/v.w:this.height/v.h)-1;return r>0?r:1}getDataTimestamps(){let s=this._cache.data||[],a,u;if(s.length)return s;const p=this.getMatchingVisibleMetas();if(this._normalized&&p.length)return this._cache.data=p[0].controller.getAllParsedValues(this);for(a=0,u=p.length;a<u;++a)s=s.concat(p[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(s)}getLabelTimestamps(){const s=this._cache.labels||[];let a,u;if(s.length)return s;const p=this.getLabels();for(a=0,u=p.length;a<u;++a)s.push(yx(this,p[a]));return this._cache.labels=this._normalized?s:this.normalize(s)}normalize(s){return Vx(s.sort(gx))}}ue(lu,"id","time"),ue(lu,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Jd(o,s,a){let u=0,p=o.length-1,g,v,r,T;a?(s>=o[u].pos&&s<=o[p].pos&&({lo:u,hi:p}=Nr(o,"pos",s)),{pos:g,time:r}=o[u],{pos:v,time:T}=o[p]):(s>=o[u].time&&s<=o[p].time&&({lo:u,hi:p}=Nr(o,"time",s)),{time:g,pos:r}=o[u],{time:v,pos:T}=o[p]);const I=v-g;return I?r+(T-r)*(s-g)/I:r}class J_ extends lu{constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const s=this._getTimestampsForTable(),a=this._table=this.buildLookupTable(s);this._minPos=Jd(a,this.min),this._tableRange=Jd(a,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){const{min:a,max:u}=this,p=[],g=[];let v,r,T,I,R;for(v=0,r=s.length;v<r;++v)I=s[v],I>=a&&I<=u&&p.push(I);if(p.length<2)return[{time:a,pos:0},{time:u,pos:1}];for(v=0,r=p.length;v<r;++v)R=p[v+1],T=p[v-1],I=p[v],Math.round((R+T)/2)!==I&&g.push({time:I,pos:v/(r-1)});return g}_generate(){const s=this.min,a=this.max;let u=super.getDataTimestamps();return(!u.includes(s)||!u.length)&&u.splice(0,0,s),(!u.includes(a)||u.length===1)&&u.push(a),u.sort((p,g)=>p-g)}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;const a=this.getDataTimestamps(),u=this.getLabelTimestamps();return a.length&&u.length?s=this.normalize(a.concat(u)):s=a.length?a:u,s=this._cache.all=s,s}getDecimalForValue(s){return(Jd(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){const a=this._offsets,u=this.getDecimalForPixel(s)/a.factor-a.end;return Jd(this._table,u*this._tableRange+this._minPos,!0)}}ue(J_,"id","timeseries"),ue(J_,"defaults",lu.defaults);var KS=Object.freeze({__proto__:null,CategoryScale:H_,LinearScale:X_,LogarithmicScale:Y_,RadialLinearScale:Zh,TimeScale:lu,TimeSeriesScale:J_});const JS=[sE,z3,CS,KS],QS=document.getElementById("radar-chart"),tM=document.getElementById("bar-chart"),eM=document.getElementById("pie-chart");let up,dp,Hh;function iM(){bs.defaults.font.family="Inconsolata",console.log("initializing charts");let s={type:"radar",data:{labels:["Primary School",["Secondary","School"],["Health","Center"],"Hospital","Market"],datasets:[{label:"Travel Time With All Potential Bridges",data:[],fill:"+1",backgroundColor:"rgba(117, 117, 117, 0.3)",borderColor:"rgb(48, 159, 242, 0.5)",pointBackgroundColor:"rgb(48, 159, 242, 0.5)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(48, 159, 242, 1)",clip:!1},{label:"Travel Time Without Bridges",data:[],fill:!1,backgroundColor:"rgba(206, 97, 96, 0.5)",borderColor:"rgb(227, 63, 41, 1)",pointBackgroundColor:"rgb(227, 63, 41, 1)",pointBorderColor:"#fff",pointHoverBackgroundColor:"#fff",pointHoverBorderColor:"rgb(227, 63, 41, 1)",clip:!1}]},options:{scale:{r:{min:0,max:120},ticks:{beginAtZero:!0,min:0,max:120,stepSize:30}},elements:{line:{borderWidth:3}},interaction:{mode:"index"},plugins:{title:{display:!0,text:"Travel Time to Destinations",font:{size:16}},tooltip:{callbacks:{label:function(v){let r=v.dataset.label||"";v.dataset.data[v.dataIndex];let T=0;return console.log("label is"+v.dataset.label),r=="Travel Time With All Potential Bridges"?T=Math.round(Xh[v.dataIndex]):r=="Travel Time Without Bridges"?T=Math.round(_p[v.dataIndex]):(console.log("else"),T=v.dataset.data[v.dataIndex]),r+=": "+T+" minutes",r}},displayColors:!1}}}},a={datasets:[{label:["Female 65+","Female 50-64","Female 15-49","Female 10-14","Female 5-9","Female 0-4","Male 0-4","Male 5-9","Male 10-14","Male 15-49","Male 50-64","Male 65+"],backgroundColor:["#330C33","#4D124D","#661766","#801D80","#992399","#B329B3","#29B3B3","#239999","#1D8080","#176666","#124D4D","#0C3333"],borderWidth:1,data:[],hoverOffset:6},{label:["Female","Male"],backgroundColor:["#661766","#186969"],borderWidth:2,data:[],hoverOffset:2},{label:["Total Population"],backgroundColor:["rgb(0, 0, 0, 0.1)"],borderWidth:0,data:[],hoverOffset:0}]},u={type:"pie",data:a,labels:{font:{family:"Inconsolata"}},options:{responsive:!0,maintainAspectRatio:!0,plugins:{title:{display:!0,text:"Population Demographics",font:{size:16}},tooltip:{callbacks:{label:function(v){console.log(v);let r=v.datasetIndex;console.log(a.datasets[r].label),console.log(r);let T=a.datasets[v.datasetIndex].label[v.dataIndex],I=v.dataset.data[v.dataIndex];return T+": "+I}}}}}};const g={type:"bar",data:{labels:["Primary school","Secondary school","Health center","Hospital","Market"],datasets:[{label:"",data:[],backgroundColor:"#47474750"},{label:"Travel Time",data:[1,1,1,1,1,1],backgroundColor:"#ed0000"},{label:"",data:[],backgroundColor:"#47474750"}]},options:{indexAxis:"y",plugins:{legend:{display:!1},title:{display:!0,text:"Travel Time Distribution (without bridges)",font:{size:16}},tooltip:{callbacks:{label:function(v){return v.chart.data.datasets[0].data[v.dataIndex]+"th percentile"}},displayColors:!1}},responsive:!0,scales:{x:{beginAtZero:!0,stacked:!0,padding:0,min:0,max:100,ticks:{stepSize:50,callback:function(v,r,T){var I=["Slower","50th percentile","Faster"];return I[r]}}},y:{stacked:!0,padding:0}},aspect:1,maintainAspectRatio:!0}};up=new bs(QS,s),dp=new bs(tM,g),Hh=new bs(eM,u)}function nM(o,s,a,u,p){console.log("updating charts"),up.data.datasets[0].data=o,up.data.datasets[1].data=s,Hh.data.datasets[0].data=a[2],Hh.data.datasets[1].data=a[1],Hh.data.datasets[2].data=a[0],dp.data.datasets[0].data=u,dp.data.datasets[2].data=p,up.update(),Hh.update(),dp.update()}const sM=document.getElementById("click-panel");let pp=[],fp=[],Xh=[],_p=[],os=[],P1=[],Q_=[],k1=[],wx=["ps-paths","ss-paths","hp-paths","hc-paths","hos-paths","sdu-paths","ps-paths-outline","ss-paths-outline","hp-paths-outline","hc-paths-outline","hos-paths-outline","sdu-paths-outline"];function rM(o){if(Number.isFinite(o)){var s=(o.toString().split(".")[1]||"").length;if(s>3)return parseFloat(o.toFixed(3))}return o}function oM(o,s){aM(s),lM(s),cM(s),sM.classList.add("show"),nM(pp,fp,k1,P1,Q_),document.getElementById("all-data-table").innerHTML="";for(var a in s)s.hasOwnProperty(a)&&(document.getElementById("all-data-table").innerHTML+="<tr><td>"+a+"</td> <td>"+rM(s[a])+"</td></tr>");for(let u=0;u<wx.length;u++)gi.setFilter(wx[u],["==","h3-index",s["h3-index"]])}function aM(o){Xh=[o.travel_time_primary_schools_fixed,o.travel_time_secondary_schools_fixed,o.travel_time_health_centers_optimal,o.travel_time_major_hospitals_optimal,o.travel_time_semi_dense_urban_optimal],_p=[o.travel_time_no_sites_primary_schools_fixed,o.travel_time_no_sites_secondary_schools_fixed,o.travel_time_no_sites_health_centers_optimal,o.travel_time_no_sites_major_hospitals_optimal,o.travel_time_no_sites_semi_dense_urban_optimal],pp=[],fp=[];for(let s=0;s<Xh.length;s++)Xh[s]>120?pp.push(120):pp.push(Xh[s]),_p[s]>120?fp.push(120):fp.push(_p[s])}function lM(o){k1=[[o.population],[Math.round(o.females_0_4+o.females_5_9+o.females_10_14+o.females_15_49+o.females_50_64+o.females_65_plus),Math.round(o.males_0_4+o.males_5_9+o.males_10_14+o.males_15_49+o.males_50_64+o.males_65_plus)],[Math.round(o.females_65_plus),Math.round(o.females_50_64),Math.round(o.females_15_49),Math.round(o.females_10_14),Math.round(o.females_5_9),Math.round(o.females_0_4),Math.round(o.males_0_4),Math.round(o.males_5_9),Math.round(o.males_10_14),Math.round(o.males_15_49),Math.round(o.males_50_64),Math.round(o.males_65_plus)]]}function Zl(o,s){let a=C[s][3].quantiles;if(o<=a[0])return 0;if(o>=a[a.length-1])return 100;for(let u=1;u<a.length;u++)if(o<=a[u]){const p=a[u-1],g=a[u],v=(o-p)/(g-p)*10+(u-1)*10;return Math.round(100-v)}}function cM(o){return os=[Zl(o.travel_time_no_sites_primary_schools_fixed,"travel_time_no_sites_primary_schools_fixed"),Zl(o.travel_time_no_sites_secondary_schools_fixed,"travel_time_no_sites_secondary_schools_fixed"),Zl(o.travel_time_no_sites_health_centers_optimal,"travel_time_no_sites_health_centers_optimal"),Zl(o.travel_time_no_sites_health_posts_optimal,"travel_time_no_sites_health_posts_optimal"),Zl(o.travel_time_no_sites_major_hospitals_optimal,"travel_time_no_sites_major_hospitals_optimal"),Zl(o.travel_time_no_sites_semi_dense_urban_optimal,"travel_time_no_sites_semi_dense_urban_optimal")],P1=[os[0]-1,os[1]-1,os[2]-1,os[3]-1,os[4]-1,os[5]-1],Q_=[100-os[0],100-os[1],100-os[2],100-os[3],100-os[4],100-os[5]],Q_}let ec={dropdown1:["Impact","Travel Time","Demographics","Population"],dropdown2:{Demographics:["Pregnancies","Births","Relative Wealth Index","Underweight","Female Education","Male Education"],Population:["All","Children 0-4","Children 5-9","Children 0-9","Youth 10-14","People 15-49","People 50-64","People 65+","Female 0-4","Female 5-9","Female 0-9","Female 10-14","Female 15-49","Female 50-64","Female 65+","Male 0-4","Male 5-9","Male 0-9","Male 10-14","Male 15-49","Male 50-64","Male 65+"],Impact:["Potential Impact","Current Impact"],TravelTime:["With All Bridges","With Constructed Bridges","Without Bridges"]},dropdown3:{Demographics:["N/A"],Population:["N/A"],Impact:["All","School","Healthcare","Market","Primary School","Secondary School","Health Post","Health Center","Major Hospital"],TravelTime:["To School","To Healthcare","To Market","To Primary School","To Secondary School","To Health Post","To Health Center","To Hospital"]},dropdown4:["Standard map","Satellite"]};function ic(o,s){for(;s.firstChild;)s.removeChild(s.firstChild);for(let a=0;a<o.length;a++){let u=document.createElement("option");u.text=o[a],u.value=o[a],s.appendChild(u),o[a]=="N/A"?s.disabled=!0:s.disabled=!1}}function hM(o){if(console.log(o),o=="Standard map"){let s=["satellite-base"],a=["land","national-park","landuse","pitch-outline","waterway","water","water-pattern","mapbox-mapbox-terrain-dem-v1","land-structure-polygon","land-structure-line","aeroway-polygon","aeroway-line","tunnel-simple","road-simple","bridge-case-simple","bridge-simple","building-extrusion","admin-1-boundary-bg","admin-0-boundary-bg","admin-1-boundary","admin-0-boundary","admin-0-boundary-disputed","satellite-light","building-entrance","building-number-label","block-number-label","road-label-simple","waterway-label","natural-line-label","natural-point-label","water-line-label","water-point-label","poi-label","transit-label","airport-label","settlement-subdivision-label","settlement-minor-label","settlement-major-label","state-label"];for(let u=0;u<s.length;u++)gi.setLayoutProperty(s[u],"visibility","none");for(let u=0;u<a.length;u++)gi.setLayoutProperty(a[u],"visibility","visible")}else{let s=["land","national-park","landuse","pitch-outline","waterway","water","water-pattern","mapbox-mapbox-terrain-dem-v1","land-structure-polygon","land-structure-line","aeroway-polygon","aeroway-line","tunnel-simple","road-simple","bridge-case-simple","bridge-simple","building-extrusion","admin-1-boundary-bg","admin-0-boundary-bg","admin-1-boundary","admin-0-boundary","admin-0-boundary-disputed","satellite-light","building-entrance","building-number-label","block-number-label","road-label-simple","waterway-label","natural-line-label","natural-point-label","water-line-label","water-point-label","poi-label","transit-label","airport-label","settlement-subdivision-label","settlement-minor-label","settlement-major-label","state-label"],a=["satellite-base"];for(let u=0;u<s.length;u++)gi.setLayoutProperty(s[u],"visibility","none");for(let u=0;u<a.length;u++)gi.setLayoutProperty(a[u],"visibility","visible")}}let C_=document.getElementById("trans-slider");C_.addEventListener("change",function(){console.log(C_.value),gi.setPaintProperty("hex-8-layer","fill-opacity",Number(C_.value)/100)});function uM(o){o.addSource("hex-8-source",{type:"geojson",data:"/rwa_travel_time_hex-8-mini.geojson",generateId:!0}),o.addLayer({id:"hex-8-layer",type:"fill",source:"hex-8-source",paint:{"fill-color":O_.travel_time_all_education_facilities_fixed["fill-color"],"fill-opacity":.5,"fill-outline-color":"rgba(255, 255, 255, .1)"}},"admin-0-boundary-disputed"),o.addLayer({id:"hex-8-hover",type:"line",source:"hex-8-source",paint:{"line-color":"#66BEC7","line-width":["interpolate",["linear"],["zoom"],3,.5,15,2],"line-opacity":["case",["boolean",["feature-state","hover"],!1],.75,0]}}),o.addLayer({id:"hex-8-click",type:"fill",source:"hex-8-source",paint:{"fill-color":"#66BEC7","fill-opacity":["case",["boolean",["feature-state","click"],!1],.8,0]}},"admin-0-boundary-disputed")}function dM(o){console.log(o),console.log(JSON.stringify([o.dropdown1,o.dropdown2,o.dropdown3]));let s=Object.keys(C).find(a=>JSON.stringify(C[a][0])===JSON.stringify([o.dropdown1,o.dropdown2,o.dropdown3]));console.log(s),console.log(O_[s]),gi.setPaintProperty("hex-8-layer","fill-color",O_[s]["fill-color"])}let I_={"info-button":"https://www.bridgestoprosperity.org/","feedback-button":"https://forms.gle/3H1hcotYYeoheCeYA","bridge-need-button":"https://forms.gle/xnuknH9SSWA5ybHg7","bug-button":"https://forms.gle/3H1hcotYYeoheCeYA"};function pM(o){if(o=="info-button"){console.log("info button clicked");var s=document.getElementById("info-modal");s.style.display="block",document.body.classList.add("modal-open")}o=="feedback-button"&&(console.log("feedback button clicked"),window.open(I_[o],"_blank")),o=="bridge-need-button"&&(console.log("bridge need button clicked"),window.open(I_[o],"_blank")),o=="bug-button"&&(console.log("bug button clicked"),window.open(I_[o],"_blank"))}var $s=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function D1(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}function fM(o){if(o.__esModule)return o;var s=o.default;if(typeof s=="function"){var a=function u(){if(this instanceof u){var p=[null];p.push.apply(p,arguments);var g=Function.bind.apply(s,p);return new g}return s.apply(this,arguments)};a.prototype=s.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(o).forEach(function(u){var p=Object.getOwnPropertyDescriptor(o,u);Object.defineProperty(a,u,p.get?p:{enumerable:!0,get:function(){return o[u]}})}),a}var L1={exports:{}};(function(o,s){(function(a,u){o.exports=u()})($s,function(){var a,u,p;function g(r,T){if(!a)a=T;else if(!u)u=T;else{var I="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+a+")(sharedChunk); ("+u+")(sharedChunk); self.onerror = null;",R={};a(R),p=T(R),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(p.workerUrl=window.URL.createObjectURL(new Blob([I],{type:"text/javascript"})))}}g(["exports"],function(r){var T=typeof self<"u"?self:{},I="2.15.0";let R;const F={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(R==null){const e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{R={}.API_URL_REGEX!=null?new RegExp({}.API_URL_REGEX):e}catch{R=e}}return R},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!F.API_URL)return null;try{const e=new URL(F.API_URL);return e.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":e.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},U={supported:!1,testSupport:function(e){!ct&&it&&(ht?bt(e):Y=e)}};let Y,it,ct=!1,ht=!1;function bt(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,it),e.isContextLost())return;U.supported=!0}catch{}e.deleteTexture(t),ct=!0}T.document&&(it=T.document.createElement("img"),it.onload=function(){Y&&bt(Y),Y=null,ht=!0},it.onerror=function(){ct=!0,Y=null},it.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Dt="01";function Ft(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Wt=Rt;function Rt(e,t,i,l){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(l-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=i,this.p2y=l}Rt.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(t===void 0&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var i=e,l=0;l<8;l++){var h=this.sampleCurveX(i)-e;if(Math.abs(h)<t)return i;var f=this.sampleCurveDerivativeX(i);if(Math.abs(f)<1e-6)break;i-=h/f}var m=0,x=1;for(i=e,l=0;l<20&&(h=this.sampleCurveX(i),!(Math.abs(h-e)<t));l++)e>h?m=i:x=i,i=.5*(x-m)+m;return i},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var Jt=Ft(Wt),ne=se;function se(e,t){this.x=e,this.y=t}se.prototype={clone:function(){return new se(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),l=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=l,this},_rotateAround:function(e,t){var i=Math.cos(e),l=Math.sin(e),h=t.y+l*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-l*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},se.convert=function(e){return e instanceof se?e:Array.isArray(e)?new se(e[0],e[1]):e};var Lt=Ft(ne);const Le=Math.PI/180,ze=180/Math.PI;function fe(e){return e*Le}function Ge(e){return e*ze}const on=[[0,0],[1,0],[1,1],[0,1]];function Ke(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,i=t*e;return 4*(e<.5?i:3*(e-t)+i-.75)}function ei(e,t,i,l){const h=new Jt(e,t,i,l);return function(f){return h.solve(f)}}const xi=ei(.25,.1,.25,1);function be(e,t,i){return Math.min(i,Math.max(t,e))}function Pi(e,t,i){return(i=be((i-e)/(t-e),0,1))*i*(3-2*i)}function vi(e,t,i){const l=i-t,h=((e-t)%l+l)%l+t;return h===t?i:h}function ki(e,t,i){if(!e.length)return i(null,[]);let l=e.length;const h=new Array(e.length);let f=null;e.forEach((m,x)=>{t(m,(w,E)=>{w&&(f=w),h[x]=E,--l==0&&i(f,h)})})}function gn(e){const t=[];for(const i in e)t.push(e[i]);return t}function _i(e,...t){for(const i of t)for(const l in i)e[l]=i[l];return e}let vn=1;function Nn(){return vn++}function bn(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function ws(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ga(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function ur(e,t){e.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function Vr(e,t){return e.indexOf(t,e.length-t.length)!==-1}function Ne(e,t,i){const l={};for(const h in e)l[h]=t.call(i||this,e[h],h,e);return l}function Ur(e,t,i){const l={};for(const h in e)t.call(i||this,e[h],h,e)&&(l[h]=e[h]);return l}function zn(e){return Array.isArray(e)?e.map(zn):typeof e=="object"&&e?Ne(e,zn):e}const Oo={};function Ei(e){Oo[e]||(typeof console<"u"&&console.warn(e),Oo[e]=!0)}function jn(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}function qa(e){let t=0;for(let i,l,h=0,f=e.length,m=f-1;h<f;m=h++)i=e[h],l=e[m],t+=(l.x-i.x)*(i.y+l.y);return t}function Ts(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Rn(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,h,f)=>{const m=h||f;return t[l]=!m||m.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let Bo=null;function Gr(e){if(Bo==null){const t=e.navigator?e.navigator.userAgent:null;Bo=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return Bo}function Fo(e){try{const t=T[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}}function Hs(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}const qr="mapbox-tiles";let $a=500,Wa=50,Vn,Xs;function No(){try{return T.caches}catch{}}function dr(){No()&&!Vn&&(Vn=T.caches.open(qr))}function $r(e){const t=e.indexOf("?");if(t<0)return e;const i=function(h){const f=h.indexOf("?");return f>0?h.slice(f+1).split("&"):[]}(e),l=i.filter(h=>{const f=h.split("=");return f[0]==="language"||f[0]==="worldview"});return l.length?`${e.slice(0,t)}?${l.join("&")}`:e.slice(0,t)}let jo=1/0;const pr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(pr);class Ys extends Error{constructor(t,i,l){i===401&&Tt(l)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const fr=Ts()?()=>self.worker&&self.worker.referrer:()=>(T.location.protocol==="blob:"?T.parent:T).location.href,_r=function(e,t){if(!(/^file:/.test(i=e.url)||/^file:/.test(fr())&&!/^\w+:/.test(i))){if(T.fetch&&T.Request&&T.AbortController&&T.Request.prototype.hasOwnProperty("signal"))return function(l,h){const f=new T.AbortController,m=new T.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:fr(),referrerPolicy:l.referrerPolicy,signal:f.signal});let x=!1,w=!1;const E=(A=m.url).indexOf("sku=")>0&&Tt(A);var A;l.type==="json"&&m.headers.set("Accept","application/json");const k=(O,B,V)=>{if(w)return;if(O&&O.message!=="SecurityError"&&Ei(O.toString()),B&&V)return D(B);const Z=Date.now();T.fetch(m).then(tt=>{if(tt.ok){const lt=E?tt.clone():null;return D(tt,lt,Z)}return h(new Ys(tt.statusText,tt.status,l.url))}).catch(tt=>{tt.name!=="AbortError"&&h(new Error(`${tt.message} ${l.url}`))})},D=(O,B,V)=>{(l.type==="arrayBuffer"?O.arrayBuffer():l.type==="json"?O.json():O.text()).then(Z=>{w||(B&&V&&function(tt,lt,et){if(dr(),!Vn)return;const ot={status:lt.status,statusText:lt.statusText,headers:new T.Headers};lt.headers.forEach((Ct,St)=>ot.headers.set(St,Ct));const dt=Rn(lt.headers.get("Cache-Control")||"");if(dt["no-store"])return;dt["max-age"]&&ot.headers.set("Expires",new Date(et+1e3*dt["max-age"]).toUTCString());const ut=ot.headers.get("Expires");ut&&(new Date(ut).getTime()-et<42e4||function(Ct,St){if(Xs===void 0)try{new Response(new ReadableStream),Xs=!0}catch{Xs=!1}Xs?St(Ct.body):Ct.blob().then(St)}(lt,Ct=>{const St=new T.Response(Ct,ot);dr(),Vn&&Vn.then(Bt=>Bt.put($r(tt.url),St)).catch(Bt=>Ei(Bt.message))}))}(m,B,V),x=!0,h(null,Z,O.headers.get("Cache-Control"),O.headers.get("Expires")))}).catch(Z=>{w||h(new Error(Z.message))})};return E?function(O,B){if(dr(),!Vn)return B(null);const V=$r(O.url);Vn.then(Z=>{Z.match(V).then(tt=>{const lt=function(et){if(!et)return!1;const ot=new Date(et.headers.get("Expires")||0),dt=Rn(et.headers.get("Cache-Control")||"");return ot>Date.now()&&!dt["no-cache"]}(tt);Z.delete(V),lt&&Z.put(V,tt.clone()),B(null,tt,lt)}).catch(B)}).catch(B)}(m,k):k(null,null),{cancel:()=>{w=!0,x||f.abort()}}}(e,t);if(Ts()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var i;return function(l,h){const f=new T.XMLHttpRequest;f.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in l.headers)f.setRequestHeader(m,l.headers[m]);return l.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=l.credentials==="include",f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(l.type==="json")try{m=JSON.parse(f.response)}catch(x){return h(x)}h(null,m,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new Ys(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}}(e,t)},Wr=function(e,t){return _r(_i(e,{type:"arrayBuffer"}),t)};function Za(e){const t=T.document.createElement("a");return t.href=e,t.protocol===T.document.location.protocol&&t.host===T.document.location.host}const at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let G,q;G=[],q=0;const rt=function(e,t){if(U.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),q>=F.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return G.push(f),f}q++;let i=!1;const l=()=>{if(!i)for(i=!0,q--;G.length&&q<F.MAX_PARALLEL_IMAGE_REQUESTS;){const f=G.shift(),{requestParameters:m,callback:x,cancelled:w}=f;w||(f.cancel=rt(m,x).cancel)}},h=Wr(e,(f,m,x,w)=>{l(),f?t(f):m&&(T.createImageBitmap?function(E,A){const k=new T.Blob([new Uint8Array(E)],{type:"image/png"});T.createImageBitmap(k).then(D=>{A(null,D)}).catch(D=>{A(new Error(`Could not load image because of ${D.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,A)=>t(E,A,x,w)):function(E,A){const k=new T.Image,D=T.URL;k.onload=()=>{A(null,k),D.revokeObjectURL(k.src),k.onload=null,T.requestAnimationFrame(()=>{k.src=at})},k.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const O=new T.Blob([new Uint8Array(E)],{type:"image/png"});k.src=E.byteLength?D.createObjectURL(O):at}(m,(E,A)=>t(E,A,x,w)))});return{cancel:()=>{h.cancel(),l()}}},pt="NO_ACCESS_TOKEN";function yt(e){return e.indexOf("mapbox:")===0}function Tt(e){return F.API_URL_REGEX.test(e)}function wt(e){return F.API_CDN_URL_REGEX.test(e)}function gt(e){return F.API_STYLE_REGEX.test(e)&&!kt(e)}function kt(e){return F.API_SPRITE_REGEX.test(e)}const ee=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ie(e){const t=e.match(ee);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Kt(e){const t=e.params.length?`?${e.params.join("&")}`:"";return`${e.protocol}://${e.authority}${e.path}${t}`}const Me="mapbox.eventData";function Pe(e){if(!e)return null;const t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent(T.atob(t[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ae{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const i=Pe(F.ACCESS_TOKEN);let l="";return l=i&&i.u?T.btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(h,f)=>String.fromCharCode(+("0x"+f)))):F.ACCESS_TOKEN||"",t?`${Me}.${t}:${l}`:`${Me}:${l}`}fetchEventData(){const t=Fo("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(t)try{const h=T.localStorage.getItem(i);h&&(this.eventData=JSON.parse(h));const f=T.localStorage.getItem(l);f&&(this.anonId=f)}catch{Ei("Unable to read from LocalStorage")}}saveEventData(){const t=Fo("localStorage"),i=this.getStorageKey(),l=this.getStorageKey("uuid");if(t)try{T.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&T.localStorage.setItem(i,JSON.stringify(this.eventData))}catch{Ei("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,i,l,h){if(!F.EVENTS_URL)return;const f=ie(F.EVENTS_URL);f.params.push(`access_token=${h||F.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(t).toISOString()},x=i?_i(m,i):m,w={url:Kt(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=function(E,A){return _r(_i(E,{method:"POST"}),A)}(w,E=>{this.pendingRequest=null,l(E),this.saveEventData(),this.processRequests(h)})}queueRequest(t,i){this.queue.push(t),this.processRequests(i)}}const ke=new class extends Ae{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(e,t){F.EVENTS_URL&&F.ACCESS_TOKEN&&Array.isArray(e)&&e.some(i=>yt(i)||Tt(i))&&this.queueRequest(Date.now(),t)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Pe(F.ACCESS_TOKEN),i=t?t.u:F.ACCESS_TOKEN;let l=i!==this.eventData.tokenU;Ga(this.anonId)||(this.anonId=bn(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),m=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||f.getDate()!==m.getDate()}else l=!0;l?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:Dt,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=h,this.eventData.tokenU=i)},e):this.processRequests()}},je=ke.postTurnstileEvent.bind(ke),Si=new class extends Ae{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(e,t,i,l){this.skuToken=t,this.errorCb=l,F.EVENTS_URL&&(i||F.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(pt)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),Ga(this.anonId)||(this.anonId=bn()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:Dt,skuToken:this.skuToken,userId:this.anonId},l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},e))}},Ni=Si.postMapLoadEvent.bind(Si),un=new class extends Ae{constructor(){super("gljs.performance")}postPerformanceEvent(e,t){F.EVENTS_URL&&(e||F.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:i}=this.queue.shift(),l=function(h){const f=T.performance.getEntriesByType("resource"),m=T.performance.getEntriesByType("mark"),x=function(D){const O={};if(D){for(const B in D)if(B!=="other")for(const V of D[B]){const Z=`${B}ResolveRangeMin`,tt=`${B}ResolveRangeMax`,lt=`${B}RequestCount`,et=`${B}RequestCachedCount`;O[Z]=Math.min(O[Z]||1/0,V.startTime),O[tt]=Math.max(O[tt]||-1/0,V.responseEnd);const ot=dt=>{O[dt]===void 0&&(O[dt]=0),++O[dt]};V.transferSize!==void 0&&V.transferSize===0&&ot(et),ot(lt)}}return O}(function(D,O){const B={};if(D)for(const V of D){const Z=O(V);B[Z]===void 0&&(B[Z]=[]),B[Z].push(V)}return B}(f,fu)),w=T.devicePixelRatio,E=T.navigator.connection||T.navigator.mozConnection||T.navigator.webkitConnection,A={counters:[],metadata:[],attributes:[]},k=(D,O,B)=>{B!=null&&D.push({name:O,value:B.toString()})};for(const D in x)k(A.counters,D,x[D]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(k(A.counters,"interactionRangeMin",h.interactionRange[0]),k(A.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const D of Object.keys(Zr)){const O=Zr[D],B=m.find(V=>V.name===O);B&&k(A.counters,O,B.startTime)}return k(A.counters,"visibilityHidden",h.visibilityHidden),k(A.attributes,"style",function(D){if(D)for(const O of D){const B=O.name.split("?")[0];if(gt(B)){const V=B.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(f)),k(A.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),k(A.attributes,"fogEnabled",h.fogEnabled?"true":"false"),k(A.attributes,"projection",h.projection),k(A.attributes,"zoom",h.zoom),k(A.metadata,"devicePixelRatio",w),k(A.metadata,"connectionEffectiveType",E?E.effectiveType:void 0),k(A.metadata,"navigatorUserAgent",T.navigator.userAgent),k(A.metadata,"screenWidth",T.screen.width),k(A.metadata,"screenHeight",T.screen.height),k(A.metadata,"windowWidth",T.innerWidth),k(A.metadata,"windowHeight",T.innerHeight),k(A.metadata,"mapWidth",h.width/w),k(A.metadata,"mapHeight",h.height/w),k(A.metadata,"webglRenderer",h.renderer),k(A.metadata,"webglVendor",h.vendor),k(A.metadata,"sdkVersion",I),k(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const h of l.metadata);for(const h of l.counters);for(const h of l.attributes);this.postEvent(t,l,()=>{},e)}},Hi=un.postPerformanceEvent.bind(un),cs=new class extends Ae{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(e,t,i,l){if(!F.API_URL||!F.SESSION_PATH)return;const h=ie(F.API_URL+F.SESSION_PATH);h.params.push(`sku=${t||""}`),h.params.push(`access_token=${l||F.ACCESS_TOKEN||""}`);const f={url:Kt(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,x){return _r(_i(m,{method:"GET"}),x)}(f,m=>{this.pendingRequest=null,i(m),this.saveEventData(),this.processRequests(l)})}getSessionAPI(e,t,i,l){this.skuToken=t,this.errorCb=l,F.SESSION_PATH&&F.API_URL&&(i||F.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},i):this.errorCb(new Error(pt)))}processRequests(e){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:i}=this.queue.shift();t&&this.success[t]||this.getSession(i,this.skuToken,l=>{l?this.errorCb(l):t&&(this.success[t]=!0)},e)}},Qi=cs.getSessionAPI.bind(cs),yn=new Set,Zr={create:"create",load:"load",fullLoad:"fullLoad"},Op={mark(e){T.performance.mark(e)},measure(e,t,i){T.performance.measure(e,t,i)}};function fu(e){const t=e.name.split("?")[0];return wt(t)&&t.includes("mapbox-gl.js")?"javascript":wt(t)&&t.includes("mapbox-gl.css")?"css":function(i){return F.API_FONTS_REGEX.test(i)}(t)?"fontRange":kt(t)?"sprite":gt(t)?"style":function(i){return F.API_TILEJSON_REGEX.test(i)}(t)?"tilejson":"other"}const He=T.performance;function rc(e){const t=e?e.url.toString():void 0;return He.getEntriesByName(t)}let Vo,oc,Ha,hs;const Es={now:()=>Ha!==void 0?Ha:T.performance.now(),setNow(e){Ha=e},restoreNow(){Ha=void 0},frame(e){const t=T.requestAnimationFrame(e);return{cancel:()=>T.cancelAnimationFrame(t)}},getImageData(e,t=0){const{width:i,height:l}=e;hs||(hs=T.document.createElement("canvas"));const h=hs.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>hs.width||l>hs.height)&&(hs.width=i,hs.height=l),h.clearRect(-t,-t,i+2*t,l+2*t),h.drawImage(e,0,0,i,l),h.getImageData(-t,-t,i+2*t,l+2*t)},resolveURL:e=>(Vo||(Vo=T.document.createElement("a")),Vo.href=e,Vo.href),get devicePixelRatio(){return T.devicePixelRatio},get prefersReducedMotion(){return!!T.matchMedia&&(oc==null&&(oc=T.matchMedia("(prefers-reduced-motion: reduce)")),oc.matches)}};function ac(e,t,i){i[e]&&i[e].indexOf(t)!==-1||(i[e]=i[e]||[],i[e].push(t))}function lc(e,t,i){if(i&&i[e]){const l=i[e].indexOf(t);l!==-1&&i[e].splice(l,1)}}class mr{constructor(t,i={}){_i(this,i),this.type=t}}class Ss extends mr{constructor(t,i={}){super("error",_i({error:t},i))}}class Uo{on(t,i){return this._listeners=this._listeners||{},ac(t,i,this._listeners),this}off(t,i){return lc(t,i,this._listeners),lc(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},ac(t,i,this._oneTimeListeners),this):new Promise(l=>this.once(t,l))}fire(t,i){typeof t=="string"&&(t=new mr(t,i||{}));const l=t.type;if(this.listens(l)){t.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of h)x.call(this,t);const f=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of f)lc(l,x,this._oneTimeListeners),x.call(this,t);const m=this._eventedParent;m&&(_i(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(t))}else t instanceof Ss&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}var Ot=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ms(e,...t){for(const i of t)for(const l in i)e[l]=i[l];return e}function ji(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function tn(e){if(Array.isArray(e))return e.map(tn);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const i in e)t[i]=tn(e[i]);return t}return ji(e)}class _u extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}var us=_u;class cc{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[l,h]of i)this.bindings[l]=h}concat(t){return new cc(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var mu=cc;const Hr={kind:"null"},le={kind:"number"},Fe={kind:"string"},Re={kind:"boolean"},On={kind:"color"},ts={kind:"object"},Oe={kind:"value"},Bn={kind:"collator"},Go={kind:"formatted"},gr={kind:"resolvedImage"};function Un(e,t){return{kind:"array",itemType:e,N:t}}function bi(e){if(e.kind==="array"){const t=bi(e.itemType);return typeof e.N=="number"?`array<${t}, ${e.N}>`:e.itemType.kind==="value"?"array":`array<${t}>`}return e.kind}const gu=[Hr,le,Fe,Re,On,Go,ts,Un(Oe),gr];function As(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!As(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(const i of gu)if(!As(i,t))return null}}return`Expected ${bi(e)} but found ${bi(t)} instead.`}function qo(e,t){return t.some(i=>i.kind===e.kind)}function $o(e,t){return t.some(i=>i==="null"?e===null:i==="array"?Array.isArray(e):i==="object"?e&&!Array.isArray(e)&&typeof e=="object":i===typeof e)}var hc,yu={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Wo(e){return(e=Math.round(e))<0?0:e>255?255:e}function Zo(e){return Wo(e[e.length-1]==="%"?parseFloat(e)/100*255:parseInt(e))}function Xa(e){return(t=e[e.length-1]==="%"?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function Xr(e,t,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?e+(t-e)*i*6:2*i<1?t:3*i<2?e+(t-e)*(2/3-i)*6:e}try{hc={}.parseCSSColor=function(e){var t,i=e.replace(/ /g,"").toLowerCase();if(i in yu)return yu[i].slice();if(i[0]==="#")return i.length===4?(t=parseInt(i.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:i.length===7&&(t=parseInt(i.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=i.indexOf("("),h=i.indexOf(")");if(l!==-1&&h+1===i.length){var f=i.substr(0,l),m=i.substr(l+1,h-(l+1)).split(","),x=1;switch(f){case"rgba":if(m.length!==4)return null;x=Xa(m.pop());case"rgb":return m.length!==3?null:[Zo(m[0]),Zo(m[1]),Zo(m[2]),x];case"hsla":if(m.length!==4)return null;x=Xa(m.pop());case"hsl":if(m.length!==3)return null;var w=(parseFloat(m[0])%360+360)%360/360,E=Xa(m[1]),A=Xa(m[2]),k=A<=.5?A*(E+1):A+E-A*E,D=2*A-k;return[Wo(255*Xr(D,k,w+1/3)),Wo(255*Xr(D,k,w)),Wo(255*Xr(D,k,w-1/3)),x];default:return null}}return null}}catch{}class wn{constructor(t,i,l,h=1){this.r=t,this.g=i,this.b=l,this.a=h}static parse(t){if(!t)return;if(t instanceof wn)return t;if(typeof t!="string")return;const i=hc(t);return i?new wn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[t,i,l,h]=this.toArray();return`rgba(${Math.round(t)},${Math.round(i)},${Math.round(l)},${h})`}toArray(){const{r:t,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[255*t/h,255*i/h,255*l/h,h]}toArray01(){const{r:t,g:i,b:l,a:h}=this;return h===0?[0,0,0,0]:[t/h,i/h,l/h,h]}toArray01PremultipliedAlpha(){const{r:t,g:i,b:l,a:h}=this;return[t,i,l,h]}}wn.black=new wn(0,0,0,1),wn.white=new wn(1,1,1,1),wn.transparent=new wn(0,0,0,0),wn.red=new wn(1,0,0,1),wn.blue=new wn(0,0,1,1);var Bi=wn;class uc{constructor(t,i,l){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class dc{constructor(t,i,l,h,f){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=l,this.fontStack=h,this.textColor=f}}class Tn{constructor(t){this.sections=t}static fromString(t){return new Tn([new dc(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof Tn?t:Tn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){t.push(["image",i.image.name]);continue}t.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toArray())),t.push(l)}return t}}class Gn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Gn({name:t,available:!1}):null}serialize(){return["image",this.name]}}function xu(e,t,i,l){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[e,t,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[e,t,i,l]:[e,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ho(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Bi||e instanceof uc||e instanceof Tn||e instanceof Gn)return!0;if(Array.isArray(e)){for(const t of e)if(!Ho(t))return!1;return!0}if(typeof e=="object"){for(const t in e)if(!Ho(e[t]))return!1;return!0}return!1}function Di(e){if(e===null)return Hr;if(typeof e=="string")return Fe;if(typeof e=="boolean")return Re;if(typeof e=="number")return le;if(e instanceof Bi)return On;if(e instanceof uc)return Bn;if(e instanceof Tn)return Go;if(e instanceof Gn)return gr;if(Array.isArray(e)){const t=e.length;let i;for(const l of e){const h=Di(l);if(i){if(i===h)continue;i=Oe;break}i=h}return Un(i||Oe,t)}return ts}function Xo(e){const t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Bi||e instanceof Tn||e instanceof Gn?e.toString():JSON.stringify(e)}class pc{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ho(t[1]))return i.error("invalid value");const l=t[1];let h=Di(l);const f=i.expectedType;return h.kind!=="array"||h.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(h=f),new pc(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Bi?["rgba"].concat(this.value.toArray()):this.value instanceof Tn?this.value.serialize():this.value}}var yr=pc,an=class{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}};const fc={string:Fe,number:le,boolean:Re,object:ts};class _c{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let l,h=1;const f=t[0];if(f==="array"){let x,w;if(t.length>2){const E=t[1];if(typeof E!="string"||!(E in fc)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=fc[E],h++}else x=Oe;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}l=Un(x,w)}else l=fc[f];const m=[];for(;h<t.length;h++){const x=i.parse(t[h],h,Oe);if(!x)return null;m.push(x)}return new _c(l,m)}evaluate(t){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(t);if(!As(this.type,Di(l)))return l;if(i===this.args.length-1)throw new an(`Expected value to be of type ${bi(this.type)}, but found ${bi(Di(l))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if(t.kind==="array"){const l=t.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const h=t.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(l=>l.serialize()))}}var Cs=_c;class Ks{constructor(t){this.type=Go,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const l=t[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const h=[];let f=!1;for(let m=1;m<=t.length-1;++m){const x=t[m];if(f&&typeof x=="object"&&!Array.isArray(x)){f=!1;let w=null;if(x["font-scale"]&&(w=i.parse(x["font-scale"],1,le),!w))return null;let E=null;if(x["text-font"]&&(E=i.parse(x["text-font"],1,Un(Fe)),!E))return null;let A=null;if(x["text-color"]&&(A=i.parse(x["text-color"],1,On),!A))return null;const k=h[h.length-1];k.scale=w,k.font=E,k.textColor=A}else{const w=i.parse(t[m],1,Oe);if(!w)return null;const E=w.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new Ks(h)}evaluate(t){return new Tn(this.sections.map(i=>{const l=i.content.evaluate(t);return Di(l)===gr?new dc("",l,null,null,null):new dc(Xo(l),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),t.push(l)}return t}}class Ya{constructor(t){this.type=gr,this.input=t}static parse(t,i){if(t.length!==2)return i.error("Expected two arguments.");const l=i.parse(t[1],1,Fe);return l?new Ya(l):i.error("No image name provided.")}evaluate(t){const i=this.input.evaluate(t),l=Gn.fromString(i);return l&&t.availableImages&&(l.available=t.availableImages.indexOf(i)>-1),l}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Bp={"to-boolean":Re,"to-color":On,"to-number":le,"to-string":Fe};class mc{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const l=t[0];if((l==="to-boolean"||l==="to-string")&&t.length!==2)return i.error("Expected one argument.");const h=Bp[l],f=[];for(let m=1;m<t.length;m++){const x=i.parse(t[m],m,Oe);if(!x)return null;f.push(x)}return new mc(h,f)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,l;for(const h of this.args){if(i=h.evaluate(t),l=null,i instanceof Bi)return i;if(typeof i=="string"){const f=t.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:xu(i[0],i[1],i[2],i[3]),!l))return new Bi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new an(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(t),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new an(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Tn.fromString(Xo(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Gn.fromString(Xo(this.args[0].evaluate(t))):Xo(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ks([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ya(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Yr=mc;const ds=["Unknown","Point","LineString","Polygon"];var gc=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?ds[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:i,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*t-e[0])+this.featureDistanceData.bearing[1]*(l*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Bi.parse(e)),t}};class xr{constructor(t,i,l,h){this.name=t,this.type=i,this._evaluate=l,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const l=t[0],h=xr.definitions[l];if(!h)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=m.filter(([E])=>!Array.isArray(E)||E.length===t.length-1);let w=null;for(const[E,A]of x){w=new Tc(i.registry,i.path,null,i.scope);const k=[];let D=!1;for(let O=1;O<t.length;O++){const B=t[O],V=Array.isArray(E)?E[O-1]:E.type,Z=w.parse(B,1+k.length,V);if(!Z){D=!0;break}k.push(Z)}if(!D)if(Array.isArray(E)&&E.length!==k.length)w.error(`Expected ${E.length} arguments, but found ${k.length} instead.`);else{for(let O=0;O<k.length;O++){const B=Array.isArray(E)?E[O]:E.type,V=k[O];w.concat(O+1).checkSubtype(B,V.type)}if(w.errors.length===0)return new xr(l,f,A,k)}}if(x.length===1)i.errors.push(...w.errors);else{const E=(x.length?x:m).map(([k])=>{return D=k,Array.isArray(D)?`(${D.map(bi).join(", ")})`:`(${bi(D.type)}...)`;var D}).join(" | "),A=[];for(let k=1;k<t.length;k++){const D=i.parse(t[k],1+A.length);if(!D)return null;A.push(bi(D.type))}i.error(`Expected arguments of type ${E}, but found (${A.join(", ")}) instead.`)}return null}static register(t,i){xr.definitions=i;for(const l in i)t[l]=xr}}var Is=xr;class Yo{constructor(t,i,l){this.type=Bn,this.locale=l,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const l=t[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const h=i.parse(l["case-sensitive"]!==void 0&&l["case-sensitive"],1,Re);if(!h)return null;const f=i.parse(l["diacritic-sensitive"]!==void 0&&l["diacritic-sensitive"],1,Re);if(!f)return null;let m=null;return l.locale&&(m=i.parse(l.locale,1,Fe),!m)?null:new Yo(h,f,m)}evaluate(t){return new uc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Ps=8192;function Ka(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Kr(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ko(e,t){const i=(180+e[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*Ps),Math.round(l*h*Ps)]}function vu(e,t,i){const l=e[0]-t[0],h=e[1]-t[1],f=e[0]-i[0],m=e[1]-i[1];return l*m-f*h==0&&l*f<=0&&h*m<=0}function Ja(e,t){let i=!1;for(let m=0,x=t.length;m<x;m++){const w=t[m];for(let E=0,A=w.length;E<A-1;E++){if(vu(e,w[E],w[E+1]))return!1;(h=w[E])[1]>(l=e)[1]!=(f=w[E+1])[1]>l[1]&&l[0]<(f[0]-h[0])*(l[1]-h[1])/(f[1]-h[1])+h[0]&&(i=!i)}}var l,h,f;return i}function yc(e,t){for(let i=0;i<t.length;i++)if(Ja(e,t[i]))return!0;return!1}function xc(e,t,i,l){const h=l[0]-i[0],f=l[1]-i[1],m=(e[0]-i[0])*f-h*(e[1]-i[1]),x=(t[0]-i[0])*f-h*(t[1]-i[1]);return m>0&&x<0||m<0&&x>0}function Jr(e,t,i){for(const E of i)for(let A=0;A<E.length-1;++A)if((x=[(m=E[A+1])[0]-(f=E[A])[0],m[1]-f[1]])[0]*(w=[(h=t)[0]-(l=e)[0],h[1]-l[1]])[1]-x[1]*w[0]!=0&&xc(l,h,f,m)&&xc(f,m,l,h))return!0;var l,h,f,m,x,w;return!1}function Xe(e,t){for(let i=0;i<e.length;++i)if(!Ja(e[i],t))return!1;for(let i=0;i<e.length-1;++i)if(Jr(e[i],e[i+1],t))return!1;return!0}function Fp(e,t){for(let i=0;i<t.length;i++)if(Xe(e,t[i]))return!0;return!1}function vc(e,t,i){const l=[];for(let h=0;h<e.length;h++){const f=[];for(let m=0;m<e[h].length;m++){const x=Ko(e[h][m],i);Ka(t,x),f.push(x)}l.push(f)}return l}function bu(e,t,i){const l=[];for(let h=0;h<e.length;h++){const f=vc(e[h],t,i);l.push(f)}return l}function bc(e,t,i,l){if(e[0]<i[0]||e[0]>i[2]){const h=.5*l;let f=e[0]-i[0]>h?-l:i[0]-e[0]>h?l:0;f===0&&(f=e[0]-i[2]>h?-l:i[2]-e[0]>h?l:0),e[0]+=f}Ka(t,e)}function wu(e,t,i,l){const h=Math.pow(2,l.z)*Ps,f=[l.x*Ps,l.y*Ps],m=[];if(!e)return m;for(const x of e)for(const w of x){const E=[w.x+f[0],w.y+f[1]];bc(E,t,i,h),m.push(E)}return m}function wc(e,t,i,l){const h=Math.pow(2,l.z)*Ps,f=[l.x*Ps,l.y*Ps],m=[];if(!e)return m;for(const w of e){const E=[];for(const A of w){const k=[A.x+f[0],A.y+f[1]];Ka(t,k),E.push(k)}m.push(E)}if(t[2]-t[0]<=h/2){(x=t)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of m)for(const E of w)bc(E,t,i,h)}var x;return m}class Qr{constructor(t,i){this.type=Re,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ho(t[1])){const l=t[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const f=l.features[h].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new Qr(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Qr(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new Qr(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const x=vc(l.coordinates,f,m),w=wu(i.geometry(),h,f,m);if(!Kr(h,f))return!1;for(const E of w)if(!Ja(E,x))return!1}if(l.type==="MultiPolygon"){const x=bu(l.coordinates,f,m),w=wu(i.geometry(),h,f,m);if(!Kr(h,f))return!1;for(const E of w)if(!yc(E,x))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(l.type==="Polygon"){const x=vc(l.coordinates,f,m),w=wc(i.geometry(),h,f,m);if(!Kr(h,f))return!1;for(const E of w)if(!Xe(E,x))return!1}if(l.type==="MultiPolygon"){const x=bu(l.coordinates,f,m),w=wc(i.geometry(),h,f,m);if(!Kr(h,f))return!1;for(const E of w)if(!Fp(E,x))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Qa=Qr;function to(e){if(e instanceof Is&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Qa)return!1;let t=!0;return e.eachChild(i=>{t&&!to(i)&&(t=!1)}),t}function ks(e){if(e instanceof Is&&e.name==="feature-state")return!1;let t=!0;return e.eachChild(i=>{t&&!ks(i)&&(t=!1)}),t}function vr(e,t){if(e instanceof Is&&t.indexOf(e.name)>=0)return!1;let i=!0;return e.eachChild(l=>{i&&!vr(l,t)&&(i=!1)}),i}class tl{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=t[1];return i.scope.has(l)?new tl(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Tu=tl;class Jo{constructor(t,i=[],l,h=new mu,f=[]){this.registry=t,this.path=i,this.key=i.map(m=>`[${m}]`).join(""),this.scope=h,this.errors=f,this.expectedType=l}parse(t,i,l,h,f={}){return i?this.concat(i,l,h)._parse(t,f):this._parse(t,f)}_parse(t,i){function l(h,f,m){return m==="assert"?new Cs(f,[h]):m==="coerce"?new Yr(f,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[h];if(f){let m=f.parse(t,this);if(!m)return null;if(this.expectedType){const x=this.expectedType,w=m.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||w.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string"){if(this.checkSubtype(x,w))return null}else m=l(m,x,i.typeAnnotation||"coerce");else m=l(m,x,i.typeAnnotation||"assert")}if(!(m instanceof yr)&&m.type.kind!=="resolvedImage"&&Ec(m)){const x=new gc;try{m=new yr(m.type,m.evaluate(x))}catch(w){return this.error(w.message),null}}return m}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,l){const h=typeof t=="number"?this.path.concat(t):this.path,f=l?this.scope.concat(l):this.scope;return new Jo(this.registry,h,i||null,f,this.errors)}error(t,...i){const l=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new us(l,t))}checkSubtype(t,i){const l=As(t,i);return l&&this.error(l),l}}var Tc=Jo;function Ec(e){if(e instanceof Tu)return Ec(e.boundExpression);if(e instanceof Is&&e.name==="error"||e instanceof Yo||e instanceof Qa)return!1;const t=e instanceof Yr||e instanceof Cs;let i=!0;return e.eachChild(l=>{i=t?i&&Ec(l):i&&l instanceof yr}),!!i&&to(e)&&vr(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function el(e,t){const i=e.length-1;let l,h,f=0,m=i,x=0;for(;f<=m;)if(x=Math.floor((f+m)/2),l=e[x],h=e[x+1],l<=t){if(x===i||t<h)return x;f=x+1}else{if(!(l>t))throw new an("Input is not a number.");m=x-1}return 0}class il{constructor(t,i,l){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,f]of l)this.labels.push(h),this.outputs.push(f)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(t[1],1,le);if(!l)return null;const h=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<t.length;m+=2){const x=m===1?-1/0:t[m],w=t[m+1],E=m,A=m+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const k=i.parse(w,A,f);if(!k)return null;f=f||k.type,h.push([x,k])}return new il(f,l,h)}evaluate(t){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return l[0].evaluate(t);const f=i.length;return h>=i[f-1]?l[f-1].evaluate(t):l[el(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}var Sc=il;function Ue(e,t,i){return e*(1-i)+t*i}var Qo=Object.freeze({__proto__:null,array:function(e,t,i){return e.map((l,h)=>Ue(l,t[h],i))},color:function(e,t,i){return new Bi(Ue(e.r,t.r,i),Ue(e.g,t.g,i),Ue(e.b,t.b,i),Ue(e.a,t.a,i))},number:Ue});const Eu=.95047,Mc=1.08883,Su=4/29,br=6/29,Ac=3*br*br,Np=br*br*br,jp=Math.PI/180,Vp=180/Math.PI;function Cc(e){return e>Np?Math.pow(e,1/3):e/Ac+Su}function Ic(e){return e>br?e*e*e:Ac*(e-Su)}function Pc(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function nl(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Mu(e){const t=nl(e.r),i=nl(e.g),l=nl(e.b),h=Cc((.4124564*t+.3575761*i+.1804375*l)/Eu),f=Cc((.2126729*t+.7151522*i+.072175*l)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-Cc((.0193339*t+.119192*i+.9503041*l)/Mc)),alpha:e.a}}function Au(e){let t=(e.l+16)/116,i=isNaN(e.a)?t:t+e.a/500,l=isNaN(e.b)?t:t-e.b/200;return t=1*Ic(t),i=Eu*Ic(i),l=Mc*Ic(l),new Bi(Pc(3.2404542*i-1.5371385*t-.4985314*l),Pc(-.969266*i+1.8760108*t+.041556*l),Pc(.0556434*i-.2040259*t+1.0572252*l),e.alpha)}function Up(e,t,i){const l=t-e;return e+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const ta={forward:Mu,reverse:Au,interpolate:function(e,t,i){return{l:Ue(e.l,t.l,i),a:Ue(e.a,t.a,i),b:Ue(e.b,t.b,i),alpha:Ue(e.alpha,t.alpha,i)}}},eo={forward:function(e){const{l:t,a:i,b:l}=Mu(e),h=Math.atan2(l,i)*Vp;return{h:h<0?h+360:h,c:Math.sqrt(i*i+l*l),l:t,alpha:e.a}},reverse:function(e){const t=e.h*jp,i=e.c;return Au({l:e.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:e.alpha})},interpolate:function(e,t,i){return{h:Up(e.h,t.h,i),c:Ue(e.c,t.c,i),l:Ue(e.l,t.l,i),alpha:Ue(e.alpha,t.alpha,i)}}};var kc=Object.freeze({__proto__:null,hcl:eo,lab:ta});class ea{constructor(t,i,l,h,f){this.type=t,this.operator=i,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[m,x]of f)this.labels.push(m),this.outputs.push(x)}static interpolationFactor(t,i,l,h){let f=0;if(t.name==="exponential")f=Dc(i,t.base,l,h);else if(t.name==="linear")f=Dc(i,1,l,h);else if(t.name==="cubic-bezier"){const m=t.controlPoints;f=new Jt(m[0],m[1],m[2],m[3]).solve(Dc(i,1,l,h))}return f}static parse(t,i){let[l,h,f,...m]=t;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,le),!f)return null;const x=[];let w=null;l==="interpolate-hcl"||l==="interpolate-lab"?w=On:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let E=0;E<m.length;E+=2){const A=m[E],k=m[E+1],D=E+3,O=E+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(x.length&&x[x.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',D);const B=i.parse(k,O,w);if(!B)return null;w=w||B.type,x.push([A,B])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new ea(w,l,h,f,x):i.error(`Type ${bi(w)} is not interpolatable.`)}evaluate(t){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return l[0].evaluate(t);const f=i.length;if(h>=i[f-1])return l[f-1].evaluate(t);const m=el(i,h),x=ea.interpolationFactor(this.interpolation,h,i[m],i[m+1]),w=l[m].evaluate(t),E=l[m+1].evaluate(t);return this.operator==="interpolate"?Qo[this.type.kind.toLowerCase()](w,E,x):this.operator==="interpolate-hcl"?eo.reverse(eo.interpolate(eo.forward(w),eo.forward(E),x)):ta.reverse(ta.interpolate(ta.forward(w),ta.forward(E),x))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,t,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function Dc(e,t,i,l){const h=l-i,f=e-i;return h===0?0:t===1?f/h:(Math.pow(t,f)-1)/(Math.pow(t,h)-1)}var ps=ea;class sl{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let l=null;const h=i.expectedType;h&&h.kind!=="value"&&(l=h);const f=[];for(const x of t.slice(1)){const w=i.parse(x,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,f.push(w)}const m=h&&f.some(x=>As(h,x.type));return new sl(m?Oe:l,f)}evaluate(t){let i,l=null,h=0;for(const f of this.args){if(h++,l=f.evaluate(t),l&&l instanceof Gn&&!l.available&&(i||(i=l),l=null,h===this.args.length))return i;if(l!==null)break}return l}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Lc=sl;class rl{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const l=[];for(let f=1;f<t.length-1;f+=2){const m=t[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=i.parse(t[f+1],f+1);if(!x)return null;l.push([m,x])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,l);return h?new rl(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,l]of this.bindings)t.push(i,l.serialize());return t.push(this.result.serialize()),t}}var Cu=rl;class zc{constructor(t,i,l){this.type=t,this.index=i,this.input=l}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=i.parse(t[1],1,le),h=i.parse(t[2],2,Un(i.expectedType||Oe));return l&&h?new zc(h.type.itemType,l,h):null}evaluate(t){const i=this.index.evaluate(t),l=this.input.evaluate(t);if(i<0)throw new an(`Array index out of bounds: ${i} < 0.`);if(i>=l.length)throw new an(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i!==Math.floor(i))throw new an(`Array index must be an integer, but found ${i} instead.`);return l[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Gp=zc;class Rc{constructor(t,i){this.type=Re,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const l=i.parse(t[1],1,Oe),h=i.parse(t[2],2,Oe);return l&&h?qo(l.type,[Re,Fe,le,Hr,Oe])?new Rc(l,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(l.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(l==null)return!1;if(!$o(i,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Di(i))} instead.`);if(!$o(l,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${bi(Di(l))} instead.`);return l.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ol=Rc;class ia{constructor(t,i,l){this.type=le,this.needle=t,this.haystack=i,this.fromIndex=l}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=i.parse(t[1],1,Oe),h=i.parse(t[2],2,Oe);if(!l||!h)return null;if(!qo(l.type,[Re,Fe,le,Hr,Oe]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${bi(l.type)} instead`);if(t.length===4){const f=i.parse(t[3],3,le);return f?new ia(l,h,f):null}return new ia(l,h)}evaluate(t){const i=this.needle.evaluate(t),l=this.haystack.evaluate(t);if(!$o(i,["boolean","string","number","null"]))throw new an(`Expected first argument to be of type boolean, string, number or null, but found ${bi(Di(i))} instead.`);if(!$o(l,["string","array"]))throw new an(`Expected second argument to be of type array or string, but found ${bi(Di(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return l.indexOf(i,h)}return l.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Iu=ia;class Oc{constructor(t,i,l,h,f,m){this.inputType=t,this.type=i,this.input=l,this.cases=h,this.outputs=f,this.otherwise=m}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let l,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const f={},m=[];for(let E=2;E<t.length-1;E+=2){let A=t[E];const k=t[E+1];Array.isArray(A)||(A=[A]);const D=i.concat(E);if(A.length===0)return D.error("Expected at least one branch label.");for(const B of A){if(typeof B!="number"&&typeof B!="string")return D.error("Branch labels must be numbers or strings.");if(typeof B=="number"&&Math.abs(B)>Number.MAX_SAFE_INTEGER)return D.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof B=="number"&&Math.floor(B)!==B)return D.error("Numeric branch labels must be integer values.");if(l){if(D.checkSubtype(l,Di(B)))return null}else l=Di(B);if(f[String(B)]!==void 0)return D.error("Branch labels must be unique.");f[String(B)]=m.length}const O=i.parse(k,E,h);if(!O)return null;h=h||O.type,m.push(O)}const x=i.parse(t[1],1,Oe);if(!x)return null;const w=i.parse(t[t.length-1],t.length-1,h);return w?x.type.kind!=="value"&&i.concat(1).checkSubtype(l,x.type)?null:new Oc(l,h,x,f,m,w):null}evaluate(t){const i=this.input.evaluate(t);return(Di(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],h={};for(const m of i){const x=h[this.cases[m]];x===void 0?(h[this.cases[m]]=l.length,l.push([this.cases[m],[m]])):l[x][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,x]of l)t.push(x.length===1?f(x[0]):x.map(f)),t.push(this.outputs[m].serialize());return t.push(this.otherwise.serialize()),t}}var qp=Oc;class Bc{constructor(t,i,l){this.type=t,this.branches=i,this.otherwise=l}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h=[];for(let m=1;m<t.length-1;m+=2){const x=i.parse(t[m],m,Re);if(!x)return null;const w=i.parse(t[m+1],m+1,l);if(!w)return null;h.push([x,w]),l=l||w.type}const f=i.parse(t[t.length-1],t.length-1,l);return f?new Bc(l,h,f):null}evaluate(t){for(const[i,l]of this.branches)if(i.evaluate(t))return l.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,l]of this.branches)t(i),t(l);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}var Pu=Bc;class na{constructor(t,i,l,h){this.type=t,this.input=i,this.beginIndex=l,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const l=i.parse(t[1],1,Oe),h=i.parse(t[2],2,le);if(!l||!h)return null;if(!qo(l.type,[Un(Oe),Fe,Oe]))return i.error(`Expected first argument to be of type array or string, but found ${bi(l.type)} instead`);if(t.length===4){const f=i.parse(t[3],3,le);return f?new na(l.type,l,h,f):null}return new na(l.type,l,h)}evaluate(t){const i=this.input.evaluate(t),l=this.beginIndex.evaluate(t);if(!$o(i,["string","array"]))throw new an(`Expected first argument to be of type array or string, but found ${bi(Di(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return i.slice(l,h)}return i.slice(l)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ku=na;function al(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Du(e,t,i,l){return l.compare(t,i)===0}function io(e,t,i){const l=e!=="=="&&e!=="!=";return class z1{constructor(f,m,x){this.type=Re,this.lhs=f,this.rhs=m,this.collator=x,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const x=f[0];let w=m.parse(f[1],1,Oe);if(!w)return null;if(!al(x,w.type))return m.concat(1).error(`"${x}" comparisons are not supported for type '${bi(w.type)}'.`);let E=m.parse(f[2],2,Oe);if(!E)return null;if(!al(x,E.type))return m.concat(2).error(`"${x}" comparisons are not supported for type '${bi(E.type)}'.`);if(w.type.kind!==E.type.kind&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${bi(w.type)}' and '${bi(E.type)}'.`);l&&(w.type.kind==="value"&&E.type.kind!=="value"?w=new Cs(E.type,[w]):w.type.kind!=="value"&&E.type.kind==="value"&&(E=new Cs(w.type,[E])));let A=null;if(f.length===4){if(w.type.kind!=="string"&&E.type.kind!=="string"&&w.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(A=m.parse(f[3],3,Bn),!A)return null}return new z1(w,E,A)}evaluate(f){const m=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const w=Di(m),E=Di(x);if(w.kind!==E.kind||w.kind!=="string"&&w.kind!=="number")throw new an(`Expected arguments for "${e}" to be (string, string) or (number, number), but found (${w.kind}, ${E.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Di(m),E=Di(x);if(w.kind!=="string"||E.kind!=="string")return t(f,m,x)}return this.collator?i(f,m,x,this.collator.evaluate(f)):t(f,m,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[e];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const $p=io("==",function(e,t,i){return t===i},Du),Wp=io("!=",function(e,t,i){return t!==i},function(e,t,i,l){return!Du(0,t,i,l)}),Zp=io("<",function(e,t,i){return t<i},function(e,t,i,l){return l.compare(t,i)<0}),Hp=io(">",function(e,t,i){return t>i},function(e,t,i,l){return l.compare(t,i)>0}),Xp=io("<=",function(e,t,i){return t<=i},function(e,t,i,l){return l.compare(t,i)<=0}),Lu=io(">=",function(e,t,i){return t>=i},function(e,t,i,l){return l.compare(t,i)>=0});class ll{constructor(t,i,l,h,f,m){this.type=Fe,this.number=t,this.locale=i,this.currency=l,this.unit=h,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const l=i.parse(t[1],1,le);if(!l)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=i.parse(h.locale,1,Fe),!f))return null;let m=null;if(h.currency&&(m=i.parse(h.currency,1,Fe),!m))return null;let x=null;if(h.unit&&(x=i.parse(h.unit,1,Fe),!x))return null;let w=null;if(h["min-fraction-digits"]&&(w=i.parse(h["min-fraction-digits"],1,le),!w))return null;let E=null;return h["max-fraction-digits"]&&(E=i.parse(h["max-fraction-digits"],1,le),!E)?null:new ll(l,f,m,x,w,E)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class no{constructor(t){this.type=le,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const l=i.parse(t[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${bi(l.type)} instead.`):new no(l):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new an(`Expected value to be of type string or array, but found ${bi(Di(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}const zu={"==":$p,"!=":Wp,">":Hp,"<":Zp,">=":Lu,"<=":Xp,array:Cs,at:Gp,boolean:Cs,case:Pu,coalesce:Lc,collator:Yo,format:Ks,image:Ya,in:ol,"index-of":Iu,interpolate:ps,"interpolate-hcl":ps,"interpolate-lab":ps,length:no,let:Cu,literal:yr,match:qp,number:Cs,"number-format":ll,object:Cs,slice:ku,step:Sc,string:Cs,"to-boolean":Yr,"to-color":Yr,"to-number":Yr,"to-string":Yr,var:Tu,within:Qa};function Ru(e,[t,i,l,h]){t=t.evaluate(e),i=i.evaluate(e),l=l.evaluate(e);const f=h?h.evaluate(e):1,m=xu(t,i,l,f);if(m)throw new an(m);return new Bi(t/255*f,i/255*f,l/255*f,f)}function Ds(e,t){return e in t}function cl(e,t){const i=t[e];return i===void 0?null:i}function qn(e){return{type:e}}Is.register(zu,{error:[{kind:"error"},[Fe],(e,[t])=>{throw new an(t.evaluate(e))}],typeof:[Fe,[Oe],(e,[t])=>bi(Di(t.evaluate(e)))],"to-rgba":[Un(le,4),[On],(e,[t])=>t.evaluate(e).toArray()],rgb:[On,[le,le,le],Ru],rgba:[On,[le,le,le,le],Ru],has:{type:Re,overloads:[[[Fe],(e,[t])=>Ds(t.evaluate(e),e.properties())],[[Fe,ts],(e,[t,i])=>Ds(t.evaluate(e),i.evaluate(e))]]},get:{type:Oe,overloads:[[[Fe],(e,[t])=>cl(t.evaluate(e),e.properties())],[[Fe,ts],(e,[t,i])=>cl(t.evaluate(e),i.evaluate(e))]]},"feature-state":[Oe,[Fe],(e,[t])=>cl(t.evaluate(e),e.featureState||{})],properties:[ts,[],e=>e.properties()],"geometry-type":[Fe,[],e=>e.geometryType()],id:[Oe,[],e=>e.id()],zoom:[le,[],e=>e.globals.zoom],pitch:[le,[],e=>e.globals.pitch||0],"distance-from-center":[le,[],e=>e.distanceFromCenter()],"heatmap-density":[le,[],e=>e.globals.heatmapDensity||0],"line-progress":[le,[],e=>e.globals.lineProgress||0],"sky-radial-progress":[le,[],e=>e.globals.skyRadialProgress||0],accumulated:[Oe,[],e=>e.globals.accumulated===void 0?null:e.globals.accumulated],"+":[le,qn(le),(e,t)=>{let i=0;for(const l of t)i+=l.evaluate(e);return i}],"*":[le,qn(le),(e,t)=>{let i=1;for(const l of t)i*=l.evaluate(e);return i}],"-":{type:le,overloads:[[[le,le],(e,[t,i])=>t.evaluate(e)-i.evaluate(e)],[[le],(e,[t])=>-t.evaluate(e)]]},"/":[le,[le,le],(e,[t,i])=>t.evaluate(e)/i.evaluate(e)],"%":[le,[le,le],(e,[t,i])=>t.evaluate(e)%i.evaluate(e)],ln2:[le,[],()=>Math.LN2],pi:[le,[],()=>Math.PI],e:[le,[],()=>Math.E],"^":[le,[le,le],(e,[t,i])=>Math.pow(t.evaluate(e),i.evaluate(e))],sqrt:[le,[le],(e,[t])=>Math.sqrt(t.evaluate(e))],log10:[le,[le],(e,[t])=>Math.log(t.evaluate(e))/Math.LN10],ln:[le,[le],(e,[t])=>Math.log(t.evaluate(e))],log2:[le,[le],(e,[t])=>Math.log(t.evaluate(e))/Math.LN2],sin:[le,[le],(e,[t])=>Math.sin(t.evaluate(e))],cos:[le,[le],(e,[t])=>Math.cos(t.evaluate(e))],tan:[le,[le],(e,[t])=>Math.tan(t.evaluate(e))],asin:[le,[le],(e,[t])=>Math.asin(t.evaluate(e))],acos:[le,[le],(e,[t])=>Math.acos(t.evaluate(e))],atan:[le,[le],(e,[t])=>Math.atan(t.evaluate(e))],min:[le,qn(le),(e,t)=>Math.min(...t.map(i=>i.evaluate(e)))],max:[le,qn(le),(e,t)=>Math.max(...t.map(i=>i.evaluate(e)))],abs:[le,[le],(e,[t])=>Math.abs(t.evaluate(e))],round:[le,[le],(e,[t])=>{const i=t.evaluate(e);return i<0?-Math.round(-i):Math.round(i)}],floor:[le,[le],(e,[t])=>Math.floor(t.evaluate(e))],ceil:[le,[le],(e,[t])=>Math.ceil(t.evaluate(e))],"filter-==":[Re,[Fe,Oe],(e,[t,i])=>e.properties()[t.value]===i.value],"filter-id-==":[Re,[Oe],(e,[t])=>e.id()===t.value],"filter-type-==":[Re,[Fe],(e,[t])=>e.geometryType()===t.value],"filter-<":[Re,[Fe,Oe],(e,[t,i])=>{const l=e.properties()[t.value],h=i.value;return typeof l==typeof h&&l<h}],"filter-id-<":[Re,[Oe],(e,[t])=>{const i=e.id(),l=t.value;return typeof i==typeof l&&i<l}],"filter->":[Re,[Fe,Oe],(e,[t,i])=>{const l=e.properties()[t.value],h=i.value;return typeof l==typeof h&&l>h}],"filter-id->":[Re,[Oe],(e,[t])=>{const i=e.id(),l=t.value;return typeof i==typeof l&&i>l}],"filter-<=":[Re,[Fe,Oe],(e,[t,i])=>{const l=e.properties()[t.value],h=i.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[Re,[Oe],(e,[t])=>{const i=e.id(),l=t.value;return typeof i==typeof l&&i<=l}],"filter->=":[Re,[Fe,Oe],(e,[t,i])=>{const l=e.properties()[t.value],h=i.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[Re,[Oe],(e,[t])=>{const i=e.id(),l=t.value;return typeof i==typeof l&&i>=l}],"filter-has":[Re,[Oe],(e,[t])=>t.value in e.properties()],"filter-has-id":[Re,[],e=>e.id()!==null&&e.id()!==void 0],"filter-type-in":[Re,[Un(Fe)],(e,[t])=>t.value.indexOf(e.geometryType())>=0],"filter-id-in":[Re,[Un(Oe)],(e,[t])=>t.value.indexOf(e.id())>=0],"filter-in-small":[Re,[Fe,Un(Oe)],(e,[t,i])=>i.value.indexOf(e.properties()[t.value])>=0],"filter-in-large":[Re,[Fe,Un(Oe)],(e,[t,i])=>function(l,h,f,m){for(;f<=m;){const x=f+m>>1;if(h[x]===l)return!0;h[x]>l?m=x-1:f=x+1}return!1}(e.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Re,overloads:[[[Re,Re],(e,[t,i])=>t.evaluate(e)&&i.evaluate(e)],[qn(Re),(e,t)=>{for(const i of t)if(!i.evaluate(e))return!1;return!0}]]},any:{type:Re,overloads:[[[Re,Re],(e,[t,i])=>t.evaluate(e)||i.evaluate(e)],[qn(Re),(e,t)=>{for(const i of t)if(i.evaluate(e))return!0;return!1}]]},"!":[Re,[Re],(e,[t])=>!t.evaluate(e)],"is-supported-script":[Re,[Fe],(e,[t])=>{const i=e.globals&&e.globals.isSupportedScript;return!i||i(t.evaluate(e))}],upcase:[Fe,[Fe],(e,[t])=>t.evaluate(e).toUpperCase()],downcase:[Fe,[Fe],(e,[t])=>t.evaluate(e).toLowerCase()],concat:[Fe,qn(Oe),(e,t)=>t.map(i=>Xo(i.evaluate(e))).join("")],"resolved-locale":[Fe,[Bn],(e,[t])=>t.evaluate(e).resolvedLocale()]});var sa=zu;function Ou(e){return{result:"success",value:e}}function wr(e){return{result:"error",value:e}}function so(e){return e["property-type"]==="data-driven"}function hl(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function ul(e){return!!e.expression&&e.expression.interpolated}function qe(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function ra(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Bu(e){return e}function dl(e,t){const i=t.type==="color",l=e.stops&&typeof e.stops[0][0]=="object",h=l||!(l||e.property!==void 0),f=e.type||(ul(t)?"exponential":"interval");if(i&&((e=Ms({},e)).stops&&(e.stops=e.stops.map(E=>[E[0],Bi.parse(E[1])])),e.default=Bi.parse(e.default?e.default:t.default)),e.colorSpace&&e.colorSpace!=="rgb"&&!kc[e.colorSpace])throw new Error(`Unknown color space: ${e.colorSpace}`);let m,x,w;if(f==="exponential")m=Ls;else if(f==="interval")m=pl;else if(f==="categorical"){m=Fu,x=Object.create(null);for(const E of e.stops)x[E[0]]=E[1];w=typeof e.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=Nu}if(l){const E={},A=[];for(let O=0;O<e.stops.length;O++){const B=e.stops[O],V=B[0].zoom;E[V]===void 0&&(E[V]={zoom:V,type:e.type,property:e.property,default:e.default,stops:[]},A.push(V)),E[V].stops.push([B[0].value,B[1]])}const k=[];for(const O of A)k.push([E[O].zoom,dl(E[O],t)]);const D={name:"linear"};return{kind:"composite",interpolationType:D,interpolationFactor:ps.interpolationFactor.bind(void 0,D),zoomStops:k.map(O=>O[0]),evaluate:({zoom:O},B)=>Ls({stops:k,base:e.base},t,O).evaluate(O,B)}}if(h){const E=f==="exponential"?{name:"exponential",base:e.base!==void 0?e.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:ps.interpolationFactor.bind(void 0,E),zoomStops:e.stops.map(A=>A[0]),evaluate:({zoom:A})=>m(e,t,A,x,w)}}return{kind:"source",evaluate(E,A){const k=A&&A.properties?A.properties[e.property]:void 0;return k===void 0?ro(e.default,t.default):m(e,t,k,x,w)}}}function ro(e,t,i){return e!==void 0?e:t!==void 0?t:i!==void 0?i:void 0}function Fu(e,t,i,l,h){return ro(typeof i===h?l[i]:void 0,e.default,t.default)}function pl(e,t,i){if(qe(i)!=="number")return ro(e.default,t.default);const l=e.stops.length;if(l===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[l-1][0])return e.stops[l-1][1];const h=el(e.stops.map(f=>f[0]),i);return e.stops[h][1]}function Ls(e,t,i){const l=e.base!==void 0?e.base:1;if(qe(i)!=="number")return ro(e.default,t.default);const h=e.stops.length;if(h===1||i<=e.stops[0][0])return e.stops[0][1];if(i>=e.stops[h-1][0])return e.stops[h-1][1];const f=el(e.stops.map(A=>A[0]),i),m=function(A,k,D,O){const B=O-D,V=A-D;return B===0?0:k===1?V/B:(Math.pow(k,V)-1)/(Math.pow(k,B)-1)}(i,l,e.stops[f][0],e.stops[f+1][0]),x=e.stops[f][1],w=e.stops[f+1][1];let E=Qo[t.type]||Bu;if(e.colorSpace&&e.colorSpace!=="rgb"){const A=kc[e.colorSpace];E=(k,D)=>A.reverse(A.interpolate(A.forward(k),A.forward(D),m))}return typeof x.evaluate=="function"?{evaluate(...A){const k=x.evaluate.apply(void 0,A),D=w.evaluate.apply(void 0,A);if(k!==void 0&&D!==void 0)return E(k,D,m)}}:E(x,w,m)}function Nu(e,t,i){return t.type==="color"?i=Bi.parse(i):t.type==="formatted"?i=Tn.fromString(i.toString()):t.type==="resolvedImage"?i=Gn.fromString(i.toString()):qe(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),ro(i,e.default,t.default)}class fl{constructor(t,i){this.expression=t,this._warningHistory={},this._evaluator=new gc,this._defaultValue=i?function(l){return l.type==="color"&&(ra(l.default)||Array.isArray(l.default))?new Bi(0,0,0,0):l.type==="color"?Bi.parse(l.default)||null:l.default===void 0?null:l.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(t,i,l,h,f,m,x,w){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,l,h,f,m,x,w){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new an(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function oo(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in sa}function ao(e,t){const i=new Tc(sa,[],t?function(h){const f={color:On,string:Fe,number:le,enum:Fe,boolean:Re,formatted:Go,resolvedImage:gr};return h.type==="array"?Un(f[h.value]||Oe,h.length):f[h.type]}(t):void 0),l=i.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return l?Ou(new fl(l,t)):wr(i.errors)}class Fc{constructor(t,i){this.kind=t,this._styleExpression=i,this.isStateDependent=t!=="constant"&&!ks(i.expression)}evaluateWithoutErrorHandling(t,i,l,h,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,i,l,h,f,m)}evaluate(t,i,l,h,f,m){return this._styleExpression.evaluate(t,i,l,h,f,m)}}class oa{constructor(t,i,l,h){this.kind=t,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!ks(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,l,h,f,m){return this._styleExpression.evaluateWithoutErrorHandling(t,i,l,h,f,m)}evaluate(t,i,l,h,f,m){return this._styleExpression.evaluate(t,i,l,h,f,m)}interpolationFactor(t,i,l){return this.interpolationType?ps.interpolationFactor(this.interpolationType,t,i,l):0}}function aa(e,t){if((e=ao(e,t)).result==="error")return e;const i=e.value.expression,l=to(i);if(!l&&!so(t))return wr([new us("","data expressions not supported")]);const h=vr(i,["zoom","pitch","distance-from-center"]);if(!h&&!hl(t))return wr([new us("","zoom expressions not supported")]);const f=ml(i);return f||h?f instanceof us?wr([f]):f instanceof ps&&!ul(t)?wr([new us("",'"interpolate" expressions cannot be used with this property')]):Ou(f?new oa(l?"camera":"composite",e.value,f.labels,f instanceof ps?f.interpolation:void 0):new Fc(l?"constant":"source",e.value)):wr([new us("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class _l{constructor(t,i){this._parameters=t,this._specification=i,Ms(this,dl(this._parameters,this._specification))}static deserialize(t){return new _l(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function ml(e){let t=null;if(e instanceof Cu)t=ml(e.result);else if(e instanceof Lc){for(const i of e.args)if(t=ml(i),t)break}else(e instanceof Sc||e instanceof ps)&&e.input instanceof Is&&e.input.name==="zoom"&&(t=e);return t instanceof us||e.eachChild(i=>{const l=ml(i);l instanceof us?t=l:!t&&l?t=new us("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&l&&t!==l&&(t=new us("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}class ce{constructor(t,i,l,h){this.message=(t?`${t}: `:"")+l,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function es(e){const t=e.key,i=e.value,l=e.valueSpec||{},h=e.objectElementValidators||{},f=e.style,m=e.styleSpec;let x=[];const w=qe(i);if(w!=="object")return[new ce(t,i,`object expected, ${w} found`)];for(const E in i){const A=E.split(".")[0];let k;h[A]?k=h[A]:l[A]?k=dn:h["*"]?k=h["*"]:l["*"]&&(k=dn),k?x=x.concat(k({key:(t&&`${t}.`)+E,value:i[E],valueSpec:l[A]||l["*"],style:f,styleSpec:m,object:i,objectKey:E},i)):x.push(new ce(t,i[E],`unknown property "${E}"`))}for(const E in l)h[E]||l[E].required&&l[E].default===void 0&&i[E]===void 0&&x.push(new ce(t,i,`missing required property "${E}"`));return x}function ju(e){const t=e.value,i=e.valueSpec,l=e.style,h=e.styleSpec,f=e.key,m=e.arrayElementValidator||dn;if(qe(t)!=="array")return[new ce(f,t,`array expected, ${qe(t)} found`)];if(i.length&&t.length!==i.length)return[new ce(f,t,`array length ${i.length} expected, length ${t.length} found`)];if(i["min-length"]&&t.length<i["min-length"])return[new ce(f,t,`array length at least ${i["min-length"]} expected, length ${t.length} found`)];let x={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};h.$version<7&&(x.function=i.function),qe(i.value)==="object"&&(x=i.value);let w=[];for(let E=0;E<t.length;E++)w=w.concat(m({array:t,arrayIndex:E,value:t[E],valueSpec:x,style:l,styleSpec:h,key:`${f}[${E}]`}));return w}function la(e){const t=e.key,i=e.value,l=e.valueSpec;let h=qe(i);if(h==="number"&&i!=i&&(h="NaN"),h!=="number")return[new ce(t,i,`number expected, ${h} found`)];if("minimum"in l){let f=l.minimum;if(qe(l.minimum)==="array"&&(f=l.minimum[e.arrayIndex]),i<f)return[new ce(t,i,`${i} is less than the minimum value ${f}`)]}if("maximum"in l){let f=l.maximum;if(qe(l.maximum)==="array"&&(f=l.maximum[e.arrayIndex]),i>f)return[new ce(t,i,`${i} is greater than the maximum value ${f}`)]}return[]}function ca(e){const t=e.valueSpec,i=ji(e.value.type);let l,h,f,m={};const x=i!=="categorical"&&e.value.property===void 0,w=!x,E=qe(e.value.stops)==="array"&&qe(e.value.stops[0])==="array"&&qe(e.value.stops[0][0])==="object",A=es({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(O){if(i==="identity")return[new ce(O.key,O.value,'identity function may not have a "stops" property')];let B=[];const V=O.value;return B=B.concat(ju({key:O.key,value:V,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:k})),qe(V)==="array"&&V.length===0&&B.push(new ce(O.key,V,"array must have at least one stop")),B},default:function(O){return dn({key:O.key,value:O.value,valueSpec:t,style:O.style,styleSpec:O.styleSpec})}}});return i==="identity"&&x&&A.push(new ce(e.key,e.value,'missing required property "property"')),i==="identity"||e.value.stops||A.push(new ce(e.key,e.value,'missing required property "stops"')),i==="exponential"&&e.valueSpec.expression&&!ul(e.valueSpec)&&A.push(new ce(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(w&&!so(e.valueSpec)?A.push(new ce(e.key,e.value,"property functions not supported")):x&&!hl(e.valueSpec)&&A.push(new ce(e.key,e.value,"zoom functions not supported"))),i!=="categorical"&&!E||e.value.property!==void 0||A.push(new ce(e.key,e.value,'"property" property is required')),A;function k(O){let B=[];const V=O.value,Z=O.key;if(qe(V)!=="array")return[new ce(Z,V,`array expected, ${qe(V)} found`)];if(V.length!==2)return[new ce(Z,V,`array length 2 expected, length ${V.length} found`)];if(E){if(qe(V[0])!=="object")return[new ce(Z,V,`object expected, ${qe(V[0])} found`)];if(V[0].zoom===void 0)return[new ce(Z,V,"object stop key must have zoom")];if(V[0].value===void 0)return[new ce(Z,V,"object stop key must have value")];const tt=ji(V[0].zoom);if(typeof tt!="number")return[new ce(Z,V[0].zoom,"stop zoom values must be numbers")];if(f&&f>tt)return[new ce(Z,V[0].zoom,"stop zoom values must appear in ascending order")];tt!==f&&(f=tt,h=void 0,m={}),B=B.concat(es({key:`${Z}[0]`,value:V[0],valueSpec:{zoom:{}},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{zoom:la,value:D}}))}else B=B.concat(D({key:`${Z}[0]`,value:V[0],valueSpec:{},style:O.style,styleSpec:O.styleSpec},V));return oo(tn(V[1]))?B.concat([new ce(`${Z}[1]`,V[1],"expressions are not allowed in function stops.")]):B.concat(dn({key:`${Z}[1]`,value:V[1],valueSpec:t,style:O.style,styleSpec:O.styleSpec}))}function D(O,B){const V=qe(O.value),Z=ji(O.value),tt=O.value!==null?O.value:B;if(l){if(V!==l)return[new ce(O.key,tt,`${V} stop domain type must match previous stop domain type ${l}`)]}else l=V;if(V!=="number"&&V!=="string"&&V!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new ce(O.key,tt,"stop domain value must be a number, string, or boolean")];if(V!=="number"&&i!=="categorical"){let lt=`number expected, ${V} found`;return so(t)&&i===void 0&&(lt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ce(O.key,tt,lt)]}return i!=="categorical"||V!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?i!=="categorical"&&V==="number"&&typeof Z=="number"&&typeof h=="number"&&h!==void 0&&Z<h?[new ce(O.key,tt,"stop domain values must appear in ascending order")]:(h=Z,i==="categorical"&&Z in m?[new ce(O.key,tt,"stop domain values must be unique")]:(m[Z]=!0,[])):[new ce(O.key,tt,`integer expected, found ${String(Z)}`)]}}function en(e){const t=(e.expressionContext==="property"?aa:ao)(tn(e.value),e.valueSpec);if(t.result==="error")return t.value.map(l=>new ce(`${e.key}${l.key}`,e.value,l.message));const i=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!i.outputDefined())return[new ce(e.key,e.value,`Invalid data expression for "${e.propertyKey}". Output values must be contained as literals within the expression.`)];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ks(i))return[new ce(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter")return ha(i,e);if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!vr(i,["zoom","feature-state"]))return[new ce(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!to(i))return[new ce(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ha(e,t){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const h of t.valueSpec.expression.parameters)i.delete(h);if(i.size===0)return[];const l=[];return e instanceof Is&&i.has(e.name)?[new ce(t.key,t.value,`["${e.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(e.eachChild(h=>{l.push(...ha(h,t))}),l)}function gl(e){const t=e.key,i=e.value,l=e.valueSpec,h=[];return Array.isArray(l.values)?l.values.indexOf(ji(i))===-1&&h.push(new ce(t,i,`expected one of [${l.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(l.values).indexOf(ji(i))===-1&&h.push(new ce(t,i,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function Nc(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Nc(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function yl(e,t="fill"){if(e==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Nc(e)||(e=co(e));const i=e;let l=!0;try{l=function(E){if(!lo(E))return E;let A=tn(E);return xl(A),A=Vu(A),A}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const h=Ot[`filter_${t}`],f=ao(l,h);let m=null;if(f.result==="error")throw new Error(f.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,A,k)=>f.value.evaluate(E,A,{},k);let x=null,w=null;if(l!==i){const E=ao(i,h);if(E.result==="error")throw new Error(E.value.map(A=>`${A.key}: ${A.message}`).join(", "));x=(A,k,D,O,B)=>E.value.evaluate(A,k,{},D,void 0,void 0,O,B),w=!to(E.value.expression)}return{filter:m,dynamicFilter:x||void 0,needGeometry:Uu(l),needFeature:!!w}}function Vu(e){if(!Array.isArray(e))return e;const t=function(i){if(jc.has(i[0])){for(let l=1;l<i.length;l++)if(lo(i[l]))return!0}return i}(e);return t===!0?t:t.map(i=>Vu(i))}function xl(e){let t=!1;const i=[];if(e[0]==="case"){for(let l=1;l<e.length-1;l+=2)t=t||lo(e[l]),i.push(e[l+1]);i.push(e[e.length-1])}else if(e[0]==="match"){t=t||lo(e[1]);for(let l=2;l<e.length-1;l+=2)i.push(e[l+1]);i.push(e[e.length-1])}else if(e[0]==="step"){t=t||lo(e[1]);for(let l=1;l<e.length-1;l+=2)i.push(e[l+1])}t&&(e.length=0,e.push("any",...i));for(let l=1;l<e.length;l++)xl(e[l])}function lo(e){if(!Array.isArray(e))return!1;if((t=e[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<e.length;i++)if(lo(e[i]))return!0;return!1}const jc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Yp(e,t){return e<t?-1:e>t?1:0}function Uu(e){if(!Array.isArray(e))return!1;if(e[0]==="within")return!0;for(let t=1;t<e.length;t++)if(Uu(e[t]))return!0;return!1}function co(e){if(!e)return!0;const t=e[0];return e.length<=1?t!=="any":t==="=="?Vc(e[1],e[2],"=="):t==="!="?vl(Vc(e[1],e[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Vc(e[1],e[2],t):t==="any"?(i=e.slice(1),["any"].concat(i.map(co))):t==="all"?["all"].concat(e.slice(1).map(co)):t==="none"?["all"].concat(e.slice(1).map(co).map(vl)):t==="in"?Uc(e[1],e.slice(2)):t==="!in"?vl(Uc(e[1],e.slice(2))):t==="has"?Gc(e[1]):t==="!has"?vl(Gc(e[1])):t!=="within"||e;var i}function Vc(e,t,i){switch(e){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,e,t]}}function Uc(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Yp)]]:["filter-in-small",e,["literal",t]]}}function Gc(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function vl(e){return["!",e]}function ua(e){return Nc(tn(e.value))?en(Ms({},e,{expressionContext:"filter",valueSpec:e.styleSpec[`filter_${e.layerType||"fill"}`]})):da(e)}function da(e){const t=e.value,i=e.key;if(qe(t)!=="array")return[new ce(i,t,`array expected, ${qe(t)} found`)];const l=e.styleSpec;let h,f=[];if(t.length<1)return[new ce(i,t,"filter array must have at least 1 element")];switch(f=f.concat(gl({key:`${i}[0]`,value:t[0],valueSpec:l.filter_operator,style:e.style,styleSpec:e.styleSpec})),ji(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&ji(t[1])==="$type"&&f.push(new ce(i,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&f.push(new ce(i,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=qe(t[1]),h!=="string"&&f.push(new ce(`${i}[1]`,t[1],`string expected, ${h} found`)));for(let m=2;m<t.length;m++)h=qe(t[m]),ji(t[1])==="$type"?f=f.concat(gl({key:`${i}[${m}]`,value:t[m],valueSpec:l.geometry_type,style:e.style,styleSpec:e.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&f.push(new ce(`${i}[${m}]`,t[m],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let m=1;m<t.length;m++)f=f.concat(da({key:`${i}[${m}]`,value:t[m],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":h=qe(t[1]),t.length!==2?f.push(new ce(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&f.push(new ce(`${i}[1]`,t[1],`string expected, ${h} found`));break;case"within":h=qe(t[1]),t.length!==2?f.push(new ce(i,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="object"&&f.push(new ce(`${i}[1]`,t[1],`object expected, ${h} found`))}return f}function qc(e,t){const i=e.key,l=e.style,h=e.styleSpec,f=e.value,m=e.objectKey,x=h[`${t}_${e.layerType}`];if(!x)return[];const w=m.match(/^(.*)-transition$/);if(t==="paint"&&w&&x[w[1]]&&x[w[1]].transition)return dn({key:i,value:f,valueSpec:h.transition,style:l,styleSpec:h});const E=e.valueSpec||x[m];if(!E)return[new ce(i,f,`unknown property "${m}"`)];let A;if(qe(f)==="string"&&so(E)&&!E.tokens&&(A=/^{([^}]+)}$/.exec(f))){const D=`\`{ "type": "identity", "property": ${A?JSON.stringify(A[1]):'"_"'} }\``;return[new ce(i,f,`"${m}" does not support interpolation syntax
Use an identity property function instead: ${D}.`)]}const k=[];return e.layerType==="symbol"&&(m==="text-field"&&l&&!l.glyphs&&k.push(new ce(i,f,'use of "text-field" requires a style "glyphs" property')),m==="text-font"&&ra(tn(f))&&ji(f.type)==="identity"&&k.push(new ce(i,f,'"text-font" does not support identity functions'))),k.concat(dn({key:e.key,value:f,valueSpec:E,style:l,styleSpec:h,expressionContext:"property",propertyType:t,propertyKey:m}))}function Gu(e){return qc(e,"paint")}function $c(e){return qc(e,"layout")}function qu(e){let t=[];const i=e.value,l=e.key,h=e.style,f=e.styleSpec;i.type||i.ref||t.push(new ce(l,i,'either "type" or "ref" is required'));let m=ji(i.type);const x=ji(i.ref);if(i.id){const w=ji(i.id);for(let E=0;E<e.arrayIndex;E++){const A=h.layers[E];ji(A.id)===w&&t.push(new ce(l,i.id,`duplicate layer id "${i.id}", previously used at line ${A.id.__line__}`))}}if("ref"in i){let w;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&t.push(new ce(l,i[E],`"${E}" is prohibited for ref layers`))}),h.layers.forEach(E=>{ji(E.id)===x&&(w=E)}),w?w.ref?t.push(new ce(l,i.ref,"ref cannot reference another ref layer")):m=ji(w.type):typeof x=="string"&&t.push(new ce(l,i.ref,`ref layer "${x}" not found`))}else if(m!=="background"&&m!=="sky")if(i.source){const w=h.sources&&h.sources[i.source],E=w&&ji(w.type);w?E==="vector"&&m==="raster"?t.push(new ce(l,i.source,`layer "${i.id}" requires a raster source`)):E==="raster"&&m!=="raster"?t.push(new ce(l,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&m!=="hillshade"?t.push(new ce(l,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||E==="geojson"&&w.lineMetrics||t.push(new ce(l,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new ce(l,i,`layer "${i.id}" must specify a "source-layer"`)):t.push(new ce(l,i.source,`source "${i.source}" not found`))}else t.push(new ce(l,i,'missing required property "source"'));return t=t.concat(es({key:l,value:i,valueSpec:f.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dn({key:`${l}.type`,value:i.type,valueSpec:f.layer.type,style:e.style,styleSpec:e.styleSpec,object:i,objectKey:"type"}),filter:w=>ua(Ms({layerType:m},w)),layout:w=>es({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>$c(Ms({layerType:m},E))}}),paint:w=>es({layer:i,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":E=>Gu(Ms({layerType:m},E))}})}})),t}function Js(e){const t=e.value,i=e.key,l=qe(t);return l!=="string"?[new ce(i,t,`string expected, ${l} found`)]:[]}const $u={promoteId:function({key:e,value:t}){if(qe(t)==="string")return Js({key:e,value:t});{const i=[];for(const l in t)i.push(...Js({key:`${e}.${l}`,value:t[l]}));return i}}};function Wu(e){const t=e.value,i=e.key,l=e.styleSpec,h=e.style;if(!t.type)return[new ce(i,t,'"type" is required')];const f=ji(t.type);let m;switch(f){case"vector":case"raster":case"raster-dem":return m=es({key:i,value:t,valueSpec:l[`source_${f.replace("-","_")}`],style:e.style,styleSpec:l,objectElementValidators:$u}),m;case"geojson":if(m=es({key:i,value:t,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:$u}),t.cluster)for(const x in t.clusterProperties){const[w,E]=t.clusterProperties[x],A=typeof w=="string"?[w,["accumulated"],["get",x]]:w;m.push(...en({key:`${i}.${x}.map`,value:E,expressionContext:"cluster-map"})),m.push(...en({key:`${i}.${x}.reduce`,value:A,expressionContext:"cluster-reduce"}))}return m;case"video":return es({key:i,value:t,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return es({key:i,value:t,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new ce(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return gl({key:`${i}.type`,value:t.type,valueSpec:{values:Kp(l)},style:h,styleSpec:l})}}function Kp(e){return e.source.reduce((t,i)=>{const l=e[i];return l.type.type==="enum"&&(t=t.concat(Object.keys(l.type.values))),t},[])}function Zu(e){const t=e.value,i=e.styleSpec,l=i.light,h=e.style;let f=[];const m=qe(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new ce("light",t,`object expected, ${m} found`)]),f;for(const x in t){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&l[w[1]]&&l[w[1]].transition?dn({key:x,value:t[x],valueSpec:i.transition,style:h,styleSpec:i}):l[x]?dn({key:x,value:t[x],valueSpec:l[x],style:h,styleSpec:i}):[new ce(x,t[x],`unknown property "${x}"`)])}return f}function Wc(e){const t=e.value,i=e.key,l=e.style,h=e.styleSpec,f=h.terrain;let m=[];const x=qe(t);if(t===void 0)return m;if(x!=="object")return m=m.concat([new ce("terrain",t,`object expected, ${x} found`)]),m;for(const w in t){const E=w.match(/^(.*)-transition$/);m=m.concat(E&&f[E[1]]&&f[E[1]].transition?dn({key:w,value:t[w],valueSpec:h.transition,style:l,styleSpec:h}):f[w]?dn({key:w,value:t[w],valueSpec:f[w],style:l,styleSpec:h}):[new ce(w,t[w],`unknown property "${w}"`)])}if(t.source){const w=l.sources&&l.sources[t.source],E=w&&ji(w.type);w?E!=="raster-dem"&&m.push(new ce(i,t.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):m.push(new ce(i,t.source,`source "${t.source}" not found`))}else m.push(new ce(i,t,'terrain is missing required property "source"'));return m}function Hu(e){const t=e.value,i=e.style,l=e.styleSpec,h=l.fog;let f=[];const m=qe(t);if(t===void 0)return f;if(m!=="object")return f=f.concat([new ce("fog",t,`object expected, ${m} found`)]),f;for(const x in t){const w=x.match(/^(.*)-transition$/);f=f.concat(w&&h[w[1]]&&h[w[1]].transition?dn({key:x,value:t[x],valueSpec:l.transition,style:i,styleSpec:l}):h[x]?dn({key:x,value:t[x],valueSpec:h[x],style:i,styleSpec:l}):[new ce(x,t[x],`unknown property "${x}"`)])}return f}const Xu={"*":()=>[],array:ju,boolean:function(e){const t=e.value,i=e.key,l=qe(t);return l!=="boolean"?[new ce(i,t,`boolean expected, ${l} found`)]:[]},number:la,color:function(e){const t=e.key,i=e.value,l=qe(i);return l!=="string"?[new ce(t,i,`color expected, ${l} found`)]:hc(i)===null?[new ce(t,i,`color expected, "${i}" found`)]:[]},enum:gl,filter:ua,function:ca,layer:qu,object:es,source:Wu,light:Zu,terrain:Wc,fog:Hu,string:Js,formatted:function(e){return Js(e).length===0?[]:en(e)},resolvedImage:function(e){return Js(e).length===0?[]:en(e)},projection:function(e){const t=e.value,i=e.styleSpec,l=i.projection,h=e.style;let f=[];const m=qe(t);if(m==="object")for(const x in t)f=f.concat(dn({key:x,value:t[x],valueSpec:l[x],style:h,styleSpec:i}));else m!=="string"&&(f=f.concat([new ce("projection",t,`object or string expected, ${m} found`)]));return f}};function dn(e){const t=e.value,i=e.valueSpec,l=e.styleSpec;return i.expression&&ra(ji(t))?ca(e):i.expression&&oo(tn(t))?en(e):i.type&&Xu[i.type]?Xu[i.type](e):es(Ms({},e,{valueSpec:i.type?l[i.type]:i}))}function Jp(e){const t=e.value,i=e.key,l=Js(e);return l.length||(t.indexOf("{fontstack}")===-1&&l.push(new ce(i,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&l.push(new ce(i,t,'"glyphs" url must include a "{range}" token'))),l}function Yu(e,t=Ot){return $n(dn({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Jp,"*":()=>[]}}))}const Qp=e=>$n(Gu(e)),tf=e=>$n($c(e));function $n(e){return e.slice().sort((t,i)=>t.line&&i.line?t.line-i.line:0)}function Ku(e,t){let i=!1;if(t&&t.length)for(const l of t)e.fire(new Ss(new Error(l.message))),i=!0;return i}var ef=fs,is=3;function fs(e,t,i){var l=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var h=new Int32Array(this.arrayBuffer);e=h[0],this.d=(t=h[1])+2*(i=h[2]);for(var f=0;f<this.d*this.d;f++){var m=h[is+f],x=h[is+f+1];l.push(m===x?null:h.subarray(m,x))}var w=h[is+l.length+1];this.keys=h.subarray(h[is+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=t+2*i;for(var E=0;E<this.d*this.d;E++)l.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=i,this.scale=t/e,this.uid=0;var A=i/t*e;this.min=-A,this.max=e+A}fs.prototype.insert=function(e,t,i,l,h){this._forEachCell(t,i,l,h,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(i),this.bboxes.push(l),this.bboxes.push(h)},fs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fs.prototype._insertCell=function(e,t,i,l,h,f){this.cells[h].push(f)},fs.prototype.query=function(e,t,i,l,h){var f=this.min,m=this.max;if(e<=f&&t<=f&&m<=i&&m<=l&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(e,t,i,l,this._queryCell,x,{},h),x},fs.prototype._queryCell=function(e,t,i,l,h,f,m,x){var w=this.cells[h];if(w!==null)for(var E=this.keys,A=this.bboxes,k=0;k<w.length;k++){var D=w[k];if(m[D]===void 0){var O=4*D;(x?x(A[O+0],A[O+1],A[O+2],A[O+3]):e<=A[O+2]&&t<=A[O+3]&&i>=A[O+0]&&l>=A[O+1])?(m[D]=!0,f.push(E[D])):m[D]=!1}}},fs.prototype._forEachCell=function(e,t,i,l,h,f,m,x){for(var w=this._convertToCellCoord(e),E=this._convertToCellCoord(t),A=this._convertToCellCoord(i),k=this._convertToCellCoord(l),D=w;D<=A;D++)for(var O=E;O<=k;O++){var B=this.d*O+D;if((!x||x(this._convertFromCellCoord(D),this._convertFromCellCoord(O),this._convertFromCellCoord(D+1),this._convertFromCellCoord(O+1)))&&h.call(this,e,t,i,l,B,f,m,x))return}},fs.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},fs.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},fs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=is+this.cells.length+1+1,i=0,l=0;l<this.cells.length;l++)i+=this.cells[l].length;var h=new Int32Array(t+i+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var f=t,m=0;m<e.length;m++){var x=e[m];h[is+m]=f,h.set(x,f),f+=x.length}return h[is+e.length]=f,h.set(this.keys,f),h[is+e.length+1]=f+=this.keys.length,h.set(this.bboxes,f),f+=this.bboxes.length,h.buffer};var Tr=Ft(ef);const bl={};function he(e,t,i={}){Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),bl[t]={klass:e,omit:i.omit||[]}}he(Object,"Object"),Tr.serialize=function(e,t){const i=e.toArrayBuffer();return t&&t.push(i),{buffer:i}},Tr.deserialize=function(e){return new Tr(e.buffer)},Object.defineProperty(Tr,"name",{value:"Grid"}),he(Tr,"Grid"),he(Bi,"Color"),he(Error,"Error"),he(Ys,"AJAXError"),he(Gn,"ResolvedImage"),he(_l,"StylePropertyFunction"),he(fl,"StyleExpression",{omit:["_evaluator"]}),he(oa,"ZoomDependentExpression"),he(Fc,"ZoomConstantExpression"),he(Is,"CompoundExpression",{omit:["_evaluate"]});for(const e in sa)bl[sa[e]._classRegistryKey]||he(sa[e],`Expression${e}`);function Zc(e){return e&&typeof ArrayBuffer<"u"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function Hc(e){return T.ImageBitmap&&e instanceof T.ImageBitmap}function ho(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Zc(e)||Hc(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){const i=e;return t&&t.push(i.buffer),i}if(e instanceof T.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){const i=[];for(const l of e)i.push(ho(l,t));return i}if(typeof e=="object"){const i=e.constructor,l=i._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=i.serialize?i.serialize(e,t):{};if(!i.serialize){for(const f in e)e.hasOwnProperty(f)&&(bl[l].omit.indexOf(f)>=0||(h[f]=ho(e[f],t)));e instanceof Error&&(h.message=e.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof e)}function Er(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Zc(e)||Hc(e)||ArrayBuffer.isView(e)||e instanceof T.ImageData)return e;if(Array.isArray(e))return e.map(Er);if(typeof e=="object"){const t=e.$name||"Object",{klass:i}=bl[t];if(!i)throw new Error(`can't deserialize unregistered class ${t}`);if(i.deserialize)return i.deserialize(e);const l=Object.create(i.prototype);for(const h of Object.keys(e))h!=="$name"&&(l[h]=Er(e[h]));return l}throw new Error("can't deserialize object of type "+typeof e)}const ae={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519};function Xc(e){for(const t of e)if(Yc(t.charCodeAt(0)))return!0;return!1}function nf(e){for(const t of e)if(!Ju(t.charCodeAt(0)))return!1;return!0}function Ju(e){return!(ae.Arabic(e)||ae["Arabic Supplement"](e)||ae["Arabic Extended-A"](e)||ae["Arabic Presentation Forms-A"](e)||ae["Arabic Presentation Forms-B"](e))}function Yc(e){return!(e!==746&&e!==747&&(e<4352||!(ae["Bopomofo Extended"](e)||ae.Bopomofo(e)||ae["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ae["CJK Compatibility Ideographs"](e)||ae["CJK Compatibility"](e)||ae["CJK Radicals Supplement"](e)||ae["CJK Strokes"](e)||!(!ae["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||ae["CJK Unified Ideographs Extension A"](e)||ae["CJK Unified Ideographs"](e)||ae["Enclosed CJK Letters and Months"](e)||ae["Hangul Compatibility Jamo"](e)||ae["Hangul Jamo Extended-A"](e)||ae["Hangul Jamo Extended-B"](e)||ae["Hangul Jamo"](e)||ae["Hangul Syllables"](e)||ae.Hiragana(e)||ae["Ideographic Description Characters"](e)||ae.Kanbun(e)||ae["Kangxi Radicals"](e)||ae["Katakana Phonetic Extensions"](e)||ae.Katakana(e)&&e!==12540||!(!ae["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!ae["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ae["Unified Canadian Aboriginal Syllabics"](e)||ae["Unified Canadian Aboriginal Syllabics Extended"](e)||ae["Vertical Forms"](e)||ae["Yijing Hexagram Symbols"](e)||ae["Yi Syllables"](e)||ae["Yi Radicals"](e))))}function Qu(e){return!(Yc(e)||function(t){return!!(ae["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ae["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ae["Letterlike Symbols"](t)||ae["Number Forms"](t)||ae["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ae["Control Pictures"](t)&&t!==9251||ae["Optical Character Recognition"](t)||ae["Enclosed Alphanumerics"](t)||ae["Geometric Shapes"](t)||ae["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ae["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ae["CJK Symbols and Punctuation"](t)||ae.Katakana(t)||ae["Private Use Area"](t)||ae["CJK Compatibility Forms"](t)||ae["Small Form Variants"](t)||ae["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function td(e){return e>=1424&&e<=2303||ae["Arabic Presentation Forms-A"](e)||ae["Arabic Presentation Forms-B"](e)}function sf(e,t){return!(!t&&td(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ae.Khmer(e))}function rf(e){for(const t of e)if(td(t.charCodeAt(0)))return!0;return!1}const Kc="deferred",Jc="loading",Qc="loaded";let uo=null,d="unavailable",n=null;const c=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(d="error"),uo&&uo(e)};function _(){y.fire(new mr("pluginStateChange",{pluginStatus:d,pluginURL:n}))}const y=new Uo,b=function(){return d},S=function(){if(d!==Kc||!n)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");d=Jc,_(),n&&Wr({url:n},e=>{e?c(e):(d=Qc,_())})},M={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>d===Qc||M.applyArabicShaping!=null,isLoading:()=>d===Jc,setState(e){d=e.pluginStatus,n=e.pluginURL},isParsed:()=>M.applyArabicShaping!=null&&M.processBidirectionalText!=null&&M.processStyledBidirectionalText!=null,getPluginURL:()=>n};class P{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(t){return function(i,l){for(const h of i)if(!sf(h.charCodeAt(0),l))return!1;return!0}(t,M.isLoaded())}}class z{constructor(t,i){this.property=t,this.value=i,this.expression=function(l,h){if(ra(l))return new _l(l,h);if(oo(l)){const f=aa(l,h);if(f.result==="error")throw new Error(f.value.map(m=>`${m.key}: ${m.message}`).join(", "));return f.value}{let f=l;return typeof l=="string"&&h.type==="color"&&(f=Bi.parse(l)),{kind:"constant",evaluate:()=>f}}}(i===void 0?t.specification.default:i,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,l){return this.property.possiblyEvaluate(this,t,i,l)}}class L{constructor(t){this.property=t,this.value=new z(t,void 0)}transitioned(t,i){return new $(this.property,this.value,i,_i({},t.transition,this.transition),t.now)}untransitioned(){return new $(this.property,this.value,null,{},0)}}class N{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return zn(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new L(this._values[t].property)),this._values[t].value=new z(this._values[t].property,i===null?void 0:zn(i))}getTransition(t){return zn(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new L(this._values[t].property)),this._values[t].transition=zn(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(t[i]=l);const h=this.getTransition(i);h!==void 0&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const l=new X(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(t,i._values[h]);return l}untransitioned(){const t=new X(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class ${constructor(t,i,l,h,f){const m=h.delay||0,x=h.duration||0;f=f||0,this.property=t,this.value=i,this.begin=f+m,this.end=this.begin+x,t.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(t,i,l){const h=t.now||0,f=this.value.possiblyEvaluate(t,i,l),m=this.prior;if(m){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return m.possiblyEvaluate(t,i,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(t,i,l),f,Ke(x))}}return f}}class X{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,l){const h=new Q(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,i,l);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class J{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return zn(this._values[t].value)}setValue(t,i){this._values[t]=new z(this._values[t].property,i===null?void 0:zn(i))}serialize(){const t={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(t[i]=l)}return t}possiblyEvaluate(t,i,l){const h=new Q(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(t,i,l);return h}}class K{constructor(t,i,l){this.property=t,this.value=i,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,l,h){return this.property.evaluate(this.value,this.parameters,t,i,l,h)}}class Q{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class j{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,l){const h=Qo[this.specification.type];return h?h(t,i,l):t}}class H{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,l,h){return new K(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},l,h)}:t.expression,i)}interpolate(t,i,l){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new K(this,{kind:"constant",value:void 0},t.parameters);const h=Qo[this.specification.type];return h?new K(this,{kind:"constant",value:h(t.value.value,i.value.value,l)},t.parameters):t}evaluate(t,i,l,h,f,m){return t.kind==="constant"?t.value:t.evaluate(i,l,h,f,m)}}class nt{constructor(t){this.specification=t}possiblyEvaluate(t,i,l,h){return!!t.expression.evaluate(i,null,{},l,h)}interpolate(){return!1}}class st{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new P(0,{});for(const l in t){const h=t[l];h.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new z(h,void 0),m=this.defaultTransitionablePropertyValues[l]=new L(h);this.defaultTransitioningPropertyValues[l]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(i)}}}function ft(e,t){return 256*(e=be(Math.floor(e),0,255))+be(Math.floor(t),0,255)}he(H,"DataDrivenProperty"),he(j,"DataConstantProperty"),he(nt,"ColorRampProperty");const mt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _t{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class vt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&(t.isTransferred=!0,i.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function xt(e,t=1){let i=0,l=0;return{members:e.map(h=>{const f=mt[h.type].BYTES_PER_ELEMENT,m=i=At(i,Math.max(t,f)),x=h.components||1;return l=Math.max(l,f),i+=f*x,{name:h.name,type:h.type,components:x,offset:m}}),size:At(i,Math.max(l,t)),alignment:t}}function At(e,t){return Math.ceil(e/t)*t}class Zt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const l=this.length;return this.resize(l+1),this.emplace(l,t,i)}emplace(t,i,l){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=l,t}}Zt.prototype.bytesPerElement=4,he(Zt,"StructArrayLayout2i4");class Et extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,l)}emplace(t,i,l,h){const f=3*t;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=h,t}}Et.prototype.bytesPerElement=6,he(Et,"StructArrayLayout3i6");class jt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,l,h)}emplace(t,i,l,h,f){const m=4*t;return this.int16[m+0]=i,this.int16[m+1]=l,this.int16[m+2]=h,this.int16[m+3]=f,t}}jt.prototype.bytesPerElement=8,he(jt,"StructArrayLayout4i8");class It extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,l,h,f,m,x)}emplace(t,i,l,h,f,m,x,w){const E=6*t,A=12*t,k=3*t;return this.int16[E+0]=i,this.int16[E+1]=l,this.uint8[A+4]=h,this.uint8[A+5]=f,this.uint8[A+6]=m,this.uint8[A+7]=x,this.float32[k+2]=w,t}}It.prototype.bytesPerElement=12,he(It,"StructArrayLayout2i4ub1f12");class $t extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,l,h)}emplace(t,i,l,h,f){const m=4*t;return this.float32[m+0]=i,this.float32[m+1]=l,this.float32[m+2]=h,this.float32[m+3]=f,t}}$t.prototype.bytesPerElement=16,he($t,"StructArrayLayout4f16");class Mt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,l,h,f)}emplace(t,i,l,h,f,m){const x=6*t,w=3*t;return this.uint16[x+0]=i,this.uint16[x+1]=l,this.uint16[x+2]=h,this.uint16[x+3]=f,this.float32[w+2]=m,t}}Mt.prototype.bytesPerElement=12,he(Mt,"StructArrayLayout4ui1f12");class Nt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,l,h)}emplace(t,i,l,h,f){const m=4*t;return this.uint16[m+0]=i,this.uint16[m+1]=l,this.uint16[m+2]=h,this.uint16[m+3]=f,t}}Nt.prototype.bytesPerElement=8,he(Nt,"StructArrayLayout4ui8");class Xt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,l,h,f,m)}emplace(t,i,l,h,f,m,x){const w=6*t;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+3]=f,this.int16[w+4]=m,this.int16[w+5]=x,t}}Xt.prototype.bytesPerElement=12,he(Xt,"StructArrayLayout6i12");class Gt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f,m,x,w,E,A,k,D){const O=this.length;return this.resize(O+1),this.emplace(O,t,i,l,h,f,m,x,w,E,A,k,D)}emplace(t,i,l,h,f,m,x,w,E,A,k,D,O){const B=12*t;return this.int16[B+0]=i,this.int16[B+1]=l,this.int16[B+2]=h,this.int16[B+3]=f,this.uint16[B+4]=m,this.uint16[B+5]=x,this.uint16[B+6]=w,this.uint16[B+7]=E,this.int16[B+8]=A,this.int16[B+9]=k,this.int16[B+10]=D,this.int16[B+11]=O,t}}Gt.prototype.bytesPerElement=24,he(Gt,"StructArrayLayout4i4ui4i24");class Yt extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f,m){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,l,h,f,m)}emplace(t,i,l,h,f,m,x){const w=10*t,E=5*t;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.float32[E+2]=f,this.float32[E+3]=m,this.float32[E+4]=x,t}}Yt.prototype.bytesPerElement=20,he(Yt,"StructArrayLayout3i3f20");class me extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}me.prototype.bytesPerElement=4,he(me,"StructArrayLayout1ul4");class we extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f,m,x,w,E,A,k,D,O){const B=this.length;return this.resize(B+1),this.emplace(B,t,i,l,h,f,m,x,w,E,A,k,D,O)}emplace(t,i,l,h,f,m,x,w,E,A,k,D,O,B){const V=20*t,Z=10*t;return this.int16[V+0]=i,this.int16[V+1]=l,this.int16[V+2]=h,this.int16[V+3]=f,this.int16[V+4]=m,this.float32[Z+3]=x,this.float32[Z+4]=w,this.float32[Z+5]=E,this.float32[Z+6]=A,this.int16[V+14]=k,this.uint32[Z+8]=D,this.uint16[V+18]=O,this.uint16[V+19]=B,t}}we.prototype.bytesPerElement=40,he(we,"StructArrayLayout5i4f1i1ul2ui40");class de extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f,m,x){const w=this.length;return this.resize(w+1),this.emplace(w,t,i,l,h,f,m,x)}emplace(t,i,l,h,f,m,x,w){const E=8*t;return this.int16[E+0]=i,this.int16[E+1]=l,this.int16[E+2]=h,this.int16[E+4]=f,this.int16[E+5]=m,this.int16[E+6]=x,this.int16[E+7]=w,t}}de.prototype.bytesPerElement=16,he(de,"StructArrayLayout3i2i2i16");class xe extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,l,h,f)}emplace(t,i,l,h,f,m){const x=4*t,w=8*t;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[w+6]=f,this.int16[w+7]=m,t}}xe.prototype.bytesPerElement=16,he(xe,"StructArrayLayout2f1f2i16");class Be extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,l,h)}emplace(t,i,l,h,f){const m=12*t,x=3*t;return this.uint8[m+0]=i,this.uint8[m+1]=l,this.float32[x+1]=h,this.float32[x+2]=f,t}}Be.prototype.bytesPerElement=12,he(Be,"StructArrayLayout2ub2f12");class De extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,l)}emplace(t,i,l,h){const f=3*t;return this.float32[f+0]=i,this.float32[f+1]=l,this.float32[f+2]=h,t}}De.prototype.bytesPerElement=12,he(De,"StructArrayLayout3f12");class _e extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,l)}emplace(t,i,l,h){const f=3*t;return this.uint16[f+0]=i,this.uint16[f+1]=l,this.uint16[f+2]=h,t}}_e.prototype.bytesPerElement=6,he(_e,"StructArrayLayout3ui6");class Je extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f,m,x,w,E,A,k,D,O,B,V,Z,tt,lt,et,ot,dt){const ut=this.length;return this.resize(ut+1),this.emplace(ut,t,i,l,h,f,m,x,w,E,A,k,D,O,B,V,Z,tt,lt,et,ot,dt)}emplace(t,i,l,h,f,m,x,w,E,A,k,D,O,B,V,Z,tt,lt,et,ot,dt,ut){const Ct=30*t,St=15*t,Bt=60*t;return this.int16[Ct+0]=i,this.int16[Ct+1]=l,this.int16[Ct+2]=h,this.float32[St+2]=f,this.float32[St+3]=m,this.uint16[Ct+8]=x,this.uint16[Ct+9]=w,this.uint32[St+5]=E,this.uint32[St+6]=A,this.uint32[St+7]=k,this.uint16[Ct+16]=D,this.uint16[Ct+17]=O,this.uint16[Ct+18]=B,this.float32[St+10]=V,this.float32[St+11]=Z,this.uint8[Bt+48]=tt,this.uint8[Bt+49]=lt,this.uint8[Bt+50]=et,this.uint32[St+13]=ot,this.int16[Ct+28]=dt,this.uint8[Bt+58]=ut,t}}Je.prototype.bytesPerElement=60,he(Je,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ii extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f,m,x,w,E,A,k,D,O,B,V,Z,tt,lt,et,ot,dt,ut,Ct,St,Bt,Ht,Pt,Vt,Ut,qt){const Qt=this.length;return this.resize(Qt+1),this.emplace(Qt,t,i,l,h,f,m,x,w,E,A,k,D,O,B,V,Z,tt,lt,et,ot,dt,ut,Ct,St,Bt,Ht,Pt,Vt,Ut,qt)}emplace(t,i,l,h,f,m,x,w,E,A,k,D,O,B,V,Z,tt,lt,et,ot,dt,ut,Ct,St,Bt,Ht,Pt,Vt,Ut,qt,Qt){const zt=38*t,re=19*t;return this.int16[zt+0]=i,this.int16[zt+1]=l,this.int16[zt+2]=h,this.float32[re+2]=f,this.float32[re+3]=m,this.int16[zt+8]=x,this.int16[zt+9]=w,this.int16[zt+10]=E,this.int16[zt+11]=A,this.int16[zt+12]=k,this.int16[zt+13]=D,this.uint16[zt+14]=O,this.uint16[zt+15]=B,this.uint16[zt+16]=V,this.uint16[zt+17]=Z,this.uint16[zt+18]=tt,this.uint16[zt+19]=lt,this.uint16[zt+20]=et,this.uint16[zt+21]=ot,this.uint16[zt+22]=dt,this.uint16[zt+23]=ut,this.uint16[zt+24]=Ct,this.uint16[zt+25]=St,this.uint16[zt+26]=Bt,this.uint16[zt+27]=Ht,this.uint16[zt+28]=Pt,this.uint32[re+15]=Vt,this.float32[re+16]=Ut,this.float32[re+17]=qt,this.float32[re+18]=Qt,t}}ii.prototype.bytesPerElement=76,he(ii,"StructArrayLayout3i2f6i15ui1ul3f76");class ni extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}ni.prototype.bytesPerElement=4,he(ni,"StructArrayLayout1f4");class si extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,l,h,f){const m=this.length;return this.resize(m+1),this.emplace(m,t,i,l,h,f)}emplace(t,i,l,h,f,m){const x=5*t;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=h,this.float32[x+3]=f,this.float32[x+4]=m,t}}si.prototype.bytesPerElement=20,he(si,"StructArrayLayout5f20");class pn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,t,i,l,h)}emplace(t,i,l,h,f){const m=6*t;return this.uint32[3*t+0]=i,this.uint16[m+2]=l,this.uint16[m+3]=h,this.uint16[m+4]=f,t}}pn.prototype.bytesPerElement=12,he(pn,"StructArrayLayout1ul3ui12");class nn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const l=this.length;return this.resize(l+1),this.emplace(l,t,i)}emplace(t,i,l){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=l,t}}nn.prototype.bytesPerElement=4,he(nn,"StructArrayLayout2ui4");class Wn extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Wn.prototype.bytesPerElement=2,he(Wn,"StructArrayLayout1ui2");class _s extends vt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const l=this.length;return this.resize(l+1),this.emplace(l,t,i)}emplace(t,i,l){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=l,t}}_s.prototype.bytesPerElement=8,he(_s,"StructArrayLayout2f8");class wi extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}wi.prototype.size=40;class ri extends we{get(t){return new wi(this,t)}}he(ri,"CollisionBoxArray");class We extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}We.prototype.size=60;class Vi extends Je{get(t){return new We(this,t)}}he(Vi,"PlacedSymbolArray");class xn extends _t{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}xn.prototype.size=76;class mi extends ii{get(t){return new xn(this,t)}}he(mi,"SymbolInstanceArray");class En extends ni{getoffsetX(t){return this.float32[1*t+0]}}he(En,"GlyphOffsetArray");class wl extends Zt{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}he(wl,"SymbolLineVertexArray");class Sr extends _t{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Sr.prototype.size=12;class pa extends pn{get(t){return new Sr(this,t)}}he(pa,"FeatureIndexArray");class zs extends nn{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}he(zs,"FillExtrusionCentroidArray");const Qs=xt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Mr=xt([{name:"a_dash",components:4,type:"Uint16"}]);var Tl={exports:{}},fa={exports:{}};fa.exports=function(e,t){var i,l,h,f,m,x,w,E;for(l=e.length-(i=3&e.length),h=t,m=3432918353,x=461845907,E=0;E<l;)w=255&e.charCodeAt(E)|(255&e.charCodeAt(++E))<<8|(255&e.charCodeAt(++E))<<16|(255&e.charCodeAt(++E))<<24,++E,h=27492+(65535&(f=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(w=0,i){case 3:w^=(255&e.charCodeAt(E+2))<<16;case 2:w^=(255&e.charCodeAt(E+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&e.charCodeAt(E)))*m+(((w>>>16)*m&65535)<<16)&4294967295)<<15|w>>>17))*x+(((w>>>16)*x&65535)<<16)&4294967295}return h^=e.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var th=fa.exports,wm={exports:{}};wm.exports=function(e,t){for(var i,l=e.length,h=t^l,f=0;l>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(f)|(255&e.charCodeAt(++f))<<8|(255&e.charCodeAt(++f))<<16|(255&e.charCodeAt(++f))<<24))+((1540483477*(i>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),l-=4,++f;switch(l){case 3:h^=(255&e.charCodeAt(f+2))<<16;case 2:h^=(255&e.charCodeAt(f+1))<<8;case 1:h=1540483477*(65535&(h^=255&e.charCodeAt(f)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var Tm=th,mv=wm.exports;Tl.exports=Tm,Tl.exports.murmur3=Tm,Tl.exports.murmur2=mv;var of=Ft(Tl.exports);class ed{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,i,l,h){this.ids.push(Em(t)),this.positions.push(i,l,h)}getPositions(t){const i=Em(t);let l=0,h=this.ids.length-1;for(;l<h;){const m=l+h>>1;this.ids[m]>=i?h=m:l=m+1}const f=[];for(;this.ids[l]===i;)f.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return f}static serialize(t,i){const l=new Float64Array(t.ids),h=new Uint32Array(t.positions);return af(l,h,0,l.length-1),i&&i.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(t){const i=new ed;return i.ids=t.ids,i.positions=t.positions,i.indexed=!0,i}}function Em(e){const t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:of(String(e))}function af(e,t,i,l){for(;i<l;){const h=e[i+l>>1];let f=i-1,m=l+1;for(;;){do f++;while(e[f]<h);do m--;while(e[m]>h);if(f>=m)break;id(e,f,m),id(t,3*f,3*m),id(t,3*f+1,3*m+1),id(t,3*f+2,3*m+2)}m-i<l-m?(af(e,t,i,m),i=m+1):(af(e,t,m+1,l),l=m)}}function id(e,t,i){const l=e[t];e[t]=e[i],e[i]=l}he(ed,"FeaturePositionMap");class Ar{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}}class nd extends Ar{constructor(t){super(t),this.current=0}set(t,i,l){this.fetchUniformLocation(t,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Sm extends Ar{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,l){this.fetchUniformLocation(t,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Mm extends Ar{constructor(t){super(t),this.current=Bi.transparent}set(t,i,l){this.fetchUniformLocation(t,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const gv=new Float32Array(16),yv=new Float32Array(9),xv=new Float32Array(4);function lf(e){return[ft(255*e.r,255*e.g),ft(255*e.b,255*e.a)]}class eh{constructor(t,i,l){this.value=t,this.uniformNames=i.map(h=>`u_${h}`),this.type=l}setUniform(t,i,l,h,f){i.set(t,f,h.constantOr(this.value))}getBinding(t,i){return this.type==="color"?new Mm(t):new nd(t)}}class El{constructor(t,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(t){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br)}setUniform(t,i,l,h,f){const m=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;m&&i.set(t,f,m)}getBinding(t,i){return i==="u_pattern"||i==="u_dash"?new Sm(t):new nd(t)}}class Cr{constructor(t,i,l,h){this.expression=t,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,l,h,f,m){const x=this.paintVertexArray.length,w=this.expression.evaluate(new P(0),i,{},f,h,m);this.paintVertexArray.resize(t),this._setPaintValue(x,t,w)}updatePaintArray(t,i,l,h,f){const m=this.expression.evaluate({zoom:0},l,h,void 0,f);this._setPaintValue(t,i,m)}_setPaintValue(t,i,l){if(this.type==="color"){const h=lf(l);for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,h[0],h[1])}else{for(let h=t;h<i;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Rs{constructor(t,i,l,h,f,m){this.expression=t,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(t,i,l,h,f,m){const x=this.expression.evaluate(new P(this.zoom),i,{},f,h,m),w=this.expression.evaluate(new P(this.zoom+1),i,{},f,h,m),E=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(E,t,x,w)}updatePaintArray(t,i,l,h,f){const m=this.expression.evaluate({zoom:this.zoom},l,h,void 0,f),x=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,f);this._setPaintValue(t,i,m,x)}_setPaintValue(t,i,l,h){if(this.type==="color"){const f=lf(l),m=lf(h);for(let x=t;x<i;x++)this.paintVertexArray.emplace(x,f[0],f[1],m[0],m[1])}else{for(let f=t;f<i;f++)this.paintVertexArray.emplace(f,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,l,h,f){const m=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=be(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);i.set(t,f,x)}getBinding(t,i){return new nd(t)}}class po{constructor(t,i,l,h,f){this.expression=t,this.layerId=f,this.paintVertexAttributes=(l==="array"?Mr:Qs).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new h}populatePaintArray(t,i,l){const h=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(h,t,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(t,i,l,h,f,m){this._setPaintValues(t,i,l.patterns&&l.patterns[this.layerId],m)}_setPaintValues(t,i,l,h){if(!h||!l)return;const f=h[l];if(!f)return;const{tl:m,br:x,pixelRatio:w}=f;for(let E=t;E<i;E++)this.paintVertexArray.emplace(E,m[0],m[1],x[0],x[1],w)}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fo{constructor(t,i,l=()=>!0){this.binders={},this._buffers=[];const h=[];for(const f in t.paint._values){if(!l(f))continue;const m=t.paint.get(f);if(!(m instanceof K&&so(m.property.specification)))continue;const x=bv(f,t.type),w=m.value,E=m.property.specification.type,A=!!m.property.useIntegerZoom,k=f==="line-dasharray"||f.endsWith("pattern"),D=f==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant";if(w.kind!=="constant"||D)if(w.kind==="source"||D||k){const O=Am(f,E,"source");this.binders[f]=k?new po(w,x,E,O,t.id):new Cr(w,x,E,O),h.push(`/a_${f}`)}else{const O=Am(f,E,"composite");this.binders[f]=new Rs(w,x,E,A,i,O),h.push(`/z_${f}`)}else this.binders[f]=k?new El(w.value,x):new eh(w.value,x,E),h.push(`/u_${f}`)}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Cr||i instanceof Rs?i.maxValue:0}populatePaintArrays(t,i,l,h,f,m){for(const x in this.binders){const w=this.binders[x];(w instanceof Cr||w instanceof Rs||w instanceof po)&&w.populatePaintArray(t,i,l,h,f,m)}}setConstantPatternPositions(t){for(const i in this.binders){const l=this.binders[i];l instanceof El&&l.setConstantPatternPositions(t)}}updatePaintArrays(t,i,l,h,f,m){let x=!1;for(const w in t){const E=i.getPositions(w);for(const A of E){const k=l.feature(A.index);for(const D in this.binders){const O=this.binders[D];if((O instanceof Cr||O instanceof Rs||O instanceof po)&&O.expression.isStateDependent===!0){const B=h.paint.get(D);O.expression=B.value,O.updatePaintArray(A.start,A.end,k,t[w],f,m),x=!0}}}}return x}defines(){const t=[];for(const i in this.binders){const l=this.binders[i];(l instanceof eh||l instanceof El)&&t.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof Cr||l instanceof Rs||l instanceof po)for(let h=0;h<l.paintVertexAttributes.length;h++)t.push(l.paintVertexAttributes[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof eh||l instanceof El||l instanceof Rs)for(const h of l.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof eh||h instanceof El||h instanceof Rs)for(const f of h.uniformNames)i.push({name:f,property:l,binding:h.getBinding(t,f)})}return i}setUniforms(t,i,l,h,f){for(const{name:m,property:x,binding:w}of l)this.binders[x].setUniform(t,w,f,h.get(x),m)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Cr||i instanceof Rs||i instanceof po)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(t){for(const i in this.binders){const l=this.binders[i];(l instanceof Cr||l instanceof Rs||l instanceof po)&&l.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Cr||i instanceof Rs||i instanceof po)&&i.destroy()}}}class _a{constructor(t,i,l=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new fo(h,i,l);this.needsUpload=!1,this._featureMap=new ed,this._bufferOffset=0}populatePaintArrays(t,i,l,h,f,m,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,i,h,f,m,x);i.id!==void 0&&this._featureMap.add(i.id,l,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,l,h,f){for(const m of l)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(t,this._featureMap,i,m,h,f)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const vv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function bv(e,t){return vv[e]||[e.replace(`${t}-`,"").replace(/-/g,"_")]}const wv={"line-pattern":{source:Mt,composite:Mt},"fill-pattern":{source:Mt,composite:Mt},"fill-extrusion-pattern":{source:Mt,composite:Mt},"line-dasharray":{source:Nt,composite:Nt}},Tv={color:{source:_s,composite:$t},number:{source:ni,composite:_s}};function Am(e,t,i){const l=wv[e];return l&&l[i]||Tv[t][i]}he(eh,"ConstantBinder"),he(El,"PatternConstantBinder"),he(Cr,"SourceExpressionBinder"),he(po,"PatternCompositeBinder"),he(Rs,"CompositeExpressionBinder"),he(fo,"ProgramConfiguration",{omit:["_buffers"]}),he(_a,"ProgramConfigurationSet");const Cm="-transition";class Os extends Uo{constructor(t,i){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&t.type!=="sky"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),i.layout&&(this._unevaluatedLayout=new J(i.layout)),i.paint)){this._transitionablePaint=new N(i.paint);for(const l in t.paint)this.setPaintProperty(l,t.paint[l],{validate:!1});for(const l in t.layout)this.setLayoutProperty(l,t.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Q(i.paint)}}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i,l={}){i!=null&&this._validate(tf,`layers.${this.id}.layout.${t}`,t,i,l)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,i):this.visibility=i)}getPaintProperty(t){return Vr(t,Cm)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i,l={}){if(i!=null&&this._validate(Qp,`layers.${this.id}.paint.${t}`,t,i,l))return!1;if(Vr(t,Cm))return this._transitionablePaint.setTransition(t.slice(0,-11),i||void 0),!1;{const h=this._transitionablePaint._values[t],f=h.value.isDataDriven(),m=h.value;this._transitionablePaint.setValue(t,i),this._handleSpecialPaintPropertyUpdate(t);const x=this._transitionablePaint._values[t].value,w=x.isDataDriven(),E=Vr(t,"pattern")||t==="line-dasharray";return w||f||E||this._handleOverridablePaintPropertyUpdate(t,m,x)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,i,l){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),Ur(t,(i,l)=>!(i===void 0||l==="layout"&&!Object.keys(i).length||l==="paint"&&!Object.keys(i).length))}_validate(t,i,l,h,f={}){return(!f||f.validate!==!1)&&Ku(this,t.call(Yu,{key:i,layerType:this.type,objectKey:l,value:h,styleSpec:Ot,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof K&&so(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=yl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Ev=xt([{name:"a_pos",components:2,type:"Int16"}],4),Sv=xt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Ui{constructor(t=[]){this.segments=t}prepareSegment(t,i,l,h){let f=this.segments[this.segments.length-1];return t>Ui.MAX_VERTEX_ARRAY_LENGTH&&Ei(`Max vertices per segment is ${Ui.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!f||f.vertexLength+t>Ui.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:i.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},h!==void 0&&(f.sortKey=h),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,l,h){return new Ui([{vertexOffset:t,primitiveOffset:i,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}Ui.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,he(Ui,"SegmentVector");var ye=8192;class _o{constructor(t,i){t&&(i?this.setSouthWest(t).setNorthEast(i):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof oi?new oi(t.lng,t.lat):oi.convert(t),this}setSouthWest(t){return this._sw=t instanceof oi?new oi(t.lng,t.lat):oi.convert(t),this}extend(t){const i=this._sw,l=this._ne;let h,f;if(t instanceof oi)h=t,f=t;else{if(!(t instanceof _o))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(_o.convert(t)):this.extend(oi.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(oi.convert(t)):this;if(h=t._sw,f=t._ne,!h||!f)return this}return i||l?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new oi(h.lng,h.lat),this._ne=new oi(f.lng,f.lat)),this}getCenter(){return new oi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new oi(this.getWest(),this.getNorth())}getSouthEast(){return new oi(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:l}=oi.convert(t);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(t){return!t||t instanceof _o?t:new _o(t)}}var sd=1e-6,Zn=typeof Float32Array<"u"?Float32Array:Array;function Im(){var e=new Zn(9);return Zn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Pm(e,t,i){var l=t[0],h=t[1],f=t[2],m=t[3],x=t[4],w=t[5],E=t[6],A=t[7],k=t[8],D=i[0],O=i[1],B=i[2],V=i[3],Z=i[4],tt=i[5],lt=i[6],et=i[7],ot=i[8];return e[0]=D*l+O*m+B*E,e[1]=D*h+O*x+B*A,e[2]=D*f+O*w+B*k,e[3]=V*l+Z*m+tt*E,e[4]=V*h+Z*x+tt*A,e[5]=V*f+Z*w+tt*k,e[6]=lt*l+et*m+ot*E,e[7]=lt*h+et*x+ot*A,e[8]=lt*f+et*w+ot*k,e}function Bs(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function cf(e,t){var i=t[0],l=t[1],h=t[2],f=t[3],m=t[4],x=t[5],w=t[6],E=t[7],A=t[8],k=t[9],D=t[10],O=t[11],B=t[12],V=t[13],Z=t[14],tt=t[15],lt=i*x-l*m,et=i*w-h*m,ot=i*E-f*m,dt=l*w-h*x,ut=l*E-f*x,Ct=h*E-f*w,St=A*V-k*B,Bt=A*Z-D*B,Ht=A*tt-O*B,Pt=k*Z-D*V,Vt=k*tt-O*V,Ut=D*tt-O*Z,qt=lt*Ut-et*Vt+ot*Pt+dt*Ht-ut*Bt+Ct*St;return qt?(e[0]=(x*Ut-w*Vt+E*Pt)*(qt=1/qt),e[1]=(h*Vt-l*Ut-f*Pt)*qt,e[2]=(V*Ct-Z*ut+tt*dt)*qt,e[3]=(D*ut-k*Ct-O*dt)*qt,e[4]=(w*Ht-m*Ut-E*Bt)*qt,e[5]=(i*Ut-h*Ht+f*Bt)*qt,e[6]=(Z*ot-B*Ct-tt*et)*qt,e[7]=(A*Ct-D*ot+O*et)*qt,e[8]=(m*Vt-x*Ht+E*St)*qt,e[9]=(l*Ht-i*Vt-f*St)*qt,e[10]=(B*ut-V*ot+tt*lt)*qt,e[11]=(k*ot-A*ut-O*lt)*qt,e[12]=(x*Bt-m*Pt-w*St)*qt,e[13]=(i*Pt-l*Bt+h*St)*qt,e[14]=(V*et-B*dt-Z*lt)*qt,e[15]=(A*dt-k*et+D*lt)*qt,e):null}function ma(e,t,i){var l=t[0],h=t[1],f=t[2],m=t[3],x=t[4],w=t[5],E=t[6],A=t[7],k=t[8],D=t[9],O=t[10],B=t[11],V=t[12],Z=t[13],tt=t[14],lt=t[15],et=i[0],ot=i[1],dt=i[2],ut=i[3];return e[0]=et*l+ot*x+dt*k+ut*V,e[1]=et*h+ot*w+dt*D+ut*Z,e[2]=et*f+ot*E+dt*O+ut*tt,e[3]=et*m+ot*A+dt*B+ut*lt,e[4]=(et=i[4])*l+(ot=i[5])*x+(dt=i[6])*k+(ut=i[7])*V,e[5]=et*h+ot*w+dt*D+ut*Z,e[6]=et*f+ot*E+dt*O+ut*tt,e[7]=et*m+ot*A+dt*B+ut*lt,e[8]=(et=i[8])*l+(ot=i[9])*x+(dt=i[10])*k+(ut=i[11])*V,e[9]=et*h+ot*w+dt*D+ut*Z,e[10]=et*f+ot*E+dt*O+ut*tt,e[11]=et*m+ot*A+dt*B+ut*lt,e[12]=(et=i[12])*l+(ot=i[13])*x+(dt=i[14])*k+(ut=i[15])*V,e[13]=et*h+ot*w+dt*D+ut*Z,e[14]=et*f+ot*E+dt*O+ut*tt,e[15]=et*m+ot*A+dt*B+ut*lt,e}function ih(e,t,i){var l,h,f,m,x,w,E,A,k,D,O,B,V=i[0],Z=i[1],tt=i[2];return t===e?(e[12]=t[0]*V+t[4]*Z+t[8]*tt+t[12],e[13]=t[1]*V+t[5]*Z+t[9]*tt+t[13],e[14]=t[2]*V+t[6]*Z+t[10]*tt+t[14],e[15]=t[3]*V+t[7]*Z+t[11]*tt+t[15]):(h=t[1],f=t[2],m=t[3],x=t[4],w=t[5],E=t[6],A=t[7],k=t[8],D=t[9],O=t[10],B=t[11],e[0]=l=t[0],e[1]=h,e[2]=f,e[3]=m,e[4]=x,e[5]=w,e[6]=E,e[7]=A,e[8]=k,e[9]=D,e[10]=O,e[11]=B,e[12]=l*V+x*Z+k*tt+t[12],e[13]=h*V+w*Z+D*tt+t[13],e[14]=f*V+E*Z+O*tt+t[14],e[15]=m*V+A*Z+B*tt+t[15]),e}function ga(e,t,i){var l=i[0],h=i[1],f=i[2];return e[0]=t[0]*l,e[1]=t[1]*l,e[2]=t[2]*l,e[3]=t[3]*l,e[4]=t[4]*h,e[5]=t[5]*h,e[6]=t[6]*h,e[7]=t[7]*h,e[8]=t[8]*f,e[9]=t[9]*f,e[10]=t[10]*f,e[11]=t[11]*f,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function hf(e,t,i){var l=Math.sin(i),h=Math.cos(i),f=t[4],m=t[5],x=t[6],w=t[7],E=t[8],A=t[9],k=t[10],D=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=f*h+E*l,e[5]=m*h+A*l,e[6]=x*h+k*l,e[7]=w*h+D*l,e[8]=E*h-f*l,e[9]=A*h-m*l,e[10]=k*h-x*l,e[11]=D*h-w*l,e}function rd(e,t,i){var l=Math.sin(i),h=Math.cos(i),f=t[0],m=t[1],x=t[2],w=t[3],E=t[8],A=t[9],k=t[10],D=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=f*h-E*l,e[1]=m*h-A*l,e[2]=x*h-k*l,e[3]=w*h-D*l,e[8]=f*l+E*h,e[9]=m*l+A*h,e[10]=x*l+k*h,e[11]=w*l+D*h,e}function km(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Dm(e,t,i){var l,h,f,m=i[0],x=i[1],w=i[2],E=Math.hypot(m,x,w);return E<sd?null:(m*=E=1/E,x*=E,w*=E,l=Math.sin(t),h=Math.cos(t),e[0]=m*m*(f=1-h)+h,e[1]=x*m*f+w*l,e[2]=w*m*f-x*l,e[3]=0,e[4]=m*x*f-w*l,e[5]=x*x*f+h,e[6]=w*x*f+m*l,e[7]=0,e[8]=m*w*f+x*l,e[9]=x*w*f-m*l,e[10]=w*w*f+h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Mv=ma;function uf(){var e=new Zn(3);return Zn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Lm(e){var t=new Zn(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function nh(e){return Math.hypot(e[0],e[1],e[2])}function Sl(e,t,i){var l=new Zn(3);return l[0]=e,l[1]=t,l[2]=i,l}function Ir(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function df(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function zm(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function sh(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function rh(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function ns(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function oh(e,t,i,l){return e[0]=t[0]+i[0]*l,e[1]=t[1]+i[1]*l,e[2]=t[2]+i[2]*l,e}function Sn(e,t){var i=t[0],l=t[1],h=t[2],f=i*i+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e}function ms(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function pf(e,t,i){var l=t[0],h=t[1],f=t[2],m=i[0],x=i[1],w=i[2];return e[0]=h*w-f*x,e[1]=f*m-l*w,e[2]=l*x-h*m,e}function Fi(e,t,i){var l=t[0],h=t[1],f=t[2],m=i[3]*l+i[7]*h+i[11]*f+i[15];return e[0]=(i[0]*l+i[4]*h+i[8]*f+i[12])/(m=m||1),e[1]=(i[1]*l+i[5]*h+i[9]*f+i[13])/m,e[2]=(i[2]*l+i[6]*h+i[10]*f+i[14])/m,e}function Rm(e,t,i){var l=i[0],h=i[1],f=i[2],m=t[0],x=t[1],w=t[2],E=h*w-f*x,A=f*m-l*w,k=l*x-h*m,D=h*k-f*A,O=f*E-l*k,B=l*A-h*E,V=2*i[3];return A*=V,k*=V,O*=2,B*=2,e[0]=m+(E*=V)+(D*=2),e[1]=x+A+O,e[2]=w+k+B,e}var ah,Fs=df,Av=zm,Cv=nh;function Om(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function Bm(e,t){var i=t[0],l=t[1],h=t[2],f=t[3],m=i*i+l*l+h*h+f*f;return m>0&&(m=1/Math.sqrt(m)),e[0]=i*m,e[1]=l*m,e[2]=h*m,e[3]=f*m,e}function ya(e,t,i){var l=t[0],h=t[1],f=t[2],m=t[3];return e[0]=i[0]*l+i[4]*h+i[8]*f+i[12]*m,e[1]=i[1]*l+i[5]*h+i[9]*f+i[13]*m,e[2]=i[2]*l+i[6]*h+i[10]*f+i[14]*m,e[3]=i[3]*l+i[7]*h+i[11]*f+i[15]*m,e}function Fm(){var e=new Zn(4);return Zn!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Nm(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function jm(e,t,i){i*=.5;var l=t[0],h=t[1],f=t[2],m=t[3],x=Math.sin(i),w=Math.cos(i);return e[0]=l*w+m*x,e[1]=h*w+f*x,e[2]=f*w-h*x,e[3]=m*w-l*x,e}function Vm(e,t,i){i*=.5;var l=t[0],h=t[1],f=t[2],m=t[3],x=Math.sin(i),w=Math.cos(i);return e[0]=l*w-f*x,e[1]=h*w+m*x,e[2]=f*w+l*x,e[3]=m*w-h*x,e}uf(),ah=new Zn(4),Zn!=Float32Array&&(ah[0]=0,ah[1]=0,ah[2]=0,ah[3]=0);var Iv=Bm;uf(),Sl(1,0,0),Sl(0,1,0),Fm(),Fm(),Im();const Pv=xt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Um}=Pv,Gm=xt([{name:"a_pos_3",components:3,type:"Int16"}]);var lh=xt([{name:"a_pos",type:"Int16",components:2}]);class ff{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,l){const h=ms(i,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/h;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(t,i,l){if(function(O,B){var V=O[0],Z=O[1],tt=O[2],lt=B[0],et=B[1],ot=B[2];return Math.abs(V-lt)<=sd*Math.max(1,Math.abs(V),Math.abs(lt))&&Math.abs(Z-et)<=sd*Math.max(1,Math.abs(Z),Math.abs(et))&&Math.abs(tt-ot)<=sd*Math.max(1,Math.abs(tt),Math.abs(ot))}(this.pos,t)||i===0)return l[0]=l[1]=l[2]=0,!1;const[h,f,m]=this.dir,x=this.pos[0]-t[0],w=this.pos[1]-t[1],E=this.pos[2]-t[2],A=h*h+f*f+m*m,k=2*(x*h+w*f+E*m),D=k*k-4*A*(x*x+w*w+E*E-i*i);if(D<0){const O=Math.max(-k/2,0),B=x+h*O,V=w+f*O,Z=E+m*O,tt=Math.hypot(B,V,Z);return l[0]=B*i/tt,l[1]=V*i/tt,l[2]=Z*i/tt,!1}{const O=(-k-Math.sqrt(D))/(2*A);if(O<0){const B=Math.hypot(x,w,E);return l[0]=x*i/B,l[1]=w*i/B,l[2]=E*i/B,!1}return l[0]=x+h*O,l[1]=w+f*O,l[2]=E+m*O,!0}}}class _f{constructor(t,i,l,h,f){this.TL=t,this.TR=i,this.BR=l,this.BL=h,this.horizon=f}static fromInvProjectionMatrix(t,i,l){const h=[-1,1,1],f=[1,1,1],m=[1,-1,1],x=[-1,-1,1],w=Fi(h,h,t),E=Fi(f,f,t),A=Fi(m,m,t),k=Fi(x,x,t);return new _f(w,E,A,k,i/l)}}class mf{constructor(t,i){this.points=t,this.planes=i}static fromInvProjectionMatrix(t,i,l,h){const f=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const E=ya([],w,t),A=1/E[3]/i*f;return function(k,D,O){return k[0]=D[0]*O[0],k[1]=D[1]*O[1],k[2]=D[2]*O[2],k[3]=D[3]*O[3],k}(E,E,[A,A,h?1/E[3]:A,A])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const E=Sn([],pf([],Fs([],m[w[0]],m[w[1]]),Fs([],m[w[2]],m[w[1]]))),A=-ms(E,m[w[1]]);return E.concat(A)});return new mf(m,x)}}class Mn{static fromPoints(t){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of t)sh(i,i,h),rh(l,l,h);return new Mn(i,l)}static applyTransform(t,i){const l=t.getCorners();for(let h=0;h<l.length;++h)Fi(l[h],l[h],i);return Mn.fromPoints(l)}constructor(t,i){this.min=t,this.max=i,this.center=ns([],Ir([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],l=Lm(this.min),h=Lm(this.max);for(let f=0;f<i.length;f++)l[f]=i[f]?this.min[f]:this.center[f],h[f]=i[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Mn(l,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){const i=this.getCorners();let l=!0;for(let h=0;h<t.planes.length;h++){const f=t.planes[h];let m=0;for(let x=0;x<i.length;x++)m+=ms(f,i[x])+f[3]>=0;if(m===0)return 0;m!==i.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let f=Number.MAX_VALUE,m=-Number.MAX_VALUE;for(let x=0;x<t.points.length;x++){const w=t.points[x][h]-this.min[h];f=Math.min(f,w),m=Math.max(m,w)}if(m<0||f>this.max[h]-this.min[h])return 0}return 1}}const gf=5,qm=6,tr=ye/Math.PI/2,kv=16383,xa=64,ch=[xa,32,16],gs=-tr,ys=tr,Dv=[new Mn([gs,gs,gs],[ys,ys,ys]),new Mn([gs,gs,gs],[0,0,ys]),new Mn([0,gs,gs],[ys,0,ys]),new Mn([gs,0,gs],[0,ys,ys]),new Mn([0,0,gs],[ys,ys,ys])];function od(e){return e*tr/dh}function $m(e,t,i,l=!0){const h=ns([],e._camera.position,e.worldSize),f=[t,i,1,1];ya(f,f,e.pixelMatrixInverse),Om(f,f,1/f[3]);const m=Sn([],Fs([],f,h)),x=e.globeMatrix,w=[x[12],x[13],x[14]],E=Fs([],w,h),A=nh(E),k=Sn([],E),D=e.worldSize/(2*Math.PI),O=ms(k,m),B=Math.asin(D/A);if(B<Math.acos(O)){if(!l)return null;const Ht=[],Pt=[];ns(Ht,m,A/O),Sn(Pt,Fs(Pt,Ht,E)),Sn(m,Ir(m,E,ns(m,Pt,Math.tan(B)*A)))}const V=[];new ff(h,m).closestPointOnSphere(w,D,V);const Z=Sn([],Hs(x,0)),tt=Sn([],Hs(x,1)),lt=Sn([],Hs(x,2)),et=ms(Z,V),ot=ms(tt,V),dt=ms(lt,V),ut=Ge(Math.asin(-ot/D));let Ct=Ge(Math.atan2(et,dt));Ct=e.center.lng+function(Ht,Pt){const Vt=(Pt-Ht+180)%360-180;return Vt<-180?Vt+360:Vt}(e.center.lng,Ct);const St=ir(Ct),Bt=be(nr(ut),0,1);return new Il(St,Bt)}class Lv{constructor(t,i,l){this.a=Fs([],t,l),this.b=Fs([],i,l),this.center=l;const h=Sn([],this.a),f=Sn([],this.b);this.angle=Math.acos(ms(h,f))}}function yf(e,t){if(e.angle===0)return null;let i;return i=e.a[t]===0?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),i<0||i>1?null:function(l,h,f,m){const x=Math.sin(f);return l*(Math.sin((1-m)*f)/x)+h*(Math.sin(m*f)/x)}(e.a[t],e.b[t],e.angle,be(i,0,1))+e.center[t]}function er(e){if(e.z<=1)return Dv[e.z+2*e.y+e.x];const t=xf(ad(e));return Mn.fromPoints(t)}function va(e,t,i){return ns(e,e,1-i),oh(e,e,t,i)}function Wm(e,t){const i=Cl(t.zoom);if(i===0)return er(e);const l=ad(e),h=xf(l),f=ir(l.getWest())*t.worldSize,m=ir(l.getEast())*t.worldSize,x=nr(l.getNorth())*t.worldSize,w=nr(l.getSouth())*t.worldSize,E=[f,x,0],A=[m,x,0],k=[f,w,0],D=[m,w,0],O=cf([],t.globeMatrix);return Fi(E,E,O),Fi(A,A,O),Fi(k,k,O),Fi(D,D,O),h[0]=va(h[0],k,i),h[1]=va(h[1],D,i),h[2]=va(h[2],A,i),h[3]=va(h[3],E,i),Mn.fromPoints(h)}function Zm(e,t,i){for(const l of e)Fi(l,l,t),ns(l,l,i)}function zv(e,t,i){const l=t/e.worldSize,h=e.globeMatrix;if(i.z<=1){const St=er(i).getCorners();return Zm(St,h,l),Mn.fromPoints(St)}const f=ad(i),m=xf(f);Zm(m,h,l);const x=Number.MAX_VALUE,w=[-x,-x,-x],E=[x,x,x];if(f.contains(e.center)){for(const Ht of m)sh(E,E,Ht),rh(w,w,Ht);w[2]=0;const St=e.point,Bt=[St.x*l,St.y*l,0];return sh(E,E,Bt),rh(w,w,Bt),new Mn(E,w)}const A=[h[12]*l,h[13]*l,h[14]*l],k=f.getCenter(),D=be(e.center.lat,-_n,_n),O=be(k.lat,-_n,_n),B=ir(e.center.lng),V=nr(D);let Z=B-ir(k.lng);const tt=V-nr(O);Z>.5?Z-=1:Z<-.5&&(Z+=1);let lt=0;Math.abs(Z)>Math.abs(tt)?lt=Z>=0?1:3:(lt=tt>=0?0:2,oh(A,A,[h[4]*l,h[5]*l,h[6]*l],-Math.sin(fe(tt>=0?f.getSouth():f.getNorth()))*tr));const et=m[lt],ot=m[(lt+1)%4],dt=new Lv(et,ot,A),ut=[yf(dt,0)||et[0],yf(dt,1)||et[1],yf(dt,2)||et[2]],Ct=Cl(e.zoom);if(Ct>0){const St=function({x:Ht,y:Pt,z:Vt},Ut,qt,Qt,zt){const re=1/(1<<Vt);let pe=Ht*re,oe=pe+re,Te=Pt*re,te=Te+re,ge=0;const Ee=(pe+oe)/2-Qt;return Ee>.5?ge=-1:Ee<-.5&&(ge=1),pe=((pe+ge)*Ut-(Qt*=Ut))*qt+Qt,oe=((oe+ge)*Ut-Qt)*qt+Qt,Te=(Te*Ut-(zt*=Ut))*qt+zt,te=(te*Ut-zt)*qt+zt,[[pe,te,0],[oe,te,0],[oe,Te,0],[pe,Te,0]]}(i,t,e._pixelsPerMercatorPixel,B,V);for(let Ht=0;Ht<m.length;Ht++)va(m[Ht],St[Ht],Ct);const Bt=Ir([],St[lt],St[(lt+1)%4]);ns(Bt,Bt,.5),va(ut,Bt,Ct)}for(const St of m)sh(E,E,St),rh(w,w,St);return E[2]=Math.min(et[2],ot[2]),sh(E,E,ut),rh(w,w,ut),new Mn(E,w)}function ad({x:e,y:t,z:i}){const l=1/(1<<i),h=new oi(ss(e*l),fn((t+1)*l)),f=new oi(ss((e+1)*l),fn(t*l));return new _o(h,f)}function xf(e){const t=fe(e.getNorth()),i=fe(e.getSouth()),l=Math.cos(t),h=Math.cos(i),f=Math.sin(t),m=Math.sin(i),x=e.getWest(),w=e.getEast();return[Ml(h,m,x),Ml(h,m,w),Ml(l,f,w),Ml(l,f,x)]}function Ml(e,t,i,l=tr){return i=fe(i),[e*Math.sin(i)*l,-t*l,e*Math.cos(i)*l]}function Al(e,t,i){return Ml(Math.cos(fe(e)),Math.sin(fe(e)),t,i)}function hh(e,t,i,l){const h=1<<i.z,f=(e/ye+i.x)/h;return Al(fn((t/ye+i.y)/h),ss(f),l)}function ld({min:e,max:t}){return kv/Math.max(t[0]-e[0],t[1]-e[1],t[2]-e[2])}const Hm=new Float64Array(16);function uh(e){const t=ld(e),i=km(Hm,[t,t,t]);return ih(i,i,((l=[])[0]=-(h=e.min)[0],l[1]=-h[1],l[2]=-h[2],l));var l,h}function vf(e){const t=(l=e.min,(i=Hm)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const h=1/ld(e);return ga(t,t,[h,h,h])}function Xm(e,t,i,l,h){const f=function(w){const E=ye/(2*Math.PI);return w/(2*Math.PI)/E}(i),m=[e,t,-i/(2*Math.PI)],x=Bs(new Float64Array(16));return ih(x,x,m),ga(x,x,[f,f,f]),hf(x,x,fe(-h)),rd(x,x,fe(-l)),x}function Cl(e){return Pi(gf,qm,e)}function Ym(e,t){const i=Al(t.lat,t.lng),l=function(B){const V=Al(B._center.lat,B._center.lng);let Z=pf([],Sl(0,1,0),V);const tt=Dm([],-B.angle,V);Z=Fi(Z,Z,tt),Dm(tt,-B._pitch,Z);const lt=Sn([],V);return ns(lt,lt,od(B.cameraToCenterDistance/B.pixelsPerMeter)),Fi(lt,lt,tt),Ir([],V,lt)}(e);return m=(h=df([],l,i))[0],x=h[1],w=h[2],E=(f=i)[0],A=f[1],k=f[2],O=(D=Math.sqrt(m*m+x*x+w*w)*Math.sqrt(E*E+A*A+k*k))&&ms(h,f)/D,Math.acos(Math.min(Math.max(O,-1),1));var h,f,m,x,w,E,A,k,D,O}function bf(e,t){return Ym(e,t)>Math.PI/2*1.01}const Km=fe(85),Rv=Math.cos(Km),Ov=Math.sin(Km),dh=63710088e-1,Jm=2*Math.PI*dh;class mo{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mo(vi(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,l=this.lat*i,h=t.lat*i,f=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return dh*Math.acos(Math.min(f,1))}toBounds(t=0){const i=360*t/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new _o(new mo(this.lng-l,this.lat-i),new mo(this.lng+l,this.lat+i))}toEcef(t){const i=od(t);return Al(this.lat,this.lng,tr+i)}static convert(t){if(t instanceof mo)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new mo(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new mo(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var oi=mo;function wf(e){return Jm*Math.cos(e*Math.PI/180)}function ir(e){return(180+e)/360}function nr(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Ns(e,t){return e/wf(t)}function ss(e){return 360*e-180}function fn(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Qm(e,t){return e*wf(fn(t))}const _n=85.051129;function tg(e){return 1/Math.cos(e*Math.PI/180)}class Il{constructor(t,i,l=0){this.x=+t,this.y=+i,this.z=+l}static fromLngLat(t,i=0){const l=oi.convert(t);return new Il(ir(l.lng),nr(l.lat),Ns(i,l.lat))}toLngLat(){return new oi(ss(this.x),fn(this.y))}toAltitude(){return Qm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Jm*tg(fn(this.y))}}function Tf(e,t,i,l,h,f,m,x,w){const E=(t+l)/2,A=(i+h)/2,k=new Lt(E,A);x(k),function(D,O,B,V,Z,tt){const lt=B-Z,et=V-tt;return Math.abs((V-O)*lt-(B-D)*et)/Math.hypot(lt,et)}(k.x,k.y,f.x,f.y,m.x,m.y)>=w?(Tf(e,t,i,E,A,f,k,x,w),Tf(e,E,A,l,h,k,m,x,w)):e.push(m)}function eg(e,t,i){let l=e[0],h=l.x,f=l.y;t(l);const m=[l];for(let x=1;x<e.length;x++){const w=e[x],{x:E,y:A}=w;t(w),Tf(m,h,f,E,A,l,w,t,i),h=E,f=A,l=w}return m}function Ef(e,t,i,l){if(l(t,i)){const h=t.add(i)._mult(.5);Ef(e,t,h,l),Ef(e,h,i,l)}else e.push(i)}function Bv(e,t){let i=e[0];const l=[i];for(let h=1;h<e.length;h++){const f=e[h];Ef(l,i,f,t),i=f}return l}const Sf=Math.pow(2,14)-1,ig=-Sf-1;function Fv(e,t){const i=Math.round(e.x*t),l=Math.round(e.y*t);return e.x=be(i,ig,Sf),e.y=be(l,ig,Sf),(i<e.x||i>e.x+1||l<e.y||l>e.y+1)&&Ei("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Pr(e,t,i){const l=e.loadGeometry(),h=e.extent,f=ye/h;if(t&&i&&i.projection.isReprojectedInTileSpace){const m=1<<t.z,{scale:x,x:w,y:E,projection:A}=i,k=D=>{const O=ss((t.x+D.x/h)/m),B=fn((t.y+D.y/h)/m),V=A.project(O,B);D.x=(V.x*x-w)*h,D.y=(V.y*x-E)*h};for(let D=0;D<l.length;D++)if(e.type!==1)l[D]=eg(l[D],k,1);else{const O=[];for(const B of l[D])B.x<0||B.x>=h||B.y<0||B.y>=h||(k(B),O.push(B));l[D]=O}}for(const m of l)for(const x of m)Fv(x,f);return l}function ba(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Pr(e):[]}}function cd(e,t,i,l,h){e.emplaceBack(2*t+(l+1)/2,2*i+(h+1)/2)}function hd(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Mf{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Zt,this.indexArray=new _e,this.segments=new Ui,this.programConfigurations=new _a(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,l,h){const f=this.layers[0],m=[];let x=null;f.type==="circle"&&(x=f.layout.get("circle-sort-key"));for(const{feature:E,id:A,index:k,sourceLayerIndex:D}of t){const O=this.layers[0]._featureFilter.needGeometry,B=ba(E,O);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),B,l))continue;const V=x?x.evaluate(B,{},l):void 0,Z={id:A,properties:E.properties,type:E.type,sourceLayerIndex:D,index:k,geometry:O?B.geometry:Pr(E,l,h),patterns:{},sortKey:V};m.push(Z)}x&&m.sort((E,A)=>E.sortKey-A.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Xt,w=h.projection);for(const E of m){const{geometry:A,index:k,sourceLayerIndex:D}=E,O=t[k].feature;this.addFeature(E,A,k,i.availableImages,l,w),i.featureIndex.insert(O,A,k,D,this.index)}}update(t,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ev.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Sv.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,i,l,h,f,m){for(const x of i)for(const w of x){const E=w.x,A=w.y;if(E<0||E>=ye||A<0||A>=ye)continue;if(m){const O=m.projectTilePoint(E,A,f),B=m.upVector(f,E,A),V=this.globeExtVertexArray;hd(V,O,B),hd(V,O,B),hd(V,O,B),hd(V,O,B)}const k=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),D=k.vertexLength;cd(this.layoutVertexArray,E,A,-1,-1),cd(this.layoutVertexArray,E,A,1,-1),cd(this.layoutVertexArray,E,A,1,1),cd(this.layoutVertexArray,E,A,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+2,D+3),k.vertexLength+=4,k.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,{},h,f)}}function ng(e,t){for(let i=0;i<e.length;i++)if(wa(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(wa(e,t[i]))return!0;return!!Af(e,t)}function Nv(e,t,i){return!!wa(e,t)||!!Cf(t,e,i)}function sg(e,t){if(e.length===1)return og(t,e[0]);for(let i=0;i<t.length;i++){const l=t[i];for(let h=0;h<l.length;h++)if(wa(e,l[h]))return!0}for(let i=0;i<e.length;i++)if(og(t,e[i]))return!0;for(let i=0;i<t.length;i++)if(Af(e,t[i]))return!0;return!1}function jv(e,t,i){if(e.length>1){if(Af(e,t))return!0;for(let l=0;l<t.length;l++)if(Cf(t[l],e,i))return!0}for(let l=0;l<e.length;l++)if(Cf(e[l],t,i))return!0;return!1}function Af(e,t){if(e.length===0||t.length===0)return!1;for(let i=0;i<e.length-1;i++){const l=e[i],h=e[i+1];for(let f=0;f<t.length-1;f++)if(Vv(l,h,t[f],t[f+1]))return!0}return!1}function Vv(e,t,i,l){return jn(e,i,l)!==jn(t,i,l)&&jn(e,t,i)!==jn(e,t,l)}function Cf(e,t,i){const l=i*i;if(t.length===1)return e.distSqr(t[0])<l;for(let h=1;h<t.length;h++)if(rg(e,t[h-1],t[h])<l)return!0;return!1}function rg(e,t,i){const l=t.distSqr(i);if(l===0)return e.distSqr(t);const h=((e.x-t.x)*(i.x-t.x)+(e.y-t.y)*(i.y-t.y))/l;return e.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function og(e,t){let i,l,h,f=!1;for(let m=0;m<e.length;m++){i=e[m];for(let x=0,w=i.length-1;x<i.length;w=x++)l=i[x],h=i[w],l.y>t.y!=h.y>t.y&&t.x<(h.x-l.x)*(t.y-l.y)/(h.y-l.y)+l.x&&(f=!f)}return f}function wa(e,t){let i=!1;for(let l=0,h=e.length-1;l<e.length;h=l++){const f=e[l],m=e[h];f.y>t.y!=m.y>t.y&&t.x<(m.x-f.x)*(t.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function ag(e,t,i,l,h){for(const m of e)if(t<=m.x&&i<=m.y&&l>=m.x&&h>=m.y)return!0;const f=[new Lt(t,i),new Lt(t,h),new Lt(l,h),new Lt(l,i)];if(e.length>2){for(const m of f)if(wa(e,m))return!0}for(let m=0;m<e.length-1;m++)if(Uv(e[m],e[m+1],f))return!0;return!1}function Uv(e,t,i){const l=i[0],h=i[2];if(e.x<l.x&&t.x<l.x||e.x>h.x&&t.x>h.x||e.y<l.y&&t.y<l.y||e.y>h.y&&t.y>h.y)return!1;const f=jn(e,t,i[0]);return f!==jn(e,t,i[1])||f!==jn(e,t,i[2])||f!==jn(e,t,i[3])}function Pl(e,t,i){const l=t.paint.get(e).value;return l.kind==="constant"?l.value:i.programConfigurations.get(t.id).getMaxValue(e)}function ud(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function lg(e,t,i,l,h){if(!t[0]&&!t[1])return e;const f=Lt.convert(t)._mult(h);i==="viewport"&&f._rotate(-l);const m=[];for(let x=0;x<e.length;x++)m.push(e[x].sub(f));return m}function cg(e,t,i,l){const h=Lt.convert(e)._mult(l);return t==="viewport"&&h._rotate(-i),h}he(Mf,"CircleBucket",{omit:["layers"]});const Gv=new st({"circle-sort-key":new H(Ot.layout_circle["circle-sort-key"])});var qv={paint:new st({"circle-radius":new H(Ot.paint_circle["circle-radius"]),"circle-color":new H(Ot.paint_circle["circle-color"]),"circle-blur":new H(Ot.paint_circle["circle-blur"]),"circle-opacity":new H(Ot.paint_circle["circle-opacity"]),"circle-translate":new j(Ot.paint_circle["circle-translate"]),"circle-translate-anchor":new j(Ot.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new j(Ot.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new j(Ot.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new H(Ot.paint_circle["circle-stroke-width"]),"circle-stroke-color":new H(Ot.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new H(Ot.paint_circle["circle-stroke-opacity"])}),layout:Gv};function hg(e,t,i,l,h,f,m,x,w){if(f&&e.queryGeometry.isAboveHorizon)return!1;f&&(w*=e.pixelToTileUnitsFactor);const E=e.tileID.canonical,A=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const k of t)for(const D of k){const O=D.add(x),B=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(O.x,O.y,!0):0,V=i.projection.projectTilePoint(O.x,O.y,E);if(B>0){const et=i.projection.upVector(E,O.x,O.y);V.x+=et[0]*A*B,V.y+=et[1]*A*B,V.z+=et[2]*A*B}const Z=f?O:$v(V.x,V.y,V.z,l),tt=f?e.tilespaceRays.map(et=>Zv(et,B)):e.queryGeometry.screenGeometry,lt=ya([],[V.x,V.y,V.z,1],l);if(!m&&f?w*=lt[3]/i.cameraToCenterDistance:m&&!f&&(w*=i.cameraToCenterDistance/lt[3]),f){const et=fn((D.y/ye+E.y)/(1<<E.z));w/=i.projection.pixelsPerMeter(et,1)/Ns(1,et)}if(Nv(tt,Z,w))return!0}return!1}function $v(e,t,i,l){const h=ya([],[e,t,i,1],l);return new Lt(h[0]/h[3],h[1]/h[3])}const ug=Sl(0,0,0),Wv=Sl(0,0,1);function Zv(e,t){const i=uf();return ug[2]=t,e.intersectsPlane(ug,Wv,i),new Lt(i[0],i[1])}class dg extends Mf{}function pg(e,{width:t,height:i},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*i*l);return e.width=t,e.height=i,e.data=h,e}function fg(e,t,i){const{width:l,height:h}=t;l===e.width&&h===e.height||(If(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,l),height:Math.min(e.height,h)},i),e.width=l,e.height=h,e.data=t.data)}function If(e,t,i,l,h,f){if(h.width===0||h.height===0)return t;if(h.width>e.width||h.height>e.height||i.x>e.width-h.width||i.y>e.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||l.x>t.width-h.width||l.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const m=e.data,x=t.data;for(let w=0;w<h.height;w++){const E=((i.y+w)*e.width+i.x)*f,A=((l.y+w)*t.width+l.x)*f;for(let k=0;k<h.width*f;k++)x[A+k]=m[E+k]}return t}he(dg,"HeatmapBucket",{omit:["layers"]});class kr{constructor(t,i){pg(this,t,1,i)}resize(t){fg(this,new kr(t),1)}clone(){return new kr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,l,h,f){If(t,i,l,h,f,1)}}class Hn{constructor(t,i){pg(this,t,4,i)}resize(t){fg(this,new Hn(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Hn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,l,h,f){If(t,i,l,h,f,4)}}he(kr,"AlphaImage"),he(Hn,"RGBAImage");var Hv={paint:new st({"heatmap-radius":new H(Ot.paint_heatmap["heatmap-radius"]),"heatmap-weight":new H(Ot.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new j(Ot.paint_heatmap["heatmap-intensity"]),"heatmap-color":new nt(Ot.paint_heatmap["heatmap-color"]),"heatmap-opacity":new j(Ot.paint_heatmap["heatmap-opacity"])})};function Pf(e){const t={},i=e.resolution||256,l=e.clips?e.clips.length:1,h=e.image||new Hn({width:i,height:l}),f=(m,x,w)=>{t[e.evaluationKey]=w;const E=e.expression.evaluate(t);h.data[m+x+0]=Math.floor(255*E.r/E.a),h.data[m+x+1]=Math.floor(255*E.g/E.a),h.data[m+x+2]=Math.floor(255*E.b/E.a),h.data[m+x+3]=Math.floor(255*E.a)};if(e.clips)for(let m=0,x=0;m<l;++m,x+=4*i)for(let w=0,E=0;w<i;w++,E+=4){const A=w/(i-1),{start:k,end:D}=e.clips[m];f(x,E,k*(1-A)+D*A)}else for(let m=0,x=0;m<i;m++,x+=4)f(0,x,m/(i-1));return h}var Xv={paint:new st({"hillshade-illumination-direction":new j(Ot.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new j(Ot.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new j(Ot.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new j(Ot.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new j(Ot.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new j(Ot.paint_hillshade["hillshade-accent-color"])})};const Yv=xt([{name:"a_pos",components:2,type:"Int16"}],4),{members:Kv}=Yv;var kf={exports:{}};function dd(e,t,i){i=i||2;var l,h,f,m,x,w,E,A=t&&t.length,k=A?t[0]*i:e.length,D=_g(e,0,k,i,!0),O=[];if(!D||D.next===D.prev)return O;if(A&&(D=function(V,Z,tt,lt){var et,ot,dt,ut=[];for(et=0,ot=Z.length;et<ot;et++)(dt=_g(V,Z[et]*lt,et<ot-1?Z[et+1]*lt:V.length,lt,!1))===dt.next&&(dt.steiner=!0),ut.push(rb(dt));for(ut.sort(ib),et=0;et<ut.length;et++)tt=nb(ut[et],tt);return tt}(e,t,D,i)),e.length>80*i){l=f=e[0],h=m=e[1];for(var B=i;B<k;B+=i)(x=e[B])<l&&(l=x),(w=e[B+1])<h&&(h=w),x>f&&(f=x),w>m&&(m=w);E=(E=Math.max(f-l,m-h))!==0?32767/E:0}return ph(D,O,i,l,h,E,0),O}function _g(e,t,i,l,h){var f,m;if(h===zf(e,t,i,l)>0)for(f=t;f<i;f+=l)m=yg(f,e[f],e[f+1],m);else for(f=i-l;f>=t;f-=l)m=yg(f,e[f],e[f+1],m);return m&&pd(m,m.next)&&(_h(m),m=m.next),m}function Ta(e,t){if(!e)return e;t||(t=e);var i,l=e;do if(i=!1,l.steiner||!pd(l,l.next)&&Gi(l.prev,l,l.next)!==0)l=l.next;else{if(_h(l),(l=t=l.prev)===l.next)break;i=!0}while(i||l!==t);return t}function ph(e,t,i,l,h,f,m){if(e){!m&&f&&function(A,k,D,O){var B=A;do B.z===0&&(B.z=Df(B.x,B.y,k,D,O)),B.prevZ=B.prev,B.nextZ=B.next,B=B.next;while(B!==A);B.prevZ.nextZ=null,B.prevZ=null,function(V){var Z,tt,lt,et,ot,dt,ut,Ct,St=1;do{for(tt=V,V=null,ot=null,dt=0;tt;){for(dt++,lt=tt,ut=0,Z=0;Z<St&&(ut++,lt=lt.nextZ);Z++);for(Ct=St;ut>0||Ct>0&&lt;)ut!==0&&(Ct===0||!lt||tt.z<=lt.z)?(et=tt,tt=tt.nextZ,ut--):(et=lt,lt=lt.nextZ,Ct--),ot?ot.nextZ=et:V=et,et.prevZ=ot,ot=et;tt=lt}ot.nextZ=null,St*=2}while(dt>1)}(B)}(e,l,h,f);for(var x,w,E=e;e.prev!==e.next;)if(x=e.prev,w=e.next,f?Qv(e,l,h,f):Jv(e))t.push(x.i/i|0),t.push(e.i/i|0),t.push(w.i/i|0),_h(e),e=w.next,E=w.next;else if((e=w)===E){m?m===1?ph(e=tb(Ta(e),t,i),t,i,l,h,f,2):m===2&&eb(e,t,i,l,h,f):ph(Ta(e),t,i,l,h,f,1);break}}}function Jv(e){var t=e.prev,i=e,l=e.next;if(Gi(t,i,l)>=0)return!1;for(var h=t.x,f=i.x,m=l.x,x=t.y,w=i.y,E=l.y,A=h<f?h<m?h:m:f<m?f:m,k=x<w?x<E?x:E:w<E?w:E,D=h>f?h>m?h:m:f>m?f:m,O=x>w?x>E?x:E:w>E?w:E,B=l.next;B!==t;){if(B.x>=A&&B.x<=D&&B.y>=k&&B.y<=O&&kl(h,x,f,w,m,E,B.x,B.y)&&Gi(B.prev,B,B.next)>=0)return!1;B=B.next}return!0}function Qv(e,t,i,l){var h=e.prev,f=e,m=e.next;if(Gi(h,f,m)>=0)return!1;for(var x=h.x,w=f.x,E=m.x,A=h.y,k=f.y,D=m.y,O=x<w?x<E?x:E:w<E?w:E,B=A<k?A<D?A:D:k<D?k:D,V=x>w?x>E?x:E:w>E?w:E,Z=A>k?A>D?A:D:k>D?k:D,tt=Df(O,B,t,i,l),lt=Df(V,Z,t,i,l),et=e.prevZ,ot=e.nextZ;et&&et.z>=tt&&ot&&ot.z<=lt;){if(et.x>=O&&et.x<=V&&et.y>=B&&et.y<=Z&&et!==h&&et!==m&&kl(x,A,w,k,E,D,et.x,et.y)&&Gi(et.prev,et,et.next)>=0||(et=et.prevZ,ot.x>=O&&ot.x<=V&&ot.y>=B&&ot.y<=Z&&ot!==h&&ot!==m&&kl(x,A,w,k,E,D,ot.x,ot.y)&&Gi(ot.prev,ot,ot.next)>=0))return!1;ot=ot.nextZ}for(;et&&et.z>=tt;){if(et.x>=O&&et.x<=V&&et.y>=B&&et.y<=Z&&et!==h&&et!==m&&kl(x,A,w,k,E,D,et.x,et.y)&&Gi(et.prev,et,et.next)>=0)return!1;et=et.prevZ}for(;ot&&ot.z<=lt;){if(ot.x>=O&&ot.x<=V&&ot.y>=B&&ot.y<=Z&&ot!==h&&ot!==m&&kl(x,A,w,k,E,D,ot.x,ot.y)&&Gi(ot.prev,ot,ot.next)>=0)return!1;ot=ot.nextZ}return!0}function tb(e,t,i){var l=e;do{var h=l.prev,f=l.next.next;!pd(h,f)&&mg(h,l,l.next,f)&&fh(h,f)&&fh(f,h)&&(t.push(h.i/i|0),t.push(l.i/i|0),t.push(f.i/i|0),_h(l),_h(l.next),l=e=f),l=l.next}while(l!==e);return Ta(l)}function eb(e,t,i,l,h,f){var m=e;do{for(var x=m.next.next;x!==m.prev;){if(m.i!==x.i&&ob(m,x)){var w=gg(m,x);return m=Ta(m,m.next),w=Ta(w,w.next),ph(m,t,i,l,h,f,0),void ph(w,t,i,l,h,f,0)}x=x.next}m=m.next}while(m!==e)}function ib(e,t){return e.x-t.x}function nb(e,t){var i=function(h,f){var m,x=f,w=h.x,E=h.y,A=-1/0;do{if(E<=x.y&&E>=x.next.y&&x.next.y!==x.y){var k=x.x+(E-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(k<=w&&k>A&&(A=k,m=x.x<x.next.x?x:x.next,k===w))return m}x=x.next}while(x!==f);if(!m)return null;var D,O=m,B=m.x,V=m.y,Z=1/0;x=m;do w>=x.x&&x.x>=B&&w!==x.x&&kl(E<V?w:A,E,B,V,E<V?A:w,E,x.x,x.y)&&(D=Math.abs(E-x.y)/(w-x.x),fh(x,h)&&(D<Z||D===Z&&(x.x>m.x||x.x===m.x&&sb(m,x)))&&(m=x,Z=D)),x=x.next;while(x!==O);return m}(e,t);if(!i)return t;var l=gg(i,e);return Ta(l,l.next),Ta(i,i.next)}function sb(e,t){return Gi(e.prev,e,t.prev)<0&&Gi(t.next,e,e.next)<0}function Df(e,t,i,l,h){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-l)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function rb(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function kl(e,t,i,l,h,f,m,x){return(h-m)*(t-x)>=(e-m)*(f-x)&&(e-m)*(l-x)>=(i-m)*(t-x)&&(i-m)*(f-x)>=(h-m)*(l-x)}function ob(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(i,l){var h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==l.i&&h.next.i!==l.i&&mg(h,h.next,i,l))return!0;h=h.next}while(h!==i);return!1}(e,t)&&(fh(e,t)&&fh(t,e)&&function(i,l){var h=i,f=!1,m=(i.x+l.x)/2,x=(i.y+l.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&m<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next;while(h!==i);return f}(e,t)&&(Gi(e.prev,e,t.prev)||Gi(e,t.prev,t))||pd(e,t)&&Gi(e.prev,e,e.next)>0&&Gi(t.prev,t,t.next)>0)}function Gi(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function pd(e,t){return e.x===t.x&&e.y===t.y}function mg(e,t,i,l){var h=_d(Gi(e,t,i)),f=_d(Gi(e,t,l)),m=_d(Gi(i,l,e)),x=_d(Gi(i,l,t));return h!==f&&m!==x||!(h!==0||!fd(e,i,t))||!(f!==0||!fd(e,l,t))||!(m!==0||!fd(i,e,l))||!(x!==0||!fd(i,t,l))}function fd(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function _d(e){return e>0?1:e<0?-1:0}function fh(e,t){return Gi(e.prev,e,e.next)<0?Gi(e,t,e.next)>=0&&Gi(e,e.prev,t)>=0:Gi(e,t,e.prev)<0||Gi(e,e.next,t)<0}function gg(e,t){var i=new Lf(e.i,e.x,e.y),l=new Lf(t.i,t.x,t.y),h=e.next,f=t.prev;return e.next=t,t.prev=e,i.next=h,h.prev=i,l.next=i,i.prev=l,f.next=l,l.prev=f,l}function yg(e,t,i,l){var h=new Lf(e,t,i);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function _h(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Lf(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function zf(e,t,i,l){for(var h=0,f=t,m=i-l;f<i;f+=l)h+=(e[m]-e[f])*(e[f+1]+e[m+1]),m=f;return h}kf.exports=dd,kf.exports.default=dd,dd.deviation=function(e,t,i,l){var h=t&&t.length,f=Math.abs(zf(e,0,h?t[0]*i:e.length,i));if(h)for(var m=0,x=t.length;m<x;m++)f-=Math.abs(zf(e,t[m]*i,m<x-1?t[m+1]*i:e.length,i));var w=0;for(m=0;m<l.length;m+=3){var E=l[m]*i,A=l[m+1]*i,k=l[m+2]*i;w+=Math.abs((e[E]-e[k])*(e[A+1]-e[E+1])-(e[E]-e[A])*(e[k+1]-e[E+1]))}return f===0&&w===0?0:Math.abs((w-f)/f)},dd.flatten=function(e){for(var t=e[0][0].length,i={vertices:[],holes:[],dimensions:t},l=0,h=0;h<e.length;h++){for(var f=0;f<e[h].length;f++)for(var m=0;m<t;m++)i.vertices.push(e[h][f][m]);h>0&&i.holes.push(l+=e[h-1].length)}return i};var Rf=Ft(kf.exports);function ab(e,t,i,l,h){xg(e,t,i||0,l||e.length-1,h||lb)}function xg(e,t,i,l,h){for(;l>i;){if(l-i>600){var f=l-i+1,m=t-i+1,x=Math.log(f),w=.5*Math.exp(2*x/3),E=.5*Math.sqrt(x*w*(f-w)/f)*(m-f/2<0?-1:1);xg(e,t,Math.max(i,Math.floor(t-m*w/f+E)),Math.min(l,Math.floor(t+(f-m)*w/f+E)),h)}var A=e[t],k=i,D=l;for(mh(e,i,t),h(e[l],A)>0&&mh(e,i,l);k<D;){for(mh(e,k,D),k++,D--;h(e[k],A)<0;)k++;for(;h(e[D],A)>0;)D--}h(e[i],A)===0?mh(e,i,D):mh(e,++D,l),D<=t&&(i=D+1),t<=D&&(l=D-1)}}function mh(e,t,i){var l=e[t];e[t]=e[i],e[i]=l}function lb(e,t){return e<t?-1:e>t?1:0}function Of(e,t){const i=e.length;if(i<=1)return[e];const l=[];let h,f;for(let m=0;m<i;m++){const x=qa(e[m]);x!==0&&(e[m].area=Math.abs(x),f===void 0&&(f=x<0),f===x<0?(h&&l.push(h),h=[e[m]]):h.push(e[m]))}if(h&&l.push(h),t>1)for(let m=0;m<l.length;m++)l[m].length<=t||(ab(l[m],t,1,l[m].length-1,cb),l[m]=l[m].slice(0,t));return l}function cb(e,t){return t.area-e.area}function Bf(e,t,i){const l=i.patternDependencies;let h=!1;for(const f of t){const m=f.paint.get(`${e}-pattern`);m.isConstant()||(h=!0);const x=m.constantOr(null);x&&(h=!0,l[x]=!0)}return h}function Ff(e,t,i,l,h){const f=h.patternDependencies;for(const m of t){const x=m.paint.get(`${e}-pattern`).value;if(x.kind!=="constant"){let w=x.evaluate({zoom:l},i,{},h.availableImages);w=w&&w.name?w.name:w,f[w]=!0,i.patterns[m.id]=w}}return i}class md{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Zt,this.indexArray=new _e,this.indexArray2=new nn,this.programConfigurations=new _a(t.layers,t.zoom),this.segments=new Ui,this.segments2=new Ui,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection}populate(t,i,l,h){this.hasPattern=Bf("fill",this.layers,i);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:x,id:w,index:E,sourceLayerIndex:A}of t){const k=this.layers[0]._featureFilter.needGeometry,D=ba(x,k);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),D,l))continue;const O=f?f.evaluate(D,{},l,i.availableImages):void 0,B={id:w,properties:x.properties,type:x.type,sourceLayerIndex:A,index:E,geometry:k?D.geometry:Pr(x,l,h),patterns:{},sortKey:O};m.push(B)}f&&m.sort((x,w)=>x.sortKey-w.sortKey);for(const x of m){const{geometry:w,index:E,sourceLayerIndex:A}=x;if(this.hasPattern){const k=Ff("fill",this.layers,x,this.zoom,i);this.patternFeatures.push(k)}else this.addFeature(x,w,E,l,{},i.availableImages);i.featureIndex.insert(t[E].feature,w,E,A,this.index)}}update(t,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,l,h)}addFeatures(t,i,l,h,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kv),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,i,l,h,f,m=[]){for(const x of Of(i,500)){let w=0;for(const B of x)w+=B.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),A=E.vertexLength,k=[],D=[];for(const B of x){if(B.length===0)continue;B!==x[0]&&D.push(k.length/2);const V=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),Z=V.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(Z+B.length-1,Z),k.push(B[0].x),k.push(B[0].y);for(let tt=1;tt<B.length;tt++)this.layoutVertexArray.emplaceBack(B[tt].x,B[tt].y),this.indexArray2.emplaceBack(Z+tt-1,Z+tt),k.push(B[tt].x),k.push(B[tt].y);V.vertexLength+=B.length,V.primitiveLength+=B.length}const O=Rf(k,D);for(let B=0;B<O.length;B+=3)this.indexArray.emplaceBack(A+O[B],A+O[B+1],A+O[B+2]);E.vertexLength+=w,E.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,f,m,h)}}he(md,"FillBucket",{omit:["layers","patternFeatures"]});const hb=new st({"fill-sort-key":new H(Ot.layout_fill["fill-sort-key"])});var ub={paint:new st({"fill-antialias":new j(Ot.paint_fill["fill-antialias"]),"fill-opacity":new H(Ot.paint_fill["fill-opacity"]),"fill-color":new H(Ot.paint_fill["fill-color"]),"fill-outline-color":new H(Ot.paint_fill["fill-outline-color"]),"fill-translate":new j(Ot.paint_fill["fill-translate"]),"fill-translate-anchor":new j(Ot.paint_fill["fill-translate-anchor"]),"fill-pattern":new H(Ot.paint_fill["fill-pattern"])}),layout:hb};const db=xt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),pb=xt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),fb=xt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:_b}=db;var gd={},mb=ne,vg=Dl;function Dl(e,t,i,l,h){this.properties={},this.extent=i,this.type=0,this._pbf=e,this._geometry=-1,this._keys=l,this._values=h,e.readFields(gb,this,t)}function gb(e,t,i){e==1?t.id=i.readVarint():e==2?function(l,h){for(var f=l.readVarint()+l.pos;l.pos<f;){var m=h._keys[l.readVarint()],x=h._values[l.readVarint()];h.properties[m]=x}}(i,t):e==3?t.type=i.readVarint():e==4&&(t._geometry=i.pos)}function yb(e){for(var t,i,l=0,h=0,f=e.length,m=f-1;h<f;m=h++)l+=((i=e[m]).x-(t=e[h]).x)*(t.y+i.y);return l}Dl.types=["Unknown","Point","LineString","Polygon"],Dl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,i=e.readVarint()+e.pos,l=1,h=0,f=0,m=0,x=[];e.pos<i;){if(h<=0){var w=e.readVarint();l=7&w,h=w>>3}if(h--,l===1||l===2)f+=e.readSVarint(),m+=e.readSVarint(),l===1&&(t&&x.push(t),t=[]),t.push(new mb(f,m));else{if(l!==7)throw new Error("unknown command "+l);t&&t.push(t[0].clone())}}return t&&x.push(t),x},Dl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,i=1,l=0,h=0,f=0,m=1/0,x=-1/0,w=1/0,E=-1/0;e.pos<t;){if(l<=0){var A=e.readVarint();i=7&A,l=A>>3}if(l--,i===1||i===2)(h+=e.readSVarint())<m&&(m=h),h>x&&(x=h),(f+=e.readSVarint())<w&&(w=f),f>E&&(E=f);else if(i!==7)throw new Error("unknown command "+i)}return[m,w,x,E]},Dl.prototype.toGeoJSON=function(e,t,i){var l,h,f=this.extent*Math.pow(2,i),m=this.extent*e,x=this.extent*t,w=this.loadGeometry(),E=Dl.types[this.type];function A(O){for(var B=0;B<O.length;B++){var V=O[B];O[B]=[360*(V.x+m)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(V.y+x)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(l=0;l<w.length;l++)k[l]=w[l][0];A(w=k);break;case 2:for(l=0;l<w.length;l++)A(w[l]);break;case 3:for(w=function(O){var B=O.length;if(B<=1)return[O];for(var V,Z,tt=[],lt=0;lt<B;lt++){var et=yb(O[lt]);et!==0&&(Z===void 0&&(Z=et<0),Z===et<0?(V&&tt.push(V),V=[O[lt]]):V.push(O[lt]))}return V&&tt.push(V),tt}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)A(w[l][h])}w.length===1?w=w[0]:E="Multi"+E;var D={type:"Feature",geometry:{type:E,coordinates:w},properties:this.properties};return"id"in this&&(D.id=this.id),D};var xb=vg,bg=wg;function wg(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(vb,this,t),this.length=this._features.length}function vb(e,t,i){e===15?t.version=i.readVarint():e===1?t.name=i.readString():e===5?t.extent=i.readVarint():e===2?t._features.push(i.pos):e===3?t._keys.push(i.readString()):e===4&&t._values.push(function(l){for(var h=null,f=l.readVarint()+l.pos;l.pos<f;){var m=l.readVarint()>>3;h=m===1?l.readString():m===2?l.readFloat():m===3?l.readDouble():m===4?l.readVarint64():m===5?l.readVarint():m===6?l.readSVarint():m===7?l.readBoolean():null}return h}(i))}wg.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new xb(this._pbf,t,this.extent,this._keys,this._values)};var bb=bg;function wb(e,t,i){if(e===3){var l=new bb(i,i.readVarint()+i.pos);l.length&&(t[l.name]=l)}}var Nf=gd.VectorTile=function(e,t){this.layers=e.readFields(wb,{},t)},yd=gd.VectorTileFeature=vg;function xd(e,t,i,l){const h=[],f=l===0?(m,x,w,E,A,k)=>{m.push(new Lt(k,w+(k-x)/(E-x)*(A-w)))}:(m,x,w,E,A,k)=>{m.push(new Lt(x+(k-w)/(A-w)*(E-x),k))};for(const m of e){const x=[];for(const w of m){if(w.length<=2)continue;const E=[];for(let D=0;D<w.length-1;D++){const O=w[D].x,B=w[D].y,V=w[D+1].x,Z=w[D+1].y,tt=l===0?O:B,lt=l===0?V:Z;tt<t?lt>t&&f(E,O,B,V,Z,t):tt>i?lt<i&&f(E,O,B,V,Z,i):E.push(w[D]),lt<t&&tt>=t&&f(E,O,B,V,Z,t),lt>i&&tt<=i&&f(E,O,B,V,Z,i)}let A=w[w.length-1];const k=l===0?A.x:A.y;k>=t&&k<=i&&E.push(A),E.length&&(A=E[E.length-1],E[0].x===A.x&&E[0].y===A.y||E.push(E[0]),x.push(E))}x.length&&h.push(x)}return h}gd.VectorTileLayer=bg;const Tb=yd.types,Eb=Math.pow(2,13);function gh(e,t,i,l,h,f,m,x){e.emplaceBack((t<<1)+m,(i<<1)+f,(Math.floor(l*Eb)<<1)+h,Math.round(x))}function yh(e,t,i){e.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class Tg{constructor(){this.acc=new Lt(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Lt(t.x,t.y),this.max=new Lt(t.x,t.y))}append(t,i){this.currentPolyCount.edges++,this.acc._add(t);const l=this.min,h=this.max;t.x<l.x?l.x=t.x:t.x>h.x&&(h.x=t.x),t.y<l.y?l.y=t.y:t.y>h.y&&(h.y=t.y),((t.x===0||t.x===ye)&&t.x===i.x)!=((t.y===0||t.y===ye)&&t.y===i.y)&&this.processBorderOverlap(t,i),i.x<0!=t.x<0&&this.addBorderIntersection(0,Ue(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>ye!=t.x>ye&&this.addBorderIntersection(1,Ue(i.y,t.y,(ye-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,Ue(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>ye!=t.y>ye&&this.addBorderIntersection(3,Ue(i.x,t.x,(ye-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[t];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const l=t.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,t.y)}else{const l=t.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,t.x)}}centroid(){const t=this.polyCount.reduce((i,l)=>i+l.edges,0);return t!==0?this.acc.div(t)._round():new Lt(0,0)}span(){return new Lt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0)}}class xh{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new jt,this.centroidVertexArray=new zs,this.indexArray=new _e,this.programConfigurations=new _a(t.layers,t.zoom),this.segments=new Ui,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.enableTerrain=t.enableTerrain}populate(t,i,l,h){this.features=[],this.hasPattern=Bf("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const m=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*m/(m*m+1)/ye/(1<<f.z)}(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:m,index:x,sourceLayerIndex:w}of t){const E=this.layers[0]._featureFilter.needGeometry,A=ba(f,E);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),A,l))continue;const k={id:m,sourceLayerIndex:w,index:x,geometry:E?A.geometry:Pr(f,l,h),properties:f.properties,type:f.type,patterns:{}},D=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ff("fill-extrusion",this.layers,k,this.zoom,i)):this.addFeature(k,k.geometry,x,l,{},i.availableImages,h),i.featureIndex.insert(f,k.geometry,x,w,this.index,D)}this.sortBorders()}addFeatures(t,i,l,h,f){for(const m of this.features){const{geometry:x}=m;this.addFeature(m,x,m.index,i,l,h,f)}this.sortBorders()}update(t,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,_b),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,fb.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,pb.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,l,h,f,m,x){const w=[new Lt(0,0),new Lt(ye,ye)],E=x.projection,A=E.name==="globe",k=this.enableTerrain&&!A?new Tg:null,D=Tb[t.type]==="Polygon";A&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Xt);const O=Of(i,500);for(let tt=O.length-1;tt>=0;tt--){const lt=O[tt];(lt.length===0||(B=lt[0]).every(et=>et.x<=0)||B.every(et=>et.x>=ye)||B.every(et=>et.y<=0)||B.every(et=>et.y>=ye))&&O.splice(tt,1)}var B;let V;if(A)V=Pg(O,w,h);else{V=[];for(const tt of O)V.push({polygon:tt,bounds:w})}const Z=D?this.edgeRadius:0;for(const{polygon:tt,bounds:lt}of V){let et=0,ot=0;for(const ut of tt)D&&!ut[0].equals(ut[ut.length-1])&&ut.push(ut[0]),ot+=D?ut.length-1:ut.length;const dt=this.segments.prepareSegment((D?5:4)*ot,this.layoutVertexArray,this.indexArray);if(D){const ut=[],Ct=[];et=dt.vertexLength;for(const Bt of tt){let Ht,Pt;Bt.length&&Bt!==tt[0]&&Ct.push(ut.length/2),Ht=Bt[1].sub(Bt[0])._perp()._unit();for(let Vt=1;Vt<Bt.length;Vt++){const Ut=Bt[Vt],qt=Bt[Vt===Bt.length-1?1:Vt+1];let{x:Qt,y:zt}=Ut;if(Z){Pt=qt.sub(Ut)._perp()._unit();const re=Ht.add(Pt)._unit(),pe=Z*Math.min(4,1/(Ht.x*re.x+Ht.y*re.y));Qt+=pe*re.x,zt+=pe*re.y,Ht=Pt}gh(this.layoutVertexArray,Qt,zt,0,0,1,1,0),dt.vertexLength++,ut.push(Ut.x,Ut.y),A&&yh(this.layoutVertexExtArray,E.projectTilePoint(Qt,zt,h),E.upVector(h,Qt,zt))}}const St=Rf(ut,Ct);for(let Bt=0;Bt<St.length;Bt+=3)this.indexArray.emplaceBack(et+St[Bt],et+St[Bt+2],et+St[Bt+1]),dt.primitiveLength++}for(const ut of tt){k&&ut.length&&k.startRing(ut[0]);let Ct,St,Bt,Ht=ut.length>4&&Ag(ut[ut.length-2],ut[0],ut[1]),Pt=Z?Sb(ut[ut.length-2],ut[0],ut[1],Z):0;St=ut[1].sub(ut[0])._perp()._unit();let Vt=!0;for(let Ut=1,qt=0;Ut<ut.length;Ut++){let Qt=ut[Ut-1],zt=ut[Ut];const re=ut[Ut===ut.length-1?1:Ut+1];if(k&&D&&k.currentPolyCount.top++,Mg(zt,Qt,lt)){Z&&(St=re.sub(zt)._perp()._unit(),Vt=!Vt);continue}k&&k.append(zt,Qt);const pe=zt.sub(Qt)._perp(),oe=pe.x/(Math.abs(pe.x)+Math.abs(pe.y)),Te=pe.y>0?1:0,te=Qt.dist(zt);if(qt+te>32768&&(qt=0),Z){Bt=re.sub(zt)._perp()._unit();let Se=Sg(Qt,zt,re,Eg(St,Bt),Z);isNaN(Se)&&(Se=0);const ve=zt.sub(Qt)._unit();Qt=Qt.add(ve.mult(Pt))._round(),zt=zt.add(ve.mult(-Se))._round(),Pt=Se,St=Bt}const ge=dt.vertexLength,Ee=ut.length>4&&Ag(Qt,zt,re);let $e=Cg(qt,Ht,Vt);if(gh(this.layoutVertexArray,Qt.x,Qt.y,oe,Te,0,0,$e),gh(this.layoutVertexArray,Qt.x,Qt.y,oe,Te,0,1,$e),qt+=te,$e=Cg(qt,Ee,!Vt),Ht=Ee,gh(this.layoutVertexArray,zt.x,zt.y,oe,Te,0,0,$e),gh(this.layoutVertexArray,zt.x,zt.y,oe,Te,0,1,$e),dt.vertexLength+=4,this.indexArray.emplaceBack(ge+0,ge+1,ge+2),this.indexArray.emplaceBack(ge+1,ge+3,ge+2),dt.primitiveLength+=2,Z){const Se=et+(Ut===1?ut.length-2:Ut-2),ve=Ut===1?et:Se+1;if(this.indexArray.emplaceBack(ge+1,Se,ge+3),this.indexArray.emplaceBack(Se,ve,ge+3),dt.primitiveLength+=2,Ct===void 0&&(Ct=ge),!Mg(re,ut[Ut],lt)){const fi=Ut===ut.length-1?Ct:dt.vertexLength;this.indexArray.emplaceBack(ge+2,ge+3,fi),this.indexArray.emplaceBack(ge+3,fi+1,fi),this.indexArray.emplaceBack(ge+3,ve,fi+1),dt.primitiveLength+=3}Vt=!Vt}if(A){const Se=this.layoutVertexExtArray,ve=E.projectTilePoint(Qt.x,Qt.y,h),fi=E.projectTilePoint(zt.x,zt.y,h),Ce=E.upVector(h,Qt.x,Qt.y),Ie=E.upVector(h,zt.x,zt.y);yh(Se,ve,Ce),yh(Se,ve,Ce),yh(Se,fi,Ie),yh(Se,fi,Ie)}}D&&(et+=ut.length-1)}}if(k&&k.polyCount.length>0){if(k.borders){k.vertexArrayOffset=this.centroidVertexArray.length;const tt=k.borders,lt=this.featuresOnBorder.push(k)-1;for(let et=0;et<4;et++)tt[et][0]!==Number.MAX_VALUE&&this.borders[et].push(lt)}this.encodeCentroid(k.borders?void 0:k.centroid(),k)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,f,m,h)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((i,l)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[l].borders[t][0])}encodeCentroid(t,i,l=!0){let h,f;if(t)if(t.y!==0){const x=i.span()._mult(this.tileToMeter);h=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(x.x/10)),f=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(t.x+450)),f=0;else h=0,f=+l;let m=l?this.centroidVertexArray.length:i.vertexArrayOffset;for(const x of i.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(m++,h,f);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(m++,0,f),this.centroidVertexArray.emplace(m++,h,f)}}}function Eg(e,t){const i=e.add(t)._unit();return e.x*i.x+e.y*i.y}function Sb(e,t,i,l){const h=t.sub(e)._perp()._unit(),f=i.sub(t)._perp()._unit();return Sg(e,t,i,Eg(h,f),l)}function Sg(e,t,i,l,h){const f=Math.sqrt(1-l*l);return Math.min(e.dist(t)/3,t.dist(i)/3,h*f/l)}function Mg(e,t,i){return e.x<i[0].x&&t.x<i[0].x||e.x>i[1].x&&t.x>i[1].x||e.y<i[0].y&&t.y<i[0].y||e.y>i[1].y&&t.y>i[1].y}function Ag(e,t,i){if(e.x<0||e.x>=ye||t.x<0||t.x>=ye||i.x<0||i.x>=ye)return!1;const l=i.sub(t),h=l.perp(),f=e.sub(t);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&h.x*f.x+h.y*f.y<0}function Cg(e,t,i){const l=t?2|e:-3&e;return i?1|l:-2&l}function Ig(){const e=Math.PI/32,t=Math.tan(e),i=dh;return i*Math.sqrt(1+2*t*t)-i}function Pg(e,t,i){const l=1<<i.z,h=ss(i.x/l),f=ss((i.x+1)/l),m=fn(i.y/l),x=fn((i.y+1)/l);return function(w,E,A,k,D=0,O){const B=[];if(!w.length||!A||!k)return B;const V=(ut,Ct)=>{for(const St of ut)B.push({polygon:St,bounds:Ct})},Z=Math.ceil(Math.log2(A)),tt=Math.ceil(Math.log2(k)),lt=Z-tt,et=[];for(let ut=0;ut<Math.abs(lt);ut++)et.push(lt>0?0:1);for(let ut=0;ut<Math.min(Z,tt);ut++)et.push(0),et.push(1);let ot=w;if(ot=xd(ot,E[0].y-D,E[1].y+D,1),ot=xd(ot,E[0].x-D,E[1].x+D,0),!ot.length)return B;const dt=[];for(et.length?dt.push({polygons:ot,bounds:E,depth:0}):V(ot,E);dt.length;){const ut=dt.pop(),Ct=ut.depth,St=et[Ct],Bt=ut.bounds[0],Ht=ut.bounds[1],Pt=St===0?Bt.x:Bt.y,Vt=St===0?Ht.x:Ht.y,Ut=O?O(St,Pt,Vt):.5*(Pt+Vt),qt=xd(ut.polygons,Pt-D,Ut+D,St),Qt=xd(ut.polygons,Ut-D,Vt+D,St);if(qt.length){const zt=[Bt,new Lt(St===0?Ut:Ht.x,St===1?Ut:Ht.y)];et.length>Ct+1?dt.push({polygons:qt,bounds:zt,depth:Ct+1}):V(qt,zt)}if(Qt.length){const zt=[new Lt(St===0?Ut:Bt.x,St===1?Ut:Bt.y),Ht];et.length>Ct+1?dt.push({polygons:Qt,bounds:zt,depth:Ct+1}):V(Qt,zt)}}return B}(e,t,Math.ceil((f-h)/11.25),Math.ceil((m-x)/11.25),1,(w,E,A)=>{if(w===0)return .5*(E+A);{const k=fn((i.y+E/ye)/l);return(nr(.5*(fn((i.y+A/ye)/l)+k))*l-i.y)*ye}})}he(xh,"FillExtrusionBucket",{omit:["layers","features"]}),he(Tg,"PartMetadata");const Mb=new st({"fill-extrusion-edge-radius":new j(Ot["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Ab={paint:new st({"fill-extrusion-opacity":new j(Ot["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new H(Ot["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new j(Ot["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new j(Ot["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new H(Ot["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new H(Ot["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new H(Ot["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new j(Ot["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new j(Ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new j(Ot["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new j(Ot["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Mb};function kg(e,t,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[e*l-2*Math.PI*6378137/2,t*l-2*Math.PI*6378137/2]}class vd{constructor(t,i,l){this.z=t,this.x=i,this.y=l,this.key=vh(0,t,t,i,l)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,i){const l=function(f,m,x){var w=kg(256*f,256*(m=Math.pow(2,x)-m-1),x),E=kg(256*(f+1),256*(m+1),x);return w[0]+","+w[1]+","+E[0]+","+E[1]}(this.x,this.y,this.z),h=function(f,m,x){let w,E="";for(let A=f;A>0;A--)w=1<<A-1,E+=(m&w?1:0)+(x&w?2:0);return E}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dg{constructor(t,i){this.wrap=t,this.canonical=i,this.key=vh(t,i.z,i.z,i.x,i.y)}}class An{constructor(t,i,l,h,f){this.overscaledZ=t,this.wrap=i,this.canonical=new vd(l,+h,+f),this.key=i===0&&t===l?this.canonical.key:vh(i,t,l,h,f)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new An(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new An(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return vh(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-t;return vh(this.wrap*+i,t,t,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new An(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new An(i,this.wrap,i,l,h),new An(i,this.wrap,i,l+1,h),new An(i,this.wrap,i,l,h+1),new An(i,this.wrap,i,l+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new An(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new An(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dg(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function vh(e,t,i,l,h){const f=1<<Math.min(i,22);let m=f*(h%f)+l%f;return e&&i<22&&(m+=f*f*((e<0?-2*e-1:2*e)%(1<<2*(22-i)))),16*(32*m+i)+(t-i)}he(vd,"CanonicalTileID"),he(An,"OverscaledTileID",{omit:["projMatrix"]});class Ll extends Lt{constructor(t,i,l){super(t,i),this.z=l}}function bh(e,t){return e.x*t.x+e.y*t.y}function Lg(e,t){if(e.length===1){let i=0;const l=t[i++];let h;for(;!h||l.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const f=t[i],m=e[0],x=h.sub(l),w=f.sub(l),E=m.sub(l),A=bh(x,x),k=bh(x,w),D=bh(w,w),O=bh(E,x),B=bh(E,w),V=A*D-k*k,Z=(D*O-k*B)/V,tt=(A*B-k*O)/V,lt=l.z*(1-Z-tt)+h.z*Z+f.z*tt;if(isFinite(lt))return lt}return 1/0}{let i=1/0;for(const l of t)i=Math.min(i,l.z);return i}}function zg(e,t,i,l,h,f,m,x){const w=m*h.getElevationAt(e,t,!0,!0),E=f[0]!==0,A=E?f[1]===0?m*(f[0]/7-450):m*function(k,D,O){const B=Math.floor(D[0]/8),V=Math.floor(D[1]/8),Z=10*(D[0]-8*B),tt=10*(D[1]-8*V),lt=k.getElevationAt(B,V,!0,!0),et=k.getMeterToDEM(O),ot=Math.floor(.5*(Z*et-1)),dt=Math.floor(.5*(tt*et-1)),ut=k.tileCoordToPixel(B,V),Ct=2*ot+1,St=2*dt+1,Bt=function(Qt,zt,re,pe,oe){return[Qt.getElevationAtPixel(zt,re,!0),Qt.getElevationAtPixel(zt+oe,re,!0),Qt.getElevationAtPixel(zt,re+oe,!0),Qt.getElevationAtPixel(zt+pe,re+oe,!0)]}(k,ut.x-ot,ut.y-dt,Ct,St),Ht=Math.abs(Bt[0]-Bt[1]),Pt=Math.abs(Bt[2]-Bt[3]),Vt=Math.abs(Bt[0]-Bt[2])+Math.abs(Bt[1]-Bt[3]),Ut=Math.min(.25,.5*et*(Ht+Pt)/Ct),qt=Math.min(.25,.5*et*Vt/St);return lt+Math.max(Ut*Z,qt*tt)}(h,f,x):w;return{base:w+(i===0)?-1:i,top:E?Math.max(A+l,w+i+2):w+l}}const Cb=xt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Ib}=Cb,Pb=xt([{name:"a_packed",components:4,type:"Float32"}]),{members:kb}=Pb,Db=yd.types,Lb=Math.cos(Math.PI/180*37.5);class bd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new It,this.layoutVertexArray2=new $t,this.indexArray=new _e,this.programConfigurations=new _a(t.layers,t.zoom),this.segments=new Ui,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(t,i,l,h){this.hasPattern=Bf("line",this.layers,i);const f=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:A,id:k,index:D,sourceLayerIndex:O}of t){const B=this.layers[0]._featureFilter.needGeometry,V=ba(A,B);if(!this.layers[0]._featureFilter.filter(new P(this.zoom),V,l))continue;const Z=f?f.evaluate(V,{},l):void 0,tt={id:k,properties:A.properties,type:A.type,sourceLayerIndex:O,index:D,geometry:B?V.geometry:Pr(A,l,h),patterns:{},sortKey:Z};m.push(tt)}f&&m.sort((A,k)=>A.sortKey-k.sortKey);const{lineAtlas:x,featureIndex:w}=i,E=this.addConstantDashes(x);for(const A of m){const{geometry:k,index:D,sourceLayerIndex:O}=A;if(E&&this.addFeatureDashes(A,x),this.hasPattern){const B=Ff("line",this.layers,A,this.zoom,i);this.patternFeatures.push(B)}else this.addFeature(A,k,D,l,x.positions,i.availableImages);w.insert(t[D].feature,k,D,O,this.index)}}addConstantDashes(t){let i=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(h.kind!=="constant"||f.kind!=="constant")i=!0;else{const m=f.value,x=h.value;if(!x)continue;t.addDash(x,m)}}return i}addFeatureDashes(t,i){const l=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let x,w;if(f.kind==="constant"){if(x=f.value,!x)continue}else x=f.evaluate({zoom:l},t);w=m.kind==="constant"?m.value:m.evaluate({zoom:l},t),i.addDash(x,w),t.patterns[h.id]=i.getKey(x,w)}}update(t,i,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,i,this.stateDependentLayers,l,h)}addFeatures(t,i,l,h,f){for(const m of this.patternFeatures)this.addFeature(m,m.geometry,m.index,i,l,h)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,kb)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ib),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,l,h,f,m){const x=this.layers[0].layout,w=x.get("line-join").evaluate(t,{}),E=x.get("line-cap").evaluate(t,{}),A=x.get("line-miter-limit"),k=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const D of i)this.addLine(D,t,w,E,A,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,l,f,m,h)}addLine(t,i,l,h,f,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let tt=0;tt<t.length-1;tt++)this.totalDistance+=t[tt].dist(t[tt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=Db[i.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let E=0;for(;E<w-1&&t[E].equals(t[E+1]);)E++;if(w<(x?3:2))return;l==="bevel"&&(f=1.05);const A=this.overscaling<=16?15*ye/(512*this.overscaling):0,k=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let D,O,B,V,Z;this.e1=this.e2=-1,x&&(D=t[w-2],Z=t[E].sub(D)._unit()._perp());for(let tt=E;tt<w;tt++){if(B=tt===w-1?x?t[E+1]:void 0:t[tt+1],B&&t[tt].equals(B))continue;Z&&(V=Z),D&&(O=D),D=t[tt],Z=B?B.sub(D)._unit()._perp():V,V=V||Z;let lt=V.add(Z);lt.x===0&&lt.y===0||lt._unit();const et=V.x*Z.x+V.y*Z.y,ot=lt.x*Z.x+lt.y*Z.y,dt=ot!==0?1/ot:1/0,ut=2*Math.sqrt(2-2*ot),Ct=ot<Lb&&O&&B,St=V.x*Z.y-V.y*Z.x>0;if(Ct&&tt>E){const Pt=D.dist(O);if(Pt>2*A){const Vt=D.sub(D.sub(O)._mult(A/Pt)._round());this.updateDistance(O,Vt),this.addCurrentVertex(Vt,V,0,0,k),O=Vt}}const Bt=O&&B;let Ht=Bt?l:x?"butt":h;if(Bt&&Ht==="round"&&(dt<m?Ht="miter":dt<=2&&(Ht="fakeround")),Ht==="miter"&&dt>f&&(Ht="bevel"),Ht==="bevel"&&(dt>2&&(Ht="flipbevel"),dt<f&&(Ht="miter")),O&&this.updateDistance(O,D),Ht==="miter")lt._mult(dt),this.addCurrentVertex(D,lt,0,0,k);else if(Ht==="flipbevel"){if(dt>100)lt=Z.mult(-1);else{const Pt=dt*V.add(Z).mag()/V.sub(Z).mag();lt._perp()._mult(Pt*(St?-1:1))}this.addCurrentVertex(D,lt,0,0,k),this.addCurrentVertex(D,lt.mult(-1),0,0,k)}else if(Ht==="bevel"||Ht==="fakeround"){const Pt=-Math.sqrt(dt*dt-1),Vt=St?Pt:0,Ut=St?0:Pt;if(O&&this.addCurrentVertex(D,V,Vt,Ut,k),Ht==="fakeround"){const qt=Math.round(180*ut/Math.PI/20);for(let Qt=1;Qt<qt;Qt++){let zt=Qt/qt;if(zt!==.5){const pe=zt-.5;zt+=zt*pe*(zt-1)*((1.0904+et*(et*(3.55645-1.43519*et)-3.2452))*pe*pe+(.848013+et*(.215638*et-1.06021)))}const re=Z.sub(V)._mult(zt)._add(V)._unit()._mult(St?-1:1);this.addHalfVertex(D,re.x,re.y,!1,St,0,k)}}B&&this.addCurrentVertex(D,Z,-Vt,-Ut,k)}else if(Ht==="butt")this.addCurrentVertex(D,lt,0,0,k);else if(Ht==="square"){const Pt=O?1:-1;O||this.addCurrentVertex(D,lt,Pt,Pt,k),this.addCurrentVertex(D,lt,0,0,k),O&&this.addCurrentVertex(D,lt,Pt,Pt,k)}else Ht==="round"&&(O&&(this.addCurrentVertex(D,V,0,0,k),this.addCurrentVertex(D,V,1,1,k,!0)),B&&(this.addCurrentVertex(D,Z,-1,-1,k,!0),this.addCurrentVertex(D,Z,0,0,k)));if(Ct&&tt<w-1){const Pt=D.dist(B);if(Pt>2*A){const Vt=D.add(B.sub(D)._mult(A/Pt)._round());this.updateDistance(D,Vt),this.addCurrentVertex(Vt,Z,0,0,k),D=Vt}}}}addCurrentVertex(t,i,l,h,f,m=!1){const x=i.y*h-i.x,w=-i.y-i.x*h;this.addHalfVertex(t,i.x+i.y*l,i.y-i.x*l,m,!1,l,f),this.addHalfVertex(t,x,w,m,!0,-h,f)}addHalfVertex({x:t,y:i},l,h,f,m,x,w){this.layoutVertexArray.emplaceBack((t<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),m?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,i){this.distance+=t.dist(i),this.updateScaledDistance()}}he(bd,"LineBucket",{omit:["layers","patternFeatures"]});const zb=new st({"line-cap":new H(Ot.layout_line["line-cap"]),"line-join":new H(Ot.layout_line["line-join"]),"line-miter-limit":new j(Ot.layout_line["line-miter-limit"]),"line-round-limit":new j(Ot.layout_line["line-round-limit"]),"line-sort-key":new H(Ot.layout_line["line-sort-key"])});var Rg={paint:new st({"line-opacity":new H(Ot.paint_line["line-opacity"]),"line-color":new H(Ot.paint_line["line-color"]),"line-translate":new j(Ot.paint_line["line-translate"]),"line-translate-anchor":new j(Ot.paint_line["line-translate-anchor"]),"line-width":new H(Ot.paint_line["line-width"]),"line-gap-width":new H(Ot.paint_line["line-gap-width"]),"line-offset":new H(Ot.paint_line["line-offset"]),"line-blur":new H(Ot.paint_line["line-blur"]),"line-dasharray":new H(Ot.paint_line["line-dasharray"]),"line-pattern":new H(Ot.paint_line["line-pattern"]),"line-gradient":new nt(Ot.paint_line["line-gradient"]),"line-trim-offset":new j(Ot.paint_line["line-trim-offset"])}),layout:zb};const Og=new class extends H{possiblyEvaluate(e,t){return t=new P(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),super.possiblyEvaluate(e,t)}evaluate(e,t,i,l){return t=_i({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,i,l)}}(Rg.paint.properties["line-width"].specification);function Bg(e,t){return t>0?t+2*e:e}Og.useIntegerZoom=!0;const Rb=xt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ob=xt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Bb=xt([{name:"a_projected_pos",components:4,type:"Float32"}],4);xt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Fb=xt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Nb=xt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);xt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Fg=xt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),jb=xt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);xt([{name:"triangle",components:3,type:"Uint16"}]),xt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),xt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),xt([{type:"Float32",name:"offsetX"}]),xt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ln=24;const js=128;function jf(e,t){const{expression:i}=t;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new P(e+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:l,interpolationType:h}=i;let f=0;for(;f<l.length&&l[f]<=e;)f++;f=Math.max(0,f-1);let m=f;for(;m<l.length&&l[m]<e+1;)m++;m=Math.min(l.length-1,m);const x=l[f],w=l[m];return i.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:i.evaluate(new P(x)),maxSize:i.evaluate(new P(w)),interpolationType:h}}}function wd(e,{uSize:t,uSizeT:i},{lowerSize:l,upperSize:h}){return e.kind==="source"?l/js:e.kind==="composite"?Ue(l/js,h/js,i):t}function zl(e,t){let i=0,l=0;if(e.kind==="constant")l=e.layoutSize;else if(e.kind!=="source"){const{interpolationType:h,minZoom:f,maxZoom:m}=e,x=h?be(ps.interpolationFactor(h,t,f,m),0,1):0;e.kind==="camera"?l=Ue(e.minSize,e.maxSize,x):i=x}return{uSizeT:i,uSize:l}}var Vb=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:js,evaluateSizeForFeature:wd,evaluateSizeForZoom:zl,getSizeData:jf});function Ub(e,t,i){return e.sections.forEach(l=>{l.text=function(h,f,m){const x=f.layout.get("text-transform").evaluate(m,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),M.applyArabicShaping&&(h=M.applyArabicShaping(h)),h}(l.text,t,i)}),e}const wh={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function Gb(e){return e==="︶"||e==="﹈"||e==="︸"||e==="﹄"||e==="﹂"||e==="︾"||e==="︼"||e==="︺"||e==="︘"||e==="﹀"||e==="︐"||e==="︓"||e==="︔"||e==="｀"||e==="￣"||e==="︑"||e==="︒"}function qb(e){return e==="︵"||e==="﹇"||e==="︷"||e==="﹃"||e==="﹁"||e==="︽"||e==="︻"||e==="︹"||e==="︗"||e==="︿"}var Ng=hi,jg=function(e,t,i,l,h){var f,m,x=8*h-l-1,w=(1<<x)-1,E=w>>1,A=-7,k=i?h-1:0,D=i?-1:1,O=e[t+k];for(k+=D,f=O&(1<<-A)-1,O>>=-A,A+=x;A>0;f=256*f+e[t+k],k+=D,A-=8);for(m=f&(1<<-A)-1,f>>=-A,A+=l;A>0;m=256*m+e[t+k],k+=D,A-=8);if(f===0)f=1-E;else{if(f===w)return m?NaN:1/0*(O?-1:1);m+=Math.pow(2,l),f-=E}return(O?-1:1)*m*Math.pow(2,f-l)},Vg=function(e,t,i,l,h,f){var m,x,w,E=8*f-h-1,A=(1<<E)-1,k=A>>1,D=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,O=l?0:f-1,B=l?1:-1,V=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(x=isNaN(t)?1:0,m=A):(m=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-m))<1&&(m--,w*=2),(t+=m+k>=1?D/w:D*Math.pow(2,1-k))*w>=2&&(m++,w/=2),m+k>=A?(x=0,m=A):m+k>=1?(x=(t*w-1)*Math.pow(2,h),m+=k):(x=t*Math.pow(2,k-1)*Math.pow(2,h),m=0));h>=8;e[i+O]=255&x,O+=B,x/=256,h-=8);for(m=m<<h|x,E+=h;E>0;e[i+O]=255&m,O+=B,m/=256,E-=8);e[i+O-B]|=128*V};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function hi(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}hi.Varint=0,hi.Fixed64=1,hi.Bytes=2,hi.Fixed32=5;var Vf=4294967296,Ug=1/Vf,Gg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Dr(e){return e.type===hi.Bytes?e.readVarint()+e.pos:e.pos+1}function Rl(e,t,i){return i?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function qg(e,t,i){var l=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(l);for(var h=i.pos-1;h>=e;h--)i.buf[h+l]=i.buf[h]}function $b(e,t){for(var i=0;i<e.length;i++)t.writeVarint(e[i])}function Wb(e,t){for(var i=0;i<e.length;i++)t.writeSVarint(e[i])}function Zb(e,t){for(var i=0;i<e.length;i++)t.writeFloat(e[i])}function Hb(e,t){for(var i=0;i<e.length;i++)t.writeDouble(e[i])}function Xb(e,t){for(var i=0;i<e.length;i++)t.writeBoolean(e[i])}function Yb(e,t){for(var i=0;i<e.length;i++)t.writeFixed32(e[i])}function Kb(e,t){for(var i=0;i<e.length;i++)t.writeSFixed32(e[i])}function Jb(e,t){for(var i=0;i<e.length;i++)t.writeFixed64(e[i])}function Qb(e,t){for(var i=0;i<e.length;i++)t.writeSFixed64(e[i])}function Td(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function Ol(e,t,i){e[i]=t,e[i+1]=t>>>8,e[i+2]=t>>>16,e[i+3]=t>>>24}function $g(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}hi.prototype={destroy:function(){this.buf=null},readFields:function(e,t,i){for(i=i||this.length;this.pos<i;){var l=this.readVarint(),h=l>>3,f=this.pos;this.type=7&l,e(h,t,this),this.pos===f&&this.skip(l)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Td(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=$g(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Td(this.buf,this.pos)+Td(this.buf,this.pos+4)*Vf;return this.pos+=8,e},readSFixed64:function(){var e=Td(this.buf,this.pos)+$g(this.buf,this.pos+4)*Vf;return this.pos+=8,e},readFloat:function(){var e=jg(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=jg(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,i,l=this.buf;return t=127&(i=l[this.pos++]),i<128?t:(t|=(127&(i=l[this.pos++]))<<7,i<128?t:(t|=(127&(i=l[this.pos++]))<<14,i<128?t:(t|=(127&(i=l[this.pos++]))<<21,i<128?t:function(h,f,m){var x,w,E=m.buf;if(x=(112&(w=E[m.pos++]))>>4,w<128||(x|=(127&(w=E[m.pos++]))<<3,w<128)||(x|=(127&(w=E[m.pos++]))<<10,w<128)||(x|=(127&(w=E[m.pos++]))<<17,w<128)||(x|=(127&(w=E[m.pos++]))<<24,w<128)||(x|=(1&(w=E[m.pos++]))<<31,w<128))return Rl(h,x,f);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(i=l[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Gg?function(i,l,h){return Gg.decode(i.subarray(l,h))}(this.buf,t,e):function(i,l,h){for(var f="",m=l;m<h;){var x,w,E,A=i[m],k=null,D=A>239?4:A>223?3:A>191?2:1;if(m+D>h)break;D===1?A<128&&(k=A):D===2?(192&(x=i[m+1]))==128&&(k=(31&A)<<6|63&x)<=127&&(k=null):D===3?(w=i[m+2],(192&(x=i[m+1]))==128&&(192&w)==128&&((k=(15&A)<<12|(63&x)<<6|63&w)<=2047||k>=55296&&k<=57343)&&(k=null)):D===4&&(w=i[m+2],E=i[m+3],(192&(x=i[m+1]))==128&&(192&w)==128&&(192&E)==128&&((k=(15&A)<<18|(63&x)<<12|(63&w)<<6|63&E)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,D=1):k>65535&&(k-=65536,f+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),f+=String.fromCharCode(k),m+=D}return f}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==hi.Bytes)return e.push(this.readVarint(t));var i=Dr(this);for(e=e||[];this.pos<i;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==hi.Bytes)return e.push(this.readSVarint());var t=Dr(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==hi.Bytes)return e.push(this.readBoolean());var t=Dr(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==hi.Bytes)return e.push(this.readFloat());var t=Dr(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==hi.Bytes)return e.push(this.readDouble());var t=Dr(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==hi.Bytes)return e.push(this.readFixed32());var t=Dr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==hi.Bytes)return e.push(this.readSFixed32());var t=Dr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==hi.Bytes)return e.push(this.readFixed64());var t=Dr(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==hi.Bytes)return e.push(this.readSFixed64());var t=Dr(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===hi.Varint)for(;this.buf[this.pos++]>127;);else if(t===hi.Bytes)this.pos=this.readVarint()+this.pos;else if(t===hi.Fixed32)this.pos+=4;else{if(t!==hi.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),Ol(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),Ol(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),Ol(this.buf,-1&e,this.pos),Ol(this.buf,Math.floor(e*Ug),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),Ol(this.buf,-1&e,this.pos),Ol(this.buf,Math.floor(e*Ug),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,i){var l,h;if(t>=0?(l=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(l=~(-t%4294967296))?l=l+1|0:(l=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(f,m,x){x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,f>>>=7,x.buf[x.pos++]=127&f|128,x.buf[x.pos]=127&(f>>>=7)}(l,0,i),function(f,m){var x=(7&f)<<4;m.buf[m.pos++]|=x|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(h,i)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(!!e)},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(l,h,f){for(var m,x,w=0;w<h.length;w++){if((m=h.charCodeAt(w))>55295&&m<57344){if(!x){m>56319||w+1===h.length?(l[f++]=239,l[f++]=191,l[f++]=189):x=m;continue}if(m<56320){l[f++]=239,l[f++]=191,l[f++]=189,x=m;continue}m=x-55296<<10|m-56320|65536,x=null}else x&&(l[f++]=239,l[f++]=191,l[f++]=189,x=null);m<128?l[f++]=m:(m<2048?l[f++]=m>>6|192:(m<65536?l[f++]=m>>12|224:(l[f++]=m>>18|240,l[f++]=m>>12&63|128),l[f++]=m>>6&63|128),l[f++]=63&m|128)}return f}(this.buf,e,this.pos);var i=this.pos-t;i>=128&&qg(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i},writeFloat:function(e){this.realloc(4),Vg(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Vg(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var i=0;i<t;i++)this.buf[this.pos++]=e[i]},writeRawMessage:function(e,t){this.pos++;var i=this.pos;e(t,this);var l=this.pos-i;l>=128&&qg(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeMessage:function(e,t,i){this.writeTag(e,hi.Bytes),this.writeRawMessage(t,i)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,$b,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Wb,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Xb,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Zb,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Hb,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Yb,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Kb,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Jb,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Qb,t)},writeBytesField:function(e,t){this.writeTag(e,hi.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,hi.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,hi.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,hi.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,hi.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,hi.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,hi.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,hi.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,hi.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,hi.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,!!t)}};var Ed=Ft(Ng);const Uf=3;function tw(e,t,i){t.glyphs=[],e===1&&i.readMessage(ew,t)}function ew(e,t,i){if(e===3){const{id:l,bitmap:h,width:f,height:m,left:x,top:w,advance:E}=i.readMessage(iw,{});t.glyphs.push({id:l,bitmap:new kr({width:f+2*Uf,height:m+2*Uf},h),metrics:{width:f,height:m,left:x,top:w,advance:E}})}else e===4?t.ascender=i.readSVarint():e===5&&(t.descender=i.readSVarint())}function iw(e,t,i){e===1?t.id=i.readVarint():e===2?t.bitmap=i.readBytes():e===3?t.width=i.readVarint():e===4?t.height=i.readVarint():e===5?t.left=i.readSVarint():e===6?t.top=i.readSVarint():e===7&&(t.advance=i.readVarint())}const Wg=Uf;function Gf(e){let t=0,i=0;for(const m of e)t+=m.w*m.h,i=Math.max(i,m.w);e.sort((m,x)=>x.h-m.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,f=0;for(const m of e)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(m.w>w.w||m.h>w.h)){if(m.x=w.x,m.y=w.y,f=Math.max(f,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===w.w&&m.h===w.h){const E=l.pop();x<l.length&&(l[x]=E)}else m.h===w.h?(w.x+=m.w,w.w-=m.w):m.w===w.w?(w.y+=m.h,w.h-=m.h):(l.push({x:w.x+m.w,y:w.y,w:w.w-m.w,h:m.h}),w.y+=m.h,w.h-=m.h);break}}return{w:h,h:f,fill:t/(h*f)||0}}const Fn=1;class qf{constructor(t,{pixelRatio:i,version:l,stretchX:h,stretchY:f,content:m}){this.paddedRect=t,this.pixelRatio=i,this.stretchX=h,this.stretchY=f,this.content=m,this.version=l}get tl(){return[this.paddedRect.x+Fn,this.paddedRect.y+Fn]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fn,this.paddedRect.y+this.paddedRect.h-Fn]}get displaySize(){return[(this.paddedRect.w-2*Fn)/this.pixelRatio,(this.paddedRect.h-2*Fn)/this.pixelRatio]}}class Zg{constructor(t,i){const l={},h={};this.haveRenderCallbacks=[];const f=[];this.addImages(t,l,f),this.addImages(i,h,f);const{w:m,h:x}=Gf(f),w=new Hn({width:m||1,height:x||1});for(const E in t){const A=t[E],k=l[E].paddedRect;Hn.copy(A.data,w,{x:0,y:0},{x:k.x+Fn,y:k.y+Fn},A.data)}for(const E in i){const A=i[E],k=h[E].paddedRect,D=k.x+Fn,O=k.y+Fn,B=A.data.width,V=A.data.height;Hn.copy(A.data,w,{x:0,y:0},{x:D,y:O},A.data),Hn.copy(A.data,w,{x:0,y:V-1},{x:D,y:O-1},{width:B,height:1}),Hn.copy(A.data,w,{x:0,y:0},{x:D,y:O+V},{width:B,height:1}),Hn.copy(A.data,w,{x:B-1,y:0},{x:D-1,y:O},{width:1,height:V}),Hn.copy(A.data,w,{x:0,y:0},{x:D+B,y:O},{width:1,height:V})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(t,i,l){for(const h in t){const f=t[h],m={x:0,y:0,w:f.data.width+2*Fn,h:f.data.height+2*Fn};l.push(m),i[h]=new qf(m,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>t.hasImage(l)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in t.updatedImages)this.patchUpdatedImage(this.iconPositions[l],t.getImage(l),i),this.patchUpdatedImage(this.patternPositions[l],t.getImage(l),i)}patchUpdatedImage(t,i,l){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,f]=t.tl;l.update(i.data,void 0,{x:h,y:f})}}he(qf,"ImagePosition"),he(Zg,"ImageAtlas");const rs={horizontal:1,vertical:2,horizontalOnly:3},Hg=-17;class Th{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,i){const l=new Th;return l.scale=t||1,l.fontStack=i,l}static forImage(t){const i=new Th;return i.imageName=t,i}}class Bl{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i){const l=new Bl;for(let h=0;h<t.sections.length;h++){const f=t.sections[h];f.image?l.addImageSection(f):l.addTextSection(f,i)}return l}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(i,l){let h="";for(let f=0;f<i.length;f++){const m=i.charCodeAt(f+1)||null,x=i.charCodeAt(f-1)||null;h+=!l&&(m&&Qu(m)&&!wh[i[f+1]]||x&&Qu(x)&&!wh[i[f-1]])||!wh[i[f]]?i[f]:wh[i[f]]}return h}(this.text,t)}trim(){let t=0;for(let l=0;l<this.text.length&&Sd[this.text.charCodeAt(l)];l++)t++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=t&&Sd[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const l=new Bl;return l.text=this.text.substring(t,i),l.sectionIndex=this.sectionIndex.slice(t,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(Th.forText(t.scale,t.fontStack||i));const l=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(l)}addImageSection(t){const i=t.image?t.image.name:"";if(i.length===0)return void Ei("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Th.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Ei("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $f(e,t,i,l,h,f,m,x,w,E,A,k,D,O,B){const V=Bl.fromFeature(e,h);k===rs.vertical&&V.verticalizePunctuation(D);let Z=[];const tt=function(ut,Ct,St,Bt,Ht,Pt){if(!ut)return[];const Vt=[],Ut=function(re,pe,oe,Te,te,ge){let Ee=0;for(let $e=0;$e<re.length();$e++){const Se=re.getSection($e);Ee+=Xg(re.getCharCode($e),Se,Te,te,pe,ge)}return Ee/Math.max(1,Math.ceil(Ee/oe))}(ut,Ct,St,Bt,Ht,Pt),qt=ut.text.indexOf("​")>=0;let Qt=0;for(let re=0;re<ut.length();re++){const pe=ut.getSection(re),oe=ut.getCharCode(re);if(Sd[oe]||(Qt+=Xg(oe,pe,Bt,Ht,Ct,Pt)),re<ut.length()-1){const Te=!((zt=oe)<11904||!(ae["Bopomofo Extended"](zt)||ae.Bopomofo(zt)||ae["CJK Compatibility Forms"](zt)||ae["CJK Compatibility Ideographs"](zt)||ae["CJK Compatibility"](zt)||ae["CJK Radicals Supplement"](zt)||ae["CJK Strokes"](zt)||ae["CJK Symbols and Punctuation"](zt)||ae["CJK Unified Ideographs Extension A"](zt)||ae["CJK Unified Ideographs"](zt)||ae["Enclosed CJK Letters and Months"](zt)||ae["Halfwidth and Fullwidth Forms"](zt)||ae.Hiragana(zt)||ae["Ideographic Description Characters"](zt)||ae["Kangxi Radicals"](zt)||ae["Katakana Phonetic Extensions"](zt)||ae.Katakana(zt)||ae["Vertical Forms"](zt)||ae["Yi Radicals"](zt)||ae["Yi Syllables"](zt)));(nw[oe]||Te||pe.imageName)&&Vt.push(Kg(re+1,Qt,Ut,Vt,sw(oe,ut.getCharCode(re+1),Te&&qt),!1))}}var zt;return Jg(Kg(ut.length(),Qt,Ut,Vt,0,!0))}(V,E,f,t,l,O),{processBidirectionalText:lt,processStyledBidirectionalText:et}=M;if(lt&&V.sections.length===1){const ut=lt(V.toString(),tt);for(const Ct of ut){const St=new Bl;St.text=Ct,St.sections=V.sections;for(let Bt=0;Bt<Ct.length;Bt++)St.sectionIndex.push(0);Z.push(St)}}else if(et){const ut=et(V.text,V.sectionIndex,tt);for(const Ct of ut){const St=new Bl;St.text=Ct[0],St.sectionIndex=Ct[1],St.sections=V.sections,Z.push(St)}}else Z=function(ut,Ct){const St=[],Bt=ut.text;let Ht=0;for(const Pt of Ct)St.push(ut.substring(Ht,Pt)),Ht=Pt;return Ht<Bt.length&&St.push(ut.substring(Ht,Bt.length)),St}(V,tt);const ot=[],dt={positionedLines:ot,text:V.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:k,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ut,Ct,St,Bt,Ht,Pt,Vt,Ut,qt,Qt,zt,re){let pe=0,oe=0,Te=0;const te=Ut==="right"?1:Ut==="left"?0:.5;let ge=!1;for(const Ce of Ht){const Ie=Ce.getSections();for(const ai of Ie){if(ai.imageName)continue;const ui=Ct[ai.fontStack];if(ui&&(ge=ui.ascender!==void 0&&ui.descender!==void 0,!ge))break}if(!ge)break}let Ee=0;for(const Ce of Ht){Ce.trim();const Ie=Ce.getMaxScale(),ai=(Ie-1)*ln,ui={positionedGlyphs:[],lineOffset:0};ut.positionedLines[Ee]=ui;const di=ui.positionedGlyphs;let li=0;if(!Ce.length()){oe+=Pt,++Ee;continue}let Mi=0,Li=0;for(let ci=0;ci<Ce.length();ci++){const Xi=Ce.getSection(ci),$i=Ce.getSectionIndex(ci),Ai=Ce.getCharCode(ci);let Ze=Xi.scale,Wi=null,pi=null,Cn=null,Zi=ln,cn=0;const sn=!(qt===rs.horizontal||!zt&&!Yc(Ai)||zt&&(Sd[Ai]||($e=Ai,ae.Arabic($e)||ae["Arabic Supplement"]($e)||ae["Arabic Extended-A"]($e)||ae["Arabic Presentation Forms-A"]($e)||ae["Arabic Presentation Forms-B"]($e))));if(Xi.imageName){const In=Bt[Xi.imageName];if(!In)continue;Cn=Xi.imageName,ut.iconsInText=ut.iconsInText||!0,pi=In.paddedRect;const rn=In.displaySize;Ze=Ze*ln/re,Wi={width:rn[0],height:rn[1],left:Fn,top:-Wg,advance:sn?rn[1]:rn[0],localGlyph:!1},cn=ge?-Wi.height*Ze:Hg+Ie*ln-rn[1]*Ze,Zi=Wi.advance;const Gs=(sn?rn[0]:rn[1])*Ze-ln*Ie;Gs>0&&Gs>li&&(li=Gs)}else{const In=St[Xi.fontStack];if(!In)continue;In[Ai]&&(pi=In[Ai]);const rn=Ct[Xi.fontStack];if(!rn)continue;const Gs=rn.glyphs[Ai];if(!Gs)continue;if(Wi=Gs.metrics,Zi=Ai!==8203?ln:0,ge){const ql=rn.ascender!==void 0?Math.abs(rn.ascender):0,Lh=rn.descender!==void 0?Math.abs(rn.descender):0,zh=(ql+Lh)*Ze;Mi<zh&&(Mi=zh,Li=(ql-Lh)/2*Ze),cn=-ql*Ze}else cn=Hg+(Ie-Ze)*ln}sn?(ut.verticalizable=!0,di.push({glyph:Ai,imageName:Cn,x:pe,y:oe+cn,vertical:sn,scale:Ze,localGlyph:Wi.localGlyph,fontStack:Xi.fontStack,sectionIndex:$i,metrics:Wi,rect:pi}),pe+=Zi*Ze+Qt):(di.push({glyph:Ai,imageName:Cn,x:pe,y:oe+cn,vertical:sn,scale:Ze,localGlyph:Wi.localGlyph,fontStack:Xi.fontStack,sectionIndex:$i,metrics:Wi,rect:pi}),pe+=Wi.advance*Ze+Qt)}di.length!==0&&(Te=Math.max(pe-Qt,Te),ge?Qg(di,te,li,Li,Pt*Ie/2):Qg(di,te,li,0,Pt/2)),pe=0;const qi=Pt*Ie+li;ui.lineOffset=Math.max(li,ai),oe+=qi,++Ee}var $e;const Se=oe,{horizontalAlign:ve,verticalAlign:fi}=Wf(Vt);(function(Ce,Ie,ai,ui,di,li){const Mi=(Ie-ai)*di,Li=-li*ui;for(const qi of Ce)for(const ci of qi.positionedGlyphs)ci.x+=Mi,ci.y+=Li})(ut.positionedLines,te,ve,fi,Te,Se),ut.top+=-fi*Se,ut.bottom=ut.top+Se,ut.left+=-ve*Te,ut.right=ut.left+Te,ut.hasBaseline=ge}(dt,t,i,l,Z,m,x,w,k,E,D,B),!function(ut){for(const Ct of ut)if(Ct.positionedGlyphs.length!==0)return!1;return!0}(ot)&&dt}const Sd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},nw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Xg(e,t,i,l,h,f){if(t.imageName){const m=l[t.imageName];return m?m.displaySize[0]*t.scale*ln/f+h:0}{const m=i[t.fontStack],x=m&&m.glyphs[e];return x?x.metrics.advance*t.scale+h:0}}function Yg(e,t,i,l){const h=Math.pow(e-t,2);return l?e<t?h/2:2*h:h+Math.abs(i)*i}function sw(e,t,i){let l=0;return e===10&&(l-=1e4),i&&(l+=150),e!==40&&e!==65288||(l+=50),t!==41&&t!==65289||(l+=50),l}function Kg(e,t,i,l,h,f){let m=null,x=Yg(t,i,h,f);for(const w of l){const E=Yg(t-w.x,i,h,f)+w.badness;E<=x&&(m=w,x=E)}return{index:e,x:t,priorBreak:m,badness:x}}function Jg(e){return e?Jg(e.priorBreak).concat(e.index):[]}function Wf(e){let t=.5,i=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function Qg(e,t,i,l,h){if(!(t||i||l||h))return;const f=e.length-1,m=e[f],x=(m.x+m.metrics.advance*m.scale)*t;for(let w=0;w<=f;w++)e[w].x-=x,e[w].y+=i+l+h}function rw(e,t,i){const{horizontalAlign:l,verticalAlign:h}=Wf(i),f=t[0]-e.displaySize[0]*l,m=t[1]-e.displaySize[1]*h;return{image:e,top:m,bottom:m+e.displaySize[1],left:f,right:f+e.displaySize[0]}}function t0(e,t,i,l,h,f){const m=e.image;let x;if(m.content){const Z=m.content,tt=m.pixelRatio||1;x=[Z[0]/tt,Z[1]/tt,m.displaySize[0]-Z[2]/tt,m.displaySize[1]-Z[3]/tt]}const w=t.left*f,E=t.right*f;let A,k,D,O;i==="width"||i==="both"?(O=h[0]+w-l[3],k=h[0]+E+l[1]):(O=h[0]+(w+E-m.displaySize[0])/2,k=O+m.displaySize[0]);const B=t.top*f,V=t.bottom*f;return i==="height"||i==="both"?(A=h[1]+B-l[0],D=h[1]+V+l[2]):(A=h[1]+(B+V-m.displaySize[1])/2,D=A+m.displaySize[1]),{image:m,top:A,right:k,bottom:D,left:O,collisionPadding:x}}class Lr extends Lt{constructor(t,i,l,h,f){super(t,i),this.angle=h,this.z=l,f!==void 0&&(this.segment=f)}clone(){return new Lr(this.x,this.y,this.z,this.angle,this.segment)}}function e0(e,t,i,l,h){if(t.segment===void 0)return!0;let f=t,m=t.segment+1,x=0;for(;x>-i/2;){if(m--,m<0)return!1;x-=e[m].dist(f),f=e[m]}x+=e[m].dist(e[m+1]),m++;const w=[];let E=0;for(;x<i/2;){const A=e[m],k=e[m+1];if(!k)return!1;let D=e[m-1].angleTo(A)-A.angleTo(k);for(D=Math.abs((D+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:D}),E+=D;x-w[0].distance>l;)E-=w.shift().angleDelta;if(E>h)return!1;m++,x+=A.dist(k)}return!0}function i0(e){let t=0;for(let i=0;i<e.length-1;i++)t+=e[i].dist(e[i+1]);return t}function n0(e,t,i){return e?.6*t*i:0}function s0(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ow(e,t,i,l,h,f){const m=n0(i,h,f),x=s0(i,l)*f;let w=0;const E=i0(e)/2;for(let A=0;A<e.length-1;A++){const k=e[A],D=e[A+1],O=k.dist(D);if(w+O>E){const B=(E-w)/O,V=Ue(k.x,D.x,B),Z=Ue(k.y,D.y,B),tt=new Lr(V,Z,0,D.angleTo(k),A);return!m||e0(e,tt,x,m,t)?tt:void 0}w+=O}}function aw(e,t,i,l,h,f,m,x,w){const E=n0(l,f,m),A=s0(l,h),k=A*m,D=e[0].x===0||e[0].x===w||e[0].y===0||e[0].y===w;return t-k<t/4&&(t=k+t/4),r0(e,D?t/2*x%t:(A/2+2*f)*m*x%t,t,E,i,k,D,!1,w)}function r0(e,t,i,l,h,f,m,x,w){const E=f/2,A=i0(e);let k=0,D=t-i,O=[];for(let B=0;B<e.length-1;B++){const V=e[B],Z=e[B+1],tt=V.dist(Z),lt=Z.angleTo(V);for(;D+i<k+tt;){D+=i;const et=(D-k)/tt,ot=Ue(V.x,Z.x,et),dt=Ue(V.y,Z.y,et);if(ot>=0&&ot<w&&dt>=0&&dt<w&&D-E>=0&&D+E<=A){const ut=new Lr(ot,dt,0,lt,B);ut._round(),l&&!e0(e,ut,f,l,h)||O.push(ut)}}k+=tt}return x||O.length||m||(O=r0(e,k/2,i,l,h,f,m,!0,w)),O}function o0(e,t,i,l,h){const f=[];for(let m=0;m<e.length;m++){const x=e[m];let w;for(let E=0;E<x.length-1;E++){let A=x[E],k=x[E+1];A.x<t&&k.x<t||(A.x<t?A=new Lt(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x<t&&(k=new Lt(t,A.y+(t-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y<i&&k.y<i||(A.y<i?A=new Lt(A.x+(i-A.y)/(k.y-A.y)*(k.x-A.x),i)._round():k.y<i&&(k=new Lt(A.x+(i-A.y)/(k.y-A.y)*(k.x-A.x),i)._round()),A.x>=l&&k.x>=l||(A.x>=l?A=new Lt(l,A.y+(l-A.x)/(k.x-A.x)*(k.y-A.y))._round():k.x>=l&&(k=new Lt(l,A.y+(l-A.x)/(k.x-A.x)*(k.y-A.y))._round()),A.y>=h&&k.y>=h||(A.y>=h?A=new Lt(A.x+(h-A.y)/(k.y-A.y)*(k.x-A.x),h)._round():k.y>=h&&(k=new Lt(A.x+(h-A.y)/(k.y-A.y)*(k.x-A.x),h)._round()),w&&A.equals(w[w.length-1])||(w=[A],f.push(w)),w.push(k)))))}}return f}he(Lr,"Anchor");const Eh=1e20;function a0(e,t,i,l,h,f,m,x,w){for(let E=t;E<t+l;E++)l0(e,i*f+E,f,h,m,x,w);for(let E=i;E<i+h;E++)l0(e,E*f+t,1,l,m,x,w)}function l0(e,t,i,l,h,f,m){f[0]=0,m[0]=-Eh,m[1]=Eh,h[0]=e[t];for(let x=1,w=0,E=0;x<l;x++){h[x]=e[t+x*i];const A=x*x;do{const k=f[w];E=(h[x]-h[k]+A-k*k)/(x-k)/2}while(E<=m[w]&&--w>-1);w++,f[w]=x,m[w]=E,m[w+1]=Eh}for(let x=0,w=0;x<l;x++){for(;m[w+1]<x;)w++;const E=f[w],A=x-E;e[t+x*i]=h[E]+A*A}}const Vs=2,Zf={none:0,ideographs:1,all:2};class Fl{constructor(t,i,l){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,i){const l=[];for(const h in t)for(const f of t[h])l.push({stack:h,id:f});ki(l,({stack:h,id:f},m)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[f];if(w!==void 0)return void m(null,{stack:h,id:f,glyph:w});if(w=this._tinySDF(x,h,f),w)return x.glyphs[f]=w,void m(null,{stack:h,id:f,glyph:w});const E=Math.floor(f/256);if(256*E>65535)return void m(new Error("glyphs > 65535 not supported"));if(x.ranges[E])return void m(null,{stack:h,id:f,glyph:w});let A=x.requests[E];A||(A=x.requests[E]=[],Fl.loadGlyphRange(h,E,this.url,this.requestManager,(k,D)=>{if(D){x.ascender=D.ascender,x.descender=D.descender;for(const O in D.glyphs)this._doesCharSupportLocalGlyph(+O)||(x.glyphs[+O]=D.glyphs[+O]);x.ranges[E]=!0}for(const O of A)O(k,D);delete x.requests[E]})),A.push((k,D)=>{k?m(k):D&&m(null,{stack:h,id:f,glyph:D.glyphs[f]||null})})},(h,f)=>{if(h)i(h);else if(f){const m={};for(const{stack:x,id:w,glyph:E}of f)m[x]===void 0&&(m[x]={}),m[x].glyphs===void 0&&(m[x].glyphs={}),m[x].glyphs[w]=E&&{id:E.id,bitmap:E.bitmap.clone(),metrics:E.metrics},m[x].ascender=this.entries[x].ascender,m[x].descender=this.entries[x].descender;i(null,m)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Zf.none&&(this.localGlyphMode===Zf.all?!!this.localFontFamily:!!this.localFontFamily&&(ae["CJK Unified Ideographs"](t)||ae["Hangul Syllables"](t)||ae.Hiragana(t)||ae.Katakana(t)||ae["CJK Symbols and Punctuation"](t)))}_tinySDF(t,i,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let f=t.tinySDF;if(!f){let V="400";/bold/i.test(i)?V="900":/medium/i.test(i)?V="500":/light/i.test(i)&&(V="200"),f=t.tinySDF=new Fl.TinySDF({fontFamily:h,fontWeight:V,fontSize:24*Vs,buffer:3*Vs,radius:8*Vs}),f.fontWeight=V}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const m=String.fromCharCode(l),{data:x,width:w,height:E,glyphWidth:A,glyphHeight:k,glyphLeft:D,glyphTop:O,glyphAdvance:B}=f.draw(m);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new kr({width:w,height:E},x),metrics:{width:A/Vs,height:k/Vs,left:D/Vs,top:O/Vs-27,advance:B/Vs,localGlyph:!0}}}}Fl.loadGlyphRange=function(e,t,i,l,h){const f=256*t,m=f+255,x=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",e).replace("{range}",`${f}-${m}`),pr.Glyphs);Wr(x,(w,E)=>{if(w)h(w);else if(E){const A={},k=function(D){return new Ed(D).readFields(tw,{})}(E);for(const D of k.glyphs)A[D.id]=D;h(null,{glyphs:A,ascender:k.ascender,descender:k.descender})}})},Fl.TinySDF=class{constructor({fontSize:e=24,buffer:t=3,radius:i=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:m="normal"}={}){this.buffer=t,this.cutoff=l,this.radius=i;const x=this.size=e+4*t,w=this._createCanvas(x),E=this.ctx=w.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${f} ${e}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(e),m=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),w=Math.min(this.size-this.buffer,m+Math.ceil(l)),E=x+2*this.buffer,A=w+2*this.buffer,k=Math.max(E*A,0),D=new Uint8ClampedArray(k),O={data:D,width:E,height:A,glyphWidth:x,glyphHeight:w,glyphTop:m,glyphLeft:0,glyphAdvance:t};if(x===0||w===0)return O;const{ctx:B,buffer:V,gridInner:Z,gridOuter:tt}=this;B.clearRect(V,V,x,w),B.fillText(e,V,V+m);const lt=B.getImageData(V,V,x,w);tt.fill(Eh,0,k),Z.fill(0,0,k);for(let et=0;et<w;et++)for(let ot=0;ot<x;ot++){const dt=lt.data[4*(et*x+ot)+3]/255;if(dt===0)continue;const ut=(et+V)*E+ot+V;if(dt===1)tt[ut]=0,Z[ut]=Eh;else{const Ct=.5-dt;tt[ut]=Ct>0?Ct*Ct:0,Z[ut]=Ct<0?Ct*Ct:0}}a0(tt,0,0,E,A,E,this.f,this.v,this.z),a0(Z,V,V,x,w,E,this.f,this.v,this.z);for(let et=0;et<k;et++){const ot=Math.sqrt(tt[et])-Math.sqrt(Z[et]);D[et]=Math.round(255-255*(ot/this.radius+this.cutoff))}return O}};const Nl=Fn;function c0(e,t,i,l){const h=[],f=e.image,m=f.pixelRatio,x=f.paddedRect.w-2*Nl,w=f.paddedRect.h-2*Nl,E=e.right-e.left,A=e.bottom-e.top,k=f.stretchX||[[0,x]],D=f.stretchY||[[0,w]],O=(Pt,Vt)=>Pt+Vt[1]-Vt[0],B=k.reduce(O,0),V=D.reduce(O,0),Z=x-B,tt=w-V;let lt=0,et=B,ot=0,dt=V,ut=0,Ct=Z,St=0,Bt=tt;if(f.content&&l){const Pt=f.content;lt=Md(k,0,Pt[0]),ot=Md(D,0,Pt[1]),et=Md(k,Pt[0],Pt[2]),dt=Md(D,Pt[1],Pt[3]),ut=Pt[0]-lt,St=Pt[1]-ot,Ct=Pt[2]-Pt[0]-et,Bt=Pt[3]-Pt[1]-dt}const Ht=(Pt,Vt,Ut,qt)=>{const Qt=Ad(Pt.stretch-lt,et,E,e.left),zt=Cd(Pt.fixed-ut,Ct,Pt.stretch,B),re=Ad(Vt.stretch-ot,dt,A,e.top),pe=Cd(Vt.fixed-St,Bt,Vt.stretch,V),oe=Ad(Ut.stretch-lt,et,E,e.left),Te=Cd(Ut.fixed-ut,Ct,Ut.stretch,B),te=Ad(qt.stretch-ot,dt,A,e.top),ge=Cd(qt.fixed-St,Bt,qt.stretch,V),Ee=new Lt(Qt,re),$e=new Lt(oe,re),Se=new Lt(oe,te),ve=new Lt(Qt,te),fi=new Lt(zt/m,pe/m),Ce=new Lt(Te/m,ge/m),Ie=t*Math.PI/180;if(Ie){const di=Math.sin(Ie),li=Math.cos(Ie),Mi=[li,-di,di,li];Ee._matMult(Mi),$e._matMult(Mi),ve._matMult(Mi),Se._matMult(Mi)}const ai=Pt.stretch+Pt.fixed,ui=Vt.stretch+Vt.fixed;return{tl:Ee,tr:$e,bl:ve,br:Se,tex:{x:f.paddedRect.x+Nl+ai,y:f.paddedRect.y+Nl+ui,w:Ut.stretch+Ut.fixed-ai,h:qt.stretch+qt.fixed-ui},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fi,pixelOffsetBR:Ce,minFontScaleX:Ct/m/E,minFontScaleY:Bt/m/A,isSDF:i}};if(l&&(f.stretchX||f.stretchY)){const Pt=h0(k,Z,B),Vt=h0(D,tt,V);for(let Ut=0;Ut<Pt.length-1;Ut++){const qt=Pt[Ut],Qt=Pt[Ut+1];for(let zt=0;zt<Vt.length-1;zt++)h.push(Ht(qt,Vt[zt],Qt,Vt[zt+1]))}}else h.push(Ht({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function Md(e,t,i){let l=0;for(const h of e)l+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return l}function h0(e,t,i){const l=[{fixed:-Nl,stretch:0}];for(const[h,f]of e){const m=l[l.length-1];l.push({fixed:h-m.stretch,stretch:m.stretch}),l.push({fixed:h-m.stretch,stretch:m.stretch+(f-h)})}return l.push({fixed:t+Nl,stretch:i}),l}function Ad(e,t,i,l){return e/t*i+l}function Cd(e,t,i,l){return e-t*i/l}function lw(e,t,i,l){const h=t+e.positionedLines[l].lineOffset;return l===0?i+h/2:i+(h+(t+e.positionedLines[l-1].lineOffset))/2}class cw{constructor(t=[],i=hw){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:l}=this,h=i[t];for(;t>0;){const f=t-1>>1,m=i[f];if(l(h,m)>=0)break;i[t]=m,t=f}i[t]=h}_down(t){const{data:i,compare:l}=this,h=this.length>>1,f=i[t];for(;t<h;){let m=1+(t<<1),x=i[m];const w=m+1;if(w<this.length&&l(i[w],x)<0&&(m=w,x=i[w]),l(x,f)>=0)break;i[t]=x,t=m}i[t]=f}}function hw(e,t){return e<t?-1:e>t?1:0}function uw(e,t=1,i=!1){let l=1/0,h=1/0,f=-1/0,m=-1/0;const x=e[0];for(let O=0;O<x.length;O++){const B=x[O];(!O||B.x<l)&&(l=B.x),(!O||B.y<h)&&(h=B.y),(!O||B.x>f)&&(f=B.x),(!O||B.y>m)&&(m=B.y)}const w=Math.min(f-l,m-h);let E=w/2;const A=new cw([],dw);if(w===0)return new Lt(l,h);for(let O=l;O<f;O+=w)for(let B=h;B<m;B+=w)A.push(new jl(O+E,B+E,E,e));let k=function(O){let B=0,V=0,Z=0;const tt=O[0];for(let lt=0,et=tt.length,ot=et-1;lt<et;ot=lt++){const dt=tt[lt],ut=tt[ot],Ct=dt.x*ut.y-ut.x*dt.y;V+=(dt.x+ut.x)*Ct,Z+=(dt.y+ut.y)*Ct,B+=3*Ct}return new jl(V/B,Z/B,0,O)}(e),D=A.length;for(;A.length;){const O=A.pop();(O.d>k.d||!k.d)&&(k=O,i&&console.log("found best %d after %d probes",Math.round(1e4*O.d)/1e4,D)),O.max-k.d<=t||(E=O.h/2,A.push(new jl(O.p.x-E,O.p.y-E,E,e)),A.push(new jl(O.p.x+E,O.p.y-E,E,e)),A.push(new jl(O.p.x-E,O.p.y+E,E,e)),A.push(new jl(O.p.x+E,O.p.y+E,E,e)),D+=4)}return i&&(console.log(`num probes: ${D}`),console.log(`best distance: ${k.d}`)),k.p}function dw(e,t){return t.max-e.max}class jl{constructor(t,i,l,h){this.p=new Lt(t,i),this.h=l,this.d=function(f,m){let x=!1,w=1/0;for(let E=0;E<m.length;E++){const A=m[E];for(let k=0,D=A.length,O=D-1;k<D;O=k++){const B=A[k],V=A[O];B.y>f.y!=V.y>f.y&&f.x<(V.x-B.x)*(f.y-B.y)/(V.y-B.y)+B.x&&(x=!x),w=Math.min(w,rg(f,B,V))}}return(x?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Vl=7,Hf=Number.POSITIVE_INFINITY,pw=Math.sqrt(2);function u0(e,[t,i]){let l=0,h=0;if(i===Hf){t<0&&(t=0);const f=t/pw;switch(e){case"top-right":case"top-left":h=f-Vl;break;case"bottom-right":case"bottom-left":h=-f+Vl;break;case"bottom":h=-t+Vl;break;case"top":h=t-Vl}switch(e){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=t;break;case"right":l=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),e){case"top-right":case"top-left":case"top":h=i-Vl;break;case"bottom-right":case"bottom-left":case"bottom":h=-i+Vl}switch(e){case"top-right":case"bottom-right":case"right":l=-t;break;case"top-left":case"bottom-left":case"left":l=t}}return[l,h]}function fw(e,t,i,l,h,f,m,x,w,E){e.createArrays(),e.tilePixelRatio=ye/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const A=e.layers[0].layout,k=e.layers[0]._unevaluatedLayout._values,D={};if(e.textSizeData.kind==="composite"){const{minZoom:V,maxZoom:Z}=e.textSizeData;D.compositeTextSizes=[k["text-size"].possiblyEvaluate(new P(V),x),k["text-size"].possiblyEvaluate(new P(Z),x)]}if(e.iconSizeData.kind==="composite"){const{minZoom:V,maxZoom:Z}=e.iconSizeData;D.compositeIconSizes=[k["icon-size"].possiblyEvaluate(new P(V),x),k["icon-size"].possiblyEvaluate(new P(Z),x)]}D.layoutTextSize=k["text-size"].possiblyEvaluate(new P(w+1),x),D.layoutIconSize=k["icon-size"].possiblyEvaluate(new P(w+1),x),D.textMaxSize=k["text-size"].possiblyEvaluate(new P(18),x);const O=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size");for(const V of e.features){const Z=A.get("text-font").evaluate(V,{},x).join(","),tt=B.evaluate(V,{},x),lt=D.layoutTextSize.evaluate(V,{},x),et=(D.layoutIconSize.evaluate(V,{},x),{horizontal:{},vertical:void 0}),ot=V.text;let dt,ut=[0,0];if(ot){const Bt=ot.toString(),Ht=A.get("text-letter-spacing").evaluate(V,{},x)*ln,Pt=A.get("text-line-height").evaluate(V,{},x)*ln,Vt=nf(Bt)?Ht:0,Ut=A.get("text-anchor").evaluate(V,{},x),qt=A.get("text-variable-anchor");if(!qt){const oe=A.get("text-radial-offset").evaluate(V,{},x);ut=oe?u0(Ut,[oe*ln,Hf]):A.get("text-offset").evaluate(V,{},x).map(Te=>Te*ln)}let Qt=O?"center":A.get("text-justify").evaluate(V,{},x);const zt=A.get("symbol-placement")==="point",re=zt?A.get("text-max-width").evaluate(V,{},x)*ln:1/0,pe=oe=>{e.allowVerticalPlacement&&Xc(Bt)&&(et.vertical=$f(ot,t,i,h,Z,re,Pt,Ut,oe,Vt,ut,rs.vertical,!0,lt,tt))};if(!O&&qt){const oe=Qt==="auto"?qt.map(te=>Xf(te)):[Qt];let Te=!1;for(let te=0;te<oe.length;te++){const ge=oe[te];if(!et.horizontal[ge])if(Te)et.horizontal[ge]=et.horizontal[0];else{const Ee=$f(ot,t,i,h,Z,re,Pt,"center",ge,Vt,ut,rs.horizontal,!1,lt,tt);Ee&&(et.horizontal[ge]=Ee,Te=Ee.positionedLines.length===1)}}pe("left")}else{if(Qt==="auto"&&(Qt=Xf(Ut)),zt||A.get("text-writing-mode").indexOf("horizontal")>=0||!Xc(Bt)){const oe=$f(ot,t,i,h,Z,re,Pt,Ut,Qt,Vt,ut,rs.horizontal,!1,lt,tt);oe&&(et.horizontal[Qt]=oe)}pe(zt?"left":Qt)}}let Ct=!1;if(V.icon&&V.icon.name){const Bt=l[V.icon.name];Bt&&(dt=rw(h[V.icon.name],A.get("icon-offset").evaluate(V,{},x),A.get("icon-anchor").evaluate(V,{},x)),Ct=Bt.sdf,e.sdfIcons===void 0?e.sdfIcons=Bt.sdf:e.sdfIcons!==Bt.sdf&&Ei("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Bt.pixelRatio!==e.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}const St=p0(et.horizontal)||et.vertical;e.iconsInText||(e.iconsInText=!!St&&St.iconsInText),(St||dt)&&_w(e,V,et,dt,l,D,lt,0,ut,Ct,m,x,E)}f&&e.generateCollisionDebugBuffers(w,e.collisionBoxArray)}function Xf(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function _w(e,t,i,l,h,f,m,x,w,E,A,k,D){let O=f.textMaxSize.evaluate(t,{},k);O===void 0&&(O=m);const B=e.layers[0].layout,V=B.get("icon-offset").evaluate(t,{},k),Z=p0(i.horizontal)||i.vertical,tt=D.name==="globe",lt=ln,et=m/lt,ot=e.tilePixelRatio*O/lt,dt=(Ut=e.overscaling,e.zoom>18&&Ut>2&&(Ut>>=1),Math.max(ye/(512*Ut),1)*B.get("symbol-spacing")),ut=B.get("text-padding")*e.tilePixelRatio,Ct=B.get("icon-padding")*e.tilePixelRatio,St=fe(B.get("text-max-angle")),Bt=B.get("text-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Ht=B.get("icon-rotation-alignment")==="map"&&B.get("symbol-placement")!=="point",Pt=B.get("symbol-placement"),Vt=dt/2;var Ut;const qt=B.get("icon-text-fit");let Qt;l&&qt!=="none"&&(e.allowVerticalPlacement&&i.vertical&&(Qt=t0(l,i.vertical,qt,B.get("icon-text-fit-padding"),V,et)),Z&&(l=t0(l,Z,qt,B.get("icon-text-fit-padding"),V,et)));const zt=(re,pe,oe)=>{if(pe.x<0||pe.x>=ye||pe.y<0||pe.y>=ye)return;let Te=null;if(tt){const{x:te,y:ge,z:Ee}=D.projectTilePoint(pe.x,pe.y,oe);Te={anchor:new Lr(te,ge,Ee,0,void 0),up:D.upVector(oe,pe.x,pe.y)}}(function(te,ge,Ee,$e,Se,ve,fi,Ce,Ie,ai,ui,di,li,Mi,Li,qi,ci,Xi,$i,Ai,Ze,Wi,pi,Cn,Zi){const cn=te.addToLineVertexArray(ge,$e);let sn,In,rn,Gs,ql,Lh,zh,W0=0,Z0=0,H0=0,X0=0,h_=-1,u_=-1;const ar={};let Y0=of("");const Ma=Ee?Ee.anchor:ge;let d_=0,p_=0;if(Ie._unevaluatedLayout.getValue("text-radial-offset")===void 0?[d_,p_]=Ie.layout.get("text-offset").evaluate(Ze,{},Zi).map(Xn=>Xn*ln):(d_=Ie.layout.get("text-radial-offset").evaluate(Ze,{},Zi)*ln,p_=Hf),te.allowVerticalPlacement&&Se.vertical){const Xn=Se.vertical;if(Li)Lh=Yf(Xn),Ce&&(zh=Yf(Ce));else{const Yn=Ie.layout.get("text-rotate").evaluate(Ze,{},Zi)+90;rn=Id(ai,Ma,ge,ui,di,li,Xn,Mi,Yn,qi),Ce&&(Gs=Id(ai,Ma,ge,ui,di,li,Ce,Xi,Yn))}}if(ve){const Xn=Ie.layout.get("icon-rotate").evaluate(Ze,{},Zi),Yn=Ie.layout.get("icon-text-fit")!=="none",Rh=c0(ve,Xn,pi,Yn),__=Ce?c0(Ce,Xn,pi,Yn):void 0;In=Id(ai,Ma,ge,ui,di,li,ve,Xi,Xn),W0=4*Rh.length;const K0=te.iconSizeData;let Aa=null;K0.kind==="source"?(Aa=[js*Ie.layout.get("icon-size").evaluate(Ze,{},Zi)],Aa[0]>go&&Ei(`${te.layerIds[0]}: Value for "icon-size" is >= ${Sh}. Reduce your "icon-size".`)):K0.kind==="composite"&&(Aa=[js*Wi.compositeIconSizes[0].evaluate(Ze,{},Zi),js*Wi.compositeIconSizes[1].evaluate(Ze,{},Zi)],(Aa[0]>go||Aa[1]>go)&&Ei(`${te.layerIds[0]}: Value for "icon-size" is >= ${Sh}. Reduce your "icon-size".`)),te.addSymbols(te.icon,Rh,Aa,Ai,$i,Ze,!1,Ee,ge,cn.lineStartIndex,cn.lineLength,-1,Cn,Zi),h_=te.icon.placedSymbolArray.length-1,__&&(Z0=4*__.length,te.addSymbols(te.icon,__,Aa,Ai,$i,Ze,rs.vertical,Ee,ge,cn.lineStartIndex,cn.lineLength,-1,Cn,Zi),u_=te.icon.placedSymbolArray.length-1)}for(const Xn in Se.horizontal){const Yn=Se.horizontal[Xn];sn||(Y0=of(Yn.text),Li?ql=Yf(Yn):sn=Id(ai,Ma,ge,ui,di,li,Yn,Mi,Ie.layout.get("text-rotate").evaluate(Ze,{},Zi),qi));const Rh=Yn.positionedLines.length===1;if(H0+=d0(te,Ee,ge,Yn,fi,Ie,Li,Ze,qi,cn,Se.vertical?rs.horizontal:rs.horizontalOnly,Rh?Object.keys(Se.horizontal):[Xn],ar,h_,Wi,Cn,Zi),Rh)break}Se.vertical&&(X0+=d0(te,Ee,ge,Se.vertical,fi,Ie,Li,Ze,qi,cn,rs.vertical,["vertical"],ar,u_,Wi,Cn,Zi));let To=-1;const f_=(Xn,Yn)=>Xn?Math.max(Xn,Yn):Yn;To=f_(ql,To),To=f_(Lh,To),To=f_(zh,To);const Gw=To>-1?1:0;te.glyphOffsetArray.length>=xo.MAX_GLYPHS&&Ei("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ze.sortKey!==void 0&&te.addToSortKeyRanges(te.symbolInstances.length,Ze.sortKey),te.symbolInstances.emplaceBack(Ma.x,Ma.y,Ma.z,ge.x,ge.y,ar.right>=0?ar.right:-1,ar.center>=0?ar.center:-1,ar.left>=0?ar.left:-1,ar.vertical>=0?ar.vertical:-1,h_,u_,Y0,sn!==void 0?sn:te.collisionBoxArray.length,sn!==void 0?sn+1:te.collisionBoxArray.length,rn!==void 0?rn:te.collisionBoxArray.length,rn!==void 0?rn+1:te.collisionBoxArray.length,In!==void 0?In:te.collisionBoxArray.length,In!==void 0?In+1:te.collisionBoxArray.length,Gs||te.collisionBoxArray.length,Gs?Gs+1:te.collisionBoxArray.length,ui,H0,X0,W0,Z0,Gw,0,d_,p_,To)})(e,pe,Te,re,i,l,h,Qt,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,ut,Bt,w,0,Ct,Ht,V,t,f,E,A,k)};if(Pt==="line")for(const re of o0(t.geometry,0,0,ye,ye)){const pe=aw(re,dt,St,i.vertical||Z,l,lt,ot,e.overscaling,ye);for(const oe of pe)Z&&mw(e,Z.text,Vt,oe)||zt(re,oe,k)}else if(Pt==="line-center"){for(const re of t.geometry)if(re.length>1){const pe=ow(re,St,i.vertical||Z,l,lt,ot);pe&&zt(re,pe,k)}}else if(t.type==="Polygon")for(const re of Of(t.geometry,0)){const pe=uw(re,16);zt(re[0],new Lr(pe.x,pe.y,0,0,void 0),k)}else if(t.type==="LineString")for(const re of t.geometry)zt(re,new Lr(re[0].x,re[0].y,0,0,void 0),k);else if(t.type==="Point")for(const re of t.geometry)for(const pe of re)zt([pe],new Lr(pe.x,pe.y,0,0,void 0),k)}const Sh=255,go=Sh*js;function d0(e,t,i,l,h,f,m,x,w,E,A,k,D,O,B,V,Z){const tt=function(ot,dt,ut,Ct,St,Bt,Ht,Pt){const Vt=[];if(dt.positionedLines.length===0)return Vt;const Ut=Ct.layout.get("text-rotate").evaluate(Bt,{})*Math.PI/180,qt=function(oe){const Te=oe[0],te=oe[1],ge=Te*te;return ge>0?[Te,-te]:ge<0?[-Te,te]:Te===0?[te,Te]:[te,-Te]}(ut);let Qt=Math.abs(dt.top-dt.bottom);for(const oe of dt.positionedLines)Qt-=oe.lineOffset;const zt=dt.positionedLines.length,re=Qt/zt;let pe=dt.top-ut[1];for(let oe=0;oe<zt;++oe){const Te=dt.positionedLines[oe];pe=lw(dt,re,pe,oe);for(const te of Te.positionedGlyphs){if(!te.rect)continue;const ge=te.rect||{};let Ee=Wg+1,$e=!0,Se=1,ve=0;if(te.imageName){const pi=Ht[te.imageName];if(!pi)continue;if(pi.sdf){Ei("SDF images are not supported in formatted text and will be ignored.");continue}$e=!1,Se=pi.pixelRatio,Ee=Fn/Se}const fi=(St||Pt)&&te.vertical,Ce=te.metrics.advance*te.scale/2,Ie=te.metrics,ai=te.rect;if(ai===null)continue;Pt&&dt.verticalizable&&(ve=te.imageName?Ce-te.metrics.width*te.scale/2:0);const ui=St?[te.x+Ce,te.y]:[0,0];let di=[0,0],li=[0,0],Mi=!1;St||(fi?(li=[te.x+Ce+qt[0],te.y+qt[1]-ve],Mi=!0):di=[te.x+Ce+ut[0],te.y+ut[1]-ve]);const Li=ai.w*te.scale/(Se*(te.localGlyph?Vs:1)),qi=ai.h*te.scale/(Se*(te.localGlyph?Vs:1));let ci,Xi,$i,Ai;if(fi){const pi=te.y-pe,Cn=new Lt(-Ce,Ce-pi),Zi=-Math.PI/2,cn=new Lt(...li);ci=new Lt(-Ce+di[0],di[1]),ci._rotateAround(Zi,Cn)._add(cn),ci.x+=-pi+Ce,ci.y-=(Ie.left-Ee)*te.scale;const sn=te.imageName?Ie.advance*te.scale:ln*te.scale,In=String.fromCharCode(te.glyph);Gb(In)?ci.x+=(1-Ee)*te.scale:qb(In)?ci.x+=sn-Ie.height*te.scale+(-Ee-1)*te.scale:ci.x+=te.imageName||Ie.width+2*Ee===ai.w&&Ie.height+2*Ee===ai.h?(sn-qi)/2:(sn-(Ie.height+2*Ee)*te.scale)/2,Xi=new Lt(ci.x,ci.y-Li),$i=new Lt(ci.x+qi,ci.y),Ai=new Lt(ci.x+qi,ci.y-Li)}else{const pi=(Ie.left-Ee)*te.scale-Ce+di[0],Cn=(-Ie.top-Ee)*te.scale+di[1],Zi=pi+Li,cn=Cn+qi;ci=new Lt(pi,Cn),Xi=new Lt(Zi,Cn),$i=new Lt(pi,cn),Ai=new Lt(Zi,cn)}if(Ut){let pi;pi=St?new Lt(0,0):Mi?new Lt(qt[0],qt[1]):new Lt(ut[0],ut[1]),ci._rotateAround(Ut,pi),Xi._rotateAround(Ut,pi),$i._rotateAround(Ut,pi),Ai._rotateAround(Ut,pi)}const Ze=new Lt(0,0),Wi=new Lt(0,0);Vt.push({tl:ci,tr:Xi,bl:$i,br:Ai,tex:ge,writingMode:dt.writingMode,glyphOffset:ui,sectionIndex:te.sectionIndex,isSDF:$e,pixelOffsetTL:Ze,pixelOffsetBR:Wi,minFontScaleX:0,minFontScaleY:0})}}return Vt}(0,l,w,f,m,x,h,e.allowVerticalPlacement),lt=e.textSizeData;let et=null;lt.kind==="source"?(et=[js*f.layout.get("text-size").evaluate(x,{},Z)],et[0]>go&&Ei(`${e.layerIds[0]}: Value for "text-size" is >= ${Sh}. Reduce your "text-size".`)):lt.kind==="composite"&&(et=[js*B.compositeTextSizes[0].evaluate(x,{},Z),js*B.compositeTextSizes[1].evaluate(x,{},Z)],(et[0]>go||et[1]>go)&&Ei(`${e.layerIds[0]}: Value for "text-size" is >= ${Sh}. Reduce your "text-size".`)),e.addSymbols(e.text,tt,et,w,m,x,A,t,i,E.lineStartIndex,E.lineLength,O,V,Z);for(const ot of k)D[ot]=e.text.placedSymbolArray.length-1;return 4*tt.length}function p0(e){for(const t in e)return e[t];return null}function Id(e,t,i,l,h,f,m,x,w,E){let A=m.top,k=m.bottom,D=m.left,O=m.right;const B=m.collisionPadding;if(B&&(D-=B[0],A-=B[1],O+=B[2],k+=B[3]),w){const V=new Lt(D,A),Z=new Lt(O,A),tt=new Lt(D,k),lt=new Lt(O,k),et=fe(w);let ot=new Lt(0,0);E&&(ot=new Lt(E[0],E[1])),V._rotateAround(et,ot),Z._rotateAround(et,ot),tt._rotateAround(et,ot),lt._rotateAround(et,ot),D=Math.min(V.x,Z.x,tt.x,lt.x),O=Math.max(V.x,Z.x,tt.x,lt.x),A=Math.min(V.y,Z.y,tt.y,lt.y),k=Math.max(V.y,Z.y,tt.y,lt.y)}return e.emplaceBack(t.x,t.y,t.z,i.x,i.y,D,A,O,k,x,l,h,f),e.length-1}function Yf(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function mw(e,t,i,l){const h=e.compareText;if(t in h){const f=h[t];for(let m=f.length-1;m>=0;m--)if(l.dist(f[m])<i)return!0}else h[t]=[];return h[t].push(l),!1}function f0(e,t){const i=e.fovAboveCenter,l=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,h=(e._camera.position[2]*e.worldSize-l)/Math.cos(e._pitch),f=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-e._pitch-i,.01)),m=Math.sin(e._pitch)*f+h;return Math.min(1.01*m,h*(1/e._horizonShift))}function Ea(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const i=Math.pow(2,-e.z),l=e.x*i,h=(e.x+1)*i,f=e.y*i,m=(e.y+1)*i,x=ss(l),w=ss(h),E=fn(f),A=fn(m),k=t.project(x,E),D=t.project(w,E),O=t.project(w,A),B=t.project(x,A);let V=Math.min(k.x,D.x,O.x,B.x),Z=Math.min(k.y,D.y,O.y,B.y),tt=Math.max(k.x,D.x,O.x,B.x),lt=Math.max(k.y,D.y,O.y,B.y);const et=i/16;function ot(ut,Ct,St,Bt,Ht,Pt){const Vt=(St+Ht)/2,Ut=(Bt+Pt)/2,qt=t.project(ss(Vt),fn(Ut)),Qt=Math.max(0,V-qt.x,Z-qt.y,qt.x-tt,qt.y-lt);V=Math.min(V,qt.x),tt=Math.max(tt,qt.x),Z=Math.min(Z,qt.y),lt=Math.max(lt,qt.y),Qt>et&&(ot(ut,qt,St,Bt,Vt,Ut),ot(qt,Ct,Vt,Ut,Ht,Pt))}ot(k,D,l,f,h,f),ot(D,O,h,f,h,m),ot(O,B,h,m,l,m),ot(B,k,l,m,l,f),V-=et,Z-=et,tt+=et,lt+=et;const dt=1/Math.max(tt-V,lt-Z);return{scale:dt,x:V*dt,y:Z*dt,x2:tt*dt,y2:lt*dt,projection:t}}const gw=Bs(new Float32Array(16));class yo{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new oi(0,0)}projectTilePoint(t,i,l){return{x:t,y:i,z:0}}locationPoint(t,i,l=!0){return t._coordinatePoint(t.locationCoordinate(i),l)}pixelsPerMeter(t,i){return Ns(1,t)*i}pixelSpaceConversion(t,i,l){return 1}farthestPixelDistance(t){return f0(t,t.pixelsPerMeter)}pointCoordinate(t,i,l,h){const f=t.horizonLineFromTop(!1),m=new Lt(i,Math.max(f,l));return t.rayIntersectionCoordinate(t.pointRayIntersection(m,h))}pointCoordinate3D(t,i,l){const h=new Lt(i,l);if(t.elevation)return t.elevation.pointCoordinate(h);{const f=this.pointCoordinate(t,h.x,h.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(t,i){if(t.elevation)return!this.pointCoordinate3D(t,i.x,i.y);const l=t.horizonLineFromTop();return i.y<l}createInversionMatrix(t,i){return gw}createTileMatrix(t,i,l){let h,f,m;const x=l.canonical,w=Bs(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=Ea(x,this);h=1,f=E.x+l.wrap*E.scale,m=E.y,ga(w,w,[h/E.scale,h/E.scale,t.pixelsPerMeter/i])}else h=i/t.zoomScale(x.z),f=(x.x+Math.pow(2,x.z)*l.wrap)*h,m=x.y*h;return ih(w,w,[f,m,0]),ga(w,w,[h/ye,h/ye,1]),w}upVector(t,i,l){return[0,0,1]}upVectorScale(t,i,l){return{metersToTile:1}}}class yw extends yo{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,l]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(fe(i));this.n=(h+Math.sin(fe(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:l,c:h,r0:f}=this,m=fe(t-this.center[0]),x=fe(i),w=Math.sqrt(h-2*l*Math.sin(x))/l;return{x:w*Math.sin(m*l),y:w*Math.cos(m*l)-f,z:0}}unproject(t,i){const{n:l,c:h,r0:f}=this,m=f+i;let x=Math.atan2(t,Math.abs(m))*Math.sign(m);m*l<0&&(x-=Math.PI*Math.sign(t)*Math.sign(m));const w=fe(this.center[0])*l;x=vi(x,-Math.PI-w,Math.PI-w);const E=be(Ge(x/l)+this.center[0],-180,180),A=Math.asin(be((h-(t*t+m*m)*l*l)/(2*l),-1,1)),k=be(Ge(A),-_n,_n);return new oi(E,k)}}const Mh=1.340264,Ah=-.081106,Ch=893e-6,Ih=.003796,Pd=Math.sqrt(3)/2;class xw extends yo{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const l=Math.asin(Pd*Math.sin(i)),h=l*l,f=h*h*h;return{x:.5*(t*Math.cos(l)/(Pd*(Mh+3*Ah*h+f*(7*Ch+9*Ih*h)))/Math.PI+.5),y:1-.5*(l*(Mh+Ah*h+f*(Ch+Ih*h))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=l*l,f=h*h*h;for(let A,k,D,O=0;O<12&&(k=l*(Mh+Ah*h+f*(Ch+Ih*h))-i,D=Mh+3*Ah*h+f*(7*Ch+9*Ih*h),A=k/D,l=be(l-A,-Math.PI/3,Math.PI/3),h=l*l,f=h*h*h,!(Math.abs(A)<1e-12));++O);const m=Pd*t*(Mh+3*Ah*h+f*(7*Ch+9*Ih*h))/Math.cos(l),x=Math.asin(Math.sin(l)/Pd),w=be(180*m/Math.PI,-180,180),E=be(180*x/Math.PI,-_n,_n);return new oi(w,E)}}class vw extends yo{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const l=360*(t-.5),h=be(360*(.5-i),-_n,_n);return new oi(l,h)}}const Ul=Math.PI/2;function kd(e){return Math.tan((Ul+e)/2)}class bw extends yo{constructor(t){super(t),this.center=t.center||[0,30];const[i,l]=this.parallels=t.parallels||[30,30];let h=fe(i),f=fe(l);this.southernCenter=h+f<0,this.southernCenter&&(h=-h,f=-f);const m=Math.cos(h),x=kd(h);this.n=h===f?Math.sin(h):Math.log(m/Math.cos(f))/Math.log(kd(f)/x),this.f=m*Math.pow(kd(h),this.n)/this.n}project(t,i){i=fe(i),this.southernCenter&&(i=-i),t=fe(t-this.center[0]);const l=1e-6,{n:h,f}=this;f>0?i<-Ul+l&&(i=-Ul+l):i>Ul-l&&(i=Ul-l);const m=f/Math.pow(kd(i),h);let x=m*Math.sin(h*t),w=f-m*Math.cos(h*t);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:h}=this,f=h-i,m=Math.sign(f),x=Math.sign(l)*Math.sqrt(t*t+f*f);let w=Math.atan2(t,Math.abs(f))*m;f*l<0&&(w-=Math.PI*Math.sign(t)*m);const E=be(Ge(w/l)+this.center[0],-180,180),A=be(Ge(2*Math.atan(Math.pow(h/x,1/l))-Ul),-_n,_n);return new oi(E,this.southernCenter?-A:A)}}class _0 extends yo{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:ir(t),y:nr(i),z:0}}unproject(t,i){const l=ss(t),h=fn(i);return new oi(l,h)}}const m0=fe(_n);class ww extends yo{project(t,i){const l=(i=fe(i))*i,h=l*l;return{x:.5*((t=fe(t))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=25,f=0,m=l*l;do{m=l*l;const E=m*m;f=(l*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-i)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),l=be(l-f,-m0,m0)}while(Math.abs(f)>1e-6&&--h>0);m=l*l;const x=be(Ge(t/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),w=Ge(l);return new oi(x,w)}}const g0=fe(_n);class Tw extends yo{project(t,i){i=fe(i),t=fe(t);const l=Math.cos(i),h=2/Math.PI,f=Math.acos(l*Math.cos(t/2)),m=Math.sin(f)/f,x=.5*(t*h+2*l*Math.sin(t/2)/m)||0,w=.5*(i+Math.sin(i)/m)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(t,i){let l=t=(2*t-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,f=25;const m=1e-6;let x=0,w=0;do{const E=Math.cos(h),A=Math.sin(h),k=2*A*E,D=A*A,O=E*E,B=Math.cos(l/2),V=Math.sin(l/2),Z=2*B*V,tt=V*V,lt=1-O*B*B,et=lt?1/lt:0,ot=lt?Math.acos(E*B)*Math.sqrt(1/lt):0,dt=.5*(2*ot*E*V+2*l/Math.PI)-t,ut=.5*(ot*A+h)-i,Ct=.5*et*(O*tt+ot*E*B*D)+1/Math.PI,St=et*(Z*k/4-ot*A*V),Bt=.125*et*(k*V-ot*A*O*Z),Ht=.5*et*(D*B+ot*tt*E)+.5,Pt=St*Bt-Ht*Ct;x=(ut*St-dt*Ht)/Pt,w=(dt*Bt-ut*Ct)/Pt,l=be(l-x,-Math.PI,Math.PI),h=be(h-w,-g0,g0)}while((Math.abs(x)>m||Math.abs(w)>m)&&--f>0);return new oi(Ge(l),Ge(h))}}class y0 extends yo{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(fe(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:l,cosPhi:h}=this;return{x:fe(t)*h*l+.5,y:-Math.sin(fe(i))/h*l+.5,z:0}}unproject(t,i){const{scale:l,cosPhi:h}=this,f=-(i-.5)/l,m=be(Ge((t-.5)/l)/h,-180,180),x=Math.asin(be(f*h,-1,1)),w=be(Ge(x),-_n,_n);return new oi(m,w)}}class Ew extends _0{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,l){const h=hh(t,i,l);return Fi(h,h,uh(er(l))),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,i){const l=Al(i.lat,i.lng),h=Sn([],l),f=t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude;oh(l,l,h,Ns(1,0)*ye*f);const m=Bs(new Float64Array(16));return ma(m,t.pixelMatrix,t.globeMatrix),Fi(l,l,m),new Lt(l[0],l[1])}pixelsPerMeter(t,i){return Ns(1,0)*i}pixelSpaceConversion(t,i,l){const h=Ns(1,t)*i,f=Ue(Ns(1,45)*i,h,l);return this.pixelsPerMeter(t,i)/f}createTileMatrix(t,i,l){const h=vf(er(l.canonical));return ma(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,i){const{center:l}=t,h=uh(er(i));return rd(h,h,fe(l.lng)),hf(h,h,fe(l.lat)),ga(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,i,l,h){return $m(t,i,l,!0)||new Il(0,0)}pointCoordinate3D(t,i,l){const h=this.pointCoordinate(t,i,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,i){return!$m(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(h,f){const m=h.cameraToCenterDistance,x=h._centerAltitude*f,w=h._camera,E=h._camera.forward(),A=Ir([],ns([],E,-m),[0,0,x]),k=h.worldSize/(2*Math.PI),D=[0,0,-k],O=h.width/h.height,B=Math.tan(h.fovAboveCenter),V=ns([],w.up(),B),Z=ns([],w.right(),B*O),tt=Sn([],Ir([],Ir([],E,V),Z)),lt=[];let et;if(new ff(A,tt).closestPointOnSphere(D,k,lt)){const ot=Ir([],lt,D),dt=Fs([],ot,A);et=Math.cos(h.fovAboveCenter)*nh(dt)}else{const ot=Fs([],A,D),dt=Fs([],D,A);Sn(dt,dt);const ut=nh(ot)-k;et=Math.sqrt(ut*(ut+2*k));const Ct=Math.acos(et/(k+ut))-Math.acos(ms(E,dt));et*=Math.cos(Ct)}return 1.01*et}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),l=Cl(t.zoom);if(l>0){const h=f0(t,Ns(1,t.center.lat)*t.worldSize),f=t.worldSize/(2*Math.PI),m=Math.max(t.width,t.height)/t.worldSize*Math.PI;return Ue(i,h+f*(1-Math.cos(m)),Math.pow(l,10))}return i}upVector(t,i,l){return hh(i,l,t,1)}upVectorScale(t){return{metersToTile:od(ld(er(t)))}}}function x0(e){const t=e.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new _0(e);case"equirectangular":return new vw(e);case"naturalEarth":return new ww(e);case"equalEarth":return new xw(e);case"winkelTripel":return new Tw(e);case"albers":return i?new y0(e):new yw(e);case"lambertConformalConic":return i?new y0(e):new bw(e);case"globe":return new Ew(e)}throw new Error(`Invalid projection name: ${e.name}`)}const Sw=yd.types,Mw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Dd(e,t,i,l,h,f,m,x,w,E,A,k,D){const O=x?Math.min(go,Math.round(x[0])):0,B=x?Math.min(go,Math.round(x[1])):0;e.emplaceBack(t,i,Math.round(32*l),Math.round(32*h),f,m,(O<<1)+(w?1:0),B,16*E,16*A,256*k,256*D)}function Ld(e,t,i,l,h,f,m){e.emplaceBack(t,i,l,h,f,m)}function zd(e,t,i,l,h){e.emplaceBack(t,i,l,h),e.emplaceBack(t,i,l,h),e.emplaceBack(t,i,l,h),e.emplaceBack(t,i,l,h)}function Aw(e){for(const t of e.sections)if(rf(t.text))return!0;return!1}class Kf{constructor(t){this.layoutVertexArray=new Gt,this.indexArray=new _e,this.programConfigurations=t,this.segments=new Ui,this.dynamicLayoutVertexArray=new $t,this.opacityVertexArray=new me,this.placedSymbolArray=new Vi,this.globeExtVertexArray=new Yt}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,i,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Rb.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Bb.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Mw,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Ob.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}he(Kf,"SymbolBuffers");class Jf{constructor(t,i,l){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new l,this.segments=new Ui,this.collisionVertexArray=new Be,this.collisionVertexArrayExt=new De}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Fb.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,Nb.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}he(Jf,"CollisionBuffers");class xo{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(m=>m.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bs([]),this.placementViewportMatrix=Bs([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jf(this.zoom,i["text-size"]),this.iconSizeData=jf(this.zoom,i["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(m=>rs[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new Kf(new _a(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Kf(new _a(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new En,this.lineVertexArray=new wl,this.symbolInstances=new mi}calculateGlyphDependencies(t,i,l,h,f){for(let m=0;m<t.length;m++)if(i[t.charCodeAt(m)]=!0,h&&f){const x=wh[t.charAt(m)];x&&(i[x.charCodeAt(0)]=!0)}}populate(t,i,l,h){const f=this.layers[0],m=f.layout,x=this.projection.name==="globe",w=m.get("text-font"),E=m.get("text-field"),A=m.get("icon-image"),k=(E.value.kind!=="constant"||E.value.value instanceof Tn&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),D=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,O=m.get("symbol-sort-key");if(this.features=[],!k&&!D)return;const B=i.iconDependencies,V=i.glyphDependencies,Z=i.availableImages,tt=new P(this.zoom);for(const{feature:lt,id:et,index:ot,sourceLayerIndex:dt}of t){const ut=f._featureFilter.needGeometry,Ct=ba(lt,ut);if(!f._featureFilter.filter(tt,Ct,l))continue;if(ut||(Ct.geometry=Pr(lt,l,h)),x&&lt.type!==1&&l.z<=5){const Pt=Ct.geometry,Vt=.98078528056,Ut=(qt,Qt)=>ms(hh(qt.x,qt.y,l,1),hh(Qt.x,Qt.y,l,1))<Vt;for(let qt=0;qt<Pt.length;qt++)Pt[qt]=Bv(Pt[qt],Ut)}let St,Bt;if(k){const Pt=f.getValueAndResolveTokens("text-field",Ct,l,Z),Vt=Tn.factory(Pt);Aw(Vt)&&(this.hasRTLText=!0),(!this.hasRTLText||b()==="unavailable"||this.hasRTLText&&M.isParsed())&&(St=Ub(Vt,f,Ct))}if(D){const Pt=f.getValueAndResolveTokens("icon-image",Ct,l,Z);Bt=Pt instanceof Gn?Pt:Gn.fromString(Pt)}if(!St&&!Bt)continue;const Ht=this.sortFeaturesByKey?O.evaluate(Ct,{},l):void 0;if(this.features.push({id:et,text:St,icon:Bt,index:ot,sourceLayerIndex:dt,geometry:Ct.geometry,properties:lt.properties,type:Sw[lt.type],sortKey:Ht}),Bt&&(B[Bt.name]=!0),St){const Pt=w.evaluate(Ct,{},l).join(","),Vt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rs.vertical)>=0;for(const Ut of St.sections)if(Ut.image)B[Ut.image.name]=!0;else{const qt=Xc(St.toString()),Qt=Ut.fontStack||Pt,zt=V[Qt]=V[Qt]||{};this.calculateGlyphDependencies(Ut.text,zt,Vt,this.allowVerticalPlacement,qt)}}}m.get("symbol-placement")==="line"&&(this.features=function(lt){const et={},ot={},dt=[];let ut=0;function Ct(Pt){dt.push(lt[Pt]),ut++}function St(Pt,Vt,Ut){const qt=ot[Pt];return delete ot[Pt],ot[Vt]=qt,dt[qt].geometry[0].pop(),dt[qt].geometry[0]=dt[qt].geometry[0].concat(Ut[0]),qt}function Bt(Pt,Vt,Ut){const qt=et[Vt];return delete et[Vt],et[Pt]=qt,dt[qt].geometry[0].shift(),dt[qt].geometry[0]=Ut[0].concat(dt[qt].geometry[0]),qt}function Ht(Pt,Vt,Ut){const qt=Ut?Vt[0][Vt[0].length-1]:Vt[0][0];return`${Pt}:${qt.x}:${qt.y}`}for(let Pt=0;Pt<lt.length;Pt++){const Vt=lt[Pt],Ut=Vt.geometry,qt=Vt.text?Vt.text.toString():null;if(!qt){Ct(Pt);continue}const Qt=Ht(qt,Ut),zt=Ht(qt,Ut,!0);if(Qt in ot&&zt in et&&ot[Qt]!==et[zt]){const re=Bt(Qt,zt,Ut),pe=St(Qt,zt,dt[re].geometry);delete et[Qt],delete ot[zt],ot[Ht(qt,dt[pe].geometry,!0)]=pe,dt[re].geometry=null}else Qt in ot?St(Qt,zt,Ut):zt in et?Bt(Qt,zt,Ut):(Ct(Pt),et[Qt]=ut-1,ot[zt]=ut-1)}return dt.filter(Pt=>Pt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((lt,et)=>lt.sortKey-et.sortKey)}update(t,i,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,i,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(t,i,this.layers,l,h))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=x0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const l=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:h,y:f}of i)this.lineVertexArray.emplaceBack(h,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(t,i,l,h,f,m,x,w,E,A,k,D,O,B){const V=t.indexArray,Z=t.layoutVertexArray,tt=t.globeExtVertexArray,lt=t.segments.prepareSegment(4*i.length,Z,V,this.canOverlap?m.sortKey:void 0),et=this.glyphOffsetArray.length,ot=lt.vertexLength,dt=this.allowVerticalPlacement&&x===rs.vertical?Math.PI/2:0,ut=m.text&&m.text.sections;for(let St=0;St<i.length;St++){const{tl:Bt,tr:Ht,bl:Pt,br:Vt,tex:Ut,pixelOffsetTL:qt,pixelOffsetBR:Qt,minFontScaleX:zt,minFontScaleY:re,glyphOffset:pe,isSDF:oe,sectionIndex:Te}=i[St],te=lt.vertexLength,ge=pe[1];if(Dd(Z,E.x,E.y,Bt.x,ge+Bt.y,Ut.x,Ut.y,l,oe,qt.x,qt.y,zt,re),Dd(Z,E.x,E.y,Ht.x,ge+Ht.y,Ut.x+Ut.w,Ut.y,l,oe,Qt.x,qt.y,zt,re),Dd(Z,E.x,E.y,Pt.x,ge+Pt.y,Ut.x,Ut.y+Ut.h,l,oe,qt.x,Qt.y,zt,re),Dd(Z,E.x,E.y,Vt.x,ge+Vt.y,Ut.x+Ut.w,Ut.y+Ut.h,l,oe,Qt.x,Qt.y,zt,re),w){const{x:Ee,y:$e,z:Se}=w.anchor,[ve,fi,Ce]=w.up;Ld(tt,Ee,$e,Se,ve,fi,Ce),Ld(tt,Ee,$e,Se,ve,fi,Ce),Ld(tt,Ee,$e,Se,ve,fi,Ce),Ld(tt,Ee,$e,Se,ve,fi,Ce),zd(t.dynamicLayoutVertexArray,Ee,$e,Se,dt)}else zd(t.dynamicLayoutVertexArray,E.x,E.y,E.z,dt);V.emplaceBack(te,te+1,te+2),V.emplaceBack(te+1,te+2,te+3),lt.vertexLength+=4,lt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(pe[0]),St!==i.length-1&&Te===i[St+1].sectionIndex||t.programConfigurations.populatePaintArrays(Z.length,m,m.index,{},O,B,ut&&ut[Te])}const Ct=w?w.anchor:E;t.placedSymbolArray.emplaceBack(Ct.x,Ct.y,Ct.z,E.x,E.y,et,this.glyphOffsetArray.length-et,ot,A,k,E.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,!1,0,D,0)}_commitLayoutVertex(t,i,l,h,f,m,x){t.emplaceBack(i,l,h,f,m,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(t,i,l,h,f,m,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),E=w.vertexLength,A=x.tileAnchorX,k=x.tileAnchorY;for(let O=0;O<4;O++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(i,-t.padding,-t.padding),l.collisionVertexArrayExt.emplaceBack(i,t.padding,-t.padding),l.collisionVertexArrayExt.emplaceBack(i,t.padding,t.padding),l.collisionVertexArrayExt.emplaceBack(i,-t.padding,t.padding),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,A,k,new Lt(t.x1,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,A,k,new Lt(t.x2,t.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,A,k,new Lt(t.x2,t.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,f,m,A,k,new Lt(t.x1,t.y2)),w.vertexLength+=4;const D=l.indexArray;D.emplaceBack(E,E+1),D.emplaceBack(E+1,E+2),D.emplaceBack(E+2,E+3),D.emplaceBack(E+3,E),w.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,l,h,f,m){for(let x=h;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(t,m,i,x);this._addCollisionDebugVertices(w,E,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(t,i,l,h,f,m){for(let x=h;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(t,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(w,E,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,m)}}generateCollisionDebugBuffers(t,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jf(de,Fg.members,nn),this.iconCollisionBox=new Jf(de,Fg.members,nn);const l=zl(this.iconSizeData,t),h=zl(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(h,t,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,t,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,t,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(l,t,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(t,i,l,h){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),m=wd(this.textSizeData,t,f)/ln;return this.tilePixelRatio*m}getSymbolInstanceIconSize(t,i,l){const h=this.icon.placedSymbolArray.get(l),f=wd(this.iconSizeData,t,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(t,i,l){t.emplaceBack(i,-l,-l),t.emplaceBack(i,l,-l),t.emplaceBack(i,l,l),t.emplaceBack(i,-l,l)}_updateTextDebugCollisionBoxes(t,i,l,h,f,m){for(let x=h;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceTextSize(t,m,i,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,w.padding)}}_updateIconDebugCollisionBoxes(t,i,l,h,f,m){for(let x=h;x<f;x++){const w=l.get(x),E=this.getSymbolInstanceIconSize(t,i,m);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,w.padding)}}updateCollisionDebugBuffers(t,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=zl(this.iconSizeData,t),h=zl(this.textSizeData,t);for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(h,t,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,t,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(l,t,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(l,t,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,l,h,f,m,x,w,E){const A={};if(i<l){const{x1:k,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:tt,projectedAnchorZ:lt,tileAnchorX:et,tileAnchorY:ot,featureIndex:dt}=t.get(i);A.textBox={x1:k,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:tt,projectedAnchorZ:lt,tileAnchorX:et,tileAnchorY:ot},A.textFeatureIndex=dt}if(h<f){const{x1:k,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:tt,projectedAnchorZ:lt,tileAnchorX:et,tileAnchorY:ot,featureIndex:dt}=t.get(h);A.verticalTextBox={x1:k,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:tt,projectedAnchorZ:lt,tileAnchorX:et,tileAnchorY:ot},A.verticalTextFeatureIndex=dt}if(m<x){const{x1:k,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:tt,projectedAnchorZ:lt,tileAnchorX:et,tileAnchorY:ot,featureIndex:dt}=t.get(m);A.iconBox={x1:k,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:tt,projectedAnchorZ:lt,tileAnchorX:et,tileAnchorY:ot},A.iconFeatureIndex=dt}if(w<E){const{x1:k,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:tt,projectedAnchorZ:lt,tileAnchorX:et,tileAnchorY:ot,featureIndex:dt}=t.get(w);A.verticalIconBox={x1:k,y1:D,x2:O,y2:B,padding:V,projectedAnchorX:Z,projectedAnchorY:tt,projectedAnchorZ:lt,tileAnchorX:et,tileAnchorY:ot},A.verticalIconFeatureIndex=dt}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,i){const l=t.placedSymbolArray.get(i),h=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<h;f+=4)t.indexArray.emplaceBack(f,f+1,f+2),t.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),l=Math.cos(t),h=[],f=[],m=[];for(let x=0;x<this.symbolInstances.length;++x){m.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(i*w.tileAnchorX+l*w.tileAnchorY)),f.push(w.featureIndex)}return m.sort((x,w)=>h[x]-h[w]||f[w]-f[x]),m}addToSortKeyRanges(t,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:E}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&f!==h&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}he(xo,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),xo.MAX_GLYPHS=65535,xo.addDynamicAttributes=zd;const Cw=new st({"symbol-placement":new j(Ot.layout_symbol["symbol-placement"]),"symbol-spacing":new j(Ot.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new j(Ot.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new H(Ot.layout_symbol["symbol-sort-key"]),"symbol-z-order":new j(Ot.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new j(Ot.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new j(Ot.layout_symbol["icon-ignore-placement"]),"icon-optional":new j(Ot.layout_symbol["icon-optional"]),"icon-rotation-alignment":new j(Ot.layout_symbol["icon-rotation-alignment"]),"icon-size":new H(Ot.layout_symbol["icon-size"]),"icon-text-fit":new j(Ot.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new j(Ot.layout_symbol["icon-text-fit-padding"]),"icon-image":new H(Ot.layout_symbol["icon-image"]),"icon-rotate":new H(Ot.layout_symbol["icon-rotate"]),"icon-padding":new j(Ot.layout_symbol["icon-padding"]),"icon-keep-upright":new j(Ot.layout_symbol["icon-keep-upright"]),"icon-offset":new H(Ot.layout_symbol["icon-offset"]),"icon-anchor":new H(Ot.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new j(Ot.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new j(Ot.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new j(Ot.layout_symbol["text-rotation-alignment"]),"text-field":new H(Ot.layout_symbol["text-field"]),"text-font":new H(Ot.layout_symbol["text-font"]),"text-size":new H(Ot.layout_symbol["text-size"]),"text-max-width":new H(Ot.layout_symbol["text-max-width"]),"text-line-height":new H(Ot.layout_symbol["text-line-height"]),"text-letter-spacing":new H(Ot.layout_symbol["text-letter-spacing"]),"text-justify":new H(Ot.layout_symbol["text-justify"]),"text-radial-offset":new H(Ot.layout_symbol["text-radial-offset"]),"text-variable-anchor":new j(Ot.layout_symbol["text-variable-anchor"]),"text-anchor":new H(Ot.layout_symbol["text-anchor"]),"text-max-angle":new j(Ot.layout_symbol["text-max-angle"]),"text-writing-mode":new j(Ot.layout_symbol["text-writing-mode"]),"text-rotate":new H(Ot.layout_symbol["text-rotate"]),"text-padding":new j(Ot.layout_symbol["text-padding"]),"text-keep-upright":new j(Ot.layout_symbol["text-keep-upright"]),"text-transform":new H(Ot.layout_symbol["text-transform"]),"text-offset":new H(Ot.layout_symbol["text-offset"]),"text-allow-overlap":new j(Ot.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new j(Ot.layout_symbol["text-ignore-placement"]),"text-optional":new j(Ot.layout_symbol["text-optional"])});var Qf={paint:new st({"icon-opacity":new H(Ot.paint_symbol["icon-opacity"]),"icon-color":new H(Ot.paint_symbol["icon-color"]),"icon-halo-color":new H(Ot.paint_symbol["icon-halo-color"]),"icon-halo-width":new H(Ot.paint_symbol["icon-halo-width"]),"icon-halo-blur":new H(Ot.paint_symbol["icon-halo-blur"]),"icon-translate":new j(Ot.paint_symbol["icon-translate"]),"icon-translate-anchor":new j(Ot.paint_symbol["icon-translate-anchor"]),"text-opacity":new H(Ot.paint_symbol["text-opacity"]),"text-color":new H(Ot.paint_symbol["text-color"],{runtimeType:On,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new H(Ot.paint_symbol["text-halo-color"]),"text-halo-width":new H(Ot.paint_symbol["text-halo-width"]),"text-halo-blur":new H(Ot.paint_symbol["text-halo-blur"]),"text-translate":new j(Ot.paint_symbol["text-translate"]),"text-translate-anchor":new j(Ot.paint_symbol["text-translate-anchor"])}),layout:Cw};class v0{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Hr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}he(v0,"FormatSectionOverride",{omit:["defaultValue"]});class Rd extends Os{constructor(t){super(t,Qf)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const f of l)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,i,l,h){const f=this.layout.get(t).evaluate(i,{},l,h),m=this._unevaluatedLayout._values[t];return m.isDataDriven()||oo(m.value)||!f?f:function(x,w){return w.replace(/{([^{}]+)}/g,(E,A)=>A in x?String(x[A]):"")}(i.properties,f)}createBucket(t){return new xo(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Qf.paint.overridableProperties){if(!Rd.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),l=new v0(i),h=new fl(l,i.property.specification);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Fc("source",h):new oa("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[t]=new K(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&Rd.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const l=t.get("text-field"),h=Qf.paint.properties[i];let f=!1;const m=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof Tn)m(l.value.value.sections);else if(l.value.kind==="source"){const x=E=>{f||(E instanceof yr&&Di(E.value)===Go?m(E.value.sections):E instanceof Ks?m(E.sections):E.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return f}getProgramConfiguration(t){return new fo(this,t)}}var Iw={paint:new st({"background-color":new j(Ot.paint_background["background-color"]),"background-pattern":new j(Ot.paint_background["background-pattern"]),"background-opacity":new j(Ot.paint_background["background-opacity"])})},Pw={paint:new st({"raster-opacity":new j(Ot.paint_raster["raster-opacity"]),"raster-hue-rotate":new j(Ot.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new j(Ot.paint_raster["raster-brightness-min"]),"raster-brightness-max":new j(Ot.paint_raster["raster-brightness-max"]),"raster-saturation":new j(Ot.paint_raster["raster-saturation"]),"raster-contrast":new j(Ot.paint_raster["raster-contrast"]),"raster-resampling":new j(Ot.paint_raster["raster-resampling"]),"raster-fade-duration":new j(Ot.paint_raster["raster-fade-duration"])})};class kw extends Os{constructor(t){super(t,{}),this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var Dw={paint:new st({"sky-type":new j(Ot.paint_sky["sky-type"]),"sky-atmosphere-sun":new j(Ot.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new j(Ot.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new j(Ot.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new j(Ot.paint_sky["sky-gradient-radius"]),"sky-gradient":new nt(Ot.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new j(Ot.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new j(Ot.paint_sky["sky-atmosphere-color"]),"sky-opacity":new j(Ot.paint_sky["sky-opacity"])})};function t_(e,t,i){const l=[0,0,1],h=Nm([]);return Vm(h,h,i?-fe(e)+Math.PI:fe(e)),jm(h,h,-fe(t)),Rm(l,l,h),Sn(l,l)}const Lw={circle:class extends Os{constructor(e){super(e,qv)}createBucket(e){return new Mf(e)}queryRadius(e){const t=e;return Pl("circle-radius",this,t)+Pl("circle-stroke-width",this,t)+ud(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,i,l,h,f,m,x){const w=cg(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,e.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return hg(e,l,f,m,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,E)}getProgramIds(){return["circle"]}getProgramConfiguration(e){return new fo(this,e)}},heatmap:class extends Os{createBucket(e){return new dg(e)}constructor(e){super(e,Hv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(e){return Pl("heatmap-radius",this,e)}queryIntersectsFeature(e,t,i,l,h,f,m,x){const w=this.paint.get("heatmap-radius").evaluate(t,i);return hg(e,l,f,m,x,!0,!0,new Lt(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(e){return new fo(this,e)}},hillshade:class extends Os{constructor(e){super(e,Xv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Os{constructor(e){super(e,ub)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getProgramConfiguration(e){return new fo(this,e)}recalculate(e,t){super.recalculate(e,t);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new md(e)}queryRadius(){return ud(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,i,l,h,f){return!e.queryGeometry.isAboveHorizon&&sg(lg(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,e.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends Os{constructor(e){super(e,Ab)}createBucket(e){return new xh(e)}queryRadius(){return ud(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(e){return new fo(this,e)}queryIntersectsFeature(e,t,i,l,h,f,m,x,w){const E=cg(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,e.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(t,i),k=this.paint.get("fill-extrusion-base").evaluate(t,i),D=[0,0],O=x&&f.elevation,B=f.elevation?f.elevation.exaggeration():1,V=e.tile.getBucket(this);if(O&&V instanceof xh){const ot=V.centroidVertexArray,dt=w+1;dt<ot.length&&(D[0]=ot.geta_centroid_pos0(dt),D[1]=ot.geta_centroid_pos1(dt))}if(D[0]===0&&D[1]===1)return!1;f.projection.name==="globe"&&(l=Pg([l],[new Lt(0,0),new Lt(ye,ye)],e.tileID.canonical).map(ot=>ot.polygon).flat());const Z=O?x:null,[tt,lt]=function(ot,dt,ut,Ct,St,Bt,Ht,Pt,Vt,Ut,qt){return ot.projection.name==="globe"?function(Qt,zt,re,pe,oe,Te,te,ge,Ee,$e,Se){const ve=[],fi=[],Ce=Qt.projection.upVectorScale(Se,Qt.center.lat,Qt.worldSize).metersToTile,Ie=[0,0,0,1],ai=[0,0,0,1],ui=(li,Mi,Li,qi)=>{li[0]=Mi,li[1]=Li,li[2]=qi,li[3]=1},di=Ig();re>0&&(re+=di),pe+=di;for(const li of zt){const Mi=[],Li=[];for(const qi of li){const ci=qi.x+oe.x,Xi=qi.y+oe.y,$i=Qt.projection.projectTilePoint(ci,Xi,Se),Ai=Qt.projection.upVector(Se,qi.x,qi.y);let Ze=re,Wi=pe;if(te){const pi=zg(ci,Xi,re,pe,te,ge,Ee,$e);Ze+=pi.base,Wi+=pi.top}re!==0?ui(Ie,$i.x+Ai[0]*Ce*Ze,$i.y+Ai[1]*Ce*Ze,$i.z+Ai[2]*Ce*Ze):ui(Ie,$i.x,$i.y,$i.z),ui(ai,$i.x+Ai[0]*Ce*Wi,$i.y+Ai[1]*Ce*Wi,$i.z+Ai[2]*Ce*Wi),Fi(Ie,Ie,Te),Fi(ai,ai,Te),Mi.push(new Ll(Ie[0],Ie[1],Ie[2])),Li.push(new Ll(ai[0],ai[1],ai[2]))}ve.push(Mi),fi.push(Li)}return[ve,fi]}(ot,dt,ut,Ct,St,Bt,Ht,Pt,Vt,Ut,qt):Ht?function(Qt,zt,re,pe,oe,Te,te,ge,Ee){const $e=[],Se=[],ve=[0,0,0,1];for(const fi of Qt){const Ce=[],Ie=[];for(const ai of fi){const ui=ai.x+pe.x,di=ai.y+pe.y,li=zg(ui,di,zt,re,Te,te,ge,Ee);ve[0]=ui,ve[1]=di,ve[2]=li.base,ve[3]=1,ya(ve,ve,oe),ve[3]=Math.max(ve[3],1e-5);const Mi=new Ll(ve[0]/ve[3],ve[1]/ve[3],ve[2]/ve[3]);ve[0]=ui,ve[1]=di,ve[2]=li.top,ve[3]=1,ya(ve,ve,oe),ve[3]=Math.max(ve[3],1e-5);const Li=new Ll(ve[0]/ve[3],ve[1]/ve[3],ve[2]/ve[3]);Ce.push(Mi),Ie.push(Li)}$e.push(Ce),Se.push(Ie)}return[$e,Se]}(dt,ut,Ct,St,Bt,Ht,Pt,Vt,Ut):function(Qt,zt,re,pe,oe){const Te=[],te=[],ge=oe[8]*zt,Ee=oe[9]*zt,$e=oe[10]*zt,Se=oe[11]*zt,ve=oe[8]*re,fi=oe[9]*re,Ce=oe[10]*re,Ie=oe[11]*re;for(const ai of Qt){const ui=[],di=[];for(const li of ai){const Mi=li.x+pe.x,Li=li.y+pe.y,qi=oe[0]*Mi+oe[4]*Li+oe[12],ci=oe[1]*Mi+oe[5]*Li+oe[13],Xi=oe[2]*Mi+oe[6]*Li+oe[14],$i=oe[3]*Mi+oe[7]*Li+oe[15],Ai=qi+ge,Ze=ci+Ee,Wi=Xi+$e,pi=Math.max($i+Se,1e-5),Cn=qi+ve,Zi=ci+fi,cn=Xi+Ce,sn=Math.max($i+Ie,1e-5);ui.push(new Ll(Ai/pi,Ze/pi,Wi/pi)),di.push(new Ll(Cn/sn,Zi/sn,cn/sn))}Te.push(ui),te.push(di)}return[Te,te]}(dt,ut,Ct,St,Bt)}(f,l,k,A,E,m,Z,D,B,f.center.lat,e.tileID.canonical),et=e.queryGeometry;return function(ot,dt,ut){let Ct=1/0;sg(ut,dt)&&(Ct=Lg(ut,dt[0]));for(let St=0;St<dt.length;St++){const Bt=dt[St],Ht=ot[St];for(let Pt=0;Pt<Bt.length-1;Pt++){const Vt=Bt[Pt],Ut=[Vt,Bt[Pt+1],Ht[Pt+1],Ht[Pt],Vt];ng(ut,Ut)&&(Ct=Math.min(Ct,Lg(ut,Ut)))}}return Ct!==1/0&&Ct}(tt,lt,et.isPointQuery()?et.screenBounds:et.screenGeometry)}},line:class extends Os{constructor(e){super(e,Rg),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(e){if(e==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof Sc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=Og.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new bd(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(e){return new fo(this,e)}queryRadius(e){const t=e,i=Bg(Pl("line-width",this,t),Pl("line-gap-width",this,t)),l=Pl("line-offset",this,t);return i/2+Math.abs(l)+ud(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,i,l,h,f){if(e.queryGeometry.isAboveHorizon)return!1;const m=lg(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,e.pixelToTileUnitsFactor),x=e.pixelToTileUnitsFactor/2*Bg(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),w=this.paint.get("line-offset").evaluate(t,i);return w&&(l=function(E,A){const k=[],D=new Lt(0,0);for(let O=0;O<E.length;O++){const B=E[O],V=[];for(let Z=0;Z<B.length;Z++){const tt=B[Z],lt=B[Z+1],et=Z===0?D:tt.sub(B[Z-1])._unit()._perp(),ot=Z===B.length-1?D:lt.sub(tt)._unit()._perp(),dt=et._add(ot)._unit();dt._mult(1/(dt.x*ot.x+dt.y*ot.y)),V.push(dt._mult(A)._add(tt))}k.push(V)}return k}(l,w*e.pixelToTileUnitsFactor)),function(E,A,k){for(let D=0;D<A.length;D++){const O=A[D];if(E.length>=3){for(let B=0;B<O.length;B++)if(wa(E,O[B]))return!0}if(jv(E,O,k))return!0}return!1}(m,l,x)}isTileClipped(){return!0}},symbol:Rd,background:class extends Os{constructor(e){super(e,Iw)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Os{constructor(e){super(e,Pw)}getProgramIds(){return["raster"]}},sky:class extends Os{constructor(e){super(e,Dw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){e==="sky-gradient"?this._updateColorRamp():e!=="sky-atmosphere-sun"&&e!=="sky-atmosphere-halo-color"&&e!=="sky-atmosphere-color"&&e!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Pf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,f=e.style.light,m=f.properties.get("position");return h&&f.properties.get("anchor")==="viewport"&&Ei("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?t_(m.azimuthal,90-m.polar,t):t_(l[0],90-l[1],t)}const i=this.paint.get("sky-gradient-center");return t_(i[0],90-i[1],t)}is3D(){return!1}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return e==="atmosphere"?["skyboxCapture","skybox"]:e==="gradient"?["skyboxGradient"]:null}}};class Ph{constructor(t,i,l,h){this.context=t,this.format=l,this.texture=t.gl.createTexture(),this.update(i,h)}update(t,i,l){const{width:h,height:f}=t,{context:m}=this,{gl:x}=m,{HTMLImageElement:w,HTMLCanvasElement:E,HTMLVideoElement:A,ImageData:k,ImageBitmap:D}=T;if(x.bindTexture(x.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!i||i.premultiply!==!1)),l||this.size&&this.size[0]===h&&this.size[1]===f){const{x:O,y:B}=l||{x:0,y:0};t instanceof w||t instanceof E||t instanceof A||t instanceof k||D&&t instanceof D?x.texSubImage2D(x.TEXTURE_2D,0,O,B,x.RGBA,x.UNSIGNED_BYTE,t):x.texSubImage2D(x.TEXTURE_2D,0,O,B,h,f,x.RGBA,x.UNSIGNED_BYTE,t.data)}else this.size=[h,f],t instanceof w||t instanceof E||t instanceof A||t instanceof k||D&&t instanceof D?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,t):x.texImage2D(x.TEXTURE_2D,0,this.format,h,f,0,this.format,x.UNSIGNED_BYTE,t.data);this.useMipmap=!!(i&&i.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(t,i){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?t===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:t),this.filter=t),i!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrap=i)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class zw{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Rw{constructor(){this.tasks={},this.taskQueue=[],ur(["process"],this),this.invoker=new zw(this.process),this.nextId=0}add(t,i){const l=this.nextId++,h=function({type:f,isSymbolTile:m,zoom:x}){return x=x||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-x:f==="maybePrepare"&&m?400-x:500:200-x:100-x}(i);if(h===0){Ts();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:t,metadata:i,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Ts();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<i&&(i=f.priority,t=h)}if(t===null)return null;const l=this.taskQueue[t];return this.taskQueue.splice(t,1),l}remove(){this.invoker.remove()}}class b0{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const l=t[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const Ow=["tile","layer","source","sourceLayer","state"];class w0{constructor(t,i,l,h,f){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=l,this._y=h,this.properties=t.properties,this.id=f}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(t.id=this.id);for(const i of Ow)this[i]!==void 0&&(t[i]=this[i]);return t}}const xs=32,sr=33,vo=new Uint16Array(8184);for(let e=0;e<2046;e++){let t=e+2,i=0,l=0,h=0,f=0,m=0,x=0;for(1&t?h=f=m=xs:i=l=x=xs;(t>>=1)>1;){const E=i+h>>1,A=l+f>>1;1&t?(h=i,f=l,i=m,l=x):(i=h,l=f,h=m,f=x),m=E,x=A}const w=4*e;vo[w+0]=i,vo[w+1]=l,vo[w+2]=h,vo[w+3]=f}const rr=new Uint16Array(2178),bo=new Uint8Array(1089),Od=new Uint16Array(1089);function T0(e){return e===0?-.03125:e===32?.03125:0}var E0=xt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const S0={type:2,extent:ye,loadGeometry:()=>[[new Lt(0,0),new Lt(ye+1,0),new Lt(ye+1,ye+1),new Lt(0,ye+1),new Lt(0,0)]]};class e_{constructor(t,i,l,h,f){this.tileID=t,this.uid=Nn(),this.uses=0,this.tileSize=i,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(t){const i=t+this.timeAdded;i<Es.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Ea(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,i,l){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(h,f){const m={};if(!f)return m;for(const x of h){const w=x.layerIds.map(E=>f.getLayer(E)).filter(Boolean);if(w.length!==0){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(E=>w.filter(A=>A.id===E)[0]));for(const E of w)m[E.id]=x}}return m}(t.buckets,i.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const f=this.buckets[h];if(f instanceof xo){if(this.hasSymbolBuckets=!0,!l)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const f=this.buckets[h];if(f instanceof xo&&f.hasRTLText){this.hasRTLText=!0,M.isLoading()||M.isLoaded()||b()!=="deferred"||S();break}}this.queryPadding=0;for(const h in this.buckets){const f=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,i.style.getLayer(h).queryRadius(f))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new ri}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(t)}const i=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ph(t,this.imageAtlas.image,i.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ph(t,this.glyphAtlasImage,i.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ph(t,this.lineAtlas.image,i.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,i,l,h,f,m,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:m,params:f,tileTransform:this.tileTransform},t,i,l):{}}querySourceFeatures(t,i){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),f=i?i.sourceLayer:"",m=h._geojsonTileLayer||h[f];if(!m)return;const x=yl(i&&i.filter),{z:w,x:E,y:A}=this.tileID.canonical,k={z:w,x:E,y:A};for(let D=0;D<m.length;D++){const O=m.feature(D);if(x.needGeometry){const Z=ba(O,!0);if(!x.filter(new P(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!x.filter(new P(this.tileID.overscaledZ),O))continue;const B=l.getId(O,f),V=new w0(O,w,E,A,B);V.tile=k,t.push(V)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const i=this.expirationTime;if(t.cacheControl){const l=Rn(t.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const f=this.expirationTime-i;f?this.expirationTime=l+Math.max(f,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,i){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0||!i)return;const l=this.latestFeatureIndex.loadVTLayers(),h=i.style.listImages();for(const f in this.buckets){if(!i.style.hasLayer(f))continue;const m=this.buckets[f],x=m.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],E=t[x];if(!w||!E||Object.keys(E).length===0)continue;if(m.update(E,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),m instanceof bd||m instanceof md){const k=i.style._getSourceCache(m.layers[0].source);i._terrain&&i._terrain.enabled&&k&&m.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(k.id,this.tileID)}const A=i&&i.style&&i.style.getLayer(f);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<Es.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=Es.now()+t}setTexture(t,i){const l=i.context,h=l.gl;this.texture=this.texture||i.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new Ph(l,t,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(t,i){const l={};for(const h of i)l[h]=!0;this.dependencies[t]=l}hasDependency(t,i){for(const l of t){const h=this.dependencies[l];if(h){for(const f of i)if(h[f])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const l=Pr(S0,this.tileID.canonical,this.tileTransform)[0],h=new Zt,f=new Wn;for(let m=0;m<l.length;m++){const{x,y:w}=l[m];h.emplaceBack(x,w),f.emplaceBack(m)}f.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(f),this._tileDebugBuffer=t.createVertexBuffer(h,lh.members),this._tileDebugSegments=Ui.simpleSegment(0,0,h.length,f.length)}_makeTileBoundsBuffers(t,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const l=Pr(S0,this.tileID.canonical,this.tileTransform)[0];let h,f;if(this.isRaster){const m=function(x,w){const E=Ea(x,w),A=Math.pow(2,x.z);for(let Z=0;Z<sr;Z++)for(let tt=0;tt<sr;tt++){const lt=ss((x.x+(tt+T0(tt))/xs)/A),et=fn((x.y+(Z+T0(Z))/xs)/A),ot=w.project(lt,et),dt=Z*sr+tt;rr[2*dt+0]=Math.round((ot.x*E.scale-E.x)*ye),rr[2*dt+1]=Math.round((ot.y*E.scale-E.y)*ye)}bo.fill(0),Od.fill(0);for(let Z=2045;Z>=0;Z--){const tt=4*Z,lt=vo[tt+0],et=vo[tt+1],ot=vo[tt+2],dt=vo[tt+3],ut=lt+ot>>1,Ct=et+dt>>1,St=ut+Ct-et,Bt=Ct+lt-ut,Ht=et*sr+lt,Pt=dt*sr+ot,Vt=Ct*sr+ut,Ut=Math.hypot((rr[2*Ht+0]+rr[2*Pt+0])/2-rr[2*Vt+0],(rr[2*Ht+1]+rr[2*Pt+1])/2-rr[2*Vt+1])>=16;bo[Vt]=bo[Vt]||(Ut?1:0),Z<1022&&(bo[Vt]=bo[Vt]||bo[(et+Bt>>1)*sr+(lt+St>>1)]||bo[(dt+Bt>>1)*sr+(ot+St>>1)])}const k=new jt,D=new _e;let O=0;function B(Z,tt){const lt=tt*sr+Z;return Od[lt]===0&&(k.emplaceBack(rr[2*lt+0],rr[2*lt+1],Z*ye/xs,tt*ye/xs),Od[lt]=++O),Od[lt]-1}function V(Z,tt,lt,et,ot,dt){const ut=Z+lt>>1,Ct=tt+et>>1;if(Math.abs(Z-ot)+Math.abs(tt-dt)>1&&bo[Ct*sr+ut])V(ot,dt,Z,tt,ut,Ct),V(lt,et,ot,dt,ut,Ct);else{const St=B(Z,tt),Bt=B(lt,et),Ht=B(ot,dt);D.emplaceBack(St,Bt,Ht)}}return V(0,0,xs,xs,xs,0),V(xs,xs,0,0,0,xs),{vertices:k,indices:D}}(this.tileID.canonical,i);h=m.vertices,f=m.indices}else{h=new jt,f=new _e;for(const{x,y:w}of l)h.emplaceBack(x,w,0,0);const m=Rf(h.int16,void 0,4);for(let x=0;x<m.length;x+=3)f.emplaceBack(m[x],m[x+1],m[x+2])}this._tileBoundsBuffer=t.createVertexBuffer(h,E0.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(f),this._tileBoundsSegments=Ui.simpleSegment(0,0,h.length,f.length)}_makeGlobeTileDebugBuffers(t,i){const l=i.projection;if(!l||l.name!=="globe"||i.freezeTileCoverage)return;const h=this.tileID.canonical,f=uh(Wm(h,i)),m=Cl(i.zoom);let x;m>0&&(x=cf(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,h,i,f,x,m),this._makeGlobeTileDebugTextBuffer(t,h,i,f,x,m)}_globePoint(t,i,l,h,f,m,x){let w=hh(t,i,l);if(m){const E=1<<l.z,A=ir(h.center.lng),k=nr(h.center.lat),D=(l.x+.5)/E-A;let O=0;D>.5?O=-1:D<-.5&&(O=1);let B=(t/ye+l.x)/E+O,V=(i/ye+l.y)/E;B=(B-A)*h._pixelsPerMercatorPixel+A,V=(V-k)*h._pixelsPerMercatorPixel+k;const Z=[B*h.worldSize,V*h.worldSize,0];Fi(Z,Z,m),w=va(w,Z,x)}return Fi(w,w,f)}_makeGlobeTileDebugBorderBuffer(t,i,l,h,f,m){const x=new Zt,w=new Wn,E=new Et,A=(D,O,B,V,Z)=>{const tt=(B-D)/(Z-1),lt=(V-O)/(Z-1),et=x.length;for(let ot=0;ot<Z;ot++){const dt=D+ot*tt,ut=O+ot*lt;x.emplaceBack(dt,ut);const Ct=this._globePoint(dt,ut,i,l,h,f,m);E.emplaceBack(Ct[0],Ct[1],Ct[2]),w.emplaceBack(et+ot)}},k=ye;A(0,0,k,0,16),A(k,0,k,k,16),A(k,k,0,k,16),A(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(w),this._tileDebugBuffer=t.createVertexBuffer(x,lh.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(E,Gm.members),this._tileDebugSegments=Ui.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugTextBuffer(t,i,l,h,f,m){const x=ye/4,w=new Zt,E=new _e,A=new Et,k=25;E.reserve(32),w.reserve(k),A.reserve(k);const D=(O,B)=>k*O+B;for(let O=0;O<k;O++){const B=O*x;for(let V=0;V<k;V++){const Z=V*x;w.emplaceBack(Z,B);const tt=this._globePoint(Z,B,i,l,h,f,m);A.emplaceBack(tt[0],tt[1],tt[2])}}for(let O=0;O<4;O++)for(let B=0;B<4;B++){const V=D(O,B),Z=D(O,B+1),tt=D(O+1,B),lt=D(O+1,B+1);E.emplaceBack(V,Z,tt),E.emplaceBack(tt,Z,lt)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(E),this._tileDebugTextBuffer=t.createVertexBuffer(w,lh.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(A,Gm.members),this._tileDebugTextSegments=Ui.simpleSegment(0,0,k,32)}}class Bw{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,i,l){const h=String(i);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][h]=this.stateChanges[t][h]||{},_i(this.stateChanges[t][h],l),this.deletedStates[t]===null){this.deletedStates[t]={};for(const f in this.state[t])f!==h&&(this.deletedStates[t][f]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][h]===null){this.deletedStates[t][h]={};for(const f in this.state[t][h])l[f]||(this.deletedStates[t][h][f]=null)}else for(const f in l)this.deletedStates[t]&&this.deletedStates[t][h]&&this.deletedStates[t][h][f]===null&&delete this.deletedStates[t][h][f]}removeFeatureState(t,i,l){if(this.deletedStates[t]===null)return;const h=String(i);if(this.deletedStates[t]=this.deletedStates[t]||{},l&&i!==void 0)this.deletedStates[t][h]!==null&&(this.deletedStates[t][h]=this.deletedStates[t][h]||{},this.deletedStates[t][h][l]=null);else if(i!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][h])for(l in this.deletedStates[t][h]={},this.stateChanges[t][h])this.deletedStates[t][h][l]=null;else this.deletedStates[t][h]=null;else this.deletedStates[t]=null}getState(t,i){const l=String(i),h=_i({},(this.state[t]||{})[l],(this.stateChanges[t]||{})[l]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const f=this.deletedStates[t][i];if(f===null)return{};for(const m in f)delete h[m]}return h}initializeTileState(t,i){t.setFeatureState(this.state,i)}coalesceChanges(t,i){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const f={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),_i(this.state[h][m],this.stateChanges[h][m]),f[m]=this.state[h][m];l[h]=f}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const f={};if(this.deletedStates[h]===null)for(const m in this.state[h])f[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const x of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][x];f[m]=this.state[h][m]}l[h]=l[h]||{},_i(l[h],f)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const h in t)t[h].setFeatureState(l,i)}}class M0{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const l=this.toIdx(t,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function A0(e,t,i,l){let h=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(l[m])<1e-15){if(i[m]<e[m]||i[m]>t[m])return null}else{const x=1/l[m];let w=(e[m]-i[m])*x,E=(t[m]-i[m])*x;if(w>E){const A=w;w=E,E=A}if(w>h&&(h=w),E<f&&(f=E),h>f)return null}return h}function C0(e,t,i,l,h,f,m,x,w,E,A){const k=l-e,D=h-t,O=f-i,B=m-e,V=x-t,Z=w-i,tt=A[1]*Z-A[2]*V,lt=A[2]*B-A[0]*Z,et=A[0]*V-A[1]*B,ot=k*tt+D*lt+O*et;if(Math.abs(ot)<1e-15)return null;const dt=1/ot,ut=E[0]-e,Ct=E[1]-t,St=E[2]-i,Bt=(ut*tt+Ct*lt+St*et)*dt;if(Bt<0||Bt>1)return null;const Ht=Ct*O-St*D,Pt=St*k-ut*O,Vt=ut*D-Ct*k,Ut=(A[0]*Ht+A[1]*Pt+A[2]*Vt)*dt;return Ut<0||Bt+Ut>1?null:(B*Ht+V*Pt+Z*Vt)*dt}function I0(e,t,i){return(e-t)/(i-t)}function P0(e,t,i,l,h,f,m,x,w){const E=1<<i,A=f-l,k=m-h,D=(e+1)/E*A+l,O=(t+0)/E*k+h,B=(t+1)/E*k+h;x[0]=(e+0)/E*A+l,x[1]=O,w[0]=D,w[1]=B}class k0{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const m=Math.ceil(Math.log2(f.dim/8)),x=[];let w=Math.ceil(Math.pow(2,m));const E=1/w,A=(O,B,V,Z,tt)=>{const lt=Z?1:0,et=(O+1)*V-lt,ot=B*V,dt=(B+1)*V-lt;tt[0]=O*V,tt[1]=ot,tt[2]=et,tt[3]=dt};let k=new M0(w);const D=[];for(let O=0;O<w*w;O++){A(O%w,Math.floor(O/w),E,!1,D);const B=wo(D[0],D[1],f),V=wo(D[2],D[1],f),Z=wo(D[2],D[3],f),tt=wo(D[0],D[3],f);k.minimums.push(Math.min(B,V,Z,tt)),k.maximums.push(Math.max(B,V,Z,tt)),k.leaves.push(1)}for(x.push(k),w/=2;w>=1;w/=2){const O=x[x.length-1];k=new M0(w);for(let B=0;B<w*w;B++){A(B%w,Math.floor(B/w),2,!0,D);const V=O.getElevation(D[0],D[1]),Z=O.getElevation(D[2],D[1]),tt=O.getElevation(D[2],D[3]),lt=O.getElevation(D[0],D[3]),et=O.isLeaf(D[0],D[1]),ot=O.isLeaf(D[2],D[1]),dt=O.isLeaf(D[2],D[3]),ut=O.isLeaf(D[0],D[3]),Ct=Math.min(V.min,Z.min,tt.min,lt.min),St=Math.max(V.max,Z.max,tt.max,lt.max),Bt=et&&ot&&dt&&ut;k.maximums.push(St),k.minimums.push(Ct),k.leaves.push(St-Ct<=5&&Bt?1:0)}x.push(k)}return x}(this.dem),l=i.length-1,h=i[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(t,i,l,h,f,m,x=1){return A0([t,i,-100],[l,h,this.maximums[0]*x],f,m)}raycast(t,i,l,h,f,m,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(t,i,l,h,f,m,x);if(w==null)return null;const E=[],A=[],k=[],D=[],O=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;O.length>0;){const{idx:B,t:V,nodex:Z,nodey:tt,depth:lt}=O.pop();if(this.leaves[B]){P0(Z,tt,lt,t,i,l,h,k,D);const ot=1<<lt,dt=(Z+0)/ot,ut=(Z+1)/ot,Ct=(tt+0)/ot,St=(tt+1)/ot,Bt=wo(dt,Ct,this.dem)*x,Ht=wo(ut,Ct,this.dem)*x,Pt=wo(ut,St,this.dem)*x,Vt=wo(dt,St,this.dem)*x,Ut=C0(k[0],k[1],Bt,D[0],k[1],Ht,D[0],D[1],Pt,f,m),qt=C0(D[0],D[1],Pt,k[0],D[1],Vt,k[0],k[1],Bt,f,m),Qt=Math.min(Ut!==null?Ut:Number.MAX_VALUE,qt!==null?qt:Number.MAX_VALUE);if(Qt!==Number.MAX_VALUE)return Qt;{const zt=oh([],f,m,V);if(D0(Bt,Ht,Vt,Pt,I0(zt[0],k[0],D[0]),I0(zt[1],k[1],D[1]))>=zt[2])return V}continue}let et=0;for(let ot=0;ot<this._siblingOffset.length;ot++){P0((Z<<1)+this._siblingOffset[ot][0],(tt<<1)+this._siblingOffset[ot][1],lt+1,t,i,l,h,k,D),k[2]=-100,D[2]=this.maximums[this.childOffsets[B]+ot]*x;const dt=A0(k,D,f,m);if(dt!=null){const ut=dt;E[ot]=ut;let Ct=!1;for(let St=0;St<et&&!Ct;St++)ut>=E[A[St]]&&(A.splice(St,0,ot),Ct=!0);Ct||(A[et]=ot),et++}}for(let ot=0;ot<et;ot++){const dt=A[ot];O.push({idx:this.childOffsets[B]+dt,t:E[dt],nodex:(Z<<1)+this._siblingOffset[dt][0],nodey:(tt<<1)+this._siblingOffset[dt][1],depth:lt+1})}}return null}_addNode(t,i,l){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,l,h,f){if(t[h].isLeaf(i,l)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=h-1,x=t[m];let w=0,E=0;for(let A=0;A<this._siblingOffset.length;A++){const k=2*i+this._siblingOffset[A][0],D=2*l+this._siblingOffset[A][1],O=x.getElevation(k,D),B=x.isLeaf(k,D),V=this._addNode(O.min,O.max,B);B&&(w|=1<<A),E||(E=V)}for(let A=0;A<this._siblingOffset.length;A++)w&1<<A||this._construct(t,2*i+this._siblingOffset[A][0],2*l+this._siblingOffset[A][1],m,E+A)}}function D0(e,t,i,l,h,f){return Ue(Ue(e,i,f),Ue(t,l,f),h)}function wo(e,t,i){const l=i.dim,h=be(e*l-.5,0,l-1),f=be(t*l-.5,0,l-1),m=Math.floor(h),x=Math.floor(f),w=Math.min(m+1,l-1),E=Math.min(x+1,l-1);return D0(i.get(m,x),i.get(w,x),i.get(m,E),i.get(w,E),h-m,f-x)}const L0={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Fw(e,t,i){return(256*e*256+256*t+i)/10-1e4}function Nw(e,t,i){return 256*e+t+i/256-32768}class Bd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,l,h=!1,f=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return Ei(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const m=this.dim=i.height-2,x=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let w=0;w<m;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(m,w)]=x[this._idx(m-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,m)]=x[this._idx(w,m-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(m,-1)]=x[this._idx(m-1,0)],x[this._idx(-1,m)]=x[this._idx(0,m-1)],x[this._idx(m,m)]=x[this._idx(m-1,m-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new k0(this)}get(t,i,l=!1){l&&(t=be(t,-1,this.dim),i=be(i,-1,this.dim));const h=4*this._idx(t,i);return(this.encoding==="terrarium"?Nw:Fw)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(t){return L0[t]}get unpackVector(){return L0[this.encoding]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){const l=[0,0,0,0],h=Bd.getUnpackVector(i);let f=Math.floor((t+h[3])/h[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new Hn({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,l){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,f=i*this.dim+this.dim,m=l*this.dim,x=l*this.dim+this.dim;switch(i){case-1:h=f-1;break;case 1:f=h+1}switch(l){case-1:m=x-1;break;case 1:x=m+1}const w=-i*this.dim,E=-l*this.dim;for(let A=m;A<x;A++)for(let k=h;k<f;k++){const D=4*this._idx(k,A),O=4*this._idx(k+w,A+E);this.pixels[D+0]=t.pixels[O+0],this.pixels[D+1]=t.pixels[O+1],this.pixels[D+2]=t.pixels[O+2],this.pixels[D+3]=t.pixels[O+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}he(Bd,"DEMData"),he(k0,"DemMinMaxQuadTree",{omit:["dem"]});class jw{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){for(const t in this.data)for(const i of this.data[t])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(t,i,l){const h=t.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const f={value:i,timeout:void 0};if(l!==void 0&&(f.timeout=setTimeout(()=>{this.remove(t,f)},l)),this.data[h].push(f),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const i=this.data[t].shift();return i.timeout&&clearTimeout(i.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),i.value}getByKey(t){const i=this.data[t];return i?i[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,i){if(!this.has(t))return this;const l=t.wrapped().key,h=i===void 0?0:this.data[l].indexOf(i),f=this.data[l][h];return this.data[l].splice(h,1),f.timeout&&clearTimeout(f.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(f.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(t){const i=[];for(const l in this.data)for(const h of this.data[l])t(h.value)||i.push(h);for(const l of i)this.remove(l.value.tileID,l)}}class Gl{constructor(t,i,l){this.func=t,this.mask=i,this.range=l}}Gl.ReadOnly=!1,Gl.ReadWrite=!0,Gl.disabled=new Gl(519,Gl.ReadOnly,[0,1]);const i_=7680;class n_{constructor(t,i,l,h,f,m){this.test=t,this.ref=i,this.mask=l,this.fail=h,this.depthFail=f,this.pass=m}}n_.disabled=new n_({func:519,mask:0},0,0,i_,i_,i_);class or{constructor(t,i,l){this.blendFunction=t,this.blendColor=i,this.mask=l}}or.Replace=[1,0],or.disabled=new or(or.Replace,Bi.transparent,[!1,!1,!1,!1]),or.unblended=new or(or.Replace,Bi.transparent,[!0,!0,!0,!0]),or.alphaBlended=new or([1,771],Bi.transparent,[!0,!0,!0,!0]);const s_=1029,r_=2305;class Us{constructor(t,i,l){this.enable=t,this.mode=i,this.frontFace=l}}Us.disabled=new Us(!1,s_,r_),Us.backCCW=new Us(!0,s_,r_),Us.backCW=new Us(!0,s_,2304),Us.frontCW=new Us(!0,1028,2304),Us.frontCCW=new Us(!0,1028,r_);class Sa extends Uo{constructor(t,i,l){super(),this.id=t,this._onlySymbols=l,i.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new jw(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Bw,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const i=this._tiles[t];if(i.state!=="loaded"&&i.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,i){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,i)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const l=this._tiles[i];l.upload(t),l.prepare(this.map.style.imageManager)}}getIds(){return gn(this._tiles).map(t=>t.tileID).sort(z0).map(t=>t.key)}getRenderableIds(t){const i=[];for(const l in this._tiles)this._isIdRenderable(+l,t)&&i.push(this._tiles[l]);return t?i.sort((l,h)=>{const f=l.tileID,m=h.tileID,x=new Lt(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),w=new Lt(m.canonical.x,m.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-m.overscaledZ||w.y-x.y||w.x-x.x}).map(l=>l.tileID.key):i.map(l=>l.tileID).sort(z0).map(l=>l.key)}hasRenderableParent(t){const i=this.findLoadedParent(t,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(t,i){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(i||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,i){const l=this._tiles[t];l&&(l.state!=="loading"&&(l.state=i),this._loadTile(l,this._tileLoaded.bind(this,l,t,i)))}_tileLoaded(t,i,l,h){if(h)if(t.state="errored",h.status!==404)this._source.fire(new Ss(h,{tile:t}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=Es.now(),l==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(i,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new mr("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const f=i[h];if(t.neighboringTiles&&t.neighboringTiles[f]){const m=this.getTileByID(f);l(t,m),l(m,t)}}function l(h,f){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=f.tileID.canonical.x-h.tileID.canonical.x;const x=f.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),E=f.tileID.key;m===0&&x===0||Math.abs(x)>1||(Math.abs(m)>1&&(Math.abs(m+w)===1?m+=w:Math.abs(m-w)===1&&(m-=w)),f.dem&&h.dem&&(h.dem.backfillBorder(f.dem,m,x),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,i,l,h){for(const f in this._tiles){let m=this._tiles[f];if(h[f]||!m.hasData()||m.tileID.overscaledZ<=i||m.tileID.overscaledZ>l)continue;let x=m.tileID;for(;m&&m.tileID.overscaledZ>i+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(x=E)}let w=x;for(;w.overscaledZ>i;)if(w=w.scaledTo(w.overscaledZ-1),t[w.key]){h[x.key]=x;break}}}findLoadedParent(t,i){if(t.key in this._loadedParentTiles){const l=this._loadedParentTiles[t.key];return l&&l.tileID.overscaledZ>=i?l:null}for(let l=t.overscaledZ-1;l>=i;l--){const h=t.scaledTo(l),f=this._getLoadedTile(h);if(f)return f}}_getLoadedTile(t){const i=this._tiles[t.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,i){i=i||this._source.tileSize;const l=Math.ceil(t.width/i)+1,h=Math.ceil(t.height/i)+1,f=Math.floor(l*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,f):f,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(x)}handleWrapJump(t){const i=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,i){const l={};for(const h in this._tiles){const f=this._tiles[h];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+i),l[f.tileID.key]=f}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(t,i,l){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(t,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new An(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=t.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const f=this._updateRetainedTiles(h);if(R0(this._source.type)&&h.length!==0){const x={},w={},E=Object.keys(f);for(const k of E){const D=f[k],O=this._tiles[k];if(!O||O.fadeEndTime&&O.fadeEndTime<=Es.now())continue;const B=this.findLoadedParent(D,Math.max(D.overscaledZ-Sa.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),x[B.tileID.key]=B.tileID),w[k]=D}const A=h[h.length-1].overscaledZ;for(const k in this._tiles){const D=this._tiles[k];if(f[k]||!D.hasData())continue;let O=D.tileID;for(;O.overscaledZ>A;){O=O.scaledTo(O.overscaledZ-1);const B=this._tiles[O.key];if(B&&B.hasData()&&w[O.key]){f[k]=D.tileID;break}}}for(const k in x)f[k]||(this._coveredTiles[k]=!0,f[k]=x[k])}for(const x in f)this._tiles[x].clearFadeHold();const m=function(x,w){const E=[];for(const A in x)A in w||E.push(A);return E}(this._tiles,f);for(const x of m){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const i={};if(t.length===0)return i;const l={},h=t.reduce((E,A)=>Math.min(E,A.overscaledZ),1/0),f=t[0].overscaledZ,m=Math.max(f-Sa.maxOverzooming,this._source.minzoom),x=Math.max(f+Sa.maxUnderzooming,this._source.minzoom),w={};for(const E of t){const A=this._addTile(E);i[E.key]=E,A.hasData()||h<this._source.maxzoom&&(w[E.key]=E)}this._retainLoadedChildren(w,h,x,i);for(const E of t){let A=this._tiles[E.key];if(A.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const D=E.children(this._source.maxzoom)[0],O=this.getTile(D);if(O&&O.hasData()){i[D.key]=D;continue}}else{const D=E.children(this._source.maxzoom);if(i[D[0].key]&&i[D[1].key]&&i[D[2].key]&&i[D[3].key])continue}let k=A.wasRequested();for(let D=E.overscaledZ-1;D>=m;--D){const O=E.scaledTo(D);if(l[O.key]||(l[O.key]=!0,A=this.getTile(O),!A&&k&&(A=this._addTile(O)),A&&(i[O.key]=O,k=A.wasRequested(),A.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const i=[];let l,h=this._tiles[t].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}i.push(h.key);const f=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(f),l)break;h=f}for(const f of i)this._loadedParentTiles[f]=l}}_addTile(t){let i=this._tiles[t.key];if(i)return i;i=this._cache.getAndRemove(t),i&&(this._setTileReloadTimer(t.key,i),i.tileID=t,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,i)));const l=!!i;if(!l){const h=this.map?this.map.painter:null;i=new e_(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,t.key,i.state))}return i?(i.uses++,this._tiles[t.key]=i,l||this._source.fire(new mr("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(t,i){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const l=i.getExpiryTimeout();l&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},l))}_removeTile(t){const i=this._tiles[t];i&&(i.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,i,l){const h=[],f=this.transform;if(!f)return h;const m=f.projection.name==="globe",x=ir(f.center.lng);for(const w in this._tiles){const E=this._tiles[w];if(l&&E.clearQueryDebugViz(),E.holdingForFade())continue;let A;if(m){const k=E.tileID.canonical;if(k.z===0){const D=[Math.abs(be(x,...kh(k,-1))-x),Math.abs(be(x,...kh(k,1))-x)];A=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(be(x,...kh(k,-1))-x),Math.abs(be(x,...kh(k,0))-x),Math.abs(be(x,...kh(k,1))-x)];A=[D.indexOf(Math.min(...D))-1]}}else A=[0];for(const k of A){const D=t.containsTile(E,f,i,k);D&&h.push(D)}}return h}getVisibleCoordinates(t){const i=this.getRenderableIds(t).map(l=>this._tiles[l].tileID);for(const l of i)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return i}hasTransition(){if(this._source.hasTransition())return!0;if(R0(this._source.type))for(const t in this._tiles){const i=this._tiles[t];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=Es.now())return!0}return!1}setFeatureState(t,i,l){this._state.updateState(t=t||"_geojsonTileLayer",i,l)}removeFeatureState(t,i,l){this._state.removeFeatureState(t=t||"_geojsonTileLayer",i,l)}getFeatureState(t,i){return this._state.getState(t=t||"_geojsonTileLayer",i)}setDependencies(t,i,l){const h=this._tiles[t];h&&h.setDependencies(i,l)}reloadTilesForDependencies(t,i){for(const l in this._tiles)this._tiles[l].hasDependency(t,i)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(t,i))}_preloadTiles(t,i){if(!this._sourceLoaded){const x=()=>{this._sourceLoaded&&(this._source.off("data",x),this._preloadTiles(t,i))};return void this._source.on("data",x)}const l=new Map,h=Array.isArray(t)?t:[t],f=this.map.painter.terrain,m=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const x of h){const w=x.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of w)l.set(E.key,E);this.usedForTerrain&&x.updateElevation(!1)}ki(Array.from(l.values()),(x,w)=>{const E=new e_(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,A=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),w(A,E)})},i)}}function z0(e,t){const i=Math.abs(2*e.wrap)-+(e.wrap<0),l=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||l-i||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function R0(e){return e==="raster"||e==="image"||e==="video"||e==="custom"}function kh(e,t){const i=1<<e.z;return[e.x/i+t,(e.x+1)/i+t]}Sa.maxOverzooming=10,Sa.maxUnderzooming=3;class Fd{constructor(t,i,l){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(t,i,l){const h=l||t.findDEMTileFor(i);if(!h||!h.dem)return;const f=h.dem,m=h.tileID,x=1<<i.canonical.z-m.canonical.z;return new Fd(h,h.tileSize/ye/x,[(i.canonical.x/x-m.canonical.x)*f.dim,(i.canonical.y/x-m.canonical.y)*f.dim])}tileCoordToPixel(t,i){const l=i*this._scale+this._offset[1],h=Math.floor(t*this._scale+this._offset[0]),f=Math.floor(l);return new Lt(h,f)}getElevationAt(t,i,l,h){const f=t*this._scale+this._offset[0],m=i*this._scale+this._offset[1],x=Math.floor(f),w=Math.floor(m),E=this._dem;return h=!!h,l?Ue(Ue(E.get(x,w,h),E.get(x,w+1,h),m-w),Ue(E.get(x+1,w,h),E.get(x+1,w+1,h),m-w),f-x):E.get(x,w,h)}getElevationAtPixel(t,i,l){return this._dem.get(t,i,!!l)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*Ns(1,t)*this._dem.stride}}class O0{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Tr(ye,16,0),this.featureIndexArray=new pa,this.promoteId=i}insert(t,i,l,h,f,m=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,f,m);const w=this.grid;for(let E=0;E<i.length;E++){const A=i[E],k=[1/0,1/0,-1/0,-1/0];for(let D=0;D<A.length;D++){const O=A[D];k[0]=Math.min(k[0],O.x),k[1]=Math.min(k[1],O.y),k[2]=Math.max(k[2],O.x),k[3]=Math.max(k[3],O.y)}k[0]<ye&&k[1]<ye&&k[2]>=0&&k[3]>=0&&w.insert(x,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Nf(new Ed(this.rawTileData)).layers,this.sourceLayerCoder=new b0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i,l,h){this.loadVTLayers();const f=t.params||{},m=yl(f.filter),x=t.tileResult,w=t.transform,E=x.bufferedTilespaceBounds,A=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(B,V,Z,tt)=>ag(x.bufferedTilespaceGeometry,B,V,Z,tt));A.sort(Vw);let k=null;w.elevation&&A.length>0&&(k=Fd.create(w.elevation,this.tileID));const D={};let O;for(let B=0;B<A.length;B++){const V=A[B];if(V===O)continue;O=V;const Z=this.featureIndexArray.get(V);let tt=null;this.loadMatchingFeature(D,Z,m,f.layers,f.availableImages,i,l,h,(lt,et,ot,dt=0)=>(tt||(tt=Pr(lt,this.tileID.canonical,t.tileTransform)),et.queryIntersectsFeature(x,lt,ot,tt,this.z,t.transform,t.pixelPosMatrix,k,dt)))}return D}loadMatchingFeature(t,i,l,h,f,m,x,w,E){const{featureIndex:A,bucketIndex:k,sourceLayerIndex:D,layoutVertexArrayOffset:O}=i,B=this.bucketLayerIDs[k];if(h&&!function(lt,et){for(let ot=0;ot<lt.length;ot++)if(et.indexOf(lt[ot])>=0)return!0;return!1}(h,B))return;const V=this.sourceLayerCoder.decode(D),Z=this.vtLayers[V].feature(A);if(l.needGeometry){const lt=ba(Z,!0);if(!l.filter(new P(this.tileID.overscaledZ),lt,this.tileID.canonical))return}else if(!l.filter(new P(this.tileID.overscaledZ),Z))return;const tt=this.getId(Z,V);for(let lt=0;lt<B.length;lt++){const et=B[lt];if(h&&h.indexOf(et)<0)continue;const ot=m[et];if(!ot)continue;let dt={};tt!==void 0&&w&&(dt=w.getState(ot.sourceLayer||"_geojsonTileLayer",tt));const ut=_i({},x[et]);ut.paint=B0(ut.paint,ot.paint,Z,dt,f),ut.layout=B0(ut.layout,ot.layout,Z,dt,f);const Ct=!E||E(Z,ot,dt,O);if(!Ct)continue;const St=new w0(Z,this.z,this.x,this.y,tt);St.layer=ut;let Bt=t[et];Bt===void 0&&(Bt=t[et]=[]),Bt.push({featureIndex:A,feature:St,intersectionZ:Ct})}}lookupSymbolFeatures(t,i,l,h,f,m,x,w){const E={};this.loadVTLayers();const A=yl(f);for(const k of t)this.loadMatchingFeature(E,{bucketIndex:l,sourceLayerIndex:h,featureIndex:k,layoutVertexArrayOffset:0},A,m,x,w,i);return E}loadFeature(t){const{featureIndex:i,sourceLayerIndex:l}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),f=this.vtFeatures[h];if(f[i])return f[i];const m=this.vtLayers[h].feature(i);return f[i]=m,m}hasLayer(t){for(const i of this.bucketLayerIDs)for(const l of i)if(t===l)return!0;return!1}getId(t,i){let l=t.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];h!=null&&(l=t.properties[h]),typeof l=="boolean"&&(l=Number(l))}return l}}function B0(e,t,i,l,h){return Ne(e,(f,m)=>{const x=t instanceof Q?t.get(m):null;return x&&x.evaluate?x.evaluate(i,l,h):x})}function Vw(e,t){return t-e}he(O0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class F0{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new kr({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const l=this.getKey(t,i);return this.positions[l]}trim(){const t=this.width,i=this.height=ws(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,l){const h=[];let f=t.length%2==1?-t[t.length-1]*l:0,m=t[0]*l,x=!0;h.push({left:f,right:m,isDash:x,zeroLength:t[0]===0});let w=t[0];for(let E=1;E<t.length;E++){x=!x;const A=t[E];f=w*l,w+=A,m=w*l,h.push({left:f,right:m,isDash:x,zeroLength:A===0})}return h}addRoundDash(t,i,l){const h=i/2;for(let f=-l;f<=l;f++){const m=this.width*(this.nextRow+l+f);let x=0,w=t[x];for(let E=0;E<this.width;E++){E/w.right>1&&(w=t[++x]);const A=Math.abs(E-w.left),k=Math.abs(E-w.right),D=Math.min(A,k);let O;const B=f/l*(h+1);if(w.isDash){const V=h-Math.abs(B);O=Math.sqrt(D*D+V*V)}else O=h-Math.sqrt(D*D+B*B);this.image.data[m+E]=Math.max(0,Math.min(255,O+128))}}}addRegularDash(t,i){for(let w=t.length-1;w>=0;--w){const E=t[w],A=t[w+1];E.zeroLength?t.splice(w,1):A&&A.isDash===E.isDash&&(A.left=E.left,t.splice(w,1))}const l=t[0],h=t[t.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const f=this.width*this.nextRow;let m=0,x=t[m];for(let w=0;w<this.width;w++){w/x.right>1&&(x=t[++m]);const E=Math.abs(w-x.left),A=Math.abs(w-x.right),k=Math.min(E,A);this.image.data[f+w]=Math.max(0,Math.min(255,(x.isDash?k:-k)+i+128))}}addDash(t,i){const l=this.getKey(t,i);if(this.positions[l])return this.positions[l];const h=i==="round",f=h?7:0,m=2*f+1;if(this.nextRow+m>this.height)return Ei("LineAtlas out of space"),null;t.length===0&&t.push(1);let x=0;for(let A=0;A<t.length;A++)t[A]<0&&(Ei("Negative value is found in line dasharray, replacing values with 0"),t[A]=0),x+=t[A];if(x!==0){const A=this.width/x,k=this.getDashRanges(t,this.width,A);h?this.addRoundDash(k,A,f):this.addRegularDash(k,i==="square"?.5*A:0)}const w=this.nextRow+f;this.nextRow+=m;const E={tl:[w,f],br:[x,0]};return this.positions[l]=E,E}}he(F0,"LineAtlas");const N0=1*Vs;class j0{constructor(t){const i={},l=[];for(const x in t){const w=t[x],E=i[x]={};for(const A in w.glyphs){const k=w.glyphs[+A];if(!k||k.bitmap.width===0||k.bitmap.height===0)continue;const D=k.metrics.localGlyph?N0:1,O={x:0,y:0,w:k.bitmap.width+2*D,h:k.bitmap.height+2*D};l.push(O),E[A]=O}}const{w:h,h:f}=Gf(l),m=new kr({width:h||1,height:f||1});for(const x in t){const w=t[x];for(const E in w.glyphs){const A=w.glyphs[+E];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const k=i[x][E],D=A.metrics.localGlyph?N0:1;kr.copy(A.bitmap,m,{x:0,y:0},{x:k.x+D,y:k.y+D},A.bitmap)}}this.image=m,this.positions=i}}he(j0,"GlyphAtlas");class Uw{constructor(t){this.tileID=new An(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Ea(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,i,l,h,f){this.status="parsing",this.data=t,this.collisionBoxArray=new ri;const m=new b0(Object.keys(t.layers).sort()),x=new O0(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},E=new F0(256,256),A={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:l},k=i.familiesBySource[this.source];for(const dt in k){const ut=t.layers[dt];if(!ut)continue;let Ct=!1,St=!1;for(const Pt of k[dt])Pt[0].type==="symbol"?Ct=!0:St=!0;if(this.isSymbolTile===!0&&!Ct||this.isSymbolTile===!1&&!St)continue;ut.version===1&&Ei(`Vector tile source "${this.source}" layer "${dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Bt=m.encode(dt),Ht=[];for(let Pt=0;Pt<ut.length;Pt++){const Vt=ut.feature(Pt),Ut=x.getId(Vt,dt);Ht.push({feature:Vt,id:Ut,index:Pt,sourceLayerIndex:Bt})}for(const Pt of k[dt]){const Vt=Pt[0];this.isSymbolTile!==void 0&&Vt.type==="symbol"!==this.isSymbolTile||Vt.minzoom&&this.zoom<Math.floor(Vt.minzoom)||Vt.maxzoom&&this.zoom>=Vt.maxzoom||Vt.visibility!=="none"&&(o_(Pt,this.zoom,l),(w[Vt.id]=Vt.createBucket({index:x.bucketLayerIDs.length,layers:Pt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Bt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(Ht,A,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(Pt.map(Ut=>Ut.id)))}}let D,O,B,V;E.trim();const Z={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},tt=()=>{if(D)return f(D);if(O&&B&&V){const dt=new j0(O),ut=new Zg(B,V);for(const Ct in w){const St=w[Ct];St instanceof xo?(o_(St.layers,this.zoom,l),fw(St,O,dt.positions,B,ut.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):St.hasPattern&&(St instanceof bd||St instanceof md||St instanceof xh)&&(o_(St.layers,this.zoom,l),St.addFeatures(A,this.tileID.canonical,ut.patternPositions,l,this.tileTransform))}this.status="done",f(null,{buckets:gn(w).filter(Ct=>!Ct.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dt.image,lineAtlas:E,imageAtlas:ut,glyphMap:this.returnDependencies?O:null,iconMap:this.returnDependencies?B:null,glyphPositions:this.returnDependencies?dt.positions:null})}},lt=Ne(A.glyphDependencies,dt=>Object.keys(dt).map(Number));Object.keys(lt).length?h.send("getGlyphs",{uid:this.uid,stacks:lt},(dt,ut)=>{D||(D=dt,O=ut,tt())},void 0,!1,Z):O={};const et=Object.keys(A.iconDependencies);et.length?h.send("getImages",{icons:et,source:this.source,tileID:this.tileID,type:"icons"},(dt,ut)=>{D||(D=dt,B=ut,tt())},void 0,!1,Z):B={};const ot=Object.keys(A.patternDependencies);ot.length?h.send("getImages",{icons:ot,source:this.source,tileID:this.tileID,type:"patterns"},(dt,ut)=>{D||(D=dt,V=ut,tt())},void 0,!1,Z):V={},tt()}}function o_(e,t,i){const l=new P(t);for(const h of e)h.recalculate(l,i)}class V0{constructor(t){this.entries={},this.scheduler=t}request(t,i,l,h){const f=this.entries[t]=this.entries[t]||{callbacks:[]};if(f.result){const[m,x]=f.result;return this.scheduler?this.scheduler.add(()=>{h(m,x)},i):h(m,x),()=>{}}return f.callbacks.push(h),f.cancel||(f.cancel=l((m,x)=>{f.result=[m,x];for(const w of f.callbacks)this.scheduler?this.scheduler.add(()=>{w(m,x)},i):w(m,x);setTimeout(()=>delete this.entries[t],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(m=>m!==h),f.callbacks.length||(f.cancel(),delete this.entries[t]))}}}function U0(e,t,i){const l=JSON.stringify(e.request);return e.data&&(this.deduped.entries[l]={result:[null,e.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},h=>{const f=Wr(e.request,(m,x,w,E)=>{m?h(m):x&&h(null,{vectorTile:i?void 0:new Nf(new Ed(x)),rawData:x,cacheControl:w,expires:E})});return()=>{f.cancel(),h()}},t)}const G0=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class a_{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const f=G0[15&l];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(t,2,1),[x]=new Uint32Array(t,4,1);return new a_(x,m,f,t)}constructor(t,i=64,l=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const f=G0.indexOf(this.ArrayType),m=2*t*this.ArrayType.BYTES_PER_ELEMENT,x=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+m+x+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+x+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=t,this.coords[this._pos++]=i,l}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return l_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:x}=this,w=[0,f.length-1,0],E=[];for(;w.length;){const A=w.pop()||0,k=w.pop()||0,D=w.pop()||0;if(k-D<=x){for(let Z=D;Z<=k;Z++){const tt=m[2*Z],lt=m[2*Z+1];tt>=t&&tt<=l&&lt>=i&&lt<=h&&E.push(f[Z])}continue}const O=D+k>>1,B=m[2*O],V=m[2*O+1];B>=t&&B<=l&&V>=i&&V<=h&&E.push(f[O]),(A===0?t<=B:i<=V)&&(w.push(D),w.push(O-1),w.push(1-A)),(A===0?l>=B:h>=V)&&(w.push(O+1),w.push(k),w.push(1-A))}return E}within(t,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:m}=this,x=[0,h.length-1,0],w=[],E=l*l;for(;x.length;){const A=x.pop()||0,k=x.pop()||0,D=x.pop()||0;if(k-D<=m){for(let Z=D;Z<=k;Z++)$0(f[2*Z],f[2*Z+1],t,i)<=E&&w.push(h[Z]);continue}const O=D+k>>1,B=f[2*O],V=f[2*O+1];$0(B,V,t,i)<=E&&w.push(h[O]),(A===0?t-l<=B:i-l<=V)&&(x.push(D),x.push(O-1),x.push(1-A)),(A===0?t+l>=B:i+l>=V)&&(x.push(O+1),x.push(k),x.push(1-A))}return w}}function l_(e,t,i,l,h,f){if(h-l<=i)return;const m=l+h>>1;q0(e,t,m,l,h,f),l_(e,t,i,l,m-1,1-f),l_(e,t,i,m+1,h,1-f)}function q0(e,t,i,l,h,f){for(;h>l;){if(h-l>600){const E=h-l+1,A=i-l+1,k=Math.log(E),D=.5*Math.exp(2*k/3),O=.5*Math.sqrt(k*D*(E-D)/E)*(A-E/2<0?-1:1);q0(e,t,i,Math.max(l,Math.floor(i-A*D/E+O)),Math.min(h,Math.floor(i+(E-A)*D/E+O)),f)}const m=t[2*i+f];let x=l,w=h;for(Dh(e,t,l,i),t[2*h+f]>m&&Dh(e,t,l,h);x<w;){for(Dh(e,t,x,w),x++,w--;t[2*x+f]<m;)x++;for(;t[2*w+f]>m;)w--}t[2*l+f]===m?Dh(e,t,l,w):(w++,Dh(e,t,w,h)),w<=i&&(l=w+1),i<=w&&(h=w-1)}}function Dh(e,t,i,l){c_(e,i,l),c_(t,2*i,2*l),c_(t,2*i+1,2*l+1)}function c_(e,t,i){const l=e[t];e[t]=e[i],e[i]=l}function $0(e,t,i,l){const h=e-i,f=t-l;return h*h+f*f}r.ARRAY_TYPE=Zn,r.AUTH_ERR_MSG=pt,r.Aabb=Mn,r.Actor=class{constructor(e,t,i){this.target=e,this.parent=t,this.mapId=i,this.callbacks={},this.cancelCallbacks={},ur(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ts()?e:T,this.scheduler=new Rw}send(e,t,i,l,h=!1,f){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=f,this.callbacks[m]=i);const x=Gr(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:e,hasCallback:!!i,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:ho(t,x)},x),{cancel:()=>{i&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(e){const t=e.data,i=t.id;if(i&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){const l=this.cancelCallbacks[i];delete this.cancelCallbacks[i],l&&l.cancel()}else if(t.mustQueue||Ts()){const l=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,t),l&&l.metadata||{type:"message"})}else this.processTask(i,t)}processTask(e,t){if(t.type==="<response>"){const i=this.callbacks[e];delete this.callbacks[e],i&&(t.error?i(Er(t.error)):i(null,Er(t.data)))}else{const i=Gr(this.globalScope)?void 0:[],l=t.hasCallback?(f,m)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:f?ho(f):null,data:ho(m,i)},i)}:f=>{},h=Er(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,h,l);else if(this.parent.getWorkerSource){const f=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,f[0],h.source)[f[1]](h,l)}else l(new Error(`Could not find function ${t.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},r.CanonicalTileID=vd,r.Color=Bi,r.ColorMode=or,r.CullFaceMode=Us,r.DEMData=Bd,r.DataConstantProperty=j,r.DedupedRequest=V0,r.DepthMode=Gl,r.EXTENT=ye,r.Elevation=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const i=t.getSource().maxzoom,l=1<<i,h=Math.floor(e.x),f=Math.floor((e.x-h)*l),m=Math.floor(e.y*l),x=this.findDEMTileFor(new An(i,h,i,f,m));return!(!x||!x.dem)}getAtPointOrZero(e,t=0){return this.getAtPoint(e,t)||0}getAtPoint(e,t,i=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const l=this._source();if(!l||e.y<0||e.y>1)return t;const h=l.getSource().maxzoom,f=1<<h,m=Math.floor(e.x),x=e.x-m,w=new An(h,m,h,Math.floor(x*f),Math.floor(e.y*f)),E=this.findDEMTileFor(w);if(!E||!E.dem)return t;const A=E.dem,k=1<<E.tileID.canonical.z,D=(x*k-E.tileID.canonical.x)*A.dim,O=(e.y*k-E.tileID.canonical.y)*A.dim,B=Math.floor(D),V=Math.floor(O);return(i?this.exaggeration():1)*Ue(Ue(A.get(B,V),A.get(B,V+1),O-V),Ue(A.get(B+1,V),A.get(B+1,V+1),O-V),D-B)}getAtTileOffset(e,t,i){const l=1<<e.canonical.z;return this.getAtPointOrZero(new Il(e.wrap+(e.canonical.x+t/ye)/l,(e.canonical.y+i/ye)/l))}getAtTileOffsetFunc(e,t,i,l){return h=>{const f=this.getAtTileOffset(e,h.x,h.y),m=l.upVector(e.canonical,h.x,h.y);return ns(m,m,f*l.upVectorScale(e.canonical,t,i).metersToTile),m}}getForTilePoints(e,t,i,l){if(this.isUsingMockSource())return!1;const h=Fd.create(this,e,l);return!!h&&(t.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const i=t.dem.tree,l=t.tileID,h=1<<e.canonical.z-l.canonical.z;let f=e.canonical.x/h-l.canonical.x,m=e.canonical.y/h-l.canonical.y,x=0;for(let w=0;w<e.canonical.z-l.canonical.z&&!i.leaves[x];w++){f*=2,m*=2;const E=2*Math.floor(m)+Math.floor(f);x=i.childOffsets[x]+E,f%=1,m%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},r.ErrorEvent=Ss,r.EvaluationParameters=P,r.Event=mr,r.Evented=Uo,r.FillExtrusionBucket=xh,r.Frustum=mf,r.FrustumCorners=_f,r.GLOBE_RADIUS=tr,r.GLOBE_SCALE_MATCH_LATITUDE=45,r.GLOBE_ZOOM_THRESHOLD_MAX=qm,r.GLOBE_ZOOM_THRESHOLD_MIN=gf,r.GlobeSharedBuffers=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const e of this._wireframeSegments)e.destroy()}}_fillGridMeshWithLods(e,t){const i=new Zt,l=new _e,h=[],f=e+1+2,m=t[0]+1,x=t[0]+1+(1+t.length),w=(E,A,k)=>{let D=E===f-1?E-2:E===0?E:E-1;return D+=k?24575:0,[D,A]};for(let E=0;E<f;++E)i.emplaceBack(...w(E,0,!0));for(let E=0;E<m;++E)for(let A=0;A<f;++A)i.emplaceBack(...w(A,E,(A===0||A===f-1)&&!0));for(let E=0;E<t.length;++E){const A=t[E];for(let k=0;k<f;++k)i.emplaceBack(...w(k,A,!0))}for(let E=0;E<t.length;++E){const A=l.length,k=t[E]+1+2,D=new _e;for(let V=0;V<k-1;V++){const Z=V===k-2,tt=Z?f*(x-t.length+E-V):f;for(let lt=0;lt<f-1;lt++){const et=V*f+lt;V===0||Z||lt===0||lt===f-2?(D.emplaceBack(et+1,et,et+tt),D.emplaceBack(et+tt,et+tt+1,et+1)):(l.emplaceBack(et+1,et,et+tt),l.emplaceBack(et+tt,et+tt+1,et+1))}}const O=Ui.simpleSegment(0,A,i.length,l.length-A);for(let V=0;V<D.uint16.length;V+=3)l.emplaceBack(D.uint16[V],D.uint16[V+1],D.uint16[V+2]);const B=Ui.simpleSegment(0,A,i.length,l.length-A);h.push({withoutSkirts:O,withSkirts:B})}return{vertices:i,indices:l,segments:h}}_createGrid(e){const t=this._fillGridMeshWithLods(xa,ch);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,lh.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new _e;for(let h=0;h<=xa;h++)t.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const i=new si,l=new si;this._poleSegments=[];for(let h=0,f=0;h<gf;h++){const m=360/(1<<h);i.emplaceBack(0,-tr,0,.5,0),l.emplaceBack(0,-tr,0,.5,1);for(let x=0;x<=xa;x++){const w=x/xa,E=Ue(0,m,w),[A,k,D]=Ml(Rv,Ov,E,tr);i.emplaceBack(A,k,D,w,0),l.emplaceBack(A,k,D,w,1)}this._poleSegments.push(Ui.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,Um,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(l,Um,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}getWirefameBuffers(e,t){if(!this._wireframeSegments){const i=new nn,l=xa,h=l+1+2,f=1;this._wireframeSegments=[];for(let m=0,x=0;m<ch.length;m++){const w=ch[m];for(let A=f;A<w+f;A++)for(let k=f;k<l+f;k++){const D=A*h+k;i.emplaceBack(D,D+1),i.emplaceBack(D,D+h),i.emplaceBack(D,D+h+1)}const E=w*l*3;this._wireframeSegments.push(Ui.simpleSegment(0,x,(w+1)*h,E)),x+=E}this._wireframeIndexBuffer=e.createIndexBuffer(i)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[t]]}},r.GlyphManager=Fl,r.ImagePosition=qf,r.KDBush=a_,r.LivePerformanceUtils=Op,r.LngLat=oi,r.LngLatBounds=_o,r.LocalGlyphMode=Zf,r.MAX_MERCATOR_LATITUDE=_n,r.MercatorCoordinate=Il,r.ONE_EM=ln,r.OverscaledTileID=An,r.PerformanceMarkers=Zr,r.Point=Lt,r.Properties=st,r.RGBAImage=Hn,r.Ray=ff,r.RequestManager=class{constructor(e,t,i){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const e=function(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Dt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(e,t){if(!yt(e))return e;const i=ie(e);return i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeGlyphsURL(e,t){if(!yt(e))return e;const i=ie(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||t)}normalizeSourceURL(e,t,i,l){if(!yt(e))return e;const h=ie(e);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),i&&h.params.push(`language=${i}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||t)}normalizeSpriteURL(e,t,i,l){const h=ie(e);return yt(e)?(h.path=`/styles/v1${h.path}/sprite${t}${i}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${t}${i}`,Kt(h))}normalizeTileURL(e,t,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!yt(e))return e;const l=ie(e);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${t||i&&l.authority!=="raster"&&i===512?"@2x":""}${U.supported?".webp":"$1"}`),l.authority==="raster"?l.path=`/${F.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${F.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(f){for(const m of f){const x=m.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||F.ACCESS_TOKEN;return F.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(e,t){const i=ie(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let l="mapbox://";i.path.match(/^\/raster\/v1\//)?l+=`raster/${i.path.replace(`/${F.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${i.path.replace(`/${F.TILE_URL_VERSION}/`,"")}`;let h=i.params;return t&&(h=h.filter(f=>!f.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(e,t){const i=!!t&&yt(t),l=[];for(const h of e.tiles||[])Tt(h)?l.push(this.canonicalizeTileURL(h,i)):l.push(h);return l}_makeAPIURL(e,t){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",l=ie(F.API_URL);if(e.protocol=l.protocol,e.authority=l.authority,e.protocol==="http"){const h=e.params.indexOf("secure");h>=0&&e.params.splice(h,1)}if(l.path!=="/"&&(e.path=`${l.path}${e.path}`),!F.REQUIRE_ACCESS_TOKEN)return Kt(e);if(t=t||F.ACCESS_TOKEN,!this._silenceAuthErrors){if(!t)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(t[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter(h=>h.indexOf("access_token")===-1),e.params.push(`access_token=${t||""}`),Kt(e)}},r.ResourceType=pr,r.SegmentVector=Ui,r.SourceCache=Sa,r.StencilMode=n_,r.StructArrayLayout1ui2=Wn,r.StructArrayLayout2f1f2i16=xe,r.StructArrayLayout2i4=Zt,r.StructArrayLayout2ui4=nn,r.StructArrayLayout3f12=De,r.StructArrayLayout3ui6=_e,r.StructArrayLayout4i8=jt,r.StructArrayLayout5f20=si,r.Texture=Ph,r.Tile=e_,r.Transitionable=N,r.Uniform1f=nd,r.Uniform1i=class extends Ar{constructor(e){super(e),this.current=0}set(e,t,i){this.fetchUniformLocation(e,t)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},r.Uniform2f=class extends Ar{constructor(e){super(e),this.current=[0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}},r.Uniform3f=class extends Ar{constructor(e){super(e),this.current=[0,0,0]}set(e,t,i){this.fetchUniformLocation(e,t)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}},r.Uniform4f=Sm,r.UniformColor=Mm,r.UniformMatrix2f=class extends Ar{constructor(e){super(e),this.current=xv}set(e,t,i){if(this.fetchUniformLocation(e,t)){for(let l=0;l<4;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}},r.UniformMatrix3f=class extends Ar{constructor(e){super(e),this.current=yv}set(e,t,i){if(this.fetchUniformLocation(e,t)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},r.UniformMatrix4f=class extends Ar{constructor(e){super(e),this.current=gv}set(e,t,i){if(this.fetchUniformLocation(e,t)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let l=1;l<16;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}},r.UnwrappedTileID=Dg,r.ValidationError=ce,r.VectorTileFeature=yd,r.VectorTileWorkerSource=class extends Uo{constructor(e,t,i,l,h){super(),this.actor=e,this.layerIndex=t,this.availableImages=i,this.loadVectorData=h||U0,this.loading={},this.loaded={},this.deduped=new V0(e.scheduler),this.isSpriteLoaded=l,this.scheduler=e.scheduler}loadTile(e,t){const i=e.uid,l=e&&e.request,h=l&&l.collectResourceTiming,f=this.loading[i]=new Uw(e);f.abort=this.loadVectorData(e,(m,x)=>{const w=!this.loading[i];if(delete this.loading[i],w||m||!x)return f.status="done",w||(this.loaded[i]=f),t(m);const E=x.rawData,A={};x.expires&&(A.expires=x.expires),x.cacheControl&&(A.cacheControl=x.cacheControl),f.vectorTile=x.vectorTile||new Nf(new Ed(E));const k=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(D,O)=>{if(D||!O)return t(D);const B={};if(h){const V=rc(l);V.length>0&&(B.resourceTiming=JSON.parse(JSON.stringify(V)))}t(null,_i({rawTileData:E.slice(0)},O,A,B))})};this.isSpriteLoaded?k():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(k,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):k()}),this.loaded=this.loaded||{},this.loaded[i]=f})}reloadTile(e,t){const i=this.loaded,l=e.uid,h=this;if(i&&i[l]){const f=i[l];f.showCollisionBoxes=e.showCollisionBoxes,f.enableTerrain=!!e.enableTerrain,f.projection=e.projection,f.tileTransform=Ea(e.tileID.canonical,e.projection);const m=(x,w)=>{const E=f.reloadCallback;E&&(delete f.reloadCallback,f.parse(f.vectorTile,h.layerIndex,this.availableImages,h.actor,E)),t(x,w)};f.status==="parsing"?f.reloadCallback=m:f.status==="done"&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}}abortTile(e,t){const i=e.uid,l=this.loading[i];l&&(l.abort&&l.abort(),delete this.loading[i]),t()}removeTile(e,t){const i=this.loaded,l=e.uid;i&&i[l]&&delete i[l],t()}},r.WritingMode=rs,r.ZoomDependentExpression=oa,r.add=Ir,r.addDynamicAttributes=zd,r.adjoint=function(e,t){var i=t[0],l=t[1],h=t[2],f=t[3],m=t[4],x=t[5],w=t[6],E=t[7],A=t[8];return e[0]=m*A-x*E,e[1]=h*E-l*A,e[2]=l*x-h*m,e[3]=x*w-f*A,e[4]=i*A-h*w,e[5]=h*f-i*x,e[6]=f*E-m*w,e[7]=l*w-i*E,e[8]=i*m-l*f,e},r.asyncAll=ki,r.bezier=ei,r.bindAll=ur,r.boundsAttributes=E0,r.bufferConvexPolygon=function(e,t){const i=[];for(let l=0;l<e.length;l++){const h=vi(l-1,-1,e.length-1),f=vi(l+1,-1,e.length-1),m=e[l],x=e[f],w=e[h].sub(m).unit(),E=x.sub(m).unit(),A=E.angleWithSep(w.x,w.y),k=w.add(E).unit().mult(-1*t/Math.sin(A/2));i.push(m.add(k))}return i},r.cacheEntryPossiblyAdded=function(e){jo++,jo>Wa&&(e.getActor().send("enforceCacheSizeLimit",$a),jo=0)},r.calculateGlobeLabelMatrix=function(e,t){const{x:i,y:l}=e.point,h=Xm(i,l,e.worldSize/e._pixelsPerMercatorPixel,0,0);return ma(h,h,vf(er(t)))},r.calculateGlobeMatrix=function(e){const{x:t,y:i}=e.point,{lng:l,lat:h}=e._center;return Xm(t,i,e.worldSize,l,h)},r.calculateGlobeMercatorMatrix=function(e){const t=e.pixelsPerMeter,i=t/Ns(1,e.center.lat),l=Bs(new Float64Array(16));return ih(l,l,[e.point.x,e.point.y,0]),ga(l,l,[i,i,t]),Float32Array.from(l)},r.circumferenceAtLatitude=wf,r.clamp=be,r.clearTileCache=function(e){if(!No())return;const t=T.caches.delete(qr);e&&t.catch(e).then(()=>e())},r.clipLine=o0,r.clone=function(e){var t=new Zn(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},r.clone$1=zn,r.collisionCircleLayout=jb,r.config=F,r.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},r.create=function(){var e=new Zn(16);return Zn!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},r.create$1=Im,r.createExpression=ao,r.createLayout=xt,r.createStyleLayer=function(e){return e.type==="custom"?new kw(e):new Lw[e.type](e)},r.cross=pf,r.degToRad=fe,r.distance=function(e,t){return Math.hypot(t[0]-e[0],t[1]-e[1],t[2]-e[2])},r.div=function(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e},r.dot=ms,r.earthRadius=dh,r.ease=xi,r.easeCubicInOut=Ke,r.ecefToLatLng=function([e,t,i]){const l=Math.hypot(e,t,i),h=Math.atan2(e,i),f=.5*Math.PI-Math.acos(-t/l);return new oi(Ge(h),Ge(f))},r.emitValidationErrors=Ku,r.endsWith=Vr,r.enforceCacheSizeLimit=function(e){dr(),Vn&&Vn.then(t=>{t.keys().then(i=>{for(let l=0;l<i.length-e;l++)t.delete(i[l])})})},r.evaluateSizeForFeature=wd,r.evaluateSizeForZoom=zl,r.evaluateVariableOffset=u0,r.evented=y,r.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},r.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},r.exported=Es,r.exported$1=U,r.extend=_i,r.extend$1=Ms,r.fillExtrusionHeightLift=Ig,r.filterObject=Ur,r.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},r.fromQuat=function(e,t){var i=t[0],l=t[1],h=t[2],f=t[3],m=i+i,x=l+l,w=h+h,E=i*m,A=l*m,k=l*x,D=h*m,O=h*x,B=h*w,V=f*m,Z=f*x,tt=f*w;return e[0]=1-k-B,e[1]=A+tt,e[2]=D-Z,e[3]=0,e[4]=A-tt,e[5]=1-E-B,e[6]=O+V,e[7]=0,e[8]=D+Z,e[9]=O-V,e[10]=1-E-k,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},r.fromRotation=function(e,t){var i=Math.sin(t),l=Math.cos(t);return e[0]=l,e[1]=i,e[2]=0,e[3]=-i,e[4]=l,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},r.fromScaling=km,r.furthestTileCorner=function(e){const t=Math.round((e+45+360)%360/90)%4;return on[t]},r.getAABBPointSquareDist=function(e,t,i){let l=0;for(let h=0;h<2;++h){const f=i?i[h]:0;e[h]>f&&(l+=(e[h]-f)*(e[h]-f)),t[h]<f&&(l+=(f-t[h])*(f-t[h]))}return l},r.getAnchorAlignment=Wf,r.getAnchorJustification=Xf,r.getBounds=function(e){let t=1/0,i=1/0,l=-1/0,h=-1/0;for(const f of e)t=Math.min(t,f.x),i=Math.min(i,f.y),l=Math.max(l,f.x),h=Math.max(h,f.y);return{min:new Lt(t,i),max:new Lt(l,h)}},r.getColumn=Hs,r.getDefaultExportFromCjs=Ft,r.getGridMatrix=function(e,t,i,l){const h=t.getNorth(),f=t.getSouth(),m=t.getWest(),x=t.getEast(),w=1<<e.z,E=x-m,A=h-f,k=E/xa,D=-A/ch[i],O=[0,k,0,D,0,0,h,m,0];if(e.z>0){const B=180/l;Pm(O,O,[B/E+1,0,0,0,B/A+1,0,-.5*B/k,.5*B/D,1])}return O[2]=w,O[5]=e.x,O[8]=e.y,O},r.getImage=rt,r.getJSON=function(e,t){return _r(_i(e,{type:"json"}),t)},r.getLatitudinalLod=function(e){const t=_n-5;e=be(e,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(fe(e))),3);return Math.round(i*(ch.length-1))},r.getMapSessionAPI=Qi,r.getPerformanceMeasurement=rc,r.getProjection=x0,r.getRTLTextPluginStatus=b,r.getReferrer=fr,r.getTilePoint=function(e,{x:t,y:i},l=0){return new Lt(((t-l)*e.scale-e.x)*ye,(i*e.scale-e.y)*ye)},r.getTileVec3=function(e,t,i=0){return Sl(((t.x-i)*e.scale-e.x)*ye,(t.y*e.scale-e.y)*ye,Qm(t.z,t.y))},r.getVideo=function(e,t){const i=T.document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let l=0;l<e.length;l++){const h=T.document.createElement("source");Za(e[l])||(i.crossOrigin="Anonymous"),h.src=e[l],i.appendChild(h)}return{cancel:()=>{}}},r.globeCenterToScreenPoint=function(e){const t=[0,0,0],i=Bs(new Float64Array(16));return ma(i,e.pixelMatrix,e.globeMatrix),Fi(t,t,i),new Lt(t[0],t[1])},r.globeDenormalizeECEF=vf,r.globeECEFOrigin=function(e,t){const i=[0,0,0];return Fi(i,i,uh(er(t.canonical))),Fi(i,i,e),i},r.globeMetersToEcef=od,r.globeNormalizeECEF=uh,r.globePixelsToTileUnits=function(e,t){return ye/(512*Math.pow(2,e))*ld(er(t))},r.globePoleMatrixForTile=function(e,t,i){const l=Bs(new Float64Array(16)),h=(t/(1<<e)-.5)*Math.PI*2;return rd(l,i.globeMatrix,h),Float32Array.from(l)},r.globeTileBounds=er,r.globeTiltAtLngLat=Ym,r.globeToMercatorTransition=Cl,r.globeUseCustomAntiAliasing=function(e,t,i){const l=Cl(i.zoom),h=e.style.map._antialias,f=!!t.extStandardDerivatives,m=t.extStandardDerivativesForceOff||e.terrain&&e.terrain.exaggeration()>0;return l===0&&!h&&!m&&f},r.identity=Bs,r.identity$1=Nm,r.invert=cf,r.isFullscreen=function(){return!!T.document.fullscreenElement||!!T.document.webkitFullscreenElement},r.isLngLatBehindGlobe=bf,r.isMapAuthenticated=function(e){return yn.has(e)},r.isMapboxURL=yt,r.isSafariWithAntialiasingBug=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!Gr(e)&&t&&(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.latFromMercatorY=fn,r.latLngToECEF=Al,r.len=Cv,r.length=nh,r.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},r.lngFromMercatorX=ss,r.loadVectorTile=U0,r.makeRequest=_r,r.mapValue=function(e,t,i,l,h){return be((e-t)/(i-t)*(h-l)+l,l,h)},r.mercatorScale=tg,r.mercatorXfromLng=ir,r.mercatorYfromLat=nr,r.mercatorZfromAltitude=Ns,r.mul=Mv,r.mul$1=Av,r.multiply=ma,r.multiply$1=Pm,r.multiply$2=zm,r.nextPowerOfTwo=ws,r.normalize=Sn,r.normalize$1=Iv,r.normalize$2=Bm,r.number=Ue,r.ortho=function(e,t,i,l,h,f,m){var x=1/(t-i),w=1/(l-h),E=1/(f-m);return e[0]=-2*x,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*w,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*E,e[11]=0,e[12]=(t+i)*x,e[13]=(h+l)*w,e[14]=(m+f)*E,e[15]=1,e},r.pbf=Ng,r.perspective=function(e,t,i,l,h){var f,m=1/Math.tan(t/2);return e[0]=m/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=m,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,h!=null&&h!==1/0?(e[10]=(h+l)*(f=1/(l-h)),e[14]=2*h*l*f):(e[10]=-1,e[14]=-2*l),e},r.pick=function(e,t){const i={};for(let l=0;l<t.length;l++){const h=t[l];h in e&&(i[h]=e[h])}return i},r.plugin=M,r.pointGeometry=ne,r.polesInViewport=function(e){const t=Bs(new Float64Array(16));ma(t,e.pixelMatrix,e.globeMatrix);const i=[0,gs,0],l=[0,ys,0];return Fi(i,i,t),Fi(l,l,t),[i[0]>0&&i[0]<=e.width&&i[1]>0&&i[1]<=e.height&&!bf(e,new oi(e.center.lat,90)),l[0]>0&&l[0]<=e.width&&l[1]>0&&l[1]<=e.height&&!bf(e,new oi(e.center.lat,-90))]},r.polygonContainsPoint=wa,r.polygonIntersectsBox=ag,r.polygonIntersectsPolygon=ng,r.polygonizeBounds=function(e,t,i=0,l=!0){const h=new Lt(i,i),f=e.sub(h),m=t.add(h),x=[f,new Lt(m.x,f.y),m,new Lt(f.x,m.y)];return l&&x.push(f.clone()),x},r.posAttributes=lh,r.postMapLoadEvent=Ni,r.postPerformanceEvent=Hi,r.postTurnstileEvent=je,r.potpack=Gf,r.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},r.radToDeg=Ge,r.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.registerForPluginStateChange=function(e){return e({pluginStatus:d,pluginURL:n}),y.on("pluginStateChange",e),e},r.removeAuthState=function(e){yn.delete(e)},r.renderColorRamp=Pf,r.resample=eg,r.rotateX=hf,r.rotateX$1=jm,r.rotateY=rd,r.rotateY$1=Vm,r.rotateZ=function(e,t,i){var l=Math.sin(i),h=Math.cos(i),f=t[0],m=t[1],x=t[2],w=t[3],E=t[4],A=t[5],k=t[6],D=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=f*h+E*l,e[1]=m*h+A*l,e[2]=x*h+k*l,e[3]=w*h+D*l,e[4]=E*h-f*l,e[5]=A*h-m*l,e[6]=k*h-x*l,e[7]=D*h-w*l,e},r.rotateZ$1=function(e,t,i){i*=.5;var l=t[0],h=t[1],f=t[2],m=t[3],x=Math.sin(i),w=Math.cos(i);return e[0]=l*w+h*x,e[1]=h*w-l*x,e[2]=f*w+m*x,e[3]=m*w-f*x,e},r.scale=ga,r.scale$1=Om,r.scale$2=ns,r.scaleAndAdd=oh,r.set=function(e,t,i,l){return e[0]=t,e[1]=i,e[2]=l,e},r.setCacheLimits=function(e,t){$a=e,Wa=t},r.setColumn=function(e,t,i){e[4*t+0]=i[0],e[4*t+1]=i[1],e[4*t+2]=i[2],e[4*t+3]=i[3]},r.setRTLTextPlugin=function(e,t,i=!1){if(d===Kc||d===Jc||d===Qc)throw new Error("setRTLTextPlugin cannot be called multiple times.");n=Es.resolveURL(e),d=Kc,uo=t,_(),i||S()},r.smoothstep=Pi,r.spec=Ot,r.squaredLength=function(e){var t=e[0],i=e[1],l=e[2];return t*t+i*i+l*l},r.storeAuthState=function(e,t){t?yn.add(e):yn.delete(e)},r.sub=Fs,r.subtract=df,r.symbolSize=Vb,r.tileAABB=function(e,t,i,l,h,f,m,x,w){if(w.name==="globe")return zv(e,t,new vd(i,l,h));const E=Ea({z:i,x:l,y:h},w);return new Mn([(f+E.x/E.scale)*t,t*(E.y/E.scale),m],[(f+E.x2/E.scale)*t,t*(E.y2/E.scale),x])},r.tileCornersToBounds=ad,r.tileTransform=Ea,r.transformMat3=function(e,t,i){var l=t[0],h=t[1],f=t[2];return e[0]=l*i[0]+h*i[3]+f*i[6],e[1]=l*i[1]+h*i[4]+f*i[7],e[2]=l*i[2]+h*i[5]+f*i[8],e},r.transformMat4=Fi,r.transformMat4$1=ya,r.transformQuat=Rm,r.transitionTileAABBinECEF=Wm,r.translate=ih,r.transpose=function(e,t){if(e===t){var i=t[1],l=t[2],h=t[5];e[1]=t[3],e[2]=t[6],e[3]=i,e[5]=t[7],e[6]=l,e[7]=h}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},r.triggerPluginCompletionEvent=c,r.uniqueId=Nn,r.updateGlobeVertexNormal=function(e,t,i,l,h){const f=5*t+2;e.float32[f+0]=i,e.float32[f+1]=l,e.float32[f+2]=h},r.validateCustomStyleLayer=function(e){const t=[],i=e.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),e.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},r.validateFilter=e=>$n(ua(e)),r.validateFog=e=>$n(Hu(e)),r.validateLayer=e=>$n(qu(e)),r.validateLight=e=>$n(Zu(e)),r.validateSource=e=>$n(Wu(e)),r.validateStyle=Yu,r.validateTerrain=e=>$n(Wc(e)),r.values=gn,r.vectorTile=gd,r.version=I,r.warnOnce=Ei,r.window=T,r.wrap=vi}),g(["./shared"],function(r){function T(at){if(typeof at=="number"||typeof at=="boolean"||typeof at=="string"||at==null)return JSON.stringify(at);if(Array.isArray(at)){let q="[";for(const rt of at)q+=`${T(rt)},`;return`${q}]`}let G="{";for(const q of Object.keys(at).sort())G+=`${q}:${T(at[q])},`;return`${G}}`}function I(at){let G="";for(const q of r.refProperties)G+=`/${T(at[q])}`;return G}class R{constructor(G){this.keyCache={},G&&this.replace(G)}replace(G){this._layerConfigs={},this._layers={},this.update(G,[])}update(G,q){for(const pt of G)this._layerConfigs[pt.id]=pt,(this._layers[pt.id]=r.createStyleLayer(pt)).compileFilter(),this.keyCache[pt.id]&&delete this.keyCache[pt.id];for(const pt of q)delete this.keyCache[pt],delete this._layerConfigs[pt],delete this._layers[pt];this.familiesBySource={};const rt=function(pt,yt){const Tt={};for(let gt=0;gt<pt.length;gt++){const kt=yt&&yt[pt[gt].id]||I(pt[gt]);yt&&(yt[pt[gt].id]=kt);let ee=Tt[kt];ee||(ee=Tt[kt]=[]),ee.push(pt[gt])}const wt=[];for(const gt in Tt)wt.push(Tt[gt]);return wt}(r.values(this._layerConfigs),this.keyCache);for(const pt of rt){const yt=pt.map(ie=>this._layers[ie.id]),Tt=yt[0];if(Tt.visibility==="none")continue;const wt=Tt.source||"";let gt=this.familiesBySource[wt];gt||(gt=this.familiesBySource[wt]={});const kt=Tt.sourceLayer||"_geojsonTileLayer";let ee=gt[kt];ee||(ee=gt[kt]=[]),ee.push(yt)}}}class F{loadTile(G,q){const{uid:rt,encoding:pt,rawImageData:yt,padding:Tt,buildQuadTree:wt}=G,gt=r.window.ImageBitmap&&yt instanceof r.window.ImageBitmap?this.getImageData(yt,Tt):yt;q(null,new r.DEMData(rt,gt,pt,Tt<1,wt))}getImageData(G,q){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(G.width,G.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=G.width,this.offscreenCanvas.height=G.height,this.offscreenCanvasContext.drawImage(G,0,0,G.width,G.height);const rt=this.offscreenCanvasContext.getImageData(-q,-q,G.width+2*q,G.height+2*q);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),rt}}function U(at,G){if(at.length!==0){Y(at[0],G);for(var q=1;q<at.length;q++)Y(at[q],!G)}}function Y(at,G){for(var q=0,rt=0,pt=0,yt=at.length,Tt=yt-1;pt<yt;Tt=pt++){var wt=(at[pt][0]-at[Tt][0])*(at[Tt][1]+at[pt][1]),gt=q+wt;rt+=Math.abs(q)>=Math.abs(wt)?q-gt+wt:wt-gt+q,q=gt}q+rt>=0!=!!G&&at.reverse()}var it=r.getDefaultExportFromCjs(function at(G,q){var rt,pt=G&&G.type;if(pt==="FeatureCollection")for(rt=0;rt<G.features.length;rt++)at(G.features[rt],q);else if(pt==="GeometryCollection")for(rt=0;rt<G.geometries.length;rt++)at(G.geometries[rt],q);else if(pt==="Feature")at(G.geometry,q);else if(pt==="Polygon")U(G.coordinates,q);else if(pt==="MultiPolygon")for(rt=0;rt<G.coordinates.length;rt++)U(G.coordinates[rt],q);return G});const ct=r.VectorTileFeature.prototype.toGeoJSON;var ht={exports:{}},bt=r.pointGeometry,Dt=r.vectorTile.VectorTileFeature,Ft=Wt;function Wt(at,G){this.options=G||{},this.features=at,this.length=at.length}function Rt(at,G){this.id=typeof at.id=="number"?at.id:void 0,this.type=at.type,this.rawGeometry=at.type===1?[at.geometry]:at.geometry,this.properties=at.tags,this.extent=G||4096}Wt.prototype.feature=function(at){return new Rt(this.features[at],this.options.extent)},Rt.prototype.loadGeometry=function(){var at=this.rawGeometry;this.geometry=[];for(var G=0;G<at.length;G++){for(var q=at[G],rt=[],pt=0;pt<q.length;pt++)rt.push(new bt(q[pt][0],q[pt][1]));this.geometry.push(rt)}return this.geometry},Rt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var at=this.geometry,G=1/0,q=-1/0,rt=1/0,pt=-1/0,yt=0;yt<at.length;yt++)for(var Tt=at[yt],wt=0;wt<Tt.length;wt++){var gt=Tt[wt];G=Math.min(G,gt.x),q=Math.max(q,gt.x),rt=Math.min(rt,gt.y),pt=Math.max(pt,gt.y)}return[G,rt,q,pt]},Rt.prototype.toGeoJSON=Dt.prototype.toGeoJSON;var Jt=r.pbf,ne=Ft;function se(at){var G=new Jt;return function(q,rt){for(var pt in q.layers)rt.writeMessage(3,Lt,q.layers[pt])}(at,G),G.finish()}function Lt(at,G){var q;G.writeVarintField(15,at.version||1),G.writeStringField(1,at.name||""),G.writeVarintField(5,at.extent||4096);var rt={keys:[],values:[],keycache:{},valuecache:{}};for(q=0;q<at.length;q++)rt.feature=at.feature(q),G.writeMessage(2,Le,rt);var pt=rt.keys;for(q=0;q<pt.length;q++)G.writeStringField(3,pt[q]);var yt=rt.values;for(q=0;q<yt.length;q++)G.writeMessage(4,Ke,yt[q])}function Le(at,G){var q=at.feature;q.id!==void 0&&G.writeVarintField(1,q.id),G.writeMessage(2,ze,at),G.writeVarintField(3,q.type),G.writeMessage(4,on,q)}function ze(at,G){var q=at.feature,rt=at.keys,pt=at.values,yt=at.keycache,Tt=at.valuecache;for(var wt in q.properties){var gt=q.properties[wt],kt=yt[wt];if(gt!==null){kt===void 0&&(rt.push(wt),yt[wt]=kt=rt.length-1),G.writeVarint(kt);var ee=typeof gt;ee!=="string"&&ee!=="boolean"&&ee!=="number"&&(gt=JSON.stringify(gt));var ie=ee+":"+gt,Kt=Tt[ie];Kt===void 0&&(pt.push(gt),Tt[ie]=Kt=pt.length-1),G.writeVarint(Kt)}}}function fe(at,G){return(G<<3)+(7&at)}function Ge(at){return at<<1^at>>31}function on(at,G){for(var q=at.loadGeometry(),rt=at.type,pt=0,yt=0,Tt=q.length,wt=0;wt<Tt;wt++){var gt=q[wt],kt=1;rt===1&&(kt=gt.length),G.writeVarint(fe(1,kt));for(var ee=rt===3?gt.length-1:gt.length,ie=0;ie<ee;ie++){ie===1&&rt!==1&&G.writeVarint(fe(2,ee-1));var Kt=gt[ie].x-pt,Me=gt[ie].y-yt;G.writeVarint(Ge(Kt)),G.writeVarint(Ge(Me)),pt+=Kt,yt+=Me}rt===3&&G.writeVarint(fe(7,1))}}function Ke(at,G){var q=typeof at;q==="string"?G.writeStringField(1,at):q==="boolean"?G.writeBooleanField(7,at):q==="number"&&(at%1!=0?G.writeDoubleField(3,at):at<0?G.writeSVarintField(6,at):G.writeVarintField(5,at))}ht.exports=se,ht.exports.fromVectorTileJs=se,ht.exports.fromGeojsonVt=function(at,G){G=G||{};var q={};for(var rt in at)q[rt]=new ne(at[rt].features,G),q[rt].name=rt,q[rt].version=G.version,q[rt].extent=G.extent;return se({layers:q})},ht.exports.GeoJSONWrapper=ne;var ei=r.getDefaultExportFromCjs(ht.exports);const xi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:at=>at},be=Math.fround||(Pi=new Float32Array(1),at=>(Pi[0]=+at,Pi[0]));var Pi;const vi=3,ki=5,gn=6;class _i{constructor(G){this.options=Object.assign(Object.create(xi),G),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(G){const{log:q,minZoom:rt,maxZoom:pt}=this.options;q&&console.time("total time");const yt=`prepare ${G.length} points`;q&&console.time(yt),this.points=G;const Tt=[];for(let gt=0;gt<G.length;gt++){const kt=G[gt];if(!kt.geometry)continue;const[ee,ie]=kt.geometry.coordinates,Kt=be(bn(ee)),Me=be(ws(ie));Tt.push(Kt,Me,1/0,gt,-1,1),this.options.reduce&&Tt.push(0)}let wt=this.trees[pt+1]=this._createTree(Tt);q&&console.timeEnd(yt);for(let gt=pt;gt>=rt;gt--){const kt=+Date.now();wt=this.trees[gt]=this._createTree(this._cluster(wt,gt)),q&&console.log("z%d: %d clusters in %dms",gt,wt.numItems,+Date.now()-kt)}return q&&console.timeEnd("total time"),this}getClusters(G,q){let rt=((G[0]+180)%360+360)%360-180;const pt=Math.max(-90,Math.min(90,G[1]));let yt=G[2]===180?180:((G[2]+180)%360+360)%360-180;const Tt=Math.max(-90,Math.min(90,G[3]));if(G[2]-G[0]>=360)rt=-180,yt=180;else if(rt>yt){const ie=this.getClusters([rt,pt,180,Tt],q),Kt=this.getClusters([-180,pt,yt,Tt],q);return ie.concat(Kt)}const wt=this.trees[this._limitZoom(q)],gt=wt.range(bn(rt),ws(Tt),bn(yt),ws(pt)),kt=wt.data,ee=[];for(const ie of gt){const Kt=this.stride*ie;ee.push(kt[Kt+ki]>1?vn(kt,Kt,this.clusterProps):this.points[kt[Kt+vi]])}return ee}getChildren(G){const q=this._getOriginId(G),rt=this._getOriginZoom(G),pt="No cluster with the specified id.",yt=this.trees[rt];if(!yt)throw new Error(pt);const Tt=yt.data;if(q*this.stride>=Tt.length)throw new Error(pt);const wt=this.options.radius/(this.options.extent*Math.pow(2,rt-1)),gt=yt.within(Tt[q*this.stride],Tt[q*this.stride+1],wt),kt=[];for(const ee of gt){const ie=ee*this.stride;Tt[ie+4]===G&&kt.push(Tt[ie+ki]>1?vn(Tt,ie,this.clusterProps):this.points[Tt[ie+vi]])}if(kt.length===0)throw new Error(pt);return kt}getLeaves(G,q,rt){const pt=[];return this._appendLeaves(pt,G,q=q||10,rt=rt||0,0),pt}getTile(G,q,rt){const pt=this.trees[this._limitZoom(G)],yt=Math.pow(2,G),{extent:Tt,radius:wt}=this.options,gt=wt/Tt,kt=(rt-gt)/yt,ee=(rt+1+gt)/yt,ie={features:[]};return this._addTileFeatures(pt.range((q-gt)/yt,kt,(q+1+gt)/yt,ee),pt.data,q,rt,yt,ie),q===0&&this._addTileFeatures(pt.range(1-gt/yt,kt,1,ee),pt.data,yt,rt,yt,ie),q===yt-1&&this._addTileFeatures(pt.range(0,kt,gt/yt,ee),pt.data,-1,rt,yt,ie),ie.features.length?ie:null}getClusterExpansionZoom(G){let q=this._getOriginZoom(G)-1;for(;q<=this.options.maxZoom;){const rt=this.getChildren(G);if(q++,rt.length!==1)break;G=rt[0].properties.cluster_id}return q}_appendLeaves(G,q,rt,pt,yt){const Tt=this.getChildren(q);for(const wt of Tt){const gt=wt.properties;if(gt&&gt.cluster?yt+gt.point_count<=pt?yt+=gt.point_count:yt=this._appendLeaves(G,gt.cluster_id,rt,pt,yt):yt<pt?yt++:G.push(wt),G.length===rt)break}return yt}_createTree(G){const q=new r.KDBush(G.length/this.stride|0,this.options.nodeSize,Float32Array);for(let rt=0;rt<G.length;rt+=this.stride)q.add(G[rt],G[rt+1]);return q.finish(),q.data=G,q}_addTileFeatures(G,q,rt,pt,yt,Tt){for(const wt of G){const gt=wt*this.stride,kt=q[gt+ki]>1;let ee,ie,Kt;if(kt)ee=Nn(q,gt,this.clusterProps),ie=q[gt],Kt=q[gt+1];else{const Ae=this.points[q[gt+vi]];ee=Ae.properties;const[ke,je]=Ae.geometry.coordinates;ie=bn(ke),Kt=ws(je)}const Me={type:1,geometry:[[Math.round(this.options.extent*(ie*yt-rt)),Math.round(this.options.extent*(Kt*yt-pt))]],tags:ee};let Pe;Pe=kt||this.options.generateId?q[gt+vi]:this.points[q[gt+vi]].id,Pe!==void 0&&(Me.id=Pe),Tt.features.push(Me)}}_limitZoom(G){return Math.max(this.options.minZoom,Math.min(Math.floor(+G),this.options.maxZoom+1))}_cluster(G,q){const{radius:rt,extent:pt,reduce:yt,minPoints:Tt}=this.options,wt=rt/(pt*Math.pow(2,q)),gt=G.data,kt=[],ee=this.stride;for(let ie=0;ie<gt.length;ie+=ee){if(gt[ie+2]<=q)continue;gt[ie+2]=q;const Kt=gt[ie],Me=gt[ie+1],Pe=G.within(gt[ie],gt[ie+1],wt),Ae=gt[ie+ki];let ke=Ae;for(const je of Pe){const Si=je*ee;gt[Si+2]>q&&(ke+=gt[Si+ki])}if(ke>Ae&&ke>=Tt){let je,Si=Kt*Ae,Ni=Me*Ae,un=-1;const Hi=((ie/ee|0)<<5)+(q+1)+this.points.length;for(const cs of Pe){const Qi=cs*ee;if(gt[Qi+2]<=q)continue;gt[Qi+2]=q;const yn=gt[Qi+ki];Si+=gt[Qi]*yn,Ni+=gt[Qi+1]*yn,gt[Qi+4]=Hi,yt&&(je||(je=this._map(gt,ie,!0),un=this.clusterProps.length,this.clusterProps.push(je)),yt(je,this._map(gt,Qi)))}gt[ie+4]=Hi,kt.push(Si/ke,Ni/ke,1/0,Hi,-1,ke),yt&&kt.push(un)}else{for(let je=0;je<ee;je++)kt.push(gt[ie+je]);if(ke>1)for(const je of Pe){const Si=je*ee;if(!(gt[Si+2]<=q)){gt[Si+2]=q;for(let Ni=0;Ni<ee;Ni++)kt.push(gt[Si+Ni])}}}}return kt}_getOriginId(G){return G-this.points.length>>5}_getOriginZoom(G){return(G-this.points.length)%32}_map(G,q,rt){if(G[q+ki]>1){const Tt=this.clusterProps[G[q+gn]];return rt?Object.assign({},Tt):Tt}const pt=this.points[G[q+vi]].properties,yt=this.options.map(pt);return rt&&yt===pt?Object.assign({},yt):yt}}function vn(at,G,q){return{type:"Feature",id:at[G+vi],properties:Nn(at,G,q),geometry:{type:"Point",coordinates:[(rt=at[G],360*(rt-.5)),Ga(at[G+1])]}};var rt}function Nn(at,G,q){const rt=at[G+ki],pt=rt>=1e4?`${Math.round(rt/1e3)}k`:rt>=1e3?Math.round(rt/100)/10+"k":rt,yt=at[G+gn],Tt=yt===-1?{}:Object.assign({},q[yt]);return Object.assign(Tt,{cluster:!0,cluster_id:at[G+vi],point_count:rt,point_count_abbreviated:pt})}function bn(at){return at/360+.5}function ws(at){const G=Math.sin(at*Math.PI/180),q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return q<0?0:q>1?1:q}function Ga(at){const G=(180-360*at)*Math.PI/180;return 360*Math.atan(Math.exp(G))/Math.PI-90}function ur(at,G,q,rt){for(var pt,yt=rt,Tt=q-G>>1,wt=q-G,gt=at[G],kt=at[G+1],ee=at[q],ie=at[q+1],Kt=G+3;Kt<q;Kt+=3){var Me=Vr(at[Kt],at[Kt+1],gt,kt,ee,ie);if(Me>yt)pt=Kt,yt=Me;else if(Me===yt){var Pe=Math.abs(Kt-Tt);Pe<wt&&(pt=Kt,wt=Pe)}}yt>rt&&(pt-G>3&&ur(at,G,pt,rt),at[pt+2]=yt,q-pt>3&&ur(at,pt,q,rt))}function Vr(at,G,q,rt,pt,yt){var Tt=pt-q,wt=yt-rt;if(Tt!==0||wt!==0){var gt=((at-q)*Tt+(G-rt)*wt)/(Tt*Tt+wt*wt);gt>1?(q=pt,rt=yt):gt>0&&(q+=Tt*gt,rt+=wt*gt)}return(Tt=at-q)*Tt+(wt=G-rt)*wt}function Ne(at,G,q,rt){var pt={id:at===void 0?null:at,type:G,geometry:q,tags:rt,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(yt){var Tt=yt.geometry,wt=yt.type;if(wt==="Point"||wt==="MultiPoint"||wt==="LineString")Ur(yt,Tt);else if(wt==="Polygon"||wt==="MultiLineString")for(var gt=0;gt<Tt.length;gt++)Ur(yt,Tt[gt]);else if(wt==="MultiPolygon")for(gt=0;gt<Tt.length;gt++)for(var kt=0;kt<Tt[gt].length;kt++)Ur(yt,Tt[gt][kt])}(pt),pt}function Ur(at,G){for(var q=0;q<G.length;q+=3)at.minX=Math.min(at.minX,G[q]),at.minY=Math.min(at.minY,G[q+1]),at.maxX=Math.max(at.maxX,G[q]),at.maxY=Math.max(at.maxY,G[q+1])}function zn(at,G,q,rt){if(G.geometry){var pt=G.geometry.coordinates,yt=G.geometry.type,Tt=Math.pow(q.tolerance/((1<<q.maxZoom)*q.extent),2),wt=[],gt=G.id;if(q.promoteId?gt=G.properties[q.promoteId]:q.generateId&&(gt=rt||0),yt==="Point")Oo(pt,wt);else if(yt==="MultiPoint")for(var kt=0;kt<pt.length;kt++)Oo(pt[kt],wt);else if(yt==="LineString")Ei(pt,wt,Tt,!1);else if(yt==="MultiLineString"){if(q.lineMetrics){for(kt=0;kt<pt.length;kt++)Ei(pt[kt],wt=[],Tt,!1),at.push(Ne(gt,"LineString",wt,G.properties));return}jn(pt,wt,Tt,!1)}else if(yt==="Polygon")jn(pt,wt,Tt,!0);else{if(yt!=="MultiPolygon"){if(yt==="GeometryCollection"){for(kt=0;kt<G.geometry.geometries.length;kt++)zn(at,{id:gt,geometry:G.geometry.geometries[kt],properties:G.properties},q,rt);return}throw new Error("Input data is not a valid GeoJSON object.")}for(kt=0;kt<pt.length;kt++){var ee=[];jn(pt[kt],ee,Tt,!0),wt.push(ee)}}at.push(Ne(gt,yt,wt,G.properties))}}function Oo(at,G){G.push(qa(at[0])),G.push(Ts(at[1])),G.push(0)}function Ei(at,G,q,rt){for(var pt,yt,Tt=0,wt=0;wt<at.length;wt++){var gt=qa(at[wt][0]),kt=Ts(at[wt][1]);G.push(gt),G.push(kt),G.push(0),wt>0&&(Tt+=rt?(pt*kt-gt*yt)/2:Math.sqrt(Math.pow(gt-pt,2)+Math.pow(kt-yt,2))),pt=gt,yt=kt}var ee=G.length-3;G[2]=1,ur(G,0,ee,q),G[ee+2]=1,G.size=Math.abs(Tt),G.start=0,G.end=G.size}function jn(at,G,q,rt){for(var pt=0;pt<at.length;pt++){var yt=[];Ei(at[pt],yt,q,rt),G.push(yt)}}function qa(at){return at/360+.5}function Ts(at){var G=Math.sin(at*Math.PI/180),q=.5-.25*Math.log((1+G)/(1-G))/Math.PI;return q<0?0:q>1?1:q}function Rn(at,G,q,rt,pt,yt,Tt,wt){if(rt/=G,yt>=(q/=G)&&Tt<rt)return at;if(Tt<q||yt>=rt)return null;for(var gt=[],kt=0;kt<at.length;kt++){var ee=at[kt],ie=ee.geometry,Kt=ee.type,Me=pt===0?ee.minX:ee.minY,Pe=pt===0?ee.maxX:ee.maxY;if(Me>=q&&Pe<rt)gt.push(ee);else if(!(Pe<q||Me>=rt)){var Ae=[];if(Kt==="Point"||Kt==="MultiPoint")Bo(ie,Ae,q,rt,pt);else if(Kt==="LineString")Gr(ie,Ae,q,rt,pt,!1,wt.lineMetrics);else if(Kt==="MultiLineString")Hs(ie,Ae,q,rt,pt,!1);else if(Kt==="Polygon")Hs(ie,Ae,q,rt,pt,!0);else if(Kt==="MultiPolygon")for(var ke=0;ke<ie.length;ke++){var je=[];Hs(ie[ke],je,q,rt,pt,!0),je.length&&Ae.push(je)}if(Ae.length){if(wt.lineMetrics&&Kt==="LineString"){for(ke=0;ke<Ae.length;ke++)gt.push(Ne(ee.id,Kt,Ae[ke],ee.tags));continue}Kt!=="LineString"&&Kt!=="MultiLineString"||(Ae.length===1?(Kt="LineString",Ae=Ae[0]):Kt="MultiLineString"),Kt!=="Point"&&Kt!=="MultiPoint"||(Kt=Ae.length===3?"Point":"MultiPoint"),gt.push(Ne(ee.id,Kt,Ae,ee.tags))}}}return gt.length?gt:null}function Bo(at,G,q,rt,pt){for(var yt=0;yt<at.length;yt+=3){var Tt=at[yt+pt];Tt>=q&&Tt<=rt&&(G.push(at[yt]),G.push(at[yt+1]),G.push(at[yt+2]))}}function Gr(at,G,q,rt,pt,yt,Tt){for(var wt,gt,kt=Fo(at),ee=pt===0?$a:Wa,ie=at.start,Kt=0;Kt<at.length-3;Kt+=3){var Me=at[Kt],Pe=at[Kt+1],Ae=at[Kt+2],ke=at[Kt+3],je=at[Kt+4],Si=pt===0?Me:Pe,Ni=pt===0?ke:je,un=!1;Tt&&(wt=Math.sqrt(Math.pow(Me-ke,2)+Math.pow(Pe-je,2))),Si<q?Ni>q&&(gt=ee(kt,Me,Pe,ke,je,q),Tt&&(kt.start=ie+wt*gt)):Si>rt?Ni<rt&&(gt=ee(kt,Me,Pe,ke,je,rt),Tt&&(kt.start=ie+wt*gt)):qr(kt,Me,Pe,Ae),Ni<q&&Si>=q&&(gt=ee(kt,Me,Pe,ke,je,q),un=!0),Ni>rt&&Si<=rt&&(gt=ee(kt,Me,Pe,ke,je,rt),un=!0),!yt&&un&&(Tt&&(kt.end=ie+wt*gt),G.push(kt),kt=Fo(at)),Tt&&(ie+=wt)}var Hi=at.length-3;Me=at[Hi],Pe=at[Hi+1],Ae=at[Hi+2],(Si=pt===0?Me:Pe)>=q&&Si<=rt&&qr(kt,Me,Pe,Ae),Hi=kt.length-3,yt&&Hi>=3&&(kt[Hi]!==kt[0]||kt[Hi+1]!==kt[1])&&qr(kt,kt[0],kt[1],kt[2]),kt.length&&G.push(kt)}function Fo(at){var G=[];return G.size=at.size,G.start=at.start,G.end=at.end,G}function Hs(at,G,q,rt,pt,yt){for(var Tt=0;Tt<at.length;Tt++)Gr(at[Tt],G,q,rt,pt,yt,!1)}function qr(at,G,q,rt){at.push(G),at.push(q),at.push(rt)}function $a(at,G,q,rt,pt,yt){var Tt=(yt-G)/(rt-G);return at.push(yt),at.push(q+(pt-q)*Tt),at.push(1),Tt}function Wa(at,G,q,rt,pt,yt){var Tt=(yt-q)/(pt-q);return at.push(G+(rt-G)*Tt),at.push(yt),at.push(1),Tt}function Vn(at,G){for(var q=[],rt=0;rt<at.length;rt++){var pt,yt=at[rt],Tt=yt.type;if(Tt==="Point"||Tt==="MultiPoint"||Tt==="LineString")pt=Xs(yt.geometry,G);else if(Tt==="MultiLineString"||Tt==="Polygon"){pt=[];for(var wt=0;wt<yt.geometry.length;wt++)pt.push(Xs(yt.geometry[wt],G))}else if(Tt==="MultiPolygon")for(pt=[],wt=0;wt<yt.geometry.length;wt++){for(var gt=[],kt=0;kt<yt.geometry[wt].length;kt++)gt.push(Xs(yt.geometry[wt][kt],G));pt.push(gt)}q.push(Ne(yt.id,Tt,pt,yt.tags))}return q}function Xs(at,G){var q=[];q.size=at.size,at.start!==void 0&&(q.start=at.start,q.end=at.end);for(var rt=0;rt<at.length;rt+=3)q.push(at[rt]+G,at[rt+1],at[rt+2]);return q}function No(at,G){if(at.transformed)return at;var q,rt,pt,yt=1<<at.z,Tt=at.x,wt=at.y;for(q=0;q<at.features.length;q++){var gt=at.features[q],kt=gt.geometry,ee=gt.type;if(gt.geometry=[],ee===1)for(rt=0;rt<kt.length;rt+=2)gt.geometry.push(dr(kt[rt],kt[rt+1],G,yt,Tt,wt));else for(rt=0;rt<kt.length;rt++){var ie=[];for(pt=0;pt<kt[rt].length;pt+=2)ie.push(dr(kt[rt][pt],kt[rt][pt+1],G,yt,Tt,wt));gt.geometry.push(ie)}}return at.transformed=!0,at}function dr(at,G,q,rt,pt,yt){return[Math.round(q*(at*rt-pt)),Math.round(q*(G*rt-yt))]}function $r(at,G,q,rt,pt){for(var yt=G===pt.maxZoom?0:pt.tolerance/((1<<G)*pt.extent),Tt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:q,y:rt,z:G,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},wt=0;wt<at.length;wt++){Tt.numFeatures++,jo(Tt,at[wt],yt,pt);var gt=at[wt].minX,kt=at[wt].minY,ee=at[wt].maxX,ie=at[wt].maxY;gt<Tt.minX&&(Tt.minX=gt),kt<Tt.minY&&(Tt.minY=kt),ee>Tt.maxX&&(Tt.maxX=ee),ie>Tt.maxY&&(Tt.maxY=ie)}return Tt}function jo(at,G,q,rt){var pt=G.geometry,yt=G.type,Tt=[];if(yt==="Point"||yt==="MultiPoint")for(var wt=0;wt<pt.length;wt+=3)Tt.push(pt[wt]),Tt.push(pt[wt+1]),at.numPoints++,at.numSimplified++;else if(yt==="LineString")pr(Tt,pt,at,q,!1,!1);else if(yt==="MultiLineString"||yt==="Polygon")for(wt=0;wt<pt.length;wt++)pr(Tt,pt[wt],at,q,yt==="Polygon",wt===0);else if(yt==="MultiPolygon")for(var gt=0;gt<pt.length;gt++){var kt=pt[gt];for(wt=0;wt<kt.length;wt++)pr(Tt,kt[wt],at,q,!0,wt===0)}if(Tt.length){var ee=G.tags||null;if(yt==="LineString"&&rt.lineMetrics){for(var ie in ee={},G.tags)ee[ie]=G.tags[ie];ee.mapbox_clip_start=pt.start/pt.size,ee.mapbox_clip_end=pt.end/pt.size}var Kt={geometry:Tt,type:yt==="Polygon"||yt==="MultiPolygon"?3:yt==="LineString"||yt==="MultiLineString"?2:1,tags:ee};G.id!==null&&(Kt.id=G.id),at.features.push(Kt)}}function pr(at,G,q,rt,pt,yt){var Tt=rt*rt;if(rt>0&&G.size<(pt?Tt:rt))q.numPoints+=G.length/3;else{for(var wt=[],gt=0;gt<G.length;gt+=3)(rt===0||G[gt+2]>Tt)&&(q.numSimplified++,wt.push(G[gt]),wt.push(G[gt+1])),q.numPoints++;pt&&function(kt,ee){for(var ie=0,Kt=0,Me=kt.length,Pe=Me-2;Kt<Me;Pe=Kt,Kt+=2)ie+=(kt[Kt]-kt[Pe])*(kt[Kt+1]+kt[Pe+1]);if(ie>0===ee)for(Kt=0,Me=kt.length;Kt<Me/2;Kt+=2){var Ae=kt[Kt],ke=kt[Kt+1];kt[Kt]=kt[Me-2-Kt],kt[Kt+1]=kt[Me-1-Kt],kt[Me-2-Kt]=Ae,kt[Me-1-Kt]=ke}}(wt,yt),at.push(wt)}}function Ys(at,G){var q=(G=this.options=function(pt,yt){for(var Tt in yt)pt[Tt]=yt[Tt];return pt}(Object.create(this.options),G)).debug;if(q&&console.time("preprocess data"),G.maxZoom<0||G.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(G.promoteId&&G.generateId)throw new Error("promoteId and generateId cannot be used together.");var rt=function(pt,yt){var Tt=[];if(pt.type==="FeatureCollection")for(var wt=0;wt<pt.features.length;wt++)zn(Tt,pt.features[wt],yt,wt);else zn(Tt,pt.type==="Feature"?pt:{geometry:pt},yt);return Tt}(at,G);this.tiles={},this.tileCoords=[],q&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",G.indexMaxZoom,G.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),rt=function(pt,yt){var Tt=yt.buffer/yt.extent,wt=pt,gt=Rn(pt,1,-1-Tt,Tt,0,-1,2,yt),kt=Rn(pt,1,1-Tt,2+Tt,0,-1,2,yt);return(gt||kt)&&(wt=Rn(pt,1,-Tt,1+Tt,0,-1,2,yt)||[],gt&&(wt=Vn(gt,1).concat(wt)),kt&&(wt=wt.concat(Vn(kt,-1)))),wt}(rt,G),rt.length&&this.splitTile(rt,0,0,0),q&&(rt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function fr(at,G,q){return 32*((1<<at)*q+G)+at}function _r(at,G){const q=at.tileID.canonical;if(!this._geoJSONIndex)return G(null,null);const rt=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!rt)return G(null,null);const pt=new class{constructor(Tt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.EXTENT,this.length=Tt.length,this._features=Tt}feature(Tt){return new class{constructor(wt){this._feature=wt,this.extent=r.EXTENT,this.type=wt.type,this.properties=wt.tags,"id"in wt&&!isNaN(wt.id)&&(this.id=parseInt(wt.id,10))}loadGeometry(){if(this._feature.type===1){const wt=[];for(const gt of this._feature.geometry)wt.push([new r.Point(gt[0],gt[1])]);return wt}{const wt=[];for(const gt of this._feature.geometry){const kt=[];for(const ee of gt)kt.push(new r.Point(ee[0],ee[1]));wt.push(kt)}return wt}}toGeoJSON(wt,gt,kt){return ct.call(this,wt,gt,kt)}}(this._features[Tt])}}(rt.features);let yt=ei(pt);yt.byteOffset===0&&yt.byteLength===yt.buffer.byteLength||(yt=new Uint8Array(yt)),G(null,{vectorTile:pt,rawData:yt.buffer})}Ys.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ys.prototype.splitTile=function(at,G,q,rt,pt,yt,Tt){for(var wt=[at,G,q,rt],gt=this.options,kt=gt.debug;wt.length;){rt=wt.pop(),q=wt.pop(),G=wt.pop(),at=wt.pop();var ee=1<<G,ie=fr(G,q,rt),Kt=this.tiles[ie];if(!Kt&&(kt>1&&console.time("creation"),Kt=this.tiles[ie]=$r(at,G,q,rt,gt),this.tileCoords.push({z:G,x:q,y:rt}),kt)){kt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",G,q,rt,Kt.numFeatures,Kt.numPoints,Kt.numSimplified),console.timeEnd("creation"));var Me="z"+G;this.stats[Me]=(this.stats[Me]||0)+1,this.total++}if(Kt.source=at,pt){if(G===gt.maxZoom||G===pt)continue;var Pe=1<<pt-G;if(q!==Math.floor(yt/Pe)||rt!==Math.floor(Tt/Pe))continue}else if(G===gt.indexMaxZoom||Kt.numPoints<=gt.indexMaxPoints)continue;if(Kt.source=null,at.length!==0){kt>1&&console.time("clipping");var Ae,ke,je,Si,Ni,un,Hi=.5*gt.buffer/gt.extent,cs=.5-Hi,Qi=.5+Hi,yn=1+Hi;Ae=ke=je=Si=null,Ni=Rn(at,ee,q-Hi,q+Qi,0,Kt.minX,Kt.maxX,gt),un=Rn(at,ee,q+cs,q+yn,0,Kt.minX,Kt.maxX,gt),at=null,Ni&&(Ae=Rn(Ni,ee,rt-Hi,rt+Qi,1,Kt.minY,Kt.maxY,gt),ke=Rn(Ni,ee,rt+cs,rt+yn,1,Kt.minY,Kt.maxY,gt),Ni=null),un&&(je=Rn(un,ee,rt-Hi,rt+Qi,1,Kt.minY,Kt.maxY,gt),Si=Rn(un,ee,rt+cs,rt+yn,1,Kt.minY,Kt.maxY,gt),un=null),kt>1&&console.timeEnd("clipping"),wt.push(Ae||[],G+1,2*q,2*rt),wt.push(ke||[],G+1,2*q,2*rt+1),wt.push(je||[],G+1,2*q+1,2*rt),wt.push(Si||[],G+1,2*q+1,2*rt+1)}}},Ys.prototype.getTile=function(at,G,q){var rt=this.options,pt=rt.extent,yt=rt.debug;if(at<0||at>24)return null;var Tt=1<<at,wt=fr(at,G=(G%Tt+Tt)%Tt,q);if(this.tiles[wt])return No(this.tiles[wt],pt);yt>1&&console.log("drilling down to z%d-%d-%d",at,G,q);for(var gt,kt=at,ee=G,ie=q;!gt&&kt>0;)kt--,ee=Math.floor(ee/2),ie=Math.floor(ie/2),gt=this.tiles[fr(kt,ee,ie)];return gt&&gt.source?(yt>1&&console.log("found parent tile z%d-%d-%d",kt,ee,ie),yt>1&&console.time("drilling down"),this.splitTile(gt.source,kt,ee,ie,at,G,q),yt>1&&console.timeEnd("drilling down"),this.tiles[wt]?No(this.tiles[wt],pt):null):null};class Wr extends r.VectorTileWorkerSource{constructor(G,q,rt,pt,yt){super(G,q,rt,pt,_r),yt&&(this.loadGeoJSON=yt)}loadData(G,q){const rt=G&&G.request,pt=rt&&rt.collectResourceTiming;this.loadGeoJSON(G,(yt,Tt)=>{if(yt||!Tt)return q(yt);if(typeof Tt!="object")return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));{it(Tt,!0);try{if(G.filter){const gt=r.createExpression(G.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(gt.result==="error")throw new Error(gt.value.map(ee=>`${ee.key}: ${ee.message}`).join(", "));Tt={type:"FeatureCollection",features:Tt.features.filter(ee=>gt.value.evaluate({zoom:0},ee))}}this._geoJSONIndex=G.cluster?new _i(function({superclusterOptions:gt,clusterProperties:kt}){if(!kt||!gt)return gt;const ee={},ie={},Kt={accumulated:null,zoom:0},Me={properties:null},Pe=Object.keys(kt);for(const Ae of Pe){const[ke,je]=kt[Ae],Si=r.createExpression(je),Ni=r.createExpression(typeof ke=="string"?[ke,["accumulated"],["get",Ae]]:ke);ee[Ae]=Si.value,ie[Ae]=Ni.value}return gt.map=Ae=>{Me.properties=Ae;const ke={};for(const je of Pe)ke[je]=ee[je].evaluate(Kt,Me);return ke},gt.reduce=(Ae,ke)=>{Me.properties=ke;for(const je of Pe)Kt.accumulated=Ae[je],Ae[je]=ie[je].evaluate(Kt,Me)},gt}(G)).load(Tt.features):function(gt,kt){return new Ys(gt,kt)}(Tt,G.geojsonVtOptions)}catch(gt){return q(gt)}this.loaded={};const wt={};if(pt){const gt=r.getPerformanceMeasurement(rt);gt&&(wt.resourceTiming={},wt.resourceTiming[G.source]=JSON.parse(JSON.stringify(gt)))}q(null,wt)}})}reloadTile(G,q){const rt=this.loaded;return rt&&rt[G.uid]?super.reloadTile(G,q):this.loadTile(G,q)}loadGeoJSON(G,q){if(G.request)r.getJSON(G.request,q);else{if(typeof G.data!="string")return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`));try{return q(null,JSON.parse(G.data))}catch{return q(new Error(`Input data given to '${G.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(G,q){try{q(null,this._geoJSONIndex.getClusterExpansionZoom(G.clusterId))}catch(rt){q(rt)}}getClusterChildren(G,q){try{q(null,this._geoJSONIndex.getChildren(G.clusterId))}catch(rt){q(rt)}}getClusterLeaves(G,q){try{q(null,this._geoJSONIndex.getLeaves(G.clusterId,G.limit,G.offset))}catch(rt){q(rt)}}}class Za{constructor(G){this.self=G,this.actor=new r.Actor(G,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.getProjection({name:"mercator"}),this.workerSourceTypes={vector:r.VectorTileWorkerSource,geojson:Wr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(q,rt)=>{if(this.workerSourceTypes[q])throw new Error(`Worker source with name "${q}" already registered.`);this.workerSourceTypes[q]=rt},this.self.registerRTLTextPlugin=q=>{if(r.plugin.isParsed())throw new Error("RTL text plugin already registered.");r.plugin.applyArabicShaping=q.applyArabicShaping,r.plugin.processBidirectionalText=q.processBidirectionalText,r.plugin.processStyledBidirectionalText=q.processStyledBidirectionalText}}clearCaches(G,q,rt){delete this.layerIndexes[G],delete this.availableImages[G],delete this.workerSources[G],delete this.demWorkerSources[G],rt()}checkIfReady(G,q,rt){rt()}setReferrer(G,q){this.referrer=q}spriteLoaded(G,q){this.isSpriteLoaded[G]=q;for(const rt in this.workerSources[G]){const pt=this.workerSources[G][rt];for(const yt in pt)pt[yt]instanceof r.VectorTileWorkerSource&&(pt[yt].isSpriteLoaded=q,pt[yt].fire(new r.Event("isSpriteLoaded")))}}setImages(G,q,rt){this.availableImages[G]=q;for(const pt in this.workerSources[G]){const yt=this.workerSources[G][pt];for(const Tt in yt)yt[Tt].availableImages=q}rt()}enableTerrain(G,q,rt){this.terrain=q,rt()}setProjection(G,q){this.projections[G]=r.getProjection(q)}setLayers(G,q,rt){this.getLayerIndex(G).replace(q),rt()}updateLayers(G,q,rt){this.getLayerIndex(G).update(q.layers,q.removedIds),rt()}loadTile(G,q,rt){const pt=this.enableTerrain?r.extend({enableTerrain:this.terrain},q):q;pt.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,q.type,q.source).loadTile(pt,rt)}loadDEMTile(G,q,rt){const pt=this.enableTerrain?r.extend({buildQuadTree:this.terrain},q):q;this.getDEMWorkerSource(G,q.source).loadTile(pt,rt)}reloadTile(G,q,rt){const pt=this.enableTerrain?r.extend({enableTerrain:this.terrain},q):q;pt.projection=this.projections[G]||this.defaultProjection,this.getWorkerSource(G,q.type,q.source).reloadTile(pt,rt)}abortTile(G,q,rt){this.getWorkerSource(G,q.type,q.source).abortTile(q,rt)}removeTile(G,q,rt){this.getWorkerSource(G,q.type,q.source).removeTile(q,rt)}removeSource(G,q,rt){if(!this.workerSources[G]||!this.workerSources[G][q.type]||!this.workerSources[G][q.type][q.source])return;const pt=this.workerSources[G][q.type][q.source];delete this.workerSources[G][q.type][q.source],pt.removeSource!==void 0?pt.removeSource(q,rt):rt()}loadWorkerSource(G,q,rt){try{this.self.importScripts(q.url),rt()}catch(pt){rt(pt.toString())}}syncRTLPluginState(G,q,rt){try{r.plugin.setState(q);const pt=r.plugin.getPluginURL();if(r.plugin.isLoaded()&&!r.plugin.isParsed()&&pt!=null){this.self.importScripts(pt);const yt=r.plugin.isParsed();rt(yt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${pt}`),yt)}}catch(pt){rt(pt.toString())}}getAvailableImages(G){let q=this.availableImages[G];return q||(q=[]),q}getLayerIndex(G){let q=this.layerIndexes[G];return q||(q=this.layerIndexes[G]=new R),q}getWorkerSource(G,q,rt){if(this.workerSources[G]||(this.workerSources[G]={}),this.workerSources[G][q]||(this.workerSources[G][q]={}),!this.workerSources[G][q][rt]){const pt={send:(yt,Tt,wt,gt,kt,ee)=>{this.actor.send(yt,Tt,wt,G,kt,ee)},scheduler:this.actor.scheduler};this.workerSources[G][q][rt]=new this.workerSourceTypes[q](pt,this.getLayerIndex(G),this.getAvailableImages(G),this.isSpriteLoaded[G])}return this.workerSources[G][q][rt]}getDEMWorkerSource(G,q){return this.demWorkerSources[G]||(this.demWorkerSources[G]={}),this.demWorkerSources[G][q]||(this.demWorkerSources[G][q]=new F),this.demWorkerSources[G][q]}enforceCacheSizeLimit(G,q){r.enforceCacheSizeLimit(q)}getWorkerPerformanceMetrics(G,q,rt){rt(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Za(self)),Za}),g(["./shared"],function(r){function T(d,n){if(Array.isArray(d)){if(!Array.isArray(n)||d.length!==n.length)return!1;for(let c=0;c<d.length;c++)if(!T(d[c],n[c]))return!1;return!0}if(typeof d=="object"&&d!==null&&n!==null){if(typeof n!="object"||Object.keys(d).length!==Object.keys(n).length)return!1;for(const c in d)if(!T(d[c],n[c]))return!1;return!0}return d===n}var I=R;function R(d){return!function(n){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,y,b=new Blob([""],{type:"text/javascript"}),S=URL.createObjectURL(b);try{y=new Worker(S),_=!0}catch{_=!1}return y&&y.terminate(),URL.revokeObjectURL(S),_}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var _=document.createElement("canvas");_.width=_.height=1;var y=_.getContext("2d");if(!y)return!1;var b=y.getImageData(0,0,1,1);return b&&b.width===_.width}()?(F[c=n&&n.failIfMajorPerformanceCaveat]===void 0&&(F[c]=function(_){var y,b=function(S){var M=document.createElement("canvas"),P=Object.create(R.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=S,M.getContext("webgl",P)||M.getContext("experimental-webgl",P)}(_);if(!b)return!1;try{y=b.createShader(b.VERTEX_SHADER)}catch{return!1}return!(!y||b.isContextLost())&&(b.shaderSource(y,"void main() {}"),b.compileShader(y),b.getShaderParameter(y,b.COMPILE_STATUS)===!0)}(c)),F[c]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var c}(d)}var F={};function U(d,n,c){const _=r.window.document.createElement(d);return n!==void 0&&(_.className=n),c&&c.appendChild(_),_}function Y(d,n,c){const _=r.window.document.createElementNS("http://www.w3.org/2000/svg",d);for(const y of Object.keys(n))_.setAttributeNS(null,y,n[y]);return c&&c.appendChild(_),_}R.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const it=r.window.document&&r.window.document.documentElement.style,ct=it&&it.userSelect!==void 0?"userSelect":"WebkitUserSelect";let ht;function bt(){it&&ct&&(ht=it[ct],it[ct]="none")}function Dt(){it&&ct&&(it[ct]=ht)}function Ft(d){d.preventDefault(),d.stopPropagation(),r.window.removeEventListener("click",Ft,!0)}function Wt(){r.window.addEventListener("click",Ft,!0),r.window.setTimeout(()=>{r.window.removeEventListener("click",Ft,!0)},0)}function Rt(d,n){const c=d.getBoundingClientRect();return se(d,c,n)}function Jt(d,n){const c=d.getBoundingClientRect(),_=[];for(let y=0;y<n.length;y++)_.push(se(d,c,n[y]));return _}function ne(d){return r.window.InstallTrigger!==void 0&&d.button===2&&d.ctrlKey&&r.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:d.button}function se(d,n,c){const _=d.offsetWidth===n.width?1:d.offsetWidth/n.width;return new r.Point((c.clientX-n.left)*_,(c.clientY-n.top)*_)}function Lt(d,n){var c=n[0],_=n[1],y=n[2],b=n[3],S=c*b-y*_;return S?(d[0]=b*(S=1/S),d[1]=-_*S,d[2]=-y*S,d[3]=c*S,d):null}function Le(d){const{userImage:n}=d;return!!(n&&n.render&&n.render())&&(d.data.replace(new Uint8Array(n.data.buffer)),!0)}class ze extends r.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new r.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(n){if(this.loaded!==n&&(this.loaded=n,n)){for(const{ids:c,callback:_}of this.requestors)this._notify(c,_);this.requestors=[]}}hasImage(n){return!!this.getImage(n)}getImage(n){return this.images[n]}addImage(n,c){this._validate(n,c)&&(this.images[n]=c)}_validate(n,c){let _=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "stretchX" value`))),_=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "stretchY" value`))),_=!1),this._validateContent(c.content,c)||(this.fire(new r.ErrorEvent(new Error(`Image "${n}" has invalid "content" value`))),_=!1),_}_validateStretch(n,c){if(!n)return!0;let _=0;for(const y of n){if(y[0]<_||y[1]<y[0]||c<y[1])return!1;_=y[1]}return!0}_validateContent(n,c){return!(n&&(n.length!==4||n[0]<0||c.data.width<n[0]||n[1]<0||c.data.height<n[1]||n[2]<0||c.data.width<n[2]||n[3]<0||c.data.height<n[3]||n[2]<n[0]||n[3]<n[1]))}updateImage(n,c){c.version=this.images[n].version+1,this.images[n]=c,this.updatedImages[n]=!0}removeImage(n){const c=this.images[n];delete this.images[n],delete this.patterns[n],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(n,c){let _=!0;if(!this.isLoaded())for(const y of n)this.images[y]||(_=!1);this.isLoaded()||_?this._notify(n,c):this.requestors.push({ids:n,callback:c})}_notify(n,c){const _={};for(const y of n){this.images[y]||this.fire(new r.Event("styleimagemissing",{id:y}));const b=this.images[y];b?_[y]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:!!(b.userImage&&b.userImage.render)}:r.warnOnce(`Image "${y}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,_)}getPixelSize(){const{width:n,height:c}=this.atlasImage;return{width:n,height:c}}getPattern(n){const c=this.patterns[n],_=this.getImage(n);if(!_)return null;if(c&&c.position.version===_.version)return c.position;if(c)c.position.version=_.version;else{const y={w:_.data.width+2,h:_.data.height+2,x:0,y:0},b=new r.ImagePosition(y,_);this.patterns[n]={bin:y,position:b}}return this._updatePatternAtlas(),this.patterns[n].position}bind(n){const c=n.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new r.Texture(n,this.atlasImage,c.RGBA),this.atlasTexture&&this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const n=[];for(const b in this.patterns)n.push(this.patterns[b].bin);const{w:c,h:_}=r.potpack(n),y=this.atlasImage;y.resize({width:c||1,height:_||1});for(const b in this.patterns){const{bin:S}=this.patterns[b],M=S.x+1,P=S.y+1,z=this.images[b].data,L=z.width,N=z.height;r.RGBAImage.copy(z,y,{x:0,y:0},{x:M,y:P},{width:L,height:N}),r.RGBAImage.copy(z,y,{x:0,y:N-1},{x:M,y:P-1},{width:L,height:1}),r.RGBAImage.copy(z,y,{x:0,y:0},{x:M,y:P+N},{width:L,height:1}),r.RGBAImage.copy(z,y,{x:L-1,y:0},{x:M-1,y:P},{width:1,height:N}),r.RGBAImage.copy(z,y,{x:0,y:0},{x:M+L,y:P},{width:1,height:N})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(n){for(const c of n){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const _=this.images[c];Le(_)&&this.updateImage(c,_)}}}const fe=new r.Properties({anchor:new r.DataConstantProperty(r.spec.light.anchor),position:new class{constructor(){this.specification=r.spec.light.position}possiblyEvaluate(d,n){return function([c,_,y]){const b=r.degToRad(_+90),S=r.degToRad(y);return{x:c*Math.cos(b)*Math.sin(S),y:c*Math.sin(b)*Math.sin(S),z:c*Math.cos(S),azimuthal:_,polar:y}}(d.expression.evaluate(n))}interpolate(d,n,c){return{x:r.number(d.x,n.x,c),y:r.number(d.y,n.y,c),z:r.number(d.z,n.z,c),azimuthal:r.number(d.azimuthal,n.azimuthal,c),polar:r.number(d.polar,n.polar,c)}}},color:new r.DataConstantProperty(r.spec.light.color),intensity:new r.DataConstantProperty(r.spec.light.intensity)});class Ge extends r.Evented{constructor(n){super(),this._transitionable=new r.Transitionable(fe),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(n,c={}){if(!this._validate(r.validateLight,n,c))for(const _ in n){const y=n[_];r.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,_){return(!_||_.validate!==!1)&&r.emitValidationErrors(this,n.call(r.validateStyle,r.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}const on=new r.Properties({source:new r.DataConstantProperty(r.spec.terrain.source),exaggeration:new r.DataConstantProperty(r.spec.terrain.exaggeration)});let Ke=class extends r.Evented{constructor(d,n){super(),this._transitionable=new r.Transitionable(on),this.set(d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(d){for(const n in d){const c=d[n];r.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-11),c):this._transitionable.setValue(n,c)}}updateTransitions(d){this._transitioning=this._transitionable.transitioned(d,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(d){this.properties=this._transitioning.possiblyEvaluate(d)}};function ei(d,n,c,_){const y=r.smoothstep(45,65,c),[b,S]=xi(d,_),M=r.length(n);let P=1-Math.min(1,Math.exp((M-b)/(S-b)*-6));return P*=P*P,P=Math.min(1,1.00747*P),P*y*d.alpha}function xi(d,n){const c=.5/Math.tan(.5*n);return[d.range[0]+c,d.range[1]+c]}const be=new r.Properties({range:new r.DataConstantProperty(r.spec.fog.range),color:new r.DataConstantProperty(r.spec.fog.color),"high-color":new r.DataConstantProperty(r.spec.fog["high-color"]),"space-color":new r.DataConstantProperty(r.spec.fog["space-color"]),"horizon-blend":new r.DataConstantProperty(r.spec.fog["horizon-blend"]),"star-intensity":new r.DataConstantProperty(r.spec.fog["star-intensity"])});class Pi extends r.Evented{constructor(n,c){super(),this._transitionable=new r.Transitionable(be),this.set(n),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const n=this._transform,c=n.projection.name==="globe",_=r.globeToMercatorTransition(n.zoom),y=this.properties.get("range"),b=[.5,3];return{range:c?[r.number(b[0],y[0],_),r.number(b[1],y[1],_)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(n,c={}){if(!this._validate(r.validateFog,n,c)){for(const _ of Object.keys(r.spec.fog))n&&n[_]===void 0&&(n[_]=r.spec.fog[_].default);for(const _ in n){const y=n[_];r.endsWith(_,"-transition")?this._transitionable.setTransition(_.slice(0,-11),y):this._transitionable.setValue(_,y)}}}getOpacity(n){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:r.smoothstep(45,65,n))*c.a}getOpacityAtLatLng(n,c){return this._transform.projection.supportsFog?function(_,y,b){const S=r.MercatorCoordinate.fromLngLat(y),M=b.elevation?b.elevation.getAtPointOrZero(S):0,P=[S.x,S.y,M];return r.transformMat4(P,P,b.mercatorFogMatrix),ei(_,P,b.pitch,b._fov)}(this.state,n,c):0}getFovAdjustedRange(n){return this._transform.projection.supportsFog?xi(this.state,n):[0,1]}updateTransitions(n){this._transitioning=this._transitionable.transitioned(n,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(n){this.properties=this._transitioning.possiblyEvaluate(n)}_validate(n,c,_){return(!_||_.validate!==!1)&&r.emitValidationErrors(this,n.call(r.validateStyle,r.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}class vi{constructor(n,c){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=r.uniqueId();const _=this.workerPool.acquire(this.id);for(let y=0;y<_.length;y++){const b=new vi.Actor(_[y],c,this.id);b.name=`Worker ${y}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,c,_){r.asyncAll(this.actors,(y,b)=>{y.send(n,c,b)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}function ki(d,n,c){return n*(r.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}vi.Actor=r.Actor;class gn{constructor(n,c,_,y){this.screenBounds=n,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,y)}static createFromScreenPoints(n,c){let _,y;if(n instanceof r.Point||typeof n[0]=="number"){const b=r.Point.convert(n);_=[b],y=c.isPointAboveHorizon(b)}else{const b=r.Point.convert(n[0]),S=r.Point.convert(n[1]);_=[b,S],y=r.polygonizeBounds(b,S).every(M=>c.isPointAboveHorizon(M))}return new gn(_,c.getCameraPoint(),y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(n){return r.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],n)}bufferedCameraGeometry(n){const c=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new r.Point(1,1)):this.screenBounds[1],y=r.polygonizeBounds(c,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<_.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),r.bufferConvexPolygon(y,n)}bufferedCameraGeometryGlobe(n){const c=this.screenBounds[0],_=this.screenBounds.length===1?this.screenBounds[0].add(new r.Point(1,1)):this.screenBounds[1],y=r.polygonizeBounds(c,_,n),b=this.cameraPoint.clone();switch(3*((b.y>c.y)+(b.y>_.y))+((b.x>c.x)+(b.x>_.x))){case 0:y[0]=b,y[4]=b.clone();break;case 1:y.splice(1,0,b);break;case 2:y[1]=b;break;case 3:y.splice(4,0,b);break;case 5:y.splice(2,0,b);break;case 6:y[3]=b;break;case 7:y.splice(3,0,b);break;case 8:y[2]=b}return y}containsTile(n,c,_,y=0){const b=n.queryPadding/c._pixelsPerMercatorPixel+1,S=_?this._bufferedCameraMercator(b,c):this._bufferedScreenMercator(b,c);let M=n.tileID.wrap+(S.unwrapped?y:0);const P=S.polygon.map(Q=>r.getTilePoint(n.tileTransform,Q,M));if(!r.polygonIntersectsBox(P,0,0,r.EXTENT,r.EXTENT))return;M=n.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const z=this.screenGeometryMercator.polygon.map(Q=>r.getTileVec3(n.tileTransform,Q,M)),L=z.map(Q=>new r.Point(Q[0],Q[1])),N=c.getFreeCameraOptions().position||new r.MercatorCoordinate(0,0,0),$=r.getTileVec3(n.tileTransform,N,M),X=z.map(Q=>{const j=r.sub(Q,Q,$);return r.normalize(j,j),new r.Ray($,j)}),J=ki(n,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:X,bufferedTilespaceGeometry:P,bufferedTilespaceBounds:(K=r.getBounds(P),K.min.x=r.clamp(K.min.x,0,r.EXTENT),K.min.y=r.clamp(K.min.y,0,r.EXTENT),K.max.x=r.clamp(K.max.x,0,r.EXTENT),K.max.y=r.clamp(K.max.y,0,r.EXTENT),K),tile:n,tileID:n.tileID,pixelToTileUnitsFactor:J};var K}_bufferedScreenMercator(n,c){const _=Nn(n);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(n),c):{polygon:this.bufferedScreenGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[_]=y,y}}_bufferedCameraMercator(n,c){const _=Nn(n);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(n),c):{polygon:this.bufferedCameraGeometry(n).map(b=>c.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[_]=y,y}}_projectAndResample(n,c){const _=function(b,S){const M=r.multiply([],S.pixelMatrix,S.globeMatrix),P=[0,-r.GLOBE_RADIUS,0,1],z=[0,r.GLOBE_RADIUS,0,1],L=[0,0,0,1];r.transformMat4$1(P,P,M),r.transformMat4$1(z,z,M),r.transformMat4$1(L,L,M);const N=new r.Point(P[0]/P[3],P[1]/P[3]),$=new r.Point(z[0]/z[3],z[1]/z[3]),X=r.polygonContainsPoint(b,N)&&P[3]<L[3],J=r.polygonContainsPoint(b,$)&&z[3]<L[3];if(!X&&!J)return null;const K=function(_t,vt,xt){for(let At=1;At<_t.length;At++){const Zt=vn(vt.pointCoordinate3D(_t[At-1]).x),Et=vn(vt.pointCoordinate3D(_t[At]).x);if(xt<0){if(Zt<Et)return{idx:At,t:-Zt/(Et-1-Zt)}}else if(Et<Zt)return{idx:At,t:(1-Zt)/(Et+1-Zt)}}return null}(b,S,X?-1:1);if(!K)return null;const{idx:Q,t:j}=K;let H=Q>1?_i(b.slice(0,Q),S):[],nt=Q<b.length?_i(b.slice(Q),S):[];H=H.map(_t=>new r.Point(vn(_t.x),_t.y)),nt=nt.map(_t=>new r.Point(vn(_t.x),_t.y));const st=[...H];st.length===0&&st.push(nt[nt.length-1]);const ft=r.number(st[st.length-1].y,(nt.length===0?H[0]:nt[0]).y,j);let mt;return mt=X?[new r.Point(0,ft),new r.Point(0,0),new r.Point(1,0),new r.Point(1,ft)]:[new r.Point(1,ft),new r.Point(1,1),new r.Point(0,1),new r.Point(0,ft)],st.push(...mt),nt.length===0?st.push(H[0]):st.push(...nt),{polygon:st.map(_t=>new r.MercatorCoordinate(_t.x,_t.y)),unwrapped:!1}}(n,c);if(_)return _;const y=function(b,S){let M=!1,P=-1/0,z=0;for(let N=0;N<b.length-1;N++)b[N].x>P&&(P=b[N].x,z=N);for(let N=0;N<b.length-1;N++){const $=(z+N)%(b.length-1),X=b[$],J=b[$+1];Math.abs(X.x-J.x)>.5&&(X.x<J.x?(X.x+=1,$===0&&(b[b.length-1].x+=1)):(J.x+=1,$+1===b.length-1&&(b[0].x+=1)),M=!0)}const L=r.mercatorXfromLng(S.center.lng);return M&&L<Math.abs(L-1)&&b.forEach(N=>{N.x-=1}),{polygon:b,unwrapped:M}}(_i(n,c).map(b=>new r.Point(vn(b.x),b.y)),c);return{polygon:y.polygon.map(b=>new r.MercatorCoordinate(b.x,b.y)),unwrapped:y.unwrapped}}}function _i(d,n){return r.resample(d,c=>{const _=n.pointCoordinate3D(c);c.x=_.x,c.y=_.y},1/256)}function vn(d){return d<0?1+d%1:d%1}function Nn(d){return 100*d|0}function bn(d,n,c,_,y){const b=function(S,M){if(S)return y(S);if(M){d.url&&M.tiles&&d.tiles&&delete d.tiles;const P=r.pick(r.extend(M,d),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);M.vector_layers&&(P.vectorLayers=M.vector_layers,P.vectorLayerIds=P.vectorLayers.map(z=>z.id)),P.tiles=n.canonicalizeTileset(P,d.url),y(null,P)}};return d.url?r.getJSON(n.transformRequest(n.normalizeSourceURL(d.url,null,c,_),r.ResourceType.Source),b):r.exported.frame(()=>b(null,d))}class ws{constructor(n,c,_){this.bounds=r.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=c||0,this.maxzoom=_||24}validateBounds(n){return Array.isArray(n)&&n.length===4?[Math.max(-180,n[0]),Math.max(-90,n[1]),Math.min(180,n[2]),Math.min(90,n[3])]:[-180,-90,180,90]}contains(n){const c=Math.pow(2,n.z),_=Math.floor(r.mercatorXfromLng(this.bounds.getWest())*c),y=Math.floor(r.mercatorYfromLat(this.bounds.getNorth())*c),b=Math.ceil(r.mercatorXfromLng(this.bounds.getEast())*c),S=Math.ceil(r.mercatorYfromLat(this.bounds.getSouth())*c);return n.x>=_&&n.x<b&&n.y>=y&&n.y<S}}class Ga{constructor(n,c,_){this.context=n;const y=n.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!_,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ur={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Vr{constructor(n,c,_,y){this.length=c.length,this.attributes=_,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.context=n;const b=n.gl;this.buffer=b.createBuffer(),n.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(n){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,n.arrayBuffer)}enableAttributes(n,c){for(let _=0;_<this.attributes.length;_++){const y=c.attributes[this.attributes[_].name];y!==void 0&&n.enableVertexAttribArray(y)}}setVertexAttribPointers(n,c,_){for(let y=0;y<this.attributes.length;y++){const b=this.attributes[y],S=c.attributes[b.name];S!==void 0&&n.vertexAttribPointer(S,b.components,n[ur[b.type]],!1,this.itemSize,b.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ne{constructor(n){this.gl=n.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(n){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ur extends Ne{getDefault(){return r.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.clearColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class zn extends Ne{getDefault(){return 1}set(n){(n!==this.current||this.dirty)&&(this.gl.clearDepth(n),this.current=n,this.dirty=!1)}}class Oo extends Ne{getDefault(){return 0}set(n){(n!==this.current||this.dirty)&&(this.gl.clearStencil(n),this.current=n,this.dirty=!1)}}class Ei extends Ne{getDefault(){return[!0,!0,!0,!0]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.colorMask(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class jn extends Ne{getDefault(){return!0}set(n){(n!==this.current||this.dirty)&&(this.gl.depthMask(n),this.current=n,this.dirty=!1)}}class qa extends Ne{getDefault(){return 255}set(n){(n!==this.current||this.dirty)&&(this.gl.stencilMask(n),this.current=n,this.dirty=!1)}}class Ts extends Ne{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(n){const c=this.current;(n.func!==c.func||n.ref!==c.ref||n.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(n.func,n.ref,n.mask),this.current=n,this.dirty=!1)}}class Rn extends Ne{getDefault(){const n=this.gl;return[n.KEEP,n.KEEP,n.KEEP]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(n[0],n[1],n[2]),this.current=n,this.dirty=!1)}}class Bo extends Ne{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=n,this.dirty=!1}}class Gr extends Ne{getDefault(){return[0,1]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.depthRange(n[0],n[1]),this.current=n,this.dirty=!1)}}class Fo extends Ne{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=n,this.dirty=!1}}class Hs extends Ne{getDefault(){return this.gl.LESS}set(n){(n!==this.current||this.dirty)&&(this.gl.depthFunc(n),this.current=n,this.dirty=!1)}}class qr extends Ne{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.BLEND):c.disable(c.BLEND),this.current=n,this.dirty=!1}}class $a extends Ne{getDefault(){const n=this.gl;return[n.ONE,n.ZERO]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(n[0],n[1]),this.current=n,this.dirty=!1)}}class Wa extends Ne{getDefault(){return r.Color.transparent}set(n){const c=this.current;(n.r!==c.r||n.g!==c.g||n.b!==c.b||n.a!==c.a||this.dirty)&&(this.gl.blendColor(n.r,n.g,n.b,n.a),this.current=n,this.dirty=!1)}}class Vn extends Ne{getDefault(){return this.gl.FUNC_ADD}set(n){(n!==this.current||this.dirty)&&(this.gl.blendEquation(n),this.current=n,this.dirty=!1)}}class Xs extends Ne{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;n?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=n,this.dirty=!1}}class No extends Ne{getDefault(){return this.gl.BACK}set(n){(n!==this.current||this.dirty)&&(this.gl.cullFace(n),this.current=n,this.dirty=!1)}}class dr extends Ne{getDefault(){return this.gl.CCW}set(n){(n!==this.current||this.dirty)&&(this.gl.frontFace(n),this.current=n,this.dirty=!1)}}let $r,jo=class extends Ne{getDefault(){return null}set(d){(d!==this.current||this.dirty)&&(this.gl.useProgram(d),this.current=d,this.dirty=!1)}};class pr extends Ne{getDefault(){return this.gl.TEXTURE0}set(n){(n!==this.current||this.dirty)&&(this.gl.activeTexture(n),this.current=n,this.dirty=!1)}}class Ys extends Ne{getDefault(){const n=this.gl;return[0,0,n.drawingBufferWidth,n.drawingBufferHeight]}set(n){const c=this.current;(n[0]!==c[0]||n[1]!==c[1]||n[2]!==c[2]||n[3]!==c[3]||this.dirty)&&(this.gl.viewport(n[0],n[1],n[2],n[3]),this.current=n,this.dirty=!1)}}class fr extends Ne{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,n),this.current=n,this.dirty=!1}}class _r extends Ne{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class Wr extends Ne{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,n),this.current=n,this.dirty=!1}}class Za extends Ne{getDefault(){return null}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class at extends Ne{getDefault(){return null}set(n){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,n),this.current=n,this.dirty=!1}}class G extends Ne{constructor(n){super(n),this.vao=n.extVertexArrayObject}getDefault(){return null}set(n){this.vao&&(n!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(n),this.current=n,this.dirty=!1)}}class q extends Ne{getDefault(){return 4}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,n),this.current=n,this.dirty=!1}}class rt extends Ne{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),this.current=n,this.dirty=!1}}class pt extends Ne{getDefault(){return!1}set(n){if(n===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,n),this.current=n,this.dirty=!1}}class yt extends Ne{constructor(n,c){super(n),this.context=n,this.parent=c}getDefault(){return null}}class Tt extends yt{setDirty(){this.dirty=!0}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,n,0),this.current=n,this.dirty=!1}}class wt extends yt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(n){if(n===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,n),this.current=n,this.dirty=!1}}class gt extends wt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class kt{constructor(n,c,_,y){this.context=n,this.width=c,this.height=_;const b=this.framebuffer=n.gl.createFramebuffer();this.colorAttachment=new Tt(n,b),y&&(this.depthAttachment=new wt(n,b))}destroy(){const n=this.context.gl,c=this.colorAttachment.get();if(c&&n.deleteTexture(c),this.depthAttachment){const _=this.depthAttachment.get();_&&n.deleteRenderbuffer(_)}n.deleteFramebuffer(this.framebuffer)}}class ee{constructor(n,c=!1){if(this.gl=n,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const _=n;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(n),deleteVertexArrayOES:_.deleteVertexArray.bind(n),bindVertexArrayOES:_.bindVertexArray.bind(n)}}this.clearColor=new Ur(this),this.clearDepth=new zn(this),this.clearStencil=new Oo(this),this.colorMask=new Ei(this),this.depthMask=new jn(this),this.stencilMask=new qa(this),this.stencilFunc=new Ts(this),this.stencilOp=new Rn(this),this.stencilTest=new Bo(this),this.depthRange=new Gr(this),this.depthTest=new Fo(this),this.depthFunc=new Hs(this),this.blend=new qr(this),this.blendFunc=new $a(this),this.blendColor=new Wa(this),this.blendEquation=new Vn(this),this.cullFace=new Xs(this),this.cullFaceSide=new No(this),this.frontFace=new dr(this),this.program=new jo(this),this.activeTexture=new pr(this),this.viewport=new Ys(this),this.bindFramebuffer=new fr(this),this.bindRenderbuffer=new _r(this),this.bindTexture=new Wr(this),this.bindVertexBuffer=new Za(this),this.bindElementBuffer=new at(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new G(this),this.pixelStoreUnpack=new q(this),this.pixelStoreUnpackPremultiplyAlpha=new rt(this),this.pixelStoreUnpackFlipY=new pt(this),this.extTextureFilterAnisotropic=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=n.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=n.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=n.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=n.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=n.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&n.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=n.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||n.getExtension("OES_standard_derivatives"),this.extTimerQuery=n.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=n.getParameter(n.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(n,c){return new Ga(this,n,c)}createVertexBuffer(n,c,_){return new Vr(this,n,c,_)}createRenderbuffer(n,c,_){const y=this.gl,b=y.createRenderbuffer();return this.bindRenderbuffer.set(b),y.renderbufferStorage(y.RENDERBUFFER,n,c,_),this.bindRenderbuffer.set(null),b}createFramebuffer(n,c,_){return new kt(this,n,c,_)}clear({color:n,depth:c,stencil:_}){const y=this.gl;let b=0;n&&(b|=y.COLOR_BUFFER_BIT,this.clearColor.set(n),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(b|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),_!==void 0&&(b|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),y.clear(b)}setCullFace(n){n.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(n.mode),this.frontFace.set(n.frontFace))}setDepthMode(n){n.func!==this.gl.ALWAYS||n.mask?(this.depthTest.set(!0),this.depthFunc.set(n.func),this.depthMask.set(n.mask),this.depthRange.set(n.range)):this.depthTest.set(!1)}setStencilMode(n){n.test.func!==this.gl.ALWAYS||n.mask?(this.stencilTest.set(!0),this.stencilMask.set(n.mask),this.stencilOp.set([n.fail,n.depthFail,n.pass]),this.stencilFunc.set({func:n.test.func,ref:n.ref,mask:n.test.mask})):this.stencilTest.set(!1)}setColorMode(n){T(n.blendFunction,r.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(n.blendFunction),this.blendColor.set(n.blendColor)),this.colorMask.set(n.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ie extends r.Evented{constructor(n,c,_,y){if(super(),this.id=n,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.extend(this,r.pick(c,["url","scheme","tileSize","promoteId"])),this._options=r.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.DedupedRequest}load(n){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=bn(this._options,this.map._requestManager,c,_,(y,b)=>{this._tileJSONRequest=null,this._loaded=!0,y?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),_&&_.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new r.ErrorEvent(y))):b&&(r.extend(this,b),b.bounds&&(this.tileBounds=new ws(b.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(b.tiles,this.map._requestManager._customAccessToken),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(y)})}loaded(){return this._loaded}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}loadTile(n,c){const _=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(_,r.ResourceType.Tile),data:void 0,uid:n.uid,tileID:n.tileID,tileZoom:n.tileZoom,zoom:n.tileID.overscaledZ,tileSize:this.tileSize*n.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:n.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,n.actor&&n.state!=="expired")n.state==="loading"?n.reloadCallback=c:n.request=n.actor.send("reloadTile",y,b.bind(this));else if(n.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)n.request=n.actor.send("loadTile",y,b.bind(this),void 0,!0);else{const S=r.loadVectorTile.call({deduped:this._deduped},y,(M,P)=>{M||!P?b.call(this,M):(y.data={cacheControl:P.cacheControl,expires:P.expires,rawData:P.rawData.slice(0)},n.actor&&n.actor.send("loadTile",y,b.bind(this),void 0,!0))},!0);n.request={cancel:S}}function b(S,M){return delete n.request,n.aborted?c(null):S&&S.status!==404?c(S):(M&&M.resourceTiming&&(n.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&M&&n.setExpiryData(M),n.loadVectorData(M,this.map.painter),r.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(n.reloadCallback&&(this.loadTile(n,n.reloadCallback),n.reloadCallback=null)))}}abortTile(n){n.request&&(n.request.cancel(),delete n.request),n.actor&&n.actor.send("abortTile",{uid:n.uid,type:this.type,source:this.id})}unloadTile(n){n.unloadVectorData(),n.actor&&n.actor.send("removeTile",{uid:n.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Kt extends r.Evented{constructor(n,c,_,y){super(),this.id=n,this.dispatcher=_,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.extend({type:"raster"},c),r.extend(this,r.pick(c,["url","scheme","tileSize"]))}load(n){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=bn(this._options,this.map._requestManager,null,null,(c,_)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new r.ErrorEvent(c)):_&&(r.extend(this,_),_.bounds&&(this.tileBounds=new ws(_.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(_.tiles),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))),n&&n(c)})}loaded(){return this._loaded}onAdd(n){this.map=n,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(n){return this._options.tiles=n,this.reload(),this}setUrl(n){return this.url=n,this._options.url=n,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return r.extend({},this._options)}hasTile(n){return!this.tileBounds||this.tileBounds.contains(n.canonical)}loadTile(n,c){const _=r.exported.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(n.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);n.request=r.getImage(this.map._requestManager.transformRequest(y,r.ResourceType.Tile),(b,S,M,P)=>(delete n.request,n.aborted?(n.state="unloaded",c(null)):b?(n.state="errored",c(b)):S?(this.map._refreshExpiredTiles&&n.setExpiryData({cacheControl:M,expires:P}),n.setTexture(S,this.map.painter),n.state="loaded",r.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(n,c,_){n.setTexture(c,_)}static unloadTileData(n,c){n.texture&&c.saveTileTexture(n.texture)}abortTile(n,c){n.request&&(n.request.cancel(),delete n.request),c()}unloadTile(n,c){n.texture&&this.map.painter.saveTileTexture(n.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Me(d,n,c,_,y,b,S,M){const P=[d,c,y,n,_,b,1,1,1],z=[S,M,1],L=r.adjoint([],P),[N,$,X]=r.transformMat3(z,z,r.transpose(L,L));return r.multiply$1(P,[N,0,0,0,$,0,0,0,X],P)}class Pe extends r.Evented{constructor(n,c,_,y){super(),this.id=n,this.dispatcher=_,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(y),this.options=c,this._dirty=!1}load(n,c){this._loaded=c||!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=r.getImage(this.map._requestManager.transformRequest(this.url,r.ResourceType.Image),(_,y)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new r.ErrorEvent(_));else if(y){const{HTMLImageElement:b}=r.window;this.image=y instanceof b?r.exported.getImageData(y):y,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading()}})}loaded(){return this._loaded}updateImage(n){return this.image&&n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(n){this.coordinates=n,this._boundsArray=void 0;const c=n.map(r.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let y=1/0,b=1/0,S=-1/0,M=-1/0;for(const N of _)y=Math.min(y,N.x),b=Math.min(b,N.y),S=Math.max(S,N.x),M=Math.max(M,N.y);const P=Math.max(S-y,M-b),z=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),L=Math.pow(2,z);return new r.CanonicalTileID(z,Math.floor((y+S)/2*L),Math.floor((b+M)/2*L))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(n){for(const P in this.tiles){const z=this.tiles[P];z.state!=="loaded"&&(z.state="loaded",z.texture=this.texture)}if(this._boundsArray)return;const c=r.tileTransform(this.tileID,this.map.transform.projection),[_,y,b,S]=this.coordinates.map(P=>{const z=c.projection.project(P[0],P[1]);return r.getTilePoint(c,z)._round()});this.perspectiveTransform=function(P,z,L,N,$,X,J,K,Q,j){const H=Me(0,0,P,0,0,z,P,z),nt=Me(L,N,$,X,J,K,Q,j);return r.multiply$1(nt,r.adjoint(H,H),nt),[nt[6]/nt[8]*P/r.EXTENT,nt[7]/nt[8]*z/r.EXTENT]}(this.width,this.height,_.x,_.y,y.x,y.y,S.x,S.y,b.x,b.y);const M=this._boundsArray=new r.StructArrayLayout4i8;M.emplaceBack(_.x,_.y,0,0),M.emplaceBack(y.x,y.y,r.EXTENT,0),M.emplaceBack(S.x,S.y,0,r.EXTENT),M.emplaceBack(b.x,b.y,r.EXTENT,r.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=n.createVertexBuffer(M,r.boundsAttributes.members),this.boundsSegments=r.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const n=this.map.painter.context,c=n.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new r.Texture(n,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(n)}loadTile(n,c){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},c(null)):(n.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Ae={vector:ie,raster:Kt,"raster-dem":class extends Kt{constructor(d,n,c,_){super(d,n,c,_),this.type="raster-dem",this.maxzoom=22,this._options=r.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(d,n){const c=this.map._requestManager.normalizeTileURL(d.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(y,b){y&&(d.state="errored",n(y)),b&&(d.dem=b,d.dem.onDeserialize(),d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0,d.state="loaded",n(null))}d.request=r.getImage(this.map._requestManager.transformRequest(c,r.ResourceType.Tile),(function(y,b,S,M){if(delete d.request,d.aborted)d.state="unloaded",n(null);else if(y)d.state="errored",n(y);else if(b){this.map._refreshExpiredTiles&&d.setExpiryData({cacheControl:S,expires:M});const P=r.window.ImageBitmap&&b instanceof r.window.ImageBitmap&&($r==null&&($r=r.window.OffscreenCanvas&&new r.window.OffscreenCanvas(1,1).getContext("2d")&&typeof r.window.createImageBitmap=="function"),$r),z=1-(b.width-r.prevPowerOfTwo(b.width))/2;z<1||d.neighboringTiles||(d.neighboringTiles=this._getNeighboringTiles(d.tileID));const L=P?b:r.exported.getImageData(b,z),N={uid:d.uid,coord:d.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:z};d.actor&&d.state!=="expired"||(d.actor=this.dispatcher.getActor(),d.actor.send("loadDEMTile",N,_.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(d){const n=d.canonical,c=Math.pow(2,n.z),_=(n.x-1+c)%c,y=n.x===0?d.wrap-1:d.wrap,b=(n.x+1+c)%c,S=n.x+1===c?d.wrap+1:d.wrap,M={};return M[new r.OverscaledTileID(d.overscaledZ,y,n.z,_,n.y).key]={backfilled:!1},M[new r.OverscaledTileID(d.overscaledZ,S,n.z,b,n.y).key]={backfilled:!1},n.y>0&&(M[new r.OverscaledTileID(d.overscaledZ,y,n.z,_,n.y-1).key]={backfilled:!1},M[new r.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},M[new r.OverscaledTileID(d.overscaledZ,S,n.z,b,n.y-1).key]={backfilled:!1}),n.y+1<c&&(M[new r.OverscaledTileID(d.overscaledZ,y,n.z,_,n.y+1).key]={backfilled:!1},M[new r.OverscaledTileID(d.overscaledZ,d.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},M[new r.OverscaledTileID(d.overscaledZ,S,n.z,b,n.y+1).key]={backfilled:!1}),M}unloadTile(d){d.demTexture&&this.map.painter.saveTileTexture(d.demTexture),d.fbo&&(d.fbo.destroy(),delete d.fbo),d.dem&&delete d.dem,delete d.neighboringTiles,d.state="unloaded"}},geojson:class extends r.Evented{constructor(d,n,c,_){super(),this.id=d,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(_),this._data=n.data,this._options=r.extend({},n),this._collectResourceTiming=n.collectResourceTiming,n.maxzoom!==void 0&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const y=r.EXTENT/this.tileSize;this.workerOptions=r.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(n.buffer!==void 0?n.buffer:128)*y,tolerance:(n.tolerance!==void 0?n.tolerance:.375)*y,extent:r.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:n.clusterMaxZoom!==void 0?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:r.EXTENT,radius:(n.clusterRadius!==void 0?n.clusterRadius:50)*y,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(d){this.map=d,this.setData(this._data)}setData(d){return this._data=d,this._updateWorkerData(),this}getClusterExpansionZoom(d,n){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:d,source:this.id},n),this}getClusterChildren(d,n){return this.actor.send("geojson.getClusterChildren",{clusterId:d,source:this.id},n),this}getClusterLeaves(d,n,c,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:d,limit:n,offset:c},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.Event("dataloading",{dataType:"source"})),this._loaded=!1;const d=r.extend({},this.workerOptions),n=this._data;typeof n=="string"?(d.request=this.map._requestManager.transformRequest(r.exported.resolveURL(n),r.ResourceType.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,d,(c,_)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new r.ErrorEvent(c));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),this.fire(new r.Event("data",y)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(d,n){const c=d.actor?"reloadTile":"loadTile";d.actor=this.actor,d.request=this.actor.send(c,{type:this.type,uid:d.uid,tileID:d.tileID,tileZoom:d.tileZoom,zoom:d.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,y)=>(delete d.request,d.unloadVectorData(),d.aborted?n(null):_?n(_):(d.loadVectorData(y,this.map.painter,c==="reloadTile"),n(null))),void 0,c==="loadTile")}abortTile(d){d.request&&(d.request.cancel(),delete d.request),d.aborted=!0}unloadTile(d){d.unloadVectorData(),this.actor.send("removeTile",{uid:d.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Pe{constructor(d,n,c,_){super(d,n,c,_),this.roundZoom=!0,this.type="video",this.options=n}load(){this._loaded=!1;const d=this.options;this.urls=[];for(const n of d.urls)this.urls.push(this.map._requestManager.transformRequest(n,r.ResourceType.Source).url);r.getVideo(this.urls,(n,c)=>{this._loaded=!0,n?this.fire(new r.ErrorEvent(n)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(d){if(this.video){const n=this.video.seekable;d<n.start(0)||d>n.end(0)?this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=d}}getVideo(){return this.video}onAdd(d){this.map||(this.map=d,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const d=this.map.painter.context,n=d.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new r.Texture(d,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(d)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Pe,canvas:class extends Pe{constructor(d,n,c,_){super(d,n,c,_),n.coordinates?Array.isArray(n.coordinates)&&n.coordinates.length===4&&!n.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(b=>typeof b!="number"))||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${d}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${d}`,null,'missing required property "coordinates"'))),n.animate&&typeof n.animate!="boolean"&&this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${d}`,null,'optional "animate" property must be a boolean value'))),n.canvas?typeof n.canvas=="string"||n.canvas instanceof r.window.HTMLCanvasElement||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${d}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${d}`,null,'missing required property "canvas"'))),this.options=n,this.animate=n.animate===void 0||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof r.window.HTMLCanvasElement?this.options.canvas:r.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(d){this.map=d,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let d=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,d=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,d=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const n=this.map.painter.context;this.texture?(d||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const d of[this.canvas.width,this.canvas.height])if(isNaN(d)||d<=0)return!0;return!1}},custom:class extends r.Evented{constructor(d,n,c,_){super(),this.id=d,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=n,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ws(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.clearTiles=this._clearTiles.bind(this),n.coveringTiles=this._coveringTiles.bind(this),r.extend(this,r.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(d){this._map=d,this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(d),this.load()}onRemove(d){this._implementation.onRemove&&this._implementation.onRemove(d)}hasTile(d){if(this._implementation.hasTile){const{x:n,y:c,z:_}=d.canonical;return this._implementation.hasTile({x:n,y:c,z:_})}return!this.tileBounds||this.tileBounds.contains(d.canonical)}loadTile(d,n){const{x:c,y:_,z:y}=d.tileID.canonical,b=new r.window.AbortController;d.request=Promise.resolve(this._implementation.loadTile({x:c,y:_,z:y},{signal:b.signal})).then((function(S){return delete d.request,d.aborted?(d.state="unloaded",n(null)):S===void 0?(d.state="errored",n(null)):S===null?(this.loadTileData(d,{width:this.tileSize,height:this.tileSize,data:null}),d.state="loaded",n(null)):function(M){return M instanceof r.window.ImageData||M instanceof r.window.HTMLCanvasElement||M instanceof r.window.ImageBitmap||M instanceof r.window.HTMLImageElement}(S)?(this.loadTileData(d,S),d.state="loaded",void n(null)):(d.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.code!==20&&(d.state="errored",n(S))}),d.request.cancel=()=>b.abort()}loadTileData(d,n){Kt.loadTileData(d,n,this._map.painter)}unloadTileData(d){Kt.unloadTileData(d,this._map.painter)}unloadTile(d,n){if(this.unloadTileData(d),this._implementation.unloadTile){const{x:c,y:_,z:y}=d.tileID.canonical;this._implementation.unloadTile({x:c,y:_,z:y})}n()}abortTile(d,n){d.request&&d.request.cancel&&(d.request.cancel(),delete d.request),n()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(d=>({x:d.canonical.x,y:d.canonical.y,z:d.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}}},ke=function(d,n,c,_){const y=new Ae[n.type](d,n,c,_);if(y.id!==d)throw new Error(`Expected Source id to be ${d} instead of ${y.id}`);return r.bindAll(["load","abort","unload","serialize","prepare"],y),y};function je(d,n){const c=r.identity([]);return r.scale(c,c,[.5*d.width,.5*-d.height,1]),r.translate(c,c,[1,-1,0]),r.multiply(c,c,d.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(c)}function Si(d,n,c,_,y,b,S,M=!1){const P=d.tilesIn(_,S,M);P.sort(un);const z=[];for(const N of P)z.push({wrappedTileID:N.tile.tileID.wrapped().key,queryResults:N.tile.queryRenderedFeatures(n,c,d._state,N,y,b,je(d.transform,N.tile.tileID),M)});const L=function(N){const $={},X={};for(const J of N){const K=J.queryResults,Q=J.wrappedTileID,j=X[Q]=X[Q]||{};for(const H in K){const nt=K[H],st=j[H]=j[H]||{},ft=$[H]=$[H]||[];for(const mt of nt)st[mt.featureIndex]||(st[mt.featureIndex]=!0,ft.push(mt))}}return $}(z);for(const N in L)L[N].forEach($=>{const X=$.feature,J=X.layer;J&&J.type!=="background"&&J.type!=="sky"&&(X.source=J.source,J["source-layer"]&&(X.sourceLayer=J["source-layer"]),X.state=X.id!==void 0?d.getFeatureState(J["source-layer"],X.id):{})});return L}function Ni(d,n){const c=d.getRenderableIds().map(b=>d.getTileByID(b)),_=[],y={};for(let b=0;b<c.length;b++){const S=c[b],M=S.tileID.canonical.key;y[M]||(y[M]=!0,S.querySourceFeatures(_,n))}return _}function un(d,n){const c=d.tileID,_=n.tileID;return c.overscaledZ-_.overscaledZ||c.canonical.y-_.canonical.y||c.wrap-_.wrap||c.canonical.x-_.canonical.x}function Hi(){return uo.workerClass!=null?new uo.workerClass:new r.window.Worker(uo.workerUrl)}const cs="mapboxgl_preloaded_worker_pool";class Qi{constructor(){this.active={}}acquire(n){if(!this.workers)for(this.workers=[];this.workers.length<Qi.workerCount;)this.workers.push(new Hi);return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[cs]}numActive(){return Object.keys(this.active).length}}let yn;function Zr(){return yn||(yn=new Qi),yn}function Op(d,n){const c={};for(const _ in d)_!=="ref"&&(c[_]=d[_]);return r.refProperties.forEach(_=>{_ in n&&(c[_]=n[_])}),c}function fu(d){d=d.slice();const n=Object.create(null);for(let c=0;c<d.length;c++)n[d[c].id]=d[c];for(let c=0;c<d.length;c++)"ref"in d[c]&&(d[c]=Op(d[c],n[d[c].ref]));return d}Qi.workerCount=2;const He={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function rc(d,n,c){c.push({command:He.addSource,args:[d,n[d]]})}function Vo(d,n,c){n.push({command:He.removeSource,args:[d]}),c[d]=!0}function oc(d,n,c,_){Vo(d,c,_),rc(d,n,c)}function Ha(d,n,c){let _;for(_ in d[c])if(d[c].hasOwnProperty(_)&&_!=="data"&&!T(d[c][_],n[c][_]))return!1;for(_ in n[c])if(n[c].hasOwnProperty(_)&&_!=="data"&&!T(d[c][_],n[c][_]))return!1;return!0}function hs(d,n,c,_,y,b){let S;for(S in n=n||{},d=d||{})d.hasOwnProperty(S)&&(T(d[S],n[S])||c.push({command:b,args:[_,S,n[S],y]}));for(S in n)n.hasOwnProperty(S)&&!d.hasOwnProperty(S)&&(T(d[S],n[S])||c.push({command:b,args:[_,S,n[S],y]}))}function Es(d){return d.id}function ac(d,n){return d[n.id]=n,d}class lc{constructor(n,c){this.reset(n,c)}reset(n,c){this.points=n||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(n){if(this.points.length===1)return this.points[0];n=r.clamp(n,0,1);let c=1,_=this._distances[c];const y=n*this.paddedLength+this.padding;for(;_<y&&c<this._distances.length;)_=this._distances[++c];const b=c-1,S=this._distances[b],M=_-S,P=M>0?(y-S)/M:0;return this.points[b].mult(1-P).add(this.points[c].mult(P))}}class mr{constructor(n,c,_){const y=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(n/_),this.yCellCount=Math.ceil(c/_);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=n,this.height=c,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(n,c,_,y,b){this._forEachCell(c,_,y,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(n),this.bboxes.push(c),this.bboxes.push(_),this.bboxes.push(y),this.bboxes.push(b)}insertCircle(n,c,_,y){this._forEachCell(c-y,_-y,c+y,_+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(n),this.circles.push(c),this.circles.push(_),this.circles.push(y)}_insertBoxCell(n,c,_,y,b,S){this.boxCells[b].push(S)}_insertCircleCell(n,c,_,y,b,S){this.circleCells[b].push(S)}_query(n,c,_,y,b,S){if(_<0||n>this.width||y<0||c>this.height)return!b&&[];const M=[];if(n<=0&&c<=0&&this.width<=_&&this.height<=y){if(b)return!0;for(let P=0;P<this.boxKeys.length;P++)M.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const z=this.circles[3*P],L=this.circles[3*P+1],N=this.circles[3*P+2];M.push({key:this.circleKeys[P],x1:z-N,y1:L-N,x2:z+N,y2:L+N})}return S?M.filter(S):M}return this._forEachCell(n,c,_,y,this._queryCell,M,{hitTest:b,seenUids:{box:{},circle:{}}},S),b?M.length>0:M}_queryCircle(n,c,_,y,b){const S=n-_,M=n+_,P=c-_,z=c+_;if(M<0||S>this.width||z<0||P>this.height)return!y&&[];const L=[];return this._forEachCell(S,P,M,z,this._queryCellCircle,L,{hitTest:y,circle:{x:n,y:c,radius:_},seenUids:{box:{},circle:{}}},b),y?L.length>0:L}query(n,c,_,y,b){return this._query(n,c,_,y,!1,b)}hitTest(n,c,_,y,b){return this._query(n,c,_,y,!0,b)}hitTestCircle(n,c,_,y){return this._queryCircle(n,c,_,!0,y)}_queryCell(n,c,_,y,b,S,M,P){const z=M.seenUids,L=this.boxCells[b];if(L!==null){const $=this.bboxes;for(const X of L)if(!z.box[X]){z.box[X]=!0;const J=4*X;if(n<=$[J+2]&&c<=$[J+3]&&_>=$[J+0]&&y>=$[J+1]&&(!P||P(this.boxKeys[X]))){if(M.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[X],x1:$[J],y1:$[J+1],x2:$[J+2],y2:$[J+3]})}}}const N=this.circleCells[b];if(N!==null){const $=this.circles;for(const X of N)if(!z.circle[X]){z.circle[X]=!0;const J=3*X;if(this._circleAndRectCollide($[J],$[J+1],$[J+2],n,c,_,y)&&(!P||P(this.circleKeys[X]))){if(M.hitTest)return S.push(!0),!0;{const K=$[J],Q=$[J+1],j=$[J+2];S.push({key:this.circleKeys[X],x1:K-j,y1:Q-j,x2:K+j,y2:Q+j})}}}}}_queryCellCircle(n,c,_,y,b,S,M,P){const z=M.circle,L=M.seenUids,N=this.boxCells[b];if(N!==null){const X=this.bboxes;for(const J of N)if(!L.box[J]){L.box[J]=!0;const K=4*J;if(this._circleAndRectCollide(z.x,z.y,z.radius,X[K+0],X[K+1],X[K+2],X[K+3])&&(!P||P(this.boxKeys[J])))return S.push(!0),!0}}const $=this.circleCells[b];if($!==null){const X=this.circles;for(const J of $)if(!L.circle[J]){L.circle[J]=!0;const K=3*J;if(this._circlesCollide(X[K],X[K+1],X[K+2],z.x,z.y,z.radius)&&(!P||P(this.circleKeys[J])))return S.push(!0),!0}}}_forEachCell(n,c,_,y,b,S,M,P){const z=this._convertToXCellCoord(n),L=this._convertToYCellCoord(c),N=this._convertToXCellCoord(_),$=this._convertToYCellCoord(y);for(let X=z;X<=N;X++)for(let J=L;J<=$;J++)if(b.call(this,n,c,_,y,this.xCellCount*J+X,S,M,P))return}_convertToXCellCoord(n){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(n*this.xScale)))}_convertToYCellCoord(n){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(n*this.yScale)))}_circlesCollide(n,c,_,y,b,S){const M=y-n,P=b-c,z=_+S;return z*z>M*M+P*P}_circleAndRectCollide(n,c,_,y,b,S,M){const P=(S-y)/2,z=Math.abs(n-(y+P));if(z>P+_)return!1;const L=(M-b)/2,N=Math.abs(c-(b+L));if(N>L+_)return!1;if(z<=P||N<=L)return!0;const $=z-P,X=N-L;return $*$+X*X<=_*_}}const Ss={unknown:0,flipRequired:1,flipNotRequired:2},Uo=Math.tan(85*Math.PI/180);function Ot(d,n,c,_,y,b,S){const M=r.create();if(c)if(b.name==="globe"){const P=r.calculateGlobeLabelMatrix(y,n);r.multiply(M,M,P)}else{const P=Lt([],S);M[0]=P[0],M[1]=P[1],M[4]=P[2],M[5]=P[3],_||r.rotateZ(M,M,y.angle)}else r.multiply(M,y.labelPlaneMatrix,d);return M}function Ms(d,n,c,_,y,b,S){const M=Ot(d,n,c,_,y,b,S);return b.name==="globe"&&c||(M[2]=M[6]=M[10]=M[14]=0),M}function ji(d,n,c,_,y,b,S){if(c){if(b.name==="globe"){const M=Ot(d,n,c,_,y,b,S);return r.invert(M,M),r.multiply(M,d,M),M}{const M=r.clone(d),P=r.identity([]);return P[0]=S[0],P[1]=S[1],P[4]=S[2],P[5]=S[3],r.multiply(M,M,P),_||r.rotateZ(M,M,-y.angle),M}}return y.glCoordMatrix}function tn(d,n,c,_){const y=[d,n,c,1];c?r.transformMat4$1(y,y,_):Oe(y,y,_);const b=y[3];return y[0]/=b,y[1]/=b,y[2]/=b,y}function _u(d,n){return Math.min(.5+d/n*.5,1.5)}function us(d,n){const c=d[0]/d[3],_=d[1]/d[3];return c>=-n[0]&&c<=n[0]&&_>=-n[1]&&_<=n[1]}function cc(d,n,c,_,y,b,S,M,P,z){const L=c.transform,N=_?d.textSizeData:d.iconSizeData,$=r.evaluateSizeForZoom(N,c.transform.zoom),X=L.projection.name==="globe",J=[256/c.width*2+1,256/c.height*2+1],K=_?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;K.clear();let Q=null;X&&(Q=_?d.text.globeExtVertexArray:d.icon.globeExtVertexArray);const j=d.lineVertexArray,H=_?d.text.placedSymbolArray:d.icon.placedSymbolArray,nt=c.transform.width/c.transform.height;let st,ft=!1;for(let mt=0;mt<H.length;mt++){const _t=H.get(mt),{numGlyphs:vt,writingMode:xt}=_t;if(xt!==r.WritingMode.vertical||ft||st===r.WritingMode.horizontal||(ft=!0),st=xt,(_t.hidden||xt===r.WritingMode.vertical)&&!ft){ts(vt,K);continue}ft=!1;const At=new r.Point(_t.tileAnchorX,_t.tileAnchorY);let{x:Zt,y:Et,z:jt}=L.projection.projectTilePoint(At.x,At.y,z.canonical);if(P){const[we,de,xe]=P(At);Zt+=we,Et+=de,jt+=xe}const It=[Zt,Et,jt,1];if(r.transformMat4$1(It,It,n),!us(It,J)){ts(vt,K);continue}const $t=_u(c.transform.cameraToCenterDistance,It[3]),Mt=r.evaluateSizeForFeature(N,$,_t),Nt=S?Mt/$t:Mt*$t,Xt=tn(Zt,Et,jt,y);if(Xt[3]<=0){ts(vt,K);continue}let Gt={};const Yt=S?null:P,me=le(_t,Nt,!1,M,n,y,b,d.glyphOffsetArray,j,K,Q,Xt,At,Gt,nt,Yt,L.projection,z,S);ft=me.useVertical,Yt&&me.needsFlipping&&(Gt={}),(me.notEnoughRoom||ft||me.needsFlipping&&le(_t,Nt,!0,M,n,y,b,d.glyphOffsetArray,j,K,Q,Xt,At,Gt,nt,Yt,L.projection,z,S).notEnoughRoom)&&ts(vt,K)}_?(d.text.dynamicLayoutVertexBuffer.updateData(K),Q&&d.text.globeExtVertexBuffer.updateData(Q)):(d.icon.dynamicLayoutVertexBuffer.updateData(K),Q&&d.icon.globeExtVertexBuffer.updateData(Q))}function mu(d,n,c,_,y,b,S,M,P,z,L,N,$,X,J,K){const{lineStartIndex:Q,glyphStartIndex:j,segment:H}=M,nt=j+M.numGlyphs,st=Q+M.lineLength,ft=n.getoffsetX(j),mt=n.getoffsetX(nt-1),_t=On(d*ft,c,_,y,b,S,H,Q,st,P,z,L,N,$,!0,X,J,K);if(!_t)return null;const vt=On(d*mt,c,_,y,b,S,H,Q,st,P,z,L,N,$,!0,X,J,K);return vt?{first:_t,last:vt}:null}function Hr(d,n,c,_){return d===r.WritingMode.horizontal&&Math.abs(_)>Math.abs(c)?{useVertical:!0}:d===r.WritingMode.vertical?_>0?{needsFlipping:!0}:null:n!==Ss.unknown&&function(y,b){return y===0||Math.abs(b/y)>Uo}(c,_)?n===Ss.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function le(d,n,c,_,y,b,S,M,P,z,L,N,$,X,J,K,Q,j,H){const nt=n/24,st=d.lineOffsetX*nt,ft=d.lineOffsetY*nt,{lineStartIndex:mt,glyphStartIndex:_t,numGlyphs:vt,segment:xt,writingMode:At,flipState:Zt}=d,Et=mt+d.lineLength,jt=It=>{if(L){const[Xt,Gt,Yt]=It.up,me=z.length;r.updateGlobeVertexNormal(L,me+0,Xt,Gt,Yt),r.updateGlobeVertexNormal(L,me+1,Xt,Gt,Yt),r.updateGlobeVertexNormal(L,me+2,Xt,Gt,Yt),r.updateGlobeVertexNormal(L,me+3,Xt,Gt,Yt)}const[$t,Mt,Nt]=It.point;r.addDynamicAttributes(z,$t,Mt,Nt,It.angle)};if(vt>1){const It=mu(nt,M,st,ft,c,N,$,d,P,b,X,K,!1,Q,j,H);if(!It)return{notEnoughRoom:!0};if(_&&!c){let[$t,Mt,Nt]=It.first.point,[Xt,Gt,Yt]=It.last.point;[$t,Mt]=tn($t,Mt,Nt,S),[Xt,Gt]=tn(Xt,Gt,Yt,S);const me=Hr(At,Zt,(Xt-$t)*J,Gt-Mt);if(d.flipState=me&&me.needsFlipping?Ss.flipRequired:Ss.flipNotRequired,me)return me}jt(It.first);for(let $t=_t+1;$t<_t+vt-1;$t++){const Mt=On(nt*M.getoffsetX($t),st,ft,c,N,$,xt,mt,Et,P,b,X,K,!1,!1,Q,j,H);if(!Mt)return z.length-=4*($t-_t),{notEnoughRoom:!0};jt(Mt)}jt(It.last)}else{if(_&&!c){const $t=tn($.x,$.y,0,y),Mt=mt+xt+1,Nt=new r.Point(P.getx(Mt),P.gety(Mt)),Xt=tn(Nt.x,Nt.y,0,y),Gt=Xt[3]>0?Xt:Re($,Nt,$t,1,y,void 0,Q,j.canonical),Yt=Hr(At,Zt,(Gt[0]-$t[0])*J,Gt[1]-$t[1]);if(d.flipState=Yt&&Yt.needsFlipping?Ss.flipRequired:Ss.flipNotRequired,Yt)return Yt}const It=On(nt*M.getoffsetX(_t),st,ft,c,N,$,xt,mt,Et,P,b,X,K,!1,!1,Q,j,H);if(!It)return{notEnoughRoom:!0};jt(It)}return{}}function Fe(d,n,c,_,y){const{x:b,y:S,z:M}=_.projectTilePoint(d.x,d.y,n);if(!y)return tn(b,S,M,c);const[P,z,L]=y(d);return tn(b+P,S+z,M+L,c)}function Re(d,n,c,_,y,b,S,M){const P=Fe(d.sub(n)._unit()._add(d),M,y,S,b);return r.sub(P,c,P),r.normalize(P,P),r.scaleAndAdd(P,c,P,_)}function On(d,n,c,_,y,b,S,M,P,z,L,N,$,X,J,K,Q,j){const H=_?d-n:d+n;let nt=H>0?1:-1,st=0;_&&(nt*=-1,st=Math.PI),nt<0&&(st+=Math.PI);let ft=M+S+(nt>0?0:1)|0,mt=y,_t=y,vt=0,xt=0;const At=Math.abs(H),Zt=[],Et=[];let jt=b,It=jt;const $t=()=>Re(It,jt,_t,At-vt+1,L,$,K,Q.canonical);for(;vt+xt<=At;){if(ft+=nt,ft<M||ft>=P)return null;if(_t=mt,It=jt,Zt.push(_t),X&&Et.push(It),jt=new r.Point(z.getx(ft),z.gety(ft)),mt=N[ft],!mt){const xe=Fe(jt,Q.canonical,L,K,$);mt=xe[3]>0?N[ft]=xe:$t()}vt+=xt,xt=r.distance(_t,mt)}J&&$&&(N[ft]&&(mt=$t(),xt=r.distance(_t,mt)),N[ft]=mt);const Mt=(At-vt)/xt,Nt=jt.sub(It)._mult(Mt)._add(It),Xt=r.sub([],mt,_t),Gt=r.scaleAndAdd([],_t,Xt,Mt);let Yt=[0,0,1],me=Xt[0],we=Xt[1];if(j&&(Yt=K.upVector(Q.canonical,Nt.x,Nt.y),Yt[0]!==0||Yt[1]!==0||Yt[2]!==1)){const xe=[Yt[2],0,-Yt[0]],Be=r.cross([],Yt,xe);r.normalize(xe,xe),r.normalize(Be,Be),me=r.dot(Xt,xe),we=r.dot(Xt,Be)}if(c){const xe=r.cross([],Yt,Xt);r.normalize(xe,xe),r.scaleAndAdd(Gt,Gt,xe,c*nt)}const de=st+Math.atan2(we,me);return Zt.push(Gt),X&&Et.push(Nt),{point:Gt,angle:de,path:Zt,tilePath:Et,up:Yt}}function ts(d,n){const c=n.length,_=c+4*d;n.resize(_),n.float32.fill(-1/0,4*c,4*_)}function Oe(d,n,c){const _=n[0],y=n[1];return d[0]=c[0]*_+c[4]*y+c[12],d[1]=c[1]*_+c[5]*y+c[13],d[3]=c[3]*_+c[7]*y+c[15],d}const Bn=100;class Go{constructor(n,c,_=new mr(n.width+200,n.height+200,25),y=new mr(n.width+200,n.height+200,25)){this.transform=n,this.grid=_,this.ignoredGrid=y,this.pitchfactor=Math.cos(n._pitch)*n.cameraToCenterDistance,this.screenRightBoundary=n.width+Bn,this.screenBottomBoundary=n.height+Bn,this.gridRightBoundary=n.width+200,this.gridBottomBoundary=n.height+200,this.fogState=c}placeCollisionBox(n,c,_,y,b,S,M,P){let z=_.projectedAnchorX,L=_.projectedAnchorY,N=_.projectedAnchorZ;const $=_.elevation,X=_.tileID,J=n.getProjection();if($&&X){const[mt,_t,vt]=J.upVector(X.canonical,_.tileAnchorX,_.tileAnchorY),xt=J.upVectorScale(X.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;z+=mt*$*xt,L+=_t*$*xt,N+=vt*$*xt}const K=this.projectAndGetPerspectiveRatio(M,z,L,N,_.tileID,J.name==="globe"||!!$||this.transform.pitch>0,J),Q=S*K.perspectiveRatio,j=(_.x1*c+y.x-_.padding)*Q+K.point.x,H=(_.y1*c+y.y-_.padding)*Q+K.point.y,nt=(_.x2*c+y.x+_.padding)*Q+K.point.x,st=(_.y2*c+y.y+_.padding)*Q+K.point.y,ft=K.perspectiveRatio<=.55||K.occluded;return!this.isInsideGrid(j,H,nt,st)||!b&&this.grid.hitTest(j,H,nt,st,P)||ft?{box:[],offscreen:!1,occluded:K.occluded}:{box:[j,H,nt,st],offscreen:this.isOffscreen(j,H,nt,st),occluded:!1}}placeCollisionCircles(n,c,_,y,b,S,M,P,z,L,N,$,X,J,K){const Q=[],j=this.transform.elevation,H=n.getProjection(),nt=j?j.getAtTileOffsetFunc(K,this.transform.center.lat,this.transform.worldSize,H):null,st=new r.Point(_.tileAnchorX,_.tileAnchorY);let{x:ft,y:mt,z:_t}=H.projectTilePoint(st.x,st.y,K.canonical);if(nt){const[Nt,Xt,Gt]=nt(st);ft+=Nt,mt+=Xt,_t+=Gt}const vt=H.name==="globe",xt=this.projectAndGetPerspectiveRatio(M,ft,mt,_t,K,vt||!!j||this.transform.pitch>0,H),{perspectiveRatio:At}=xt,Zt=(N?S/At:S*At)/r.ONE_EM,Et=tn(ft,mt,_t,P),jt=xt.signedDistanceFromCamera>0?mu(Zt,b,_.lineOffsetX*Zt,_.lineOffsetY*Zt,!1,Et,st,_,y,P,{},j&&!N?nt:null,N&&!!j,H,K,N):null;let It=!1,$t=!1,Mt=!0;if(jt&&!xt.occluded){const Nt=.5*X*At+J,Xt=new r.Point(-100,-100),Gt=new r.Point(this.screenRightBoundary,this.screenBottomBoundary),Yt=new lc,{first:me,last:we}=jt,de=me.path.length;let xe=[];for(let _e=de-1;_e>=1;_e--)xe.push(me.path[_e]);for(let _e=1;_e<we.path.length;_e++)xe.push(we.path[_e]);const Be=2.5*Nt;z&&(xe=xe.map(([_e,Je,ii],ni)=>(nt&&!vt&&(ii=nt(ni<de-1?me.tilePath[de-1-ni]:we.tilePath[ni-de+2])[2]),tn(_e,Je,ii,z))),xe.some(_e=>_e[3]<=0)&&(xe=[]));let De=[];if(xe.length>0){let _e=1/0,Je=-1/0,ii=1/0,ni=-1/0;for(const si of xe)_e=Math.min(_e,si[0]),ii=Math.min(ii,si[1]),Je=Math.max(Je,si[0]),ni=Math.max(ni,si[1]);Je>=Xt.x&&_e<=Gt.x&&ni>=Xt.y&&ii<=Gt.y&&(De=[xe.map(si=>new r.Point(si[0],si[1]))],(_e<Xt.x||Je>Gt.x||ii<Xt.y||ni>Gt.y)&&(De=r.clipLine(De,Xt.x,Xt.y,Gt.x,Gt.y)))}for(const _e of De){Yt.reset(_e,.25*Nt);let Je=0;Je=Yt.length<=.5*Nt?1:Math.ceil(Yt.paddedLength/Be)+1;for(let ii=0;ii<Je;ii++){const ni=ii/Math.max(Je-1,1),si=Yt.lerp(ni),pn=si.x+Bn,nn=si.y+Bn;Q.push(pn,nn,Nt,0);const Wn=pn-Nt,_s=nn-Nt,wi=pn+Nt,ri=nn+Nt;if(Mt=Mt&&this.isOffscreen(Wn,_s,wi,ri),$t=$t||this.isInsideGrid(Wn,_s,wi,ri),!c&&this.grid.hitTestCircle(pn,nn,Nt,$)&&(It=!0,!L))return{circles:[],offscreen:!1,collisionDetected:It,occluded:!1}}}}return{circles:!L&&It||!$t?[]:Q,offscreen:Mt,collisionDetected:It,occluded:xt.occluded}}queryRenderedSymbols(n){if(n.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let _=1/0,y=1/0,b=-1/0,S=-1/0;for(const L of n){const N=new r.Point(L.x+Bn,L.y+Bn);_=Math.min(_,N.x),y=Math.min(y,N.y),b=Math.max(b,N.x),S=Math.max(S,N.y),c.push(N)}const M=this.grid.query(_,y,b,S).concat(this.ignoredGrid.query(_,y,b,S)),P={},z={};for(const L of M){const N=L.key;if(P[N.bucketInstanceId]===void 0&&(P[N.bucketInstanceId]={}),P[N.bucketInstanceId][N.featureIndex])continue;const $=[new r.Point(L.x1,L.y1),new r.Point(L.x2,L.y1),new r.Point(L.x2,L.y2),new r.Point(L.x1,L.y2)];r.polygonIntersectsPolygon(c,$)&&(P[N.bucketInstanceId][N.featureIndex]=!0,z[N.bucketInstanceId]===void 0&&(z[N.bucketInstanceId]=[]),z[N.bucketInstanceId].push(N.featureIndex))}return z}insertCollisionBox(n,c,_,y,b){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:y,collisionGroupID:b},n[0],n[1],n[2],n[3])}insertCollisionCircles(n,c,_,y,b){const S=c?this.ignoredGrid:this.grid,M={bucketInstanceId:_,featureIndex:y,collisionGroupID:b};for(let P=0;P<n.length;P+=4)S.insertCircle(M,n[P],n[P+1],n[P+2])}projectAndGetPerspectiveRatio(n,c,_,y,b,S,M){const P=[c,_,y,1];let z=!1;y||this.transform.pitch>0?(r.transformMat4$1(P,P,n),this.fogState&&b&&M.name!=="globe"&&(z=function($,X,J,K,Q,j){const H=j.calculateFogTileMatrix(Q),nt=[X,J,K];return r.transformMat4(nt,nt,H),ei($,nt,j.pitch,j._fov)}(this.fogState,c,_,y,b.toUnwrapped(),this.transform)>.9)):Oe(P,P,n);const L=P[3];return{point:new r.Point((P[0]/L+1)/2*this.transform.width+Bn,(-P[1]/L+1)/2*this.transform.height+Bn),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/L*.5,1.5),signedDistanceFromCamera:L,occluded:S&&P[2]>L||z}}isOffscreen(n,c,_,y){return _<Bn||n>=this.screenRightBoundary||y<Bn||c>this.screenBottomBoundary}isInsideGrid(n,c,_,y){return _>=0&&n<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const n=r.identity([]);return r.translate(n,n,[-100,-100,0]),n}}function gr(d,n,c){const _=n.createTileMatrix(d,d.worldSize,c.toUnwrapped());return r.multiply(new Float32Array(16),d.projMatrix,_)}function Un(d,n,c){if(n.projection.name===c.projection.name)return d.projMatrix;const _=c.clone();return _.setProjection(n.projection),gr(_,n.getProjection(),d)}function bi(d,n,c){return n.name===c.projection.name?d.projMatrix:gr(c,n,d)}class gu{constructor(n,c,_,y){this.opacity=n?Math.max(0,Math.min(1,n.opacity+(n.placed?c:-c))):y&&_?1:0,this.placed=_}isHidden(){return this.opacity===0&&!this.placed}}class As{constructor(n,c,_,y,b,S=!1){this.text=new gu(n?n.text:null,c,_,b),this.icon=new gu(n?n.icon:null,c,y,b),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class qo{constructor(n,c,_,y=!1){this.text=n,this.icon=c,this.skipFade=_,this.clipped=y}}class $o{constructor(){this.invProjMatrix=r.create(),this.viewportMatrix=r.create(),this.circles=[]}}class hc{constructor(n,c,_,y,b){this.bucketInstanceId=n,this.featureIndex=c,this.sourceLayerIndex=_,this.bucketIndex=y,this.tileID=b}}class yu{constructor(n){this.crossSourceCollisions=n,this.maxGroupID=0,this.collisionGroups={}}get(n){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[n]){const c=++this.maxGroupID;this.collisionGroups[n]={ID:c,predicate:_=>_.collisionGroupID===c}}return this.collisionGroups[n]}}function Wo(d,n,c,_,y){const{horizontalAlign:b,verticalAlign:S}=r.getAnchorAlignment(d),M=-(b-.5)*n,P=-(S-.5)*c,z=r.evaluateVariableOffset(d,_);return new r.Point(M+z[0]*y,P+z[1]*y)}function Zo(d,n,c,_,y){const b=new r.Point(d,n);return c&&b._rotate(_?y:-y),b}class Xa{constructor(n,c,_,y,b){this.transform=n.clone(),this.projection=n.projection.name,this.collisionIndex=new Go(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new yu(_),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(n,c,_,y){const b=_.getBucket(c),S=_.latestFeatureIndex;if(!b||!S||c.id!==b.layerIds[0])return;const M=b.layers[0].layout,P=_.collisionBoxArray,z=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),L=_.tileSize/r.EXTENT,N=_.tileID.toUnwrapped();this.transform.setProjection(b.projection);const $=(X=_.tileID,J=b.getProjection(),K=this.transform,J.name===this.projection?K.calculateProjMatrix(X.toUnwrapped()):gr(K,J,X));var X,J,K;const Q=M.get("text-pitch-alignment")==="map",j=M.get("text-rotation-alignment")==="map";c.compileFilter();const H=c.dynamicFilter(),nt=c.dynamicFilterNeedsFeature(),st=this.transform.calculatePixelsToTileUnitsMatrix(_),ft=Ms($,_.tileID.canonical,Q,j,this.transform,b.getProjection(),st);let mt=null;if(Q){const xt=ji($,_.tileID.canonical,Q,j,this.transform,b.getProjection(),st);mt=r.multiply([],this.transform.labelPlaneMatrix,xt)}let _t=null;H&&_.latestFeatureIndex&&(_t={unwrappedTileID:N,dynamicFilter:H,dynamicFilterNeedsFeature:nt,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new hc(b.bucketInstanceId,S,b.sourceLayerIndex,b.index,_.tileID);const vt={bucket:b,layout:M,posMatrix:$,textLabelPlaneMatrix:ft,labelToScreenMatrix:mt,clippingData:_t,scale:z,textPixelRatio:L,holdingForFade:_.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:r.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(y)for(const xt of b.sortKeyRanges){const{sortKey:At,symbolInstanceStart:Zt,symbolInstanceEnd:Et}=xt;n.push({sortKey:At,symbolInstanceStart:Zt,symbolInstanceEnd:Et,parameters:vt})}else n.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:vt})}attemptAnchorPlacement(n,c,_,y,b,S,M,P,z,L,N,$,X,J,K,Q,j,H){const{textOffset0:nt,textOffset1:st,crossTileID:ft}=$,mt=[nt,st],_t=Wo(n,_,y,mt,b),vt=this.collisionIndex.placeCollisionBox(J,b,c,Zo(_t.x,_t.y,S,M,this.transform.angle),N,P,z,L.predicate);if(Q){const xt=J.getSymbolInstanceIconSize(H,this.transform.zoom,$.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(J,xt,Q,Zo(_t.x,_t.y,S,M,this.transform.angle),N,P,z,L.predicate).box.length===0)return}if(vt.box.length>0){let xt;return this.prevPlacement&&this.prevPlacement.variableOffsets[ft]&&this.prevPlacement.placements[ft]&&this.prevPlacement.placements[ft].text&&(xt=this.prevPlacement.variableOffsets[ft].anchor),this.variableOffsets[ft]={textOffset:mt,width:_,height:y,anchor:n,textScale:b,prevAnchor:xt},this.markUsedJustification(J,n,$,K),J.allowVerticalPlacement&&(this.markUsedOrientation(J,K,$),this.placedOrientations[ft]=K),{shift:_t,placedGlyphBoxes:vt}}}placeLayerBucketPart(n,c,_,y){const{bucket:b,layout:S,posMatrix:M,textLabelPlaneMatrix:P,labelToScreenMatrix:z,clippingData:L,textPixelRatio:N,holdingForFade:$,collisionBoxArray:X,partiallyEvaluatedTextSize:J,partiallyEvaluatedIconSize:K,collisionGroup:Q}=n.parameters,j=S.get("text-optional"),H=S.get("icon-optional"),nt=S.get("text-allow-overlap"),st=S.get("icon-allow-overlap"),ft=S.get("text-rotation-alignment")==="map",mt=S.get("text-pitch-alignment")==="map",_t=S.get("icon-text-fit")!=="none",vt=S.get("symbol-z-order")==="viewport-y";this.transform.setProjection(b.projection);let xt=nt&&(st||!b.hasIconData()||H),At=st&&(nt||!b.hasTextData()||j);!b.collisionArrays&&X&&b.deserializeCollisionBoxes(X),_&&y&&b.updateCollisionDebugBuffers(this.transform.zoom,X);const Zt=(Et,jt,It)=>{const{crossTileID:$t,numVerticalGlyphVertices:Mt}=Et;if(L){const wi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ri=null;if(L.dynamicFilterNeedsFeature){const We=this.retainedQueryData[b.bucketInstanceId];ri=L.featureIndex.loadFeature({featureIndex:Et.featureIndex,bucketIndex:We.bucketIndex,sourceLayerIndex:We.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(wi,ri,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new r.Point(Et.tileAnchorX,Et.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[$t]=new qo(!1,!1,!1,!0),void c.add($t)}if(c.has($t))return;if($)return void(this.placements[$t]=new qo(!1,!1,!1));let Nt=!1,Xt=!1,Gt=!0,Yt=!1,me=!1,we=null,de={box:null,offscreen:null,occluded:null},xe={box:null,offscreen:null,occluded:null},Be=null,De=null,_e=null,Je=0,ii=0,ni=0;It.textFeatureIndex?Je=It.textFeatureIndex:Et.useRuntimeCollisionCircles&&(Je=Et.featureIndex),It.verticalTextFeatureIndex&&(ii=It.verticalTextFeatureIndex);const si=wi=>{wi.tileID=this.retainedQueryData[b.bucketInstanceId].tileID;const ri=this.transform.elevation;(ri||wi.elevation)&&(wi.elevation=ri?ri.getAtTileOffset(wi.tileID,wi.tileAnchorX,wi.tileAnchorY):0)},pn=It.textBox;if(pn){si(pn);const wi=We=>{let Vi=r.WritingMode.horizontal;if(b.allowVerticalPlacement&&!We&&this.prevPlacement){const xn=this.prevPlacement.placedOrientations[$t];xn&&(this.placedOrientations[$t]=xn,Vi=xn,this.markUsedOrientation(b,Vi,Et))}return Vi},ri=(We,Vi)=>{if(b.allowVerticalPlacement&&Mt>0&&It.verticalTextBox){for(const xn of b.writingModes)if(xn===r.WritingMode.vertical?(de=Vi(),xe=de):de=We(),de&&de.box&&de.box.length)break}else de=We()};if(S.get("text-variable-anchor")){let We=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$t]){const mi=this.prevPlacement.variableOffsets[$t];We.indexOf(mi.anchor)>0&&(We=We.filter(En=>En!==mi.anchor),We.unshift(mi.anchor))}const Vi=(mi,En,wl)=>{const Sr=b.getSymbolInstanceTextSize(J,Et,this.transform.zoom,jt),pa=(mi.x2-mi.x1)*Sr+2*mi.padding,zs=(mi.y2-mi.y1)*Sr+2*mi.padding,Qs=_t&&!st?En:null;Qs&&si(Qs);let Mr={box:[],offscreen:!1,occluded:!1};const Tl=nt?2*We.length:We.length;for(let fa=0;fa<Tl;++fa){const th=this.attemptAnchorPlacement(We[fa%We.length],mi,pa,zs,Sr,ft,mt,N,M,Q,fa>=We.length,Et,jt,b,wl,Qs,J,K);if(th&&(Mr=th.placedGlyphBoxes,Mr&&Mr.box&&Mr.box.length)){Nt=!0,we=th.shift;break}}return Mr};ri(()=>Vi(pn,It.iconBox,r.WritingMode.horizontal),()=>{const mi=It.verticalTextBox;return mi&&si(mi),b.allowVerticalPlacement&&!(de&&de.box&&de.box.length)&&Mt>0&&mi?Vi(mi,It.verticalIconBox,r.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),de&&(Nt=de.box,Gt=de.offscreen,Yt=de.occluded);const xn=wi(!(!de||!de.box));if(!Nt&&this.prevPlacement){const mi=this.prevPlacement.variableOffsets[$t];mi&&(this.variableOffsets[$t]=mi,this.markUsedJustification(b,mi.anchor,Et,xn))}}else{const We=(Vi,xn)=>{const mi=b.getSymbolInstanceTextSize(J,Et,this.transform.zoom,jt),En=this.collisionIndex.placeCollisionBox(b,mi,Vi,new r.Point(0,0),nt,N,M,Q.predicate);return En&&En.box&&En.box.length&&(this.markUsedOrientation(b,xn,Et),this.placedOrientations[$t]=xn),En};ri(()=>We(pn,r.WritingMode.horizontal),()=>{const Vi=It.verticalTextBox;return b.allowVerticalPlacement&&Mt>0&&Vi?(si(Vi),We(Vi,r.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),wi(!!(de&&de.box&&de.box.length))}}if(Be=de,Nt=Be&&Be.box&&Be.box.length>0,Gt=Be&&Be.offscreen,Yt=Be&&Be.occluded,Et.useRuntimeCollisionCircles){const wi=b.text.placedSymbolArray.get(Et.centerJustifiedTextSymbolIndex>=0?Et.centerJustifiedTextSymbolIndex:Et.verticalPlacedTextSymbolIndex),ri=r.evaluateSizeForFeature(b.textSizeData,J,wi),We=S.get("text-padding");De=this.collisionIndex.placeCollisionCircles(b,nt,wi,b.lineVertexArray,b.glyphOffsetArray,ri,M,P,z,_,mt,Q.predicate,Et.collisionCircleDiameter*ri/r.ONE_EM,We,this.retainedQueryData[b.bucketInstanceId].tileID),Nt=nt||De.circles.length>0&&!De.collisionDetected,Gt=Gt&&De.offscreen,Yt=De.occluded}if(It.iconFeatureIndex&&(ni=It.iconFeatureIndex),It.iconBox){const wi=ri=>{si(ri);const We=_t&&we?Zo(we.x,we.y,ft,mt,this.transform.angle):new r.Point(0,0),Vi=b.getSymbolInstanceIconSize(K,this.transform.zoom,Et.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(b,Vi,ri,We,st,N,M,Q.predicate)};xe&&xe.box&&xe.box.length&&It.verticalIconBox?(_e=wi(It.verticalIconBox),Xt=_e.box.length>0):(_e=wi(It.iconBox),Xt=_e.box.length>0),Gt=Gt&&_e.offscreen,me=_e.occluded}const nn=j||Et.numHorizontalGlyphVertices===0&&Mt===0,Wn=H||Et.numIconVertices===0;if(nn||Wn?Wn?nn||(Xt=Xt&&Nt):Nt=Xt&&Nt:Xt=Nt=Xt&&Nt,Nt&&Be&&Be.box&&this.collisionIndex.insertCollisionBox(Be.box,S.get("text-ignore-placement"),b.bucketInstanceId,xe&&xe.box&&ii?ii:Je,Q.ID),Xt&&_e&&this.collisionIndex.insertCollisionBox(_e.box,S.get("icon-ignore-placement"),b.bucketInstanceId,ni,Q.ID),De&&(Nt&&this.collisionIndex.insertCollisionCircles(De.circles,S.get("text-ignore-placement"),b.bucketInstanceId,Je,Q.ID),_)){const wi=b.bucketInstanceId;let ri=this.collisionCircleArrays[wi];ri===void 0&&(ri=this.collisionCircleArrays[wi]=new $o);for(let We=0;We<De.circles.length;We+=4)ri.circles.push(De.circles[We+0]),ri.circles.push(De.circles[We+1]),ri.circles.push(De.circles[We+2]),ri.circles.push(De.collisionDetected?1:0)}const _s=b.projection.name!=="globe";xt=xt&&(_s||!Yt),At=At&&(_s||!me),this.placements[$t]=new qo(Nt||xt,Xt||At,Gt||b.justReloaded),c.add($t)};if(vt){const Et=b.getSortedSymbolIndexes(this.transform.angle);for(let jt=Et.length-1;jt>=0;--jt){const It=Et[jt];Zt(b.symbolInstances.get(It),It,b.collisionArrays[It])}}else for(let Et=n.symbolInstanceStart;Et<n.symbolInstanceEnd;Et++)Zt(b.symbolInstances.get(Et),Et,b.collisionArrays[Et]);if(_&&b.bucketInstanceId in this.collisionCircleArrays){const Et=this.collisionCircleArrays[b.bucketInstanceId];r.invert(Et.invProjMatrix,M),Et.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(n,c,_,y){const{leftJustifiedTextSymbolIndex:b,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:M,verticalPlacedTextSymbolIndex:P,crossTileID:z}=_,L=r.getAnchorJustification(c),N=y===r.WritingMode.vertical?P:L==="left"?b:L==="center"?S:L==="right"?M:-1;b>=0&&(n.text.placedSymbolArray.get(b).crossTileID=N>=0&&b!==N?0:z),S>=0&&(n.text.placedSymbolArray.get(S).crossTileID=N>=0&&S!==N?0:z),M>=0&&(n.text.placedSymbolArray.get(M).crossTileID=N>=0&&M!==N?0:z),P>=0&&(n.text.placedSymbolArray.get(P).crossTileID=N>=0&&P!==N?0:z)}markUsedOrientation(n,c,_){const y=c===r.WritingMode.horizontal||c===r.WritingMode.horizontalOnly?c:0,b=c===r.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:P,verticalPlacedTextSymbolIndex:z}=_,L=n.text.placedSymbolArray;S>=0&&(L.get(S).placedOrientation=y),M>=0&&(L.get(M).placedOrientation=y),P>=0&&(L.get(P).placedOrientation=y),z>=0&&(L.get(z).placedOrientation=b)}commit(n){this.commitTime=n,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let _=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(n):1,b=c?c.opacities:{},S=c?c.variableOffsets:{},M=c?c.placedOrientations:{};for(const P in this.placements){const z=this.placements[P],L=b[P];L?(this.opacities[P]=new As(L,y,z.text,z.icon,null,z.clipped),_=_||z.text!==L.text.placed||z.icon!==L.icon.placed):(this.opacities[P]=new As(null,y,z.text,z.icon,z.skipFade,z.clipped),_=_||z.text||z.icon)}for(const P in b){const z=b[P];if(!this.opacities[P]){const L=new As(z,y,!1,!1);L.isHidden()||(this.opacities[P]=L,_=_||z.text.placed||z.icon.placed)}}for(const P in S)this.variableOffsets[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.variableOffsets[P]=S[P]);for(const P in M)this.placedOrientations[P]||!this.opacities[P]||this.opacities[P].isHidden()||(this.placedOrientations[P]=M[P]);_?this.lastPlacementChangeTime=n:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:n)}updateLayerOpacities(n,c){const _=new Set;for(const y of c){const b=y.getBucket(n);b&&y.latestFeatureIndex&&n.id===b.layerIds[0]&&this.updateBucketOpacities(b,_,y.collisionBoxArray)}}updateBucketOpacities(n,c,_){n.hasTextData()&&n.text.opacityVertexArray.clear(),n.hasIconData()&&n.icon.opacityVertexArray.clear(),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexArray.clear(),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexArray.clear();const y=n.layers[0].layout,b=!!n.layers[0].dynamicFilter(),S=new As(null,0,!1,!1,!0),M=y.get("text-allow-overlap"),P=y.get("icon-allow-overlap"),z=y.get("text-variable-anchor"),L=y.get("text-rotation-alignment")==="map",N=y.get("text-pitch-alignment")==="map",$=y.get("icon-text-fit")!=="none",X=new As(null,0,M&&(P||!n.hasIconData()||y.get("icon-optional")),P&&(M||!n.hasTextData()||y.get("text-optional")),!0);!n.collisionArrays&&_&&(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData())&&n.deserializeCollisionBoxes(_);const J=(Q,j,H)=>{for(let nt=0;nt<j/4;nt++)Q.opacityVertexArray.emplaceBack(H)};let K=0;for(let Q=0;Q<n.symbolInstances.length;Q++){const j=n.symbolInstances.get(Q),{numHorizontalGlyphVertices:H,numVerticalGlyphVertices:nt,crossTileID:st,numIconVertices:ft}=j,mt=c.has(st);let _t=this.opacities[st];mt?_t=S:_t||(_t=X,this.opacities[st]=_t),c.add(st);const vt=H>0||nt>0,xt=ft>0,At=this.placedOrientations[st],Zt=At===r.WritingMode.vertical,Et=At===r.WritingMode.horizontal||At===r.WritingMode.horizontalOnly;if(!vt&&!xt||_t.isHidden()||K++,vt){const jt=Ho(_t.text);J(n.text,H,Zt?Di:jt),J(n.text,nt,Et?Di:jt);const It=_t.text.isHidden(),{leftJustifiedTextSymbolIndex:$t,centerJustifiedTextSymbolIndex:Mt,rightJustifiedTextSymbolIndex:Nt,verticalPlacedTextSymbolIndex:Xt}=j,Gt=n.text.placedSymbolArray,Yt=It||Zt?1:0;$t>=0&&(Gt.get($t).hidden=Yt),Mt>=0&&(Gt.get(Mt).hidden=Yt),Nt>=0&&(Gt.get(Nt).hidden=Yt),Xt>=0&&(Gt.get(Xt).hidden=It||Et?1:0);const me=this.variableOffsets[st];me&&this.markUsedJustification(n,me.anchor,j,At);const we=this.placedOrientations[st];we&&(this.markUsedJustification(n,"left",j,we),this.markUsedOrientation(n,we,j))}if(xt){const jt=Ho(_t.icon),{placedIconSymbolIndex:It,verticalPlacedIconSymbolIndex:$t}=j,Mt=n.icon.placedSymbolArray,Nt=_t.icon.isHidden()?1:0;It>=0&&(J(n.icon,ft,Zt?Di:jt),Mt.get(It).hidden=Nt),$t>=0&&(J(n.icon,j.numVerticalIconVertices,Et?Di:jt),Mt.get($t).hidden=Nt)}if(n.hasIconCollisionBoxData()||n.hasTextCollisionBoxData()){const jt=n.collisionArrays[Q];if(jt){let It=new r.Point(0,0),$t=!0;if(jt.textBox||jt.verticalTextBox){if(z){const Nt=this.variableOffsets[st];Nt?(It=Wo(Nt.anchor,Nt.width,Nt.height,Nt.textOffset,Nt.textScale),L&&It._rotate(N?this.transform.angle:-this.transform.angle)):$t=!1}b&&($t=!_t.clipped),jt.textBox&&Xr(n.textCollisionBox.collisionVertexArray,_t.text.placed,!$t||Zt,It.x,It.y),jt.verticalTextBox&&Xr(n.textCollisionBox.collisionVertexArray,_t.text.placed,!$t||Et,It.x,It.y)}const Mt=$t&&!!(!Et&&jt.verticalIconBox);jt.iconBox&&Xr(n.iconCollisionBox.collisionVertexArray,_t.icon.placed,Mt,$?It.x:0,$?It.y:0),jt.verticalIconBox&&Xr(n.iconCollisionBox.collisionVertexArray,_t.icon.placed,!Mt,$?It.x:0,$?It.y:0)}}}if(n.fullyClipped=K===0,n.sortFeatures(this.transform.angle),this.retainedQueryData[n.bucketInstanceId]&&(this.retainedQueryData[n.bucketInstanceId].featureSortOrder=n.featureSortOrder),n.hasTextData()&&n.text.opacityVertexBuffer&&n.text.opacityVertexBuffer.updateData(n.text.opacityVertexArray),n.hasIconData()&&n.icon.opacityVertexBuffer&&n.icon.opacityVertexBuffer.updateData(n.icon.opacityVertexArray),n.hasIconCollisionBoxData()&&n.iconCollisionBox.collisionVertexBuffer&&n.iconCollisionBox.collisionVertexBuffer.updateData(n.iconCollisionBox.collisionVertexArray),n.hasTextCollisionBoxData()&&n.textCollisionBox.collisionVertexBuffer&&n.textCollisionBox.collisionVertexBuffer.updateData(n.textCollisionBox.collisionVertexArray),n.bucketInstanceId in this.collisionCircleArrays){const Q=this.collisionCircleArrays[n.bucketInstanceId];n.placementInvProjMatrix=Q.invProjMatrix,n.placementViewportMatrix=Q.viewportMatrix,n.collisionCircleArray=Q.circles,delete this.collisionCircleArrays[n.bucketInstanceId]}}symbolFadeChange(n){return this.fadeDuration===0?1:(n-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(n){return Math.max(0,(this.transform.zoom-n)/1.5)}hasTransitions(n){return this.stale||n-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(n,c){const _=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*_>n}setStale(){this.stale=!0}}function Xr(d,n,c,_,y){d.emplaceBack(n?1:0,c?1:0,_||0,y||0),d.emplaceBack(n?1:0,c?1:0,_||0,y||0),d.emplaceBack(n?1:0,c?1:0,_||0,y||0),d.emplaceBack(n?1:0,c?1:0,_||0,y||0)}const wn=Math.pow(2,25),Bi=Math.pow(2,24),uc=Math.pow(2,17),dc=Math.pow(2,16),Tn=Math.pow(2,9),Gn=Math.pow(2,8),xu=Math.pow(2,1);function Ho(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const n=d.placed?1:0,c=Math.floor(127*d.opacity);return c*wn+n*Bi+c*uc+n*dc+c*Tn+n*Gn+c*xu+n}const Di=0;class Xo{constructor(n){this._sortAcrossTiles=n.layout.get("symbol-z-order")!=="viewport-y"&&n.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(n,c,_,y,b){const S=this._bucketParts;for(;this._currentTileIndex<n.length;)if(c.getBucketParts(S,y,n[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((M,P)=>M.sortKey-P.sortKey));this._currentPartIndex<S.length;){const M=S[this._currentPartIndex];if(c.placeLayerBucketPart(M,this._seenCrossTileIDs,_,M.symbolInstanceStart===0),this._currentPartIndex++,b())return!0}return!1}}class pc{constructor(n,c,_,y,b,S,M,P){this.placement=new Xa(n,b,S,M,P),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(n,c,_){const y=r.exported.now(),b=()=>{const S=r.exported.now()-y;return!this._forceFullPlacement&&S>2};for(;this._currentPlacementIndex>=0;){const S=c[n[this._currentPlacementIndex]],M=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=M)&&(!S.maxzoom||S.maxzoom>M)){if(this._inProgressLayer||(this._inProgressLayer=new Xo(S)),this._inProgressLayer.continuePlacement(_[S.source],this.placement,this._showCollisionBoxes,S,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(n){return this.placement.commit(n),this.placement}}const yr=512/r.EXTENT/2;class an{constructor(n,c,_){this.tileID=n,this.bucketInstanceId=_,this.index=new r.KDBush(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=n.canonical.x*r.EXTENT,b=n.canonical.y*r.EXTENT;for(let S=0;S<c.length;S++){const{key:M,crossTileID:P,tileAnchorX:z,tileAnchorY:L}=c.get(S),N=Math.floor((y+z)*yr),$=Math.floor((b+L)*yr);this.index.add(N,$),this.keys.push(M),this.crossTileIDs.push(P)}this.index.finish()}findMatches(n,c,_){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),b=yr/Math.pow(2,c.canonical.z-this.tileID.canonical.z),S=c.canonical.x*r.EXTENT,M=c.canonical.y*r.EXTENT;for(let P=0;P<n.length;P++){const z=n.get(P);if(z.crossTileID)continue;const{key:L,tileAnchorX:N,tileAnchorY:$}=z,X=Math.floor((S+N)*b),J=Math.floor((M+$)*b),K=this.index.range(X-y,J-y,X+y,J+y);for(const Q of K){const j=this.crossTileIDs[Q];if(this.keys[Q]===L&&!_.has(j)){_.add(j),z.crossTileID=j;break}}}}}class fc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _c{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(n){const c=Math.round((n-this.lng)/360);if(c!==0)for(const _ in this.indexes){const y=this.indexes[_],b={};for(const S in y){const M=y[S];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+c),b[M.tileID.key]=M}this.indexes[_]=b}this.lng=n}addBucket(n,c,_){if(this.indexes[n.overscaledZ]&&this.indexes[n.overscaledZ][n.key]){if(this.indexes[n.overscaledZ][n.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(n.overscaledZ,this.indexes[n.overscaledZ][n.key])}for(let b=0;b<c.symbolInstances.length;b++)c.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[n.overscaledZ]||(this.usedCrossTileIDs[n.overscaledZ]=new Set);const y=this.usedCrossTileIDs[n.overscaledZ];for(const b in this.indexes){const S=this.indexes[b];if(Number(b)>n.overscaledZ)for(const M in S){const P=S[M];P.tileID.isChildOf(n)&&P.findMatches(c.symbolInstances,n,y)}else{const M=S[n.scaledTo(Number(b)).key];M&&M.findMatches(c.symbolInstances,n,y)}}for(let b=0;b<c.symbolInstances.length;b++){const S=c.symbolInstances.get(b);S.crossTileID||(S.crossTileID=_.generate(),y.add(S.crossTileID))}return this.indexes[n.overscaledZ]===void 0&&(this.indexes[n.overscaledZ]={}),this.indexes[n.overscaledZ][n.key]=new an(n,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(n,c){for(const _ of c.crossTileIDs)this.usedCrossTileIDs[n].delete(_)}removeStaleBuckets(n){let c=!1;for(const _ in this.indexes){const y=this.indexes[_];for(const b in y)n[y[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,y[b]),delete y[b],c=!0)}return c}}class Cs{constructor(){this.layerIndexes={},this.crossTileIDs=new fc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(n,c,_,y){let b=this.layerIndexes[n.id];b===void 0&&(b=this.layerIndexes[n.id]=new _c);let S=!1;const M={};y.name!=="globe"&&b.handleWrapJump(_);for(const P of c){const z=P.getBucket(n);z&&n.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(P.tileID,z,this.crossTileIDs)&&(S=!0),M[z.bucketInstanceId]=!0)}return b.removeStaleBuckets(M)&&(S=!0),S}pruneUnusedLayers(n){const c={};n.forEach(_=>{c[_]=!0});for(const _ in this.layerIndexes)c[_]||delete this.layerIndexes[_]}}const Ks=(d,n)=>r.emitValidationErrors(d,n&&n.filter(c=>c.identifier!=="source.canvas")),Ya=r.pick(He,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Bp=r.pick(He,["setCenter","setZoom","setBearing","setPitch"]),mc={version:8,layers:[],sources:{}},Yr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ds extends r.Evented{constructor(n,c={}){super(),this.map=n,this.dispatcher=new vi(Zr(),this),this.imageManager=new ze,this.imageManager.setEventedParent(this),this.glyphManager=new r.GlyphManager(n._requestManager,c.localFontFamily?r.LocalGlyphMode.all:c.localIdeographFontFamily?r.LocalGlyphMode.ideographs:r.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Cs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",r.getReferrer());const _=this;this._rtlTextPluginCallback=ds.registerForPluginStateChange(y=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(b,S)=>{if(r.triggerPluginCompletionEvent(b),S&&S.every(M=>M))for(const M in _._sourceCaches){const P=_._sourceCaches[M],z=P.getSource().type;z!=="vector"&&z!=="geojson"||P.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const b=this.getSource(y.sourceId);if(b&&b.vectorLayerIds)for(const S in this._layers){const M=this._layers[S];M.source===b.id&&this._validateLayer(M)}})}loadURL(n,c={}){this.fire(new r.Event("dataloading",{dataType:"style"}));const _=typeof c.validate=="boolean"?c.validate:!r.isMapboxURL(n);n=this.map._requestManager.normalizeStyleURL(n,c.accessToken);const y=this.map._requestManager.transformRequest(n,r.ResourceType.Style);this._request=r.getJSON(y,(b,S)=>{this._request=null,b?this.fire(new r.ErrorEvent(b)):S&&this._load(S,_)})}loadJSON(n,c={}){this.fire(new r.Event("dataloading",{dataType:"style"})),this._request=r.exported.frame(()=>{this._request=null,this._load(n,c.validate!==!1)})}loadEmpty(){this.fire(new r.Event("dataloading",{dataType:"style"})),this._load(mc,!1)}_updateLayerCount(n,c){const _=c?1:-1;n.is3D()&&(this._num3DLayers+=_),n.type==="circle"&&(this._numCircleLayers+=_),n.type==="symbol"&&(this._numSymbolLayers+=_)}_load(n,c){if(c&&Ks(this,r.validateStyle(n)))return;this._loaded=!0,this.stylesheet=r.clone$1(n),this._updateMapProjection();for(const y in n.sources)this.addSource(y,n.sources[y],{validate:!1});this._changed=!1,n.sprite?this._loadSprite(n.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(n.glyphs);const _=fu(this.stylesheet.layers);this._order=_.map(y=>y.id),this._layers={},this._serializedLayers={};for(const y of _){const b=r.createStyleLayer(y);b.setEventedParent(this,{layer:{id:b.id}}),this._layers[b.id]=b,this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ge(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new r.Event("data",{dataType:"style"})),this.fire(new r.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(n){n?this.stylesheet.projection=n:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(n){this._spriteRequest=function(c,_,y){let b,S,M;const P=r.exported.devicePixelRatio>1?"@2x":"";let z=r.getJSON(_.transformRequest(_.normalizeSpriteURL(c,P,".json"),r.ResourceType.SpriteJSON),($,X)=>{z=null,M||(M=$,b=X,N())}),L=r.getImage(_.transformRequest(_.normalizeSpriteURL(c,P,".png"),r.ResourceType.SpriteImage),($,X)=>{L=null,M||(M=$,S=X,N())});function N(){if(M)y(M);else if(b&&S){const $=r.exported.getImageData(S),X={};for(const J in b){const{width:K,height:Q,x:j,y:H,sdf:nt,pixelRatio:st,stretchX:ft,stretchY:mt,content:_t}=b[J],vt=new r.RGBAImage({width:K,height:Q});r.RGBAImage.copy($,vt,{x:j,y:H},{x:0,y:0},{width:K,height:Q}),X[J]={data:vt,pixelRatio:st,sdf:nt,stretchX:ft,stretchY:mt,content:_t}}y(null,X)}}return{cancel(){z&&(z.cancel(),z=null),L&&(L.cancel(),L=null)}}}(n,this.map._requestManager,(c,_)=>{if(this._spriteRequest=null,c)this.fire(new r.ErrorEvent(c));else if(_)for(const y in _)this.imageManager.addImage(y,_[y]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new r.Event("data",{dataType:"style"}))})}_validateLayer(n){const c=this.getSource(n.source);if(!c)return;const _=n.sourceLayer;_&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(_)===-1)&&this.fire(new r.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${c.id}" as specified by style layer "${n.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const n in this._sourceCaches)if(!this._sourceCaches[n].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(n){const c=[];for(const _ of n){const y=this._layers[_];y.type!=="custom"&&c.push(y.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const n in this._sourceCaches)if(this._sourceCaches[n].hasTransition())return!0;for(const n in this._layers)if(this._layers[n].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(n){return!!this.terrain&&(typeof n.isLayerDraped=="function"?n.isLayerDraped():Yr[n.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(n){if(!this._loaded)return;const c=this._changed;if(this._changed){const y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(y.length||b.length)&&this._updateWorkerLayers(y,b);for(const S in this._updatedSources){const M=this._updatedSources[S];M==="reload"?this._reloadSource(S):M==="clear"&&this._clearSource(S)}this._updateTilesForChangedImages();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(n);this.light.updateTransitions(n),this.fog&&this.fog.updateTransitions(n),this._resetUpdates()}const _={};for(const y in this._sourceCaches){const b=this._sourceCaches[y];_[y]=b.used,b.used=!1}for(const y of this._order){const b=this._layers[y];if(b.recalculate(n,this._availableImages),!b.isHidden(n.zoom)){const M=this._getLayerSourceCache(b);M&&(M.used=!0)}const S=this.map.painter;if(S){const M=b.getProgramIds();if(!M)continue;const P=b.getProgramConfiguration(n.zoom);for(const z of M)S.useProgram(z,P)}}for(const y in _){const b=this._sourceCaches[y];_[y]!==b.used&&b.getSource().fire(new r.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(n),this.terrain&&this.terrain.recalculate(n),this.fog&&this.fog.recalculate(n),this.z=n.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new r.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const n=Object.keys(this._changedImages);if(n.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],n);this._changedImages={}}}_updateWorkerLayers(n,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(n),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(n){if(this._checkLoaded(),Ks(this,r.validateStyle(n)))return!1;(n=r.clone$1(n)).layers=fu(n.layers);const c=function(y,b){if(!y)return[{command:He.setStyle,args:[b]}];let S=[];try{if(!T(y.version,b.version))return[{command:He.setStyle,args:[b]}];T(y.center,b.center)||S.push({command:He.setCenter,args:[b.center]}),T(y.zoom,b.zoom)||S.push({command:He.setZoom,args:[b.zoom]}),T(y.bearing,b.bearing)||S.push({command:He.setBearing,args:[b.bearing]}),T(y.pitch,b.pitch)||S.push({command:He.setPitch,args:[b.pitch]}),T(y.sprite,b.sprite)||S.push({command:He.setSprite,args:[b.sprite]}),T(y.glyphs,b.glyphs)||S.push({command:He.setGlyphs,args:[b.glyphs]}),T(y.transition,b.transition)||S.push({command:He.setTransition,args:[b.transition]}),T(y.light,b.light)||S.push({command:He.setLight,args:[b.light]}),T(y.fog,b.fog)||S.push({command:He.setFog,args:[b.fog]}),T(y.projection,b.projection)||S.push({command:He.setProjection,args:[b.projection]});const M={},P=[];(function(N,$,X,J){let K;for(K in $=$||{},N=N||{})N.hasOwnProperty(K)&&($.hasOwnProperty(K)||Vo(K,X,J));for(K in $){if(!$.hasOwnProperty(K))continue;const Q=$[K];N.hasOwnProperty(K)?T(N[K],Q)||(N[K].type==="geojson"&&Q.type==="geojson"&&Ha(N,$,K)?X.push({command:He.setGeoJSONSourceData,args:[K,Q.data]}):oc(K,$,X,J)):rc(K,$,X)}})(y.sources,b.sources,P,M);const z=[];y.layers&&y.layers.forEach(N=>{N.source&&M[N.source]?S.push({command:He.removeLayer,args:[N.id]}):z.push(N)});let L=y.terrain;L&&M[L.source]&&(S.push({command:He.setTerrain,args:[void 0]}),L=void 0),S=S.concat(P),T(L,b.terrain)||S.push({command:He.setTerrain,args:[b.terrain]}),function(N,$,X){$=$||[];const J=(N=N||[]).map(Es),K=$.map(Es),Q=N.reduce(ac,{}),j=$.reduce(ac,{}),H=J.slice(),nt=Object.create(null);let st,ft,mt,_t,vt,xt,At;for(st=0,ft=0;st<J.length;st++)mt=J[st],j.hasOwnProperty(mt)?ft++:(X.push({command:He.removeLayer,args:[mt]}),H.splice(H.indexOf(mt,ft),1));for(st=0,ft=0;st<K.length;st++)mt=K[K.length-1-st],H[H.length-1-st]!==mt&&(Q.hasOwnProperty(mt)?(X.push({command:He.removeLayer,args:[mt]}),H.splice(H.lastIndexOf(mt,H.length-ft),1)):ft++,xt=H[H.length-st],X.push({command:He.addLayer,args:[j[mt],xt]}),H.splice(H.length-st,0,mt),nt[mt]=!0);for(st=0;st<K.length;st++)if(mt=K[st],_t=Q[mt],vt=j[mt],!nt[mt]&&!T(_t,vt))if(T(_t.source,vt.source)&&T(_t["source-layer"],vt["source-layer"])&&T(_t.type,vt.type)){for(At in hs(_t.layout,vt.layout,X,mt,null,He.setLayoutProperty),hs(_t.paint,vt.paint,X,mt,null,He.setPaintProperty),T(_t.filter,vt.filter)||X.push({command:He.setFilter,args:[mt,vt.filter]}),T(_t.minzoom,vt.minzoom)&&T(_t.maxzoom,vt.maxzoom)||X.push({command:He.setLayerZoomRange,args:[mt,vt.minzoom,vt.maxzoom]}),_t)_t.hasOwnProperty(At)&&At!=="layout"&&At!=="paint"&&At!=="filter"&&At!=="metadata"&&At!=="minzoom"&&At!=="maxzoom"&&(At.indexOf("paint.")===0?hs(_t[At],vt[At],X,mt,At.slice(6),He.setPaintProperty):T(_t[At],vt[At])||X.push({command:He.setLayerProperty,args:[mt,At,vt[At]]}));for(At in vt)vt.hasOwnProperty(At)&&!_t.hasOwnProperty(At)&&At!=="layout"&&At!=="paint"&&At!=="filter"&&At!=="metadata"&&At!=="minzoom"&&At!=="maxzoom"&&(At.indexOf("paint.")===0?hs(_t[At],vt[At],X,mt,At.slice(6),He.setPaintProperty):T(_t[At],vt[At])||X.push({command:He.setLayerProperty,args:[mt,At,vt[At]]}))}else X.push({command:He.removeLayer,args:[mt]}),xt=H[H.lastIndexOf(mt)+1],X.push({command:He.addLayer,args:[vt,xt]})}(z,b.layers,S)}catch(M){console.warn("Unable to compute style diff:",M),S=[{command:He.setStyle,args:[b]}]}return S}(this.serialize(),n).filter(y=>!(y.command in Bp));if(c.length===0)return!1;const _=c.filter(y=>!(y.command in Ya));if(_.length>0)throw new Error(`Unimplemented: ${_.map(y=>y.command).join(", ")}.`);return c.forEach(y=>{y.command!=="setTransition"&&y.command!=="setProjection"&&this[y.command].apply(this,y.args)}),this.stylesheet=n,this._updateMapProjection(),!0}addImage(n,c){return this.getImage(n)?this.fire(new r.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(n,c),this._afterImageUpdated(n),this)}updateImage(n,c){this.imageManager.updateImage(n,c)}getImage(n){return this.imageManager.getImage(n)}removeImage(n){return this.getImage(n)?(this.imageManager.removeImage(n),this._afterImageUpdated(n),this):this.fire(new r.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(n){this._availableImages=this.imageManager.listImages(),this._changedImages[n]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new r.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(n,c,_={}){if(this._checkLoaded(),this.getSource(n)!==void 0)throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(r.validateSource,`sources.${n}`,c,null,_))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=ke(n,c,this.dispatcher,this);y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(n),source:y.serialize(),sourceId:n}));const b=S=>{const M=(S?"symbol:":"other:")+n,P=this._sourceCaches[M]=new r.SourceCache(M,y,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[n]=P,P.style=this,P.onAdd(this.map)};b(!1),c.type!=="vector"&&c.type!=="geojson"||b(!0),y.onAdd&&y.onAdd(this.map),this._changed=!0}removeSource(n){this._checkLoaded();const c=this.getSource(n);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===n)return this.fire(new r.ErrorEvent(new Error(`Source "${n}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.get().source===n)return this.fire(new r.ErrorEvent(new Error(`Source "${n}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(n);for(const y of _)delete this._sourceCaches[y.id],delete this._updatedSources[y.id],y.fire(new r.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles();return delete this._otherSourceCaches[n],delete this._symbolSourceCaches[n],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(n,c){this._checkLoaded(),this.getSource(n).setData(c),this._changed=!0}getSource(n){const c=this._getSourceCache(n);return c&&c.getSource()}_getSources(){const n=[];for(const c in this._otherSourceCaches){const _=this._getSourceCache(c);_&&n.push(_.getSource())}return n}addLayer(n,c,_={}){this._checkLoaded();const y=n.id;if(this.getLayer(y))return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${y}" already exists on this map`)));let b;if(n.type==="custom"){if(Ks(this,r.validateCustomStyleLayer(n)))return;b=r.createStyleLayer(n)}else{if(typeof n.source=="object"&&(this.addSource(y,n.source),n=r.clone$1(n),n=r.extend(n,{source:y})),this._validate(r.validateLayer,`layers.${y}`,n,{arrayIndex:-1},_))return;b=r.createStyleLayer(n),this._validateLayer(b),b.setEventedParent(this,{layer:{id:y}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const S=c?this._order.indexOf(c):this._order.length;if(c&&S===-1)return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=b;const M=this._getLayerSourceCache(b);if(this._removedLayers[y]&&b.source&&M&&b.type!=="custom"){const P=this._removedLayers[y];delete this._removedLayers[y],P.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",M.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(n,c){if(this._checkLoaded(),this._changed=!0,!this._layers[n])return void this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be moved.`)));if(n===c)return;const _=this._order.indexOf(n);this._order.splice(_,1);const y=c?this._order.indexOf(c):this._order.length;c&&y===-1?this.fire(new r.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(y,0,n),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(n){this._checkLoaded();const c=this._layers[n];if(!c)return void this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const _=this._order.indexOf(n);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[n]=c,delete this._layers[n],delete this._serializedLayers[n],delete this._updatedLayers[n],delete this._updatedPaintProps[n],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(n){return this._layers[n]}hasLayer(n){return n in this._layers}hasLayerType(n){for(const c in this._layers)if(this._layers[c].type===n)return!0;return!1}setLayerZoomRange(n,c,_){this._checkLoaded();const y=this.getLayer(n);y?y.minzoom===c&&y.maxzoom===_||(c!=null&&(y.minzoom=c),_!=null&&(y.maxzoom=_),this._updateLayer(y)):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(n,c,_={}){this._checkLoaded();const y=this.getLayer(n);if(y){if(!T(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(r.validateFilter,`layers.${y.id}.filter`,c,{layerType:y.type},_)||(y.filter=r.clone$1(c),this._updateLayer(y)))}else this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be filtered.`)))}getFilter(n){const c=this.getLayer(n);return c&&r.clone$1(c.filter)}setLayoutProperty(n,c,_,y={}){this._checkLoaded();const b=this.getLayer(n);b?T(b.getLayoutProperty(c),_)||(b.setLayoutProperty(c,_,y),this._updateLayer(b)):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(n,c){const _=this.getLayer(n);if(_)return _.getLayoutProperty(c);this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style.`)))}setPaintProperty(n,c,_,y={}){this._checkLoaded();const b=this.getLayer(n);b?T(b.getPaintProperty(c),_)||(b.setPaintProperty(c,_,y)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[n]=!0):this.fire(new r.ErrorEvent(new Error(`The layer '${n}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(n,c){const _=this.getLayer(n);return _&&_.getPaintProperty(c)}setFeatureState(n,c){this._checkLoaded();const _=n.source,y=n.sourceLayer,b=this.getSource(_);if(!b)return void this.fire(new r.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const S=b.type;if(S==="geojson"&&y)return void this.fire(new r.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!y)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));n.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided.")));const M=this._getSourceCaches(_);for(const P of M)P.setFeatureState(y,n.id,c)}removeFeatureState(n,c){this._checkLoaded();const _=n.source,y=this.getSource(_);if(!y)return void this.fire(new r.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const b=y.type,S=b==="vector"?n.sourceLayer:void 0;if(b==="vector"&&!S)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof n.id!="string"&&typeof n.id!="number")return void this.fire(new r.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const M=this._getSourceCaches(_);for(const P of M)P.removeFeatureState(S,n.id,c)}getFeatureState(n){this._checkLoaded();const c=n.source,_=n.sourceLayer,y=this.getSource(c);if(y){if(y.type!=="vector"||_)return n.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(_,n.id);this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new r.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return r.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const n={};for(const c in this._sourceCaches){const _=this._sourceCaches[c].getSource();n[_.id]||(n[_.id]=_.serialize())}return r.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:n,layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateLayer(n){this._updatedLayers[n.id]=!0;const c=this._getLayerSourceCache(n);n.source&&!this._updatedSources[n.source]&&c&&c.getSource().type!=="raster"&&(this._updatedSources[n.source]="reload",c.pause()),this._changed=!0,n.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(n){const c=S=>this._layers[S].type==="fill-extrusion",_={},y=[];for(let S=this._order.length-1;S>=0;S--){const M=this._order[S];if(c(M)){_[M]=S;for(const P of n){const z=P[M];if(z)for(const L of z)y.push(L)}}}y.sort((S,M)=>M.intersectionZ-S.intersectionZ);const b=[];for(let S=this._order.length-1;S>=0;S--){const M=this._order[S];if(c(M))for(let P=y.length-1;P>=0;P--){const z=y[P].feature;if(_[z.layer.id]<S)break;b.push(z),y.pop()}else for(const P of n){const z=P[M];if(z)for(const L of z)b.push(L.feature)}}return b}queryRenderedFeatures(n,c,_){c&&c.filter&&this._validate(r.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const y={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new r.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const z=this._layers[P];if(!z)return this.fire(new r.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];y[z.source]=!0}}const b=[];c.availableImages=this._availableImages;const S=c&&c.layers?c.layers.some(P=>{const z=this.getLayer(P);return z&&z.is3D()}):this.has3DLayers(),M=gn.createFromScreenPoints(n,_);for(const P in this._sourceCaches){const z=this._sourceCaches[P].getSource().id;c.layers&&!y[z]||b.push(Si(this._sourceCaches[P],this._layers,this._serializedLayers,M,c,_,S,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(P,z,L,N,$,X,J){const K={},Q=X.queryRenderedSymbols(N),j=[];for(const H of Object.keys(Q).map(Number))j.push(J[H]);j.sort(un);for(const H of j){const nt=H.featureIndex.lookupSymbolFeatures(Q[H.bucketInstanceId],z,H.bucketIndex,H.sourceLayerIndex,$.filter,$.layers,$.availableImages,P);for(const st in nt){const ft=K[st]=K[st]||[],mt=nt[st];mt.sort((_t,vt)=>{const xt=H.featureSortOrder;if(xt){const At=xt.indexOf(_t.featureIndex);return xt.indexOf(vt.featureIndex)-At}return vt.featureIndex-_t.featureIndex});for(const _t of mt)ft.push(_t)}}for(const H in K)K[H].forEach(nt=>{const st=nt.feature,ft=L(P[H]);if(!ft)return;const mt=ft.getFeatureState(st.layer["source-layer"],st.id);st.source=st.layer.source,st.layer["source-layer"]&&(st.sourceLayer=st.layer["source-layer"]),st.state=mt});return K}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),M.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(n,c){c&&c.filter&&this._validate(r.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const _=this._getSourceCaches(n);let y=[];for(const b of _)y=y.concat(Ni(b,c));return y}addSourceType(n,c,_){return ds.getSourceType(n)?_(new Error(`A source type called "${n}" already exists.`)):(ds.setSourceType(n,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:n,url:c.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(n,c={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const S in n)if(!T(n[S],_[S])){y=!0;break}if(!y)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(n,c),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(n,c=1){if(this._checkLoaded(),!n)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=n;if(c===1){if(typeof _.source=="object"){const y="terrain-dem-src";this.addSource(y,_.source),_=r.clone$1(_),_=r.extend(_,{source:y})}if(this._validate(r.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,c)}else{const y=this.terrain,b=y.get();for(const S of Object.keys(r.spec.terrain))!_.hasOwnProperty(S)&&r.spec.terrain[S].default&&(_[S]=r.spec.terrain[S].default);for(const S in _)if(!T(_[S],b[S])){y.set(_),this.stylesheet.terrain=_;const M=this._setTransitionParameters({duration:0});y.updateTransitions(M);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(n){const c=this.fog=new Pi(n,this.map.transform);this.stylesheet.fog=n;const _=this._setTransitionParameters({duration:0});c.updateTransitions(_)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const n of this.map._markers)n._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(n){if(this._checkLoaded(),!n)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,_=c.get();Object.keys(n).length===0&&c.set(n);for(const y in n)if(!T(n[y],_[y])){c.set(n),this.stylesheet.fog=n;const b=this._setTransitionParameters({duration:0});c.updateTransitions(b);break}}else this._createFog(n);this._markersNeedUpdate=!0}_setTransitionParameters(n){return{now:r.exported.now(),transition:r.extend(n,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const n=this._order.filter(_=>this.isLayerDraped(this._layers[_])),c=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...n),this._drapedFirstOrder.push(...c)}_createTerrain(n,c){const _=this.terrain=new Ke(n,c);this.stylesheet.terrain=n,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const y=this._setTransitionParameters({duration:0});_.updateTransitions(y)}_force3DLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const n in this._layers){const c=this._layers[n];c.type==="symbol"&&this._updateLayer(c)}}_validate(n,c,_,y,b={}){return(!b||b.validate!==!1)&&Ks(this,n.call(r.validateStyle,r.extend({key:c,style:this.serialize(),value:_,styleSpec:r.spec},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const n in this._layers)this._layers[n].setEventedParent(null);for(const n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(n){const c=this._getSourceCaches(n);for(const _ of c)_.clearTiles()}_reloadSource(n){const c=this._getSourceCaches(n);for(const _ of c)_.resume(),_.reload()}_reloadSources(){for(const n of this._getSources())n.reload&&n.reload()}_updateSources(n){for(const c in this._sourceCaches)this._sourceCaches[c].update(n)}_generateCollisionBoxes(){for(const n in this._sourceCaches){const c=this._sourceCaches[n];c.resume(),c.reload()}}_updatePlacement(n,c,_,y,b=!1){let S=!1,M=!1;const P={};for(const z of this._order){const L=this._layers[z];if(L.type!=="symbol")continue;if(!P[L.source]){const $=this._getLayerSourceCache(L);if(!$)continue;P[L.source]=$.getRenderableIds(!0).map(X=>$.getTileByID(X)).sort((X,J)=>J.tileID.overscaledZ-X.tileID.overscaledZ||(X.tileID.isLessThan(J.tileID)?-1:1))}const N=this.crossTileSymbolIndex.addLayer(L,P[L.source],n.center.lng,n.projection);S=S||N}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new r.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.exported.now(),n.zoom))&&(this.pauseablePlacement=new pc(n,this._order,b,c,_,y,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,P),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.exported.now()),M=!0),S&&this.pauseablePlacement.placement.setStale()),M||S)for(const z of this._order){const L=this._layers[z];L.type==="symbol"&&this.placement.updateLayerOpacities(L,P[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.exported.now())}_releaseSymbolFadeTiles(){for(const n in this._sourceCaches)this._sourceCaches[n].releaseSymbolFadeTiles()}getImages(n,c,_){this.imageManager.getImages(c.icons,_),this._updateTilesForChangedImages();const y=b=>{b&&b.setDependencies(c.tileID.key,c.type,c.icons)};y(this._otherSourceCaches[c.source]),y(this._symbolSourceCaches[c.source])}getGlyphs(n,c,_){this.glyphManager.getGlyphs(c.stacks,_)}getResource(n,c,_){return r.makeRequest(c,_)}_getSourceCache(n){return this._otherSourceCaches[n]}_getLayerSourceCache(n){return n.type==="symbol"?this._symbolSourceCaches[n.source]:this._otherSourceCaches[n.source]}_getSourceCaches(n){const c=[];return this._otherSourceCaches[n]&&c.push(this._otherSourceCaches[n]),this._symbolSourceCaches[n]&&c.push(this._symbolSourceCaches[n]),c}_isSourceCacheLoaded(n){const c=this._getSourceCaches(n);return c.length===0?(this.fire(new r.ErrorEvent(new Error(`There is no source with ID '${n}'`))),!1):c.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ds.getSourceType=function(d){return Ae[d]},ds.setSourceType=function(d,n){Ae[d]=n},ds.registerForPluginStateChange=r.registerForPluginStateChange;var gc=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0`,xr="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Is=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Yo=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ps=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`;let Ka={},Kr={};const Ko=[];Jr(gc,Ko),Jr(Is,Ko),Jr(Yo,Ko),Jr(Ps,Ko),Ka=Xe("",Is),Kr=Xe(Ps,Yo);const vu=Xe(`
#if __VERSION__ >=300
#define varying in
#define gl_FragColor glFragColor
#define texture2D texture
#define textureCube texture
out vec4 glFragColor;
#endif
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}`,`
#if __VERSION__ >=300
#define attribute in
#define varying out
#define texture2D texture
#endif
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ja=gc,yc=`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`;var xc={background:Xe(`uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
varying vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform vec4 u_color;varying vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(u_color);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Xe(`uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Xe(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Xe("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Xe(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Xe(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Xe("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Xe("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Xe("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Xe(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Xe(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Xe(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Xe(`uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Xe(`varying vec4 v_color;
#ifdef RENDER_SHADOWS
varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
vec3 normal=v_normal;
#endif
float z;vec4 color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);
#else
color=v_color;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;
#endif
#ifdef RENDER_SHADOWS
#ifdef ZERO_ROOF_RADIUS
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#endif
color.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;
#endif
#ifdef ZERO_ROOF_RADIUS
varying vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
varying highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
v_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting(color,NdotL);
#else
v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_color*=u_opacity;
#ifdef ZERO_ROOF_RADIUS
v_roof_color=vec4(0.0,0.0,0.0,1.0);
#ifdef LIGHTING_3D_MODE
v_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));
#else
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));
#endif
v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:Xe(`uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
varying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,v_NdotL)*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos;varying vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;varying vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
varying float v_NdotL;
#endif
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_NdotL=NdotL;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:Xe(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Xe(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
gl_FragColor=apply_lighting(gl_FragColor);
#endif
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Xe(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
uniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture2D(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
#ifdef RENDER_LINE_BORDER
float edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);
#ifdef RENDER_LINE_BORDER_AUTO
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}
#else
out_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);
#endif
}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
attribute highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Xe(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Xe(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:Xe(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:Xe(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:Xe(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));
#endif
float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:Xe(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef RENDER_SHADOWS
color.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;
#endif
const float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=wireframeOffset;
#endif
v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Xe(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Xe(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,xr),skyboxGradient:Xe(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,xr),skyboxCapture:Xe(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Xe(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);
#else
color=texture2D(u_image0,v_pos0);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Xe(`uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:
(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:
uv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}`,`attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`)};function Jr(d,n){const c=d.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let _ of c)if(_=_.trim(),_[0]==="#"&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=_.split(" ");for(const b of y)n.includes(b)||n.push(b)}}function Xe(d,n){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=n.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),y={},b=[...Ko];return Jr(d,b),Jr(n,b),{fragmentSource:d=d.replace(c,(S,M,P,z,L)=>(y[L]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${L}
varying ${P} ${z} ${L};
#else
uniform ${P} ${z} u_${L};
#endif
`:`
#ifdef HAS_UNIFORM_u_${L}
    ${P} ${z} ${L} = u_${L};
#endif
`)),vertexSource:n=n.replace(c,(S,M,P,z,L)=>{const N=z==="float"?"vec2":"vec4",$=L.match(/color/)?"color":N;return y[L]?M==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${P} ${N} a_${L};
varying ${P} ${z} ${L};
#else
uniform ${P} ${z} u_${L};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = a_${L};
#else
    ${P} ${z} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${L} = unpack_mix_${$}(a_${L}, u_${L}_t);
#else
    ${P} ${z} ${L} = u_${L};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${L}
uniform lowp float u_${L}_t;
attribute ${P} ${N} a_${L};
#else
uniform ${P} ${z} u_${L};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${L}
    ${P} ${z} ${L} = a_${L};
#else
    ${P} ${z} ${L} = u_${L};
#endif
`:`
#ifndef HAS_UNIFORM_u_${L}
    ${P} ${z} ${L} = unpack_mix_${$}(a_${L}, u_${L}_t);
#else
    ${P} ${z} ${L} = u_${L};
#endif
`}),staticAttributes:_,usedDefines:b}}class Fp{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(n,c,_,y,b,S,M){this.context=n;let P=this.boundPaintVertexBuffers.length!==y.length;for(let L=0;!P&&L<y.length;L++)this.boundPaintVertexBuffers[L]!==y[L]&&(P=!0);let z=this.boundDynamicVertexBuffers.length!==M.length;for(let L=0;!z&&L<M.length;L++)this.boundDynamicVertexBuffers[L]!==M[L]&&(z=!0);if(!n.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==_||P||z||this.boundIndexBuffer!==b||this.boundVertexOffset!==S)this.freshBind(c,_,y,b,S,M);else{n.bindVertexArrayOES.set(this.vao);for(const L of M)L&&L.bind();b&&b.dynamicDraw&&b.bind()}}freshBind(n,c,_,y,b,S){let M;const P=n.numAttributes,z=this.context,L=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),M=0,this.boundProgram=n,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=y,this.boundVertexOffset=b,this.boundDynamicVertexBuffers=S;else{M=z.currentNumAttributes||0;for(let N=P;N<M;N++)L.disableVertexAttribArray(N)}c.enableAttributes(L,n),c.bind(),c.setVertexAttribPointers(L,n,b);for(const N of _)N.enableAttributes(L,n),N.bind(),N.setVertexAttribPointers(L,n,b);for(const N of S)N&&(N.enableAttributes(L,n),N.bind(),N.setVertexAttribPointers(L,n,b));y&&y.bind(),z.currentNumAttributes=P}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function vc(d,n){const c=Math.pow(2,n.canonical.z),_=n.canonical.y;return[new r.MercatorCoordinate(0,_/c).toLngLat().lat,new r.MercatorCoordinate(0,(_+1)/c).toLngLat().lat]}function bu(d,n,c,_,y,b,S){const M=d.context,P=M.gl,z=c.fbo;if(!z)return;d.prepareDrawTile();const L=d.useProgram("hillshade");M.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,z.colorAttachment.get());const N=((K,Q,j,H)=>{const nt=j.paint.get("hillshade-shadow-color"),st=j.paint.get("hillshade-highlight-color"),ft=j.paint.get("hillshade-accent-color");let mt=j.paint.get("hillshade-illumination-direction")*(Math.PI/180);j.paint.get("hillshade-illumination-anchor")==="viewport"&&(mt-=K.transform.angle);const _t=!K.options.moving;return{u_matrix:H||K.transform.calculateProjMatrix(Q.tileID.toUnwrapped(),_t),u_image:0,u_latrange:vc(0,Q.tileID),u_light:[j.paint.get("hillshade-exaggeration"),mt],u_shadow:nt,u_highlight:st,u_accent:ft}})(d,c,_,d.terrain?n.projMatrix:null);d.prepareDrawProgram(M,L,n.toUnwrapped());const{tileBoundsBuffer:$,tileBoundsIndexBuffer:X,tileBoundsSegments:J}=d.getTileBoundsBuffers(c);L.draw(M,P.TRIANGLES,y,b,S,r.CullFaceMode.disabled,N,_.id,$,X,J)}function bc(d,n,c){if(!n.needsDEMTextureUpload)return;const _=d.context,y=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||d.getTileTexture(c.stride);const b=c.getPixels();n.demTexture?n.demTexture.update(b,{premultiply:!1}):n.demTexture=new r.Texture(_,b,y.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function wu(d,n,c,_,y,b){const S=d.context,M=S.gl;if(!n.dem)return;const P=n.dem;if(S.activeTexture.set(M.TEXTURE1),bc(d,n,P),!n.demTexture)return;n.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE);const z=P.dim;S.activeTexture.set(M.TEXTURE0);let L=n.fbo;if(!L){const J=new r.Texture(S,{width:z,height:z,data:null},M.RGBA);J.bind(M.LINEAR,M.CLAMP_TO_EDGE),L=n.fbo=S.createFramebuffer(z,z,!0),L.colorAttachment.set(J.texture)}S.bindFramebuffer.set(L.framebuffer),S.viewport.set([0,0,z,z]);const{tileBoundsBuffer:N,tileBoundsIndexBuffer:$,tileBoundsSegments:X}=d.getMercatorTileBoundsBuffers();d.useProgram("hillshadePrepare").draw(S,M.TRIANGLES,_,y,b,r.CullFaceMode.disabled,((J,K)=>{const Q=K.stride,j=r.create();return r.ortho(j,0,r.EXTENT,-r.EXTENT,0,0,1),r.translate(j,j,[0,-r.EXTENT,0]),{u_matrix:j,u_image:1,u_dimension:[Q,Q],u_zoom:J.overscaledZ,u_unpack:K.unpackVector}})(n.tileID,P),c.id,N,$,X),n.needsHillshadePrepare=!1}const wc=d=>({u_matrix:new r.UniformMatrix4f(d),u_image0:new r.Uniform1i(d),u_skirt_height:new r.Uniform1f(d)}),Qr=(d,n)=>({u_matrix:d,u_image0:0,u_skirt_height:n}),Qa=(d,n,c,_,y,b,S,M,P,z,L,N,$,X,J)=>({u_proj_matrix:Float32Array.from(d),u_globe_matrix:n,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:b,u_image0:0,u_frustum_tl:S,u_frustum_tr:M,u_frustum_br:P,u_frustum_bl:z,u_globe_pos:L,u_globe_radius:N,u_viewport:$,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:X});function to(d,n){return d!=null&&n!=null&&!(!d.hasData()||!n.hasData())&&d.demTexture!=null&&n.demTexture!=null&&d.tileID.key!==n.tileID.key}const ks=new class{constructor(){this.operations={}}newMorphing(d,n,c,_,y){if(d in this.operations){const b=this.operations[d];b.to.tileID.key!==c.tileID.key&&(b.queued=c)}else this.operations[d]={startTime:_,phase:0,duration:y,from:n,to:c,queued:null}}getMorphValuesForProxy(d){if(!(d in this.operations))return null;const n=this.operations[d];return{from:n.from,to:n.to,phase:n.phase}}update(d){for(const n in this.operations){const c=this.operations[n];for(c.phase=(d-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,d)){delete this.operations[n];break}}}_nextOp(d,n){return!!d.queued&&(d.from=d.to,d.to=d.queued,d.queued=null,d.phase=0,d.startTime=n,!0)}_validOp(d){return d.from.hasData()&&d.to.hasData()}},vr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function tl(d){return 6*Math.pow(1.5,22-d)}function Tu(d,n){const c=1<<d.z;return!n&&(d.x===0||d.x===c-1)||d.y===0||d.y===c-1}const Jo=d=>({u_matrix:d});function Tc(d,n,c,_,y){if(y>0){const b=r.exported.now(),S=(b-d.timeAdded)/y,M=n?(b-n.timeAdded)/y:-1,P=c.getSource(),z=_.coveringZoomLevel({tileSize:P.tileSize,roundZoom:P.roundZoom}),L=!n||Math.abs(n.tileID.overscaledZ-z)>Math.abs(d.tileID.overscaledZ-z),N=L&&d.refreshedUponExpiration?1:r.clamp(L?S:1-M,0,1);return d.refreshedUponExpiration&&S>=1&&(d.refreshedUponExpiration=!1),n?{opacity:1,mix:1-N}:{opacity:N,mix:0}}return{opacity:1,mix:0}}class Ec extends r.SourceCache{constructor(n){const c={type:"raster-dem",maxzoom:n.transform.maxZoom},_=new vi(Zr(),null),y=ke("mock-dem",c,_,n.style);super("mock-dem",y,!1),y.setEventedParent(this),this._sourceLoaded=!0}_loadTile(n,c){n.state="loaded",c(null)}}class el extends r.SourceCache{constructor(n){const c=ke("proxy",{type:"geojson",maxzoom:n.transform.maxZoom},new vi(Zr(),null),n.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=n,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(n,c,_){if(n.freezeTileCoverage)return;this.transform=n;const y=n.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,S)=>{if(b[S.key]="",!this._tiles[S.key]){const M=new r.Tile(S,this._source.tileSize*S.overscaleFactor(),n.tileZoom);M.state="loaded",this._tiles[S.key]=M}return b},{});for(const b in this._tiles)b in y||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(n){const c=this.proxyCachedFBO[n];if(c!==void 0){const _=Object.values(c);this.renderCachePool.push(..._),delete this.proxyCachedFBO[n]}}deallocRenderCache(){this.renderCache.forEach(n=>n.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class il extends r.OverscaledTileID{constructor(n,c,_){super(n.overscaledZ,n.wrap,n.canonical.z,n.canonical.x,n.canonical.y),this.proxyTileKey=c,this.projMatrix=_}}class Sc extends r.Elevation{constructor(n,c){super(),this.painter=n,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,y,b]=function(P){const z=new r.StructArrayLayout2i4,L=new r.StructArrayLayout3ui6,N=131;z.reserve(17161),L.reserve(33800);const $=r.EXTENT/128,X=r.EXTENT+$/2,J=X+$;for(let Q=-$;Q<J;Q+=$)for(let j=-$;j<J;j+=$){const H=j<0||j>X||Q<0||Q>X?24575:0,nt=r.clamp(Math.round(j),0,r.EXTENT),st=r.clamp(Math.round(Q),0,r.EXTENT);z.emplaceBack(nt+H,st)}const K=(Q,j)=>{const H=j*N+Q;L.emplaceBack(H+1,H,H+N),L.emplaceBack(H+N,H+N+1,H+1)};for(let Q=1;Q<129;Q++)for(let j=1;j<129;j++)K(j,Q);return[0,129].forEach(Q=>{for(let j=0;j<130;j++)K(j,Q),K(Q,j)}),[z,L,32768]}(),S=n.context;this.gridBuffer=S.createVertexBuffer(_,r.posAttributes.members),this.gridIndexBuffer=S.createIndexBuffer(y),this.gridSegments=r.SegmentVector.simpleSegment(0,0,_.length,y.length),this.gridNoSkirtSegments=r.SegmentVector.simpleSegment(0,0,_.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new el(c.map),this.orthoMatrix=r.create(),r.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,r.EXTENT,0,r.EXTENT,0,1);const M=S.gl;this._overlapStencilMode=new r.StencilMode({func:M.GEQUAL,mask:255},0,255,M.KEEP,M.KEEP,M.REPLACE),this._previousZoom=n.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ec(c.map)}set style(n){n.on("data",this._onStyleDataEvent.bind(this)),n.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=n,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(n,c,_){if(n&&n.terrain){this._style!==n&&(this.style=n),this.enabled=!0;const y=n.terrain.properties;this.sourceCache=n.terrain.drapeRenderMode===0?this._mockSourceCache:n._getSourceCache(y.get("source")),this._exaggeration=y.get("exaggeration");const b=()=>{this.sourceCache.used&&r.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const S=this.getScaledDemTileSize();this.sourceCache.update(c,S,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),c.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(n){this._findCoveringTileCache[n]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const n=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||n.efficiency!==100&&r.warnOnce(`Terrain render cache efficiency is not optimal (${n.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${n.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(n){n.coord&&n.dataType==="source"?this._clearRenderCacheForTile(n.sourceCacheId,n.coord):n.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const n in this._style._sourceCaches)this._style._sourceCaches[n].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(n=>n.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const n=2*this.proxySourceCache.getSource().tileSize;return[n,n]}set useVertexMorphing(n){this._useVertexMorphing=n}updateTileBinding(n){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=_._centerAltitude===0&&this.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(_.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(P=>{const z=c.getTileByID(P).tileID;return z.projMatrix=_.calculateProjMatrix(z.toUnwrapped()),z});(function(P,z){const L=z.transform.pointCoordinate(z.transform.getCameraPoint()),N=new r.Point(L.x,L.y);P.sort(($,X)=>{if(X.overscaledZ-$.overscaledZ)return X.overscaledZ-$.overscaledZ;const J=new r.Point($.canonical.x+(1<<$.canonical.z)*$.wrap,$.canonical.y),K=new r.Point(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),Q=N.mult(1<<$.canonical.z);return Q.x-=.5,Q.y-=.5,Q.distSqr(J)-Q.distSqr(K)})})(y,this.painter),this._previousZoom=_.zoom;const b=this.proxyToSource||{};this.proxyToSource={},y.forEach(P=>{this.proxyToSource[P.key]={}}),this.terrainTileForTile={};const S=this._style._sourceCaches;for(const P in S){const z=S[P];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,n[P],b),z.usedForTerrain))continue;const L=n[P];z.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[c.id]=y.map(P=>new il(P,P.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=r.exported.now();const M={};this._visibleDemTiles=[];for(const P of this.proxyCoords){const z=this.terrainTileForTile[P.key];if(!z)continue;const L=z.tileID.key;L in M||(this._visibleDemTiles.push(z),M[L]=L)}}_assignTerrainTiles(n){this._initializing||n.forEach(c=>{if(this.terrainTileForTile[c.key])return;const _=this._findTileCoveringTileID(c,this.sourceCache);_&&(this.terrainTileForTile[c.key]=_)})}_prepareDEMTextures(){const n=this.painter.context,c=n.gl;for(const _ in this.terrainTileForTile){const y=this.terrainTileForTile[_],b=y.dem;!b||y.demTexture&&!y.needsDEMTextureUpload||(n.activeTexture.set(c.TEXTURE1),bc(this.painter,y,b))}}_prepareDemTileUniforms(n,c,_,y){if(!c||c.demTexture==null)return!1;const b=n.tileID.canonical,S=Math.pow(2,c.tileID.canonical.z-b.z),M=y||"";return _[`u_dem_tl${M}`]=[b.x*S%1,b.y*S%1],_[`u_dem_scale${M}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const n=this.painter.context,c=n.gl;if(!this._emptyDepthBufferTexture){const _=new r.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.Texture(n,_,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let n=0;const c=this._visibleDemTiles.reduce((_,y)=>{if(!y.dem)return _;const b=y.dem.tree.minimums[0];return b>0&&n++,_+b},0);return n?c/n:0}_updateEmptyDEMTexture(){const n=this.painter.context,c=n.gl;n.activeTexture.set(c.TEXTURE2);const _=this._getLoadedAreaMinimum(),y=new r.RGBAImage({width:1,height:1},new Uint8Array(r.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(y,{premultiply:!1}):b=this._emptyDEMTexture=new r.Texture(n,y,c.RGBA,{premultiply:!1}),b}setupElevationDraw(n,c,_){const y=this.painter.context,b=y.gl,S=(M=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:r.DEMData.getUnpackVector(M),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var M;S.u_dem_size=this.sourceCache.getSource().tileSize,S.u_exaggeration=this.exaggeration();let P=null,z=null,L=1;if(_&&_.morphing&&this._useVertexMorphing){const N=_.morphing.srcDemTile,$=_.morphing.dstDemTile;L=_.morphing.phase,N&&$&&(this._prepareDemTileUniforms(n,N,S,"_prev")&&(z=N),this._prepareDemTileUniforms(n,$,S)&&(P=$))}if(z&&P?(y.activeTexture.set(b.TEXTURE2),P.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),y.activeTexture.set(b.TEXTURE4),z.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),S.u_dem_lerp=L):(P=this.terrainTileForTile[n.tileID.key],y.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(n,P,S)?P.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),y.activeTexture.set(b.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(S.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),S.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&P){const N=(1<<P.tileID.canonical.z)*r.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=N}if(_&&_.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),c.setTerrainUniformValues(y,S),this.painter.transform.projection.name==="globe"){const N=this.globeUniformValues(this.painter.transform,n.tileID.canonical,_&&_.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,N)}}globeUniformValues(n,c,_){const y=n.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,r.EXTENT,0),u_tile_br_up:y.upVector(c,r.EXTENT,r.EXTENT),u_tile_bl_up:y.upVector(c,0,r.EXTENT),u_tile_up_scale:_?r.globeMetersToEcef(1):y.upVectorScale(c,n.center.lat,n.worldSize).metersToTile}}renderToBackBuffer(n){const c=this.painter,_=this.painter.context;n.length!==0&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,b,S,M,P){if(y.transform.projection.name==="globe")(function(z,L,N,$,X){const J=z.context,K=J.gl;let Q,j;const H=z.options.showTerrainWireframe?2:0,nt=z.transform,st=r.globeUseCustomAntiAliasing(z,J,nt),ft=($t,Mt)=>{if(j===$t)return;const Nt=[vr[$t],"PROJECTION_GLOBE_VIEW"];st&&Nt.push("CUSTOM_ANTIALIASING"),Mt&&Nt.push(vr[H]),Q=z.useProgram("globeRaster",null,Nt),j=$t},mt=z.colorModeForRenderPass(),_t=new r.DepthMode(K.LEQUAL,r.DepthMode.ReadWrite,z.depthRangeFor3D);ks.update(X);const vt=r.calculateGlobeMercatorMatrix(nt),xt=[r.mercatorXfromLng(nt.center.lng),r.mercatorYfromLat(nt.center.lat)],At=H?[!1,!0]:[!1],Zt=z.globeSharedBuffers,Et=[nt.width*r.exported.devicePixelRatio,nt.height*r.exported.devicePixelRatio],jt=Float32Array.from(nt.globeMatrix),It={useDenormalizedUpVectorScale:!0};if(At.forEach($t=>{const Mt=z.transform,Nt=tl(Mt.zoom)*L.exaggeration();j=-1;const Xt=$t?K.LINES:K.TRIANGLES;for(const Gt of $){const Yt=N.getTile(Gt),me=r.StencilMode.disabled,we=L.prevTerrainTileForTile[Gt.key],de=L.terrainTileForTile[Gt.key];to(we,de)&&ks.newMorphing(Gt.key,we,de,X,250),J.activeTexture.set(K.TEXTURE0),Yt.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);const xe=ks.getMorphValuesForProxy(Gt.key),Be=xe?1:0;xe&&r.extend$1(It,{morphing:{srcDemTile:xe.from,dstDemTile:xe.to,phase:r.easeCubicInOut(xe.phase)}});const De=r.tileCornersToBounds(Gt.canonical),_e=r.getLatitudinalLod(De.getCenter().lat),Je=r.getGridMatrix(Gt.canonical,De,_e,Mt.worldSize/Mt._pixelsPerMercatorPixel),ii=r.globeNormalizeECEF(r.globeTileBounds(Gt.canonical)),ni=Qa(Mt.projMatrix,jt,vt,ii,r.globeToMercatorTransition(Mt.zoom),xt,Mt.frustumCorners.TL,Mt.frustumCorners.TR,Mt.frustumCorners.BR,Mt.frustumCorners.BL,Mt.globeCenterInViewSpace,Mt.globeRadius,Et,Nt,Je);if(ft(Be,$t),L.setupElevationDraw(Yt,Q,It),z.prepareDrawProgram(J,Q,Gt.toUnwrapped()),Zt){const[si,pn,nn]=$t?Zt.getWirefameBuffers(z.context,_e):Zt.getGridBuffers(_e,Nt!==0);Q.draw(J,Xt,_t,me,mt,r.CullFaceMode.backCCW,ni,"globe_raster",si,pn,nn)}}}),Zt){const $t=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];st&&$t.push("CUSTOM_ANTIALIASING"),Q=z.useProgram("globeRaster",null,$t);for(const Mt of $){const{x:Nt,y:Xt,z:Gt}=Mt.canonical,Yt=Xt===0,me=Xt===(1<<Gt)-1,[we,de,xe,Be]=Zt.getPoleBuffers(Gt);if(Be&&(Yt||me)){const De=N.getTile(Mt);J.activeTexture.set(K.TEXTURE0),De.texture.bind(K.LINEAR,K.CLAMP_TO_EDGE);let _e=r.globePoleMatrixForTile(Gt,Nt,nt);const Je=r.globeNormalizeECEF(r.globeTileBounds(Mt.canonical)),ii=(ni,si)=>ni.draw(J,K.TRIANGLES,_t,r.StencilMode.disabled,mt,r.CullFaceMode.disabled,Qa(nt.projMatrix,_e,_e,Je,0,xt,nt.frustumCorners.TL,nt.frustumCorners.TR,nt.frustumCorners.BR,nt.frustumCorners.BL,nt.globeCenterInViewSpace,nt.globeRadius,Et,0),"globe_pole_raster",si,xe,Be);L.setupElevationDraw(De,Q,It),z.prepareDrawProgram(J,Q,Mt.toUnwrapped()),Yt&&ii(Q,we),me&&(_e=r.scale(r.create(),_e,[1,-1,1]),ii(Q,de))}}}})(y,b,S,M,P);else{const z=y.context,L=z.gl;let N,$;const X=y.options.showTerrainWireframe?2:0,J=(nt,st)=>{if($===nt)return;const ft=[vr[nt]];st&&ft.push(vr[X]),N=y.useProgram("terrainRaster",null,ft),$=nt},K=y.colorModeForRenderPass(),Q=new r.DepthMode(L.LEQUAL,r.DepthMode.ReadWrite,y.depthRangeFor3D);ks.update(P);const j=y.transform,H=tl(j.zoom)*b.exaggeration();(X?[!1,!0]:[!1]).forEach(nt=>{$=-1;const st=nt?L.LINES:L.TRIANGLES,[ft,mt]=nt?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const _t of M){const vt=S.getTile(_t),xt=r.StencilMode.disabled,At=b.prevTerrainTileForTile[_t.key],Zt=b.terrainTileForTile[_t.key];to(At,Zt)&&ks.newMorphing(_t.key,At,Zt,P,250),z.activeTexture.set(L.TEXTURE0),vt.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const Et=ks.getMorphValuesForProxy(_t.key),jt=Et?1:0;let It;Et&&(It={morphing:{srcDemTile:Et.from,dstDemTile:Et.to,phase:r.easeCubicInOut(Et.phase)}});const $t=Qr(_t.projMatrix,Tu(_t.canonical,j.renderWorldCopies)?H/10:H);J(jt,nt),b.setupElevationDraw(vt,N,It),y.prepareDrawProgram(z,N,_t.toUnwrapped()),N.draw(z,st,Q,xt,K,r.CullFaceMode.backCCW,$t,"terrain_raster",b.gridBuffer,ft,mt)}})}}(c,this,this.proxySourceCache,n,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),n.splice(0,n.length))}renderBatch(n){if(this._drapedRenderBatches.length===0)return n+1;this.renderingToTexture=!0;const c=this.painter,_=this.painter.context,y=this.proxySourceCache,b=this.proxiedCoords[y.id],S=this._drapedRenderBatches.shift(),M=[],P=c.style.order;let z=0;for(const L of b){const N=y.getTileByID(L.proxyTileKey),$=y.proxyCachedFBO[L.key]?y.proxyCachedFBO[L.key][n]:void 0,X=$!==void 0?y.renderCache[$]:this.pool[z++],J=$!==void 0;if(N.texture=X.tex,J&&!X.dirty){M.push(N.tileID);continue}let K;_.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(_.clear({color:r.Color.transparent,stencil:0}),X.dirty=!1);for(let Q=S.start;Q<=S.end;++Q){const j=c.style._layers[P[Q]];if(j.isHidden(c.transform.zoom))continue;const H=c.style._getLayerSourceCache(j),nt=H?this.proxyToSource[L.key][H.id]:[L];if(!nt)continue;const st=nt;_.viewport.set([0,0,X.fb.width,X.fb.height]),K!==(H?H.id:null)&&(this._setupStencil(X,nt,j,H),K=H?H.id:null),c.renderLayer(c,H,j,st)}this.renderedToTile?(X.dirty=!0,M.push(N.tileID)):J||--z,z===5&&(z=0,this.renderToBackBuffer(M))}return this.renderToBackBuffer(M),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,c.width,c.height]),S.end+1}postRender(){}renderCacheEfficiency(n){const c=n.order.length;if(c===0)return{efficiency:100};let _,y=0,b=0,S=!1;for(let M=0;M<c;++M){const P=n._layers[n.order[M]];this._style.isLayerDraped(P)?(S&&++y,++b):S||(S=!0,_=P.id)}return b===0?{efficiency:100}:{efficiency:100*(1-y/b),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let n=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{n=Math.min(n,c.dem.tree.minimums[0])}),n===0?n:(n-30)*this._exaggeration}raycast(n,c,_){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const S=b.tileID,M=1<<S.overscaledZ,{x:P,y:z}=S.canonical,L=P/M,N=(P+1)/M,$=z/M,X=(z+1)/M;return{minx:L,miny:$,maxx:N,maxy:X,t:b.dem.tree.raycastRoot(L,$,N,X,n,c,_),tile:b}});y.sort((b,S)=>(b.t!==null?b.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const b of y){if(b.t==null)return null;const S=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,n,c,_);if(S!=null)return S}return null}_createFBO(){const n=this.painter.context,c=n.gl,_=this.drapeBufferSize;n.activeTexture.set(c.TEXTURE0);const y=new r.Texture(n,{width:_[0],height:_[1],data:null},c.RGBA);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const b=n.createFramebuffer(_[0],_[1],!1);return b.colorAttachment.set(y.texture),b.depthAttachment=new gt(n,b.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=n.createRenderbuffer(n.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),n.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),n.extTextureFilterAnisotropic&&!n.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax),{fb:b,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const n in this._style._sourceCaches)if(this._style._sourceCaches[n].hasTransition())return!0;return this._style.order.some(n=>{const c=this._style._layers[n],_=c.isHidden(this.painter.transform.zoom);return c.type==="custom"?!_&&c.shouldRedrape():!_&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let n=!1;for(const _ of this._style._getSources())if(_ instanceof ie){n=!0;break}if(!n)return;const c={};for(let _=0;_<this._style.order.length;++_){const y=this._style._layers[this._style.order[_]],b=this._style._getLayerSourceCache(y);if(b&&!c[b.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof r.ZoomDependentExpression){c[b.id]=!0;for(const S of this.proxyCoords){const M=this.proxyToSource[S.key][b.id];if(M)for(const P of M)this._clearRenderCacheForTile(b.id,P)}}}}_clearRasterLayersFromRenderCache(){let n=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Kt){n=!0;break}if(!n)return;const c={};for(let _=0;_<this._style.order.length;++_){const y=this._style._layers[this._style.order[_]],b=this._style._getLayerSourceCache(y);if(!b||c[b.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const S=y.paint.get("raster-fade-duration");for(const M of this.proxyCoords){const P=this.proxyToSource[M.key][b.id];if(P)for(const z of P){const L=Tc(b.getTile(z),b.findLoadedParent(z,0),b,this.painter.transform,S);(L.opacity!==1||L.mix!==0)&&this._clearRenderCacheForTile(b.id,z)}}}}_setupDrapedRenderBatches(){const n=this._style.order,c=n.length;if(c===0)return;const _=[];let y,b=0,S=this._style._layers[n[b]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++b<c;)S=this._style._layers[n[b]];for(;b<c;++b){const M=this._style._layers[n[b]];M.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(M)?y===void 0&&(y=b):y!==void 0&&(_.push({start:y,end:b-1}),y=void 0))}y!==void 0&&_.push({start:y,end:b-1}),this._drapedRenderBatches=_}_setupRenderCache(n){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const S=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let M=0;M<S.length;++M){const P=Object.values(S[M]);c.renderCachePool.push(...P)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,y=this._tilesDirty;for(let S=_.length-1;S>=0;S--){const M=_[S];if(c.getTileByID(M.key),c.proxyCachedFBO[M.key]!==void 0){const P=n[M.key],z=this.proxyToSource[M.key];let L=0;for(const N in z){const $=z[N],X=P[N];if(!X||X.length!==$.length||$.some((J,K)=>J!==X[K]||y[N]&&y[N].hasOwnProperty(J.key))){L=-1;break}++L}for(const N in c.proxyCachedFBO[M.key])c.renderCache[c.proxyCachedFBO[M.key][N]].dirty=L<0||L!==Object.values(P).length}}const b=[...this._drapedRenderBatches];b.sort((S,M)=>M.end-M.start-(S.end-S.start));for(const S of b)for(const M of _){if(c.proxyCachedFBO[M.key])continue;let P=c.renderCachePool.pop();P===void 0&&c.renderCache.length<50&&(P=c.renderCache.length,c.renderCache.push(this._createFBO())),P!==void 0&&(c.proxyCachedFBO[M.key]={},c.proxyCachedFBO[M.key][S.start]=P,c.renderCache[P].dirty=!0)}this._tilesDirty={}}_setupStencil(n,c,_,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,S=b.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let M;if(_.isTileClipped())M=c.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);M=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+M>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=M,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(n){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[n.key]),this._overlapStencilMode):r.StencilMode.disabled}_renderTileClippingMasks(n,c){const _=this.painter,y=this.painter.context,b=y.gl;_._tileClippingMaskIDs={},y.setColorMode(r.ColorMode.disabled),y.setDepthMode(r.DepthMode.disabled);const S=_.useProgram("clippingMask");for(const M of n){const P=_._tileClippingMaskIDs[M.key]=--c;S.draw(y,b.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:b.ALWAYS,mask:0},P,255,b.KEEP,b.KEEP,b.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,Jo(M.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(n){const c=this.painter.transform;if(n.x<0||n.x>c.width||n.y<0||n.y>c.height)return null;const _=[n.x,n.y,1,1];r.transformMat4$1(_,_,c.pixelMatrixInverse),r.scale$1(_,_,1/_[3]),_[0]/=c.worldSize,_[1]/=c.worldSize;const y=c._camera.position,b=r.mercatorZfromAltitude(1,c.center.lat),S=[y[0],y[1],y[2]/b,0],M=r.subtract([],_.slice(0,3),S);r.normalize(M,M);const P=this.raycast(S,M,this._exaggeration);return P!==null&&P?(r.scaleAndAdd(S,S,M,P),S[3]=S[2],S[2]*=b,S):null}drawDepth(){const n=this.painter,c=n.context,_=this.proxySourceCache,y=Math.ceil(n.width),b=Math.ceil(n.height);if(!this._depthFBO||this._depthFBO.width===y&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const S=c.gl,M=c.createFramebuffer(y,b,!0);c.activeTexture.set(S.TEXTURE0);const P=new r.Texture(c,{width:y,height:b,data:null},S.RGBA);P.bind(S.NEAREST,S.CLAMP_TO_EDGE),M.colorAttachment.set(P.texture);const z=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,y,b);M.depthAttachment.set(z),this._depthFBO=M,this._depthTexture=P}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,y,b]),function(S,M,P,z){if(S.transform.projection.name==="globe")return;const L=S.context,N=L.gl;L.clear({depth:1});const $=S.useProgram("terrainDepth"),X=new r.DepthMode(N.LESS,r.DepthMode.ReadWrite,S.depthRangeFor3D);for(const J of z){const K=P.getTile(J),Q=Qr(J.projMatrix,0);M.setupElevationDraw(K,$),$.draw(L,N.TRIANGLES,X,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.backCCW,Q,"terrain_depth",M.gridBuffer,M.gridIndexBuffer,M.gridNoSkirtSegments)}}(n,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(n,c,_){if(n.getSource()instanceof Pe)return this._setupProxiedCoordsForImageSource(n,c,_);this._findCoveringTileCache[n.id]=this._findCoveringTileCache[n.id]||{};const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords;for(let M=0;M<b.length;M++){const P=b[M],z=this._findTileCoveringTileID(P,n);if(z){const L=this._createProxiedId(P,z,_[P.key]&&_[P.key][n.id]);y.push(L),this.proxyToSource[P.key][n.id]=[L]}}let S=!1;for(let M=0;M<c.length;M++){const P=n.getTile(c[M]);if(!P||!P.hasData())continue;const z=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(z&&z.tileID.canonical.z!==P.tileID.canonical.z){const L=this.proxyToSource[z.tileID.key][n.id],N=this._createProxiedId(z.tileID,P,_[z.tileID.key]&&_[z.tileID.key][n.id]);L?L.splice(L.length-1,0,N):this.proxyToSource[z.tileID.key][n.id]=[N],y.push(N),S=!0}}this._sourceTilesOverlap[n.id]=S}_setupProxiedCoordsForImageSource(n,c,_){if(!n.getSource().loaded())return;const y=this.proxiedCoords[n.id]=[],b=this.proxyCoords,S=n.getSource(),M=new r.Point(S.tileID.x,S.tileID.y)._div(1<<S.tileID.z),P=S.coordinates.map(r.MercatorCoordinate.fromLngLat).reduce((L,N)=>(L.min.x=Math.min(L.min.x,N.x-M.x),L.min.y=Math.min(L.min.y,N.y-M.y),L.max.x=Math.max(L.max.x,N.x-M.x),L.max.y=Math.max(L.max.y,N.y-M.y),L),{min:new r.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),z=(L,N)=>{const $=L.wrap+L.canonical.x/(1<<L.canonical.z),X=L.canonical.y/(1<<L.canonical.z),J=r.EXTENT/(1<<L.canonical.z),K=N.wrap+N.canonical.x/(1<<N.canonical.z),Q=N.canonical.y/(1<<N.canonical.z);return $+J<K+P.min.x||$>K+P.max.x||X+J<Q+P.min.y||X>Q+P.max.y};for(let L=0;L<b.length;L++){const N=b[L];for(let $=0;$<c.length;$++){const X=n.getTile(c[$]);if(!X||!X.hasData()||z(N,X.tileID))continue;const J=this._createProxiedId(N,X,_[N.key]&&_[N.key][n.id]),K=this.proxyToSource[N.key][n.id];K?K.push(J):this.proxyToSource[N.key][n.id]=[J],y.push(J)}}}_createProxiedId(n,c,_){let y=this.orthoMatrix;if(_){const b=_.find(S=>S.key===c.tileID.key);if(b)return b}if(c.tileID.key!==n.key){const b=n.canonical.z-c.tileID.canonical.z;let S,M,P;y=r.create();const z=c.tileID.wrap-n.wrap<<n.overscaledZ;b>0?(S=r.EXTENT>>b,M=S*((c.tileID.canonical.x<<b)-n.canonical.x+z),P=S*((c.tileID.canonical.y<<b)-n.canonical.y)):(S=r.EXTENT<<-b,M=r.EXTENT*(c.tileID.canonical.x-(n.canonical.x+z<<-b)),P=r.EXTENT*(c.tileID.canonical.y-(n.canonical.y<<-b))),r.ortho(y,0,S,0,S,0,1),r.translate(y,y,[M,P,0])}return new il(c.tileID,n.key,y)}_findTileCoveringTileID(n,c){let _=c.getTile(n);if(_&&_.hasData())return _;const y=this._findCoveringTileCache[c.id],b=y[n.key];if(_=b?c.getTileByID(b):null,_&&_.hasData()||b===null)return _;let S=_?_.tileID:n,M=S.overscaledZ;const P=c.getSource().minzoom,z=[];if(!b){const N=c.getSource().maxzoom;if(n.canonical.z>=N){const $=n.canonical.z-N;c.getSource().reparseOverscaled?(M=Math.max(n.canonical.z+2,c.transform.tileZoom),S=new r.OverscaledTileID(M,n.wrap,N,n.canonical.x>>$,n.canonical.y>>$)):$!==0&&(M=N,S=new r.OverscaledTileID(M,n.wrap,N,n.canonical.x>>$,n.canonical.y>>$))}S.key!==n.key&&(z.push(S.key),_=c.getTile(S))}const L=N=>{z.forEach($=>{y[$]=N}),z.length=0};for(M-=1;M>=P&&(!_||!_.hasData());M--){_&&L(_.tileID.key);const N=S.calculateScaledKey(M);if(_=c.getTileByID(N),_&&_.hasData())break;const $=y[N];if($===null)break;$===void 0?z.push(N):_=c.getTileByID($)}return L(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(n){return this.enabled?this._findTileCoveringTileID(n,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(n,c){let _=this._tilesDirty[n];_||(_=this._tilesDirty[n]={}),_[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const n=function(c){let _=0;const y=new r.StructArrayLayout2ui4,b=131;for(let S=1;S<129;S++){for(let M=1;M<129;M++)_=S*b+M,y.emplaceBack(_,_+1),y.emplaceBack(_,_+b),y.emplaceBack(_+1,_+b),S===128&&y.emplaceBack(_+b,_+b+1);y.emplaceBack(_+1,_+1+b)}return y}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(n),this.wireframeSegments=r.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,n.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ue{static cacheKey(n,c,_,y){let b=`${c}${y?y.cacheKey:""}`;for(const S of _)n.usedDefines.includes(S)&&(b+=`/${S}`);return b}constructor(n,c,_,y,b,S){const M=n.gl;this.program=M.createProgram();const P=function(j){const H=[];for(let nt=0;nt<j.length;nt++){if(j[nt]===null)continue;const st=j[nt].split(" ");H.push(st.pop())}return H}(_.staticAttributes),z=y?y.getBinderAttributes():[],L=P.concat(z);let N=y?y.defines():[];N=N.concat(S.map(j=>`#define ${j}`));const $=n.isWebGL2?`#version 300 es
`:"",X=$+N.concat(n.extStandardDerivatives&&$.length===0?`#extension GL_OES_standard_derivatives : enable
`.concat(yc):yc,yc,Ja,vu.fragmentSource,Kr.fragmentSource,_.fragmentSource).join(`
`),J=$+N.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ja,vu.vertexSource,Kr.vertexSource,Ka.vertexSource,_.vertexSource).join(`
`),K=M.createShader(M.FRAGMENT_SHADER);if(M.isContextLost())return void(this.failedToCreate=!0);M.shaderSource(K,X),M.compileShader(K),M.attachShader(this.program,K);const Q=M.createShader(M.VERTEX_SHADER);if(M.isContextLost())this.failedToCreate=!0;else{M.shaderSource(Q,J),M.compileShader(Q),M.attachShader(this.program,Q),this.attributes={},this.numAttributes=L.length;for(let j=0;j<this.numAttributes;j++)L[j]&&(M.bindAttribLocation(this.program,j,L[j]),this.attributes[L[j]]=j);M.linkProgram(this.program),M.deleteShader(Q),M.deleteShader(K),this.fixedUniforms=b(n),this.binderUniforms=y?y.getUniforms(n):[],S.includes("TERRAIN")&&(this.terrainUniforms=(j=>({u_dem:new r.Uniform1i(j),u_dem_prev:new r.Uniform1i(j),u_dem_unpack:new r.Uniform4f(j),u_dem_tl:new r.Uniform2f(j),u_dem_scale:new r.Uniform1f(j),u_dem_tl_prev:new r.Uniform2f(j),u_dem_scale_prev:new r.Uniform1f(j),u_dem_size:new r.Uniform1f(j),u_dem_lerp:new r.Uniform1f(j),u_exaggeration:new r.Uniform1f(j),u_depth:new r.Uniform1i(j),u_depth_size_inv:new r.Uniform2f(j),u_meter_to_dem:new r.Uniform1f(j),u_label_plane_matrix_inv:new r.UniformMatrix4f(j)}))(n)),S.includes("GLOBE")&&(this.globeUniforms=(j=>({u_tile_tl_up:new r.Uniform3f(j),u_tile_tr_up:new r.Uniform3f(j),u_tile_br_up:new r.Uniform3f(j),u_tile_bl_up:new r.Uniform3f(j),u_tile_up_scale:new r.Uniform1f(j)}))(n)),S.includes("FOG")&&(this.fogUniforms=(j=>({u_fog_matrix:new r.UniformMatrix4f(j),u_fog_range:new r.Uniform2f(j),u_fog_color:new r.Uniform4f(j),u_fog_horizon_blend:new r.Uniform1f(j),u_fog_temporal_offset:new r.Uniform1f(j),u_frustum_tl:new r.Uniform3f(j),u_frustum_tr:new r.Uniform3f(j),u_frustum_br:new r.Uniform3f(j),u_frustum_bl:new r.Uniform3f(j),u_globe_pos:new r.Uniform3f(j),u_globe_radius:new r.Uniform1f(j),u_globe_transition:new r.Uniform1f(j),u_is_globe:new r.Uniform1i(j),u_viewport:new r.Uniform2f(j)}))(n))}}setTerrainUniformValues(n,c){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)_[y]&&_[y].set(this.program,y,c[y])}}setGlobeUniformValues(n,c){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)_[y]&&_[y].set(this.program,y,c[y])}}setFogUniformValues(n,c){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){n.program.set(this.program);for(const y in c)_[y].set(this.program,y,c[y])}}draw(n,c,_,y,b,S,M,P,z,L,N,$,X,J,K){const Q=n.gl;if(this.failedToCreate)return;n.program.set(this.program),n.setDepthMode(_),n.setStencilMode(y),n.setColorMode(b),n.setCullFace(S);for(const H of Object.keys(this.fixedUniforms))this.fixedUniforms[H].set(this.program,H,M[H]);J&&J.setUniforms(this.program,n,this.binderUniforms,$,{zoom:X});const j={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[c];for(const H of N.get()){const nt=H.vaos||(H.vaos={});(nt[P]||(nt[P]=new Fp)).bind(n,this,z,J?J.getPaintVertexBuffers():[],L,H.vertexOffset,K||[]),Q.drawElements(c,H.primitiveLength*j,Q.UNSIGNED_SHORT,H.primitiveOffset*j*2)}}}function Qo(d,n){const c=Math.pow(2,n.tileID.overscaledZ),_=n.tileSize*Math.pow(2,d.transform.tileZoom)/c,y=_*(n.tileID.canonical.x+n.tileID.wrap*c),b=_*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_tile_units_to_pixels:1/ki(n,1,d.transform.tileZoom),u_pixel_coord_upper:[y>>16,b>>16],u_pixel_coord_lower:[65535&y,65535&b]}}const Eu=r.create(),Mc=(d,n,c,_,y,b,S,M,P,z,L)=>{const N=n.style.light,$=N.properties.get("position"),X=[$.x,$.y,$.z],J=r.create$1();N.properties.get("anchor")==="viewport"&&(r.fromRotation(J,-n.transform.angle),r.transformMat3(X,X,J));const K=N.properties.get("color"),Q=n.transform,j={u_matrix:d,u_lightpos:X,u_lightintensity:N.properties.get("intensity"),u_lightcolor:[K.r,K.g,K.b],u_vertical_gradient:+c,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Eu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:y,u_edge_radius:b};return Q.projection.name==="globe"&&(j.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],j.u_zoom_transition=P,j.u_inv_rot_matrix=L,j.u_merc_center=z,j.u_up_dir=Q.projection.upVector(new r.CanonicalTileID(0,0,0),z[0]*r.EXTENT,z[1]*r.EXTENT),j.u_height_lift=M),j},Su=(d,n,c,_,y,b,S,M,P,z,L,N)=>{const $=Mc(d,n,c,_,y,b,S,P,z,L,N),X={u_height_factor:-Math.pow(2,S.overscaledZ)/M.tileSize/8};return r.extend($,Qo(n,M),X)},br=d=>({u_matrix:d}),Ac=(d,n,c)=>r.extend(br(d),Qo(n,c)),Np=(d,n)=>({u_matrix:d,u_world:n}),jp=(d,n,c,_)=>r.extend(Ac(d,n,c),{u_world:_}),Vp=r.create(),Cc=(d,n,c,_,y,b)=>{const S=d.transform,M=S.projection.name==="globe";let P;if(b.paint.get("circle-pitch-alignment")==="map")if(M){const L=r.globePixelsToTileUnits(S.zoom,n.canonical)*S._pixelsPerMercatorPixel;P=Float32Array.from([L,0,0,L])}else P=S.calculatePixelsToTileUnitsMatrix(c);else P=new Float32Array([S.pixelsToGLUnits[0],0,0,S.pixelsToGLUnits[1]]);const z={u_camera_to_center_distance:S.cameraToCenterDistance,u_matrix:d.translatePosMatrix(n.projMatrix,c,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:r.exported.devicePixelRatio,u_extrude_scale:P,u_inv_rot_matrix:Vp,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(M){z.u_inv_rot_matrix=_,z.u_merc_center=y,z.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],z.u_zoom_transition=r.globeToMercatorTransition(S.zoom);const L=y[0]*r.EXTENT,N=y[1]*r.EXTENT;z.u_up_dir=S.projection.upVector(new r.CanonicalTileID(0,0,0),L,N)}return z},Ic=d=>{const n=[];return d.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),d.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n},Pc=(d,n,c,_)=>{const y=r.EXTENT/c.tileSize;return{u_matrix:d,u_camera_to_center_distance:n.getCameraToCenterDistance(_),u_extrude_scale:[n.pixelsToGLUnits[0]/y,n.pixelsToGLUnits[1]/y]}},nl=(d,n,c=1)=>({u_matrix:d,u_color:n,u_overlay:0,u_overlay_scale:c}),Mu=r.create(),Au=(d,n,c,_,y,b,S)=>{const M=d.transform,P=M.projection.name==="globe",z=P?r.globePixelsToTileUnits(M.zoom,n.canonical)*M._pixelsPerMercatorPixel:ki(c,1,b),L={u_matrix:n.projMatrix,u_extrude_scale:z,u_intensity:S,u_inv_rot_matrix:Mu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(P){L.u_inv_rot_matrix=_,L.u_merc_center=y,L.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],L.u_zoom_transition=r.globeToMercatorTransition(M.zoom);const N=y[0]*r.EXTENT,$=y[1]*r.EXTENT;L.u_up_dir=M.projection.upVector(new r.CanonicalTileID(0,0,0),N,$)}return L},Up=(d,n,c,_,y,b,S)=>{const M=d.transform,P=M.calculatePixelsToTileUnitsMatrix(n);return{u_matrix:kc(d,n,c,_),u_pixels_to_tile_units:P,u_device_pixel_ratio:b,u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:y,u_texsize:ea(c)?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:eo(n,d.transform),u_alpha_discard_threshold:0,u_trim_offset:S}},ta=(d,n,c,_,y)=>{const b=d.transform;return{u_matrix:kc(d,n,c,_),u_texsize:n.imageAtlasTexture.size,u_pixels_to_tile_units:b.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:y,u_image:0,u_tile_units_to_pixels:eo(n,b),u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function eo(d,n){return 1/ki(d,1,n.tileZoom)}function kc(d,n,c,_){return d.translatePosMatrix(_||n.tileID.projMatrix,n,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function ea(d){const n=d.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}const Dc=(d,n,c,_,y,b)=>{return{u_matrix:d,u_tl_parent:n,u_scale_parent:c,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(M=y.paint.get("raster-saturation"),M>0?1-1/(1.001-M):-M),u_contrast_factor:(S=y.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:ps(y.paint.get("raster-hue-rotate")),u_perspective_transform:b};var S,M};function ps(d){d*=Math.PI/180;const n=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*n-c+1)/3,(Math.sqrt(3)*n-c+1)/3]}const sl=r.create(),Lc=(d,n,c,_,y,b,S,M,P,z,L,N,$,X,J,K)=>{const Q=y.transform,j={u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:Q.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:Q.width/Q.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:S,u_coord_matrix:M,u_is_text:+P,u_pitch_with_map:+_,u_texsize:z,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:sl,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:sl,u_up_vector:[0,-1,0]};return K.name==="globe"&&(j.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],j.u_zoom_transition=N,j.u_inv_rot_matrix=X,j.u_merc_center=$,j.u_camera_forward=Q._camera.forward(),j.u_ecef_origin=r.globeECEFOrigin(Q.globeMatrix,L.toUnwrapped()),j.u_tile_matrix=Float32Array.from(Q.globeMatrix),j.u_up_vector=J),j},rl=(d,n,c,_,y,b,S,M,P,z,L,N,$,X,J,K,Q)=>r.extend(Lc(d,n,c,_,y,b,S,M,P,z,N,$,X,J,K,Q),{u_gamma_scale:_?y.transform.cameraToCenterDistance*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:r.exported.devicePixelRatio,u_is_halo:+L}),Cu=(d,n,c,_,y,b,S,M,P,z,L,N,$,X,J,K)=>r.extend(rl(d,n,c,_,y,b,S,M,!0,P,!0,L,N,$,X,J,K),{u_texsize_icon:z,u_texture_icon:1}),zc=(d,n,c)=>({u_matrix:d,u_opacity:n,u_color:c}),Gp=(d,n,c,_,y)=>r.extend(function(b,S,M){const P=S.imageManager.getPattern(b.toString()),{width:z,height:L}=S.imageManager.getPixelSize(),N=Math.pow(2,M.tileID.overscaledZ),$=M.tileSize*Math.pow(2,S.transform.tileZoom)/N,X=$*(M.tileID.canonical.x+M.tileID.wrap*N),J=$*M.tileID.canonical.y;return{u_image:0,u_pattern_tl:P.tl,u_pattern_br:P.br,u_texsize:[z,L],u_pattern_size:P.displaySize,u_tile_units_to_pixels:1/ki(M,1,S.transform.tileZoom),u_pixel_coord_upper:[X>>16,J>>16],u_pixel_coord_lower:[65535&X,65535&J]}}(_,c,y),{u_matrix:d,u_opacity:n}),Rc={fillExtrusion:d=>({u_matrix:new r.UniformMatrix4f(d),u_lightpos:new r.Uniform3f(d),u_lightintensity:new r.Uniform1f(d),u_lightcolor:new r.Uniform3f(d),u_vertical_gradient:new r.Uniform1f(d),u_opacity:new r.Uniform1f(d),u_edge_radius:new r.Uniform1f(d),u_ao:new r.Uniform2f(d),u_tile_id:new r.Uniform3f(d),u_zoom_transition:new r.Uniform1f(d),u_inv_rot_matrix:new r.UniformMatrix4f(d),u_merc_center:new r.Uniform2f(d),u_up_dir:new r.Uniform3f(d),u_height_lift:new r.Uniform1f(d)}),fillExtrusionPattern:d=>({u_matrix:new r.UniformMatrix4f(d),u_lightpos:new r.Uniform3f(d),u_lightintensity:new r.Uniform1f(d),u_lightcolor:new r.Uniform3f(d),u_vertical_gradient:new r.Uniform1f(d),u_height_factor:new r.Uniform1f(d),u_edge_radius:new r.Uniform1f(d),u_ao:new r.Uniform2f(d),u_tile_id:new r.Uniform3f(d),u_zoom_transition:new r.Uniform1f(d),u_inv_rot_matrix:new r.UniformMatrix4f(d),u_merc_center:new r.Uniform2f(d),u_up_dir:new r.Uniform3f(d),u_height_lift:new r.Uniform1f(d),u_image:new r.Uniform1i(d),u_texsize:new r.Uniform2f(d),u_pixel_coord_upper:new r.Uniform2f(d),u_pixel_coord_lower:new r.Uniform2f(d),u_tile_units_to_pixels:new r.Uniform1f(d),u_opacity:new r.Uniform1f(d)}),fill:d=>({u_matrix:new r.UniformMatrix4f(d)}),fillPattern:d=>({u_matrix:new r.UniformMatrix4f(d),u_image:new r.Uniform1i(d),u_texsize:new r.Uniform2f(d),u_pixel_coord_upper:new r.Uniform2f(d),u_pixel_coord_lower:new r.Uniform2f(d),u_tile_units_to_pixels:new r.Uniform1f(d)}),fillOutline:d=>({u_matrix:new r.UniformMatrix4f(d),u_world:new r.Uniform2f(d)}),fillOutlinePattern:d=>({u_matrix:new r.UniformMatrix4f(d),u_world:new r.Uniform2f(d),u_image:new r.Uniform1i(d),u_texsize:new r.Uniform2f(d),u_pixel_coord_upper:new r.Uniform2f(d),u_pixel_coord_lower:new r.Uniform2f(d),u_tile_units_to_pixels:new r.Uniform1f(d)}),circle:d=>({u_camera_to_center_distance:new r.Uniform1f(d),u_extrude_scale:new r.UniformMatrix2f(d),u_device_pixel_ratio:new r.Uniform1f(d),u_matrix:new r.UniformMatrix4f(d),u_inv_rot_matrix:new r.UniformMatrix4f(d),u_merc_center:new r.Uniform2f(d),u_tile_id:new r.Uniform3f(d),u_zoom_transition:new r.Uniform1f(d),u_up_dir:new r.Uniform3f(d)}),collisionBox:d=>({u_matrix:new r.UniformMatrix4f(d),u_camera_to_center_distance:new r.Uniform1f(d),u_extrude_scale:new r.Uniform2f(d)}),collisionCircle:d=>({u_matrix:new r.UniformMatrix4f(d),u_inv_matrix:new r.UniformMatrix4f(d),u_camera_to_center_distance:new r.Uniform1f(d),u_viewport_size:new r.Uniform2f(d)}),debug:d=>({u_color:new r.UniformColor(d),u_matrix:new r.UniformMatrix4f(d),u_overlay:new r.Uniform1i(d),u_overlay_scale:new r.Uniform1f(d)}),clippingMask:d=>({u_matrix:new r.UniformMatrix4f(d)}),heatmap:d=>({u_extrude_scale:new r.Uniform1f(d),u_intensity:new r.Uniform1f(d),u_matrix:new r.UniformMatrix4f(d),u_inv_rot_matrix:new r.UniformMatrix4f(d),u_merc_center:new r.Uniform2f(d),u_tile_id:new r.Uniform3f(d),u_zoom_transition:new r.Uniform1f(d),u_up_dir:new r.Uniform3f(d)}),heatmapTexture:d=>({u_image:new r.Uniform1i(d),u_color_ramp:new r.Uniform1i(d),u_opacity:new r.Uniform1f(d)}),hillshade:d=>({u_matrix:new r.UniformMatrix4f(d),u_image:new r.Uniform1i(d),u_latrange:new r.Uniform2f(d),u_light:new r.Uniform2f(d),u_shadow:new r.UniformColor(d),u_highlight:new r.UniformColor(d),u_accent:new r.UniformColor(d)}),hillshadePrepare:d=>({u_matrix:new r.UniformMatrix4f(d),u_image:new r.Uniform1i(d),u_dimension:new r.Uniform2f(d),u_zoom:new r.Uniform1f(d),u_unpack:new r.Uniform4f(d)}),line:d=>({u_matrix:new r.UniformMatrix4f(d),u_pixels_to_tile_units:new r.UniformMatrix2f(d),u_device_pixel_ratio:new r.Uniform1f(d),u_units_to_pixels:new r.Uniform2f(d),u_dash_image:new r.Uniform1i(d),u_gradient_image:new r.Uniform1i(d),u_image_height:new r.Uniform1f(d),u_texsize:new r.Uniform2f(d),u_tile_units_to_pixels:new r.Uniform1f(d),u_alpha_discard_threshold:new r.Uniform1f(d),u_trim_offset:new r.Uniform2f(d)}),linePattern:d=>({u_matrix:new r.UniformMatrix4f(d),u_texsize:new r.Uniform2f(d),u_pixels_to_tile_units:new r.UniformMatrix2f(d),u_device_pixel_ratio:new r.Uniform1f(d),u_image:new r.Uniform1i(d),u_units_to_pixels:new r.Uniform2f(d),u_tile_units_to_pixels:new r.Uniform1f(d),u_alpha_discard_threshold:new r.Uniform1f(d)}),raster:d=>({u_matrix:new r.UniformMatrix4f(d),u_tl_parent:new r.Uniform2f(d),u_scale_parent:new r.Uniform1f(d),u_fade_t:new r.Uniform1f(d),u_opacity:new r.Uniform1f(d),u_image0:new r.Uniform1i(d),u_image1:new r.Uniform1i(d),u_brightness_low:new r.Uniform1f(d),u_brightness_high:new r.Uniform1f(d),u_saturation_factor:new r.Uniform1f(d),u_contrast_factor:new r.Uniform1f(d),u_spin_weights:new r.Uniform3f(d),u_perspective_transform:new r.Uniform2f(d)}),symbolIcon:d=>({u_is_size_zoom_constant:new r.Uniform1i(d),u_is_size_feature_constant:new r.Uniform1i(d),u_size_t:new r.Uniform1f(d),u_size:new r.Uniform1f(d),u_camera_to_center_distance:new r.Uniform1f(d),u_rotate_symbol:new r.Uniform1i(d),u_aspect_ratio:new r.Uniform1f(d),u_fade_change:new r.Uniform1f(d),u_matrix:new r.UniformMatrix4f(d),u_label_plane_matrix:new r.UniformMatrix4f(d),u_coord_matrix:new r.UniformMatrix4f(d),u_is_text:new r.Uniform1i(d),u_pitch_with_map:new r.Uniform1i(d),u_texsize:new r.Uniform2f(d),u_tile_id:new r.Uniform3f(d),u_zoom_transition:new r.Uniform1f(d),u_inv_rot_matrix:new r.UniformMatrix4f(d),u_merc_center:new r.Uniform2f(d),u_camera_forward:new r.Uniform3f(d),u_tile_matrix:new r.UniformMatrix4f(d),u_up_vector:new r.Uniform3f(d),u_ecef_origin:new r.Uniform3f(d),u_texture:new r.Uniform1i(d)}),symbolSDF:d=>({u_is_size_zoom_constant:new r.Uniform1i(d),u_is_size_feature_constant:new r.Uniform1i(d),u_size_t:new r.Uniform1f(d),u_size:new r.Uniform1f(d),u_camera_to_center_distance:new r.Uniform1f(d),u_rotate_symbol:new r.Uniform1i(d),u_aspect_ratio:new r.Uniform1f(d),u_fade_change:new r.Uniform1f(d),u_matrix:new r.UniformMatrix4f(d),u_label_plane_matrix:new r.UniformMatrix4f(d),u_coord_matrix:new r.UniformMatrix4f(d),u_is_text:new r.Uniform1i(d),u_pitch_with_map:new r.Uniform1i(d),u_texsize:new r.Uniform2f(d),u_texture:new r.Uniform1i(d),u_gamma_scale:new r.Uniform1f(d),u_device_pixel_ratio:new r.Uniform1f(d),u_tile_id:new r.Uniform3f(d),u_zoom_transition:new r.Uniform1f(d),u_inv_rot_matrix:new r.UniformMatrix4f(d),u_merc_center:new r.Uniform2f(d),u_camera_forward:new r.Uniform3f(d),u_tile_matrix:new r.UniformMatrix4f(d),u_up_vector:new r.Uniform3f(d),u_ecef_origin:new r.Uniform3f(d),u_is_halo:new r.Uniform1i(d)}),symbolTextAndIcon:d=>({u_is_size_zoom_constant:new r.Uniform1i(d),u_is_size_feature_constant:new r.Uniform1i(d),u_size_t:new r.Uniform1f(d),u_size:new r.Uniform1f(d),u_camera_to_center_distance:new r.Uniform1f(d),u_rotate_symbol:new r.Uniform1i(d),u_aspect_ratio:new r.Uniform1f(d),u_fade_change:new r.Uniform1f(d),u_matrix:new r.UniformMatrix4f(d),u_label_plane_matrix:new r.UniformMatrix4f(d),u_coord_matrix:new r.UniformMatrix4f(d),u_is_text:new r.Uniform1i(d),u_pitch_with_map:new r.Uniform1i(d),u_texsize:new r.Uniform2f(d),u_texsize_icon:new r.Uniform2f(d),u_texture:new r.Uniform1i(d),u_texture_icon:new r.Uniform1i(d),u_gamma_scale:new r.Uniform1f(d),u_device_pixel_ratio:new r.Uniform1f(d),u_is_halo:new r.Uniform1i(d)}),background:d=>({u_matrix:new r.UniformMatrix4f(d),u_opacity:new r.Uniform1f(d),u_color:new r.UniformColor(d)}),backgroundPattern:d=>({u_matrix:new r.UniformMatrix4f(d),u_opacity:new r.Uniform1f(d),u_image:new r.Uniform1i(d),u_pattern_tl:new r.Uniform2f(d),u_pattern_br:new r.Uniform2f(d),u_texsize:new r.Uniform2f(d),u_pattern_size:new r.Uniform2f(d),u_pixel_coord_upper:new r.Uniform2f(d),u_pixel_coord_lower:new r.Uniform2f(d),u_tile_units_to_pixels:new r.Uniform1f(d)}),terrainRaster:wc,terrainDepth:wc,skybox:d=>({u_matrix:new r.UniformMatrix4f(d),u_sun_direction:new r.Uniform3f(d),u_cubemap:new r.Uniform1i(d),u_opacity:new r.Uniform1f(d),u_temporal_offset:new r.Uniform1f(d)}),skyboxGradient:d=>({u_matrix:new r.UniformMatrix4f(d),u_color_ramp:new r.Uniform1i(d),u_center_direction:new r.Uniform3f(d),u_radius:new r.Uniform1f(d),u_opacity:new r.Uniform1f(d),u_temporal_offset:new r.Uniform1f(d)}),skyboxCapture:d=>({u_matrix_3f:new r.UniformMatrix3f(d),u_sun_direction:new r.Uniform3f(d),u_sun_intensity:new r.Uniform1f(d),u_color_tint_r:new r.Uniform4f(d),u_color_tint_m:new r.Uniform4f(d),u_luminance:new r.Uniform1f(d)}),globeRaster:d=>({u_proj_matrix:new r.UniformMatrix4f(d),u_globe_matrix:new r.UniformMatrix4f(d),u_normalize_matrix:new r.UniformMatrix4f(d),u_merc_matrix:new r.UniformMatrix4f(d),u_zoom_transition:new r.Uniform1f(d),u_merc_center:new r.Uniform2f(d),u_image0:new r.Uniform1i(d),u_grid_matrix:new r.UniformMatrix3f(d),u_skirt_height:new r.Uniform1f(d),u_frustum_tl:new r.Uniform3f(d),u_frustum_tr:new r.Uniform3f(d),u_frustum_br:new r.Uniform3f(d),u_frustum_bl:new r.Uniform3f(d),u_globe_pos:new r.Uniform3f(d),u_globe_radius:new r.Uniform1f(d),u_viewport:new r.Uniform2f(d)}),globeAtmosphere:d=>({u_frustum_tl:new r.Uniform3f(d),u_frustum_tr:new r.Uniform3f(d),u_frustum_br:new r.Uniform3f(d),u_frustum_bl:new r.Uniform3f(d),u_horizon:new r.Uniform1f(d),u_transition:new r.Uniform1f(d),u_fadeout_range:new r.Uniform1f(d),u_color:new r.Uniform4f(d),u_high_color:new r.Uniform4f(d),u_space_color:new r.Uniform4f(d),u_star_intensity:new r.Uniform1f(d),u_star_density:new r.Uniform1f(d),u_star_size:new r.Uniform1f(d),u_temporal_offset:new r.Uniform1f(d),u_horizon_angle:new r.Uniform1f(d),u_rotation_matrix:new r.UniformMatrix4f(d)})};let ol;function ia(d,n,c,_,y,b,S){const M=d.context,P=M.gl,z=d.transform,L=d.useProgram("collisionBox"),N=[];let $=0,X=0;for(let st=0;st<_.length;st++){const ft=_[st],mt=n.getTile(ft),_t=mt.getBucket(c);if(!_t)continue;const vt=Un(ft,_t,z);let xt=vt;y[0]===0&&y[1]===0||(xt=d.translatePosMatrix(vt,mt,y,b));const At=S?_t.textCollisionBox:_t.iconCollisionBox,Zt=_t.collisionCircleArray;if(Zt.length>0){const Et=r.create(),jt=xt;r.mul(Et,_t.placementInvProjMatrix,z.glCoordMatrix),r.mul(Et,Et,_t.placementViewportMatrix),N.push({circleArray:Zt,circleOffset:X,transform:jt,invTransform:Et,projection:_t.getProjection()}),$+=Zt.length/4,X=$}At&&(d.terrain&&d.terrain.setupElevationDraw(mt,L),L.draw(M,P.LINES,r.DepthMode.disabled,r.StencilMode.disabled,d.colorModeForRenderPass(),r.CullFaceMode.disabled,Pc(xt,z,mt,_t.getProjection()),c.id,At.layoutVertexBuffer,At.indexBuffer,At.segments,null,z.zoom,null,[At.collisionVertexBuffer,At.collisionVertexBufferExt]))}if(!S||!N.length)return;const J=d.useProgram("collisionCircle"),K=new r.StructArrayLayout2f1f2i16;K.resize(4*$),K._trim();let Q=0;for(const st of N)for(let ft=0;ft<st.circleArray.length/4;ft++){const mt=4*ft,_t=st.circleArray[mt+0],vt=st.circleArray[mt+1],xt=st.circleArray[mt+2],At=st.circleArray[mt+3];K.emplace(Q++,_t,vt,xt,At,0),K.emplace(Q++,_t,vt,xt,At,1),K.emplace(Q++,_t,vt,xt,At,2),K.emplace(Q++,_t,vt,xt,At,3)}(!ol||ol.length<2*$)&&(ol=function(st){const ft=2*st,mt=new r.StructArrayLayout3ui6;mt.resize(ft),mt._trim();for(let _t=0;_t<ft;_t++){const vt=6*_t;mt.uint16[vt+0]=4*_t+0,mt.uint16[vt+1]=4*_t+1,mt.uint16[vt+2]=4*_t+2,mt.uint16[vt+3]=4*_t+2,mt.uint16[vt+4]=4*_t+3,mt.uint16[vt+5]=4*_t+0}return mt}($));const j=M.createIndexBuffer(ol,!0),H=M.createVertexBuffer(K,r.collisionCircleLayout.members,!0);for(const st of N){const ft={u_matrix:st.transform,u_inv_matrix:st.invTransform,u_camera_to_center_distance:(nt=z).getCameraToCenterDistance(st.projection),u_viewport_size:[nt.width,nt.height]};J.draw(M,P.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,d.colorModeForRenderPass(),r.CullFaceMode.disabled,ft,c.id,H,j,r.SegmentVector.simpleSegment(0,2*st.circleOffset,st.circleArray.length,st.circleArray.length/2),null,z.zoom)}var nt;H.destroy(),j.destroy()}const Iu=r.create();function Oc({width:d,height:n,anchor:c,textOffset:_,textScale:y},b){const{horizontalAlign:S,verticalAlign:M}=r.getAnchorAlignment(c),P=-(S-.5)*d,z=-(M-.5)*n,L=r.evaluateVariableOffset(c,_);return new r.Point((P/y+L[0])*b,(z/y+L[1])*b)}function qp(d,n,c,_,y,b,S,M,P,z,L){const N=d.text.placedSymbolArray,$=d.text.dynamicLayoutVertexArray,X=d.icon.dynamicLayoutVertexArray,J={},K=d.getProjection(),Q=bi(M,K,b),j=b.elevation,H=K.upVectorScale(M.canonical,b.center.lat,b.worldSize).metersToTile;$.clear();for(let nt=0;nt<N.length;nt++){const st=N.get(nt),{tileAnchorX:ft,tileAnchorY:mt,numGlyphs:_t}=st,vt=st.hidden||!st.crossTileID||d.allowVerticalPlacement&&!st.placedOrientation?null:_[st.crossTileID];if(vt){let xt=0,At=0,Zt=0;if(j){const Yt=j?j.getAtTileOffset(M,ft,mt):0,[me,we,de]=K.upVector(M.canonical,ft,mt);xt=Yt*me*H,At=Yt*we*H,Zt=Yt*de*H}let[Et,jt,It,$t]=tn(st.projectedAnchorX+xt,st.projectedAnchorY+At,st.projectedAnchorZ+Zt,c?Q:S);const Mt=_u(b.getCameraToCenterDistance(K),$t);let Nt=y.evaluateSizeForFeature(d.textSizeData,z,st)*Mt/r.ONE_EM;c&&(Nt*=d.tilePixelRatio/P);const Xt=Oc(vt,Nt);c?({x:Et,y:jt,z:It}=K.projectTilePoint(ft+Xt.x,mt+Xt.y,M.canonical),[Et,jt,It]=tn(Et+xt,jt+At,It+Zt,S)):(n&&Xt._rotate(-b.angle),Et+=Xt.x,jt+=Xt.y,It=0);const Gt=d.allowVerticalPlacement&&st.placedOrientation===r.WritingMode.vertical?Math.PI/2:0;for(let Yt=0;Yt<_t;Yt++)r.addDynamicAttributes($,Et,jt,It,Gt);L&&st.associatedIconIndex>=0&&(J[st.associatedIconIndex]={x:Et,y:jt,z:It,angle:Gt})}else ts(_t,$)}if(L){X.clear();const nt=d.icon.placedSymbolArray;for(let st=0;st<nt.length;st++){const ft=nt.get(st),{numGlyphs:mt}=ft,_t=J[st];if(ft.hidden||!_t)ts(mt,X);else{const{x:vt,y:xt,z:At,angle:Zt}=_t;for(let Et=0;Et<mt;Et++)r.addDynamicAttributes(X,vt,xt,At,Zt)}}d.icon.dynamicLayoutVertexBuffer.updateData(X)}d.text.dynamicLayoutVertexBuffer.updateData($)}function Bc(d,n,c){return c.iconsInText&&n?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function Pu(d,n,c,_,y,b,S,M,P,z,L,N){const $=d.context,X=$.gl,J=d.transform,K=M==="map",Q=P==="map",j=K&&c.layout.get("symbol-placement")!=="point",H=K&&!Q&&!j,nt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let st=!1;const ft=d.depthModeForSublayer(0,r.DepthMode.ReadOnly),mt=[r.mercatorXfromLng(J.center.lng),r.mercatorYfromLat(J.center.lat)],_t=c.layout.get("text-variable-anchor"),vt=J.projection.name==="globe",xt=[],At=[0,-1,0];let Zt=At;!vt&&!J.mercatorFromTransition||K||(Zt=function(Et){const jt=Et._camera.getWorldToCamera(Et.worldSize,1),It=r.multiply([],jt,Et.globeMatrix);r.invert(It,It);const $t=[0,0,0],Mt=[0,1,0,0];return r.transformMat4$1(Mt,Mt,It),$t[0]=Mt[0],$t[1]=Mt[1],$t[2]=Mt[2],r.normalize($t,$t),$t}(J));for(const Et of _){const jt=n.getTile(Et),It=jt.getBucket(c);if(!It||It.projection.name==="mercator"&&vt)continue;const $t=y?It.text:It.icon;if(!$t||It.fullyClipped||!$t.segments.get().length)continue;const Mt=$t.programConfigurations.get(c.id),Nt=y||It.sdfIcons,Xt=y?It.textSizeData:It.iconSizeData,Gt=Q||J.pitch!==0,Yt=r.evaluateSizeForZoom(Xt,J.zoom);let me,we,de,xe,Be=[0,0],De=null;if(y)we=jt.glyphAtlasTexture,de=X.LINEAR,me=jt.glyphAtlasTexture.size,It.iconsInText&&(Be=jt.imageAtlasTexture.size,De=jt.imageAtlasTexture,xe=Gt||d.options.rotating||d.options.zooming||Xt.kind==="composite"||Xt.kind==="camera"?X.LINEAR:X.NEAREST);else{const zs=c.layout.get("icon-size").constantOr(0)!==1||It.iconsNeedLinear;we=jt.imageAtlasTexture,de=Nt||d.options.rotating||d.options.zooming||zs||Gt?X.LINEAR:X.NEAREST,me=jt.imageAtlasTexture.size}const _e=It.projection.name==="globe",Je=_e?Zt:At,ii=_e?r.globeToMercatorTransition(J.zoom):0,ni=bi(Et,It.getProjection(),J),si=J.calculatePixelsToTileUnitsMatrix(jt),pn=Ot(ni,jt.tileID.canonical,Q,K,J,It.getProjection(),si),nn=d.terrain&&Q&&j?r.invert(r.create(),pn):Iu,Wn=ji(ni,jt.tileID.canonical,Q,K,J,It.getProjection(),si),_s=_t&&It.hasTextData(),wi=c.layout.get("icon-text-fit")!=="none"&&_s&&It.hasIconData();if(j){const zs=J.elevation,Qs=zs?zs.getAtTileOffsetFunc(Et,J.center.lat,J.worldSize,It.getProjection()):null,Mr=Ms(ni,jt.tileID.canonical,Q,K,J,It.getProjection(),si);cc(It,ni,d,y,Mr,Wn,Q,z,Qs,Et)}const ri=j||y&&_t||wi,We=d.translatePosMatrix(ni,jt,b,S),Vi=ri?Iu:pn,xn=d.translatePosMatrix(Wn,jt,b,S,!0),mi=It.getProjection().createInversionMatrix(J,Et.canonical),En=[];d.terrainRenderModeElevated()&&Q&&En.push("PITCH_WITH_MAP_TERRAIN"),_e&&En.push("PROJECTION_GLOBE_VIEW"),ri&&En.push("PROJECTED_POS_ON_VIEWPORT");const wl=Nt&&c.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Sr;Sr=Nt?It.iconsInText?Cu(Xt.kind,Yt,H,Q,d,We,Vi,xn,me,Be,Et,ii,mt,mi,Je,It.getProjection()):rl(Xt.kind,Yt,H,Q,d,We,Vi,xn,y,me,!0,Et,ii,mt,mi,Je,It.getProjection()):Lc(Xt.kind,Yt,H,Q,d,We,Vi,xn,y,me,Et,ii,mt,mi,Je,It.getProjection());const pa={program:d.useProgram(Bc(Nt,y,It),Mt,En),buffers:$t,uniformValues:Sr,atlasTexture:we,atlasTextureIcon:De,atlasInterpolation:de,atlasInterpolationIcon:xe,isSDF:Nt,hasHalo:wl,tile:jt,labelPlaneMatrixInv:nn};if(nt&&It.canOverlap){st=!0;const zs=$t.segments.get();for(const Qs of zs)xt.push({segments:new r.SegmentVector([Qs]),sortKey:Qs.sortKey,state:pa})}else xt.push({segments:$t.segments,sortKey:0,state:pa})}st&&xt.sort((Et,jt)=>Et.sortKey-jt.sortKey);for(const Et of xt){const jt=Et.state;if(d.terrain&&d.terrain.setupElevationDraw(jt.tile,jt.program,{useDepthForOcclusion:!vt,labelPlaneMatrixInv:jt.labelPlaneMatrixInv}),$.activeTexture.set(X.TEXTURE0),jt.atlasTexture.bind(jt.atlasInterpolation,X.CLAMP_TO_EDGE),jt.atlasTextureIcon&&($.activeTexture.set(X.TEXTURE1),jt.atlasTextureIcon&&jt.atlasTextureIcon.bind(jt.atlasInterpolationIcon,X.CLAMP_TO_EDGE)),jt.isSDF){const It=jt.uniformValues;jt.hasHalo&&(It.u_is_halo=1,na(jt.buffers,Et.segments,c,d,jt.program,ft,L,N,It)),It.u_is_halo=0}na(jt.buffers,Et.segments,c,d,jt.program,ft,L,N,jt.uniformValues)}}function na(d,n,c,_,y,b,S,M,P){const z=_.context,L=[d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer,d.globeExtVertexBuffer];y.draw(z,z.gl.TRIANGLES,b,S,M,r.CullFaceMode.disabled,P,c.id,d.layoutVertexBuffer,d.indexBuffer,n,c.paint,_.transform.zoom,d.programConfigurations.get(c.id),L)}function ku(d,n,c,_,y,b,S){const M=d.context.gl,P=c.paint.get("fill-pattern"),z=P&&P.constantOr(1);let L,N,$,X,J;S?(N=z&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",L=M.LINES):(N=z?"fillPattern":"fill",L=M.TRIANGLES);for(const K of _){const Q=n.getTile(K);if(z&&!Q.patternsLoaded())continue;const j=Q.getBucket(c);if(!j)continue;d.prepareDrawTile();const H=j.programConfigurations.get(c.id),nt=d.useProgram(N,H);z&&(d.context.activeTexture.set(M.TEXTURE0),Q.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),H.updatePaintBuffers());const st=P.constantOr(null);if(st&&Q.imageAtlas){const mt=Q.imageAtlas.patternPositions[st.toString()];mt&&H.setConstantPatternPositions(mt)}const ft=d.translatePosMatrix(K.projMatrix,Q,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(S){X=j.indexBuffer2,J=j.segments2;const mt=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[M.drawingBufferWidth,M.drawingBufferHeight];$=N==="fillOutlinePattern"&&z?jp(ft,d,Q,mt):Np(ft,mt)}else X=j.indexBuffer,J=j.segments,$=z?Ac(ft,d,Q):br(ft);d.prepareDrawProgram(d.context,nt,K.toUnwrapped()),nt.draw(d.context,L,y,d.stencilModeForClipping(K),b,r.CullFaceMode.disabled,$,c.id,j.layoutVertexBuffer,X,J,c.paint,d.transform.zoom,H)}}function al(d,n,c,_,y,b,S){const M=d.context,P=M.gl,z=d.transform,L=c.paint.get("fill-extrusion-pattern"),N=L.constantOr(1),$=c.paint.get("fill-extrusion-opacity"),X=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],J=c.layout.get("fill-extrusion-edge-radius"),K=J>0&&!c.paint.get("fill-extrusion-rounded-roof"),Q=K?0:J,j=z.projection.name==="globe"?r.fillExtrusionHeightLift():0,H=z.projection.name==="globe",nt=H?r.globeToMercatorTransition(z.zoom):0,st=[r.mercatorXfromLng(z.center.lng),r.mercatorYfromLat(z.center.lat)],ft=[];H&&ft.push("PROJECTION_GLOBE_VIEW"),X[0]>0&&ft.push("FAUX_AO"),K&&ft.push("ZERO_ROOF_RADIUS");for(const mt of _){const _t=n.getTile(mt),vt=_t.getBucket(c);if(!vt||vt.projection.name!==z.projection.name)continue;const xt=vt.programConfigurations.get(c.id),At=d.useProgram(N?"fillExtrusionPattern":"fillExtrusion",xt,ft);if(d.terrain){const Nt=d.terrain;if(d.style.terrainSetForDrapingOnly())Nt.setupElevationDraw(_t,At,{useMeterToDem:!0});else{if(!vt.enableTerrain)continue;if(Nt.setupElevationDraw(_t,At,{useMeterToDem:!0}),Du(M,n,mt,vt,c,Nt),!vt.centroidVertexBuffer){const Xt=At.attributes.a_centroid_pos;Xt!==void 0&&P.vertexAttrib2f(Xt,0,0)}}}N&&(d.context.activeTexture.set(P.TEXTURE0),_t.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),xt.updatePaintBuffers());const Zt=L.constantOr(null);if(Zt&&_t.imageAtlas){const Nt=_t.imageAtlas.patternPositions[Zt.toString()];Nt&&xt.setConstantPatternPositions(Nt)}const Et=d.translatePosMatrix(mt.projMatrix,_t,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),jt=z.projection.createInversionMatrix(z,mt.canonical),It=c.paint.get("fill-extrusion-vertical-gradient"),$t=N?Su(Et,d,It,$,X,Q,mt,_t,j,nt,st,jt):Mc(Et,d,It,$,X,Q,mt,j,nt,st,jt);d.prepareDrawProgram(M,At,mt.toUnwrapped());const Mt=[];d.terrain&&Mt.push(vt.centroidVertexBuffer),H&&Mt.push(vt.layoutVertexExtBuffer),At.draw(M,M.gl.TRIANGLES,y,b,S,r.CullFaceMode.backCCW,$t,c.id,vt.layoutVertexBuffer,vt.indexBuffer,vt.segments,c.paint,d.transform.zoom,xt,Mt)}}function Du(d,n,c,_,y,b){const S=[j=>{let H=j.canonical.x-1,nt=j.wrap;return H<0&&(H=(1<<j.canonical.z)-1,nt--),new r.OverscaledTileID(j.overscaledZ,nt,j.canonical.z,H,j.canonical.y)},j=>{let H=j.canonical.x+1,nt=j.wrap;return H===1<<j.canonical.z&&(H=0,nt++),new r.OverscaledTileID(j.overscaledZ,nt,j.canonical.z,H,j.canonical.y)},j=>new r.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,(j.canonical.y===0?1<<j.canonical.z:j.canonical.y)-1),j=>new r.OverscaledTileID(j.overscaledZ,j.wrap,j.canonical.z,j.canonical.x,j.canonical.y===(1<<j.canonical.z)-1?0:j.canonical.y+1)],M=j=>{const H=n.getSource().minzoom,nt=ft=>{const mt=n.getTileByID(ft);if(mt&&mt.hasData())return mt.getBucket(y)},st=[0,-1,1];for(const ft of st){if(j.overscaledZ+ft<H)continue;const mt=nt(j.calculateScaledKey(j.overscaledZ+ft));if(mt)return mt}},P=[0,0,0],z=(j,H)=>(P[0]=Math.min(j.min.y,H.min.y),P[1]=Math.max(j.max.y,H.max.y),P[2]=r.EXTENT-H.min.x>j.max.x?H.min.x-r.EXTENT:j.max.x,P),L=(j,H)=>(P[0]=Math.min(j.min.x,H.min.x),P[1]=Math.max(j.max.x,H.max.x),P[2]=r.EXTENT-H.min.y>j.max.y?H.min.y-r.EXTENT:j.max.y,P),N=[(j,H)=>z(j,H),(j,H)=>z(H,j),(j,H)=>L(j,H),(j,H)=>L(H,j)],$=new r.Point(0,0);let X,J,K;const Q=(j,H,nt,st,ft)=>{const mt=[[st?nt:j,st?j:nt,0],[st?nt:H,st?H:nt,0]],_t=ft<0?r.EXTENT+ft:ft,vt=[st?_t:(j+H)/2,st?(j+H)/2:_t,0];return nt===0&&ft<0||nt!==0&&ft>0?b.getForTilePoints(K,[vt],!0,J):mt.push(vt),b.getForTilePoints(c,mt,!0,X),Math.max(mt[0][2],mt[1][2],vt[2])/b.exaggeration()};for(let j=0;j<4;j++){const H=(j<2?1:5)-j,nt=_.borders[j];if(nt.length===0)continue;const st=K=S[j](c),ft=M(st);if(!(ft&&ft instanceof r.FillExtrusionBucket&&ft.enableTerrain)||_.borderDoneWithNeighborZ[j]===ft.canonical.z&&ft.borderDoneWithNeighborZ[H]===_.canonical.z||(J=b.findDEMTileFor(st),!J||!J.dem))continue;if(!X){const xt=b.findDEMTileFor(c);if(!xt||!xt.dem)return;X=xt}const mt=ft.borders[H];let _t=0;const vt=ft.borderDoneWithNeighborZ[H]!==_.canonical.z;if(_.canonical.z===ft.canonical.z){for(let xt=0;xt<nt.length;xt++){const At=_.featuresOnBorder[nt[xt]],Zt=At.borders[j];let Et;for(;_t<mt.length&&(Et=ft.featuresOnBorder[mt[_t]],!(Et.borders[H][1]>Zt[0]+3));)vt&&ft.encodeCentroid(void 0,Et,!1),_t++;if(Et&&_t<mt.length){const jt=_t;let It=0;for(;!(Et.borders[H][0]>Zt[1]-3)&&(It++,++_t!==mt.length);)Et=ft.featuresOnBorder[mt[_t]];if(Et=ft.featuresOnBorder[mt[jt]],At.intersectsCount()>1||Et.intersectsCount()>1||It!==1){It!==1&&(_t=jt),_.encodeCentroid(void 0,At,!1),vt&&ft.encodeCentroid(void 0,Et,!1);continue}const $t=N[j](At,Et),Mt=j%2?r.EXTENT-1:0;$.x=Q($t[0],Math.min(r.EXTENT-1,$t[1]),Mt,j<2,$t[2]),$.y=0,_.encodeCentroid($,At,!1),vt&&ft.encodeCentroid($,Et,!1)}else _.encodeCentroid(void 0,At,!1)}_.borderDoneWithNeighborZ[j]=ft.canonical.z,_.needsCentroidUpdate=!0,vt&&(ft.borderDoneWithNeighborZ[H]=_.canonical.z,ft.needsCentroidUpdate=!0)}else{for(const xt of nt)_.encodeCentroid(void 0,_.featuresOnBorder[xt],!1);if(vt){for(const xt of mt)ft.encodeCentroid(void 0,ft.featuresOnBorder[xt],!1);ft.borderDoneWithNeighborZ[H]=_.canonical.z,ft.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[j]=ft.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&_.centroidVertexArray.length!==0)&&_.uploadCentroid(d)}const io=new r.Color(1,0,0,1),$p=new r.Color(0,1,0,1),Wp=new r.Color(0,0,1,1),Zp=new r.Color(1,0,1,1),Hp=new r.Color(0,1,1,1);function Xp(d,n,c){const _=d.context,y=d.transform,b=_.gl,S=y.projection.name==="globe",M=S?["PROJECTION_GLOBE_VIEW"]:null;let P=c.projMatrix;if(S&&r.globeToMercatorTransition(y.zoom)>0){const At=r.transitionTileAABBinECEF(c.canonical,y),Zt=r.globeDenormalizeECEF(At);P=r.multiply(new Float32Array(16),y.globeMatrix,Zt),r.multiply(P,y.projMatrix,P)}const z=d.useProgram("debug",null,M),L=n.getTileByID(c.key);d.terrain&&d.terrain.setupElevationDraw(L,z);const N=r.DepthMode.disabled,$=r.StencilMode.disabled,X=d.colorModeForRenderPass(),J="$debug";_.activeTexture.set(b.TEXTURE0),d.emptyTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),S?L._makeGlobeTileDebugBuffers(d.context,y):L._makeDebugTileBoundsBuffers(d.context,y.projection);const K=L._tileDebugBuffer||d.debugBuffer,Q=L._tileDebugIndexBuffer||d.debugIndexBuffer,j=L._tileDebugSegments||d.debugSegments;z.draw(_,b.LINE_STRIP,N,$,X,r.CullFaceMode.disabled,nl(P,r.Color.red),J,K,Q,j,null,null,null,[L._globeTileDebugBorderBuffer]);const H=L.latestRawTileData,nt=Math.floor((H&&H.byteLength||0)/1024),st=n.getTile(c).tileSize,ft=512/Math.min(st,512)*(c.overscaledZ/y.zoom)*.5;let mt=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(mt+=` => ${c.overscaledZ}`),mt+=` ${nt}kb`,function(At,Zt){At.initDebugOverlayCanvas();const Et=At.debugOverlayCanvas,jt=At.context.gl,It=At.debugOverlayCanvas.getContext("2d");It.clearRect(0,0,Et.width,Et.height),It.shadowColor="white",It.shadowBlur=2,It.lineWidth=1.5,It.strokeStyle="white",It.textBaseline="top",It.font="bold 36px Open Sans, sans-serif",It.fillText(Zt,5,5),It.strokeText(Zt,5,5),At.debugOverlayTexture.update(Et),At.debugOverlayTexture.bind(jt.LINEAR,jt.CLAMP_TO_EDGE)}(d,mt);const _t=L._tileDebugTextBuffer||d.debugBuffer,vt=L._tileDebugTextIndexBuffer||d.quadTriangleIndexBuffer,xt=L._tileDebugTextSegments||d.debugSegments;z.draw(_,b.TRIANGLES,N,$,r.ColorMode.alphaBlended,r.CullFaceMode.disabled,nl(P,r.Color.transparent,ft),J,_t,vt,xt,null,null,null,[L._globeTileDebugTextBuffer])}function Lu(d,n,c,_){no(d,0,n+c/2,d.transform.width,c,_)}function ll(d,n,c,_){no(d,n-c/2,0,c,d.transform.height,_)}function no(d,n,c,_,y,b){const S=d.context,M=S.gl;M.enable(M.SCISSOR_TEST),M.scissor(n*r.exported.devicePixelRatio,c*r.exported.devicePixelRatio,_*r.exported.devicePixelRatio,y*r.exported.devicePixelRatio),S.clear({color:b}),M.disable(M.SCISSOR_TEST)}const zu=r.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ru}=zu;function Ds(d,n,c,_){d.emplaceBack(n,c,_)}class cl{constructor(n){this.vertexArray=new r.StructArrayLayout3f12,this.indices=new r.StructArrayLayout3ui6,Ds(this.vertexArray,-1,-1,1),Ds(this.vertexArray,1,-1,1),Ds(this.vertexArray,-1,1,1),Ds(this.vertexArray,1,1,1),Ds(this.vertexArray,-1,-1,-1),Ds(this.vertexArray,1,-1,-1),Ds(this.vertexArray,-1,1,-1),Ds(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Ru),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=r.SegmentVector.simpleSegment(0,0,36,12)}}function qn(d,n,c,_,y,b){const S=d.gl,M=n.paint.get("sky-atmosphere-color"),P=n.paint.get("sky-atmosphere-halo-color"),z=n.paint.get("sky-atmosphere-sun-intensity"),L=((N,$,X,J,K)=>({u_matrix_3f:N,u_sun_direction:$,u_sun_intensity:X,u_color_tint_r:[J.r,J.g,J.b,J.a],u_color_tint_m:[K.r,K.g,K.b,K.a],u_luminance:5e-5}))(r.fromMat4(r.create$1(),_),y,z,M,P);S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+b,n.skyboxTexture,0),c.draw(d,S.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.frontCW,L,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}const sa=r.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ou{constructor(n){const c=new r.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const _=new r.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=n.createVertexBuffer(c,sa.members),this.indexBuffer=n.createIndexBuffer(_),this.segments=r.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const wr={symbol:function(d,n,c,_,y){if(d.renderPass!=="translucent")return;const b=r.StencilMode.disabled,S=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(M,P,z,L,N,$,X){const J=P.transform,K=N==="map",Q=$==="map";for(const j of M){const H=L.getTile(j),nt=H.getBucket(z);if(!nt||!nt.text||!nt.text.segments.get().length)continue;const st=r.evaluateSizeForZoom(nt.textSizeData,J.zoom),ft=bi(j,nt.getProjection(),J),mt=J.calculatePixelsToTileUnitsMatrix(H),_t=Ot(ft,H.tileID.canonical,Q,K,J,nt.getProjection(),mt),vt=z.layout.get("icon-text-fit")!=="none"&&nt.hasIconData();if(st){const xt=Math.pow(2,J.zoom-H.tileID.overscaledZ);qp(nt,K,Q,X,r.symbolSize,J,_t,j,xt,st,vt)}}}(_,d,c,n,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y),c.paint.get("icon-opacity").constantOr(1)!==0&&Pu(d,n,c,_,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),b,S),c.paint.get("text-opacity").constantOr(1)!==0&&Pu(d,n,c,_,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),b,S),n.map.showCollisionBoxes&&(ia(d,n,c,_,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),ia(d,n,c,_,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,n,c,_){if(d.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),b=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),M=c.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)===0&&(b.constantOr(1)===0||S.constantOr(1)===0))return;const P=d.context,z=P.gl,L=d.transform,N=d.depthModeForSublayer(0,r.DepthMode.ReadOnly),$=r.StencilMode.disabled,X=d.colorModeForRenderPass(),J=L.projection.name==="globe",K=[r.mercatorXfromLng(L.center.lng),r.mercatorYfromLat(L.center.lat)],Q=[];for(let H=0;H<_.length;H++){const nt=_[H],st=n.getTile(nt),ft=st.getBucket(c);if(!ft||ft.projection.name!==L.projection.name)continue;const mt=ft.programConfigurations.get(c.id),_t=Ic(c);J&&_t.push("PROJECTION_GLOBE_VIEW");const vt=d.useProgram("circle",mt,_t),xt=ft.layoutVertexBuffer,At=ft.globeExtVertexBuffer,Zt=ft.indexBuffer,Et=L.projection.createInversionMatrix(L,nt.canonical),jt={programConfiguration:mt,program:vt,layoutVertexBuffer:xt,globeExtVertexBuffer:At,indexBuffer:Zt,uniformValues:Cc(d,nt,st,Et,K,c),tile:st};if(M){const It=ft.segments.get();for(const $t of It)Q.push({segments:new r.SegmentVector([$t]),sortKey:$t.sortKey,state:jt})}else Q.push({segments:ft.segments,sortKey:0,state:jt})}M&&Q.sort((H,nt)=>H.sortKey-nt.sortKey);const j={useDepthForOcclusion:!J};for(const H of Q){const{programConfiguration:nt,program:st,layoutVertexBuffer:ft,globeExtVertexBuffer:mt,indexBuffer:_t,uniformValues:vt,tile:xt}=H.state,At=H.segments;d.terrain&&d.terrain.setupElevationDraw(xt,st,j),d.prepareDrawProgram(P,st,xt.tileID.toUnwrapped()),st.draw(P,z.TRIANGLES,N,$,X,r.CullFaceMode.disabled,vt,c.id,ft,_t,At,c.paint,L.zoom,nt,[mt])}},heatmap:function(d,n,c,_){if(c.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const y=d.context,b=y.gl,S=r.StencilMode.disabled,M=new r.ColorMode([b.ONE,b.ONE],r.Color.transparent,[!0,!0,!0,!0]);(function(X,J,K,Q){const j=X.gl,H=J.width*Q,nt=J.height*Q;X.activeTexture.set(j.TEXTURE1),X.viewport.set([0,0,H,nt]);let st=K.heatmapFbo;if(!st||st&&(st.width!==H||st.height!==nt)){st&&st.destroy();const ft=j.createTexture();j.bindTexture(j.TEXTURE_2D,ft),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR),st=K.heatmapFbo=X.createFramebuffer(H,nt,!1),function(mt,_t,vt,xt,At,Zt){const Et=mt.gl;Et.texImage2D(Et.TEXTURE_2D,0,mt.isWebGL2&&mt.extRenderToTextureHalfFloat?Et.RGBA16F:Et.RGBA,At,Zt,0,Et.RGBA,mt.extRenderToTextureHalfFloat?mt.isWebGL2?Et.HALF_FLOAT:mt.extTextureHalfFloat.HALF_FLOAT_OES:Et.UNSIGNED_BYTE,null),xt.colorAttachment.set(vt)}(X,0,ft,st,H,nt)}else j.bindTexture(j.TEXTURE_2D,st.colorAttachment.get()),X.bindFramebuffer.set(st.framebuffer)})(y,d,c,d.transform.projection.name==="globe"?.5:.25),y.clear({color:r.Color.transparent});const P=d.transform,z=P.projection.name==="globe",L=z?["PROJECTION_GLOBE_VIEW"]:null,N=z?r.CullFaceMode.frontCCW:r.CullFaceMode.disabled,$=[r.mercatorXfromLng(P.center.lng),r.mercatorYfromLat(P.center.lat)];for(let X=0;X<_.length;X++){const J=_[X];if(n.hasRenderableParent(J))continue;const K=n.getTile(J),Q=K.getBucket(c);if(!Q||Q.projection.name!==P.projection.name)continue;const j=Q.programConfigurations.get(c.id),H=d.useProgram("heatmap",j,L),{zoom:nt}=d.transform;d.terrain&&d.terrain.setupElevationDraw(K,H),d.prepareDrawProgram(y,H,J.toUnwrapped());const st=P.projection.createInversionMatrix(P,J.canonical);H.draw(y,b.TRIANGLES,r.DepthMode.disabled,S,M,N,Au(d,J,K,st,$,nt,c.paint.get("heatmap-intensity")),c.id,Q.layoutVertexBuffer,Q.indexBuffer,Q.segments,c.paint,d.transform.zoom,j,z?[Q.globeExtVertexBuffer]:null)}y.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(y,b){const S=y.context,M=S.gl,P=b.heatmapFbo;if(!P)return;S.activeTexture.set(M.TEXTURE0),M.bindTexture(M.TEXTURE_2D,P.colorAttachment.get()),S.activeTexture.set(M.TEXTURE1);let z=b.colorRampTexture;z||(z=b.colorRampTexture=new r.Texture(S,b.colorRamp,M.RGBA)),z.bind(M.LINEAR,M.CLAMP_TO_EDGE),y.useProgram("heatmapTexture").draw(S,M.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,y.colorModeForRenderPass(),r.CullFaceMode.disabled,((L,N,$,X)=>({u_image:0,u_color_ramp:1,u_opacity:N.paint.get("heatmap-opacity")}))(0,b),b.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,b.paint,y.transform.zoom)}(d,c))},line:function(d,n,c,_){if(d.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),b=c.paint.get("line-width");if(y.constantOr(1)===0||b.constantOr(1)===0)return;const S=d.depthModeForSublayer(0,r.DepthMode.ReadOnly),M=d.colorModeForRenderPass(),P=d.terrain&&d.terrain.renderingToTexture?1:r.exported.devicePixelRatio,z=c.paint.get("line-dasharray"),L=z.constantOr(1),N=c.layout.get("line-cap"),$=c.paint.get("line-pattern"),X=$.constantOr(1),J=c.paint.get("line-gradient"),K=X?"linePattern":"line",Q=d.context,j=Q.gl,H=(st=>{const ft=[];ea(st)&&ft.push("RENDER_LINE_DASH"),st.paint.get("line-gradient")&&ft.push("RENDER_LINE_GRADIENT");const mt=st.paint.get("line-trim-offset");mt[0]===0&&mt[1]===0||ft.push("RENDER_LINE_TRIM_OFFSET");const _t=st.paint.get("line-pattern").constantOr(1),vt=st.paint.get("line-opacity").constantOr(1)!==1;return!_t&&vt&&ft.push("RENDER_LINE_ALPHA_DISCARD"),ft})(c);let nt=H.includes("RENDER_LINE_ALPHA_DISCARD");d.terrain&&d.terrain.clipOrMaskOverlapStencilType()&&(nt=!1);for(const st of _){const ft=n.getTile(st);if(X&&!ft.patternsLoaded())continue;const mt=ft.getBucket(c);if(!mt)continue;d.prepareDrawTile();const _t=mt.programConfigurations.get(c.id),vt=d.useProgram(K,_t,H),xt=$.constantOr(null);if(xt&&ft.imageAtlas){const Nt=ft.imageAtlas.patternPositions[xt.toString()];Nt&&_t.setConstantPatternPositions(Nt)}const At=z.constantOr(null),Zt=N.constantOr(null);if(!X&&At&&Zt&&ft.lineAtlas){const Nt=ft.lineAtlas.getDash(At,Zt);Nt&&_t.setConstantPatternPositions(Nt)}let[Et,jt]=c.paint.get("line-trim-offset");(Zt==="round"||Zt==="square")&&Et!==jt&&(Et===0&&(Et-=1),jt===1&&(jt+=1));const It=d.terrain?st.projMatrix:null,$t=X?ta(d,ft,c,It,P):Up(d,ft,c,It,mt.lineClipsArray.length,P,[Et,jt]);if(J){const Nt=mt.gradients[c.id];let Xt=Nt.texture;if(c.gradientVersion!==Nt.version){let Gt=256;if(c.stepInterpolant){const Yt=n.getSource().maxzoom,me=st.canonical.z===Yt?Math.ceil(1<<d.transform.maxZoom-st.canonical.z):1;Gt=r.clamp(r.nextPowerOfTwo(mt.maxLineLength/r.EXTENT*1024*me),256,Q.maxTextureSize)}Nt.gradient=r.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Gt,image:Nt.gradient||void 0,clips:mt.lineClipsArray}),Nt.texture?Nt.texture.update(Nt.gradient):Nt.texture=new r.Texture(Q,Nt.gradient,j.RGBA),Nt.version=c.gradientVersion,Xt=Nt.texture}Q.activeTexture.set(j.TEXTURE1),Xt.bind(c.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}L&&(Q.activeTexture.set(j.TEXTURE0),ft.lineAtlasTexture.bind(j.LINEAR,j.REPEAT),_t.updatePaintBuffers()),X&&(Q.activeTexture.set(j.TEXTURE0),ft.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),_t.updatePaintBuffers()),d.prepareDrawProgram(Q,vt,st.toUnwrapped());const Mt=Nt=>{vt.draw(Q,j.TRIANGLES,S,Nt,M,r.CullFaceMode.disabled,$t,c.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,c.paint,d.transform.zoom,_t,[mt.layoutVertexBuffer2])};if(nt){const Nt=d.stencilModeForClipping(st).ref;Nt===0&&d.terrain&&Q.clear({stencil:0});const Xt={func:j.EQUAL,mask:255};$t.u_alpha_discard_threshold=.8,Mt(new r.StencilMode(Xt,Nt,255,j.KEEP,j.KEEP,j.INVERT)),$t.u_alpha_discard_threshold=0,Mt(new r.StencilMode(Xt,Nt,255,j.KEEP,j.KEEP,j.KEEP))}else Mt(d.stencilModeForClipping(st))}nt&&(d.resetStencilClippingMasks(),d.terrain&&Q.clear({stencil:0}))},fill:function(d,n,c,_){const y=c.paint.get("fill-color"),b=c.paint.get("fill-opacity");if(b.constantOr(1)===0)return;const S=d.colorModeForRenderPass(),M=c.paint.get("fill-pattern"),P=d.opaquePassEnabledForLayer()&&!M.constantOr(1)&&y.constantOr(r.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===P){const z=d.depthModeForSublayer(1,d.renderPass==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly);ku(d,n,c,_,z,S,!1)}if(d.renderPass==="translucent"&&c.paint.get("fill-antialias")){const z=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,r.DepthMode.ReadOnly);ku(d,n,c,_,z,S,!0)}},"fill-extrusion":function(d,n,c,_){const y=c.paint.get("fill-extrusion-opacity");if(y!==0&&d.renderPass==="translucent"){const b=new r.DepthMode(d.context.gl.LEQUAL,r.DepthMode.ReadWrite,d.depthRangeFor3D);if(y!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))al(d,n,c,_,b,r.StencilMode.disabled,r.ColorMode.disabled),al(d,n,c,_,b,d.stencilModeFor3D(),d.colorModeForRenderPass()),d.resetStencilClippingMasks();else{const S=d.colorModeForRenderPass();al(d,n,c,_,b,r.StencilMode.disabled,S)}}},hillshade:function(d,n,c,_){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const y=d.context,b=d.depthModeForSublayer(0,r.DepthMode.ReadOnly),S=d.colorModeForRenderPass(),M=d.terrain&&d.terrain.renderingToTexture,[P,z]=d.renderPass!=="translucent"||M?[{},_]:d.stencilConfigForOverlap(_);for(const L of z){const N=n.getTile(L);if(N.needsHillshadePrepare&&d.renderPass==="offscreen")wu(d,N,c,b,r.StencilMode.disabled,S);else if(d.renderPass==="translucent"){const $=M&&d.terrain?d.terrain.stencilModeForRTTOverlap(L):P[L.overscaledZ];bu(d,L,N,c,b,$,S)}}y.viewport.set([0,0,d.width,d.height]),d.resetStencilClippingMasks()},raster:function(d,n,c,_,y,b){if(d.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!_.length)return;const S=d.context,M=S.gl,P=n.getSource(),z=d.useProgram("raster"),L=d.colorModeForRenderPass(),N=d.terrain&&d.terrain.renderingToTexture,[$,X]=P instanceof Pe||N?[{},_]:d.stencilConfigForOverlap(_),J=X[X.length-1].overscaledZ,K=!d.options.moving;for(const Q of X){const j=N?r.DepthMode.disabled:d.depthModeForSublayer(Q.overscaledZ-J,c.paint.get("raster-opacity")===1?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly,M.LESS),H=Q.toUnwrapped(),nt=n.getTile(Q);if(N&&(!nt||!nt.hasData()))continue;const st=N?Q.projMatrix:d.transform.calculateProjMatrix(H,K),ft=d.terrain&&N?d.terrain.stencilModeForRTTOverlap(Q):$[Q.overscaledZ],mt=b?0:c.paint.get("raster-fade-duration");nt.registerFadeDuration(mt);const _t=n.findLoadedParent(Q,0),vt=Tc(nt,_t,n,d.transform,mt);let xt,At;d.terrain&&d.terrain.prepareDrawTile();const Zt=c.paint.get("raster-resampling")==="nearest"?M.NEAREST:M.LINEAR;S.activeTexture.set(M.TEXTURE0),nt.texture.bind(Zt,M.CLAMP_TO_EDGE),S.activeTexture.set(M.TEXTURE1),_t?(_t.texture.bind(Zt,M.CLAMP_TO_EDGE),xt=Math.pow(2,_t.tileID.overscaledZ-nt.tileID.overscaledZ),At=[nt.tileID.canonical.x*xt%1,nt.tileID.canonical.y*xt%1]):nt.texture.bind(Zt,M.CLAMP_TO_EDGE),nt.texture.useMipmap&&S.extTextureFilterAnisotropic&&d.transform.pitch>20&&M.texParameterf(M.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax);const Et=Dc(st,At||[0,0],xt||1,vt,c,P instanceof Pe?P.perspectiveTransform:[0,0]);if(d.prepareDrawProgram(S,z,H),P instanceof Pe)P.boundsBuffer&&P.boundsSegments&&z.draw(S,M.TRIANGLES,j,r.StencilMode.disabled,L,r.CullFaceMode.disabled,Et,c.id,P.boundsBuffer,d.quadTriangleIndexBuffer,P.boundsSegments);else{const{tileBoundsBuffer:jt,tileBoundsIndexBuffer:It,tileBoundsSegments:$t}=d.getTileBoundsBuffers(nt);z.draw(S,M.TRIANGLES,j,ft,L,r.CullFaceMode.disabled,Et,c.id,jt,It,$t)}}d.resetStencilClippingMasks()},background:function(d,n,c,_){const y=c.paint.get("background-color"),b=c.paint.get("background-opacity");if(b===0)return;const S=d.context,M=S.gl,P=d.transform,z=P.tileSize,L=c.paint.get("background-pattern");if(d.isPatternMissing(L))return;const N=!L&&y.a===1&&b===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==N)return;const $=r.StencilMode.disabled,X=d.depthModeForSublayer(0,N==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly),J=d.colorModeForRenderPass(),K=d.useProgram(L?"backgroundPattern":"background");let Q,j=_;j||(Q=d.getBackgroundTiles(),j=Object.values(Q).map(H=>H.tileID)),L&&(S.activeTexture.set(M.TEXTURE0),d.imageManager.bind(d.context));for(const H of j){const nt=H.toUnwrapped(),st=_?H.projMatrix:d.transform.calculateProjMatrix(nt);d.prepareDrawTile();const ft=n?n.getTile(H):Q?Q[H.key]:new r.Tile(H,z,P.zoom,d),mt=L?Gp(st,b,d,L,{tileID:H,tileSize:z}):zc(st,b,y);d.prepareDrawProgram(S,K,nt);const{tileBoundsBuffer:_t,tileBoundsIndexBuffer:vt,tileBoundsSegments:xt}=d.getTileBoundsBuffers(ft);K.draw(S,M.TRIANGLES,X,$,J,r.CullFaceMode.disabled,mt,c.id,_t,vt,xt)}},sky:function(d,n,c){const _=d.transform,y=_.projection.name==="mercator"||_.projection.name==="globe"?1:r.smoothstep(7,8,_.zoom),b=c.paint.get("sky-opacity")*y;if(b===0)return;const S=d.context,M=c.paint.get("sky-type"),P=new r.DepthMode(S.gl.LEQUAL,r.DepthMode.ReadOnly,[0,1]),z=d.frameCounter/1e3%1;M==="atmosphere"?d.renderPass==="offscreen"?c.needsSkyboxCapture(d)&&(function(L,N,$,X){const J=L.context,K=J.gl;let Q=N.skyboxFbo;if(!Q){Q=N.skyboxFbo=J.createFramebuffer(32,32,!1),N.skyboxGeometry=new cl(J),N.skyboxTexture=J.gl.createTexture(),K.bindTexture(K.TEXTURE_CUBE_MAP,N.skyboxTexture),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_CUBE_MAP,K.TEXTURE_MAG_FILTER,K.LINEAR);for(let st=0;st<6;++st)K.texImage2D(K.TEXTURE_CUBE_MAP_POSITIVE_X+st,0,K.RGBA,32,32,0,K.RGBA,K.UNSIGNED_BYTE,null)}J.bindFramebuffer.set(Q.framebuffer),J.viewport.set([0,0,32,32]);const j=N.getCenter(L,!0),H=L.useProgram("skyboxCapture"),nt=new Float64Array(16);r.identity(nt),r.rotateY(nt,nt,.5*-Math.PI),qn(J,N,H,nt,j,0),r.identity(nt),r.rotateY(nt,nt,.5*Math.PI),qn(J,N,H,nt,j,1),r.identity(nt),r.rotateX(nt,nt,.5*-Math.PI),qn(J,N,H,nt,j,2),r.identity(nt),r.rotateX(nt,nt,.5*Math.PI),qn(J,N,H,nt,j,3),r.identity(nt),qn(J,N,H,nt,j,4),r.identity(nt),r.rotateY(nt,nt,Math.PI),qn(J,N,H,nt,j,5),J.viewport.set([0,0,L.width,L.height])}(d,c),c.markSkyboxValid(d)):d.renderPass==="sky"&&function(L,N,$,X,J){const K=L.context,Q=K.gl,j=L.transform,H=L.useProgram("skybox");K.activeTexture.set(Q.TEXTURE0),Q.bindTexture(Q.TEXTURE_CUBE_MAP,N.skyboxTexture);const nt=((st,ft,mt,_t,vt)=>({u_matrix:st,u_sun_direction:ft,u_cubemap:0,u_opacity:_t,u_temporal_offset:vt}))(j.skyboxMatrix,N.getCenter(L,!1),0,X,J);L.prepareDrawProgram(K,H),H.draw(K,Q.TRIANGLES,$,r.StencilMode.disabled,L.colorModeForRenderPass(),r.CullFaceMode.backCW,nt,"skybox",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(d,c,P,b,z):M==="gradient"&&d.renderPass==="sky"&&function(L,N,$,X,J){const K=L.context,Q=K.gl,j=L.transform,H=L.useProgram("skyboxGradient");N.skyboxGeometry||(N.skyboxGeometry=new cl(K)),K.activeTexture.set(Q.TEXTURE0);let nt=N.colorRampTexture;nt||(nt=N.colorRampTexture=new r.Texture(K,N.colorRamp,Q.RGBA)),nt.bind(Q.LINEAR,Q.CLAMP_TO_EDGE);const st=((ft,mt,_t,vt,xt)=>({u_matrix:ft,u_color_ramp:0,u_center_direction:mt,u_radius:r.degToRad(_t),u_opacity:vt,u_temporal_offset:xt}))(j.skyboxMatrix,N.getCenter(L,!1),N.paint.get("sky-gradient-radius"),X,J);L.prepareDrawProgram(K,H),H.draw(K,Q.TRIANGLES,$,r.StencilMode.disabled,L.colorModeForRenderPass(),r.CullFaceMode.backCW,st,"skyboxGradient",N.skyboxGeometry.vertexBuffer,N.skyboxGeometry.indexBuffer,N.skyboxGeometry.segment)}(d,c,P,b,z)},debug:function(d,n,c){for(let _=0;_<c.length;_++)Xp(d,n,c[_])},custom:function(d,n,c,_){const y=d.context,b=c.implementation;if(!d.transform.projection.unsupportedLayers||!d.transform.projection.unsupportedLayers.includes("custom")||d.terrain&&(d.terrain.renderingToTexture||d.renderPass==="offscreen")&&c.isLayerDraped()){if(d.renderPass==="offscreen"){const S=b.prerender;if(S){if(d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),d.transform.projection.name==="globe"){const M=d.transform.pointMerc;S.call(b,y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else S.call(b,y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState()}}else if(d.renderPass==="translucent"){if(d.terrain&&d.terrain.renderingToTexture){const M=b.renderToTile;if(M){const P=_[0].canonical,z=new r.MercatorCoordinate(P.x+_[0].wrap*(1<<P.z),P.y,P.z);y.setDepthMode(r.DepthMode.disabled),y.setStencilMode(r.StencilMode.disabled),y.setColorMode(d.colorModeForRenderPass()),d.setCustomLayerDefaults(),M.call(b,y.gl,z),y.setDirty(),d.setBaseState()}return}d.setCustomLayerDefaults(),y.setColorMode(d.colorModeForRenderPass()),y.setStencilMode(r.StencilMode.disabled);const S=b.renderingMode==="3d"?new r.DepthMode(d.context.gl.LEQUAL,r.DepthMode.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,r.DepthMode.ReadOnly);if(y.setDepthMode(S),d.transform.projection.name==="globe"){const M=d.transform.pointMerc;b.render(y.gl,d.transform.customLayerMatrix(),d.transform.getProjection(),d.transform.globeToMercatorMatrix(),r.globeToMercatorTransition(d.transform.zoom),[M.x,M.y],d.transform.pixelsPerMeterRatio)}else b.render(y.gl,d.transform.customLayerMatrix());y.setDirty(),d.setBaseState(),y.bindFramebuffer.set(null)}}else r.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class so{constructor(n,c,_=!1){this.context=new ee(n,_),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=r.SourceCache.maxUnderzooming+r.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(n,c){const _=!!n&&!!n.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Sc(this,n));const y=this._terrain;this.transform.elevation=_?y:null,y.update(n,this.transform,c)}_updateFog(n){const c=n.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,y]=c.getFovAdjustedRange(this.transform._fov);if(_>y)return void(this.transform.fogCullDistSq=null);const b=_+.78*(y-_);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(n,c){if(this.width=n*r.exported.devicePixelRatio,this.height=c*r.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const n=this.context,c=new r.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(r.EXTENT,0),c.emplaceBack(0,r.EXTENT),c.emplaceBack(r.EXTENT,r.EXTENT),this.tileExtentBuffer=n.createVertexBuffer(c,r.posAttributes.members),this.tileExtentSegments=r.SegmentVector.simpleSegment(0,0,4,2);const _=new r.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(r.EXTENT,0),_.emplaceBack(0,r.EXTENT),_.emplaceBack(r.EXTENT,r.EXTENT),this.debugBuffer=n.createVertexBuffer(_,r.posAttributes.members),this.debugSegments=r.SegmentVector.simpleSegment(0,0,4,5);const y=new r.StructArrayLayout2i4;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=n.createVertexBuffer(y,r.posAttributes.members),this.viewportSegments=r.SegmentVector.simpleSegment(0,0,4,2);const b=new r.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(r.EXTENT,0,r.EXTENT,0),b.emplaceBack(0,r.EXTENT,0,r.EXTENT),b.emplaceBack(r.EXTENT,r.EXTENT,r.EXTENT,r.EXTENT),this.mercatorBoundsBuffer=n.createVertexBuffer(b,r.boundsAttributes.members),this.mercatorBoundsSegments=r.SegmentVector.simpleSegment(0,0,4,2);const S=new r.StructArrayLayout3ui6;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=n.createIndexBuffer(S);const M=new r.StructArrayLayout1ui2;for(const z of[0,1,3,2,0])M.emplaceBack(z);this.debugIndexBuffer=n.createIndexBuffer(M),this.emptyTexture=new r.Texture(n,new r.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),n.gl.RGBA),this.identityMat=r.create();const P=this.context.gl;this.stencilClearMode=new r.StencilMode({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO),this.loadTimeStamps.push(r.window.performance.now()),this.atmosphereBuffer=new Ou(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(n){return n._makeTileBoundsBuffers(this.context,this.transform.projection),n._tileBoundsBuffer?{tileBoundsBuffer:n._tileBoundsBuffer,tileBoundsIndexBuffer:n._tileBoundsIndexBuffer,tileBoundsSegments:n._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const n=this.context,c=n.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(n,c.TRIANGLES,r.DepthMode.disabled,this.stencilClearMode,r.ColorMode.disabled,r.CullFaceMode.disabled,Jo(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(n,c,_){if(!c||this.currentStencilSource===c.id||!n.isTileClipped()||!_||_.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let M=!1;for(const P of _)if(this._tileClippingMaskIDs[P.key]===void 0){M=!0;break}if(!M)return}this.currentStencilSource=c.id;const y=this.context,b=y.gl;this.nextStencilID+_.length>256&&this.clearStencil(),y.setColorMode(r.ColorMode.disabled),y.setDepthMode(r.DepthMode.disabled);const S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const M of _){const P=c.getTile(M),z=this._tileClippingMaskIDs[M.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:N,tileBoundsSegments:$}=this.getTileBoundsBuffers(P);S.draw(y,b.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:b.ALWAYS,mask:0},z,255,b.KEEP,b.KEEP,b.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,Jo(M.projMatrix),"$clipping",L,N,$)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const n=this.nextStencilID++,c=this.context.gl;return new r.StencilMode({func:c.NOTEQUAL,mask:255},n,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(n){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(n);const c=this.context.gl;return new r.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[n.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(n){const c=this.context.gl,_=n.sort((S,M)=>M.overscaledZ-S.overscaledZ),y=_[_.length-1].overscaledZ,b=_[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const S={};for(let M=0;M<b;M++)S[M+y]=new r.StencilMode({func:c.GEQUAL,mask:255},M+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=b,[S,_]}return[{[y]:r.StencilMode.disabled},_]}colorModeForRenderPass(){const n=this.context.gl;return this._showOverdrawInspector?new r.ColorMode([n.CONSTANT_COLOR,n.ONE],new r.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.ColorMode.unblended:r.ColorMode.alphaBlended}depthModeForSublayer(n,c,_){if(!this.opaquePassEnabledForLayer())return r.DepthMode.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+n)*this.depthEpsilon;return new r.DepthMode(_||this.context.gl.LEQUAL,c,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(n,c){this.style=n,this.options=c,this.imageManager=n.imageManager,this.glyphManager=n.glyphManager,this.symbolFadeChange=n.placement.symbolFadeChange(r.exported.now()),this.imageManager.beginFrame();const _=this.style.order,y=this.style._sourceCaches;for(const z in y){const L=y[z];L.used&&L.prepare(this.context)}const b={},S={},M={};for(const z in y){const L=y[z];b[z]=L.getVisibleCoordinates(),S[z]=b[z].slice().reverse(),M[z]=L.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let z=0;z<_.length;z++)if(this.style._layers[_[z]].is3D()){this.opaquePassCutoff=z;break}if(this.terrain&&(this.terrain.updateTileBinding(M),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.GlobeSharedBuffers(this.context)),!r.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const z of _){const L=this.style._layers[z],N=n._getLayerSourceCache(L);if(!L.hasOffscreenPass()||L.isHidden(this.transform.zoom))continue;const $=N?S[N.id]:void 0;(L.type==="custom"||L.isSky()||$&&$.length)&&this.renderLayer(this,N,L,$)}this.depthRangeFor3D=[0,1-(n.order.length+2)*this.numSublayers*this.depthEpsilon];const P=this.terrain;if(P&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&P.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?r.Color.black:r.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const z=this.style._layers[_[this.currentLayer]],L=n._getLayerSourceCache(z);if(z.isSky())continue;const N=L?S[L.id]:void 0;this._renderTileClippingMasks(z,L,N),this.renderLayer(this,L,z,N)}if(this.style.fog&&this.transform.projection.supportsFog&&function(z,L){const N=z.context,$=N.gl,X=z.transform,J=new r.DepthMode($.LEQUAL,r.DepthMode.ReadOnly,[0,1]),K=z.useProgram("globeAtmosphere",null,X.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Q=r.globeToMercatorTransition(X.zoom),j=L.properties.get("color").toArray01(),H=L.properties.get("high-color").toArray01(),nt=L.properties.get("space-color").toArray01PremultipliedAlpha(),st=r.identity$1([]);r.rotateY$1(st,st,-r.degToRad(X._center.lng)),r.rotateX$1(st,st,r.degToRad(X._center.lat)),r.rotateZ$1(st,st,X.angle),r.rotateX$1(st,st,-X._pitch);const ft=r.fromQuat(new Float32Array(16),st),mt=r.mapValue(L.properties.get("star-intensity"),0,1,0,.25),_t=5e-4,vt=r.mapValue(L.properties.get("horizon-blend"),0,1,_t,.25),xt=r.globeUseCustomAntiAliasing(z,N,X)&&vt===_t?X.worldSize/(2*Math.PI*1.025)-1:X.globeRadius,At=z.frameCounter/1e3%1,Zt=r.length(X.globeCenterInViewSpace),Et=Math.sqrt(Math.pow(Zt,2)-Math.pow(xt,2)),jt=Math.acos(Et/Zt),It=((Mt,Nt,Xt,Gt,Yt,me,we,de,xe,Be,De,_e,Je,ii)=>({u_frustum_tl:Mt,u_frustum_tr:Nt,u_frustum_br:Xt,u_frustum_bl:Gt,u_horizon:Yt,u_transition:me,u_fadeout_range:we,u_color:de,u_high_color:xe,u_space_color:Be,u_star_intensity:De,u_star_size:5*r.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:_e,u_horizon_angle:Je,u_rotation_matrix:ii}))(X.frustumCorners.TL,X.frustumCorners.TR,X.frustumCorners.BR,X.frustumCorners.BL,X.frustumCorners.horizon,Q,vt,j,H,nt,mt,At,jt,ft);z.prepareDrawProgram(N,K);const $t=z.atmosphereBuffer;$t&&K.draw(N,$.TRIANGLES,J,r.StencilMode.disabled,r.ColorMode.alphaBlended,r.CullFaceMode.backCW,It,"skybox",$t.vertexBuffer,$t.indexBuffer,$t.segments)}(this,this.style.fog),this.renderPass="sky",(r.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const z=this.style._layers[_[this.currentLayer]],L=n._getLayerSourceCache(z);z.isSky()&&this.renderLayer(this,L,z,L?S[L.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const z=this.style._layers[_[this.currentLayer]],L=n._getLayerSourceCache(z);if(z.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(z)){if(z.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const N=L?(z.type==="symbol"?M:S)[L.id]:void 0;this._renderTileClippingMasks(z,L,L?b[L.id]:void 0),this.renderLayer(this,L,z,N),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let z=null;r.values(this.style._layers).forEach(L=>{const N=n._getLayerSourceCache(L);N&&!L.isHidden(this.transform.zoom)&&(!z||z.getSource().maxzoom<N.getSource().maxzoom)&&(z=N)}),z&&this.options.showTileBoundaries&&wr.debug(this,z,z.getVisibleCoordinates())}this.options.showPadding&&function(z){const L=z.transform.padding;Lu(z,z.transform.height-(L.top||0),3,io),Lu(z,L.bottom||0,3,$p),ll(z,L.left||0,3,Wp),ll(z,z.transform.width-(L.right||0),3,Zp);const N=z.transform.centerPoint;(function($,X,J,K){no($,X-1,J-10,2,20,K),no($,X-10,J-1,20,2,K)})(z,N.x,z.transform.height-N.y,Hp)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(r.window.performance.now()),this.saveCanvasCopy())}renderLayer(n,c,_,y){_.isHidden(this.transform.zoom)||(_.type==="background"||_.type==="sky"||_.type==="custom"||y&&y.length)&&(this.id=_.id,this.gpuTimingStart(_),(!n.transform.projection.unsupportedLayers||!n.transform.projection.unsupportedLayers.includes(_.type)||n.terrain&&_.type==="custom")&&wr[_.type](n,c,_,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(n){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let _=this.gpuTimers[n.id];_||(_=this.gpuTimers[n.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),_.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const n=this.context.extTimerQuery,c=n.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),n.beginQueryEXT(n.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery;n.endQueryEXT(n.TIME_ELAPSED_EXT)}collectGpuTimers(){const n=this.gpuTimers;return this.gpuTimers={},n}collectDeferredRenderGpuQueries(){const n=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],n}queryGpuTimers(n){const c={};for(const _ in n){const y=n[_],b=this.context.extTimerQuery,S=b.getQueryObjectEXT(y.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(y.query),c[_]=S}return c}queryGpuTimeDeferredRender(n){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let _=0;for(const y of n)_+=c.getQueryObjectEXT(y,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(y);return _}translatePosMatrix(n,c,_,y,b){if(!_[0]&&!_[1])return n;const S=b?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(S){const z=Math.sin(S),L=Math.cos(S);_=[_[0]*L-_[1]*z,_[0]*z+_[1]*L]}const M=[b?_[0]:ki(c,_[0],this.transform.zoom),b?_[1]:ki(c,_[1],this.transform.zoom),0],P=new Float32Array(16);return r.translate(P,n,M),P}saveTileTexture(n){const c=this._tileTextures[n.size[0]];c?c.push(n):this._tileTextures[n.size[0]]=[n]}getTileTexture(n){const c=this._tileTextures[n];return c&&c.length>0?c.pop():null}isPatternMissing(n){return n===null||n!==void 0&&!this.imageManager.getPattern(n.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const n=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&this.terrain.exaggeration()===0,_=this.style&&this.style.fog,y=[];return this.terrainRenderModeElevated()&&y.push("TERRAIN"),this.transform.projection.name==="globe"&&y.push("GLOBE"),c&&y.push("ZERO_EXAGGERATION"),_&&!n&&_.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),n&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(n,c,_){this.cache=this.cache||{};const y=_||[],b=this.currentGlobalDefines().concat(y),S=Ue.cacheKey(xc[n],n,b,c);return this.cache[S]||(this.cache[S]=new Ue(this.context,n,xc[n],c,Rc[n],b)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const n=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(n.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=r.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(n,c,_){if(this.terrain&&this.terrain.renderingToTexture)return;const y=this.style.fog;if(y){const b=y.getOpacity(this.transform.pitch),S=((M,P,z,L,N,$,X,J,K,Q,j)=>{const H=M.transform,nt=P.properties.get("color").toArray01();nt[3]=L;const st=M.frameCounter/1e3%1;return{u_fog_matrix:z?H.calculateFogTileMatrix(z):M.identityMat,u_fog_range:P.getFovAdjustedRange(H._fov),u_fog_color:nt,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_temporal_offset:st,u_frustum_tl:N,u_frustum_tr:$,u_frustum_br:X,u_frustum_bl:J,u_globe_pos:K,u_globe_radius:Q,u_viewport:j,u_globe_transition:r.globeToMercatorTransition(H.zoom),u_is_globe:+(H.projection.name==="globe")}})(this,y,_,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*r.exported.devicePixelRatio,this.transform.height*r.exported.devicePixelRatio]);c.setFogUniformValues(n,S)}}setTileLoadedFlag(n){this.tileLoaded=n}saveCanvasCopy(){const n=this.canvasCopy();n&&(this.frameCopies.push(n),this.tileLoaded=!1)}canvasCopy(){const n=this.context.gl,c=n.createTexture();return n.bindTexture(n.TEXTURE_2D,c),n.copyTexImage2D(n.TEXTURE_2D,0,n.RGBA,0,0,n.drawingBufferWidth,n.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const n=this.style&&this.style.fog;return!!n&&n.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const n=this._backgroundTiles,c=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const y of _)c[y.key]=n[y.key]||new r.Tile(y,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class hl{constructor(n=0,c=0,_=0,y=0){if(isNaN(n)||n<0||isNaN(c)||c<0||isNaN(_)||_<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=n,this.bottom=c,this.left=_,this.right=y}interpolate(n,c,_){return c.top!=null&&n.top!=null&&(this.top=r.number(n.top,c.top,_)),c.bottom!=null&&n.bottom!=null&&(this.bottom=r.number(n.bottom,c.bottom,_)),c.left!=null&&n.left!=null&&(this.left=r.number(n.left,c.left,_)),c.right!=null&&n.right!=null&&(this.right=r.number(n.right,c.right,_)),this}getCenter(n,c){const _=r.clamp((this.left+n-this.right)/2,0,n),y=r.clamp((this.top+c-this.bottom)/2,0,c);return new r.Point(_,y)}equals(n){return this.top===n.top&&this.bottom===n.bottom&&this.left===n.left&&this.right===n.right}clone(){return new hl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ul(d,n){const c=r.getColumn(d,3);r.fromQuat(d,n),r.setColumn(d,3,c)}function qe(d,n){const c=r.identity$1([]);return r.rotateZ$1(c,c,-n),r.rotateX$1(c,c,-d),c}function ra(d,n){const c=[d[0],d[1],0],_=[n[0],n[1],0];if(r.length(c)>=1e-15){const S=r.normalize([],c);r.scale$2(_,S,r.dot(_,S)),n[0]=_[0],n[1]=_[1]}const y=r.cross([],n,d);if(r.len(y)<1e-15)return null;const b=Math.atan2(-y[1],y[0]);return qe(Math.atan2(Math.sqrt(d[0]*d[0]+d[1]*d[1]),-d[2]),b)}class Bu{constructor(n,c){this.position=n,this.orientation=c}get position(){return this._position}set position(n){if(n){const c=n instanceof r.MercatorCoordinate?n:new r.MercatorCoordinate(n[0],n[1],n[2]);this._renderWorldCopies&&(c.x=r.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(n,c){if(this.orientation=null,!this.position)return;const _=this.position,y=this._elevation?this._elevation.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(n)):0,b=r.MercatorCoordinate.fromLngLat(n,y),S=[b.x-_.x,b.y-_.y,b.z-_.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=ra(S,c)}setPitchBearing(n,c){this.orientation=qe(r.degToRad(n),r.degToRad(-c))}}class dl{constructor(n,c){this._transform=r.identity([]),this.orientation=c,this.position=n}get mercatorPosition(){const n=this.position;return new r.MercatorCoordinate(n[0],n[1],n[2])}get position(){const n=r.getColumn(this._transform,3);return[n[0],n[1],n[2]]}set position(n){var c;n&&r.setColumn(this._transform,3,[(c=n)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(n){this._orientation=n||r.identity$1([]),n&&ul(this._transform,this._orientation)}getPitchBearing(){const n=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(n[0]*n[0]+n[1]*n[1]),-n[2])}}setPitchBearing(n,c){this._orientation=qe(n,c),ul(this._transform,this._orientation)}forward(){const n=r.getColumn(this._transform,2);return[-n[0],-n[1],-n[2]]}up(){const n=r.getColumn(this._transform,1);return[-n[0],-n[1],-n[2]]}right(){const n=r.getColumn(this._transform,0);return[n[0],n[1],n[2]]}getCameraToWorld(n,c){const _=new Float64Array(16);return r.invert(_,this.getWorldToCamera(n,c)),_}getWorldToCameraPosition(n,c,_){const y=this.position;r.scale$2(y,y,-n);const b=new Float64Array(16);return r.fromScaling(b,[_,_,_]),r.translate(b,b,y),b[10]*=c,b}getWorldToCamera(n,c){const _=new Float64Array(16),y=new Float64Array(4),b=this.position;return r.conjugate(y,this._orientation),r.scale$2(b,b,-n),r.fromQuat(_,y),r.translate(_,_,b),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=c,_[9]*=c,_[10]*=c,_[11]*=c,_}getCameraToClipPerspective(n,c,_,y){const b=new Float64Array(16);return r.perspective(b,n,c,_,y),b}getDistanceToElevation(n,c=!1){const _=n===0?0:r.mercatorZfromAltitude(n,c?r.latFromMercatorY(this.position[1]):this.position[1]),y=this.forward();return(_-this.position[2])/y[2]}clone(){return new dl([...this.position],[...this.orientation])}}function ro(d,n){const c=pl(d.projection,d.zoom,d.width,d.height),_=function(b,S,M,P,z){const L=new r.LngLat(M.lng-180*Ls,M.lat),N=new r.LngLat(M.lng+180*Ls,M.lat),$=b.project(L.lng,L.lat),X=b.project(N.lng,N.lat),J=-Math.atan2(X.y-$.y,X.x-$.x),K=r.MercatorCoordinate.fromLngLat(M);K.y=r.clamp(K.y,-1+Ls,1-Ls);const Q=K.toLngLat(),j=b.project(Q.lng,Q.lat),H=r.MercatorCoordinate.fromLngLat(Q);H.x+=Ls;const nt=H.toLngLat(),st=b.project(nt.lng,nt.lat),ft=fl(st.x-j.x,st.y-j.y,J),mt=r.MercatorCoordinate.fromLngLat(Q);mt.y+=Ls;const _t=mt.toLngLat(),vt=b.project(_t.lng,_t.lat),xt=fl(vt.x-j.x,vt.y-j.y,J),At=Math.abs(ft.x)/Math.abs(xt.y),Zt=r.identity([]);r.rotateZ(Zt,Zt,-J*(1-(z?0:P)));const Et=r.identity([]);return r.scale(Et,Et,[1,1-(1-At)*P,1]),Et[4]=-xt.x/xt.y*P,r.rotateZ(Et,Et,J),r.multiply(Et,Zt,Et),Et}(d.projection,0,d.center,c,n),y=Fu(d);return r.scale(_,_,[y,y,1]),_}function Fu(d){const n=d.projection,c=pl(d.projection,d.zoom,d.width,d.height),_=Nu(n,d.center),y=Nu(n,r.LngLat.convert(n.center));return Math.pow(2,_*c+(1-c)*y)}function pl(d,n,c,_,y=1/0){const b=d.range;if(!b)return 0;const S=Math.min(y,Math.max(c,_)),M=Math.log(S/1024)/Math.LN2;return r.smoothstep(b[0]+M,b[1]+M,n)}const Ls=1/4e4;function Nu(d,n){const c=r.clamp(n.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),_=new r.LngLat(n.lng-180*Ls,c),y=new r.LngLat(n.lng+180*Ls,c),b=d.project(_.lng,c),S=d.project(y.lng,c),M=r.MercatorCoordinate.fromLngLat(_),P=r.MercatorCoordinate.fromLngLat(y),z=S.x-b.x,L=S.y-b.y,N=P.x-M.x,$=P.y-M.y,X=Math.sqrt((N*N+$*$)/(z*z+L*L));return Math.log(X)/Math.LN2}function fl(d,n,c){const _=Math.cos(c),y=Math.sin(c);return{x:d*_-n*y,y:d*y+n*_}}class oo{constructor(n,c,_,y,b,S,M){this.tileSize=512,this._renderWorldCopies=b===void 0||b,this._minZoom=n||0,this._maxZoom=c||22,this._minPitch=_??0,this._maxPitch=y??60,this.setProjection(S),this.setMaxBounds(M),this.width=0,this.height=0,this._center=new r.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new hl,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new dl,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const n=new oo(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return n._elevation=this._elevation,n._centerAltitude=this._centerAltitude,n._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,n.tileSize=this.tileSize,n.mercatorFromTransition=this.mercatorFromTransition,n.width=this.width,n.height=this.height,n.cameraElevationReference=this.cameraElevationReference,n._center=this._center,n._setZoom(this.zoom),n._seaLevelZoom=this._seaLevelZoom,n.angle=this.angle,n._fov=this._fov,n._pitch=this._pitch,n._nearZ=this._nearZ,n._farZ=this._farZ,n._averageElevation=this._averageElevation,n._unmodified=this._unmodified,n._edgeInsets=this._edgeInsets.clone(),n._camera=this._camera.clone(),n._calcMatrices(),n.freezeTileCoverage=this.freezeTileCoverage,n.frustumCorners=this.frustumCorners,n}get elevation(){return this._elevation}set elevation(n){this._elevation!==n&&(this._elevation=n,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(n,c=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||_)&&this._updateCameraOnTerrain(),(n||_)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return r.pick(this.projection,["name","center","parallels"])}setProjection(n){this.projectionOptions=n||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=r.getProjection(this.projectionOptions);const _=!T(c,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const n=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=r.getProjection({name:"mercator"});const c=n!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(n){this._minZoom!==n&&(this._minZoom=n,this.zoom=Math.max(this.zoom,n))}get maxZoom(){return this._maxZoom}set maxZoom(n){this._maxZoom!==n&&(this._maxZoom=n,this.zoom=Math.min(this.zoom,n))}get minPitch(){return this._minPitch}set minPitch(n){this._minPitch!==n&&(this._minPitch=n,this.pitch=Math.max(this.pitch,n))}get maxPitch(){return this._maxPitch}set maxPitch(n){this._maxPitch!==n&&(this._maxPitch=n,this.pitch=Math.min(this.pitch,n))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(n){n===void 0?n=!0:n===null&&(n=!1),this._renderWorldCopies=n}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get cameraWorldSize(){const n=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(n))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return r.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.Point(this.width,this.height)}get bearing(){return r.wrap(this.rotation,-180,180)}set bearing(n){this.rotation=n}get rotation(){return-this.angle/Math.PI*180}set rotation(n){const c=-n*Math.PI/180;var _;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(_=new r.ARRAY_TYPE(4),r.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),function(y,b,S){var M=b[0],P=b[1],z=b[2],L=b[3],N=Math.sin(S),$=Math.cos(S);y[0]=M*$+z*N,y[1]=P*$+L*N,y[2]=M*-N+z*$,y[3]=P*-N+L*$}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(n){const c=r.clamp(n,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const n=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/n)}set fov(n){n=Math.max(.01,Math.min(60,n)),this._fov!==n&&(this._unmodified=!1,this._fov=r.degToRad(n),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(n){this._averageElevation=n,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(n){const c=Math.min(Math.max(n,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(n){this._zoom=n,this.scale=this.zoomScale(n),this.tileZoom=Math.floor(n),this.zoomFraction=n-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const n=this._elevation;this._centerAltitude=n.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=n.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const n=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let y=0,b=0;for(let S=0;S<c.length;S++){const M=new r.Point(c[S][0]*this.width,_+c[S][1]*(this.height-_)),P=n.pointCoordinate(M);if(!P)continue;const z=1/Math.hypot(P[0]-this._camera.position[0],P[1]-this._camera.position[1]);y+=P[3]*z,b+=z}return b===0?NaN:y/b}get center(){return this._center}set center(n){n.lat===this._center.lat&&n.lng===this._center.lng||(this._unmodified=!1,this._center=n,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const n=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(n),b=this._mercatorZfromZoom(this._maxZoom),S=Math.max(y-_,b);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(n){this._edgeInsets.equals(n)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,n,1),this._calcMatrices())}computeZoomRelativeTo(n){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,n.toAltitude()));let _;_=n.z<this._camera.position[2]?[c.x,c.y,c.z]:[n.x,n.y,n.z];const y=r.length(r.sub([],this._camera.position,_));return r.clamp(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(n){if(!this.height||!n.position&&!n.orientation)return;this._updateCameraState();let c=!1;if(n.orientation&&!r.exactEquals(n.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(n.orientation)),n.position){const _=[n.position.x,n.position.y,n.position.z];r.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const n=this._camera.position,c=new Bu;return c.position=new r.MercatorCoordinate(n[0],n[1],n[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(n){if(!r.length$1(n))return!1;r.normalize$1(n,n);const c=r.transformQuat([],[0,0,-1],n),_=r.transformQuat([],[0,-1,0],n);if(_[2]<0)return!1;const y=ra(c,_);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(n){const c=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;n[2]=r.clamp(n[2],y/_,y/c),this._camera.position=n}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(n){return this._edgeInsets.equals(n)}interpolatePadding(n,c,_){this._unmodified=!1,this._edgeInsets.interpolate(n,c,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(n){const c=(n.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/n.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(n){const c=[new r.UnwrappedTileID(0,n)];if(this.renderWorldCopies){const _=this.pointCoordinate(new r.Point(0,0)),y=this.pointCoordinate(new r.Point(this.width,0)),b=this.pointCoordinate(new r.Point(this.width,this.height)),S=this.pointCoordinate(new r.Point(0,this.height)),M=Math.floor(Math.min(_.x,y.x,b.x,S.x)),P=Math.floor(Math.max(_.x,y.x,b.x,S.x)),z=1;for(let L=M-z;L<=P+z;L++)L!==0&&c.push(new r.UnwrappedTileID(L,n))}return c}coveringTiles(n){let c=this.coveringZoomLevel(n);const _=c,y=this.elevation&&!n.isTerrainDEM,b=this.projection.name==="mercator";if(n.minzoom!==void 0&&c<n.minzoom)return[];n.maxzoom!==void 0&&c>n.maxzoom&&(c=n.maxzoom);const S=this.locationCoordinate(this.center),M=this.center.lat,P=1<<c,z=[P*S.x,P*S.y,0],L=this.projection.name==="globe",N=!L,$=r.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,N),X=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=P*r.mercatorZfromAltitude(1,this.center.lat),K=this._camera.position[2]/r.mercatorZfromAltitude(1,this.center.lat),Q=[P*X.x,P*X.y,K*(N?1:J)],j=this.cameraToCenterDistance/n.tileSize*(n.roundZoom?1:.502),H=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,nt=n.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,st=n.isTerrainDEM?-nt:this._elevation?this._elevation.getMinElevationBelowMSL():0,ft=this.projection.isReprojectedInTileSpace?Fu(this):1,mt=Mt=>{const Xt=new r.MercatorCoordinate(Mt.x+25e-6,Mt.y,Mt.z),Gt=new r.MercatorCoordinate(Mt.x,Mt.y+25e-6,Mt.z),Yt=Mt.toLngLat(),me=Xt.toLngLat(),we=Gt.toLngLat(),de=this.locationCoordinate(Yt),xe=this.locationCoordinate(me),Be=this.locationCoordinate(we),De=Math.hypot(xe.x-de.x,xe.y-de.y),_e=Math.hypot(Be.x-de.x,Be.y-de.y);return Math.sqrt(De*_e)*ft/25e-6},_t=Mt=>{const Nt=nt,Xt=st;return{aabb:r.tileAABB(this,P,0,0,0,Mt,Xt,Nt,this.projection),zoom:0,x:0,y:0,minZ:Xt,maxZ:Nt,wrap:Mt,fullyVisible:!1}},vt=[];let xt=[];const At=c,Zt=n.reparseOverscaled?_:c,Et=Mt=>Mt*Mt,jt=Et((K-this._centerAltitude)*J),It=Mt=>{if(!this._elevation||!Mt.tileID||!b)return;const Nt=this._elevation.getMinMaxForTile(Mt.tileID),Xt=Mt.aabb;Nt?(Xt.min[2]=Nt.min,Xt.max[2]=Nt.max,Xt.center[2]=(Xt.min[2]+Xt.max[2])/2):(Mt.shouldSplit=$t(Mt),Mt.shouldSplit||(Xt.min[2]=Xt.max[2]=Xt.center[2]=this._centerAltitude))},$t=Mt=>{if(Mt.zoom<H)return!0;if(Mt.zoom===At)return!1;if(Mt.shouldSplit!=null)return Mt.shouldSplit;const Nt=Mt.aabb.distanceX(Q),Xt=Mt.aabb.distanceY(Q);let Gt=jt,Yt=1;if(L){Gt=Et(Mt.aabb.distanceZ(Q));const de=Math.pow(2,Mt.zoom),xe=r.latFromMercatorY((Mt.y+1)/de),Be=r.latFromMercatorY(Mt.y/de),De=Math.min(Math.max(M,xe),Be),_e=r.circumferenceAtLatitude(De)/r.circumferenceAtLatitude(M);if(Yt=De===M?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,_e/this._mercatorScaleRatio),this.zoom<=r.GLOBE_ZOOM_THRESHOLD_MIN&&Mt.zoom===At-1&&_e>=.9)return!0}else if(y&&(Gt=Et(Mt.aabb.distanceZ(Q)*J)),this.projection.isReprojectedInTileSpace&&_<=5){const de=Math.pow(2,Mt.zoom),xe=mt(new r.MercatorCoordinate((Mt.x+.5)/de,(Mt.y+.5)/de));Yt=xe>.85?1:xe}const me=Nt*Nt+Xt*Xt+Gt,we=Et((1<<At-Mt.zoom)*j*Yt*((de,xe)=>{if(xe*Et(.707)<de)return 1;const Be=Math.sqrt(xe/de);return Be/(1.4144271570014144+(Math.pow(1.1,Be-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Gt,jt),me));return me<we};if(this.renderWorldCopies)for(let Mt=1;Mt<=3;Mt++)vt.push(_t(-Mt)),vt.push(_t(Mt));for(vt.push(_t(0));vt.length>0;){const Mt=vt.pop(),Nt=Mt.x,Xt=Mt.y;let Gt=Mt.fullyVisible;if(!Gt){const Yt=Mt.aabb.intersects($);if(Yt===0)continue;Gt=Yt===2}if(Mt.zoom!==At&&$t(Mt))for(let Yt=0;Yt<4;Yt++){const me=(Nt<<1)+Yt%2,we=(Xt<<1)+(Yt>>1),de={aabb:b?Mt.aabb.quadrant(Yt):r.tileAABB(this,P,Mt.zoom+1,me,we,Mt.wrap,Mt.minZ,Mt.maxZ,this.projection),zoom:Mt.zoom+1,x:me,y:we,wrap:Mt.wrap,fullyVisible:Gt,tileID:void 0,shouldSplit:void 0,minZ:Mt.minZ,maxZ:Mt.maxZ};y&&!L&&(de.tileID=new r.OverscaledTileID(Mt.zoom+1===At?Zt:Mt.zoom+1,Mt.wrap,Mt.zoom+1,me,we),It(de)),vt.push(de)}else{const Yt=Mt.zoom===At?Zt:Mt.zoom;if(n.minzoom&&n.minzoom>Yt)continue;const me=z[0]-(.5+Nt+(Mt.wrap<<Mt.zoom))*(1<<c-Mt.zoom),we=z[1]-.5-Xt,de=Mt.tileID?Mt.tileID:new r.OverscaledTileID(Yt,Mt.wrap,Mt.zoom,Nt,Xt);xt.push({tileID:de,distanceSq:me*me+we*we})}}if(this.fogCullDistSq){const Mt=this.fogCullDistSq,Nt=this.horizonLineFromTop();xt=xt.filter(Xt=>{const Gt=[0,0,0,1],Yt=[r.EXTENT,r.EXTENT,0,1],me=this.calculateFogTileMatrix(Xt.tileID.toUnwrapped());r.transformMat4$1(Gt,Gt,me),r.transformMat4$1(Yt,Yt,me);const we=r.getAABBPointSquareDist(Gt,Yt);if(we===0)return!0;let de=!1;const xe=this._elevation;if(xe&&we>Mt&&Nt!==0){const Be=this.calculateProjMatrix(Xt.tileID.toUnwrapped());let De;n.isTerrainDEM||(De=xe.getMinMaxForTile(Xt.tileID)),De||(De={min:st,max:nt});const _e=r.furthestTileCorner(this.rotation),Je=[_e[0]*r.EXTENT,_e[1]*r.EXTENT,De.max];r.transformMat4(Je,Je,Be),de=(1-Je[1])*this.height*.5<Nt}return we<Mt||de})}return xt.sort((Mt,Nt)=>Mt.distanceSq-Nt.distanceSq).map(Mt=>Mt.tileID)}resize(n,c){this.width=n,this.height=c,this.pixelsToGLUnits=[2/n,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(n){return Math.pow(2,n)}scaleZoom(n){return Math.log(n)/Math.LN2}project(n){const c=r.clamp(n.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),_=this.projection.project(n.lng,c);return new r.Point(_.x*this.worldSize,_.y*this.worldSize)}unproject(n){return this.projection.unproject(n.x/this.worldSize,n.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/r.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(n,c){let _,y;const b=this.centerPoint;if(this.projection.name==="globe"){const M=this.worldSize;_=(c.x-b.x)/M,y=(c.y-b.y)/M}else{const M=this.pointCoordinate(c),P=this.pointCoordinate(b);_=M.x-P.x,y=M.y-P.y}const S=this.locationCoordinate(n);this.setLocation(new r.MercatorCoordinate(S.x-_,S.y-y))}setLocation(n){this.center=this.coordinateLocation(n),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(n){return this.projection.locationPoint(this,n)}locationPoint3D(n){return this.projection.locationPoint(this,n,!0)}pointLocation(n){return this.coordinateLocation(this.pointCoordinate(n))}pointLocation3D(n){return this.coordinateLocation(this.pointCoordinate3D(n))}locationCoordinate(n,c){const _=c?r.mercatorZfromAltitude(c,n.lat):void 0,y=this.projection.project(n.lng,n.lat);return new r.MercatorCoordinate(y.x,y.y,_)}coordinateLocation(n){return this.projection.unproject(n.x,n.y)}pointRayIntersection(n,c){const _=c??this._centerAltitude,y=[n.x,n.y,0,1],b=[n.x,n.y,1,1];r.transformMat4$1(y,y,this.pixelMatrixInverse),r.transformMat4$1(b,b,this.pixelMatrixInverse);const S=b[3];r.scale$1(y,y,1/y[3]),r.scale$1(b,b,1/S);const M=y[2],P=b[2];return{p0:y,p1:b,t:M===P?0:(_-M)/(P-M)}}screenPointToMercatorRay(n){const c=[n.x,n.y,0,1],_=[n.x,n.y,1,1];return r.transformMat4$1(c,c,this.pixelMatrixInverse),r.transformMat4$1(_,_,this.pixelMatrixInverse),r.scale$1(c,c,1/c[3]),r.scale$1(_,_,1/_[3]),c[2]=r.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,_[2]=r.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,r.scale$1(c,c,1/this.worldSize),r.scale$1(_,_,1/this.worldSize),new r.Ray([c[0],c[1],c[2]],r.normalize([],r.sub([],_,c)))}rayIntersectionCoordinate(n){const{p0:c,p1:_,t:y}=n,b=r.mercatorZfromAltitude(c[2],this._center.lat),S=r.mercatorZfromAltitude(_[2],this._center.lat);return new r.MercatorCoordinate(r.number(c[0],_[0],y)/this.worldSize,r.number(c[1],_[1],y)/this.worldSize,r.number(b,S,y))}pointCoordinate(n,c=this._centerAltitude){return this.projection.pointCoordinate(this,n.x,n.y,c)}pointCoordinate3D(n){if(!this.elevation)return this.pointCoordinate(n);let c=this.projection.pointCoordinate3D(this,n.x,n.y);if(c)return new r.MercatorCoordinate(c[0],c[1],c[2]);let _=0,y=this.horizonLineFromTop();if(n.y>y)return this.pointCoordinate(n);const b=.02*y,S=n.clone();for(let M=0;M<10&&y-_>b;M++){S.y=r.number(_,y,.66);const P=this.projection.pointCoordinate3D(this,S.x,S.y);P?(y=S.y,c=P):_=S.y}return c?new r.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(n)}isPointAboveHorizon(n){return this.projection.isPointAboveHorizon(this,n)}isPointOnSurface(n){if(n.y<0||n.y>this.height||n.x<0||n.x>this.width)return!1;if(this.elevation||this.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(n);const c=this.pointCoordinate(n);return c.y>=0&&c.y<=1}_coordinatePoint(n,c){const _=c&&this.elevation?this.elevation.getAtPointOrZero(n,this._centerAltitude):this._centerAltitude,y=[n.x*this.worldSize,n.y*this.worldSize,_+n.toAltitude(),1];return r.transformMat4$1(y,y,this.pixelMatrix),y[3]>0?new r.Point(y[0]/y[3],y[1]/y[3]):new r.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:n,left:c}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,b=this.pointLocation3D(new r.Point(c,n)),S=this.pointLocation3D(new r.Point(y,n)),M=this.pointLocation3D(new r.Point(y,_)),P=this.pointLocation3D(new r.Point(c,_));let z=Math.min(b.lng,S.lng,M.lng,P.lng),L=Math.max(b.lng,S.lng,M.lng,P.lng),N=Math.min(b.lat,S.lat,M.lat,P.lat),$=Math.max(b.lat,S.lat,M.lat,P.lat);const X=Math.pow(2,-this.zoom)/16*270,J=this.projection.name==="globe"?1:4,K=(Q,j,H,nt,st)=>{const ft=(Q+H)/2,mt=(j+nt)/2,_t=new r.Point(ft,mt),{lng:vt,lat:xt}=this.pointLocation3D(_t),At=Math.max(0,z-vt,N-xt,vt-L,xt-$);z=Math.min(z,vt),L=Math.max(L,vt),N=Math.min(N,xt),$=Math.max($,xt),(st<J||At>X)&&(K(Q,j,ft,mt,st+1),K(ft,mt,H,nt,st+1))};if(K(c,n,y,n,1),K(y,n,y,_,1),K(y,_,c,_,1),K(c,_,c,n,1),this.projection.name==="globe"){const[Q,j]=r.polesInViewport(this);Q?($=90,L=180,z=-180):j&&(N=-90,L=180,z=-180)}return new r.LngLatBounds(new r.LngLat(z,N),new r.LngLat(L,$))}_getBoundsRectangular(n,c){const{top:_,left:y}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,M=new r.Point(y,_),P=new r.Point(S,_),z=new r.Point(S,b),L=new r.Point(y,b);let N=this.pointCoordinate(M,n),$=this.pointCoordinate(P,n);const X=this.pointCoordinate(z,c),J=this.pointCoordinate(L,c),K=(Q,j)=>(j.y-Q.y)/(j.x-Q.x);return N.y>1&&$.y>=0?N=new r.MercatorCoordinate((1-J.y)/K(J,N)+J.x,1):N.y<0&&$.y<=1&&(N=new r.MercatorCoordinate(-J.y/K(J,N)+J.x,0)),$.y>1&&N.y>=0?$=new r.MercatorCoordinate((1-X.y)/K(X,$)+X.x,1):$.y<0&&N.y<=1&&($=new r.MercatorCoordinate(-X.y/K(X,$)+X.x,0)),new r.LngLatBounds().extend(this.coordinateLocation(N)).extend(this.coordinateLocation($)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){const n=this.elevation;if(!n.visibleDemTiles.length||n.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=n.visibleDemTiles.reduce((_,y)=>{if(y.dem){const b=y.dem.tree;_.min=Math.min(_.min,b.minimums[0]),_.max=Math.max(_.max,b.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*n.exaggeration(),c.max*n.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(n=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-c*(1-this._horizonShift);return n?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(n){this.maxBounds=n,this.minLat=-r.MAX_MERCATOR_LATITUDE,this.maxLat=r.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,n&&(this.minLat=n.getSouth(),this.maxLat=n.getNorth(),this.minLng=n.getWest(),this.maxLng=n.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=r.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=r.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=r.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(n,c){return this.projection.createTileMatrix(this,c,n)}calculateDistanceTileData(n){const c=n.key,_=this._distanceTileDataCache;if(_[c])return _[c];const y=n.canonical,b=1/this.height,S=this.cameraWorldSize,M=S/this.zoomScale(y.z),P=(y.x+Math.pow(2,y.z)*n.wrap)*M,z=y.y*M,L=this.point;L.x*=S/this.worldSize,L.y*=S/this.worldSize;const N=this.angle,$=Math.sin(-N),X=-Math.cos(-N);return _[c]={bearing:[$,X],center:[(L.x-P)*b,(L.y-z)*b],scale:M/r.EXTENT*b},_[c]}calculateFogTileMatrix(n){const c=n.key,_=this._fogTileMatrixCache;if(_[c])return _[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,n);return r.multiply(y,this.worldToFogMatrix,y),_[c]=new Float32Array(y),_[c]}calculateProjMatrix(n,c=!1){const _=n.key,y=c?this._alignedProjMatrixCache:this._projMatrixCache;if(y[_])return y[_];const b=this.calculatePosMatrix(n,this.worldSize);return r.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,b),y[_]=new Float32Array(b),y[_]}calculatePixelsToTileUnitsMatrix(n){const c=n.tileID.key,_=this._pixelsToTileUnitsCache;if(_[c])return _[c];const y=function(b,S){const{scale:M}=b.tileTransform,P=M*r.EXTENT/(b.tileSize*Math.pow(2,S.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return z=new Float32Array(4),$=(L=S.inverseAdjustmentMatrix)[1],X=L[2],J=L[3],Q=(N=[P,P])[1],z[0]=L[0]*(K=N[0]),z[1]=$*K,z[2]=X*Q,z[3]=J*Q,z;var z,L,N,$,X,J,K,Q}(n,this);return _[c]=y,_[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const n=1/this.worldSize,c=r.fromScaling([],[n,n,n]);return r.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const n=this._elevation;this._updateCameraState();const c=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(c),y=this._camera.forward(),b=r.mercatorZfromAltitude(1,this._center.lat);_[2]/=b,y[2]/=b,r.normalize(y,y);const S=n.raycast(_,y,n.exaggeration());if(S){const M=r.scaleAndAdd([],_,y,S),P=new r.MercatorCoordinate(M[0],M[1],r.mercatorZfromAltitude(M[2],r.latFromMercatorY(M[1]))),z=(P.z+r.length([P.x-_[0],P.y-_[1],P.z-_[2]*b]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=P.toAltitude(),this._center=this.coordinateLocation(P),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(n=!1){if(!this._elevation)return;const c=this._elevation,_=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(_),b=c.getAtPointOrZero(new r.MercatorCoordinate(...y)),S=this.pixelsPerMeter/this.worldSize*b,M=this._minimumHeightOverTerrain(),P=y[2]-S;if(P<=M)if(P<0||n){const z=this.locationCoordinate(this._center,this._centerAltitude),L=[y[0],y[1],z.z-y[2]],N=r.length(L);L[2]-=(M-P)/this._pixelsPerMercatorPixel;const $=r.length(L);if($===0)return;r.scale$2(L,L,N/$*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],z.z*this._pixelsPerMercatorPixel-L[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const n=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||n){const $=this.center;return $.lat=r.clamp($.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!n)&&($.lng=r.clamp($.lng,this.minLng,this.maxLng)),this.center=$,void(this._constraining=!1)}const c=this._unmodified,{x:_,y}=this.point;let b=0,S=_,M=y;const P=this.width/2,z=this.height/2,L=this.worldMinY*this.scale,N=this.worldMaxY*this.scale;if(y-z<L&&(M=L+z),y+z>N&&(M=N-z),N-L<this.height&&(b=Math.max(b,this.height/(N-L)),M=(N+L)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const $=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,J=this.worldSize/2-($+X)/2;S=(_+J+this.worldSize)%this.worldSize-J,S-P<$&&(S=$+P),S+P>X&&(S=X-P),X-$<this.width&&(b=Math.max(b,this.width/(X-$)),S=(X+$)/2)}S===_&&M===y||(this.center=this.unproject(new r.Point(S,M))),b&&(this.zoom+=this.scaleZoom(b)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let n=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(n=Math.max(n,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),n}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const n=this.centerOffset,c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=r.mercatorZfromAltitude(1,this.center.lat)/r.mercatorZfromAltitude(1,r.GLOBE_SCALE_MATCH_LATITUDE));const _=pl(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?c:1,b=this._camera.getWorldToCamera(this.worldSize,y),S=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);S[8]=2*-n.x/this.width,S[9]=2*n.y/this.height;let M=r.mul([],S,b);if(this.projection.isReprojectedInTileSpace){const mt=this.locationCoordinate(this.center),_t=r.identity([]);r.translate(_t,_t,[mt.x*this.worldSize,mt.y*this.worldSize,0]),r.multiply(_t,_t,ro(this)),r.translate(_t,_t,[-mt.x*this.worldSize,-mt.y*this.worldSize,0]),r.multiply(M,M,_t),this.inverseAdjustmentMatrix=function(vt){const xt=ro(vt,!0);return Lt([],[xt[0],xt[1],xt[4],xt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=r.scale([],M,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=M,this.invProjMatrix=r.invert(new Float64Array(16),this.projMatrix);const P=r.invert([],S);this.frustumCorners=r.FrustumCorners.fromInvProjectionMatrix(P,this.horizonLineFromTop(),this.height);const z=new Float32Array(16);r.identity(z),r.scale(z,z,[1,-1,1]),r.rotateX(z,z,this._pitch),r.rotateZ(z,z,this.angle);const L=r.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),N=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;L[8]=2*-n.x/this.width,L[9]=2*(n.y+N)/this.height,this.skyboxMatrix=r.multiply(z,L,z);const $=this.point,X=$.x,J=$.y,K=this.width%2/2,Q=this.height%2/2,j=Math.cos(this.angle),H=Math.sin(this.angle),nt=X-Math.round(X)+j*K+H*Q,st=J-Math.round(J)+j*Q+H*K,ft=new Float64Array(M);if(r.translate(ft,ft,[nt>.5?nt-1:nt,st>.5?st-1:st,0]),this.alignedProjMatrix=ft,M=r.create(),r.scale(M,M,[this.width/2,-this.height/2,1]),r.translate(M,M,[1,-1,0]),this.labelPlaneMatrix=M,M=r.create(),r.scale(M,M,[1,-1,1]),r.translate(M,M,[-1,-1,0]),r.scale(M,M,[2/this.width,2/this.height,1]),this.glCoordMatrix=M,this.pixelMatrix=r.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},M=r.invert(new Float64Array(16),this.pixelMatrix),!M)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=M,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=r.calculateGlobeMatrix(this);const mt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=r.transformMat4(mt,mt,b),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=M;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const n=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,_=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,b=[n,n,c];r.scale$2(b,b,y),r.scale$2(_,_,-1),r.multiply$2(_,_,b);const S=r.create();r.translate(S,S,_),r.scale(S,S,b),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(n,c,y)}_computeCameraPosition(n){const c=(n=n||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),y=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-n/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-_[0]*b,y.y/this.worldSize-_[1]*b,n/this.worldSize*this._centerAltitude-_[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(n){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],y=n[2];let b=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(b=Math.min((c-_)/y,1)),this._camera.position=r.scaleAndAdd([],this._camera.position,n,b),this._updateStateFromCamera()}_updateStateFromCamera(){const n=this._camera.position,c=this._camera.forward(),{pitch:_,bearing:y}=this._camera.getPitchBearing(),b=r.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.degToRad(this._maxPitch)),M=Math.max((n[2]-b)/Math.cos(_),S),P=this._zoomFromMercatorZ(M);r.scaleAndAdd(n,n,c,M),this._pitch=r.clamp(_,r.degToRad(this.minPitch),r.degToRad(this.maxPitch)),this.angle=r.wrap(y,-Math.PI,Math.PI),this._setZoom(r.clamp(P,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.MercatorCoordinate(n[0],n[1],n[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(n){return Math.pow(2,n)*this.tileSize}_mercatorZfromZoom(n){return this.cameraToCenterDistance/this._worldSizeFromZoom(n)}_minimumHeightOverTerrain(){const n=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(n)}_zoomFromMercatorZ(n){return this.scaleZoom(this.cameraToCenterDistance/(n*this.tileSize))}zoomFromMercatorZAdjusted(n){let c=0,_=r.GLOBE_ZOOM_THRESHOLD_MAX,y=0,b=1/0;for(;_-c>1e-6&&_>c;){const S=c+.5*(_-c),M=this.tileSize*Math.pow(2,S),P=this.getCameraToCenterDistance(this.projection,S,M),z=this.scaleZoom(P/(n*this.tileSize)),L=Math.abs(S-z);L<b&&(b=L,y=S),S<z?c=S:_=S}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(n,c){const _=Math.min(n.x,c.x),y=Math.max(n.x,c.x),b=Math.min(n.y,c.y),S=Math.max(n.y,c.y);if(b<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const M=[new r.Point(_,b),new r.Point(y,S),new r.Point(_,S),new r.Point(y,b)],P=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const L of M){const N=this.pointRayIntersection(L);if(N.t<0)return!0;const $=this.rayIntersectionCoordinate(N);if($.x<P||$.y<0||$.x>z||$.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.Point(0,0),new r.Point(this.width,this.height))}zoomDeltaToMovement(n,c){const _=r.length(r.sub([],this._camera.position,n)),y=this._zoomFromMercatorZ(_)+c;return _-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const n=function([c,_,y],b){const S=[c,_,y,1];r.transformMat4$1(S,S,b);const M=S[3]=Math.max(S[3],1e-6);return S[0]/=M,S[1]/=M,S[2]/=M,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new r.Point(n[0],n[1])}{const n=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.Point(0,n))}}getCameraToCenterDistance(n,c=this.zoom,_=this.worldSize){const y=pl(n,c,this.width,this.height,1024),b=n.pixelSpaceConversion(this.center.lat,_,y);return .5/Math.tan(.5*this._fov)*this.height*b}getWorldToCameraMatrix(){const n=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&r.multiply(n,n,this.globeMatrix),n}}function ao(d,n){let c=!1,_=null;const y=()=>{_=null,c&&(d(),_=setTimeout(y,n),c=!1)};return()=>(c=!0,_||y(),_)}class Fc{constructor(n){this._hashName=n&&encodeURIComponent(n),r.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=ao(this._updateHashUnthrottled.bind(this),300)}addTo(n){return this._map=n,r.window.addEventListener("hashchange",this._onHashChange,!1),n.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),r.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const n=this._map;if(!n)return"";const c=oa(n);if(this._hashName){const _=this._hashName;let y=!1;const b=r.window.location.hash.slice(1).split("&").map(S=>{const M=S.split("=")[0];return M===_?(y=!0,`${M}=${c}`):S}).filter(S=>S);return y||b.push(`${_}=${c}`),`#${b.join("&")}`}return`#${c}`}_getCurrentHash(){const n=r.window.location.hash.replace("#","");if(this._hashName){let c;return n.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(c=_)}),(c&&c[1]||"").split("/")}return n.split("/")}_onHashChange(){const n=this._map;if(!n)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(_=>isNaN(_))){const _=n.dragRotate.isEnabled()&&n.touchZoomRotate.isEnabled()?+(c[3]||0):n.getBearing();return n.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:_,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const n=r.window.location.href.replace(/(#.+)?$/,this.getHashString());r.window.history.replaceState(r.window.history.state,null,n)}}function oa(d,n){const c=d.getCenter(),_=Math.round(100*d.getZoom())/100,y=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,y),S=Math.round(c.lng*b)/b,M=Math.round(c.lat*b)/b,P=d.getBearing(),z=d.getPitch();let L=n?`/${S}/${M}/${_}`:`${_}/${M}/${S}`;return(P||z)&&(L+="/"+Math.round(10*P)/10),z&&(L+=`/${Math.round(z)}`),L}const aa={linearity:.3,easing:r.bezier(0,0,.3,1)},_l=r.extend({deceleration:2500,maxSpeed:1400},aa),ml=r.extend({deceleration:20,maxSpeed:1400},aa),ce=r.extend({deceleration:1e3,maxSpeed:360},aa),es=r.extend({deceleration:1e3,maxSpeed:90},aa);class ju{constructor(n){this._map=n,this.clear()}clear(){this._inertiaBuffer=[]}record(n){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.exported.now(),settings:n})}_drainInertiaBuffer(){const n=this._inertiaBuffer,c=r.exported.now();for(;n.length>0&&c-n[0].time>160;)n.shift()}_onMoveEnd(n){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new r.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)c.zoom+=b.zoomDelta||0,c.bearing+=b.bearingDelta||0,c.pitch+=b.pitchDelta||0,b.panDelta&&c.pan._add(b.panDelta),b.around&&(c.around=b.around),b.pinchAround&&(c.pinchAround=b.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const b=ca(c.pan.mag(),_,r.extend({},_l,n||{}));y.offset=c.pan.mult(b.amount/c.pan.mag()),y.center=this._map.transform.center,la(y,b)}if(c.zoom){const b=ca(c.zoom,_,ml);y.zoom=this._map.transform.zoom+b.amount,la(y,b)}if(c.bearing){const b=ca(c.bearing,_,ce);y.bearing=this._map.transform.bearing+r.clamp(b.amount,-179,179),la(y,b)}if(c.pitch){const b=ca(c.pitch,_,es);y.pitch=this._map.transform.pitch+b.amount,la(y,b)}if(y.zoom||y.bearing){const b=c.pinchAround===void 0?c.around:c.pinchAround;y.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function la(d,n){(!d.duration||d.duration<n.duration)&&(d.duration=n.duration,d.easing=n.easing)}function ca(d,n,c){const{maxSpeed:_,linearity:y,deceleration:b}=c,S=r.clamp(d*y/(n/1e3),-_,_),M=Math.abs(S)/(b*y);return{easing:c.easing,duration:1e3*M,amount:S*(M/2)}}class en extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_,y={}){const b=Rt(c.getCanvasContainer(),_),S=c.unproject(b);super(n,r.extend({point:b,lngLat:S,originalEvent:_},y)),this._defaultPrevented=!1,this.target=c}}class ha extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_){const y=n==="touchend"?_.changedTouches:_.touches,b=Jt(c.getCanvasContainer(),y),S=b.map(P=>c.unproject(P)),M=b.reduce((P,z,L,N)=>P.add(z.div(N.length)),new r.Point(0,0));super(n,{points:b,point:M,lngLats:S,lngLat:c.unproject(M),originalEvent:_}),this._defaultPrevented=!1}}class gl extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(n,c,_){super(n,{originalEvent:_}),this._defaultPrevented=!1}}class Nc{constructor(n,c){this._map=n,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(n){return this._firePreventable(new gl(n.type,this._map,n))}mousedown(n,c){return this._mousedownPos=c,this._firePreventable(new en(n.type,this._map,n))}mouseup(n){this._map.fire(new en(n.type,this._map,n))}preclick(n){const c=r.extend({},n);c.type="preclick",this._map.fire(new en(c.type,this._map,c))}click(n,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(n),this._map.fire(new en(n.type,this._map,n)))}dblclick(n){return this._firePreventable(new en(n.type,this._map,n))}mouseover(n){this._map.fire(new en(n.type,this._map,n))}mouseout(n){this._map.fire(new en(n.type,this._map,n))}touchstart(n){return this._firePreventable(new ha(n.type,this._map,n))}touchmove(n){this._map.fire(new ha(n.type,this._map,n))}touchend(n){this._map.fire(new ha(n.type,this._map,n))}touchcancel(n){this._map.fire(new ha(n.type,this._map,n))}_firePreventable(n){if(this._map.fire(n),n.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class yl{constructor(n){this._map=n}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(n){this._map.fire(new en(n.type,this._map,n))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new en("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(n){this._delayContextMenu?this._contextMenuEvent=n:this._map.fire(new en(n.type,this._map,n)),this._map.listens("contextmenu")&&n.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vu{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._container=n.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(n,c){this.isEnabled()&&n.shiftKey&&n.button===0&&(bt(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(n,c){if(!this._active)return;const _=c,y=this._startPos,b=this._lastPos;if(!y||!b||b.equals(_)||!this._box&&_.dist(y)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=U("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",n));const S=Math.min(y.x,_.x),M=Math.max(y.x,_.x),P=Math.min(y.y,_.y),z=Math.max(y.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${P}px)`,this._box.style.width=M-S+"px",this._box.style.height=z-P+"px")})}mouseupWindow(n,c){if(!this._active)return;const _=this._startPos,y=c;if(_&&n.button===0){if(this.reset(),Wt(),_.x!==y.x||_.y!==y.y)return this._map.fire(new r.Event("boxzoomend",{originalEvent:n})),{cameraAnimation:b=>b.fitScreenCoordinates(_,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",n)}}keydown(n){this._active&&n.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",n))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Dt(),delete this._startPos,delete this._lastPos}_fireEvent(n,c){return this._map.fire(new r.Event(n,{originalEvent:c}))}}function xl(d,n){const c={};for(let _=0;_<d.length;_++)c[d[_].identifier]=n[_];return c}class lo{constructor(n){this.reset(),this.numTouches=n.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(n,c,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=n.timeStamp),_.length===this.numTouches&&(this.centroid=function(y){const b=new r.Point(0,0);for(const S of y)b._add(S);return b.div(y.length)}(c),this.touches=xl(_,c)))}touchmove(n,c,_){if(this.aborted||!this.centroid)return;const y=xl(_,c);for(const b in this.touches){const S=y[b];(!S||S.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(n,c,_){if((!this.centroid||n.timeStamp-this.startTime>500)&&(this.aborted=!0),_.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class jc{constructor(n){this.singleTap=new lo(n),this.numTaps=n.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(n,c,_){this.singleTap.touchstart(n,c,_)}touchmove(n,c,_){this.singleTap.touchmove(n,c,_)}touchend(n,c,_){const y=this.singleTap.touchend(n,c,_);if(y){const b=n.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(b&&S||this.reset(),this.count++,this.lastTime=n.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Yp{constructor(){this._zoomIn=new jc({numTouches:1,numTaps:2}),this._zoomOut=new jc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(n,c,_){this._zoomIn.touchstart(n,c,_),this._zoomOut.touchstart(n,c,_)}touchmove(n,c,_){this._zoomIn.touchmove(n,c,_),this._zoomOut.touchmove(n,c,_)}touchend(n,c,_){const y=this._zoomIn.touchend(n,c,_),b=this._zoomOut.touchend(n,c,_);return y?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:n})}):b?(this._active=!0,n.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(b)},{originalEvent:n})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Uu={0:1,2:2};class co{constructor(n){this.reset(),this._clickTolerance=n.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(n,c){return!1}_move(n,c){return{}}mousedown(n,c){if(this._lastPoint)return;const _=ne(n);this._correctButton(n,_)&&(this._lastPoint=c,this._eventButton=_)}mousemoveWindow(n,c){const _=this._lastPoint;if(_){if(n.preventDefault(),this._eventButton!=null&&function(y,b){const S=Uu[b];return y.buttons===void 0||(y.buttons&S)!==S}(n,this._eventButton))this.reset();else if(this._moved||!(c.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(_,c)}}mouseupWindow(n){this._lastPoint&&ne(n)===this._eventButton&&(this._moved&&Wt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vc extends co{mousedown(n,c){super.mousedown(n,c),this._lastPoint&&(this._active=!0)}_correctButton(n,c){return c===0&&!n.ctrlKey}_move(n,c){return{around:c,panDelta:c.sub(n)}}}class Uc extends co{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const _=.8*(c.x-n.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(n){n.preventDefault()}}class Gc extends co{_correctButton(n,c){return c===0&&n.ctrlKey||c===2}_move(n,c){const _=-.5*(c.y-n.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(n){n.preventDefault()}}class vl{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),r.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.Point(0,0)}touchstart(n,c,_){return this._calculateTransform(n,c,_)}touchmove(n,c,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(_.length===1&&!r.isFullscreen())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return n.cancelable&&n.preventDefault(),this._calculateTransform(n,c,_)}}touchend(n,c,_){this._calculateTransform(n,c,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(n,c,_){_.length>0&&(this._active=!0);const y=xl(_,c),b=new r.Point(0,0),S=new r.Point(0,0);let M=0;for(const z in y){const L=y[z],N=this._touches[z];N&&(b._add(L),S._add(L.sub(N)),M++,y[z]=L)}if(this._touches=y,M<this._minTouches||!S.mag())return;const P=S.div(M);return this._sum._add(P),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(M),panDelta:P}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class ua{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(n){}_move(n,c,_){return{}}touchstart(n,c,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([c[0],c[1]]))}touchmove(n,c,_){const y=this._firstTwoTouches;if(!y)return;n.preventDefault();const[b,S]=y,M=da(_,c,b),P=da(_,c,S);if(!M||!P)return;const z=this._aroundCenter?null:M.add(P).div(2);return this._move([M,P],z,n)}touchend(n,c,_){if(!this._firstTwoTouches)return;const[y,b]=this._firstTwoTouches,S=da(_,c,y),M=da(_,c,b);S&&M||(this._active&&Wt(),this.reset())}touchcancel(){this.reset()}enable(n){this._enabled=!0,this._aroundCenter=!!n&&n.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function da(d,n,c){for(let _=0;_<d.length;_++)if(d[_].identifier===c)return n[_]}function qc(d,n){return Math.log(d/n)/Math.LN2}class Gu extends ua{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(n){this._startDistance=this._distance=n[0].dist(n[1])}_move(n,c){const _=this._distance;if(this._distance=n[0].dist(n[1]),this._active||!(Math.abs(qc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:qc(this._distance,_),pinchAround:c}}}function $c(d,n){return 180*d.angleWith(n)/Math.PI}class qu extends ua{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(n){this._startVector=this._vector=n[0].sub(n[1]),this._minDiameter=n[0].dist(n[1])}_move(n,c){const _=this._vector;if(this._vector=n[0].sub(n[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:$c(this._vector,_),pinchAround:c}}_isBelowThreshold(n){this._minDiameter=Math.min(this._minDiameter,n.mag());const c=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const y=$c(n,_);return Math.abs(y)<c}}function Js(d){return Math.abs(d.y)>Math.abs(d.x)}class $u extends ua{constructor(n){super(),this._map=n}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(n){this._lastPoints=n,Js(n[0].sub(n[1]))&&(this._valid=!1)}_move(n,c,_){const y=this._lastPoints;if(!y)return;const b=n[0].sub(y[0]),S=n[1].sub(y[1]);return this._map._cooperativeGestures&&!r.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(b,S,_.timeStamp),!this._valid)?void 0:(this._lastPoints=n,this._active=!0,{pitchDelta:(b.y+S.y)/2*-.5})}gestureBeginsVertically(n,c,_){if(this._valid!==void 0)return this._valid;const y=n.mag()>=2,b=c.mag()>=2;if(!y&&!b)return;if(!y||!b)return this._firstMove==null&&(this._firstMove=_),_-this._firstMove<100&&void 0;const S=n.y>0==c.y>0;return Js(n)&&Js(c)&&S}}const Wu={panStep:100,bearingStep:15,pitchStep:10};class Kp{constructor(){const n=Wu;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(n){if(n.altKey||n.ctrlKey||n.metaKey)return;let c=0,_=0,y=0,b=0,S=0;switch(n.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:n.shiftKey?_=-1:(n.preventDefault(),b=-1);break;case 39:n.shiftKey?_=1:(n.preventDefault(),b=1);break;case 38:n.shiftKey?y=1:(n.preventDefault(),S=-1);break;case 40:n.shiftKey?y=-1:(n.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(_=0,y=0),{cameraAnimation:M=>{const P=M.getZoom();M.easeTo({duration:300,easeId:"keyboardHandler",easing:Zu,zoom:c?Math.round(P)+c*(n.shiftKey?2:1):P,bearing:M.getBearing()+_*this._bearingStep,pitch:M.getPitch()+y*this._pitchStep,offset:[-b*this._panStep,-S*this._panStep],center:M.getCenter()},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Zu(d){return d*(2-d)}const Wc=4.000244140625;class Hu{constructor(n,c){this._map=n,this._el=n.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,r.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(n){this._defaultZoomRate=n}setWheelZoomRate(n){this._wheelZoomRate=n}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(n){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!n&&n.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(n){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(n.ctrlKey||n.metaKey||this.isZooming()||r.isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=n.deltaMode===r.window.WheelEvent.DOM_DELTA_LINE?40*n.deltaY:n.deltaY;const _=r.exported.now(),y=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,c!==0&&c%Wc==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,n)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),n.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=n,this._delta-=c,this._active||this._start(n)),n.preventDefault()}_onTimeout(n){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(n)}_start(n){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Rt(this._el,n);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const n=this._map.transform;this._type==="wheel"&&n.projection.wrap&&(n._center.lng>=180||n._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>n._terrainEnabled()&&this._aroundCoord?n.computeZoomRelativeTo(this._aroundCoord):n.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Wc?this._wheelZoomRate:this._defaultZoomRate;let z=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&z!==0&&(z=1/z);const L=c(),N=Math.pow(2,L),$=typeof this._targetZoom=="number"?n.zoomScale(this._targetZoom):N;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom($*z))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._delta=0}const _=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,b=this._easing;let S,M=!1;if(this._type==="wheel"&&y&&b){const P=Math.min((r.exported.now()-this._lastWheelEventTime)/200,1),z=b(P);S=r.number(y,_,z),P<1?this._frameId||(this._frameId=!0):M=!0}else S=_,M=!0;return this._active=!0,M&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!M,zoomDelta:S-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(n){let c=r.ease;if(this._prevEase){const _=this._prevEase,y=(r.exported.now()-_.start)/_.duration,b=_.easing(y+.01)-_.easing(y),S=.27/Math.sqrt(b*b+1e-4)*.01,M=Math.sqrt(.0729-S*S);c=r.bezier(S,M,.25,1)}return this._prevEase={start:r.exported.now(),duration:n,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=U("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(r.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Xu{constructor(n,c){this._clickZoom=n,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class dn{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(n,c){return n.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(n.shiftKey?-1:1),around:_.unproject(c)},{originalEvent:n})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jp{constructor(){this._tap=new jc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(n,c,_){this._swipePoint||(this._tapTime&&n.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=c[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(n,c,_))}touchmove(n,c,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const y=c[0],b=y.y-this._swipePoint.y;return this._swipePoint=y,n.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(n,c,_)}touchend(n,c,_){this._tapTime?this._swipePoint&&_.length===0&&this.reset():this._tap.touchend(n,c,_)&&(this._tapTime=n.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yu{constructor(n,c,_){this._el=n,this._mousePan=c,this._touchPan=_}enable(n){this._inertiaOptions=n||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Qp{constructor(n,c,_){this._pitchWithRotate=n.pitchWithRotate,this._mouseRotate=c,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tf{constructor(n,c,_,y){this._el=n,this._touchZoom=c,this._touchRotate=_,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(n){this._touchZoom.enable(n),this._rotationDisabled||this._touchRotate.enable(n),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const $n=d=>d.zoom||d.drag||d.pitch||d.rotate;class Ku extends r.Event{}class ef{constructor(){this.constants=[1,1,.01],this.radius=0}setup(n,c){const _=r.sub([],c,n);this.radius=r.length(_[2]<0?r.div([],_,this.constants):[_[0],_[1],0])}projectRay(n){r.div(n,n,this.constants),r.normalize(n,n),r.mul$1(n,n,this.constants);const c=r.scale$2([],n,this.radius);if(c[2]>0){const _=r.scale$2([],[0,0,1],r.dot(c,[0,0,1])),y=r.scale$2([],r.normalize([],[c[0],c[1],0]),this.radius),b=r.add([],c,r.scale$2([],r.sub([],r.add([],y,_),c),2));c[0]=b[0],c[1]=b[1]}return c}}function is(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class fs{constructor(n,c){this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ju(n),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ef,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),r.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[r.window.document,"mousemove",{capture:!0}],[r.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[r.window,"blur",void 0]];for(const[y,b,S]of this._listeners)y.addEventListener(b,y===r.window.document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[n,c,_]of this._listeners)n.removeEventListener(c,n===r.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(n){const c=this._map,_=c.getCanvasContainer();this._add("mapEvent",new Nc(c,n));const y=c.boxZoom=new Vu(c,n);this._add("boxZoom",y);const b=new Yp,S=new dn;c.doubleClickZoom=new Xu(S,b),this._add("tapZoom",b),this._add("clickZoom",S);const M=new Jp;this._add("tapDragZoom",M);const P=c.touchPitch=new $u(c);this._add("touchPitch",P);const z=new Uc(n),L=new Gc(n);c.dragRotate=new Qp(n,z,L),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const N=new Vc(n),$=new vl(c,n);c.dragPan=new Yu(_,N,$),this._add("mousePan",N),this._add("touchPan",$,["touchZoom","touchRotate"]);const X=new qu,J=new Gu;c.touchZoomRotate=new tf(_,J,X,M),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",J,["touchPan","touchRotate"]),this._add("blockableMapEvent",new yl(c));const K=c.scrollZoom=new Hu(c,this);this._add("scrollZoom",K,["mousePan"]);const Q=c.keyboard=new Kp;this._add("keyboard",Q);for(const j of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])n.interactive&&n[j]&&c[j].enable(n[j])}_add(n,c,_){this._handlers.push({handlerName:n,handler:c,allowed:_}),this._handlersById[n]=c}stop(n){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},n),this._changes=[]}}isActive(){for(const{handler:n}of this._handlers)if(n.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!$n(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(n,c,_){for(const y in n)if(y!==_&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(n){this.handleEvent(n,`${n.type}Window`)}_getMapTouches(n){const c=[];for(const _ of n)this._el.contains(_.target)&&c.push(_);return c}handleEvent(n,c){this._updatingCamera=!0;const _=n.type==="renderFrame",y=_?void 0:n,b={needsRenderFrame:!1},S={},M={},P=n.touches?this._getMapTouches(n.touches):void 0,z=P?Jt(this._el,P):_?void 0:Rt(this._el,n);for(const{handlerName:$,handler:X,allowed:J}of this._handlers){if(!X.isEnabled())continue;let K;this._blockedByActive(M,J,$)?X.reset():X[c||n.type]&&(K=X[c||n.type](n,z,P),this.mergeHandlerResult(b,S,K,$,y),K&&K.needsRenderFrame&&this._triggerRenderFrame()),(K||X.isActive())&&(M[$]=X)}const L={};for(const $ in this._previousActiveHandlers)M[$]||(L[$]=y);this._previousActiveHandlers=M,(Object.keys(L).length||is(b))&&(this._changes.push([b,S,L]),this._triggerRenderFrame()),(Object.keys(M).length||is(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:N}=b;N&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],N(this._map))}mergeHandlerResult(n,c,_,y,b){if(!_)return;r.extend(n,_);const S={handlerName:y,originalEvent:_.originalEvent||b};_.zoomDelta!==void 0&&(c.zoom=S),_.panDelta!==void 0&&(c.drag=S),_.pitchDelta!==void 0&&(c.pitch=S),_.bearingDelta!==void 0&&(c.rotate=S)}_applyChanges(){const n={},c={},_={};for(const[y,b,S]of this._changes)y.panDelta&&(n.panDelta=(n.panDelta||new r.Point(0,0))._add(y.panDelta)),y.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(n.around=y.around),y.aroundCoord!==void 0&&(n.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(n.pinchAround=y.pinchAround),y.noInertia&&(n.noInertia=y.noInertia),r.extend(c,b),r.extend(_,S);this._updateMapTransform(n,c,_),this._changes=[]}_updateMapTransform(n,c,_){const y=this._map,b=y.transform,S=H=>[H.x,H.y,H.z];if((H=>{const nt=this._eventsInProgress.drag;return nt&&!this._handlersById[nt.handlerName].isActive()})()&&!is(n)){const H=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",H!==b.zoom&&this._map._update(!0)}if(b._isCameraConstrained&&y._stop(!0),!is(n))return void this._fireEvents(c,_,!0);let{panDelta:M,zoomDelta:P,bearingDelta:z,pitchDelta:L,around:N,aroundCoord:$,pinchAround:X}=n;b._isCameraConstrained&&(P>0&&(P=0),b._isCameraConstrained=!1),X!==void 0&&(N=X),(P||(H=>c[H]&&!this._eventsInProgress[H])("drag"))&&N&&(this._dragOrigin=S(b.pointCoordinate3D(N)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",y._stop(!0),N=N||y.transform.centerPoint,z&&(b.bearing+=z),L&&(b.pitch+=L),b._updateCameraState();const J=[0,0,0];if(M)if(b.projection.name==="mercator"){const H=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N).dir),nt=this._trackingEllipsoid.projectRay(b.screenPointToMercatorRay(N.sub(M)).dir);J[0]=nt[0]-H[0],J[1]=nt[1]-H[1]}else{const H=b.pointCoordinate(N);if(b.projection.name==="globe"){M=M.rotate(-b.angle);const nt=b._pixelsPerMercatorPixel/b.worldSize;J[0]=-M.x*r.mercatorScale(r.latFromMercatorY(H.y))*nt,J[1]=-M.y*r.mercatorScale(b.center.lat)*nt}else{const nt=b.pointCoordinate(N.sub(M));H&&nt&&(J[0]=nt.x-H.x,J[1]=nt.y-H.y)}}const K=b.zoom,Q=[0,0,0];if(P){const H=S($||b.pointCoordinate3D(N)),nt={dir:r.normalize([],r.sub([],H,b._camera.position))};if(nt.dir[2]<0){const st=b.zoomDeltaToMovement(H,P);r.scale$2(Q,nt.dir,st)}}const j=r.add(J,J,Q);b._translateCameraConstrained(j),P&&Math.abs(b.zoom-K)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),n.noInertia||this._inertia.record(n),this._fireEvents(c,_,!0)}_fireEvents(n,c,_){const y=$n(this._eventsInProgress),b=$n(n),S={};for(const L in n){const{originalEvent:N}=n[L];this._eventsInProgress[L]||(S[`${L}start`]=N),this._eventsInProgress[L]=n[L]}!y&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in S)this._fireEvent(L,S[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in n){const{originalEvent:N}=n[L];this._fireEvent(L,N)}const M={};let P;for(const L in this._eventsInProgress){const{handlerName:N,originalEvent:$}=this._eventsInProgress[L];this._handlersById[N].isActive()||(delete this._eventsInProgress[L],P=c[N]||$,M[`${L}end`]=P)}for(const L in M)this._fireEvent(L,M[L]);const z=$n(this._eventsInProgress);if(_&&(y||b)&&!z){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),N=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;L?(N(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:P})):(this._map.fire(new r.Event("moveend",{originalEvent:P})),N(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(n,c){this._map.fire(new r.Event(n,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(n=>{this._frameId=void 0,this.handleEvent(new Ku("renderFrame",{timeStamp:n})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Tr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class bl extends r.Evented{constructor(n,c){super(),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,r.bindAll(["_renderFrameCallback"],this)}getCenter(){return new r.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(n,c){return this.jumpTo({center:n},c)}panBy(n,c,_){return n=r.Point.convert(n).mult(-1),this.panTo(this.transform.center,r.extend({offset:n},c),_)}panTo(n,c,_){return this.easeTo(r.extend({center:n},c),_)}getZoom(){return this.transform.zoom}setZoom(n,c){return this.jumpTo({zoom:n},c),this}zoomTo(n,c,_){return this.easeTo(r.extend({zoom:n},c),_)}zoomIn(n,c){return this.zoomTo(this.getZoom()+1,n,c),this}zoomOut(n,c){return this.zoomTo(this.getZoom()-1,n,c),this}getBearing(){return this.transform.bearing}setBearing(n,c){return this.jumpTo({bearing:n},c),this}getPadding(){return this.transform.padding}setPadding(n,c){return this.jumpTo({padding:n},c),this}rotateTo(n,c,_){return this.easeTo(r.extend({bearing:n},c),_)}resetNorth(n,c){return this.rotateTo(0,r.extend({duration:1e3},n),c),this}resetNorthPitch(n,c){return this.easeTo(r.extend({bearing:0,pitch:0,duration:1e3},n),c),this}snapToNorth(n,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(n,c):this}getPitch(){return this.transform.pitch}setPitch(n,c){return this.jumpTo({pitch:n},c),this}cameraForBounds(n,c){n=r.LngLatBounds.convert(n);const _=c&&c.bearing||0,y=c&&c.pitch||0,b=n.getNorthWest(),S=n.getSouthEast();return this._cameraForBounds(this.transform,b,S,_,y,c)}_extendCameraOptions(n){const c={top:0,bottom:0,right:0,left:0};if(typeof(n=r.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},n)).padding=="number"){const _=n.padding;n.padding={top:_,bottom:_,right:_,left:_}}return n.padding=r.extend(c,n.padding),n}_minimumAABBFrustumDistance(n,c){const _=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return _/y>n.aspect?_/(2*Math.tan(.5*n.fovX)*n.aspect):y/(2*Math.tan(.5*n.fovY)*n.aspect)}_cameraForBoundsOnGlobe(n,c,_,y,b,S){const M=n.clone(),P=this._extendCameraOptions(S);M.bearing=y,M.pitch=b;const z=r.LngLat.convert(c),L=r.LngLat.convert(_),N=.5*(z.lat+L.lat),$=.5*(z.lng+L.lng),X=r.latLngToECEF(N,$),J=r.normalize([],X),K=r.normalize([],r.cross([],J,[0,1,0])),Q=r.cross([],K,J),j=[K[0],K[1],K[2],0,Q[0],Q[1],Q[2],0,J[0],J[1],J[2],0,0,0,0,1],H=[X,r.latLngToECEF(z.lat,z.lng),r.latLngToECEF(L.lat,z.lng),r.latLngToECEF(L.lat,L.lng),r.latLngToECEF(z.lat,L.lng),r.latLngToECEF(N,z.lng),r.latLngToECEF(N,L.lng),r.latLngToECEF(z.lat,$),r.latLngToECEF(L.lat,$)];let nt=r.Aabb.fromPoints(H.map(Gt=>[r.dot(K,Gt),r.dot(Q,Gt),r.dot(J,Gt)]));const st=r.transformMat4([],nt.center,j);r.squaredLength(st)===0&&r.set(st,0,0,1),r.normalize(st,st),r.scale$2(st,st,r.GLOBE_RADIUS),M.center=r.ecefToLatLng(st);const ft=M.getWorldToCameraMatrix(),mt=r.invert(new Float64Array(16),ft);nt=r.Aabb.applyTransform(nt,r.multiply([],ft,j)),r.transformMat4(st,st,ft);const _t=.5*(nt.max[2]-nt.min[2]),vt=this._minimumAABBFrustumDistance(M,nt),xt=r.scale$2([],[0,0,1],_t),At=r.add(xt,st,xt),Zt=vt+(M.pitch===0?0:r.distance(st,At)),Et=M.globeCenterInViewSpace,jt=r.sub([],st,[Et[0],Et[1],Et[2]]);r.normalize(jt,jt),r.scale$2(jt,jt,Zt);const It=r.add([],st,jt);r.transformMat4(It,It,mt);const $t=r.earthRadius/r.GLOBE_RADIUS,Mt=r.length(It),Nt=r.mercatorZfromAltitude(Math.max(Mt*$t-r.earthRadius,Number.EPSILON),0),Xt=Math.min(M.zoomFromMercatorZAdjusted(Nt),P.maxZoom);return Xt>.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"mercator"}),M.zoom=Xt,this._cameraForBounds(M,c,_,y,b,S)):{center:M.center,zoom:Xt,bearing:y,pitch:b}}queryTerrainElevation(n,c){const _=this.transform.elevation;return _?(c=r.extend({},{exaggerated:!0},c),_.getAtPoint(r.MercatorCoordinate.fromLngLat(n),null,c.exaggerated)):null}_cameraForBounds(n,c,_,y,b,S){if(n.projection.name==="globe")return this._cameraForBoundsOnGlobe(n,c,_,y,b,S);const M=n.clone(),P=this._extendCameraOptions(S),z=M.padding;M.bearing=y,M.pitch=b;const L=r.LngLat.convert(c),N=r.LngLat.convert(_),$=new r.LngLat(L.lng,N.lat),X=new r.LngLat(N.lng,L.lat),J=M.project(L),K=M.project(N),Q=this.queryTerrainElevation(L),j=this.queryTerrainElevation(N),H=this.queryTerrainElevation($),nt=this.queryTerrainElevation(X),st=[[J.x,J.y,Math.min(Q||0,j||0,H||0,nt||0)],[K.x,K.y,Math.max(Q||0,j||0,H||0,nt||0)]];let ft=r.Aabb.fromPoints(st);const mt=M.getWorldToCameraMatrix(),_t=r.invert(new Float64Array(16),mt);ft=r.Aabb.applyTransform(ft,mt);const vt=r.sub([],ft.max,ft.min),xt=z.left||0,At=z.right||0,Zt=z.bottom||0,Et=z.top||0,{left:jt,right:It,top:$t,bottom:Mt}=P.padding,Nt=.5*(xt+At),Xt=.5*(Et+Zt),Gt=Math.min(M.scaleZoom(M.scale*Math.min((M.width-(xt+At+jt+It))/vt[0],(M.height-(Zt+Et+Mt+$t))/vt[1])),P.maxZoom),Yt=M.scale/M.zoomScale(Gt);ft=new r.Aabb([ft.min[0]-(jt+Nt)*Yt,ft.min[1]-(Mt+Xt)*Yt,ft.min[2]],[ft.max[0]+(It+Nt)*Yt,ft.max[1]+($t+Xt)*Yt,ft.max[2]]);const me=.5*vt[2],we=this._minimumAABBFrustumDistance(M,ft),de=[0,0,1,0];r.transformMat4$1(de,de,mt),r.normalize$2(de,de);const xe=r.scale$2([],de,we+me),Be=r.add([],ft.center,xe),De=(typeof P.offset.x=="number"&&typeof P.offset.y=="number"?new r.Point(P.offset.x,P.offset.y):r.Point.convert(P.offset)).rotate(-r.degToRad(y));ft.center[0]-=De.x*Yt,ft.center[1]+=De.y*Yt,r.transformMat4(ft.center,ft.center,_t),r.transformMat4(Be,Be,_t);const _e=[ft.center[0],ft.center[1],Be[2]*M.pixelsPerMeter];r.scale$2(_e,_e,1/M.worldSize);const Je=r.lngFromMercatorX(_e[0]),ii=r.latFromMercatorY(_e[1]),ni=Math.min(M._zoomFromMercatorZ(_e[2]),P.maxZoom),si=new r.LngLat(Je,ii);return M.mercatorFromTransition&&ni<.5*(r.GLOBE_ZOOM_THRESHOLD_MIN+r.GLOBE_ZOOM_THRESHOLD_MAX)?(M.setProjection({name:"globe"}),M.zoom=ni,this._cameraForBounds(M,c,_,y,b,S)):{center:si,zoom:ni,bearing:y,pitch:b}}fitBounds(n,c,_){const y=this.cameraForBounds(n,c);return this._fitInternal(y,c,_)}fitScreenCoordinates(n,c,_,y,b){const S=r.Point.convert(n),M=r.Point.convert(c),P=new r.Point(Math.min(S.x,M.x),Math.min(S.y,M.y)),z=new r.Point(Math.max(S.x,M.x),Math.max(S.y,M.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,M))return this;const L=this.transform.pointLocation3D(P),N=this.transform.pointLocation3D(z),$=this.transform.pointLocation3D(new r.Point(P.x,z.y)),X=this.transform.pointLocation3D(new r.Point(z.x,P.y)),J=[Math.min(L.lng,N.lng,$.lng,X.lng),Math.min(L.lat,N.lat,$.lat,X.lat)],K=[Math.max(L.lng,N.lng,$.lng,X.lng),Math.max(L.lat,N.lat,$.lat,X.lat)],Q=y&&y.pitch?y.pitch:this.getPitch(),j=this._cameraForBounds(this.transform,J,K,_,Q,y);return this._fitInternal(j,y,b)}_fitInternal(n,c,_){return n?(delete(c=r.extend(n,c)).padding,c.linear?this.easeTo(c,_):this.flyTo(c,_)):this}jumpTo(n,c){this.stop();const _=n.preloadOnly?this.transform.clone():this.transform;let y=!1,b=!1,S=!1;return"zoom"in n&&_.zoom!==+n.zoom&&(y=!0,_.zoom=+n.zoom),n.center!==void 0&&(_.center=r.LngLat.convert(n.center)),"bearing"in n&&_.bearing!==+n.bearing&&(b=!0,_.bearing=+n.bearing),"pitch"in n&&_.pitch!==+n.pitch&&(S=!0,_.pitch=+n.pitch),n.padding==null||_.isPaddingEqual(n.padding)||(_.padding=n.padding),n.preloadOnly?(this._preloadTiles(_),this):(this.fire(new r.Event("movestart",c)).fire(new r.Event("move",c)),y&&this.fire(new r.Event("zoomstart",c)).fire(new r.Event("zoom",c)).fire(new r.Event("zoomend",c)),b&&this.fire(new r.Event("rotatestart",c)).fire(new r.Event("rotate",c)).fire(new r.Event("rotateend",c)),S&&this.fire(new r.Event("pitchstart",c)).fire(new r.Event("pitch",c)).fire(new r.Event("pitchend",c)),this.fire(new r.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.warnOnce(Tr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(n,c){const _=this.transform;if(!_.projection.supportsFreeCamera)return r.warnOnce(Tr),this;this.stop();const y=_.zoom,b=_.pitch,S=_.bearing;_.setFreeCameraOptions(n);const M=y!==_.zoom,P=b!==_.pitch,z=S!==_.bearing;return this.fire(new r.Event("movestart",c)).fire(new r.Event("move",c)),M&&this.fire(new r.Event("zoomstart",c)).fire(new r.Event("zoom",c)).fire(new r.Event("zoomend",c)),z&&this.fire(new r.Event("rotatestart",c)).fire(new r.Event("rotate",c)).fire(new r.Event("rotateend",c)),P&&this.fire(new r.Event("pitchstart",c)).fire(new r.Event("pitch",c)).fire(new r.Event("pitchend",c)),this.fire(new r.Event("moveend",c)),this}easeTo(n,c){this._stop(!1,n.easeId),((n=r.extend({offset:[0,0],duration:500,easing:r.ease},n)).animate===!1||this._prefersReducedMotion(n))&&(n.duration=0);const _=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),M=this.getPadding(),P="zoom"in n?+n.zoom:y,z="bearing"in n?this._normalizeBearing(n.bearing,b):b,L="pitch"in n?+n.pitch:S,N="padding"in n?n.padding:_.padding,$=r.Point.convert(n.offset);let X,J,K;if(_.projection.name==="globe"){const xt=r.MercatorCoordinate.fromLngLat(_.center),At=$.rotate(-_.angle);xt.x+=At.x/_.worldSize,xt.y+=At.y/_.worldSize;const Zt=xt.toLngLat(),Et=r.LngLat.convert(n.center||Zt);this._normalizeCenter(Et),X=_.centerPoint.add(At),J=new r.Point(xt.x,xt.y).mult(_.worldSize),K=new r.Point(r.mercatorXfromLng(Et.lng),r.mercatorYfromLat(Et.lat)).mult(_.worldSize).sub(J)}else{X=_.centerPoint.add($);const xt=_.pointLocation(X),At=r.LngLat.convert(n.center||xt);this._normalizeCenter(At),J=_.project(xt),K=_.project(At).sub(J)}const Q=_.zoomScale(P-y);let j,H;n.around&&(j=r.LngLat.convert(n.around),H=_.locationPoint(j));const nt=this._zooming||P!==y,st=this._rotating||b!==z,ft=this._pitching||L!==S,mt=!_.isPaddingEqual(N),_t=xt=>At=>{if(nt&&(xt.zoom=r.number(y,P,At)),st&&(xt.bearing=r.number(b,z,At)),ft&&(xt.pitch=r.number(S,L,At)),mt&&(xt.interpolatePadding(M,N,At),X=xt.centerPoint.add($)),j)xt.setLocationAtPoint(j,H);else{const Zt=xt.zoomScale(xt.zoom-y),Et=P>y?Math.min(2,Q):Math.max(.5,Q),jt=Math.pow(Et,1-At),It=xt.unproject(J.add(K.mult(At*jt)).mult(Zt));xt.setLocationAtPoint(xt.renderWorldCopies?It.wrap():It,X)}return n.preloadOnly||this._fireMoveEvents(c),xt};if(n.preloadOnly){const xt=this._emulate(_t,n.duration,_);return this._preloadTiles(xt),this}const vt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=nt,this._rotating=st,this._pitching=ft,this._padding=mt,this._easeId=n.easeId,this._prepareEase(c,n.noMoveStart,vt),this._ease(_t(_),xt=>{_.recenterOnTerrain(),this._afterEase(c,xt)},n),this}_prepareEase(n,c,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||_.moving||this.fire(new r.Event("movestart",n)),this._zooming&&!_.zooming&&this.fire(new r.Event("zoomstart",n)),this._rotating&&!_.rotating&&this.fire(new r.Event("rotatestart",n)),this._pitching&&!_.pitching&&this.fire(new r.Event("pitchstart",n))}_fireMoveEvents(n){this.fire(new r.Event("move",n)),this._zooming&&this.fire(new r.Event("zoom",n)),this._rotating&&this.fire(new r.Event("rotate",n)),this._pitching&&this.fire(new r.Event("pitch",n))}_afterEase(n,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,y=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new r.Event("zoomend",n)),y&&this.fire(new r.Event("rotateend",n)),b&&this.fire(new r.Event("pitchend",n)),this.fire(new r.Event("moveend",n))}flyTo(n,c){if(this._prefersReducedMotion(n)){const Gt=r.pick(n,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Gt,c)}this.stop(),n=r.extend({offset:[0,0],speed:1.2,curve:1.42,easing:r.ease},n);const _=this.transform,y=this.getZoom(),b=this.getBearing(),S=this.getPitch(),M=this.getPadding(),P="zoom"in n?r.clamp(+n.zoom,_.minZoom,_.maxZoom):y,z="bearing"in n?this._normalizeBearing(n.bearing,b):b,L="pitch"in n?+n.pitch:S,N="padding"in n?n.padding:_.padding,$=_.zoomScale(P-y),X=r.Point.convert(n.offset);let J=_.centerPoint.add(X);const K=_.pointLocation(J),Q=r.LngLat.convert(n.center||K);this._normalizeCenter(Q);const j=_.project(K),H=_.project(Q).sub(j);let nt=n.curve;const st=Math.max(_.width,_.height),ft=st/$,mt=H.mag();if("minZoom"in n){const Gt=r.clamp(Math.min(n.minZoom,y,P),_.minZoom,_.maxZoom),Yt=st/_.zoomScale(Gt-y);nt=Math.sqrt(Yt/mt*2)}const _t=nt*nt;function vt(Gt){const Yt=(ft*ft-st*st+(Gt?-1:1)*_t*_t*mt*mt)/(2*(Gt?ft:st)*_t*mt);return Math.log(Math.sqrt(Yt*Yt+1)-Yt)}function xt(Gt){return(Math.exp(Gt)-Math.exp(-Gt))/2}function At(Gt){return(Math.exp(Gt)+Math.exp(-Gt))/2}const Zt=vt(0);let Et=function(Gt){return At(Zt)/At(Zt+nt*Gt)},jt=function(Gt){return st*((At(Zt)*(xt(Yt=Zt+nt*Gt)/At(Yt))-xt(Zt))/_t)/mt;var Yt},It=(vt(1)-Zt)/nt;if(Math.abs(mt)<1e-6||!isFinite(It)){if(Math.abs(st-ft)<1e-6)return this.easeTo(n,c);const Gt=ft<st?-1:1;It=Math.abs(Math.log(ft/st))/nt,jt=function(){return 0},Et=function(Yt){return Math.exp(Gt*nt*Yt)}}n.duration="duration"in n?+n.duration:1e3*It/("screenSpeed"in n?+n.screenSpeed/nt:+n.speed),n.maxDuration&&n.duration>n.maxDuration&&(n.duration=0);const $t=b!==z,Mt=L!==S,Nt=!_.isPaddingEqual(N),Xt=Gt=>Yt=>{const me=Yt*It,we=1/Et(me);Gt.zoom=Yt===1?P:y+Gt.scaleZoom(we),$t&&(Gt.bearing=r.number(b,z,Yt)),Mt&&(Gt.pitch=r.number(S,L,Yt)),Nt&&(Gt.interpolatePadding(M,N,Yt),J=Gt.centerPoint.add(X));const de=Yt===1?Q:Gt.unproject(j.add(H.mult(jt(me))).mult(we));return Gt.setLocationAtPoint(Gt.renderWorldCopies?de.wrap():de,J),Gt._updateCameraOnTerrain(),n.preloadOnly||this._fireMoveEvents(c),Gt};if(n.preloadOnly){const Gt=this._emulate(Xt,n.duration,_);return this._preloadTiles(Gt),this}return this._zooming=!0,this._rotating=$t,this._pitching=Mt,this._padding=Nt,this._prepareEase(c,!1),this._ease(Xt(_),()=>this._afterEase(c),n),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(n,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,c)}if(!n){const _=this.handlers;_&&_.stop(!1)}return this}_ease(n,c,_){_.animate===!1||_.duration===0?(n(1),c()):(this._easeStart=r.exported.now(),this._easeOptions=_,this._onEaseFrame=n,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const n=Math.min((r.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(n)),n<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(n,c){n=r.wrap(n,-180,180);const _=Math.abs(n-c);return Math.abs(n-360-c)<_&&(n-=360),Math.abs(n+360-c)<_&&(n+=360),n}_normalizeCenter(n){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const _=n.lng-c.center.lng;n.lng+=_>180?-360:_<-180?360:0}_prefersReducedMotion(n){return this._respectPrefersReducedMotion&&r.exported.prefersReducedMotion&&!(n&&n.essential)}_emulate(n,c,_){const y=Math.ceil(15*c/1e3),b=[],S=n(_.clone());for(let M=0;M<=y;M++){const P=S(M/y);b.push(P.clone())}return b}}class he{constructor(n={}){this.options=n,r.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(n){const c=this.options&&this.options.compact;return this._map=n,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=U("button","mapboxgl-ctrl-attrib-button",this._container),U("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=U("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(n,c){const _=this._map._getUIString(`AttributionControl.${c}`);n.setAttribute("aria-label",_),n.removeAttribute("title"),n.firstElementChild&&n.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let n=this._editLink;n||(n=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.config.ACCESS_TOKEN}];if(n){const _=c.reduce((y,b,S)=>(b.value&&(y+=`${b.key}=${b.value}${S<c.length-1?"&":""}`),y),"?");n.href=`${r.config.FEEDBACK_URL}/${_}#${oa(this._map,!0)}`,n.rel="noopener nofollow",this._setElementTitle(n,"MapFeedback")}}_updateData(n){!n||n.sourceDataType!=="metadata"&&n.sourceDataType!=="visibility"&&n.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let n=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._sourceCaches;for(const y in c){const b=c[y];if(b.used){const S=b.getSource();S.attribution&&n.indexOf(S.attribution)<0&&n.push(S.attribution)}}n.sort((y,b)=>y.length-b.length),n=n.filter((y,b)=>{for(let S=b+1;S<n.length;S++)if(n[S].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?n=[...this.options.customAttribution,...n]:n.unshift(this.options.customAttribution));const _=n.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,n.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Zc{constructor(){r.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(n){this._map=n,this._container=U("div","mapboxgl-ctrl");const c=U("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(n){n&&n.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const n=this._map.style._sourceCaches;if(Object.entries(n).length===0)return!0;for(const c in n){const _=n[c].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const n=this._container.children;if(n.length){const c=n[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Hc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(n){const c=++this._id;return this._queue.push({callback:n,id:c,cancelled:!1}),c}remove(n){const c=this._currentlyRunning,_=c?this._queue.concat(c):this._queue;for(const y of _)if(y.id===n)return void(y.cancelled=!0)}run(n=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const _ of c)if(!_.cancelled&&(_.callback(n),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ho(d,n,c){if(d=new r.LngLat(d.lng,d.lat),n){const _=new r.LngLat(d.lng-360,d.lat),y=new r.LngLat(d.lng+360,d.lat),b=360*Math.ceil(Math.abs(d.lng-c.center.lng)/360),S=c.locationPoint(d).distSqr(n),M=n.x<0||n.y<0||n.x>c.width||n.y>c.height;c.locationPoint(_).distSqr(n)<S&&(M||Math.abs(_.lng-c.center.lng)<b)?d=_:c.locationPoint(y).distSqr(n)<S&&(M||Math.abs(y.lng-c.center.lng)<b)&&(d=y)}for(;Math.abs(d.lng-c.center.lng)>180;){const _=c.locationPoint(d);if(_.x>=0&&_.y>=0&&_.x<=c.width&&_.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}const Er={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ae extends r.Evented{constructor(n,c){if(super(),(n instanceof r.window.HTMLElement||c)&&(n=r.extend({element:n},c)),r.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=n&&n.anchor||"center",this._color=n&&n.color||"#3FB1CE",this._scale=n&&n.scale||1,this._draggable=n&&n.draggable||!1,this._clickTolerance=n&&n.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=n&&n.rotation||0,this._rotationAlignment=n&&n.rotationAlignment||"auto",this._pitchAlignment=n&&n.pitchAlignment&&n.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=n&&n.occludedOpacity||.2,n&&n.element)this._element=n.element,this._offset=r.Point.convert(n&&n.offset||[0,0]);else{this._defaultMarker=!0,this._element=U("div");const y=41,b=27,S=Y("svg",{display:"block",height:y*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${y}`},this._element),M=Y("radialGradient",{id:"shadowGradient"},Y("defs",{},S));Y("stop",{offset:"10%","stop-opacity":.4},M),Y("stop",{offset:"100%","stop-opacity":.05},M),Y("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},S),Y("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},S),Y("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},S),Y("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},S),this._offset=r.Point.convert(n&&n.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",y=>{y.preventDefault()}),this._element.addEventListener("mousedown",y=>{y.preventDefault()});const _=this._element.classList;for(const y in Er)_.remove(`mapboxgl-marker-anchor-${y}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(n){return n===this._map||(this.remove(),this._map=n,n.getCanvasContainer().appendChild(this._element),n.on("move",this._updateMoving),n.on("moveend",this._update),n.on("remove",this._clearFadeTimer),n._addMarker(this),this.setDraggable(this._draggable),this._update(),n.on("click",this._onMapClick)),this}remove(){const n=this._map;return n&&(n.off("click",this._onMapClick),n.off("move",this._updateMoving),n.off("moveend",this._update),n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler),n.off("mouseup",this._onUp),n.off("touchend",this._onUp),n.off("mousemove",this._onMove),n.off("touchmove",this._onMove),n.off("remove",this._clearFadeTimer),n._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(n){return this._lngLat=r.LngLat.convert(n),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(n){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),n){if(!("offset"in n.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);n.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=n,n._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(n){const c=n.code,_=n.charCode||n.keyCode;c!=="Space"&&c!=="Enter"&&_!==32&&_!==13||this.togglePopup()}_onMapClick(n){const c=n.originalEvent.target,_=this._element;this._popup&&(c===_||_.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const n=this._popup;return n?(n.isOpen()?(n.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(n.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const n=this._map,c=this._pos;if(!n||!c)return!1;const _=n.unproject(c),y=n.getFreeCameraOptions();if(!y.position)return!1;const b=y.position.toLngLat();return b.distanceTo(_)<.9*b.distanceTo(this._lngLat)}_evaluateOpacity(){const n=this._map;if(!n)return;const c=this._pos;if(!c||c.x<0||c.x>n.transform.width||c.y<0||c.y>n.transform.height)return void this._clearFadeTimer();const _=n.unproject(c);let y;n._showingGlobe()&&r.isLngLatBehindGlobe(n.transform,this._lngLat)?y=0:(y=1-n._queryFogOpacity(_),n.transform._terrainEnabled()&&n.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const n=this._pos;if(!n||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${n.x}px,${n.y}px)
            ${Er[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const n=this._pos,c=this._map,_=this.getPitchAlignment();if(!c||!n||_!=="map")return"";if(!c._showingGlobe()){const P=c.getPitch();return P?`rotateX(${P}deg)`:""}const y=r.radToDeg(r.globeTiltAtLngLat(c.transform,this._lngLat)),b=n.sub(r.globeCenterToScreenPoint(c.transform)),S=Math.abs(b.x)+Math.abs(b.y);if(S===0)return"";const M=y/S;return`rotateX(${-b.y*M}deg) rotateY(${b.x*M}deg)`}_calculateZTransform(){const n=this._pos,c=this._map;if(!c||!n)return"";let _=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const b=c.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),S=c.project(new r.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(b);_=r.radToDeg(Math.atan2(S.y,S.x))-90}else _=-c.getBearing();else if(y==="horizon"){const b=r.smoothstep(4,6,c.getZoom()),S=r.globeCenterToScreenPoint(c.transform);S.y+=b*c.transform.height;const M=n.sub(S),P=r.radToDeg(Math.atan2(M.y,M.x));_=(P>90?P-270:P+90)*(1-b)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(n){r.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=ho(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),n===!0?this._updateFrameId=r.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(n){return this._offset=r.Point.convert(n),this._update(),this}_onMove(n){const c=this._map;if(!c)return;const _=this._pointerdownPos,y=this._positionDelta;if(_&&y){if(!this._isDragging){const b=this._clickTolerance||c._clickTolerance;if(n.point.dist(_)<b)return;this._isDragging=!0}this._pos=n.point.sub(y),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.Event("dragstart"))),this.fire(new r.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const n=this._map;n&&(n.off("mousemove",this._onMove),n.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.Event("dragend")),this._state="inactive"}_addDragHandler(n){const c=this._map,_=this._pos;c&&_&&this._element.contains(n.originalEvent.target)&&(n.preventDefault(),this._positionDelta=n.point.sub(_),this._pointerdownPos=n.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(n){this._draggable=!!n;const c=this._map;return c&&(n?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(n){return this._rotation=n||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(n){return this._rotationAlignment=n||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(n){return this._pitchAlignment=n||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(n){return this._occludedOpacity=n||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Xc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},nf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Ju(d=new r.Point(0,0),n="bottom"){if(typeof d=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(d,2)));switch(n){case"top":return new r.Point(0,d);case"top-left":return new r.Point(c,c);case"top-right":return new r.Point(-c,c);case"bottom":return new r.Point(0,-d);case"bottom-left":return new r.Point(c,-c);case"bottom-right":return new r.Point(-c,-c);case"left":return new r.Point(d,0);case"right":return new r.Point(-d,0)}return new r.Point(0,0)}return d instanceof r.Point||Array.isArray(d)?r.Point.convert(d):r.Point.convert(d[n]||[0,0])}class Yc{constructor(n){this.jumpTo(n)}getValue(n){if(n<=this._startTime)return this._start;if(n>=this._endTime)return this._end;const c=r.easeCubicInOut((n-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(n){return n>=this._startTime&&n<=this._endTime}jumpTo(n){this._startTime=-1/0,this._endTime=-1/0,this._start=n,this._end=n}easeTo(n,c,_){this._start=this.getValue(c),this._end=n,this._startTime=c,this._endTime=c+_}}const Qu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},td={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},sf={showCompass:!0,showZoom:!0,visualizePitch:!1};class rf{constructor(n,c,_=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new Uc({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,_&&(this.mousePitch=new Gc({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),r.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(n,c){this.mouseRotate.mousedown(n,c),this.mousePitch&&this.mousePitch.mousedown(n,c),bt()}move(n,c){const _=this.map,y=this.mouseRotate.mousemoveWindow(n,c),b=y&&y.bearingDelta;if(b&&_.setBearing(_.getBearing()+b),this.mousePitch){const S=this.mousePitch.mousemoveWindow(n,c),M=S&&S.pitchDelta;M&&_.setPitch(_.getPitch()+M)}}off(){const n=this.element;n.removeEventListener("mousedown",this.mousedown),n.removeEventListener("touchstart",this.touchstart,{passive:!1}),n.removeEventListener("touchmove",this.touchmove),n.removeEventListener("touchend",this.touchend),n.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Dt(),r.window.removeEventListener("mousemove",this.mousemove),r.window.removeEventListener("mouseup",this.mouseup)}mousedown(n){this.down(r.extend({},n,{ctrlKey:!0,preventDefault:()=>n.preventDefault()}),Rt(this.element,n)),r.window.addEventListener("mousemove",this.mousemove),r.window.addEventListener("mouseup",this.mouseup)}mousemove(n){this.move(n,Rt(this.element,n))}mouseup(n){this.mouseRotate.mouseupWindow(n),this.mousePitch&&this.mousePitch.mouseupWindow(n),this.offTemp()}touchstart(n){n.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Jt(this.element,n.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>n.preventDefault()},this._startPos))}touchmove(n){n.targetTouches.length!==1?this.reset():(this._lastPos=Jt(this.element,n.targetTouches)[0],this.move({preventDefault:()=>n.preventDefault()},this._lastPos))}touchend(n){n.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Kc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Jc={maxWidth:100,unit:"metric"},Qc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},uo={version:r.version,supported:I,setRTLTextPlugin:r.setRTLTextPlugin,getRTLTextPluginStatus:r.getRTLTextPluginStatus,Map:class extends bl{constructor(d){if(r.LivePerformanceUtils.mark(r.PerformanceMarkers.create),(d=r.extend({},td,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(d.antialias&&r.isSafariWithAntialiasingBug(r.window)&&(d.antialias=!1,r.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new oo(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),d),this._interactive=d.interactive,this._minTileCacheSize=d.minTileCacheSize,this._maxTileCacheSize=d.maxTileCacheSize,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._useWebGL2=d.useWebGL2,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=d.crossSourceCollisions,this._collectResourceTiming=d.collectResourceTiming,this._optimizeForTerrain=d.optimizeForTerrain,this._language=this._parseLanguage(d.language),this._worldview=d.worldview,this._renderTaskQueue=new Hc,this._domRenderTaskQueue=new Hc,this._controls=[],this._markers=[],this._popups=[],this._mapId=r.uniqueId(),this._locale=r.extend({},Qu,d.locale),this._clickTolerance=d.clickTolerance,this._cooperativeGestures=d.cooperativeGestures,this._performanceMetricsCollection=d.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Yc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new r.RequestManager(d.transformRequest,d.accessToken,d.testMode),this._silenceAuthErrors=!!d.testMode,typeof d.container=="string"){if(this._container=r.window.document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof r.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(this._container.childNodes.length>0&&r.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),d.maxBounds&&this.setMaxBounds(d.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),r.window!==void 0&&(r.window.addEventListener("online",this._onWindowOnline,!1),r.window.addEventListener("resize",this._onWindowResize,!1),r.window.addEventListener("orientationchange",this._onWindowResize,!1),r.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new fs(this,d),this._localFontFamily=d.localFontFamily,this._localIdeographFontFamily=d.localIdeographFontFamily,d.style&&this.setStyle(d.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),d.projection&&this.setProjection(d.projection),this._hash=d.hash&&new Fc(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,r.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),d.attributionControl&&this.addControl(new he({customAttribution:d.customAttribution})),this._logoControl=new Zc,this.addControl(this._logoControl,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new r.Event(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new r.Event(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(d,n){if(n===void 0&&(n=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=d.onAdd(this);this._controls.push(d);const _=this._controlPositions[n];return n.indexOf("bottom")!==-1?_.insertBefore(c,_.firstChild):_.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(d);return n>-1&&this._controls.splice(n,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(d){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new r.Event("movestart",d)).fire(new r.Event("move",d)),this.fire(new r.Event("resize",d)),n&&this.fire(new r.Event("moveend",d)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(d){return this.transform.setMaxBounds(r.LngLatBounds.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d?this.setZoom(d):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d?this.setZoom(d):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d?this.setPitch(d):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d?this.setPitch(d):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(d){return d==="auto"?r.window.navigator.language:Array.isArray(d)?d.length===0?void 0:d.map(n=>n==="auto"?r.window.navigator.language:n):d}setLanguage(d){const n=this._parseLanguage(d);if(!this.style||n===this._language)return this;this._language=n,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(d){return this.style&&d!==this._worldview?(this._worldview=d,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(d){return this._lazyInitEmptyStyle(),d?typeof d=="string"&&(d={name:d}):d=null,this._useExplicitProjection=!!d,this._prioritizeAndUpdateProjection(d,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const d=this.transform,n=d.projection.name;let c;n==="globe"&&d.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?(d.setMercatorFromTransition(),c=!0):n==="mercator"&&d.zoom<r.GLOBE_ZOOM_THRESHOLD_MAX&&(d.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(d,n){return this._updateProjection(d||n||{name:"mercator"})}_updateProjection(d){let n;if(n=d.name==="globe"&&this.transform.zoom>=r.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(d),this.style.applyProjectionUpdate(),n){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(d){return this.transform.locationPoint3D(r.LngLat.convert(d))}unproject(d){return this.transform.pointLocation3D(r.Point.convert(d))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(d,n,c){if(d==="mouseenter"||d==="mouseover"){let _=!1;const y=S=>{const M=n.filter(z=>this.getLayer(z)),P=M.length?this.queryRenderedFeatures(S.point,{layers:M}):[];P.length?_||(_=!0,c.call(this,new en(d,this,S.originalEvent,{features:P}))):_=!1},b=()=>{_=!1};return{layers:new Set(n),listener:c,delegates:{mousemove:y,mouseout:b}}}if(d==="mouseleave"||d==="mouseout"){let _=!1;const y=S=>{const M=n.filter(P=>this.getLayer(P));(M.length?this.queryRenderedFeatures(S.point,{layers:M}):[]).length?_=!0:_&&(_=!1,c.call(this,new en(d,this,S.originalEvent)))},b=S=>{_&&(_=!1,c.call(this,new en(d,this,S.originalEvent)))};return{layers:new Set(n),listener:c,delegates:{mousemove:y,mouseout:b}}}{const _=y=>{const b=n.filter(M=>this.getLayer(M)),S=b.length?this.queryRenderedFeatures(y.point,{layers:b}):[];S.length&&(y.features=S,c.call(this,y),delete y.features)};return{layers:new Set(n),listener:c,delegates:{[d]:_}}}}on(d,n,c){if(c===void 0)return super.on(d,n);Array.isArray(n)||(n=[n]);const _=this._createDelegatedListener(d,n,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(_);for(const y in _.delegates)this.on(y,_.delegates[y]);return this}once(d,n,c){if(c===void 0)return super.once(d,n);Array.isArray(n)||(n=[n]);const _=this._createDelegatedListener(d,n,c);for(const y in _.delegates)this.once(y,_.delegates[y]);return this}off(d,n,c){if(c===void 0)return super.off(d,n);n=new Set(Array.isArray(n)?n:[n]);const _=(b,S)=>{if(b.size!==S.size)return!1;for(const M of b)if(!S.has(M))return!1;return!0},y=this._delegatedListeners?this._delegatedListeners[d]:void 0;return y&&(b=>{for(let S=0;S<b.length;S++){const M=b[S];if(M.listener===c&&_(M.layers,n)){for(const P in M.delegates)this.off(P,M.delegates[P]);return b.splice(S,1),this}}})(y),this}queryRenderedFeatures(d,n){return this.style?(n!==void 0||d===void 0||d instanceof r.Point||Array.isArray(d)||(n=d,d=void 0),this.style.queryRenderedFeatures(d=d||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(d,n){return this.style.querySourceFeatures(d,n)}isPointOnSurface(d){const{name:n}=this.transform.projection;return n!=="globe"&&n!=="mercator"&&r.warnOnce(`${n} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(r.Point.convert(d))}setStyle(d,n){return(n=r.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff!==!1&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&d?(this._diffStyle(d,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(d,n))}_getUIString(d){const n=this._locale[d];if(n==null)throw new Error(`Missing UI string '${d}'`);return n}_updateStyle(d,n){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),d&&(this.style=new ds(this,n||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d):this.style.loadJSON(d)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ds(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,n){if(typeof d=="string"){const c=this._requestManager.normalizeStyleURL(d),_=this._requestManager.transformRequest(c,r.ResourceType.Style);r.getJSON(_,(y,b)=>{y?this.fire(new r.ErrorEvent(y)):b&&this._updateDiff(b,n)})}else typeof d=="object"&&this._updateDiff(d,n)}_updateDiff(d,n){try{this.style.setState(d)&&this._update(!0)}catch(c){r.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.warnOnce("There is no style added to the map."),!1)}addSource(d,n){return this._lazyInitEmptyStyle(),this.style.addSource(d,n),this._update(!0)}isSourceLoaded(d){return!!this.style&&this.style._isSourceCacheLoaded(d)}areTilesLoaded(){const d=this.style&&this.style._sourceCaches;for(const n in d){const c=d[n]._tiles;for(const _ in c){const y=c[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}addSourceType(d,n,c){this._lazyInitEmptyStyle(),this.style.addSourceType(d,n,c)}removeSource(d){return this.style.removeSource(d),this._updateTerrain(),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,n,{pixelRatio:c=1,sdf:_=!1,stretchX:y,stretchY:b,content:S}={}){if(this._lazyInitEmptyStyle(),n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap){const{width:M,height:P,data:z}=r.exported.getImageData(n);this.style.addImage(d,{data:new r.RGBAImage({width:M,height:P},z),pixelRatio:c,stretchX:y,stretchY:b,content:S,sdf:_,version:0})}else if(n.width===void 0||n.height===void 0)this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:M,height:P}=n,z=n;this.style.addImage(d,{data:new r.RGBAImage({width:M,height:P},new Uint8Array(z.data)),pixelRatio:c,stretchX:y,stretchY:b,content:S,sdf:_,version:0,userImage:z}),z.onAdd&&z.onAdd(this,d)}}updateImage(d,n){const c=this.style.getImage(d);if(!c)return void this.fire(new r.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap?r.exported.getImageData(n):n,{width:y,height:b}=_;y!==void 0&&b!==void 0?y===c.data.width&&b===c.data.height?(c.data.replace(_.data,!(n instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&n instanceof r.window.ImageBitmap)),this.style.updateImage(d,c)):this.fire(new r.ErrorEvent(new Error(`The width and height of the updated image (${y}, ${b})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`))):this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new r.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,n){r.getImage(this._requestManager.transformRequest(d,r.ResourceType.Image),(c,_)=>{n(c,_ instanceof r.window.HTMLImageElement?r.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(d,n){return this._lazyInitEmptyStyle(),this.style.addLayer(d,n),this._update(!0)}moveLayer(d,n){return this.style.moveLayer(d,n),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,n,c){return this.style.setLayerZoomRange(d,n,c),this._update(!0)}setFilter(d,n,c={}){return this.style.setFilter(d,n,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,n,c,_={}){return this.style.setPaintProperty(d,n,c,_),this._update(!0)}getPaintProperty(d,n){return this.style.getPaintProperty(d,n)}setLayoutProperty(d,n,c,_={}){return this.style.setLayoutProperty(d,n,c,_),this._update(!0)}getLayoutProperty(d,n){return this.style.getLayoutProperty(d,n)}setLight(d,n={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,n),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(d){return this._lazyInitEmptyStyle(),!d&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(d),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(d){return this._lazyInitEmptyStyle(),this.style.setFog(d),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(d){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.LngLat.convert(d),this.transform):0}setFeatureState(d,n){return this.style.setFeatureState(d,n),this._update()}removeFeatureState(d,n){return this.style.removeFeatureState(d,n),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}_updateContainerDimensions(){if(!this._container)return;const d=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let c,_,y,b=this._container;for(;b&&(!_||!y);){const S=r.window.getComputedStyle(b).transform;S&&S!=="none"&&(c=S.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(_=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),b=b.parentElement}this._containerWidth=_?Math.abs(d/_):d,this._containerHeight=y?Math.abs(n/y):n}_detectMissingCSS(){r.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const d=this._container;d.classList.add("mapboxgl-map"),(this._missingCSSCanary=U("div","mapboxgl-canary",d)).style.visibility="hidden",this._detectMissingCSS();const n=this._canvasContainer=U("div","mapboxgl-canvas-container",d);this._interactive&&n.classList.add("mapboxgl-interactive"),this._canvas=U("canvas","mapboxgl-canvas",n),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=U("div","mapboxgl-control-container",d),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(y=>{_[y]=U("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(d,n){const c=r.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(d),this._canvas.height=c*Math.ceil(n),this._canvas.style.width=`${d}px`,this._canvas.style.height=`${n}px`}_addMarker(d){this._markers.push(d)}_removeMarker(d){const n=this._markers.indexOf(d);n!==-1&&this._markers.splice(n,1)}_addPopup(d){this._popups.push(d)}_removePopup(d){const n=this._popups.indexOf(d);n!==-1&&this._popups.splice(n,1)}_setupPainter(){const d=r.extend({},I.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),n=this._useWebGL2&&this._canvas.getContext("webgl2",d),c=n||this._canvas.getContext("webgl",d)||this._canvas.getContext("experimental-webgl",d);c?(this._useWebGL2&&!n&&r.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),r.storeAuthState(c,!0),this.painter=new so(c,this.transform,!!n),this.on("data",_=>{_.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.exported$1.testSupport(c)):this.fire(new r.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new r.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_requestDomTask(d){!this.loaded()||this.loaded()&&!this.isMoving()?d():this._domRenderTaskQueue.add(d)}_render(d){let n;const c=this.painter.context.extTimerQuery,_=r.exported.now();if(this.listens("gpu-timing-frame")&&(n=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],r.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],r.window.performance.now())),this._renderTaskQueue.run(d),this._domRenderTaskQueue.run(d),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const M=this.transform.zoom,P=this.transform.pitch,z=r.exported.now(),L=new r.EvaluationParameters(M,{now:z,fadeDuration:y,pitch:P,transition:this.style.getTransition()});this.style.update(L)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let b=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),b=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):b=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const M=r.exported.now()-_;c.endQueryEXT(c.TIME_ELAPSED_EXT,n),setTimeout(()=>{const P=c.getQueryObjectEXT(n,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(n),this.fire(new r.Event("gpu-timing-frame",{cpuTime:M,gpuTime:P})),r.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:P}})},50)}if(this.listens("gpu-timing-layer")){const M=this.painter.collectGpuTimers();setTimeout(()=>{const P=this.painter.queryGpuTimers(M);this.fire(new r.Event("gpu-timing-layer",{layerTimes:P}))},50)}if(this.listens("gpu-timing-deferred-render")){const M=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const P=this.painter.queryGpuTimeDeferredRender(M);this.fire(new r.Event("gpu-timing-deferred-render",{gpuTime:P}))},50)}const S=this._sourcesDirty||this._styleDirty||this._placementDirty||b;if(S||this._repaint)this.triggerRepaint();else{const M=!this.isMoving()&&this.loaded();if(M&&(b=this._updateAverageElevation(_,!0)),b)this.triggerRepaint();else if(this._triggerFrame(!1),M&&(this.fire(new r.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const P=this._calculateSpeedIndex();this.fire(new r.Event("speedindexcompleted",{speedIndex:P})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||S||(this._fullyLoaded=!0,r.LivePerformanceUtils.mark(r.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&r.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(d){for(const n of this._markers)d&&!this.getRenderWorldCopies()&&(n._lngLat=n._lngLat.wrap()),n._update();for(const n of this._popups)!d||this.getRenderWorldCopies()||n._trackPointer||(n._lngLat=n._lngLat.wrap()),n._update()}_updateAverageElevation(d,n=!1){const c=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);if((n||d-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(d)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=d;const S=Math.abs(_-y);if(S>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(y),c(y);this._averageElevation.easeTo(y,d,300)}else if(S>1e-4)return this._averageElevation.jumpTo(y),c(y)}return!!this._averageElevation.isEasing(d)&&c(this._averageElevation.getValue(d))}_authenticate(){r.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,d=>{if(d&&(d.message===r.AUTH_ERR_MSG||d.status===401)){const n=this.painter.context.gl;r.storeAuthState(n,!1),this._logoControl instanceof Zc&&this._logoControl._updateLogo(),n&&n.clear(n.DEPTH_BUFFER_BIT|n.COLOR_BUFFER_BIT|n.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new r.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),r.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const d=this._isDragging();this.painter.updateTerrain(this.style,d)}_calculateSpeedIndex(){const d=this.painter.canvasCopy(),n=this.painter.getCanvasCopiesAndTimestamps();n.timeStamps.push(performance.now());const c=this.painter.context.gl,_=c.createFramebuffer();function y(b){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b,0);const S=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,S),S}return c.bindFramebuffer(c.FRAMEBUFFER,_),this._canvasPixelComparison(y(d),n.canvasCopies.map(y),n.timeStamps)}_canvasPixelComparison(d,n,c){let _=c[1]-c[0];const y=d.length/4;for(let b=0;b<n.length;b++){const S=n[b];let M=0;for(let P=0;P<S.length;P+=4)S[P]===d[P]&&S[P+1]===d[P+1]&&S[P+2]===d[P+2]&&S[P+3]===d[P+3]&&(M+=1);_+=(c[b+2]-c[b+1])*(1-M/y)}return _}remove(){this._hash&&this._hash.remove();for(const n of this._controls)n.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),r.window!==void 0&&(r.window.removeEventListener("resize",this._onWindowResize,!1),r.window.removeEventListener("orientationchange",this._onWindowResize,!1),r.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.removeEventListener("online",this._onWindowOnline,!1),r.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const d=this.painter.context.gl.getExtension("WEBGL_lose_context");d&&d.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),r.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new r.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(d){this._renderNextFrame=this._renderNextFrame||d,this.style&&!this._frame&&(this._frame=r.exported.frame(n=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(n)}))}_preloadTiles(d){const n=this.style?Object.values(this.style._sourceCaches):[];return r.asyncAll(n,(c,_)=>c._preloadTiles(d,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(d){this._trackResize&&this.resize({originalEvent:d})._update()}_onVisibilityChange(){r.window.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(d){this._showTerrainWireframe!==d&&(this._showTerrainWireframe=d,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(d){this._speedIndexTiming!==d&&(this._speedIndexTiming=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(d){this._showTileAABBs!==d&&(this._showTileAABBs=d,d&&this._update())}_setCacheLimits(d,n){r.setCacheLimits(d,n)}get version(){return r.version}},NavigationControl:class{constructor(d){this.options=r.extend({},sf,d),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",n=>n.preventDefault()),this.options.showZoom&&(r.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",n=>{this._map&&this._map.zoomIn({},{originalEvent:n})}),U("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",n=>{this._map&&this._map.zoomOut({},{originalEvent:n})}),U("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",n=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:n}):c.resetNorth({},{originalEvent:n}))}),this._compassIcon=U("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map;if(!d)return;const n=d.getZoom(),c=n===d.getMaxZoom(),_=n===d.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const d=this._map;if(!d)return;const n=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(d.transform.pitch*(Math.PI/180)),.5)}) rotateX(${d.transform.pitch}deg) rotateZ(${d.transform.angle*(180/Math.PI)}deg)`:`rotate(${d.transform.angle*(180/Math.PI)}deg)`;d._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=n)})}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),d.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&d.on("pitch",this._rotateCompassArrow),d.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new rf(d,this._compass,this.options.visualizePitch)),this._container}onRemove(){const d=this._map;d&&(this._container.remove(),this.options.showZoom&&d.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&d.off("pitch",this._rotateCompassArrow),d.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(d,n){const c=U("button",d,this._container);return c.type="button",c.addEventListener("click",n),c}_setButtonTitle(d,n){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${n}`);d.setAttribute("aria-label",c),d.firstElementChild&&d.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends r.Evented{constructor(d){super(),this.options=r.extend({geolocation:r.window.navigator.geolocation},Kc,d),r.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=ao(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(d){return this._map=d,this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(d){const n=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,d(c)};this._supportsGeolocation!==void 0?d(this._supportsGeolocation):r.window.navigator.permissions!==void 0?r.window.navigator.permissions.query({name:"geolocation"}).then(c=>n(c.state!=="denied")).catch(()=>n()):n()}_isOutOfMapMaxBounds(d){const n=this._map.getMaxBounds(),c=d.coords;return!!n&&(c.longitude<n.getWest()||c.longitude>n.getEast()||c.latitude<n.getSouth()||c.latitude>n.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new r.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("geolocate",d)),this._finish()}}_updateCamera(d){const n=new r.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,_=this._map.getBearing(),y=r.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(c),y,{geolocateSource:!0})}_updateMarker(d){if(d){const n=new r.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.transform,n=r.mercatorZfromAltitude(1,d._center.lat)*d.worldSize,c=Math.ceil(2*this._accuracy*n);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",n=>n.preventDefault()),this._geolocateButton=U("button","mapboxgl-ctrl-geolocate",this._container),U("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){r.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}else{const n=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",n),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",n)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=U("div","mapboxgl-user-location"),this._dotElement.appendChild(U("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(U("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ae({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=U("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ae({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",n=>{n.geolocateSource||this._watchState!=="ACTIVE_LOCK"||n.originalEvent&&n.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.Event("trackuserlocationend")))})}}_onDeviceOrientation(d){this._userLocationDotMarker&&(d.webkitCompassHeading?this._heading=d.webkitCompassHeading:d.absolute===!0&&(this._heading=-1*d.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(d={maximumAge:6e5,timeout:0},this._noTimeout=!0):(d=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,d),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const d=()=>{r.window.addEventListener("ondeviceorientationabsolute"in r.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};r.window.DeviceMotionEvent!==void 0&&typeof r.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(n=>{n==="granted"&&d()}).catch(console.error):d()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),r.window.removeEventListener("deviceorientation",this._onDeviceOrientation),r.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:he,ScaleControl:class{constructor(d){this.options=r.extend({},Jc,d),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),r.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const d=this.options.maxWidth||100,n=this._map,c=n._containerHeight/2,_=n._containerWidth/2-d/2,y=n.unproject([_,c]),b=n.unproject([_+d,c]),S=y.distanceTo(b);if(this.options.unit==="imperial"){const M=3.2808*S;M>5280?this._setScale(d,M/5280,"mile"):this._setScale(d,M,"foot")}else this.options.unit==="nautical"?this._setScale(d,S/1852,"nautical-mile"):S>=1e3?this._setScale(d,S/1e3,"kilometer"):this._setScale(d,S,"meter")}_setScale(d,n,c){this._map._requestDomTask(()=>{const _=function(b){const S=Math.pow(10,`${Math.floor(b)}`.length-1);let M=b/S;return M=M>=10?10:M>=5?5:M>=3?3:M>=2?2:M>=1?1:function(P){const z=Math.pow(10,Math.ceil(-Math.log(P)/Math.LN10));return Math.round(P*z)/z}(M),S*M}(n),y=_/n;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(_):`${_}&nbsp;${Qc[c]}`,this._container.style.width=d*y+"px"})}onAdd(d){return this._map=d,this._language=d.getLanguage(),this._container=U("div","mapboxgl-ctrl mapboxgl-ctrl-scale",d.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(d){this._language=d,this._update()}setUnit(d){this.options.unit=d,this._update()}},FullscreenControl:class{constructor(d){this._fullscreen=!1,d&&d.container&&(d.container instanceof r.window.HTMLElement?this._container=d.container:r.warnOnce("Full screen control 'container' must be a DOM element.")),r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in r.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in r.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=U("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,r.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!r.window.document.fullscreenEnabled&&!r.window.document.webkitFullscreenEnabled)}_setupUI(){const d=this._fullscreenButton=U("button","mapboxgl-ctrl-fullscreen",this._controlContainer);U("span","mapboxgl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),r.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",d)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(r.window.document.fullscreenElement||r.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?r.window.document.exitFullscreen?r.window.document.exitFullscreen():r.window.document.webkitCancelFullScreen&&r.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.Evented{constructor(d){super(),this.options=r.extend(Object.create(Xc),d),r.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(d&&d.className?d.className.trim().split(/\s+/):[])}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&d.on("preclick",this._onClose),this.options.closeOnMove&&d.on("move",this._onClose),d.on("remove",this.remove),this._update(),d._addPopup(this),this._focusFirstElement(),this._trackPointer?(d.on("mousemove",this._onMouseEvent),d.on("mouseup",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")):d.on("move",this._update),this.fire(new r.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const d=this._map;return d&&(d.off("move",this._update),d.off("move",this._onClose),d.off("preclick",this._onClose),d.off("click",this._onClose),d.off("remove",this.remove),d.off("mousemove",this._onMouseEvent),d.off("mouseup",this._onMouseEvent),d.off("drag",this._onMouseEvent),d._canvasContainer&&d._canvasContainer.classList.remove("mapboxgl-track-pointer"),d._removePopup(this),this._map=void 0),this.fire(new r.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){this._lngLat=r.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const d=this._map;return d&&(d.off("move",this._update),d.on("mousemove",this._onMouseEvent),d.on("drag",this._onMouseEvent),d._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(r.window.document.createTextNode(d))}setHTML(d){const n=r.window.document.createDocumentFragment(),c=r.window.document.createElement("body");let _;for(c.innerHTML=d;_=c.firstChild,_;)n.appendChild(_);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){let n=this._content;if(n)for(;n.hasChildNodes();)n.firstChild&&n.removeChild(n.firstChild);else n=this._content=U("div","mapboxgl-popup-content",this._container||void 0);if(n.appendChild(d),this.options.closeButton){const c=this._closeButton=U("button","mapboxgl-popup-close-button",n);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(d){return this._classList.add(d),this._updateClassList(),this}removeClassName(d){return this._classList.delete(d),this._updateClassList(),this}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){let n;return this._classList.delete(d)?n=!1:(this._classList.add(d),n=!0),this._updateClassList(),n}_onMouseEvent(d){this._update(d.point)}_getAnchor(d){if(this.options.anchor)return this.options.anchor;const n=this._map,c=this._container,_=this._pos;if(!n||!c||!_)return"bottom";const y=c.offsetWidth,b=c.offsetHeight,S=_.x<y/2,M=_.x>n.transform.width-y/2;if(_.y+d<b)return S?"top-left":M?"top-right":"top";if(_.y>n.transform.height-b){if(S)return"bottom-left";if(M)return"bottom-right"}return S?"left":M?"right":"bottom"}_updateClassList(){const d=this._container;if(!d)return;const n=[...this._classList];n.push("mapboxgl-popup"),this._anchor&&n.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&n.push("mapboxgl-popup-track-pointer"),d.className=n.join(" ")}_update(d){const n=this._map,c=this._content;if(!n||!this._lngLat&&!this._trackPointer||!c)return;let _=this._container;if(_||(_=this._container=U("div","mapboxgl-popup",n.getContainer()),this._tip=U("div","mapboxgl-popup-tip",_),_.appendChild(c)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),n.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ho(this._lngLat,this._pos,n.transform)),!this._trackPointer||d){const y=this._pos=this._trackPointer&&d?d:n.project(this._lngLat),b=Ju(this.options.offset),S=this._anchor=this._getAnchor(b.y),M=Ju(this.options.offset,S),P=y.add(M).round();n._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${Er[S]} translate(${P.x}px,${P.y}px)`)})}if(!this._marker&&n._showingGlobe()){const y=r.isLngLatBehindGlobe(n.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(nf);d&&d.focus()}_onClose(){this.remove()}_setOpacity(d){this._container&&(this._container.style.opacity=`${d}`),this._content&&(this._content.style.pointerEvents=d?"auto":"none")}},Marker:ae,Style:ds,LngLat:r.LngLat,LngLatBounds:r.LngLatBounds,Point:r.Point,MercatorCoordinate:r.MercatorCoordinate,FreeCameraOptions:Bu,Evented:r.Evented,config:r.config,prewarm:function(){Zr().acquire(cs)},clearPrewarmedResources:function(){const d=yn;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(cs),yn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return r.config.ACCESS_TOKEN},set accessToken(d){r.config.ACCESS_TOKEN=d},get baseApiUrl(){return r.config.API_URL},set baseApiUrl(d){r.config.API_URL=d},get workerCount(){return Qi.workerCount},set workerCount(d){Qi.workerCount=d},get maxParallelImageRequests(){return r.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){r.config.MAX_PARALLEL_IMAGE_REQUESTS=d},clearStorage(d){r.clearTileCache(d)},workerUrl:"",workerClass:null,setNow:r.exported.setNow,restoreNow:r.exported.restoreNow};return uo});var v=p;return v})})(L1);var _M=L1.exports;const cu=D1(_M);var sc=gM,mM=Object.prototype.hasOwnProperty;function gM(){for(var o={},s=0;s<arguments.length;s++){var a=arguments[s];for(var u in a)mM.call(a,u)&&(o[u]=a[u])}return o}var R1={exports:{}};(function(o,s){(function(){var a={};o.exports=a,a.simpleFilter=function(u,p){return p.filter(function(g){return a.test(u,g)})},a.test=function(u,p){return a.match(u,p)!==null},a.match=function(u,p,g){g=g||{};var v=0,r=[],T=p.length,I=0,R=0,F=g.pre||"",U=g.post||"",Y=g.caseSensitive&&p||p.toLowerCase(),it;u=g.caseSensitive&&u||u.toLowerCase();for(var ct=0;ct<T;ct++)it=p[ct],Y[ct]===u[v]?(it=F+it+U,v+=1,R+=1+R):R=0,I+=R,r[r.length]=it;return v===u.length?(I=Y===u?1/0:I,{rendered:r.join(""),score:I}):null},a.filter=function(u,p,g){return!p||p.length===0?[]:typeof u!="string"?p:(g=g||{},p.reduce(function(v,r,T,I){var R=r;g.extract&&(R=g.extract(r));var F=a.match(u,R,g);return F!=null&&(v[v.length]={string:F.rendered,score:F.score,index:T,original:r}),v},[]).sort(function(v,r){var T=r.score-v.score;return T||v.index-r.index}))}})()})(R1);var yM=R1.exports,Qn=function(o){return this.component=o,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,o.el.parentNode.insertBefore(this.wrapper,o.el.nextSibling),this};Qn.prototype.show=function(){this.element.style.display="block"};Qn.prototype.hide=function(){this.element.style.display="none"};Qn.prototype.add=function(o){this.items.push(o)};Qn.prototype.clear=function(){this.items=[],this.active=0};Qn.prototype.isEmpty=function(){return!this.items.length};Qn.prototype.isVisible=function(){return this.element.style.display==="block"};Qn.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var o=0;o<this.items.length;o++)this.drawItem(this.items[o],this.active===o);this.show()};Qn.prototype.drawItem=function(o,s){var a=document.createElement("li"),u=document.createElement("a");s&&(a.className+=" active"),u.innerHTML=o.string,a.appendChild(u),this.element.appendChild(a),a.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),a.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,o)}).bind(this))};Qn.prototype.handleMouseUp=function(o){this.selectingListItem=!1,this.component.value(o.original),this.clear(),this.draw()};Qn.prototype.move=function(o){this.active=o,this.draw()};Qn.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)};Qn.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)};Qn.prototype.drawError=function(o){var s=document.createElement("li");s.innerHTML=o,this.element.appendChild(s),this.show()};var xM=Qn,vM=sc,bM=yM,wM=xM,Ln=function(o,s,a){return a=a||{},this.options=vM({minLength:2,limit:5,filter:!0,hideOnBlur:!0},a),this.el=o,this.data=s||[],this.list=new wM(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(u){this.handleKeyUp(u.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(u){this.handleKeyDown(u)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(u){this.handlePaste(u)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};Ln.prototype.handleKeyUp=function(o){o===40||o===38||o===27||o===13||o===9||this.handleInputChange(this.el.value)};Ln.prototype.handleKeyDown=function(o){switch(o.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&o.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}};Ln.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()};Ln.prototype.handlePaste=function(o){if(o.clipboardData)this.handleInputChange(o.clipboardData.getData("Text"));else{var s=this;setTimeout(function(){s.handleInputChange(o.target.value)},100)}};Ln.prototype.handleInputChange=function(o){if(this.query=this.normalize(o),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(s){for(var a=0;a<s.length&&(this.list.add(s[a]),a!==this.options.limit-1);a++);this.list.draw()}).bind(this))};Ln.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1};Ln.prototype.update=function(o){this.data=o,this.handleKeyUp()};Ln.prototype.clear=function(){this.data=[],this.list.clear()};Ln.prototype.normalize=function(o){return o=o.toLowerCase(),o};Ln.prototype.match=function(o,s){return o.indexOf(s)>-1};Ln.prototype.value=function(o){if(this.selected=o,this.el.value=this.getItemValue(o),document.createEvent){var s=document.createEvent("HTMLEvents");s.initEvent("change",!0,!1),this.el.dispatchEvent(s)}else this.el.fireEvent("onchange")};Ln.prototype.getCandidates=function(o){var s={pre:"<strong>",post:"</strong>",extract:(function(u){return this.getItemValue(u)}).bind(this)},a;this.options.filter?(a=bM.filter(this.query,this.data,s),a=a.map((function(u){return{original:u.original,string:this.render(u.original,u.string)}}).bind(this))):a=this.data.map((function(u){var p=this.render(u);return{original:u,string:p}}).bind(this)),o(a)};Ln.prototype.getItemValue=function(o){return o};Ln.prototype.render=function(o,s){if(s)return s;for(var a=o.original?this.getItemValue(o.original):this.getItemValue(o),u=this.normalize(a),p=u.lastIndexOf(this.query);p>-1;){var g=p+this.query.length;a=a.slice(0,p)+"<strong>"+a.slice(p,g)+"</strong>"+a.slice(g),p=u.slice(0,p).lastIndexOf(this.query)}return a};Ln.prototype.renderError=function(o){this.list.drawError(o)};var TM=Ln,O1=TM,EM=O1;typeof window<"u"&&(window.Suggestions=O1);var SM="Expected a function",Tx=0/0,MM="[object Symbol]",AM=/^\s+|\s+$/g,CM=/^[-+]0x[0-9a-f]+$/i,IM=/^0b[01]+$/i,PM=/^0o[0-7]+$/i,kM=parseInt,DM=typeof $s=="object"&&$s&&$s.Object===Object&&$s,LM=typeof self=="object"&&self&&self.Object===Object&&self,zM=DM||LM||Function("return this")(),RM=Object.prototype,OM=RM.toString,BM=Math.max,FM=Math.min,P_=function(){return zM.Date.now()};function NM(o,s,a){var u,p,g,v,r,T,I=0,R=!1,F=!1,U=!0;if(typeof o!="function")throw new TypeError(SM);s=Ex(s)||0,tm(a)&&(R=!!a.leading,F="maxWait"in a,g=F?BM(Ex(a.maxWait)||0,s):g,U="trailing"in a?!!a.trailing:U);function Y(Jt){var ne=u,se=p;return u=p=void 0,I=Jt,v=o.apply(se,ne),v}function it(Jt){return I=Jt,r=setTimeout(bt,s),R?Y(Jt):v}function ct(Jt){var ne=Jt-T,se=Jt-I,Lt=s-ne;return F?FM(Lt,g-se):Lt}function ht(Jt){var ne=Jt-T,se=Jt-I;return T===void 0||ne>=s||ne<0||F&&se>=g}function bt(){var Jt=P_();if(ht(Jt))return Dt(Jt);r=setTimeout(bt,ct(Jt))}function Dt(Jt){return r=void 0,U&&u?Y(Jt):(u=p=void 0,v)}function Ft(){r!==void 0&&clearTimeout(r),I=0,u=T=p=r=void 0}function Wt(){return r===void 0?v:Dt(P_())}function Rt(){var Jt=P_(),ne=ht(Jt);if(u=arguments,p=this,T=Jt,ne){if(r===void 0)return it(T);if(F)return r=setTimeout(bt,s),Y(T)}return r===void 0&&(r=setTimeout(bt,s)),v}return Rt.cancel=Ft,Rt.flush=Wt,Rt}function tm(o){var s=typeof o;return!!o&&(s=="object"||s=="function")}function jM(o){return!!o&&typeof o=="object"}function VM(o){return typeof o=="symbol"||jM(o)&&OM.call(o)==MM}function Ex(o){if(typeof o=="number")return o;if(VM(o))return Tx;if(tm(o)){var s=typeof o.valueOf=="function"?o.valueOf():o;o=tm(s)?s+"":s}if(typeof o!="string")return o===0?o:+o;o=o.replace(AM,"");var a=IM.test(o);return a||PM.test(o)?kM(o.slice(2),a?2:8):CM.test(o)?Tx:+o}var UM=NM,gm={exports:{}},Xl=typeof Reflect=="object"?Reflect:null,Sx=Xl&&typeof Xl.apply=="function"?Xl.apply:function(s,a,u){return Function.prototype.apply.call(s,a,u)},mp;Xl&&typeof Xl.ownKeys=="function"?mp=Xl.ownKeys:Object.getOwnPropertySymbols?mp=function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:mp=function(s){return Object.getOwnPropertyNames(s)};function GM(o){console&&console.warn&&console.warn(o)}var B1=Number.isNaN||function(s){return s!==s};function Ti(){Ti.init.call(this)}gm.exports=Ti;gm.exports.once=ZM;Ti.EventEmitter=Ti;Ti.prototype._events=void 0;Ti.prototype._eventsCount=0;Ti.prototype._maxListeners=void 0;var Mx=10;function zp(o){if(typeof o!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof o)}Object.defineProperty(Ti,"defaultMaxListeners",{enumerable:!0,get:function(){return Mx},set:function(o){if(typeof o!="number"||o<0||B1(o))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+o+".");Mx=o}});Ti.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ti.prototype.setMaxListeners=function(s){if(typeof s!="number"||s<0||B1(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this};function F1(o){return o._maxListeners===void 0?Ti.defaultMaxListeners:o._maxListeners}Ti.prototype.getMaxListeners=function(){return F1(this)};Ti.prototype.emit=function(s){for(var a=[],u=1;u<arguments.length;u++)a.push(arguments[u]);var p=s==="error",g=this._events;if(g!==void 0)p=p&&g.error===void 0;else if(!p)return!1;if(p){var v;if(a.length>0&&(v=a[0]),v instanceof Error)throw v;var r=new Error("Unhandled error."+(v?" ("+v.message+")":""));throw r.context=v,r}var T=g[s];if(T===void 0)return!1;if(typeof T=="function")Sx(T,this,a);else for(var I=T.length,R=G1(T,I),u=0;u<I;++u)Sx(R[u],this,a);return!0};function N1(o,s,a,u){var p,g,v;if(zp(a),g=o._events,g===void 0?(g=o._events=Object.create(null),o._eventsCount=0):(g.newListener!==void 0&&(o.emit("newListener",s,a.listener?a.listener:a),g=o._events),v=g[s]),v===void 0)v=g[s]=a,++o._eventsCount;else if(typeof v=="function"?v=g[s]=u?[a,v]:[v,a]:u?v.unshift(a):v.push(a),p=F1(o),p>0&&v.length>p&&!v.warned){v.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+v.length+" "+String(s)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=o,r.type=s,r.count=v.length,GM(r)}return o}Ti.prototype.addListener=function(s,a){return N1(this,s,a,!1)};Ti.prototype.on=Ti.prototype.addListener;Ti.prototype.prependListener=function(s,a){return N1(this,s,a,!0)};function qM(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function j1(o,s,a){var u={fired:!1,wrapFn:void 0,target:o,type:s,listener:a},p=qM.bind(u);return p.listener=a,u.wrapFn=p,p}Ti.prototype.once=function(s,a){return zp(a),this.on(s,j1(this,s,a)),this};Ti.prototype.prependOnceListener=function(s,a){return zp(a),this.prependListener(s,j1(this,s,a)),this};Ti.prototype.removeListener=function(s,a){var u,p,g,v,r;if(zp(a),p=this._events,p===void 0)return this;if(u=p[s],u===void 0)return this;if(u===a||u.listener===a)--this._eventsCount===0?this._events=Object.create(null):(delete p[s],p.removeListener&&this.emit("removeListener",s,u.listener||a));else if(typeof u!="function"){for(g=-1,v=u.length-1;v>=0;v--)if(u[v]===a||u[v].listener===a){r=u[v].listener,g=v;break}if(g<0)return this;g===0?u.shift():$M(u,g),u.length===1&&(p[s]=u[0]),p.removeListener!==void 0&&this.emit("removeListener",s,r||a)}return this};Ti.prototype.off=Ti.prototype.removeListener;Ti.prototype.removeAllListeners=function(s){var a,u,p;if(u=this._events,u===void 0)return this;if(u.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):u[s]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete u[s]),this;if(arguments.length===0){var g=Object.keys(u),v;for(p=0;p<g.length;++p)v=g[p],v!=="removeListener"&&this.removeAllListeners(v);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(a=u[s],typeof a=="function")this.removeListener(s,a);else if(a!==void 0)for(p=a.length-1;p>=0;p--)this.removeListener(s,a[p]);return this};function V1(o,s,a){var u=o._events;if(u===void 0)return[];var p=u[s];return p===void 0?[]:typeof p=="function"?a?[p.listener||p]:[p]:a?WM(p):G1(p,p.length)}Ti.prototype.listeners=function(s){return V1(this,s,!0)};Ti.prototype.rawListeners=function(s){return V1(this,s,!1)};Ti.listenerCount=function(o,s){return typeof o.listenerCount=="function"?o.listenerCount(s):U1.call(o,s)};Ti.prototype.listenerCount=U1;function U1(o){var s=this._events;if(s!==void 0){var a=s[o];if(typeof a=="function")return 1;if(a!==void 0)return a.length}return 0}Ti.prototype.eventNames=function(){return this._eventsCount>0?mp(this._events):[]};function G1(o,s){for(var a=new Array(s),u=0;u<s;++u)a[u]=o[u];return a}function $M(o,s){for(;s+1<o.length;s++)o[s]=o[s+1];o.pop()}function WM(o){for(var s=new Array(o.length),a=0;a<s.length;++a)s[a]=o[a].listener||o[a];return s}function ZM(o,s){return new Promise(function(a,u){function p(v){o.removeListener(s,g),u(v)}function g(){typeof o.removeListener=="function"&&o.removeListener("error",p),a([].slice.call(arguments))}q1(o,s,g,{once:!0}),s!=="error"&&HM(o,p,{once:!0})})}function HM(o,s,a){typeof o.on=="function"&&q1(o,"error",s,a)}function q1(o,s,a,u){if(typeof o.on=="function")u.once?o.once(s,a):o.on(s,a);else if(typeof o.addEventListener=="function")o.addEventListener(s,function p(g){u.once&&o.removeEventListener(s,p),a(g)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof o)}var XM=gm.exports,YM={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}};function KM(o){var s=o.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return s?{key:s[1],value:s[2]}:null}function JM(o){var s=o.match(/<?([^>]*)>(.*)/);if(!s)return null;var a=s[1],u=s[2].split(";"),p=null,g=u.reduce(function(v,r){var T=KM(r);return T?T.key==="rel"?(p||(p=T.value),v):(v[T.key]=T.value,v):v},{});return p?{url:a,rel:p,params:g}:null}function QM(o){return o?o.split(/,\s*</).reduce(function(s,a){var u=JM(a);if(!u)return s;var p=u.rel.split(/\s+/);return p.forEach(function(g){s[g]||(s[g]={url:u.url,params:u.params})}),s},{}):{}}var tA=QM,eA=tA;function ym(o,s){this.request=o,this.headers=s.headers,this.rawBody=s.body,this.statusCode=s.statusCode;try{this.body=JSON.parse(s.body||"{}")}catch{this.body=s.body}this.links=eA(this.headers.link)}ym.prototype.hasNextPage=function(){return!!this.links.next};ym.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null};var iA=ym,Rp={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"},Ax=Rp;function nA(o){var s=o.type||Ax.ERROR_HTTP,a;if(o.body)try{a=JSON.parse(o.body)}catch{a=o.body}else a=null;var u=o.message||null;u||(typeof a=="string"?u=a:a&&typeof a.message=="string"?u=a.message:s===Ax.ERROR_REQUEST_ABORTED&&(u="Request aborted")),this.message=u,this.type=s,this.statusCode=o.statusCode||null,this.request=o.request,this.body=a}var sA=nA;function rA(o){var s=o.indexOf(":"),a=o.substring(0,s).trim().toLowerCase(),u=o.substring(s+1).trim();return{name:a,value:u}}function oA(o){var s={};return o&&o.trim().split(/[\r|\n]+/).forEach(function(a){var u=rA(a);s[u.name]=u.value}),s}var aA=oA,lA=iA,Cx=sA,k_=Rp,cA=aA,Sp={};function hA(o){var s=Sp[o.id];s&&(s.abort(),delete Sp[o.id])}function uA(o,s){return new lA(o,{body:s.response,headers:cA(s.getAllResponseHeaders()),statusCode:s.status})}function Ix(o){var s=o.total,a=o.loaded,u=100*a/s;return{total:s,transferred:a,percent:u}}function $1(o,s){return new Promise(function(a,u){s.onprogress=function(v){o.emitter.emit(k_.EVENT_PROGRESS_DOWNLOAD,Ix(v))};var p=o.file;p&&(s.upload.onprogress=function(v){o.emitter.emit(k_.EVENT_PROGRESS_UPLOAD,Ix(v))}),s.onerror=function(v){u(v)},s.onabort=function(){var v=new Cx({request:o,type:k_.ERROR_REQUEST_ABORTED});u(v)},s.onload=function(){if(delete Sp[o.id],s.status<200||s.status>=400){var v=new Cx({request:o,body:s.response,statusCode:s.status});u(v);return}a(s)};var g=o.body;typeof g=="string"?s.send(g):g?s.send(JSON.stringify(g)):p?s.send(p):s.send(),Sp[o.id]=s}).then(function(a){return uA(o,a)})}function W1(o,s){var a=o.url(s),u=new window.XMLHttpRequest;return u.open(o.method,a),Object.keys(o.headers).forEach(function(p){u.setRequestHeader(p,o.headers[p])}),u}function dA(o){return Promise.resolve().then(function(){var s=W1(o,o.client.accessToken);return $1(o,s)})}var pA={browserAbort:hA,sendRequestXhr:$1,browserSend:dA,createRequestXhr:W1},Mp={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */Mp.exports;(function(o,s){(function(a){var u=s,p=o&&o.exports==u&&o,g=typeof $s=="object"&&$s;(g.global===g||g.window===g)&&(a=g);var v=function(it){this.message=it};v.prototype=new Error,v.prototype.name="InvalidCharacterError";var r=function(it){throw new v(it)},T="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",I=/[\t\n\f\r ]/g,R=function(it){it=String(it).replace(I,"");var ct=it.length;ct%4==0&&(it=it.replace(/==?$/,""),ct=it.length),(ct%4==1||/[^+a-zA-Z0-9/]/.test(it))&&r("Invalid character: the string to be decoded is not correctly encoded.");for(var ht=0,bt,Dt,Ft="",Wt=-1;++Wt<ct;)Dt=T.indexOf(it.charAt(Wt)),bt=ht%4?bt*64+Dt:Dt,ht++%4&&(Ft+=String.fromCharCode(255&bt>>(-2*ht&6)));return Ft},F=function(it){it=String(it),/[^\0-\xFF]/.test(it)&&r("The string to be encoded contains characters outside of the Latin1 range.");for(var ct=it.length%3,ht="",bt=-1,Dt,Ft,Wt,Rt,Jt=it.length-ct;++bt<Jt;)Dt=it.charCodeAt(bt)<<16,Ft=it.charCodeAt(++bt)<<8,Wt=it.charCodeAt(++bt),Rt=Dt+Ft+Wt,ht+=T.charAt(Rt>>18&63)+T.charAt(Rt>>12&63)+T.charAt(Rt>>6&63)+T.charAt(Rt&63);return ct==2?(Dt=it.charCodeAt(bt)<<8,Ft=it.charCodeAt(++bt),Rt=Dt+Ft,ht+=T.charAt(Rt>>10)+T.charAt(Rt>>4&63)+T.charAt(Rt<<2&63)+"="):ct==1&&(Rt=it.charCodeAt(bt),ht+=T.charAt(Rt>>2)+T.charAt(Rt<<4&63)+"=="),ht},U={encode:F,decode:R,version:"0.1.0"};if(u&&!u.nodeType)if(p)p.exports=U;else for(var Y in U)U.hasOwnProperty(Y)&&(u[Y]=U[Y]);else a.base64=U})($s)})(Mp,Mp.exports);var fA=Mp.exports,_A=fA,D_={};function mA(o){if(D_[o])return D_[o];var s=o.split("."),a=s[0],u=s[1];if(!u)throw new Error("Invalid token");var p=gA(u),g={usage:a,user:p.u};return Da(p,"a")&&(g.authorization=p.a),Da(p,"exp")&&(g.expires=p.exp*1e3),Da(p,"iat")&&(g.created=p.iat*1e3),Da(p,"scopes")&&(g.scopes=p.scopes),Da(p,"client")&&(g.client=p.client),Da(p,"ll")&&(g.lastLogin=p.ll),Da(p,"iu")&&(g.impersonator=p.iu),D_[o]=g,g}function gA(o){try{return JSON.parse(_A.decode(o))}catch{throw new Error("Invalid token")}}function Da(o,s){return Object.prototype.hasOwnProperty.call(o,s)}var Z1=mA,H1={exports:{}};(function(o){var s=Object.prototype.hasOwnProperty,a="~";function u(){}Object.create&&(u.prototype=Object.create(null),new u().__proto__||(a=!1));function p(T,I,R){this.fn=T,this.context=I,this.once=R||!1}function g(T,I,R,F,U){if(typeof R!="function")throw new TypeError("The listener must be a function");var Y=new p(R,F||T,U),it=a?a+I:I;return T._events[it]?T._events[it].fn?T._events[it]=[T._events[it],Y]:T._events[it].push(Y):(T._events[it]=Y,T._eventsCount++),T}function v(T,I){--T._eventsCount===0?T._events=new u:delete T._events[I]}function r(){this._events=new u,this._eventsCount=0}r.prototype.eventNames=function(){var I=[],R,F;if(this._eventsCount===0)return I;for(F in R=this._events)s.call(R,F)&&I.push(a?F.slice(1):F);return Object.getOwnPropertySymbols?I.concat(Object.getOwnPropertySymbols(R)):I},r.prototype.listeners=function(I){var R=a?a+I:I,F=this._events[R];if(!F)return[];if(F.fn)return[F.fn];for(var U=0,Y=F.length,it=new Array(Y);U<Y;U++)it[U]=F[U].fn;return it},r.prototype.listenerCount=function(I){var R=a?a+I:I,F=this._events[R];return F?F.fn?1:F.length:0},r.prototype.emit=function(I,R,F,U,Y,it){var ct=a?a+I:I;if(!this._events[ct])return!1;var ht=this._events[ct],bt=arguments.length,Dt,Ft;if(ht.fn){switch(ht.once&&this.removeListener(I,ht.fn,void 0,!0),bt){case 1:return ht.fn.call(ht.context),!0;case 2:return ht.fn.call(ht.context,R),!0;case 3:return ht.fn.call(ht.context,R,F),!0;case 4:return ht.fn.call(ht.context,R,F,U),!0;case 5:return ht.fn.call(ht.context,R,F,U,Y),!0;case 6:return ht.fn.call(ht.context,R,F,U,Y,it),!0}for(Ft=1,Dt=new Array(bt-1);Ft<bt;Ft++)Dt[Ft-1]=arguments[Ft];ht.fn.apply(ht.context,Dt)}else{var Wt=ht.length,Rt;for(Ft=0;Ft<Wt;Ft++)switch(ht[Ft].once&&this.removeListener(I,ht[Ft].fn,void 0,!0),bt){case 1:ht[Ft].fn.call(ht[Ft].context);break;case 2:ht[Ft].fn.call(ht[Ft].context,R);break;case 3:ht[Ft].fn.call(ht[Ft].context,R,F);break;case 4:ht[Ft].fn.call(ht[Ft].context,R,F,U);break;default:if(!Dt)for(Rt=1,Dt=new Array(bt-1);Rt<bt;Rt++)Dt[Rt-1]=arguments[Rt];ht[Ft].fn.apply(ht[Ft].context,Dt)}}return!0},r.prototype.on=function(I,R,F){return g(this,I,R,F,!1)},r.prototype.once=function(I,R,F){return g(this,I,R,F,!0)},r.prototype.removeListener=function(I,R,F,U){var Y=a?a+I:I;if(!this._events[Y])return this;if(!R)return v(this,Y),this;var it=this._events[Y];if(it.fn)it.fn===R&&(!U||it.once)&&(!F||it.context===F)&&v(this,Y);else{for(var ct=0,ht=[],bt=it.length;ct<bt;ct++)(it[ct].fn!==R||U&&!it[ct].once||F&&it[ct].context!==F)&&ht.push(it[ct]);ht.length?this._events[Y]=ht.length===1?ht[0]:ht:v(this,Y)}return this},r.prototype.removeAllListeners=function(I){var R;return I?(R=a?a+I:I,this._events[R]&&v(this,R)):(this._events=new u,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=a,r.EventEmitter=r,o.exports=r})(H1);var yA=H1.exports;function xA(o){return o.map(encodeURIComponent).join(",")}function X1(o){return Array.isArray(o)?xA(o):encodeURIComponent(String(o))}function Y1(o,s,a){if(a===!1||a===null)return o;var u=/\?/.test(o)?"&":"?",p=encodeURIComponent(s);return a!==void 0&&a!==""&&a!==!0&&(p+="="+X1(a)),""+o+u+p}function vA(o,s){if(!s)return o;var a=o;return Object.keys(s).forEach(function(u){var p=s[u];p!==void 0&&(Array.isArray(p)&&(p=p.filter(function(g){return g!=null}).join(",")),a=Y1(a,u,p))}),a}function bA(o,s){if(!s||o.slice(0,4)==="http")return o;var a=o[0]==="/"?"":"/";return""+s.replace(/\/$/,"")+a+o}function wA(o,s){return s?o.replace(/\/:([a-zA-Z0-9]+)/g,function(a,u){var p=s[u];if(p===void 0)throw new Error("Unspecified route parameter "+u);var g=X1(p);return"/"+g}):o}var TA={appendQueryObject:vA,appendQueryParam:Y1,prependOrigin:bA,interpolateRouteParams:wA},EA=Z1,xm=sc,SA=yA,Qd=TA,Px=Rp,MA=1;function Lo(o,s){if(!o)throw new Error("MapiRequest requires a client");if(!s||!s.path||!s.method)throw new Error("MapiRequest requires an options object with path and method properties");var a={};s.body&&(a["content-type"]="application/json");var u=xm(a,s.headers),p=Object.keys(u).reduce(function(g,v){return g[v.toLowerCase()]=u[v],g},{});this.id=MA++,this._options=s,this.emitter=new SA,this.client=o,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=s.path,this.method=s.method,this.origin=s.origin||o.origin,this.query=s.query||{},this.params=s.params||{},this.body=s.body||null,this.file=s.file||null,this.encoding=s.encoding||"utf8",this.sendFileAs=s.sendFileAs||null,this.headers=p}Lo.prototype.url=function(s){var a=Qd.prependOrigin(this.path,this.origin);a=Qd.appendQueryObject(a,this.query);var u=this.params,p=s??this.client.accessToken;if(p){a=Qd.appendQueryParam(a,"access_token",p);var g=EA(p).user;u=xm({ownerId:g},u)}return a=Qd.interpolateRouteParams(a,u),a};Lo.prototype.send=function(){var s=this;if(s.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return s.sent=!0,s.client.sendRequest(s).then(function(a){return s.response=a,s.emitter.emit(Px.EVENT_RESPONSE,a),a},function(a){throw s.error=a,s.emitter.emit(Px.EVENT_ERROR,a),a})};Lo.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))};Lo.prototype.eachPage=function(s){var a=this;function u(v){function r(){delete a._nextPageRequest;var T=v.nextPage();T&&(a._nextPageRequest=T,g(T))}s(null,v,r)}function p(v){s(v,null,function(){})}function g(v){v.send().then(u,p)}g(this)};Lo.prototype.clone=function(){return this._extend()};Lo.prototype._extend=function(s){var a=xm(this._options,s);return new Lo(this.client,a)};var AA=Lo,CA=Z1,IA=AA,PA=Rp;function K1(o){if(!o||!o.accessToken)throw new Error("Cannot create a client without an access token");CA(o.accessToken),this.accessToken=o.accessToken,this.origin=o.origin||PA.API_ORIGIN}K1.prototype.createRequest=function(s){return new IA(this,s)};var J1=K1,Q1=pA,tv=J1;function nc(o){tv.call(this,o)}nc.prototype=Object.create(tv.prototype);nc.prototype.constructor=nc;nc.prototype.sendRequest=Q1.browserSend;nc.prototype.abortRequest=Q1.browserAbort;function kA(o){return new nc(o)}var ev=kA,DA=ev,LA=DA,zA=Object.prototype.toString,RA=function(o){var s;return zA.call(o)==="[object Object]"&&(s=Object.getPrototypeOf(o),s===null||s===Object.getPrototypeOf({}))},OA=RA,BA=sc,iv="value",L_=`
  `,Ii={};Ii.assert=function(o,s){return s=s||{},function(a){var u=zo(o,a);if(u){var p=vm(u,s);throw s.apiName&&(p=s.apiName+": "+p),new Error(p)}}};Ii.shape=function(s){var a=VA(s);return function(p){var g=zo(Ii.plainObject,p);if(g)return g;for(var v,r,T=[],I=0;I<a.length;I++)v=a[I].key,r=a[I].value,g=zo(r,p[v]),g&&T.push([v].concat(g));return T.length<2?T[0]:function(R){T=T.map(function(Y){var it=Y[0],ct=vm(Y,R).split(`
`).join(L_);return"- "+it+": "+ct});var F=R.path.join("."),U=F===iv?"":" of "+F;return"The following properties"+U+" have invalid values:"+L_+T.join(L_)}}};Ii.strictShape=function(s){var a=Ii.shape(s);return function(p){var g=a(p);if(g)return g;var v=Object.keys(p).reduce(function(r,T){return s[T]===void 0&&r.push(T),r},[]);if(v.length!==0)return function(){return"The following keys are invalid: "+v.join(", ")}}};Ii.arrayOf=function(s){return nv(s)};Ii.tuple=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return nv(s)};function nv(o){var s=Array.isArray(o),a=function(u){return s?o[u]:o};return function(p){var g=zo(Ii.plainArray,p);if(g)return g;if(s&&p.length!==o.length)return"an array with "+o.length+" items";for(var v=0;v<p.length;v++)if(g=zo(a(v),p[v]),g)return[v].concat(g)}}Ii.required=function(s){function a(u){return u==null?function(p){return sv(p,rv(p.path)?"cannot be undefined/null.":"is required.")}:s.apply(this,arguments)}return a.__required=!0,a};Ii.oneOfType=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(u){var p=s.map(function(g){return zo(g,u)}).filter(Boolean);if(p.length===s.length)return p.every(function(g){return g.length===1&&typeof g[0]=="string"})?FA(p.map(function(g){return g[0]})):p.reduce(function(g,v){return v.length>g.length?v:g})}};Ii.equal=function(s){return function(u){if(u!==s)return JSON.stringify(s)}};Ii.oneOf=function(){var s=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),a=s.map(function(u){return Ii.equal(u)});return Ii.oneOfType.apply(this,a)};Ii.range=function(s){var a=s[0],u=s[1];return function(g){var v=zo(Ii.number,g);if(v||g<a||g>u)return"number between "+a+" & "+u+" (inclusive)"}};Ii.any=function(){};Ii.boolean=function(s){if(typeof s!="boolean")return"boolean"};Ii.number=function(s){if(typeof s!="number")return"number"};Ii.plainArray=function(s){if(!Array.isArray(s))return"array"};Ii.plainObject=function(s){if(!OA(s))return"object"};Ii.string=function(s){if(typeof s!="string")return"string"};Ii.func=function(s){if(typeof s!="function")return"function"};function zo(o,s){if(!(s==null&&!o.hasOwnProperty("__required"))){var a=o(s);if(a)return Array.isArray(a)?a:[a]}}function vm(o,s){var a=o.length,u=o[a-1],p=o.slice(0,a-1);return p.length===0&&(p=[iv]),s=BA(s,{path:p}),typeof u=="function"?u(s):sv(s,NA(u))}function FA(o){return o.length<2?o[0]:o.length===2?o.join(" or "):o.slice(0,-1).join(", ")+", or "+o.slice(-1)}function NA(o){return"must be "+jA(o)+"."}function jA(o){return/^an? /.test(o)?o:/^[aeiou]/i.test(o)?"an "+o:/^[a-z]/i.test(o)?"a "+o:o}function sv(o,s){var a=rv(o.path),u=o.path.join(".")+" "+s,p=a?"Item at position ":"";return p+u}function rv(o){return typeof o[o.length-1]=="number"||typeof o[0]=="number"}function VA(o){return Object.keys(o||{}).map(function(s){return{key:s,value:o[s]}})}Ii.validate=zo;Ii.processMessage=vm;var UA=Ii,GA=sc,Yl=UA;function qA(o){if(typeof window<"u")return o instanceof $s.Blob||o instanceof $s.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof o=="string"||o.pipe!==void 0))return"Filename or Readable stream"}function $A(o,s){return Yl.assert(Yl.strictShape(o),s)}function WA(o){var s="date";if(typeof o=="boolean")return s;try{var a=new Date(o);if(a.getTime&&isNaN(a.getTime()))return s}catch{return s}}function ZA(o){return Yl.tuple(Yl.number,Yl.number)(o)}var HA=GA(Yl,{file:qA,date:WA,coordinates:ZA,assertShape:$A});function XA(o,s){var a=function(u,p){return s.indexOf(u)!==-1&&p!==void 0};return typeof s=="function"&&(a=s),Object.keys(o).filter(function(u){return a(u,o[u])}).reduce(function(u,p){return u[p]=o[p],u},{})}var YA=XA;function KA(o,s){return Object.keys(o).reduce(function(a,u){return a[u]=s(u,o[u]),a},{})}var JA=KA,QA=JA;function tC(o){return QA(o,function(s,a){return typeof a=="boolean"?JSON.stringify(a):a})}var eC=tC,iC=J1,nC=ev;function sC(o){return function(s){var a;iC.prototype.isPrototypeOf(s)?a=s:a=nC(s);var u=Object.create(o);return u.client=a,u}}var rC=sC,ov=sc,Qe=HA,Ap=YA,av=eC,oC=rC,bm={},lv=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];bm.forwardGeocode=function(o){Qe.assertShape({query:Qe.required(Qe.string),mode:Qe.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qe.arrayOf(Qe.string),proximity:Qe.oneOf(Qe.coordinates,"ip"),types:Qe.arrayOf(Qe.oneOf(lv)),autocomplete:Qe.boolean,bbox:Qe.arrayOf(Qe.number),limit:Qe.number,language:Qe.arrayOf(Qe.string),routing:Qe.boolean,fuzzyMatch:Qe.boolean,worldview:Qe.string})(o),o.mode=o.mode||"mapbox.places";var s=av(ov({country:o.countries},Ap(o,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Ap(o,["mode","query"]),query:s})};bm.reverseGeocode=function(o){Qe.assertShape({query:Qe.required(Qe.coordinates),mode:Qe.oneOf("mapbox.places","mapbox.places-permanent"),countries:Qe.arrayOf(Qe.string),types:Qe.arrayOf(Qe.oneOf(lv)),bbox:Qe.arrayOf(Qe.number),limit:Qe.number,language:Qe.arrayOf(Qe.string),reverseMode:Qe.oneOf("distance","score"),routing:Qe.boolean,worldview:Qe.string})(o),o.mode=o.mode||"mapbox.places";var s=av(ov({country:o.countries},Ap(o,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:Ap(o,["mode","query"]),query:s})};var aC=oC(bm);let lC="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",cv=o=>crypto.getRandomValues(new Uint8Array(o)),hv=(o,s,a)=>{let u=(2<<Math.log(o.length-1)/Math.LN2)-1,p=-~(1.6*u*s/o.length);return(g=s)=>{let v="";for(;;){let r=a(p),T=p;for(;T--;)if(v+=o[r[T]&u]||"",v.length===g)return v}}},cC=(o,s=21)=>hv(o,s,cv),hC=(o=21)=>crypto.getRandomValues(new Uint8Array(o)).reduce((s,a)=>(a&=63,a<36?s+=a.toString(36):a<62?s+=(a-26).toString(36).toUpperCase():a>62?s+="-":s+="_",s),"");const uC=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:cC,customRandom:hv,nanoid:hC,random:cv,urlAlphabet:lC},Symbol.toStringTag,{value:"Module"})),dC=fM(uC);var pC=dC.nanoid;function uv(o){this.origin=o.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=o.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=o,this.send=this.send.bind(this),this.countries=o.countries?o.countries.split(","):null,this.types=o.types?o.types.split(","):null,this.bbox=o.bbox?o.bbox:null,this.language=o.language?o.language.split(","):null,this.limit=o.limit?+o.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(o),this.eventQueue=new Array,this.flushInterval=o.flushInterval||1e3,this.maxQueueSize=o.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}uv.prototype={select:function(o,s){var a=this.getSelectedIndex(o,s),u=this.getEventPayload("search.select",s);if(u.resultIndex=a,u.resultPlaceName=o.place_name,u.resultId=o.id,!(a===this.lastSentIndex&&u.queryString===this.lastSentInput||a==-1)&&(this.lastSentIndex=a,this.lastSentInput=u.queryString,!!u.queryString))return this.push(u)},start:function(o){var s=this.getEventPayload("search.start",o);if(s.queryString)return this.push(s)},keyevent:function(o,s){if(o.key&&!(o.metaKey||[9,27,37,39,13,38,40].indexOf(o.keyCode)!==-1)){var a=this.getEventPayload("search.keystroke",s);if(a.lastAction=o.key,!!a.queryString)return this.push(a)}},send:function(o,s){if(!this.enableEventLogging)return s?s():void 0;var a=this.getRequestOptions(o);this.request(a,(function(u){if(u)return this.handleError(u,s);if(s)return s()}).bind(this))},getRequestOptions:function(o){Array.isArray(o)||(o=[o]);var s={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)};return s},getEventPayload:function(o,s){var a;s.options.proximity?typeof s.options.proximity=="object"?a=[s.options.proximity.longitude,s.options.proximity.latitude]:s.options.proximity==="ip"?a=[999,999]:a=s.options.proximity:a=null;var u=s._map?s._map.getZoom():void 0,p={event:o,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:s.options.autocomplete,fuzzyMatch:s.options.fuzzyMatch,proximity:a,limit:s.options.limit,routing:s.options.routing,worldview:s.options.worldview,mapZoom:u,keyboardLocale:this.locale};return o==="search.select"?p.queryString=s.inputString:o!="search.select"&&s._inputEl?p.queryString=s._inputEl.value:p.queryString=s.inputString,p},request:function(o,s){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(this.readyState==4)return this.status==204?s(null):s(this.statusText)},a.open(o.method,o.host+"/"+o.path,!0);for(var u in o.headers){var p=o.headers[u];a.setRequestHeader(u,p)}a.send(o.body)},handleError:function(o,s){if(s)return s(o)},generateSessionID:function(){return pC()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(o,s){if(s._typeahead){var a=s._typeahead.data,u=o.id,p=a.map(function(v){return v.id}),g=p.indexOf(u);return g}},shouldEnableLogging:function(o){return!(o.enableEventLogging===!1||o.origin&&o.origin!=="https://api.mapbox.com"||o.localGeocoder||o.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(o,s){this.eventQueue.push(o),(this.eventQueue.length>=this.maxQueueSize||s)&&this.flush()},remove:function(){this.flush()}};var fC=uv,_C={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"},mC={placeholder:_C},dv={exports:{}};(function(o){(function(s,a,u){o.exports?o.exports=u():s[a]=u()})($s,"subtag",function(){var s="",a=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function u(T){return T.match(a)||[]}function p(T){return u(T).filter(function(I,R){return I&&R})}function g(T){return T=u(T),{language:T[1]||s,extlang:T[2]||s,script:T[3]||s,region:T[4]||s}}function v(T,I,R){Object.defineProperty(T,I,{value:R,enumerable:!0})}function r(T,I,R){function F(U){return u(U)[T]||s}v(F,"pattern",I),v(g,R,F)}return r(1,/^[a-zA-Z]{2,3}$/,"language"),r(2,/^[a-zA-Z]{3}$/,"extlang"),r(3,/^[a-zA-Z]{4}$/,"script"),r(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),v(g,"split",p),g})})(dv);var gC=dv.exports;function pv(){}pv.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const o={enableHighAccuracy:!0};return new Promise(function(s,a){window.navigator.geolocation.getCurrentPosition(s,a,o)})}};var yC=pv;function xC(o,s){const a=fv(o),u=["address","street","place","country"];var p;if(typeof s=="function")return s(a);const g=u.indexOf(s);return g===-1?p=u:p=u.slice(g),p.reduce(function(v,r){return a[r]?(v!==""&&(v=v+", "),v+a[r]):v},"")}function fv(o){const s=o.address||"",a=o.text||"",u=o.place_name||"",g={address:u.split(",")[0],houseNumber:s,street:a,placeName:u};return o.context.forEach(function(v){const r=v.id.split(".")[0];g[r]=v.text}),g}const vC=/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/;var bC={transformFeatureToGeolocationText:xC,getAddressInfo:fv,REVERSE_GEOCODE_COORD_RGX:vC},wC=EM,TC=UM,Oa=sc,EC=XM.EventEmitter,kx=YM,z_=LA,R_=aC,SC=fC,MC=mC,AC=gC,CC=yC,Dx=bC;const So={FORWARD:0,LOCAL:1,REVERSE:2};function IC(){var o=document.createElement("div");return o.className="mapboxgl-ctrl-geocoder--powered-by",o.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',o}function _v(o){this._eventEmitter=new EC,this.options=Oa({},this.options,o),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new CC}_v.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(o){return o.place_name},render:function(o){var s=o.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+s[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+s.splice(1,s.length).join(",")+"</div></div>"}},addTo:function(o){function s(a,u){if(!document.body.contains(u))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const p=a.onAdd();u.appendChild(p)}if(o._controlContainer)o.addControl(this);else if(o instanceof HTMLElement)s(this,o);else if(typeof o=="string"){const a=document.querySelectorAll(o);if(a.length===0)throw new Error("Element ",o,"not found.");if(a.length>1)throw new Error("Geocoder can only be added to a single html element");s(this,a[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(o){if(o&&typeof o!="string"&&(this._map=o),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=R_(z_({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new SC(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var s=this.container=document.createElement("div");s.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var a=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",TC(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(I){this.eventManager.keyevent(I,this)}).bind(this));var u=document.createElement("div");u.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var p=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(p),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),u.appendChild(this._clearEl),u.appendChild(this._loadingEl),s.appendChild(a),s.appendChild(this._inputEl),s.appendChild(u),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var g=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(g),u.appendChild(this._geolocateEl),this._showGeolocateButton()}var v=this._typeahead=new wC(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),v.getItemValue=this.options.getItemValue;var r=v.list.draw,T=this._footerNode=IC();return v.list.draw=function(){r.call(this),T.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),T.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(T)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),s},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(o){this._hideLoadingIcon();const s={geometry:{type:"Point",coordinates:[o.coords.longitude,o.coords.latitude]}};this._handleMarker(s),this._fly(s),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(s),this._showClearButton(),this.fresh=!1;const a={limit:1,language:[this.options.language],query:s.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const u=s.geometry.coordinates[0]+","+s.geometry.coordinates[1];this._setInputValue(u),this._eventEmitter.emit("result",{result:s})}else this.geocoderService.reverseGeocode(a).send().then((function(u){const p=u.body.features[0];if(p){const g=Dx.transformFeatureToGeolocationText(p,this.options.addressAccuracy);this._setInputValue(g),p.user_coordinates=s.geometry.coordinates,this._eventEmitter.emit("result",{result:p})}else this._eventEmitter.emit("result",{result:{user_coordinates:s.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(o){o.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(o,s){var a=document.createElementNS("http://www.w3.org/2000/svg","svg");return a.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+o),a.setAttribute("viewBox","0 0 18 18"),a.setAttribute("xml:space","preserve"),a.setAttribute("width",18),a.setAttribute("height",18),a.innerHTML=s,a},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(o){this._inputEl.value=o,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(o){var s=(o.clipboardData||window.clipboardData).getData("text");s.length>=this.options.minLength&&this._geocode(s)},_onKeyDown:function(o){var s=27,a=9;if(o.keyCode===s&&this.options.clearAndBlurOnEsc)return this._clear(o),this._inputEl.blur();var u=o.target&&o.target.shadowRoot?o.target.shadowRoot.activeElement:o.target,p=u?u.value:"";if(!p)return this.fresh=!0,o.keyCode!==a&&this.clear(o),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(o.metaKey||[a,s,37,39,13,38,40].indexOf(o.keyCode)!==-1)&&u.value.length>=this.options.minLength&&this._geocode(u.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(o){this.options.clearOnBlur&&this._clearOnBlur(o),this.options.collapsed&&this._collapse()},_onChange:function(){var o=this._typeahead.selected;o&&JSON.stringify(o)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(o),this.options.marker&&this._mapboxgl&&this._handleMarker(o),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(o),this._eventEmitter.emit("result",{result:o}),this.eventManager.select(o,this))},_fly:function(o){var s;if(o.properties&&kx[o.properties.short_code])s=Oa({},this.options.flyTo),this._map&&this._map.fitBounds(kx[o.properties.short_code].bbox,s);else if(o.bbox){var a=o.bbox;s=Oa({},this.options.flyTo),this._map&&this._map.fitBounds([[a[0],a[1]],[a[2],a[3]]],s)}else{var u={zoom:this.options.zoom};s=Oa({},u,this.options.flyTo),o.center?s.center=o.center:o.geometry&&o.geometry.type&&o.geometry.type==="Point"&&o.geometry.coordinates&&(s.center=o.geometry.coordinates),this._map&&this._map.flyTo(s)}},_requestType:function(o,s){var a;return o.localGeocoderOnly?a=So.LOCAL:o.reverseGeocode&&Dx.REVERSE_GEOCODE_COORD_RGX.test(s)?a=So.REVERSE:a=So.FORWARD,a},_setupConfig:function(o,s){const a=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],u=/[\s,]+/;var p=this,g=a.reduce(function(r,T){if(p.options[T]===void 0||p.options[T]===null)return r;["countries","types","language"].indexOf(T)>-1?r[T]=p.options[T].split(u):r[T]=p.options[T];const I=typeof p.options[T].longitude=="number"&&typeof p.options[T].latitude=="number";if(T==="proximity"&&I){const R=p.options[T].longitude,F=p.options[T].latitude;r[T]=[R,F]}return r},{});switch(o){case So.REVERSE:{var v=s.split(u).map(function(r){return parseFloat(r,10)});p.options.flipCoordinates||v.reverse(),g.types&&g.types[0],g=Oa(g,{query:v,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(r){r in g&&delete g[r]})}break;case So.FORWARD:{const r=s.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(r)&&(s=s.replace(/,/g," ")),g=Oa(g,{query:s})}break}return g},_geocode:function(o){this.inputString=o,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:o});const s=this._requestType(this.options,o),a=this._setupConfig(s,o);var u;switch(s){case So.LOCAL:u=Promise.resolve();break;case So.FORWARD:u=this.geocoderService.forwardGeocode(a).send();break;case So.REVERSE:u=this.geocoderService.reverseGeocode(a).send();break}var p=this.options.localGeocoder?this.options.localGeocoder(o)||[]:[],g=[],v=null;return u.catch((function(r){v=r}).bind(this)).then((function(r){this._hideLoadingIcon();var T={};return r?r.statusCode=="200"&&(T=r.body,T.request=r.request,T.headers=r.headers):T={type:"FeatureCollection",features:[]},T.config=a,this.fresh&&(this.eventManager.start(this),this.fresh=!1),T.features=T.features?p.concat(T.features):p,this.options.externalGeocoder?(g=this.options.externalGeocoder(o,T.features)||Promise.resolve([]),g.then(function(I){return T.features=T.features?I.concat(T.features):I,T},function(){return T})):T}).bind(this)).then((function(r){if(v)throw v;this.options.filter&&r.features.length&&(r.features=r.features.filter(this.options.filter)),r.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",r),this._typeahead.update(r.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",r))}).bind(this)).catch((function(r){this._hideLoadingIcon(),this._hideAttribution(),p.length&&this.options.localGeocoder||g.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(p)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:p}),this._eventEmitter.emit("error",{error:r})}).bind(this)),u},_clear:function(o){o&&o.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(o){this._clear(o),this._inputEl.focus()},_clearOnBlur:function(o){var s=this;o.relatedTarget&&s._clear(o)},_onQueryResult:function(o){var s=o.body;if(s.features.length){var a=s.features[0];this._typeahead.selected=a,this._inputEl.value=a.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var o=this._map.getCenter().wrap();this.setProximity({longitude:o.lng,latitude:o.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(o){return this._geocode(o).then(this._onQueryResult),this},_renderError:function(){var o="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(o)},_renderLocationError:function(){var o="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(o)},_renderNoResults:function(){var o="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(o)},_renderUserDeniedGeolocationError:function(){var o="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(o)},_renderMessage:function(o){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(o)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var o=this.options.language.split(",")[0],s=AC.language(o),a=MC.placeholder[s];if(a)return a}return"Search"},setInput:function(o){return this._inputEl.value=o,this._typeahead.selected=null,this._typeahead.clear(),o.length>=this.options.minLength&&this._geocode(o),this},setProximity:function(o,s=!0){return this.options.proximity=o,s&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(o){return o&&typeof o=="function"&&(this._typeahead.render=o),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(o){var s=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=o||this.options.language||s,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(o){return this.options.zoom=o,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(o){return this.options.flyTo=o,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(o){return this.placeholder=o||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(o){return this.options.bbox=o,this},getCountries:function(){return this.options.countries},setCountries:function(o){return this.options.countries=o,this},getTypes:function(){return this.options.types},setTypes:function(o){return this.options.types=o,this},getMinLength:function(){return this.options.minLength},setMinLength:function(o){return this.options.minLength=o,this._typeahead&&(this._typeahead.options.minLength=o),this},getLimit:function(){return this.options.limit},setLimit:function(o){return this.options.limit=o,this._typeahead&&(this._typeahead.options.limit=o),this},getFilter:function(){return this.options.filter},setFilter:function(o){return this.options.filter=o,this},setOrigin:function(o){return this.options.origin=o,this.geocoderService=R_(z_({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(o){return this.options.accessToken=o,this.geocoderService=R_(z_({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(o){return this.options.autocomplete=o,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(o){return this.options.fuzzyMatch=o,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(o){return this.options.routing=o,this},getRouting:function(){return this.options.routing},setWorldview:function(o){return this.options.worldview=o,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(o){if(this._map){this._removeMarker();var s={color:"#4668F2"},a=Oa({},s,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(a),o.center?this.mapMarker.setLngLat(o.center).addTo(this._map):o.geometry&&o.geometry.type&&o.geometry.type==="Point"&&o.geometry.coordinates&&this.mapMarker.setLngLat(o.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(o,s){return this._eventEmitter.on(o,s),this},off:function(o,s){return this._eventEmitter.removeListener(o,s),this.eventManager.remove(),this}};var PC=_v;const kC=D1(PC);bs.register(...JS);let La=["villages-travel-time-simple","villages-travel-time-detailed"],tp=["villages-travel-time-detailed","villages-travel-time-simple"];cu.accessToken="pk.eyJ1IjoiaGlnaGVzdHJvYWQiLCJhIjoiY2lzNjlpa3c3MGQ3cDJ6cDFzMXZpZTNmMCJ9.M1X4AOcuj4n3VT01ze0x5Q";const gi=new cu.Map({container:"map",style:"mapbox://styles/highestroad/clg35ltys000m01nhht5my9n3",center:[29.519,-1.956],zoom:8.2,hash:!0,maxBounds:[[26.856,-4.84],[32.8954,1.0546]],minZoom:7.1}),DC=new cu.NavigationControl;gi.addControl(DC,"bottom-left");let hu=[];for(let o=1;o<=4;o++){let s=document.getElementById("dropdown"+o);hu.push(s)}function Cp(o){return o.replace(/\s/g,"")}ic(ec.dropdown1,dropdown1);dropdown1.value="Travel Time";ic(ec.dropdown2[Cp(dropdown1.value)],dropdown2);dropdown2.value="With All Bridges";ic(ec.dropdown3[Cp(dropdown1.value)],dropdown3);dropdown3.value="To School";ic(ec.dropdown4,dropdown4);dropdown4.disabled=!1;let Kl={};for(let o=1;o<=4;o++){let s="dropdown"+o;Kl[s]=hu[o-1].value}function LC(){for(let o=0;o<4;o++)Kl[hu[o].id]=hu[o].value}hu.forEach(o=>{o.addEventListener("change",function(){o.id=="dropdown1"&&(ic(ec.dropdown2[Cp(o.value)],dropdown2),ic(ec.dropdown3[Cp(o.value)],dropdown3)),o.id=="dropdown4"&&hM(dropdown4.value),LC(),dM(Kl)})});iM();gi.on("load",function(){uM(gi);const o=new kC({accessToken:cu.accessToken,mapboxgl:cu,bbox:[28.856,-2.84,30.8954,-1.0546]});document.getElementById("geocoder").appendChild(o.onAdd(gi));let s=null;tp=["hex-8-layer"],La=["hex-8-layer","bridge-point","health-point","edu-point"];for(let a=0;a<La.length;a++)gi.on("mousemove",La[a],function(u){u.features[0].id&&(u.features[0].id,gi.getCanvas().style.cursor="pointer",J0(La[a],u.features[0]))});for(let a=0;a<La.length;a++)gi.on("mouseleave",La[a],function(u){J0(La[a]),gi.getCanvas().style.cursor=""});for(let a=0;a<tp.length;a++)gi.on("click",function(u){document.getElementById("click-panel").classList.remove("show"),document.getElementById("control-panel").classList.remove("left"),s!==null&&gi.setFeatureState({source:"hex-8-source",id:s},{click:!1}),s=null}),gi.on("click",tp[a],function(u){oM(tp[a],u.features[0].properties),document.getElementById("control-panel").classList.add("left"),u.features.length>0&&(s!==null&&gi.setFeatureState({source:"hex-8-source",id:s},{click:!1}),s=u.features[0].id,gi.setFeatureState({source:"hex-8-source",id:s},{click:!0}))})});let ep=["info-button","feedback-button","bridge-need-button","bug-button"];for(let o=0;o<ep.length;o++)document.getElementById(ep[o]).addEventListener("click",function(){console.log(ep[o]),pM(ep[o])});document.getElementById("close-button").addEventListener("click",function(){document.getElementById("click-panel").classList.remove("show"),document.getElementById("control-panel").classList.remove("left")});document.getElementById("close-modal-button").addEventListener("click",function(){var o=document.getElementById("info-modal");o.style.display="none",document.body.classList.remove("modal-open")});
